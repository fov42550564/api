* PDShopServer/project/App/index.js

```js
import bodyParser from 'body-parser';
import express from 'express';
import multer from 'multer';
import mongoose from 'mongoose';
import path from 'path';
import xmlparser from 'express-xml-bodyparser';

import routers from './routers';

const storage = {
    _handleFile (req, file, cb) {
        const { originalname, stream } = file;
        const writestream = mongoose.gfs.createWriteStream({
            filename: originalname,
        }).on('close', grid => {
            cb(null, { grid });
        }).on('error', cb);

        stream.pipe(writestream);
    },
    _removeFile (req, file, cb) {
        if (file.grid) {
            mongoose.gfs.remove({ _id: file.grid._id }, cb);
        } else {
            cb(null);
        }
    },
};

const app = express();
// Multer
app.use(multer({
    storage,
    limits: {
        fileSize: 100000000,
    },
    onFileSizeLimit: function (file) {
        mongoose.gfs.remove({ _id: file.id });
    },
}).single('file'));

// Json
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json({ limit: 100000000 }));
app.use(xmlparser({ explicitArray: false, ignoreAttrs: true }));

// Static files
app.use(express.static(path.resolve('public')));
app.use(express.static(path.resolve('download')));

app.all('*', (req, res, next) => {
    res.header('Access-Control-Allow-Origin', '*');
    res.header('Access-Control-Allow-Headers', 'Content-Type');
    next();
});

// Routers
app.use(routers);

export default app;

```

* PDShopServer/project/App/constants/account.js

```js
// 账户类型
export const AT_BASIC = 0; // 基础账号类型（包括10000，10001，10002）
export const AT_BRANCH_SHOP = 1; // 分店账号类型
export const AT_BRANCH_SHOP_PARTMENT = 2; // 分店部门账号类型
export const AT_CLIENT = 3; // 货主账号类型（物流公司的账号为物流公司负责人的账号，收货点的账号为收货点的账号）

/*
 * 银行对应账户对应银行卡里面的钱。对账的时候，需要看银行对应账户和银行卡的钱是否一致（利息另算）
 * 安全账户用来存放不可动用的部分（各种押金，当交易成功后才将这些钱划到相应的账户上）
 * 总部账户用户存放总部的提成。
 */
export const AC_BANK_ACCOUNT = 10000; // 银行对应账户
export const AC_SECURITY_ACCOUNT = 10001; // 安全账户
export const AC_MASTER_ACCOUNT = 10002; // 总部账户，总部可以支配的金额

// 对账方法：
// 银行对应账户 = 10001以上的账号总和 =  充值总额 - 提现总额

```

* PDShopServer/project/App/constants/authority.js

```js
/*
*
* 规则，只能添加，不能修改
*
*/

// 总部权限
export const AH_CREATE_BRANCH_SHOP = 0; // 创建分店的权限
export const AH_MODIFY_BRANCH_SHOP = 1; // 修改分店信息的权限
export const AH_REMOVE_BRANCH_SHOP = 2; // 删除分店的权限
export const AH_LOOK_BRANCH_SHOP = 3; // 查看分店列表的权限
export const AH_MODIFY_SETTING = 4; // 修改设置的权限
export const AH_CREATE_AGENT = 5; // 创建收货点的权限
export const AH_MODIFY_AGENT = 6; // 修改收货点的权限
export const AH_REMOVE_AGENT = 7; // 删除收货点的权限
export const AH_LOOK_AGENT = 8; // 查看收货点的权限

// 公共权限
export const AH_MODIFY_OWN_SHOP = 10000; // 修改所在物流超市信息的权限
export const AH_CREATE_MEMBER = 10001; // 创建成员的权限
export const AH_MODIFY_MEMBER = 10002; // 修改成员信息的权限
export const AH_REMOVE_MEMBER = 10003; // 删除成员的权限
export const AH_LOOK_MEMBER = 10004; // 查看成员的权限
export const AH_RECHARGE = 10005; // 充值的权限
export const AH_WITHDRAW = 10006; // 提现的权限
export const AH_LOOK_AMOUNT = 10007; // 查看余额的权限
export const AH_MODIFY_ROADMAP_PROFIT = 10008; // 修改路线的提成的权限
export const AH_LOOK_STATISTICS = 10009; // 查看统计信息的权限
export const AH_LOOK_ORDERS = 10010; // 查看综合货单的权限

// 分店权限
export const AH_CREATE_SHIPPER = 20000; // 创建物流公司的权限
export const AH_MODIFY_SHIPPER = 20001; // 修改物流公司的权限
export const AH_REMOVE_SHIPPER = 20002; // 删除物流公司的权限
export const AH_LOOK_SHIPPER = 20003; // 查看物流公司的权限
export const AH_CREATE_PARTMENT = 20004; // 创建部门的权限
export const AH_MODIFY_PARTMENT = 20005; // 修改部门信息的权限
export const AH_REMOVE_PARTMENT = 20006; // 删除部门的权限
export const AH_LOOK_PARTMENT = 20007; // 查看部门的权限
export const AH_MODIFY_OWN_PARTMENT = 20008; // 修改所在部门信息的权限
export const AH_RECEIVE_PARTMENT = 20009; // 收货的权限（收货部人员）
export const AH_WARE_HOUSE_PARTMENT = 20010; // 库管的权限（库管部人员）
export const AH_CARRY_PARTMENT = 20011; // 搬货的权限（搬运部人员）
export const AH_SECURITY_CHECK_PARTMENT = 20012; // 安检的权限（保安部人员）
export const AH_DISTRIBUTION_PARTMENT = 20013; // 配送的权限（配送部人员）
export const AH_TO_EXAMINE_TRUCK = 20014; // 审核货车的权限
export const AH_CREATE_WAREHOUSE = 20015; // 创建仓库的权限
export const AH_MODIFY_WAREHOUSE = 20016; // 修改仓库信息的权限
export const AH_REMOVE_WAREHOUSE = 20017; // 删除仓库的权限
export const AH_LOOK_WAREHOUSE = 20018; // 查看仓库的权限

// 物流公司
export const AH_MODIFY_SHIPPER_INFO = 30000; // 修改物流公司信息的权限
export const AH_MODIFY_SHIPPER_MEMBER_AUTHORITY = 30001; // 修改物流公司成员权限的权限
export const AH_CREATE_ROADMAP = 30002; // 创建路线的权限
export const AH_MODIFY_ROADMAP = 30003; // 修改路线的权限
export const AH_REMOVE_ROADMAP = 30004; // 删除路线的权限
export const AH_LOOK_ROADMAP = 30005; // 查看路线的权限 (分店共享该权限)
export const AH_CREATE_SEND_DOOR_ROADMAP = 30006; // 创建同城配送路线的权限
export const AH_MODIFY_SEND_DOOR_ROADMAP = 30007; // 修改同城配送路线的权限
export const AH_REMOVE_SEND_DOOR_ROADMAP = 30008; // 删除同城配送路线的权限
export const AH_LOOK_SEND_DOOR_ROADMAP = 30009; // 查看同城配送路线的权限 (分店共享该权限)
export const AH_CREATE_TRUCK = 30010; // 创建货车的权限
export const AH_MODIFY_TRUCK = 30011; // 修改货车的权限
export const AH_REMOVE_TRUCK = 30012; // 删除货车的权限
export const AH_LOOK_TRUCK = 30013; // 查看货车的权限
export const SELECT_CARRY_PARTMENT = 30014; // 选择搬运队的权限
export const AH_SCAN_LOAD_TRUCK = 30015; // 扫描装车的权限
export const AH_CITY_DISTRIBUTE = 30016; // 同城配送的权限

// 收货点
export const AH_MODIFY_AGENT_INFO = 40000; // 修改收货点信息的权限
export const AH_MODIFY_AGENT_MEMBER_AUTHORITY = 40001; // 修改收货点成员权限的权限
export const AH_PLACE_ORDER = 40002; // 收货点下单的权限

```

* PDShopServer/project/App/constants/common.js

```js
// 支付方式
export const PM_IMMEDIATE = 0; // 现付
export const PM_REACH = 1; // 到付
export const PM_MIXED = 2; // 混合支付（指定收款的部分到付，其余的现付）

// 支付工具
export const PT_CASH = 0; // 现金支付
export const PT_ALIPAY = 1; // 支付宝
export const PT_WEIXIN = 2; // 微信
export const PT_BANK = 3; // 银行

// 物流公司类型
export const ST_LONG = 0; // 长途物流公司
export const ST_CITY = 1; // 同城配送物流公司

// 方向设置的类型
export const RRT_ALL = 0; // 所有
export const RRT_LONG = 1; // 长途
export const RRT_CITY = 2; // 同城配送

// 公里与弧度的计算比
export const KILOMETRE_RADIAN_RATE = 111.12;

```

* PDShopServer/project/App/constants/index.js

```js
import * as common from './common';
import * as authority from './authority';
import * as account from './account';
import * as state from './state';
import * as post from './post';
import * as partment from './partment';

export default {
    ...common,
    ...authority,
    ...account,
    ...state,
    ...post,
    ...partment,
};

```

* PDShopServer/project/App/constants/partment.js

```js
// 分店
export const SP_RECEIVE_PARTMENT = 0; // 收货部
export const SP_WARE_HOUSE_PARTMENT = 1; // 库管部
export const SP_CARRY_PARTMENT = 2; // 搬运部
export const SP_SECURITY_CHECK_PARTMENT = 3; // 保安部

```

* PDShopServer/project/App/constants/post.js

```js
// 职位
export const PO_CHAIR_MAN = '董事长';
export const PO_PARTMENT_CHARGE_MAN = '部门经理'; // 五大部门的经理
export const PO_CEO = '总经理';
export const PO_PARTMENT_LEADER = '部门主管'; // 五大部门的经理
export const PO_STAFF = '员工';

```

* PDShopServer/project/App/constants/state.js

```js
// 货单的状态
/*
===========
长途运输状态图:(当物流公司确认卸货之后，那么它之前的货单就在待交货状态)
(0->)1->2->5    |           |->11
                |->6->7->8  |
(0->)1->3->4->5 |           |->14->15
===========
收货点状态图:
0->2->9    |
           |(->10)->11->14->15
0->3->4->9 |
===========
同城配送状态图: (当同城配送的在运输中，那么它之前的货单就在待交货状态)
(0->)1->2->5    |
                |->6->8->15
(0->)1->3->4->5 |
===========
上门自提状态图:(当上门自提的在运输中或者等待上门自提，那么它之前的货单就在待交货状态)
         |->13->15
1->5->12 |
         |->6->8->15
*/
export const OS_PREORDER = -1; // 预下单状态，需要将货拉到分店后不显示（件数，重量，方量），由收货员填写确认后进入待选线路状态
export const OS_READY_PRINT_BAR_CODE = 0; // 待打印二维码
export const OS_READY_SELECT_ROADMAP = 1; // 待选物流公司
export const OS_READY_DEDUCT_AND_PRINT_ORDER = 2; // 待扣款并打印打印货单（用来区别需要付款的情况）
export const OS_READY_PAYMENT = 3; // 待付款
export const OS_READY_PRINT_ORDER = 4; // 待打印货单
export const OS_READY_STOCK = 5; // 待入库
export const OS_READY_LOAD = 6; // 待装车
export const OS_READY_START_OFF = 7; // 待出发
export const OS_ON_THE_WAY = 8; // 运输中
export const OS_READY_SEND = 9; // 待发货 (收货点专用)
export const OS_ON_SENDING = 10; // 发货中 (收货点专用)
export const OS_ON_TRANSFER = 11; // 中转中
export const OS_READY_PHONE_CONFIRM = 12; // 待打电话确认
export const OS_WAIT_CLIENT_PICK = 13; // 等待上门自提
export const OS_READY_RECEIVE = 14; // 待交货
export const OS_RECEIVE_SUCCESS = 15; // 交货成功

// 货车的状态
export const TS_READY_EXAMINE = 0; // 待审核
export const TS_READY_ENTER_WAREHOUSE = 1; // 待入库
export const TS_READY_SEARCH_CARRY_PARTMENT = 2; // 待找搬运队
export const TS_READY_SCAN_LOAD = 3; // 待扫描装车
export const TS_SCAN_LOADING = 4; // 装车中
export const TS_READY_PAY_FOR_CARRY_PARTMENT = 5; // 待付搬运部的款
export const TS_READY_EXIT_WAREHOUSE = 6; // 待出库
export const TS_ON_THE_WAY = 7; // 运输中
export const TS_RECEIVE_SUCCESS = 8; // 驾驶员或者物流公司的人点击确认到达后的状态

// 支付状态
export const PS_READY_PAY = 0; // 待支付
export const PS_READY_SAVE = 1; // 待同步数据
export const PS_SUCCESS = 2; // 支付完成

```

* PDShopServer/project/App/models/AdminModel.js

```js
import mongoose from 'mongoose';
import passportLocalMongoose from 'passport-local-mongoose';
import { virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    phone: { type: String, required: true, unique: true }, // 注册电话
    email: { type: String }, //注册邮箱，用来找回密码
});

schema.plugin(passportLocalMongoose, { usernameField: 'phone' });

virtualObjectById(schema);

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatObjectById(ret);
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Admin', schema);

```

* PDShopServer/project/App/models/AgentModel.js

```js
import mongoose from 'mongoose';
import { formatMedia, formatTime, getMediaPath, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

/*
 * 当发货人将货物拉到收货点的时候，收货点的人员通过填写重量和方量后，显示出路线排名，依据是对应的referShopId的路线，显示价格为该收货点设置的提成比*实际价格
 * 如果收货点对该条路线设置了单独的提成比，优先使用，否则使用默认的提成比
 * 当客户使用预下单和查看行情时，也需要显示提价后的价格
 */

const schema = new Schema({
    chairManId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 董事长(法人)
    // 基础信息
    name: { type: String }, // 收货点名称
    image: { type: String }, // 收货点背景图片
    sign: { type: String }, // 收货点签名
    addressRegion: { type: String }, // 物流超市所在城市
    addressRegionLastCode: { type: Number }, // 物流超市所在城市的lastCode
    address: { type: String }, // 收货点地址
    location: { type: [ Number ], index: '2d' }, // 经纬度定位(必须使用地图来选择)
    phoneList: { type: String }, // 收货点电话列表

    // 法人信息
    legalName: { type: String }, // 法人姓名
    legalPhone: { type: String }, // 法人电话
    legalIDCard: [{ type: Schema.Types.ObjectId, ref: 'Media' }], // 法人身份证

    // 参考店铺
    referShopId: { type: Schema.Types.ObjectId, ref: 'Shop' },

    createTime: { type: Date, default: Date.now }, //创建时间
});

virtualObjectById(schema, 'chairManId', 'referShopId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        ret.name = ret.name || ret.phone;
        formatMedia(ret, 'image');
        formatTime(ret, 'createTime');
        formatObjectById(ret, 'chairManId', 'referShopId');
        ret.legalIDCard && (ret.legalIDCard = ret.legalIDCard.map(o => getMediaPath(o)));
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Agent', schema);

```

* PDShopServer/project/App/models/AgentRegionProfitModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { formatTime, virtualObjectById, formatObjectById } from '../utils';

const schema = new Schema({
    agentId: { type: Schema.Types.ObjectId, ref: 'Agent' }, // 所属收货点
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属分店 Id， 如果为空，则为所有的分店

    region: { type: String }, // 方向，如：北京（必须使用地图选择）
    regionLastCode: { type: Number, default: 0 },  // 方向的最后一个code

    profitRate: { type: Number, default: 0 }, // 收货点对路线的提成比例
    profitCount: { type: Number, default: 0 }, // 收货点对路线的提成价格 （优先于profitRate）

    type: { type: Number, default: 0 }, // 类型，0：所有，1：长途，2：短途

    level: { type: Number, default: 0 },  // 内部使用，用来排序
    createTime: { type: Date, default: Date.now }, // 创建时间
    modifyTime: { type: Date }, //修改时间
});

virtualObjectById(schema, 'shopId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'modifyTime');
        formatObjectById(ret, 'shopId');

        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('AgentRegionProfit', schema);

```

* PDShopServer/project/App/models/CityTruckModel.js

```js
import mongoose from 'mongoose';
import { formatTime, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    shipperId: { type: Schema.Types.ObjectId, ref: 'Shipper' }, // 所属物流公司 Id
    driverId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 对应的司机(同城配送的物流公司员工)

    enable: { type: Boolean, default: true }, // 是否可用，当董事长添加一个成员权限的时候，默认是可用的，当删除权限的时候，车辆关系不删除，设置为不可用的状态
    plateNo: { type: String }, // 车牌号码
    locationList: [ { address: String, longitude: Number, latitude: Number, time: Date } ], // 定位列表

    // 货单
    orderList: [ { type: Schema.Types.ObjectId, ref: 'Order' } ], // 货单列表
    orderCount: { type: Number, default: 0 }, // 总单数
    totalNumbers: { type: Number, default: 0 }, // 总件数
    totalWeight: { type: Number, default: 0 }, // 总重量
    totalSize: { type: Number, default: 0 }, // 总方量
    unloadAllOrderList: [ { type: Schema.Types.ObjectId, ref: 'Order' } ], // 只上了一部分货单列表

    createTime: { type: Date, default: Date.now }, // 创建时间
    modifyTime: { type: Date }, // 修改时间
});

virtualObjectById(schema, 'driverId', 'shipperId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'modifyTime');
        formatObjectById(ret, 'driverId', 'shipperId');
        ret.locationList && (ret.locationList = ret.locationList.map(item => { formatTime(item, 'time'); delete item._id; return item; }));
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('CityTruck', schema);

```

* PDShopServer/project/App/models/ClientModel.js

```js
import mongoose from 'mongoose';
import passportLocalMongoose from 'passport-local-mongoose';
import { _T, formatTime, formatMedia, formatPhoneList, virtualObjectById, formatObjectById } from '../utils';
import moment from 'moment';
import { AccountModel } from '../mysql';
import CONSTANTS from '../constants';
const Schema = mongoose.Schema;

const schema = new Schema({
    phone: { type: String, required: true, unique: true }, // 注册电话
    email: { type: String }, // 注册邮箱，用来找回密码
    name: { type: String }, // 姓名
    sex: { type: Number, default: 0 }, // 性别 0:男   1:女
    head: { type: Schema.Types.ObjectId, ref: 'Media' }, // 用户头像
    birthday: { type: String }, // 生日
    address: { type: String }, // 住址
    phoneList: { type: String }, // 预备电话列表

    authority: [ { type: Number } ], // 拥有的权限
    isSetPaymentPassword: { type: Number, default: 0 }, // 性别 0:没设置   1:已设置

    shipperId: { type: Schema.Types.ObjectId, ref: 'Shipper' }, // 所属物流公司
    truckId: { type: Schema.Types.ObjectId, ref: 'CityTruck' }, // 同城配送的人员对应的货车
    agentId: { type: Schema.Types.ObjectId, ref: 'Agent' }, // 所属收货点
    // 时间
    createTime: { type: Date, default: Date.now }, // 创建时间
    registerTime: { type: Date }, // 注册时间（只有实际注册的用户才有这个时间）
});
schema.plugin(passportLocalMongoose, { usernameField: 'phone' });

schema.virtual('age').get(function () {
    return this.birthday && Math.floor(moment().diff(moment(this.birthday)) / 31536000000);
});

virtualObjectById(schema, 'shipperId', 'truckId', 'agentId');

schema.statics.checkExistElseCreate = async function (phone, name) {
    let user = await this.findOne({ phone });
    if (!user) {
        user = new this({ phone, name });
        const account = await AccountModel.create({ targetId: _T(user.id), type: CONSTANTS.AT_CLIENT });
        if (!account) {
            return undefined;
        }
        await user.save();
    } else if (!user.registerTime && !user.name) { // 如果对方还没有注册，可以修改对方的用户名
        user.name = name;
        await user.save();
    }
    return user.id;
};

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'registerTime');
        formatMedia(ret, 'head');
        formatObjectById(ret, 'shipperId', 'truckId', 'agentId');
        formatPhoneList(ret);
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Client', schema);

```

* PDShopServer/project/App/models/CollectionModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { formatTime, virtualObjectById, formatObjectById } from '../utils';

const schema = new Schema({
    clientId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 客户 Id
    roadmapId: { type: Schema.Types.ObjectId, ref: 'Roadmap' }, // 路线 Id
    collectionTime: { type: Date, default: Date.now }, //收藏时间
});

virtualObjectById(schema);

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'collectionTime');
        formatObjectById(ret);
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Collection', schema);

```

* PDShopServer/project/App/models/CommentModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { getMediaPath, formatTime, virtualObjectById, formatObjectById } from '../utils';

const schema = new Schema({
    clientId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 客户 Id
    roadmapId: { type: Schema.Types.ObjectId, ref: 'Roadmap' }, // 线路 Id
    commentTime: { type: Date, default: Date.now }, // 评论时间
    content: { type: String }, // 评论内容
    imgList: [{ type: Schema.Types.ObjectId, ref: 'Media' }], //图片列表
});

virtualObjectById(schema, 'clientId');

const transform = {
    virtuals: true,
    depopulate: ['clientId'],
    transform: function (doc, ret, options) {
        formatTime(ret, 'commentTime');
        formatObjectById(ret, 'clientId');
        ret.imgList && (ret.imgList = ret.imgList.map(item => getMediaPath(item)));
        ret.userId = ret.clientId;
        delete ret.clientId;
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Comment', schema);

```

* PDShopServer/project/App/models/DriverModel.js

```js
import mongoose from 'mongoose';
import passportLocalMongoose from 'passport-local-mongoose';
import moment from 'moment';
import { formatTime, formatMedia, formatPhoneList, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
  // 基本信息
    phone: { type: String, required: true, unique: true }, // 注册电话
    email: { type: String }, // 注册邮箱，用来找回密码
    name: { type: String }, // 姓名
    sex: { type: Number, default: 0 }, // 性别 0:男   1:女
    head: { type: Schema.Types.ObjectId, ref: 'Media' }, // 用户头像
    birthday: { type: String }, // 生日
    address: { type: String }, // 住址
    phoneList: { type: String }, // 预备电话列表

    license: { type: Schema.Types.ObjectId, ref: 'Media' }, // 驾驶证图片
    licenseNo: { type: String }, // 驾驶证号
    insuranceEndTime: { type: Date }, // 保险到期时间

    registerTime: { type: Date, default: Date.now }, //注册时间
});
schema.plugin(passportLocalMongoose, { usernameField: 'phone' });

schema.virtual('age').get(function () {
    return this.birthday && Math.floor(moment().diff(moment(this.birthday)) / 31536000000);
});

virtualObjectById(schema);

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'registerTime');
        formatMedia(ret, 'head');
        formatObjectById(ret);
        formatPhoneList(ret);
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Driver', schema);

```

* PDShopServer/project/App/models/FeedbackModel.js

```js
import mongoose from 'mongoose';
import { formatTime, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    clientId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 客户Id
    shopMemberId: { type: Schema.Types.ObjectId, ref: 'ShopMember' }, // 商户Id
    driverId: { type: Schema.Types.ObjectId, ref: 'Driver' }, // 司机Id
    content: { type: String, required: true }, // 反馈内容
    email: { type: String }, // 联系邮箱
    state: { type: Number, default: 0 }, // 申请发卡的状态， 0：未处理，1：处理中，2：已处理
    submitTime: { type: Date, default: Date.now }, // 反馈时间
    acceptTime: { type: Date }, // 接收时间
    finishTime: { type: Date }, //处理时间
});

virtualObjectById(schema);

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'submitTime', 'acceptTime', 'finishTime');
        formatObjectById(ret);
        ret.state >= 1 || (ret.acceptTime = undefined);
        ret.state === 2 || (ret.finishTime = undefined);
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Feedback', schema);

```

* PDShopServer/project/App/models/LogModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;

const schema = new Schema({
    operator: { id: { type: String }, model: { type: String } }, // 操作人
    target: { id: { type: String }, model: { type: String } }, // 操作对象
    targetList: [{ id: { type: String }, model: { type: String } }], // 操作对象
    action: { type: String }, // 行为
    remark: { type: String }, // 备注
    createTime: { type: Date, default: Date.now }, //创建时间
});

export default mongoose.model('Log', schema);

```

* PDShopServer/project/App/models/MediaModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import _ from 'lodash';

const schema = new Schema({
    ref: { type: Number, default: 0 }, // 文件引用次数，初次上传的时候，ref为1，当文件被使用一次，ref+1, 被弃用一次，ref-1，当ref为0的时候删除文件和记录
    type: { type: Number, default: 0 }, // 文件类型，0：图片，1，音频，2，视频
    gridId: { type: Schema.Types.ObjectId }, //在gridfs中的id
});

schema.statics._updateRef = function (...params) {
    let obj = _.mergeWith(...params, (x, y) => (x || 0) + (y || 0));
    _.map(obj, (value, key) => {
        if (key !== 'undefined' && value !== 0) {
            this.findByIdAndUpdate(key, { $inc: { ref: value } }).exec();
        }
    });
};

export default mongoose.model('Media', schema);

```

* PDShopServer/project/App/models/NotifyModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { formatTime, virtualObjectById, formatObjectById } from '../utils';

const schema = new Schema({
    adminId: { type: Schema.Types.ObjectId, ref: 'Admin' }, // 发布通知的后台管理员Id
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 物流超市的Id
    memberId: { type: Schema.Types.ObjectId, ref: 'ShopMember' }, // 具体发通知的人的Id
    shipperId: { type: Schema.Types.ObjectId, ref: 'Shipper' }, // 发布通知的物流公司
    type: { type: String, default: 'news' }, // 通知类型  news, publicity, policy, notice
    source: { type: String, required: true }, // 通知来源
    title: { type: String, required: true }, // 通知标题
    content: { type: String, required: true }, // 通知内容
    time: { type: Date, default: Date.now }, //发布时间
});

virtualObjectById(schema);

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'time');
        formatObjectById(ret);
        delete ret.adminId;
        delete ret.type;
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Notify', schema);

```

* PDShopServer/project/App/models/OrderGroupModel.js

```js
import mongoose from 'mongoose';
import { formatTime, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    name: { type: String }, // 名称
    senderId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 发货的客户 Id (如果是物流公司，就是物流公司的负责人，如果是收货点，就是收货点的负责人)
    // 始发地
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 这个货单隶属于哪家分店（预下单的情况下为指定的某家分店）
    agentId: { type: Schema.Types.ObjectId, ref: 'Agent' }, // 这个货单隶属于哪家收货点预下单的情况下为指定的某家收货点）
    startPoint: { type: String }, // 省市（只对预下单有用，如果有 shopId 或 agentId 时，该字段无效）
    startPointLastCode: { type: Number }, // 始发地的lastCode

    // 货单列表
    orderIdList: [{ type: Schema.Types.ObjectId, ref: 'Order' }], // 货单列表
    orderCount: { type: Number, default: 0 }, // 货单的单数
    totalNumbers: { type: Number, default: 0 }, // 总的货物的件数
    totalWeight: { type: Number, default: 0 }, // 重量
    totalSize: { type: Number, default: 0 }, // 方量

    createTime: { type: Date, default: Date.now }, // 下单时间
    modifyTime: { type: Date }, // 修改时间
});

virtualObjectById(schema, 'shopId', 'agentId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'modifyTime');
        formatObjectById(ret, 'shopId', 'agentId');
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('OrderGroup', schema);

```

* PDShopServer/project/App/models/OrderModel.js

```js
import mongoose from 'mongoose';
import { _T, formatTime, formatMedia, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    isTransferOrder: { type: Boolean, default: false }, // 是否是中转单
    preOrderId: { type: Schema.Types.ObjectId, ref: 'Order' }, // 上一个货单的 Id
    nextOrderId: { type: Schema.Types.ObjectId, ref: 'Order' }, // 下一个货单的 Id

    groupId: { type: Schema.Types.ObjectId, ref: 'OrderGroup' }, // 批次的 Id

    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 这个货单隶属于哪家分店（预下单的情况下为指定的某家分店）
    agentId: { type: Schema.Types.ObjectId, ref: 'Agent' }, // 这个货单隶属于哪家收货点预下单的情况下为指定的某家收货点）

    senderId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 发货的客户 Id (如果是物流公司，就是物流公司的负责人，如果是收货点，就是收货点的负责人)
    senderName: { type: String }, // 货单使用的发货人姓名
    senderPhone: { type: String }, // 货单使用的发货人姓名
    isSenderRepresentShipper: { type: Boolean, default: false }, // 发货人是否代表一家物流公司，如果是，需要更新物流公司的账目
    receiverId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 发货的客户 Id
    receiverName: { type: String }, // 货单使用的收货人姓名
    receiverPhone: { type: String }, // 货单使用的收货人姓名
    name: { type: String }, // 货物名称
    photo: { type: Schema.Types.ObjectId, ref: 'Media' }, // 货物拍照
    startPoint: { type: String }, // 始发地省市县
    startPointLastCode: { type: Number, default: 0 },  // 始发地的lastCode（只对预下单有用，如果有 shopId 或 agentId 时，该字段无效）

    isCityDistribute: { type: Boolean, default: false }, // 是否是同城配送
    endPoint: { type: String }, // 长途终点，精确到镇
    endPointLastCode: { type: Number, default: 0 },  // 送货上门终点的lastCode

    isSendDoor: { type: Boolean, default: false }, // 是否送货上门
    sendDoorEndPoint: { type: String }, // 送货上门终点，精确到镇
    sendDoorEndPointLastCode: { type: Number, default: 0 },  // 送货上门终点的lastCode

    isClientPick: { type: Boolean, default: false }, // 是否上门自提

    roadmapId: { type: Schema.Types.ObjectId, ref: 'Roadmap' }, // 线路 Id
    roadmapRankIndex: { type: Number, default: -1 }, // 该货单选择的路线在选择时的排序名次，交易成功后，需要根据这个名次修改 RoadmapMaskModel 的数据
    shipperId: { type: Schema.Types.ObjectId, ref: 'Shipper' }, // 物流公司 Id
    needBondAmount: { type: Number, default: 0 }, // 需要担保的金额
    shipperChairManId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 物流公司董事长Id
    truckId: { type: Schema.Types.ObjectId, ref: 'Truck' }, // 货车 Id

    // 路线的价格信息
    price: { type: Number, default: 0 }, // 成交的价格
    minFee: { type: Number, default: 0 }, // 成交的底价
    sendDoorPrice: { type: Number, default: 0 }, // 成交的送货上门价格
    sendDoorMinFee: { type: Number, default: 0 }, // 成交的送货上门底价

    receivePartmentId: { type: Schema.Types.ObjectId, ref: 'ShopPartment' }, // 收货的部门
    receiveMemberId: { type: Schema.Types.ObjectId, ref: 'ShopMember' }, // 具体收货制单的人员的Id
    receiveAgentMemberId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 具体收货制单的收货点人员的Id
    placeOrderTime: { type: Date }, // 下单时间
    warehouse: { type: String }, // 仓库（一家物流公司可能有多个仓库，都显示出来，用分号分开，拉过去由库管决定, 如果没有找到仓库，则显示该物流公司名称）
    storeScannerId: { type: Schema.Types.ObjectId, ref: 'ShopMember' }, // 入库扫描的库管员 Id
    shipperStoreScannerId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 入库扫描的物流公司员工 Id
    placeStoreTime: { type: Date }, // 入库时间
    loadScannerId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 上车扫描的物流公司员工 Id (同城配送的物流公司为同城配送的司机)
    loadScanTime: { type: Date }, // 装车时间
    confirmHandOverId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 确认交货的流公司员工 Id（只有长途运输公司）

    // 必须由称货员填写的信息
    totalNumbers: { type: Number, default: 0 }, // 总的货物的件数（具体的数量以这个数量为准）
    weight: { type: Number, default: 0 }, // 重量
    size: { type: Number, default: 0 }, // 方量

    // 保险
    isInsuance: { type: Boolean, default: false }, // 是否保价 [初始货单]，如果保价，保价个度为运费的setting.insuanceMountRate倍
    insuanceMount: { type: Number, default: 0 }, // 担保保险额度（需要赔偿用户的钱）[初始货单]
    insuanceFee: { type: Number, default: 0 }, // 担保保险的费用（客户实际付的钱）(必须现付)[初始货单]

    /*
     * 如果是到付，当创建中转货单时，还不知道需要多少运费，不能填写指定收款，当选定路线确定价格后，指定收款 = 总运费 - 屏幕呈现价格 fee（物流公司价格+分店提成+总店提成）
     * 验证方式： fee + masterProfit + branchProfit 为呈现给用户的价格
     * designatedFee = totalFee - 下一家物流公司的屏幕报价(下一家物流公司的实际报价+分店提成+总店提成)
     */
    // 付款方式
    isReachPay: { type: Boolean, default: false }, // 是否是到付
    payMode: { type: Number, default: 0 }, // 支付方式 0：现付（PM_IMMEDIATE），1：到付（PM_REACH），2：混合支付（PM_MIXED 指定收款的部分到付，其余的现付）
    payTool: { type: Number, default: 0 }, // 现付的情况下的支付工具 0：现金支付（PT_CASH），1：支付宝（PT_ALIPAY），2：微信（PT_WEIXIN），3：银行卡（PT_BANK）

    fee: { type: Number, default: 0 }, // 运输价格（物流公司实际价格，没有经过加价）（自动计算）
    // 提成金额
    profit: { type: Number, default: 0 }, // 总的提成
    masterProfit: { type: Number, default: 0 }, // 总部的提成
    branchProfit: { type: Number, default: 0 }, // 分部的提成
    realFee: { type: Number, default: 0 }, // 屏幕显示价格 fee+masterProfit+branchProfit

    totalDesignatedFee: { type: Number, default: 0 }, // 全程总的指定收款(只有payMode为到付的情况下有效，实际为到付时向收货人收的运费)
    designatedFee: { type: Number, default: 0 }, // 指定收款 (只有payMode为到付的情况下，才可能有指定收款)

    // 代收货款
    proxyCharge: { type: Number, default: 0 }, // 代收货款金额
    proxyChargeProfit: { type: Number, default: 0 }, // 代收货款手续费（交易成功后，从代收货款的金额中扣除，只给总部）[初始货单]

    // 该货单需要现付的项目
    needPayTransportFee: { type: Number, default: 0 }, // 需要现场付的运费
    needPayInsuanceFee: { type: Number, default: 0 }, // 需要现场付的保险

    // 附加费用 (上门自提需要送的这种货的收货人谈定的价格)
    additionalFee: { type: Number, default: 0 }, // 附加费用

    /* 状态：
    * 货主把货拉倒分店收货部，收货部对其点数，称重，量方量后填单，然后调用 < placeOriginOrder > 成功后为待选线路状态
    * 0：待选线路（安装所填的数据，给货主显示路线排名，让货主选择一条路线，付款方式，是否交保险，是否代收货款，是否送货上门，选择后显示运费和其他费用的列表和总的费用，点击确认按钮，调用接口 < confirmSelectRoadmap >后，如果是需要付钱的进入待付款状态，否则进入待入库状态）。
    * 1：待付款状态（1.货主在手机上刷新，使用支付宝等付款，成功后告知收货员，收货员刷新货单，显示收款成功，2.货主将现金给收货员，收货员点击代付款按钮，付款成功后，显示收款成功；之后进入待入库状态）
    * 2：待入库（指收款成功后搬运人员将货物运到库管处的状态，交给库管成功后，状态进入待装车状态）
    * 3：待装车（货物送到库管处，每收5吨货就通知物流公司，物流公司自己看有一车的时候会生成一个货车实例<包括司机和货车信息>到检查部审核，审核成功后，将车开到库管处，物流公司会通过竞价联系搬运部，搬运部搬运货物上车，物流公司需要一件一件的扫描，装车完成，需要给库管确认，库管确认之后，进入待出发状态）
    * 4：待出发 （物流公司将车开到门卫处，门卫扫描驾驶员的二维码，点击放行按钮，进入运输中状态）
    * 5：运输中 （运输过程中，驾驶员需要开启app，自动上传位置信息）
    * 6：交货成功 （司机将货物送到目的地之后，会劝说收货人安装app或者扫描小程序，然后让他扫描货物，确认收货的件数，完成交接）
    * 不能包含相同的状态
    */
    stateList: [ { state: Number, count: Number } ],
    deductError: { type: Boolean }, // 扣款失败（该字段只针对 state 为 OS_READY_DEDUCT_AND_PRINT_ORDER 和 OS_READY_PAYMENT 的货单有效）

    createTime: { type: Date, default: Date.now }, // 创建时间
    modifyTime: { type: Date }, // 修改时间

    remark: { type: String }, //备注
});

virtualObjectById(schema, 'senderId', 'receiverId', 'shopId', 'agentId', 'roadmapId', 'shipperId', 'receiveMemberId', 'receiveAgentMemberId');

schema.statics.getOrderFromOriginOrder = async function (targetId, orderId, type = 0) { // type值， 0：分店，1：物流公司，2：发货人，3：收货人
    while (orderId) {
        const order = await this.findById(orderId);
        if (!order) {
            return undefined;
        }
        if (type === 0 && _T(order.shopId) === _T(targetId)) {
            return order;
        } else if (type === 1 && _T(order.shipperId) === _T(targetId)) {
            return order;
        } else if (type === 2 && _T(order.senderId) === _T(targetId)) {
            return order;
        } else if (type === 3 && _T(order.receiverId) === _T(targetId)) {
            return order;
        }
        orderId = order.nextOrderId;
    }
    return undefined;
};
schema.statics.getOrderIdListFromNode = async function (order, includeSelf) {
    const orderIdList = includeSelf ? [order.id] : [];
    while (order.preOrderId) {
        order = await this.findById(order.preOrderId);
        order && orderIdList.unshift(order.id);
    }
    return orderIdList;
};
schema.statics.getLatestOrderFromOriginOrder = async function (orderId) {
    let order = await this.findById(orderId);
    while (order && order.nextOrderId) {
        order = await this.findById(order.nextOrderId);
    }
    return order;
};
schema.statics.getOriginOrderFromNode = async function (orderId) {
    let order = await this.findById(orderId);
    while (order && order.preOrderId) {
        order = await this.findById(order.preOrderId);
    }
    return order;
};

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatMedia(ret, 'photo');
        formatTime(ret, 'createTime', 'modifyTime', 'placeOrderTime', 'placeStoreTime', 'loadScanTime');
        formatObjectById(ret, 'senderId', 'receiverId', 'shopId', 'agentId', 'roadmapId', 'shipperId', 'receiveMemberId', 'receiveAgentMemberId');
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Order', schema);

```

* PDShopServer/project/App/models/PaymentModel.js

```js
import mongoose from 'mongoose';
import passportLocalMongoose from 'passport-local-mongoose';
import { virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    userId: { type: String }, // 对应的用户和店员的Id
    modifyTime: { type: Date, default: Date.now }, // 修改时间
});

schema.plugin(passportLocalMongoose, { usernameField: 'userId' });

virtualObjectById(schema);

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatObjectById(ret);
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Payment', schema);

```

* PDShopServer/project/App/models/RoadmapAddressModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;

const schema = new Schema({
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属分店 Id

    code: { type: Number }, // 地址code
    parentCode: { type: Number }, // 父级地址code
    name: { type: String }, // 名称
    level: { type: Number }, // 级别
});

schema.virtual('isLeaf').get(function () {
    return (
        this.level === 0 ||
        this.level === 4 ||
        this.level === 5 ||
        this.level === 6 ||
        this.level === 7 ||
        this.level === 10
    );
});

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        delete ret.__v;
        delete ret._id;
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('RoadmapAddress', schema);

```

* PDShopServer/project/App/models/RoadmapMaskModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { setting } from '../manager';
import _ from 'lodash';
/*
* 屏蔽规则：
* 开始屏蔽时，获取该路线的statusList中上次收货时间最小的一个，如果该名次的收货量小于最大收货量，则屏蔽该名次之前的名次的路线；否则查找收货时间第二小的名次，如果该名次的收货量小于最大收货量，则屏蔽该名次之前的名次的路线；否则继续查找，如果都没有查找到。调整 receivedWeight 为 receivedWeight-maxWeight，重复以上动作。
* 如果
*/
const schema = new Schema({
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属分店的Id
    endPointLastCode: { type: Number }, // 终点（精确到镇级别），判断只有终点相同的为同意路线 (如果endPointLastCode为0，则代表上门自提的过滤)
    statusList: [{
        receivedWeight: Number, // 序号名次的已经收到的货物重量，单位（吨）
        maxWeight: Number, // 最大可以收货的量
        lastReceivedTime: Date, //序号名次的上次收货的时间
    }],
});

// maxCount 为总的路线条数，如果总路线的数量小于rankedMaskRateList的长度，取 maxCount
schema.statics.getMaskNumber = async function (shopId, endPointLastCode, maxCount) {
    const doc = await this.findOne({ shopId, endPointLastCode });
    let statusList = doc ? doc.statusList : [];
    const rankLength = Math.min(setting.rankedMaskRateList.length, maxCount);

    if (!rankLength) {
        return 0;
    }
    if (statusList.length < rankLength) {
        return statusList.length;
    }
    if (statusList.length > rankLength) {
        statusList = statusList.slice(0, rankLength);
    }
    const list = _.orderBy(_.map(_.cloneDeep(statusList), (m, i) => { m.index = i; return m; }), o => o.lastReceivedTime);
    const listItem = _.find(list, o => o.receivedWeight < o.maxWeight);
    if (listItem) {
        return listItem.index;
    }
    for (const item of doc.statusList) {
        item.receivedWeight -= item.maxWeight;
    }
    await doc.save();

    return list[0].index;
};

schema.statics.updateStatusList = async function (shopId, endPointLastCode, index, weight) {
    if (index >= setting.rankedMaskRateList.length) {
        return;
    }
    let doc = await this.findOne({ shopId, endPointLastCode });
    if (!doc) {
        const statusList = [];
        const maxWeight = (setting.rankedMaskFirstRankWeight * setting.rankedMaskRateList[index]) || 0;
        statusList[index] = { receivedWeight: weight, maxWeight, lastReceivedTime: Date.now() };
        for (let i = 0; i < index; i++) { // 防止数组为空
            !statusList[i] && (statusList[i] = {
                receivedWeight: 0,
                maxWeight: (setting.rankedMaskFirstRankWeight * setting.rankedMaskRateList[i]) || 0,
                lastReceivedTime: 0,
            });
        }
        doc = new this({ shopId, endPointLastCode, statusList });
    } else {
        const item = doc.statusList[index];
        if (!item) {
            const maxWeight = (setting.rankedMaskFirstRankWeight * setting.rankedMaskRateList[index]) || 0;
            doc.statusList[index] = { receivedWeight: weight, maxWeight, lastReceivedTime: Date.now() };
            for (let i = 0; i < index; i++) { // 防止数组为空
                !doc.statusList[i] && (doc.statusList[i] = {
                    receivedWeight: 0,
                    maxWeight: (setting.rankedMaskFirstRankWeight * setting.rankedMaskRateList[i]) || 0,
                    lastReceivedTime: 0,
                });
            }
        } else {
            item.receivedWeight += weight;
            item.lastReceivedTime = Date.now();
        }
    }
    await doc.save();
};

export default mongoose.model('RoadmapMask', schema);

```

* PDShopServer/project/App/models/RoadmapModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { formatTime, getFormatTime, virtualObjectById, formatObjectById } from '../utils';

const schema = new Schema({
    // 基础信息
    shipperId: { type: Schema.Types.ObjectId, ref: 'Shipper' }, // 物流公司 Id
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属分店 Id
    shipperInBranchShopId: { type: Schema.Types.ObjectId, ref: 'ShipperInBranchShop' }, // 所属入驻分店模型分店 Id

    profitRate: { type: Number }, // 对路线的提成 = 方向.profitRate < 路线.profitRate

    sendDoorEnable: { type: Boolean, default: false }, // 送货上门是否全部设置（内部使用）
    enable: { type: Boolean, default: false }, // 是否可用
    endPoint: { type: String }, // 终点（精确到镇级别）
    endPointLastCode: { type: Number },  // 终点的最后一个code

    price: { type: Number, default: 0 }, // 每吨的价格，单位为元/吨 (差价必须为整数，相同的路线不能设置和别人相同的价格)
    basePrice: { type: Number, default: 0 }, // 价格保底价（为0的时候无效）
    updatePriceTime: { type: Date, default: Date.now }, // 修改价格的时间，如果价格相同，使用updateXXTime排序，谁先修改谁排前面
    minFee: { type: Number, default: 0 }, // 起步价，在按照重量来计算不足起步价的情况下按照起步价计算。
    baseMinFee: { type: Number, default: 0 }, // 起步价保底价（为0的时候无效）
    updateMinFeeTime: { type: Date, default: Date.now }, // 修改起步价的时间

    isCityDistribute: { type: Boolean, default: false }, // 是否是同城配送的路线（如果为false，表示长途路线，需要配置 sendDoorList， 否则不需要配置）
    sendDoorList: [{ // 送货上门的列表
        enable: { type: Boolean }, // 该同城配送是否可用
        sendDoorEndPoint: { type: String },  // 送货上门的终点
        sendDoorEndPointLastCode: { type: Number },  // 送货上门的终点的最后一个code
        sendDoorPrice: { type: Number }, // 送货上门价格（元/吨）
        baseSendDoorPrice: { type: Number }, // 送货上门价格保底价
        updateSendDoorPriceTime: { type: Date }, // 修改送货上门价格的时间
        sendDoorMinFee: { type: Number }, // 送货上门起步价，在按照重量来计算不足起步价的情况下按照起步价计算。
        baseSendDoorMinFee: { type: Number }, // 送货上门起步价保底价
        updateSendDoorMinFeeTime: { type: Date }, // 修改送货上门起步价的时间
    }],

    // 时长信息
    duration: { type: Number, default: 0 }, // 经历时长(h)(通过统计获得)
    selfSignRate: { type: Number, default: 0 }, // 收货人亲自签收率

    // 统计信息
    tradeTimes: { type: Number, default: 0 }, // 交易次数
    monthTradeTimes: { type: Number, default: 0 }, // 月交易次数

    remark: { type: String }, // 备注 (添加一些特殊说明)

    createTime: { type: Date, default: Date.now }, // 创建时间
    modifyTime: { type: Date }, // 修改时间
    setProfitRateTime: { type: Date }, //总部对路线设置提成的时间
});

schema.virtual('startPoint').get(function () {
    return this.shop ? this.shop.name : undefined;
});

virtualObjectById(schema, 'shipperId', 'shopId', 'shipperInBranchShopId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'modifyTime', 'setProfitRateTime', 'updatePriceTime', 'updateMinFeeTime');
        formatObjectById(ret, 'shipperId', 'shopId', 'shipperInBranchShopId');
        ret.sendDoorList && (ret.sendDoorList = ret.sendDoorList.map(item => {
            item.updateSendDoorPriceTime = getFormatTime(item.updateSendDoorPriceTime);
            item.updateSendDoorMinFeeTime = getFormatTime(item.updateSendDoorMinFeeTime);
            return item;
        }));

        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Roadmap', schema);

```

* PDShopServer/project/App/models/RoadmapRegionProfitRateModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { formatTime, virtualObjectById, formatObjectById } from '../utils';

const schema = new Schema({
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属分店 Id， 如果为空，则为所有的分店
    region: { type: String, default: '' }, // 方向，如：北京（必须使用地图选择）
    regionLastCode: { type: Number, default: 0 },  // 方向的最后一个code
    profitRate: { type: Number, default: 0 }, // 对路线的提成 = 方向.profitRate < 路线.profitRate

    type: { type: Number, default: 0 }, // 类型，0：所有，1：长途，2：短途

    level: { type: Number, default: 0 },  // 内部使用，用来排序
    createTime: { type: Date, default: Date.now }, // 创建时间
    modifyTime: { type: Date }, //修改时间
});

virtualObjectById(schema, 'shopId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'modifyTime');
        formatObjectById(ret, 'shopId');

        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('RoadmapRegionProfitRate', schema);

```

* PDShopServer/project/App/models/SettingModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { formatObjectById } from '../utils';

const schema = new Schema({
    sizeWeightRate: { type: Number, default: 3 }, // 方量和重量的计算比
    insuanceRate: { type: Number, default: 0.002 }, // 担保保险的费用（客户实际付的钱）= 担保保险额度（需要赔偿用户的钱）* insuanceRate
    insuanceMountRate: { type: Number, default: 5 }, // 保额相对于运费的多少倍，默认为10
    insuanceBaseValue: { type: Number, default: 10 }, // 保险的最低值（默认为最低10元）
    proxyChargeProfitRate: { type: Number, default: 0.01 }, // 手续费 = 代收货款 * proxyChargeProfitRate
    // 设置min必须从0开始，默认： [ {rate: 1.1, min: 0}, {rate: 1, min: 10}, {rate: 0.9, min: 20 } ] 如果物流公司设置的是100元/吨，表示0-10为110元/吨，10-20为100元/吨，20以上为90元/吨
    gradientPriceList: [ { rate: Number, min: Number } ], // 每吨的价格，单位为元/吨（采用阶梯价格）
    additionalDeliverTime: { type: Number, default: 240 }, // 物流公司没有让货主确认附加的交易成功时间，单位小时(h)
    noticeShipperStorageWeight: { type: Number, default: 5 }, // 没多少吨货物放置后通知物流公司
    bondAmountWeightRate: { type: Number, default: 10000 }, // 每吨货需要的保证金
    rankedMaskFirstRankWeight: { type: Number, default: 5 }, // 用来判断排名第一的物流公司的收购多少吨货被屏蔽的依据
    rankedMaskRateList: [{ type: Number }], //为了防止物流公司垄断，排在前3（数组的长度+1）名的需要轮流收货，第一名收货的量为rankedMaskFirstRankWeight*1，第二名为rankedMaskFirstRankWeight*0.8，第三名为rankedMaskFirstRankWeight*0.6。默认： [ 1, 0.8, 0.6 ]，屏蔽规则：见 RoadmapMaskModel
});

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        delete ret.id;
        formatObjectById(ret);
        ret.gradientPriceList && (ret.gradientPriceList = ret.gradientPriceList.map(item => {
            delete item._id;
            return item;
        }));
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Setting', schema);

```

* PDShopServer/project/App/models/ShipperInBranchShopModel.js

```js
import mongoose from 'mongoose';
import { formatTime, formatMedia, getMediaPath, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    shipperId: { type: Schema.Types.ObjectId, ref: 'Shipper' }, // 物流公司
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属分店

    // 担保公司
    bondCompanyList: [{ // 担保公司列表
        capital: { type: Number }, // 担保公司注册资金
        bondAmount: { type: Number }, // 担保金额
        name: { type: String }, // 担保公司名称
        address: { type: String }, // 担保公司地址
        phoneList: { type: String }, // 担保公司电话
        legalName: { type: String }, // 法人姓名
        legalPhone: { type: String }, // 法人电话
        certificate: [{ type: Schema.Types.ObjectId, ref: 'Media' }], // 担保公司资格证书
        legalIDCard: [{ type: Schema.Types.ObjectId, ref: 'Media' }], //法人身份证
    }],
    totalBondAmount: { type: Number, default: 0 }, // 总的担保金额
    remainBondAmount: { type: Number, default: 0 }, // 剩余可用的担保金额
    usedBondAmount: { type: Number, default: 0 }, // 已使用的担保金额

    // 上门自提的信息
    clientPickPrice: { type: Number }, // 自提价格 (只有 shipperType === 1 的物流公司需要设置)
    clientPickEnable: { type: Boolean, default: false }, // 是否可用 (默认为不可用，只有物流公司设置了价格后才生效)

    registerTime: { type: Date, default: Date.now }, //注册时间
});

virtualObjectById(schema, 'shopId', 'shipperId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'registerTime');
        formatMedia(ret, 'head');
        formatObjectById(ret, 'shopId', 'shipperId');
        ret.bondCompanyList && (ret.bondCompanyList = ret.bondCompanyList.map(item => {
            item.certificate = item.certificate.map(o => getMediaPath(o));
            item.legalIDCard = item.legalIDCard.map(o => getMediaPath(o));
            delete item._id;
            return item;
        }));
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('ShipperInBranchShop', schema);

```

* PDShopServer/project/App/models/ShipperModel.js

```js
import mongoose from 'mongoose';
import { formatMedia, formatTime, getMediaPath, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    chairManId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 董事长(法人)
    // 基础信息
    name: { type: String }, // 物流公司名称
    image: { type: String }, // 物流公司背景图片
    sign: { type: String }, // 物流公司签名
    address: { type: String }, // 商铺地址
    phoneList: { type: String }, // 物流公司电话列表

    capital: { type: Number, default: 0 }, // 注册资金
    acountAmount: { type: Number, default: 0 }, // 账户金额

    legalName: { type: String }, // 法人姓名
    legalPhone: { type: String }, // 法人电话
    legalIDCard: [{ type: Schema.Types.ObjectId, ref: 'Media' }], // 法人身份证

    // 物流公司类型
    shipperType: { type: Number, default: 0 }, // 0：长途物流公司 1：同城配送物流公司（默认为0）

    createTime: { type: Date, default: Date.now }, //创建时间
});

virtualObjectById(schema, 'chairManId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        ret.name = ret.name || ret.phone;
        formatMedia(ret, 'image');
        formatTime(ret, 'createTime');
        formatObjectById(ret, 'chairManId');
        ret.legalIDCard && (ret.legalIDCard = ret.legalIDCard.map(o => getMediaPath(o)));
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Shipper', schema);

```

* PDShopServer/project/App/models/ShopMemberModel.js

```js
import mongoose from 'mongoose';
import passportLocalMongoose from 'passport-local-mongoose';
import { formatTime, formatMedia, formatPhoneList, getAgeFromBirthday, virtualObjectById, formatObjectById } from '../utils';
import CONSTANTS from '../constants';
const Schema = mongoose.Schema;

const schema = new Schema({
    phone: { type: String, required: true, unique: true }, // 注册电话
    name: { type: String }, // 姓名
    head: { type: Schema.Types.ObjectId, ref: 'Media' }, // 用户头像
    sex: { type: Number, default: 0 }, // 性别 0:男   1:女
    birthday: { type: String }, // 生日
    address: { type: String }, // 住址
    email: { type: String }, // 邮箱
    salary: { type: Number, default: 0 }, // 工资
    post: { type: String, derault: CONSTANTS.PO_STAFF }, // 职位， 默认普通员工
    phoneList: { type: String }, // 预备电话列表

    isSetPaymentPassword: { type: Number, default: 0 }, // 性别 0:没设置   1:已设置

    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属店铺
    partmentId: { type: Schema.Types.ObjectId, ref: 'ShopPartment' }, // 所属部门 (这个部门指的是分店的专属部门)
    authority: [ { type: Number } ], // 拥有的权限

    registerTime: { type: Date, default: Date.now }, //注册时间
});

schema.plugin(passportLocalMongoose, { usernameField: 'phone' });

schema.virtual('age').get(function () {
    return getAgeFromBirthday(this.birthday);
});

virtualObjectById(schema, 'shopId', 'partmentId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'registerTime');
        formatMedia(ret, 'head');
        formatObjectById(ret, 'shopId', 'partmentId');
        formatPhoneList(ret);
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('ShopMember', schema);

```

* PDShopServer/project/App/models/ShopModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { formatMedia, formatTime, virtualObjectById, formatObjectById } from '../utils';

const schema = new Schema({
    chairManId: { type: Schema.Types.ObjectId, ref: 'ShopMember' }, // 董事长(法人)
    // 基础信息
    name: { type: String }, // 物流超市名称
    image: { type: String }, // 物流超市背景图片
    sign: { type: String }, // 物流超市签名
    addressRegion: { type: String }, // 物流超市所在城市
    addressRegionLastCode: { type: Number }, // 物流超市所在城市的lastCode
    address: { type: String }, // 收货点地址
    location: { type: [ Number ], index: '2d' }, // 经纬度定位(必须使用地图来选择)
    phoneList: { type: String }, // 物流超市电话列表

    // 分类
    isMasterShop: { type: Boolean, default: false }, // 是否是主店

    // 提成信息
    profitRate: { type: Number, default: 0 }, // 该分店对路线的默认提成比例  分店的提成 = 总的提成 * profitRate，该参数由总部设置 (只对分店有效)

    createTime: { type: Date, default: Date.now }, //创建时间
});

virtualObjectById(schema, 'chairManId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        ret.name = ret.name || ret.phone;
        formatMedia(ret, 'image');
        formatTime(ret, 'createTime');
        formatObjectById(ret, 'chairManId');
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Shop', schema);

```

* PDShopServer/project/App/models/ShopPartmentModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;
import { formatTime, virtualObjectById, formatObjectById } from '../utils';

const schema = new Schema({
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属店铺
    chargeManId: { type: Schema.Types.ObjectId, ref: 'ShopMember' }, // 负责人

    name: { type: String }, // 部门名称
    type: { type: Number }, // 部门类型(见constants.partment)
    descript: { type: String }, // 部门描述
    phoneList: { type: String }, // 联系电话
    memberCount: { type: Number, default: 1 }, // 部门成员数量

    price: { type: Number }, // 价格 (如果为搬运部，为搬运每吨的价格，如果为货运部，为同城配送每吨的价格)
    enable: { type: Boolean, default: false }, // 是否可用 (默认为不可用，只有部门设置了价格后才生效)
    workTruckId: { type: Schema.Types.ObjectId, ref: 'Truck' }, // （搬运队再在上车的货车Id, 该字段只对搬运队有效）

    createTime: { type: Date, default: Date.now }, // 创建时间
    modifyTime: { type: Date }, //修改时间
});

virtualObjectById(schema, 'chargeManId', 'workTruckId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'modifyTime');
        formatObjectById(ret, 'chargeManId', 'workTruckId');
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('ShopPartment', schema);

```

* PDShopServer/project/App/models/StartPointAddressModel.js

```js
import mongoose from 'mongoose';
const Schema = mongoose.Schema;

const schema = new Schema({
    code: { type: Number }, // 地址code
    parentCode: { type: Number }, // 父级地址code
    name: { type: String }, // 名称
    level: { type: Number }, // 级别
});

const transform = {
    virtuals: false,
    transform: function (doc, ret, options) {
        delete ret.__v;
        delete ret._id;
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('StartPointAddress', schema);

```

* PDShopServer/project/App/models/TruckModel.js

```js
import mongoose from 'mongoose';
import { formatTime, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    shipperId: { type: Schema.Types.ObjectId, ref: 'Shipper' }, // 所属物流公司 Id
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属分店 Id（物流公司创建货车时需要制定为哪家分店）
    driverId: { type: Schema.Types.ObjectId, ref: 'Driver' }, // 对应的司机
    carryPartmentId: { type: Schema.Types.ObjectId, ref: 'ShopPartment' }, // 选择的搬运部
    scannerId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 扫描员的 Id

    carryPrice: { type: Number, default: 0 }, // 搬运价格

    plateNo: { type: String }, // 车牌号码
    drivingLicense: { type: String }, // 行驶证编号
    truckType: { type: String }, // 车型
    insuanceMount: { type: Number, default: 0 }, // 保险
    locationList: [ { address: String, longitude: Number, latitude: Number, time: Date } ], // 定位列表

    state: { type: Number, default: 0 }, // 申请发卡的状态， 0：待审核，1：待入库，2：待找搬运队，3：待扫描装车，4：装车中，5：待付搬运部的款，6：待出库，7：运输中，8：完成

    // 货单
    orderList: [ { type: Schema.Types.ObjectId, ref: 'Order' } ], // 货单列表
    orderCount: { type: Number, default: 0 }, // 总单数
    totalNumbers: { type: Number, default: 0 }, // 总件数
    totalWeight: { type: Number, default: 0 }, // 总重量
    totalSize: { type: Number, default: 0 }, // 总方量
    unloadAllOrderList: [ { type: Schema.Types.ObjectId, ref: 'Order' } ], // 只上了一部分货单列表

    createTime: { type: Date, default: Date.now }, // 创建时间
    modifyTime: { type: Date }, // 修改时间
});

virtualObjectById(schema, 'driverId', 'shopId', 'shipperId', 'carryPartmentId', 'scannerId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'modifyTime');
        formatObjectById(ret, 'driverId', 'shopId', 'shipperId', 'carryPartmentId', 'scannerId');
        ret.locationList && (ret.locationList = ret.locationList.map(item => { formatTime(item, 'time'); delete item._id; return item; }));
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Truck', schema);

```

* PDShopServer/project/App/models/VerifyCodeModel.js

```js
import mongoose from 'mongoose';
import { virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    phone: { type: String, required: true, unique: true }, // 注册电话
    codeList: [{ code: String, deadTime: Date }], //验证码的列表
});

virtualObjectById(schema);

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatObjectById(ret);
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('VerifyCode', schema);

```

* PDShopServer/project/App/models/VersionModel.js

```js
import mongoose from 'mongoose';
import { formatTime, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    platform: { type: String }, // platform类型， android, ios
    versionName: { type: String }, // 版本号
    versionCode: { type: String }, // 版本 code
    minVersion: { type: Number }, // 小版本号（js版本号）
    passed: [{ type: String }], // 通过审核的渠道，ios只有default(代表AppStore), android有default和其他渠道名
    description: [{ type: String }], // 版本描述
    time: { type: Date, default: Date.now }, //发布时间
});

schema.virtual('verName').get(function () {
    return this.versionName + '.' + this.minVersion;
});

virtualObjectById(schema);

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatObjectById(ret);
        formatTime('time');
        delete ret.platform;
        delete ret.versionName;
        delete ret.minVersion;
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Version', schema);

```

* PDShopServer/project/App/models/WarehouseModel.js

```js
import mongoose from 'mongoose';
import { formatTime, virtualObjectById, formatObjectById } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    shopId: { type: Schema.Types.ObjectId, ref: 'Shop' }, // 所属分店 Id（物流公司创建货车时需要制定为哪家分店）
    shipperList: [ { type: Schema.Types.ObjectId, ref: 'Shipper' } ], // 所属物流公司 Id

    // 基本信息
    houseManId: { type: Schema.Types.ObjectId, ref: 'ShopMember' }, // 对应的库管员
    houseNo: { type: String }, // 仓库编号
    maxStoreWeight: { type: Number, default: 0 }, // 可以容纳的总重量
    maxStoreSize: { type: Number, default: 0 }, // 可以容纳的总方量

    // 已经入库的信息
    orderCount: { type: Number, default: 0 }, // 已入库的总单数
    totalNumbers: { type: Number, default: 0 }, // 已入库的总件数
    totalWeight: { type: Number, default: 0 }, // 已入库的总重量
    totalSize: { type: Number, default: 0 }, // 已入库的总方量

    createTime: { type: Date, default: Date.now }, // 创建时间
    modifyTime: { type: Date }, // 修改时间
});

virtualObjectById(schema, 'houseManId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'modifyTime');
        formatObjectById(ret, 'houseManId');
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('Warehouse', schema);

```

* PDShopServer/project/App/models/WeixinPayModel.js

```js
import mongoose from 'mongoose';
import { virtualObjectById, formatObjectById, formatTime } from '../utils';
const Schema = mongoose.Schema;

const schema = new Schema({
    // 用户信息
    clientId: { type: Schema.Types.ObjectId, ref: 'Client' }, // 创建货单的人的 Id （用户端）
    shopMemberId: { type: Schema.Types.ObjectId, ref: 'ShopMember' }, // 创建货单的人的 Id （店面端）
    spbill_create_ip: { type: String }, // 支付的人的ip
    openid: { type: String }, // 支付的人的微信 openid

    // 金额信息
    body: { type: String }, // 商品描述
    trade_type: { type: String }, // 交易类型
    total_fee: { type: Number }, // 总金额

    // 回包信息
    prepay_id: { type: String }, // 预支付交易会话 Id
    appid: { type: String }, // App Id
    mch_id: { type: String }, // 商户 Id
    nonce_str: { type: String }, // 随机字符串
    package: { type: String }, // 扩展字段
    timestamp: { type: Number }, // 时间戳

    // 支付信息
    bank_type: { type: String }, // 付款银行
    cash_fee: { type: String }, // 现金支付金额
    transaction_id: { type: String }, // 微信支付货单号
    code_url: { type: String }, // 微信支付二维码（扫码支付）

    // 状态
    state: { type: Number, default: 0 }, // 未支付
    payedTime: { type: Date, default: Date.now }, // 支付完成时间，使用通知接口的 time_end 赋值
    createTime: { type: Date, default: Date.now }, //创建时间
});

schema.virtual('out_trade_no').get(function () {
    return this._id;
});
virtualObjectById(schema, 'clientId');

const transform = {
    virtuals: true,
    transform: function (doc, ret, options) {
        formatTime(ret, 'createTime', 'payedTime');
        formatObjectById(ret, 'clientId');
        delete ret.id;
        return ret;
    },
};
schema.options.toJSON = transform;
schema.options.toObject = transform;

export default mongoose.model('WeixinPay', schema);

```

* PDShopServer/project/App/models/index.js

```js
export AdminModel from './AdminModel';
export AgentModel from './AgentModel';
export ClientModel from './ClientModel';
export CollectionModel from './CollectionModel';
export CommentModel from './CommentModel';
export FeedbackModel from './FeedbackModel';
export MediaModel from './MediaModel';
export NotifyModel from './NotifyModel';
export OrderModel from './OrderModel';
export OrderGroupModel from './OrderGroupModel';
export RoadmapModel from './RoadmapModel';
export RoadmapMaskModel from './RoadmapMaskModel';
export RoadmapRegionProfitRateModel from './RoadmapRegionProfitRateModel';
export RoadmapAddressModel from './RoadmapAddressModel';
export ShipperModel from './ShipperModel';
export ShipperInBranchShopModel from './ShipperInBranchShopModel';
export ShopModel from './ShopModel';
export ShopMemberModel from './ShopMemberModel';
export ShopPartmentModel from './ShopPartmentModel';
export TruckModel from './TruckModel';
export CityTruckModel from './CityTruckModel';
export VersionModel from './VersionModel';
export SettingModel from './SettingModel';
export StartPointAddressModel from './StartPointAddressModel';
export LogModel from './LogModel';
export AgentRegionProfitModel from './AgentRegionProfitModel';
export DriverModel from './DriverModel';
export PaymentModel from './PaymentModel';
export VerifyCodeModel from './VerifyCodeModel';
export WeixinPayModel from './WeixinPayModel';
export WarehouseModel from './WarehouseModel';

```

* PDShopServer/project/App/manager/index.js

```js
import _settingMgr from './settingMgr';

export const settingMgr = _settingMgr;

export const setting = _settingMgr.value;

export function init () {
    return Promise.all([
        _settingMgr.init(),
    ]);
}

```

* PDShopServer/project/App/manager/settingMgr.js

```js
import { SettingModel } from '../models';
import { _N } from '../utils';
import _ from 'lodash';

class Manager {
    constructor () {
        this.value = {};
    }
    init () {
        return new Promise(async resolve => {
            const data = await SettingModel.findOne();
            Object.assign(this.value, data ? data.toObject() : null);
            return resolve();
        });
    }
    set (data) {
        Object.assign(this.value, data.toObject());
    }
    getRealWeight (weight, size) {
        return _N(Math.max(weight, size / this.value.sizeWeightRate));
    }
    getFloatWeight (weight, size) {
        weight = this.getRealWeight(weight, size);
        return _.findLast(this.value.gradientPriceList, o => o.min <= weight).rate * weight;
    }
    getBondAmount (weight, size) {
        weight = this.getRealWeight(weight, size);
        return this.value.bondAmountWeightRate * weight;
    }
}

module.exports = new Manager();

```

* PDShopServer/project/App/mysql/AccountModel.js

```js
import Sequelize from 'sequelize';
import sequelize from './sequelize';
import CONSTANTS from '../constants';
import { _Y } from '../utils';

const model = sequelize.define('Account', {
    targetId: { type: Sequelize.STRING(24) }, // mongodb中的对应的 分店的Id，分店的部门的Id，客户的Id
    amount: { type: Sequelize.BIGINT, defaultValue: 0 }, // 账户总额，单位(分)
    type: Sequelize.INTEGER, //账户类型，AT_BASIC：总部, AT_BRANCH_SHOP： 分店， AT_BRANCH_SHOP_PARTMENT： 分店的部门， AT_CLIENT：客户账号 (详情见constans/account)
}, {
    getterMethods: {
        amountYuan: function () { return _Y(this.amount); },
    },
    timestamps: false,
    initialAutoIncrement: CONSTANTS.AC_BANK_ACCOUNT, //10000为总部账号
});

export default model;

```

* PDShopServer/project/App/mysql/BillModel.js

```js
import Sequelize from 'sequelize';
import sequelize from './sequelize';
import { _Y, getFormatTime } from '../utils';

// 如果 thirdpartyAccount 不为空， 说明是充值和提现的账单，否则是内部账单，内部账单必须针对于某个货单 orderId
const model = sequelize.define('Bill', {
    account: Sequelize.INTEGER, // 对应的账户Id
    tradeAmount: Sequelize.BIGINT, // 交易金额 (单位分) (大于0表示进账，小于0表示出账)
    thirdpartyAccount: Sequelize.STRING, // 第三方的货单号  0：支付宝(A)， 1：财付通(C)，2：工商银行(G)，3：建设银行(J)， 4：中国银行（Z）， 5：农业银行(N)，规则：缩写字母#第三方的货单号#第三方账号
    orderId: Sequelize.STRING(24), // 交易对应的货单号
    truckId: Sequelize.STRING(24), // 交易对应的货车号
    remark: Sequelize.STRING, // 备注
    tradeTime: { // 注册时间
        type: Sequelize.DATE,
        defaultValue: Sequelize.NOW,
        get () {
            return getFormatTime(this.getDataValue('tradeTime'));
        },
    },
}, {
    getterMethods: {
        tradeAmountYuan: function () { return _Y(this.tradeAmount); },
    },
    timestamps: false,
});

export default model;

```

* PDShopServer/project/App/mysql/OrderPaymentModel.js

```js
import Sequelize from 'sequelize';
import sequelize from './sequelize';
import { getFormatTime } from '../utils';

const model = sequelize.define('OrderPayment', {
    orderId: { type: Sequelize.STRING(24), primaryKey: true, unique: true },
    isPayed: { type: Sequelize.BOOLEAN, defaultValue: false }, // 是否已经付款（如果是现付，只是否已经付运费+保险，如果是到付，是否扣除物流公司和支付运费）
    isRebated: { type: Sequelize.BOOLEAN, defaultValue: false }, // 是否返利，(交易成功后所有的资金返回)
    payedTime: { // 付款时间
        type: Sequelize.DATE,
        get () {
            return getFormatTime(this.getDataValue('payedTime'));
        },
    },
    rebatedTime: { // 返利时间
        type: Sequelize.DATE,
        get () {
            return getFormatTime(this.getDataValue('rebatedTime'));
        },
    },
}, {
    timestamps: false,
});

export default model;

```

* PDShopServer/project/App/mysql/RegionModel.js

```js
import Sequelize from 'sequelize';
import sequelize from './sequelize';
// 内部交易
const model = sequelize.define('Region', {
    code: Sequelize.INTEGER(10), // 对应的代码
    parentCode: Sequelize.INTEGER(8), // 父级代码
    name: Sequelize.STRING(50), // 名称
    level: Sequelize.STRING, //级别 (1,2,3,4)
}, {
    getterMethods: {
        isLeaf: function () {
            return (
                this.level === 0 ||
                this.level === 4 ||
                this.level === 5 ||
                this.level === 6 ||
                this.level === 7 ||
                this.level === 10
            );
        },
    },
    timestamps: false,
});

export default model;

```

* PDShopServer/project/App/mysql/TruckPaymentModel.js

```js
import Sequelize from 'sequelize';
import sequelize from './sequelize';
import { getFormatTime } from '../utils';

const model = sequelize.define('TruckPayment', {
    truckId: { type: Sequelize.STRING(24), primaryKey: true, unique: true },
    isPayedForCarryPartment: { type: Sequelize.BOOLEAN, defaultValue: false }, // 是否已经给搬运部付钱
    payedForCarryPartmentTime: { // 付款时间
        type: Sequelize.DATE,
        get () {
            return getFormatTime(this.getDataValue('payedForCarryPartmentTime'));
        },
    },
}, {
    timestamps: false,
});

export default model;

```

* PDShopServer/project/App/mysql/index.js

```js
export sequelize from './sequelize';
export AccountModel from './AccountModel';
export BillModel from './BillModel';
export OrderPaymentModel from './OrderPaymentModel';
export TruckPaymentModel from './TruckPaymentModel';
export RegionModel from './RegionModel';

```

* PDShopServer/project/App/mysql/sequelize.js

```js
import Sequelize from 'sequelize';
import config from '../../config';

export default new Sequelize(config.mysql.database, config.mysql.username, config.mysql.password, config.mysql);

```

* PDShopServer/project/App/routers/index.js

```js
import { Router } from 'express';
import posts from './posts';
import gets from './gets';
import _ from 'lodash';
import { timeout, apiRoot } from '../../config';

const router = new Router();
const LOG_FILTERS = [
    'getRegionAddress',
    'getRegionAddressFromLastCode',
    'getSendDoorRegionAddressFromLastCode',
    'getStartPointAddress',
    'getStartPoint',
    'getRegionAddressWithOrder',
    'getRegionAddressWithRegion',
];

async function DEBUG (func, ...params) {
    try {
        return await func(...params);
    } catch (e) {
        console.log(e);
    }
}

function registerPostRouter (root, posts) {
    _.map(posts, (func, api) => {
        const url = root + '/' + api;
        if (typeof func === 'object') {
            registerPostRouter(url, func);
        } else {
            // console.log('register:', url);
            router.post(url, async (req, res) => {
                if (process.env.NODE_ENV === 'production') {
                    console.log(url + ' recv:', req.body, req.file || '');
                    let result = await func(req.body, req);
                    _.includes(LOG_FILTERS, api) || console.log(url + ' send:', JSON.stringify(result, null, 2));
                    if (!result || typeof result === 'number') {
                        res.sendStatus(result || 500);
                    } else {
                        res.send(result);
                    }
                } else {
                    console.log(url + ' recv:', req.body, req.file || '');
                    let result = await DEBUG(func, req.body, req);
                    _.includes(LOG_FILTERS, api) || console.log(url + ' send:', JSON.stringify(result, null, 2));
                    setTimeout(() => {
                        if (!result || typeof result === 'number') {
                            res.sendStatus(result || 500);
                        } else {
                            res.send(result);
                        }
                    }, timeout);
                }
            });
        }
    });
}

function registerGetRouter (root, gets) {
    _.map(gets, (func, api) => {
        const url = root + '/' + api;
        if (typeof func === 'object') {
            registerGetRouter(url, func);
        } else {
            // console.log('register:', url);
            router.get(url, async (req, res) => {
                if (process.env.NODE_ENV === 'production') {
                    console.log(url + ' recv:', req.query);
                    let result = await func(req.query, req);
                    _.includes(LOG_FILTERS, api) || console.log(url + ' send:', result.readable ? 'image' : result);
                    if (!result || typeof result === 'number') {
                        res.sendStatus(result || 500);
                    } else if (result.readable) {
                        result.pipe(res);
                    } else {
                        res.send(result);
                    }
                } else {
                    console.log(url + ' recv:', req.query);
                    let result = await DEBUG(func, req.query, req);
                    _.includes(LOG_FILTERS, api) || console.log(url + ' send:', result.readable ? 'image' : result);
                    setTimeout(() => {
                        if (!result || typeof result === 'number') {
                            res.sendStatus(result || 500);
                        } else if (result.readable) {
                            result.pipe(res);
                        } else {
                            res.send(result);
                        }
                    }, timeout);
                }
            });
        }
    });
}

registerPostRouter(apiRoot, posts);
registerGetRouter(apiRoot, gets);

export default router;

```

* PDShopServer/project/App/utils/account.js

```js
import _ from 'lodash';
import mongoose from 'mongoose';
import { ShopMemberModel, ClientModel, PaymentModel, VerifyCodeModel } from '../models';
import config from '../../config';

export function registerUser (model, user, password) {
    return new Promise(resolve => {
        model.register(user, password, error => {
            if (error) {
                return resolve(error.name);
            }
            return resolve();
        });
    });
}
export function setPassword (user, password) {
    return new Promise(resolve => {
        user.setPassword(password, (err, thisModel, passwordErr) => {
            if (passwordErr) {
                return resolve(passwordErr);
            }
            return resolve();
        });
    });
}
export function checkVerifyCode (phone, verifyCode) {
    if (config.hasNoVerifyCode) {
        return true;
    }
    return new Promise(async resolve => {
        const vc = await VerifyCodeModel.findOne({ phone });
        if (!vc) {
            return resolve();
        }
        const codeList = vc.codeList;
        const now = Date.now();
        if (!_.find(codeList, o => o.code === verifyCode && o.deadTime.getTime() > now)) {
            return resolve();
        }
        vc.codeList = [];
        await vc.save();
        resolve(true);
    });
}
export function authenticatePassword (user, password) {
    return new Promise(resolve => {
        user.authenticate(password, (err, thisModel, passwordErr) => {
            if (passwordErr) {
                return resolve(passwordErr);
            }
            return resolve();
        });
    });
}
export function authenticatePaymentPassword (userId, password) {
    return new Promise(async resolve => {
        const payment = await PaymentModel.findOne({ userId });
        if (!payment) {
            return resolve(true);
        }
        payment.authenticate(password, (err, thisModel, passwordErr) => {
            if (passwordErr) {
                return resolve(passwordErr);
            }
            return resolve();
        });
    });
}
export function getDefaultPassWord (phone, password) {
    return password || phone.substr(-6, 6);
}
export function genRandomPassword () {
    let pwd = '';
    let ranges = [[48, 57], [65, 90], [97, 122]];
    for (let i = 0; i < 6; i++) {
        let range = ranges[_.random(0, 2)];
        pwd += String.fromCharCode(_.random(range[0], range[1]));
    }
    return pwd;
}
export function getOwnShop (userId) {
    return new Promise(async resolve => {
        const member = await ShopMemberModel.findById(userId);
        return resolve(member && member.shopId);
    });
}
export function getOwnShipper (userId) {
    return new Promise(async resolve => {
        const member = await ClientModel.findById(userId);
        return resolve(member && member.shipperId);
    });
}
export function getPartmentIdByMember (userId) {
    return new Promise(async resolve => {
        const member = await ShopMemberModel.findById(userId);
        return resolve(member ? member.partmentId + '' : '');
    });
}
export function hasAuthority (member, authority, isClient) {
    authority = _.isArray(authority) ? authority : [authority];
    if (mongoose.Types.ObjectId.isValid(member)) {
        return new Promise(async resolve => {
            const model = isClient ? ClientModel : ShopMemberModel;
            const _member = await model.findById(member);
            return resolve(_member && !!_.intersection(_member.authority, authority).length);
        });
    } else {
        return member && !!_.intersection(member.authority, authority).length;
    }
}
export function checkAuthorizationCode (authorizationCode) {
    return authorizationCode === '__smt_8_8_6_2_2_8_0_3__';
}

```

* PDShopServer/project/App/utils/check.js

```js
import _ from 'lodash';

function _R (keyword) {
    return new RegExp('.*' + (keyword || '') + '.*', 'gim');
}

export function getKeywordCriteriaForShipper (keyword, criteria = {}) {
    if (keyword) {
        const regex = _R(keyword);
        criteria = { ...criteria, $or: [{ name: regex }, { phone: regex }] };
    }
    return _.omitBy(criteria, _.isNil);
}
export function getKeywordCriteriaForRoadmap (keyword, criteria = {}) {
    if (keyword) {
        criteria = { ...criteria, endPoint: _R(keyword) };
    }
    return _.omitBy(criteria, _.isNil);
}
export function getKeywordCriteriaForOrder (keyword, criteria = {}) {
    if (keyword) {
        const regex = _R(keyword);
        criteria = { ...criteria, endPoint: regex };
    }
    return _.omitBy(criteria, _.isNil);
}
export function getKeywordCriteriaForUser (keyword, criteria = {}) {
    if (keyword) {
        const regex = _R(keyword);
        criteria = { ...criteria, $or: [{ name: regex }, { phone: regex }, { email: regex }] };
    }
    return _.omitBy(criteria, _.isNil);
}
export function getKeywordCriteriaForTruck (keyword, criteria = {}) {
    if (keyword) {
        criteria = { ...criteria, plateNo: _R(keyword) };
    }
    return _.omitBy(criteria, _.isNil);
}
export function getKeywordCriteriaForPartment (keyword, criteria = {}) {
    if (keyword) {
        const regex = _R(keyword);
        criteria = { ...criteria, $or: [{ name: regex }, { plateNo: regex }] };
    }
    return _.omitBy(criteria, _.isNil);
}
export function getKeywordCriteriaForWarehouse (keyword, criteria = {}) {
    if (keyword) {
        const regex = _R(keyword);
        criteria = { ...criteria, houseNo: regex };
    }
    return _.omitBy(criteria, _.isNil);
}
export function getKeywordCriteriaForRoadmapRegion (keyword, criteria = {}) {
    if (keyword) {
        const regex = _R(keyword);
        criteria = { ...criteria, region: regex };
    }
    return _.omitBy(criteria, _.isNil);
}

```

* PDShopServer/project/App/utils/common.js

```js
import _ from 'lodash';
import moment from 'moment';

export function _T (id) {
    return String(id);
}
export function _F (yuan) {
    return Math.floor(yuan * 100);
}
export function _Y (fen) {
    return fen / 100;
}
export function _N (num, rank = 2) {
    return parseFloat(num.toFixed(rank));
}
export function omitNil (obj) {
    return _.omitBy(obj, _.isNil);
}
export function testPhone (phone) {
    return /^1\d{10}$/.test(phone);
}
export function getAgeFromBirthday (birthday) {
    if (!birthday) {
        return undefined;
    }
    return Math.floor(moment().diff(moment(birthday)) / 31536000000);
}

```

* PDShopServer/project/App/utils/email.js

```js
import nodemailer from 'nodemailer';

export function sendFindPasswordMail (address, password) {
    const name = '刷我的卡';
    const serverName = '刷我的卡官网';
    const serverUrl = 'mailto:cocos@chukong-inc.com';
    const transporter = nodemailer.createTransport({
        host: 'smtp.163.com',   // 支持列表 https://github.com/andris9/nodemailer-wellknown#supported-services
        port: 25, // SMTP 端口
        secureConnection: true, // 使用 SSL
        auth: {
            user: 'use_myself_card@163.com',
            pass: 'card123456',
        },
    });
    const options = {
        from: 'use_myself_card@163.com', // 发件地址
        to: address, // 收件列表
        subject: `【${name}】请在30分钟内重设您的密码`, // 标题
        html: `
        <div style="border-top:1px solid #808080;margin:0px 0 10px;padding:20px 0">
                <p style="font-size:14px;font-weight:bold;font-family:'Helvetica Neue',Helvetica,STheiti,Arial,Tahoma,微软雅黑,sans-serif,serif;color:#222;padding:0;margin:0">${address}</span>，感谢您使用刷我的卡帐号</p>
                <div style="font-size:14px;font-family:'Helvetica Neue',Helvetica,STheiti,Arial,Tahoma,微软雅黑,sans-serif,serif;color:#464646;padding:0;margin:20px 0 5px;line-height:1.6">您正在申请重新设置您的${name}帐号密码，请确认是本人操作</div>
                <div style="font-size:14px;font-family:'Helvetica Neue',Helvetica,STheiti,Arial,Tahoma,微软雅黑,sans-serif,serif;color:#464646;padding:0;margin:20px 0 5px;line-height:1.6">你的重置密码为：${password}，请在30分钟内在${name}App中修改密码。</div>
                <p style="font-size:12px;font-family:'Helvetica Neue',Helvetica,STheiti,Arial,Tahoma,微软雅黑,sans-serif,serif;color:#666;padding:0;margin:0;line-height:1.6">如您有任何问题，请联系：<a href="${serverUrl}" target="_blank">${serverName}</a></p>
                <p style="font-size:12px;font-family:'Helvetica Neue',Helvetica,STheiti,Arial,Tahoma,微软雅黑,sans-serif,serif;color:#666;padding:0;margin:0;line-height:1.6">${name}帐号系统</p>
        </div>
        `, //内容
    };
    return new Promise(async resolve => {
        transporter.sendMail(options, (error, info) => {
            console.log(error, info);
            if (error) {
                return resolve(false);
            }
            return resolve(true);
        });
    });
}

```

* PDShopServer/project/App/utils/format.js

```js
import mongoose from 'mongoose';
import moment from 'moment';
import _ from 'lodash';
import { host, port, apiRoot } from '../../config';

export function getMediaPath (id) {
    const imgPort = process.env.NODE_ENV === 'production' ? 80 : port;
    return id ? 'http://' + host + ':' + imgPort + apiRoot + '/image?id=' + id : undefined;
}
export function getMediaId (url) {
    return url ? url.replace(/.*id=/, '') : undefined;
}
export function formatMedia (obj, ...keys) {
    for (var key of keys) {
        obj[key] = getMediaPath(obj[key]);
    }
}
export function getFormatTime (time) {
    return time ? moment(time).format('YYYY-MM-DD HH:mm:ss') : undefined;
}
export function formatTime (obj, ...keys) {
    for (var key of keys) {
        obj[key] && (obj[key] = moment(obj[key]).format('YYYY-MM-DD HH:mm:ss'));
    }
}
export function formatPhoneList (obj) {
    let phoneList = [];
    if (obj.phoneList) {
        phoneList = _.without(obj.phoneList.split(/;|；/), obj.phone);
    }
    obj.phoneList = _.uniq(phoneList).join(';') || undefined;
}
export function virtualObjectById (schema, ...keys) {
    schema.virtual('id').get(function () {
        return this._id;
    });
    _.forEach(keys, (key) => {
        schema.virtual(key.replace(/Id$/, '')).get(function () {
            return mongoose.Types.ObjectId.isValid(this[key]) ? undefined : this[key];
        });
    });
}
export function formatObjectById (obj, ...keys) {
    delete obj.__v;
    delete obj._id;
    for (var key of keys) {
        obj[key.replace(/Id$/, '')] && delete obj[key];
    }
}

```

* PDShopServer/project/App/utils/index.js

```js
export * from './account';
export * from './check';
export * from './common';
export * from './email';
export * from './format';
export * from './sms';
export * from './log';

```

* PDShopServer/project/App/utils/log.js

```js
import { LogModel } from '../models';

export function actionLog (operatorId, operatorModel, targetId, targetModel, action, remark) {
    const log = new LogModel({
        operator: { id: operatorId, model: operatorModel },
        target: { id: targetId, model: targetModel },
        action,
        remark,
    });
    log.save();
}
export function actionLogWithList (operatorId, operatorModel, targetList, action, remark) {
    const log = new LogModel({
        operator: { id: operatorId, model: operatorModel },
        targetList: targetList,
        action,
        remark,
    });
    log.save();
}

```

* PDShopServer/project/App/utils/sms.js

```js
import request from 'superagent';

export function sendSms (phone, code) {
    return new Promise(async resolve => {
        request.get('http://v.juhe.cn/sms/send')
        .query({
            mobile: phone,
            tpl_id: 45242,
            tpl_value: `#code#=${code}`,
            key: '61234234f2760791609002be4d14508f',
        })
        .end((error, res) => {
            if (error) {
                return resolve(false);
            } else {
                const { error_code } = res.body;
                if (error_code === 0) {
                    return resolve(true);
                } else {
                    return resolve(false);
                }
            }
        });
    });
}

```

* PDShopServer/project/App/routers/gets/index.js

```js
import * as common from './common';
import * as test from './test';

export default {
    ...common,
    ...test,
};

```

* PDShopServer/project/App/routers/posts/index.js

```js
import * as common from './common';
import * as admin from './admin';
import * as client from './client';
import * as shop from './shop';
import * as shipper from './shipper';
import * as agent from './agent';
import * as driver from './driver';

export default {
    ...common,
    admin,
    client,
    shipper,
    shop,
    agent,
    driver,
};

```

* PDShopServer/project/App/routers/gets/common/audio.js

```js
import mongoose from 'mongoose';
import { MediaModel } from '../../../models';

export default ({
    id,
}) => {
    return new Promise(async resolve => {
        const { gfs } = mongoose;
        let doc = await MediaModel.findById(id);
        if (!doc) {
            return resolve(404);
        } else {
            return resolve(gfs.createReadStream({ _id: doc.gridId }));
        }
    });
};

```

* PDShopServer/project/App/routers/gets/common/image.js

```js
import mongoose from 'mongoose';
import { MediaModel } from '../../../models';

export default ({
    id,
}) => {
    return new Promise(async resolve => {
        const { gfs } = mongoose;
        let doc = await MediaModel.findById(id);
        if (!doc) {
            return resolve(404);
        } else {
            return resolve(gfs.createReadStream({ _id: doc.gridId }));
        }
    });
};

```

* PDShopServer/project/App/routers/gets/common/index.js

```js
export image from './image';
export audio from './audio';

```

* PDShopServer/project/App/routers/gets/test/getVerifyCode.js

```js
import { VerifyCodeModel } from '../../../models';

export default async ({
    phone,
}) => {
    let doc = await VerifyCodeModel.findOne({ phone });
    if (!doc) {
        return { msg: '没有验证码' };
    }
    return { code: (doc.codeList[0] || {}).code };
};

```

* PDShopServer/project/App/routers/gets/test/index.js

```js
export getVerifyCode from './getVerifyCode';

```

* PDShopServer/project/App/routers/posts/admin/index.js

```js
// common
export login from './personal/login'; // 登录
export register from './personal/register'; // 注册
export findPassword from './personal/findPassword'; // 找回密码
export modifyPassword from './personal/modifyPassword'; // 修改密码
export removeUnusedMedia from './personal/removeUnusedMedia'; // 删除无用的media文件

// version
export addVersion from './version/addVersion'; // 发布版本
export getVersionList from './version/getVersionList'; // 获取发布版本的列表

// feedback
export getFeedbackList from './feedback/getFeedbackList'; // 获取反馈意见的列表
export acceptDeelFeedback from './feedback/acceptDeelFeedback'; // 开始反馈意见的处理
export finishDeelFeedback from './feedback/finishDeelFeedback'; // 完成反馈意见的处理

// shop
export createMasterShop from './shop/createMasterShop'; // 创建总部和董事长账号

// authority
export resetMasterChairManAuthority from './authority/resetMasterChairManAuthority'; // 重置总部董事长的权限
export resetBranchChairManAuthority from './authority/resetBranchChairManAuthority'; // 重置分店董事长的权限
export resetPartmentChargeManAuthority from './authority/resetPartmentChargeManAuthority'; // 重置部门负责人的权限
export resetShipperChairManAuthority from './authority/resetShipperChairManAuthority'; // 重置部门物流公司董事长的权限
export modifyMemberAuthority from './authority/modifyMemberAuthority'; // 修改成员的权限
export modifyClientAuthority from './authority/modifyClientAuthority'; // 修改客户的权限（物流公司 和 收货点）

// test
export test from './test/test'; // 测试接口

```

* PDShopServer/project/App/routers/posts/agent/index.js

```js
// member
export modifyMemberAuthority from './member/modifyMemberAuthority'; // 修改成员的权限
export getMemberList from './member/getMemberList'; // 获取成员列表
export getMemberDetail from './member/getMemberDetail'; // 获取成员详情
export getMemberByPhone from './member/getMemberByPhone'; // 通过电话获取成员详情

// regionProfit
export addRegionProfit from './regionProfit/addRegionProfit'; // 添加区域的路线提成
export removeRegionProfit from './regionProfit/removeRegionProfit'; // 删除区域的路线提成
export modifyRegionProfit from './regionProfit/modifyRegionProfit'; // 修改区域的路线提成
export getRegionProfitDetail from './regionProfit/getRegionProfitDetail'; // 获取区域的路线提成详情
export getRegionProfitList from './regionProfit/getRegionProfitList'; // 获取区域的路线提成列表
export setRegionProfitWithList from './regionProfit/setRegionProfitWithList'; // 批量设置提成
export getRegionAddressWithRegion from './regionProfit/getRegionAddressWithRegion'; // 通过region获取地址列表

// referShop
export setReferShop from './referShop/setReferShop'; // 设置关联店铺
export getReferShopList from './referShop/getReferShopList'; // 获取关联店铺的列表

// order
export placeOrder from './order/placeOrder'; // 下单
export modifyOrder from './order/modifyOrder'; // 修改货单
export placeOrderWithPreOrder from './order/placeOrderWithPreOrder'; // 根据预下单下初始单
export getOrders from './order/getOrders'; // 获取货单列表
export getOrderDetail from './order/getOrderDetail'; // 获取货单详情
export getLastestOrder from './order/getLastestOrder'; // 获取待打印货单
export printBarCode from './order/printBarCode'; // 打印二维码
export confirmCachPayed from './order/confirmCachPayed'; // 确认现金支付
export confirmCachPayedForOrderList from './order/confirmCachPayedForOrderList'; // 确认现金支付多个货单
export printOrderBill from './order/printOrderBill'; // 打印货单
export printOrderListBill from './order/printOrderListBill'; // 打印货单列表的货单
export getPreOrderList from './order/getPreOrderList'; // 获取预下单列表
export getRegionAddressWithOrder from './order/getRegionAddressWithOrder'; // 通过货单获取地址
export getRegionSendDoorAddressWithOrder from './order/getRegionSendDoorAddressWithOrder'; // 通过货单获取送货上门地址
export removeOrder from './order/removeOrder'; // 删除货单

```

* PDShopServer/project/App/routers/posts/client/index.js

```js
// common
export login from './personal/login';// 登录
export register from './personal/register';// 注册
export findPassword from './personal/findPassword';// 找回密码
export modifyPassword from './personal/modifyPassword';// 修改密码
export getPersonalInfo from './personal/getPersonalInfo';// 获取个人信息
export modifyPersonalInfo from './personal/modifyPersonalInfo'; // 修改个人信息
export getShipperInfo from './personal/getShipperInfo';// 获取物流公司信息
export modifyShipperInfo from './personal/modifyShipperInfo'; // 修改物流公司信息
export getAgentInfo from './personal/getAgentInfo';// 获取收货点信息
export modifyAgentInfo from './personal/modifyAgentInfo'; // 修改收货点信息
export getUserNameByPhone from './personal/getUserNameByPhone'; // 通过电话号码获取用户名
export getBranchShopInfo from './personal/getBranchShopInfo'; // 获取物流公司入住分店的详情
export submitFeedback from './personal/submitFeedback'; // 提交反馈意见

// account
export recharge from './account/recharge'; // 充值
export withdraw from './account/withdraw'; // 提现
export getBillList from './account/getBillList'; // 获取账单
export getRemainAmount from './account/getRemainAmount'; // 获取余额值
export setPaymentPassword from './account/setPaymentPassword'; // 设置支付密码
export getBills from './account/getBills'; // 获取

// weixinPay
export weixinPayGetUnifiedOrder from './weixinPay/getUnifiedOrder'; // 统一下单(App支付)
export weixinPayGetUnifiedOrderForPC from './weixinPay/getUnifiedOrderForPC'; // 统一下单(扫码支付)

// roadmap
export getRoadmapListWithPreOrder from './roadmap/getRoadmapListWithPreOrder'; // 通过预下单获取收货点和分店路线列表
export getRoadmapListWithPreOrderGroup from './roadmap/getRoadmapListWithPreOrderGroup'; // 通过预下单批次获取收货点和分店路线列表
export getRoadmapListWithEndPoint from './roadmap/getRoadmapListWithEndPoint'; // 通过终点获取收货点和分店路线列表
export getRoadmapDetail from './roadmap/getRoadmapDetail'; // 获取路线详情

// order
export finishOrder from './order/finishOrder'; // 确认收货
export payForOrderWhenReceive from './order/payForOrderWhenReceive'; // 付款后确认收货
export payForOrderWhenSend from './order/payForOrderWhenSend'; // 货主使用app支付
export payForAgentOrder from './order/payForAgentOrder'; // 支付收货点的费用
export getSendOrderList from './order/getSendOrderList'; // 获取发生货单列表
export getReceiveOrderList from './order/getReceiveOrderList'; // 获取接收货单列表
export getOrderDetail from './order/getOrderDetail'; // 获取货单详情
export getLogisticsList from './order/getLogisticsList'; // 获取物流信息
export getSendOrders from './order/getSendOrders'; // 获取发生货单综合列表
export getReceiveOrders from './order/getReceiveOrders'; // 获取接收货单综合列表

// preOrder
export placePreOrder from './preOrder/placePreOrder'; // 预下单
export modifyPreOrder from './preOrder/modifyPreOrder'; // 修改预下单
export removePreOrder from './preOrder/removePreOrder'; // 删除预下单
export getPreOrderList from './preOrder/getPreOrderList'; // 获取预下单列表
export getPreOrderGroupList from './preOrder/getPreOrderGroupList'; // 获取预下单批次列表
export createPreOrderGroup from './preOrder/createPreOrderGroup'; // 创建预下单批次
export modifyPreOrderGroup from './preOrder/modifyPreOrderGroup'; // 修改预下单批次
export removePreOrderFromGroup from './preOrder/removePreOrderFromGroup'; // 删除货单批次中的一个货单
export getPreOrderListInGroup from './preOrder/getPreOrderListInGroup'; // 获取批次中的预下单列表

// client
export getClientList from './client/getClientList'; // 获取客户列表

```

* PDShopServer/project/App/routers/posts/common/index.js

```js
// notify
export getNotifies from './notify/getNotifies'; // 获取通知的综合列表
export sendNotify from './notify/sendNotify'; // 发送通知

// upload
export uploadFile from './upload/uploadFile'; // 上传文件

// address
export getRegionAddress from './address/getRegionAddress'; // 通过parentCode获取地址列表
export getRegionAddressFromLastCode from './address/getRegionAddressFromLastCode'; // 通过lastCode获取地址列表
export getRegionSendDoorAddressFromLastCode from './address/getRegionSendDoorAddressFromLastCode'; // 通过lastCode获取送货上门地址列表
export getStartPointAddress from './address/getStartPointAddress'; // 通过parentCode获取始发地地址列表
export getStartPointAddressFromLastCode from './address/getStartPointAddressFromLastCode'; // 通过lastCode获取始发地地址列表

// client
export getClientNameByPhone from './client/getClientNameByPhone'; // 通过电话号码获取用户名

// verifyCode
export requestSendVerifyCode from './verifyCode/requestSendVerifyCode'; // 请求发送验证码

// weixinPay
export weixinNotifyCallBack from '../libs/weixinPay/notifyCallBack'; // 微信支付通知回调

```

* PDShopServer/project/App/routers/posts/driver/index.js

```js
// personal
export register from './personal/register'; // 注册
export login from './personal/login'; // 登录
export findPassword from './personal/findPassword'; // 找回密码
export modifyPassword from './personal/modifyPassword'; // 修改密码
export getPersonalInfo from './personal/getPersonalInfo'; // 获取个人信息
export modifyPersonalInfo from './personal/modifyPersonalInfo'; // 修改个人信息
export getUserNameByPhone from './personal/getUserNameByPhone'; // 通过电话号码获取用户名
export submitFeedback from './personal/submitFeedback'; // 提交反馈意见

// truck
export getOnWayTruck from './truck/getOnWayTruck'; // 获取当前车辆
export getLocationList from './truck/getLocationList'; // 获取当前车辆的位置列表
export uploadLocation from './truck/uploadLocation'; // 上传位置
export confirmReach from './truck/confirmReach'; // 确认到达

```

* PDShopServer/project/App/routers/posts/shipper/index.js

```js
// member
export modifyMemberAuthority from './member/modifyMemberAuthority'; // 修改成员的权限
export getMemberList from './member/getMemberList'; // 获取成员列表
export getMemberDetail from './member/getMemberDetail'; // 获取成员详情
export getMemberByPhone from './member/getMemberByPhone'; // 通过电话获取成员详情

// account
export getBondAmountInfo from './account/getBondAmountInfo'; // 获取在某一家分店的担保金额信息

// roadmap
export publishRoadmap from './roadmap/publishRoadmap'; // 发布物流路线
export modifyRoadmap from './roadmap/modifyRoadmap'; // 修改物流路线
export removeRoadmap from './roadmap/removeRoadmap'; // 删除物流路线
export getRoadmapList from './roadmap/getRoadmapList'; // 获取物流路线列表
export getRoadmapDetail from './roadmap/getRoadmapDetail'; // 获取物流路线详情
export setRoadmapPrice from './roadmap/setRoadmapPrice'; // 设置物流路线价格
export setRoadmapEnable from './roadmap/setRoadmapEnable'; // 设置物流路线是否停运
export setRoadmapSendDoorEnable from './roadmap/setRoadmapSendDoorEnable'; // 设置物流路线送货上门是否停运
export setRoadmapSendDoorPrice from './roadmap/setRoadmapSendDoorPrice'; // 设置物流路线送货上门价格
export setRoadmapSendDoorBasePrice from './roadmap/setRoadmapSendDoorBasePrice'; // 设置物流路线送货上门底价

// order
export getNeedSendOrderSummaryList from './order/getNeedSendOrderSummaryList'; // 获取竞得货物汇总列表
export getNeedSendOrderListByEndPoint from './order/getNeedSendOrderListByEndPoint'; // 通过终点获取竞得货物列表
export confirmHandOverOrder from './order/confirmHandOverOrder'; // 确认交货
export getOrders from './order/getOrders'; // 获取货单综合列表

// truck
export createTruck from './truck/createTruck'; // 创建货车
export modifyTruck from './truck/modifyTruck'; // 修改货车
export removeTruck from './truck/removeTruck'; // 删除货车
export getWorkTruckList from './truck/getWorkTruckList'; // 获取待工作货车列表
export getHistoryTruckList from './truck/getHistoryTruckList'; // 获取历史货车列表
export getTruckDetail from './truck/getTruckDetail'; // 获取货车详情
export getTruckType from './truck/getTruckType'; // 获取货车类型
export getDriverInfoByPhone from './truck/getDriverInfoByPhone'; // 通过司机手机号获取司机信息
export getOrderListInTruck from './truck/getOrderListInTruck'; // 获取货车的货单列表
export getTrucks from './truck/getTrucks'; // 获取货车综合列表
export getUnfinishTruck from './truck/getUnfinishTruck'; // 获取未装完货车信息

// loadCargo
export getCarryPartmentList from './loadCargo/getCarryPartmentList'; // 获取搬运部列表
export selectCarryPartment from './loadCargo/selectCarryPartment'; // 选择搬运部
export startScanOrder from './loadCargo/startScanOrder'; // 开始扫描装车 （在列表的时候点击调用）
export scanLoadOrder from './loadCargo/scanLoadOrder'; // 扫描货单装车
export scanOrder from './loadCargo/scanLoadOrder'; // 扫描货单装车
export finishScanOrder from './loadCargo/finishScanOrder'; // 结束扫描
export continueScanOrder from './loadCargo/continueScanOrder'; // 继续扫描装车 （在结束扫描的后点击继续扫描时调用）
export payForCarryPartment from './loadCargo/payForCarryPartment'; // 给搬运队付钱

// cityDistribute
export getClientPickShipperList from './cityDistribute/getClientPickShipperList'; // 获取设置了上门自提竞价的物流公司列表
export placeStorage from './cityDistribute/placeStorage'; // 入库
export setClientPickOrderTransportFee from './cityDistribute/setClientPickOrderTransportFee'; // 打电话确认后设置地址和价格
export setCityTruck from './cityDistribute/setCityTruck'; // 设置同城配送的货车
export getCityTruckDetail from './cityDistribute/getCityTruckDetail'; // 获取同城配送的货车的详情
export getOrderListInCityTruck from './cityDistribute/getOrderListInCityTruck'; // 获取同城配送的货车的货单列表
export scanLoadOrderForCityDistribute from './cityDistribute/scanLoadOrderForCityDistribute'; // 获取同城配送扫描装车
export getCityDistributeOrders from './cityDistribute/getOrders'; // 获取同城配送货单列表

// statistics
export getStatistics from './statistics/getStatistics'; // 获取统计信息

```

* PDShopServer/project/App/routers/posts/shop/index.js

```js
// common
export login from './personal/login'; // 登录
export findPassword from './personal/findPassword'; // 找回密码
export modifyPassword from './personal/modifyPassword'; // 修改密码
export getPersonalInfo from './personal/getPersonalInfo'; // 获取个人信息
export modifyPersonalInfo from './personal/modifyPersonalInfo'; // 修改个人信息
export submitFeedback from './personal/submitFeedback'; // 提交反馈意见

// account
export recharge from './account/recharge'; // 部门充值
export withdraw from './account/withdraw'; // 提现
export getRemainAmount from './account/getRemainAmount'; // 获取余额
export setPaymentPassword from './account/setPaymentPassword'; // 设置支付密码
export getBillList from './account/getBillList'; // 获取账单列表
export getBills from './account/getBills'; // 获取综合账单

// weixinPay
export weixinPayGetUnifiedOrder from './weixinPay/getUnifiedOrder'; // 统一下单(App支付)
export weixinPayGetUnifiedOrderForPC from './weixinPay/getUnifiedOrderForPC'; // 统一下单(扫码支付)

// member
export createMember from './member/createMember'; // 创建公司成员
export getMemberList from './member/getMemberList'; // 获取公司成员列表
export getMemberDetail from './member/getMemberDetail'; // 获取公司成员详情
export modifyMember from './member/modifyMember'; // 修改公司成员信息
export removeMember from './member/removeMember'; // 删除公司成员信息
export getWarehouseMemberList from './member/getWarehouseMemberList'; // 获取库管成员

// partment
export createPartment from './partment/createPartment'; // 创建部门
export getPartmentList from './partment/getPartmentList'; // 获取部门列表
export getPartmentDetail from './partment/getPartmentDetail'; // 获取部门详情
export modifyPartment from './partment/modifyPartment'; // 修改部门信息
export removePartment from './partment/removePartment'; // 删除部门信息
export getOwnPartmentInfo from './partment/getOwnPartmentInfo'; // 获取所在部门信息
export modifyOwnPartment from './partment/modifyOwnPartment'; // 修改所在部门信息

// masterShop
export createBranchShop from './masterShop/createBranchShop'; // 创建分部
export getBranchShopList from './masterShop/getBranchShopList'; // 获取分部列表
export getBranchShopDetail from './masterShop/getBranchShopDetail'; // 获取分部详情
export modifyBranchShop from './masterShop/modifyBranchShop'; // 修改分部信息
export removeBranchShop from './masterShop/removeBranchShop'; // 删除分部
export getSettingInfo from './masterShop/getSettingInfo'; // 获取设置的信息
export modifySettingInfo from './masterShop/modifySettingInfo'; // 获取设置的信息

// branchShop
export createAndRegisterShipper from './branchShop/createAndRegisterShipper'; // 创建并注册物流公司
export registerShipper from './branchShop/registerShipper'; // 注册物流物流公司
export getShipperByChairManPhone from './branchShop/getShipperByChairManPhone'; // 通过董事长电话获取物流公司信息
export getToExamineTruckList from './branchShop/getToExamineTruckList'; // 获取待审核货车的列表

// order
export getOrders from './order/getOrders'; // 获取货单列表
export getOrderDetail from './order/getOrderDetail'; // 获取货单详情

// shop
export getOwnShopDetail from './shop/getOwnShopDetail'; // 获取所在店的信息
export modifyOwnShop from './shop/modifyOwnShop'; // 修改所在分店和总部的信息

// receivePartment
export placeOriginOrder from './receivePartment/placeOriginOrder'; // 收货员下初始单
export placeOriginOrderWithPreOrder from './receivePartment/placeOriginOrderWithPreOrder'; // 收货员根据预下单下初始单
export placeTransferOrder from './receivePartment/placeTransferOrder'; // 收货员下中转单
export modifyOriginOrder from './receivePartment/modifyOriginOrder'; // 收货员修改初始货单
export getLastestOrderByReceivePartment from './receivePartment/getLastestOrder'; // 获取收货部最近下的货单
export getOrdersByReceivePartment from './receivePartment/getOrders'; // 获取货单列表
export getRoadmapListWithOrderByReceivePartment from './receivePartment/getRoadmapListWithOrder'; // 根据货单获取路线列表
export selectRoadmap from './receivePartment/selectRoadmap'; // 选择路线
export selectRoadmapForOrderList from './receivePartment/selectRoadmapForOrderList'; // 批量选择路线
export proxyPay from './receivePartment/proxyPay'; // 代支付
export proxyPayForOrderList from './receivePartment/proxyPayForOrderList'; // 代支付多个货单
export printOrderBill from './receivePartment/printOrderBill'; // 打印货单
export printOrderListBill from './receivePartment/printOrderListBill'; // 打印货单列表的货单
export printBarCode from './receivePartment/printBarCode'; // 打印二维码
export removeOrder from './receivePartment/removeOrder'; // 删除货单
export getRegionAddressWithOrder from './receivePartment/getRegionAddressWithOrder'; // 通过货单获取地址
export getRegionSendDoorAddressWithOrder from './receivePartment/getRegionSendDoorAddressWithOrder'; // 通过货单获取送货上门地址
export setPhotoForOriginOrder from './receivePartment/setPhotoForOriginOrder'; // 为初始单设置图片
export getPreOrderList from './receivePartment/getPreOrderList'; // 收货部获取用户预下单列表

// warehousePartment
export placeStorage from './warehousePartment/placeStorage'; // 库管放置货物
export getOrdersByWareHousePartment from './warehousePartment/getOrders'; // 库管获取货单列表
export getLoadingOrderList from './warehousePartment/getLoadingOrderList'; // 库管获取正在装车的信息

// carryPartment
export getWorkTruckInfo from './carryPartment/getWorkTruckInfo'; // 获取当前正在搬运的货车的信息
export getCarryPartmentList from './carryPartment/getCarryPartmentList'; // 获取搬运队的列表查看行情
export getCarryList from './carryPartment/getCarryList'; // 获取搬运队的搬运历史列表
export getWaitScanTruckInfo from './carryPartment/getWaitScanTruckInfo'; // 获取搬运队的待扫描货车
export getOrderListInTruck from './carryPartment/getOrderListInTruck'; // 获取货车中的货单列表

// securityCheckPartment
export checkTruckPass from './securityCheckPartment/checkTruckPass'; // 保安部扫描是否可以通行

// shipper
export getShipperList from './shipper/getShipperList'; // 获取物流公司列表
export getShipperDetail from './shipper/getShipperDetail'; // 获取物流公司详情
export modifyShipper from './shipper/modifyShipper'; // 修改物流公司信息
export setBondCompany from './shipper/setBondCompany'; // 设置物流公司担保公司
export removeBondCompany from './shipper/removeBondCompany'; // 删除物流公司担保公司
export getNeedExamineTruckList from './shipper/getNeedExamineTruckList'; // 获取需要审核的货车
export passExamineTruck from './shipper/passExamineTruck'; // 通过审核货车

// agent
export createAgent from './agent/createAgent'; // 创建收货点
export modifyAgent from './agent/modifyAgent'; // 修改收货点
export removeAgent from './agent/removeAgent'; // 删除收货点
export getAgentList from './agent/getAgentList'; // 获取收货点列表
export getAgentDetail from './agent/getAgentDetail'; // 获取收货点详情
export checkAgentByChairManPhone from './agent/checkAgentByChairManPhone'; // 检测收货点董事长

// roadmap
export getRoadmapList from './roadmap/getRoadmapList'; // 获取物流路线列表
export getRoadmapDetail from './roadmap/getRoadmapDetail'; // 获取物流路线详情
export setRoadmapProfit from './roadmap/setRoadmapProfit'; // 修改路线的提成
export addRoadmapRegionProfitRate from './roadmap/addRoadmapRegionProfitRate'; // 添加区域的路线提成
export removeRoadmapRegionProfitRate from './roadmap/removeRoadmapRegionProfitRate'; // 删除区域的路线提成
export modifyRoadmapRegionProfitRate from './roadmap/modifyRoadmapRegionProfitRate'; // 修改区域的路线提成
export getRoadmapRegionProfitRateDetail from './roadmap/getRoadmapRegionProfitRateDetail'; // 获取区域的路线提成详情
export getRoadmapRegionProfitRateList from './roadmap/getRoadmapRegionProfitRateList'; // 获取区域的路线提成列表
export setRegionRateProfit from './roadmap/setRegionRateProfit'; // 批量修改区域的路线提成

// warehouse
export createWarehouse from './warehouse/createWarehouse'; // 创建仓库
export getWarehouseList from './warehouse/getWarehouseList'; // 获取仓库列表
export getWarehouseDetail from './warehouse/getWarehouseDetail'; // 获取仓库详情
export modifyWarehouse from './warehouse/modifyWarehouse'; // 修改仓库信息
export removeWarehouse from './warehouse/removeWarehouse'; // 删除仓库信息

// client
export getClientList from './client/getClientList'; // 获取用户列表
export getClientDetail from './client/getClientDetail'; // 获取用户详情

// statistics
export getStatistics from './statistics/getStatistics'; // 获取统计信息 (总部和分部)

```

* PDShopServer/project/App/routers/posts/admin/authority/modifyClientAuthority.js

```js
import { ClientModel } from '../../../../models';
import _ from 'lodash';

export default async ({
    userId,
    clientId,
    authority,
}) => {
    if (authority) {
        authority = _.sortBy(_.uniq(authority));
    }
    const doc = await ClientModel.findByIdAndUpdate(clientId, { authority }, { new: true }).select({
        phone: 1,
        email: 1,
        name: 1,
        head: 1,
        post: 1,
        partmentId: 1,
        authority: 1,
        phoneList: 1,
    }).populate({
        path: 'partmentId',
        select: { name: 1 },
    });
    if (!doc) {
        return { msg: '修改失败' };
    }
    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/admin/authority/modifyMemberAuthority.js

```js
import { ShopMemberModel } from '../../../../models';
import _ from 'lodash';

export default async ({
    userId,
    memberId,
    authority,
}) => {
    if (authority) {
        authority = _.sortBy(_.uniq(authority));
    }
    const doc = await ShopMemberModel.findByIdAndUpdate(memberId, { authority }, { new: true }).select({
        phone: 1,
        email: 1,
        name: 1,
        head: 1,
        post: 1,
        partmentId: 1,
        authority: 1,
        phoneList: 1,
    }).populate({
        path: 'partmentId',
        select: { name: 1 },
    });
    if (!doc) {
        return { msg: '修改失败' };
    }
    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/admin/authority/resetAgentChairManAuthority.js

```js
import { ClientModel, AgentModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    const agents = await AgentModel.find();
    for (const agent of agents) {
        await ClientModel.findByIdAndUpdate(agent.chairManId, {
            authority: [
                CONSTANTS.AH_MODIFY_AGENT_INFO, // 修改收货点信息的权限
                CONSTANTS.AH_MODIFY_AGENT_MEMBER_AUTHORITY, // 修改收货点成员权限的权限
                CONSTANTS.AH_PLACE_ORDER, // 收货下单的权限
                // 公共权限
                CONSTANTS.AH_MODIFY_ROADMAP_PROFIT, // 修改路线的提成的权限
                CONSTANTS.AH_RECHARGE, // 充值的权限
                CONSTANTS.AH_WITHDRAW, // 提现的权限
                CONSTANTS.AH_LOOK_AMOUNT, // 查看余额的权限
                // 统计
                CONSTANTS.AH_LOOK_ORDERS, // 查看综合货单的权限
                CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
            ],
        });
    }
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/authority/resetBranchChairManAuthority.js

```js
import { ShopMemberModel, ShopModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    const shops = await ShopModel.find({ isMasterShop: false });
    const chairManIds = shops.map(o => o.chairManId);
    await ShopMemberModel.update({ _id: { $in: chairManIds } }, {
        authority: [
            // 物流公司
            CONSTANTS.AH_CREATE_SHIPPER, // 创建物流公司
            CONSTANTS.AH_MODIFY_SHIPPER, // 修改物流公司
            CONSTANTS.AH_REMOVE_SHIPPER, // 删除物流公司
            CONSTANTS.AH_LOOK_SHIPPER, // 查看物流公司
            // 部门
            CONSTANTS.AH_CREATE_PARTMENT, // 创建部门的权限
            CONSTANTS.AH_MODIFY_PARTMENT, // 修改部门信息的权限
            CONSTANTS.AH_REMOVE_PARTMENT, // 删除部门的权限
            CONSTANTS.AH_LOOK_PARTMENT, // 查看部门的权限
            // 路线
            CONSTANTS.AH_LOOK_ROADMAP, // 查看路线的权限
            CONSTANTS.AH_TO_EXAMINE_TRUCK, // 审核货车
            // 公共权限
            CONSTANTS.AH_MODIFY_OWN_SHOP, // 修改自身分店的权限
            // 成员
            CONSTANTS.AH_CREATE_MEMBER, // 创建成员的权限
            CONSTANTS.AH_MODIFY_MEMBER, // 修改成员信息的权限
            CONSTANTS.AH_REMOVE_MEMBER, // 删除成员的权限
            CONSTANTS.AH_LOOK_MEMBER, // 查看成员的权限
            // 仓库
            CONSTANTS.AH_CREATE_WAREHOUSE, // 创建仓库的权限
            CONSTANTS.AH_MODIFY_WAREHOUSE, // 修改仓库信息的权限
            CONSTANTS.AH_REMOVE_WAREHOUSE, // 删除仓库的权限
            CONSTANTS.AH_LOOK_WAREHOUSE, // 查看仓库的权限
            // 提现，余额
            CONSTANTS.AH_WITHDRAW, // 提现的权限
            CONSTANTS.AH_LOOK_AMOUNT, // 查看余额的权限
            // 统计
            CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
            CONSTANTS.AH_LOOK_ORDERS, // 查看综合货单的权限
        ],
    }, { multi: true });

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/authority/resetMasterChairManAuthority.js

```js
import { ShopMemberModel, ShopModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    const shop = await ShopModel.findOne({ isMasterShop: true });
    await ShopMemberModel.findByIdAndUpdate(shop.chairManId, {
        authority: [
            // 分店
            CONSTANTS.AH_CREATE_BRANCH_SHOP, // 创建分店的权限
            CONSTANTS.AH_MODIFY_BRANCH_SHOP, // 修改分店的权限
            CONSTANTS.AH_REMOVE_BRANCH_SHOP, // 删除分店的权限
            CONSTANTS.AH_LOOK_BRANCH_SHOP, // 查看分店的权限
            // 设置
            CONSTANTS.AH_MODIFY_SETTING, // 修改设置的权限
            // 物流公司
            CONSTANTS.AH_LOOK_SHIPPER, // 查看物流公司
            // 收货点
            CONSTANTS.AH_CREATE_AGENT, // 创建收货点的权限
            CONSTANTS.AH_MODIFY_AGENT, // 修改收货点的权限
            CONSTANTS.AH_REMOVE_AGENT, // 删除收货点的权限
            CONSTANTS.AH_LOOK_AGENT, // 查看收货点的权限
            // 公共权限
            CONSTANTS.AH_MODIFY_OWN_SHOP, // 修改所在总部信息的权限
            // 成员
            CONSTANTS.AH_CREATE_MEMBER, // 创建成员的权限
            CONSTANTS.AH_MODIFY_MEMBER, // 修改成员信息的权限
            CONSTANTS.AH_REMOVE_MEMBER, // 删除成员的权限
            CONSTANTS.AH_LOOK_MEMBER, // 查看成员的权限
            // 提现，余额
            CONSTANTS.AH_WITHDRAW, // 提现的权限
            CONSTANTS.AH_LOOK_AMOUNT, // 查看余额的权限
            CONSTANTS.AH_MODIFY_ROADMAP_PROFIT, // 修改路线的提成
            // 统计
            CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
            CONSTANTS.AH_LOOK_ORDERS, // 查看综合货单的权限
        ],
    });

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/authority/resetPartmentChargeManAuthority.js

```js
import { ShopMemberModel, ShopPartmentModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    const authorities = {
        [CONSTANTS.SP_RECEIVE_PARTMENT]: [CONSTANTS.AH_RECEIVE_PARTMENT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW, CONSTANTS.AH_LOOK_AMOUNT],
        [CONSTANTS.SP_WARE_HOUSE_PARTMENT]: [CONSTANTS.AH_WARE_HOUSE_PARTMENT],
        [CONSTANTS.SP_CARRY_PARTMENT]: [CONSTANTS.AH_CARRY_PARTMENT, CONSTANTS.AH_WITHDRAW, CONSTANTS.AH_LOOK_AMOUNT],
        [CONSTANTS.SP_SECURITY_CHECK_PARTMENT]: [CONSTANTS.AH_SECURITY_CHECK_PARTMENT],
    };
    const partments = await ShopPartmentModel.find();
    for (const partment of partments) {
        await ShopMemberModel.findByIdAndUpdate(partment.chargeManId, {
            authority: [
                ...(authorities[partment.type] || []), // 部门的权限
                // 部门
                CONSTANTS.AH_MODIFY_OWN_PARTMENT, // 修改所在部门信息的权限
                // 成员
                CONSTANTS.AH_CREATE_MEMBER, // 创建成员的权限
                CONSTANTS.AH_MODIFY_MEMBER, // 修改成员信息的权限
                CONSTANTS.AH_REMOVE_MEMBER, // 删除成员的权限
                CONSTANTS.AH_LOOK_MEMBER, // 查看成员的权限
                // 统计
                CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
            ],
        });
    }
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/authority/resetShipperChairManAuthority.js

```js
import { ClientModel, ShipperModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    const shippers = await ShipperModel.find();
    for (const shipper of shippers) {
        const shipperType = shipper.shipperType;
        const commonAuthority = [
            CONSTANTS.AH_MODIFY_SHIPPER_INFO, // 修改物流公司信息的权限
            CONSTANTS.AH_MODIFY_SHIPPER_MEMBER_AUTHORITY, // 修改物流公司成员权限的权限

            // 充值，提现，余额
            CONSTANTS.AH_RECHARGE, // 充值的权限
            CONSTANTS.AH_WITHDRAW, // 提现的权限
            CONSTANTS.AH_LOOK_AMOUNT, // 查看余额的权限
            // 统计
            CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
            CONSTANTS.AH_LOOK_ORDERS, // 查看综合货单的权限
        ];

        await ClientModel.findByIdAndUpdate(shipper.chairManId, {
            authority: shipperType === CONSTANTS.ST_LONG ? [
                ...commonAuthority,
                // 路线
                CONSTANTS.AH_CREATE_ROADMAP, // 创建路线的权限
                CONSTANTS.AH_MODIFY_ROADMAP, // 修改路线的权限
                CONSTANTS.AH_REMOVE_ROADMAP, // 删除路线的权限
                CONSTANTS.AH_LOOK_ROADMAP, // 查看路线的权限
                // 货车
                CONSTANTS.AH_CREATE_TRUCK, // 创建货车的权限
                CONSTANTS.AH_MODIFY_TRUCK, // 修改货车的权限
                CONSTANTS.AH_REMOVE_TRUCK, // 删除货车的权限
                CONSTANTS.AH_LOOK_TRUCK, // 查看货车的权限
                // 装车
                CONSTANTS.SELECT_CARRY_PARTMENT, // 选择搬运队的权限
                CONSTANTS.AH_SCAN_LOAD_TRUCK, // 扫描装车的权限
            ] : [
                ...commonAuthority,
                // 同城配送路线
                CONSTANTS.AH_CREATE_SEND_DOOR_ROADMAP, // 创建同城配送路线的权限
                CONSTANTS.AH_MODIFY_SEND_DOOR_ROADMAP, // 修改同城配送路线的权限
                CONSTANTS.AH_REMOVE_SEND_DOOR_ROADMAP, // 删除同城配送路线的权限
                CONSTANTS.AH_LOOK_SEND_DOOR_ROADMAP, // 查看同城配送路线的权限
                // 同城配送
                CONSTANTS.AH_CITY_DISTRIBUTE, // 同城配送的权限
            ],
        });
    }
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/feedback/acceptDeelFeedback.js

```js
import { FeedbackModel } from '../../../../models';

export default async ({
    userId,
    feedbackId,
}) => {
    await FeedbackModel.findByIdAndUpdate(feedbackId, { state: 1, finishTime: Date.now() });
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/feedback/finishDeelFeedback.js

```js
import { FeedbackModel } from '../../../../models';

export default async ({
    userId,
    feedbackId,
    reply,
}) => {
    await FeedbackModel.findByIdAndUpdate(feedbackId, { state: 2, acceptTime: Date.now() });
    // email reply
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/feedback/getFeedbackList.js

```js
import { FeedbackModel } from '../../../../models';
import _ from 'lodash';

async function getPageData (userId, state, keyword, fromPC, pageNo, pageSize) {
    let criteria = state < 0 ? {} : { state };
    if (keyword) {
        const regex = new RegExp('.*' + (keyword || '') + '.*', 'gim');
        criteria = { ...criteria, content: regex };
    }
    const sortCriteria = state === 1 ? { acceptTime: 'desc' } : state === 2 ? { finishTime: 'desc' } : { submitTime: 'desc' };
    const count = (fromPC && pageNo === 0) ? await FeedbackModel.count(criteria) : undefined;
    const query = FeedbackModel.find(criteria).sort(sortCriteria).skip(pageNo * pageSize).limit(pageSize);
    const list = await query
    .select({
        feedbackId: 1,
        email: 1,
        content: 1,
        state: 1,
        finishTime: 1,
        acceptTime: 1,
        submitTime: 1,
    });
    return {
        count,
        list,
    };
}

const TYPES = ['all', 'untreated', 'processing', 'finish'];
export default async ({ userId, type, keyword, fromPC, pageNo, pageSize }) => {
    const index = _.indexOf(TYPES, type);
    if (index !== -1) {
        return {
            success: true,
            context: {
                [type]: await getPageData(userId, index - 1, keyword, fromPC, pageNo, pageSize),
            },
        };
    } else {
        return {
            success: true,
            context: {
                all: await getPageData(userId, -1, keyword, fromPC, pageNo, pageSize),
                untreated: await getPageData(userId, 0, keyword, fromPC, pageNo, pageSize),
                processing: await getPageData(userId, 1, keyword, fromPC, pageNo, pageSize),
                finish: await getPageData(userId, 2, keyword, fromPC, pageNo, pageSize),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/admin/personal/findPassword.js

```js
import { AdminModel } from '../../../../models';
import { setPassword, genRandomPassword, sendFindPasswordMail } from '../../../../utils';

export default async ({ phone, email }) => {
    const user = await AdminModel.findOne({ phone });
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    if (user.email !== email) {
        return { msg: '邮箱和注册的时候的邮箱不一致' };
    }
    let newPassword = genRandomPassword();
    let ret = await sendFindPasswordMail(email, newPassword);
    if (!ret) {
        return { msg: '发送邮件失败' };
    }
    const error = await setPassword(user, newPassword);
    if (error) {
        return { msg: '服务器错误' };
    }
    await user.save();
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/personal/login.js

```js
import { AdminModel } from '../../../../models';
import { authenticatePassword } from '../../../../utils';

export default async ({ phone, password }) => {
    const user = await AdminModel.findOne({ phone });
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    const error = await authenticatePassword(user, password);
    if (error) {
        return { msg: '密码错误' };
    } else {
        return { success: true, context: { userId: user.id } };
    }
};

```

* PDShopServer/project/App/routers/posts/admin/personal/modifyPassword.js

```js
import { AdminModel } from '../../../../models';
import { setPassword, authenticatePassword } from '../../../../utils';

export default async ({ userId, oldPassword, newPassword }) => {
    const user = await AdminModel.findById(userId);
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    let error = await authenticatePassword(user, oldPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    error = await setPassword(user, newPassword);
    if (error) {
        return { msg: '设置密码失败' };
    }
    await user.save();
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/personal/register.js

```js
import { AdminModel } from '../../../../models';
import { registerUser } from '../../../../utils';

export default async ({ phone, password, email }) => {
    const user = new AdminModel({
        phone,
        email,
    });
    const error = await registerUser(AdminModel, user, password);
    if (!error) {
        return { success: true };
    } else if (error === 'UserExistsError') {
        return { msg: '该账号已经被占用' };
    } else {
        return { msg: '注册失败' };
    }
};

```

* PDShopServer/project/App/routers/posts/admin/personal/removeUnusedMedia.js

```js
import mongoose from 'mongoose';
import { MediaModel } from '../../../../models';

export default async ({
    userId,
}) => {
    const docs = await MediaModel.find({ ref: 0 });
    docs.forEach(doc => {
        mongoose.gfs.remove({ _id: doc.gridId });
        doc.remove();
    });
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/shop/createMasterShop.js

```js
import { ShopMemberModel, ShopModel, SettingModel, RoadmapRegionProfitRateModel, MediaModel } from '../../../../models';
import { sequelize, AccountModel } from '../../../../mysql';
import { settingMgr } from '../../../../manager';
import { _T, getMediaId, registerUser, getDefaultPassWord, checkAuthorizationCode } from '../../../../utils';
import CONSTANTS from '../../../../constants';

// 创建基础账号（银行对应账户/安全账户/总部账户）
function createBasicAccount (masterShopId) {
    return new Promise(async resolve => {
        sequelize.transaction(async (transaction) => {
            await AccountModel.create({ targetId: masterShopId, type: CONSTANTS.AT_BASIC }, { transaction });
            await AccountModel.create({ targetId: masterShopId, type: CONSTANTS.AT_BASIC }, { transaction });
            await AccountModel.create({ targetId: masterShopId, type: CONSTANTS.AT_BASIC }, { transaction });
        }).then((result) => {
            return resolve(true);
        }).catch(err => {
            return resolve(false);
        });
    });
}

export default async ({
    userId,
    authorizationCode,
    chairManPhone,  // 总部董事长登录电话
    chairManName,  // 总部董事长姓名
    chairManPassword, // 分店董事长登录密码（不传入该参数，默认为手机号码后6位）
    name, // 总部名称
    image, // 总部背景图片
    sign, // 总部签名
    phoneList, // 总部联系电话
    address, // 总部地址
    location, // 经纬度定位
}) => { // 创建一个全局配置
    if (authorizationCode) {
        if (!checkAuthorizationCode(authorizationCode)) {
            return { msg: '没有权限' };
        }
    }
    const masterShop = await ShopModel.findOne({ isMasterShop: true });
    if (masterShop) {
        return { msg: '总部已经存在' };
    }

    // 注册董事长账号
    const chairMan = new ShopMemberModel({
        phone: chairManPhone,
        name: chairManName,
        post: CONSTANTS.PO_CHAIR_MAN,
        authority: [
            // 分店
            CONSTANTS.AH_CREATE_BRANCH_SHOP, // 创建分店的权限
            CONSTANTS.AH_MODIFY_BRANCH_SHOP, // 修改分店的权限
            CONSTANTS.AH_REMOVE_BRANCH_SHOP, // 删除分店的权限
            CONSTANTS.AH_LOOK_BRANCH_SHOP, // 查看分店的权限
            // 设置
            CONSTANTS.AH_MODIFY_SETTING, // 修改设置的权限
            // 物流公司
            CONSTANTS.AH_LOOK_SHIPPER, // 查看物流公司
            // 收货点
            CONSTANTS.AH_CREATE_AGENT, // 创建收货点的权限
            CONSTANTS.AH_MODIFY_AGENT, // 修改收货点的权限
            CONSTANTS.AH_REMOVE_AGENT, // 删除收货点的权限
            CONSTANTS.AH_LOOK_AGENT, // 查看收货点的权限
            // 公共权限
            CONSTANTS.AH_MODIFY_OWN_SHOP, // 修改所在总部信息的权限
            // 成员
            CONSTANTS.AH_CREATE_MEMBER, // 创建成员的权限
            CONSTANTS.AH_MODIFY_MEMBER, // 修改成员信息的权限
            CONSTANTS.AH_REMOVE_MEMBER, // 删除成员的权限
            CONSTANTS.AH_LOOK_MEMBER, // 查看成员的权限
            // 提现，余额
            CONSTANTS.AH_WITHDRAW, // 提现的权限
            CONSTANTS.AH_LOOK_AMOUNT, // 查看余额的权限
            CONSTANTS.AH_MODIFY_ROADMAP_PROFIT, // 修改路线的提成
            // 统计
            CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
            CONSTANTS.AH_LOOK_ORDERS, // 查看综合货单的权限
        ],
    });

    // 创建总部
    let _image = getMediaId(image);
    const shop = new ShopModel({
        chairManId: chairMan.id,
        isMasterShop: true,
        name,
        image: _image,
        sign,
        phoneList,
        address,
        location,
    });
    chairMan.shopId = shop.id;

    // 保存
    const error = await registerUser(ShopMemberModel, chairMan, getDefaultPassWord(chairManPhone, chairManPassword));
    if (error === 'UserExistsError') {
        return { msg: '董事长账号已经被占用' };
    } else if (error) {
        return { msg: '董事长账号注册失败' };
    }

    // 创建总部账号
    const success = await createBasicAccount(_T(shop.id));
    if (!success) {
        return { msg: '创建总部账号失败' };
    }
    await shop.save();

    // 创建一个全局配置
    const setting = new SettingModel({
        gradientPriceList: [{ min: 0, rate: 3 }, { min: 0.1, rate: 2 }, { min: 0.3, rate: 1.5 }, { min: 0.8, rate: 1 }, { min: 3, rate: 0.95 }, { min: 8, rate: 0.9 }],
        rankedMaskRateList: [ 1 ],
    });
    await setting.save();
    settingMgr.set(setting);

    // 创建路线提成的所有分店和所有方向
    const regionProfit = new RoadmapRegionProfitRateModel({ profitRate: 0.2, level: 1 });
    await regionProfit.save();

    MediaModel._updateRef(
        { [_image]: 1 },
    );
    return { success: true, context: shop };
};

```

* PDShopServer/project/App/routers/posts/admin/version/addVersion.js

```js
import { VersionModel } from '../../../../models';

export default async ({
    platform,
    versionName,
    minVersion,
    versionCode,
    passed,
    description,
}) => {
    const version = new VersionModel({
        platform,
        versionName,
        minVersion,
        versionCode,
        passed,
        description,
    });
    const doc = await version.save();
    if (!doc) {
        return { msg: '发布失败' };
    }

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/admin/version/getVersionList.js

```js
import { VersionModel } from '../../../../models';
import _ from 'lodash';

async function getPageData (userId, platform, fromPC, pageNo, pageSize) {
    const criteria = { platform };
    const count = (fromPC && pageNo === 0) ? await VersionModel.count(criteria) : undefined;
    const query = VersionModel.find(criteria).sort({ time: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const list = await query
    .select({
        verName: 1,
        versionName: 1,
        versionCode: 1,
        minVersion: 1,
        passed: 1,
        description: 1,
        time: 1,
    });
    return {
        count,
        list,
    };
}

const PLATFORMS = ['android', 'ios'];
export default async ({ userId, platform, fromPC, pageNo, pageSize }) => {
    if (_.includes(PLATFORMS, platform)) {
        return {
            success: true,
            context: {
                [platform]: await getPageData(userId, platform, fromPC, pageNo, pageSize),
            },
        };
    } else {
        return {
            success: true,
            context: {
                android: await getPageData(userId, 'android', fromPC, pageNo, pageSize),
                ios: await getPageData(userId, 'ios', fromPC, pageNo, pageSize),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/admin/test/test.js

```js
import _ from 'lodash';

export default async ({ address, oldAddress }, req) => {
    return { success: true, context: req.get('X-Real-IP') || req.get('X-Forwarded-For') || req.ip };
};

```

* PDShopServer/project/App/routers/posts/agent/member/getMemberByPhone.js

```js
import { ClientModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    memberPhone,
}) => {
    const member = await ClientModel.findById(userId);
    const client = await ClientModel.findOne({ phone: memberPhone });
    if (!client || !client.registerTime) {
        return { msg: '没有该用户' };
    }
    if (client.shipperId) {
        return { msg: '该用户已经是物流公司的成员' };
    }
    if (client.agentId) {
        if (_T(member.agentId) === _T(client.agentId)) {
            return { msg: '该用户已经是收货点成员，无需再添加' };
        } else if (_T(client.agentId) !== _T(member.agentId)) {
            return { msg: '该用户已经是其他收货点的成员' };
        }
    }

    const clientAccount = await AccountModel.findOne({ where: { targetId: client.id, type: CONSTANTS.AT_CLIENT } });
    if (clientAccount && clientAccount.amount > 0) {
        return { msg: '请通知该用户先将其账户中的余额提现后再加入收货点' };
    }

    return { success: true, context: client };
};

```

* PDShopServer/project/App/routers/posts/agent/member/getMemberDetail.js

```js
import { ClientModel } from '../../../../models';

export default async ({
    userId,
    memberId,
}) => {
    const member = await ClientModel.findById(memberId);
    return { success: true, context: member };
};

```

* PDShopServer/project/App/routers/posts/agent/member/getMemberList.js

```js
import { ClientModel } from '../../../../models';

export default async ({
    userId,
}) => {
    const member = await ClientModel.findById(userId);
    if (!member || !member.agentId) {
        return { msg: '你不是收货点成员' };
    }
    const docs = await ClientModel.find({ agentId: member.agentId }).sort({ registerTime: 'asc' });

    return { success: true, context: { memberList: docs } };
};

```

* PDShopServer/project/App/routers/posts/agent/member/modifyMemberAuthority.js

```js
import { ClientModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    memberId,
    authority,
}) => {
    if (authority) {
        authority = _.sortBy(_.uniq(authority));
    }
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_AGENT_MEMBER_AUTHORITY)) {
        return { msg: '你没有修改成员的权限' };
    }
    const client = await ClientModel.findById(memberId);
    if (!client || !client.registerTime) {
        return { msg: '没有该用户' };
    }
    if (client.shipperId) {
        return { msg: '该用户是物流公司的成员，你不能修改他的权限' };
    }
    if (client.agentId && _T(client.agentId) !== _T(member.agentId)) {
        return { msg: '该用户是其他收货点的成员，你不能修改他的权限' };
    }
    const clientAccount = await AccountModel.findOne({ where: { targetId: memberId, type: CONSTANTS.AT_CLIENT } });
    if (clientAccount && clientAccount.amount > 0) {
        return { msg: '请通知该用户先将其账户中的余额提现后再加入收货点' };
    }
    // 删除权限
    if (!authority || !authority.length) {
        await client.update({ $unset: { agentId: 1 }, authority: [] });
    } else {
        await client.update({ authority, agentId: member.agentId });
    }

    actionLog(userId, 'Client', memberId, 'Client', 'modifyMemberAuthority');
    const context = client.toObject();
    context.authority = authority || [];
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/order/confirmCachPayed.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId, // 收货点收货员
    orderId,
}) => {
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_PLACE_ORDER)) {
        return { msg: '权限不足' };
    }
    const order = await OrderModel.findByIdAndUpdate(orderId, { 'stateList.0.state': CONSTANTS.OS_READY_PRINT_ORDER, modifyTime: Date.now() }, { new: true });
    if (!order) {
        return { msg: '没有该货单' };
    }
    let context = order.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'Client', orderId, 'Order', 'confirmCachPayed');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/order/confirmCachPayedForOrderList.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderIdList,
}) => {
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_PLACE_ORDER)) {
        return { msg: '权限不足' };
    }

    await OrderModel.update({ _id: { $in: orderIdList } }, { 'stateList.0.state': CONSTANTS.OS_READY_PRINT_ORDER, modifyTime: Date.now() }, { multi: true });

    actionLogWithList(userId, 'Client', orderIdList.map(o => ({ id: o, model: 'Order' })), 'confirmCachPayedForOrderList');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/agent/order/getLastestOrder.js

```js
import { OrderModel } from '../../../../models';
import { getAgentLatestOrder } from '../../libs/order';

export default async ({ userId }) => {
    let order = await getAgentLatestOrder(userId);
    if (!order) {
        return { msg: '暂无货单' };
    }

    order = await OrderModel.findById(order.id)
    .populate({
        path: 'agentId',
        select: { name: 1, address: 1 },
    });

    const context = order.toObject();
    context.state = context.stateList[0].state;
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/order/getOrderDetail.js

```js
import { OrderModel } from '../../../../models';

export default async ({ userId, orderId }) => {
    const order = await OrderModel.findById(orderId)
    .populate({
        path: 'agentId',
        select: { name: 1, address: 1 },
    });
    if (!order) {
        return { msg: '没有该货单' };
    }

    const context = order.toObject();
    context.state = context.stateList[0].state;
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/order/getOrders.js

```js
import _ from 'lodash';
import { OrderModel } from '../../../../models';
import { getKeywordCriteriaForOrder } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getPageData (userId, type, params) {
    let { keyword, startDate, endDate, fromPC, pageNo, pageSize } = params;
    let criteria = {};
    if (type === 'topay') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_PAYMENT };
    } else if (type === 'toprintbill') {
        criteria = { 'stateList.state': { $in: [ CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER, CONSTANTS.OS_READY_PRINT_ORDER ] } };
    } else if (type === 'tosend') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_SEND };
    } else if (type === 'onway') {
        criteria = { 'stateList.state': { $gte: CONSTANTS.OS_ON_TRANSFER } };
    } else if (type === 'success') {
        criteria = { 'stateList.state': { $gte: CONSTANTS.OS_RECEIVE_SUCCESS } };
    }
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }
    criteria = getKeywordCriteriaForOrder(keyword, { ...criteria, receiveAgentMemberId: userId });
    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        senderName: 1,
        senderPhone: 1,
        receiverName: 1,
        receiverPhone: 1,
        name: 1,
        photo: 1,
        shopId: 1,
        agentId: 1,
        shipperId: 1,
        isCityDistribute: 1,
        endPoint: 1,
        sendDoorEndPoint: 1,
        isSendDoor: 1,
        createTime: 1,
        placeOrderTime: 1,
        modifyTime: 1,
        payMode: 1,
        receiveAgentMemberId: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
        totalDesignatedFee: 1,
        proxyCharge: 1,
        deductError: 1,
    }).populate({
        path: 'receiveAgentMemberId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperId',
        select: { name: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    }).populate({
        path: 'agentId',
        select: { name: 1, address: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['待支付', '待打印货单', '待发货', '运输中', '已完成']
const TYPES = ['topay', 'toprintbill', 'tosend', 'onway', 'success'];
export default async ({ userId, type, ...params }) => {
    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(userId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                topay: await getPageData(userId, 'topay', params),
                toprintbill: await getPageData(userId, 'toprintbill', params),
                tosend: await getPageData(userId, 'tosend', params),
                onway: await getPageData(userId, 'onway', params),
                success: await getPageData(userId, 'success', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/agent/order/getPreOrderList.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { getKeywordCriteriaForOrder } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, senderPhone, keyword, fromPC, pageNo, pageSize }) => {
    const client = await ClientModel.findOne({ phone: senderPhone });
    if (!client) {
        return { msg: '没有该用户' };
    }
    const criteria = getKeywordCriteriaForOrder(keyword, { senderId: client.id, 'stateList.state': CONSTANTS.OS_PREORDER });

    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const docs = await OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);

    return { success: true, context: {
        count,
        orderList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/agent/order/getRegionAddressWithOrder.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { getAgentLatestOrder } from '../../libs/order';
import { getEndPointFromLastCode, getSendDoorAddressFromLastCode } from '../../libs/address';

export default async ({
    userId,
    orderId,
}) => {
    const member = await ClientModel.findById(userId).populate({ path: 'agentId', select: { addressRegionLastCode: 1, referShopId: 1 } });
    const { addressRegionLastCode, referShopId } = (member || {}).agent || {};

    let order;
    if (orderId) {
        order = await OrderModel.findById(orderId);
    } else {
        order = await getAgentLatestOrder(userId);
    }

    let addressList = [];
    let cityAddressList = [];

    if (order) {
        if (!order.isCityDistribute) {
            addressList = await getEndPointFromLastCode(referShopId, order.endPointLastCode);
            cityAddressList = await getSendDoorAddressFromLastCode(0, addressRegionLastCode);
        } else {
            addressList = await getEndPointFromLastCode(referShopId, 0);
            cityAddressList = await getSendDoorAddressFromLastCode(order.endPointLastCode);
        }
    } else {
        addressList = await getEndPointFromLastCode(referShopId, 0);
        cityAddressList = await getSendDoorAddressFromLastCode(0, addressRegionLastCode);
    }

    return { success: true, context: {
        addressList,
        cityAddressList,
    } };
};

```

* PDShopServer/project/App/routers/posts/agent/order/getRegionSendDoorAddressWithOrder.js

```js
import { OrderModel } from '../../../../models';
import { getAgentLatestOrder } from '../../libs/order';
import { getSendDoorAddressFromLastCode } from '../../libs/address';

export default async ({
    userId,
    orderId,
}) => {
    let order;
    if (orderId) {
        order = await OrderModel.findById(orderId);
    } else {
        order = await getAgentLatestOrder(userId);
    }

    const addressList = await getSendDoorAddressFromLastCode((order || {}).sendDoorEndPointLastCode);

    return { success: true, context: {
        addressList,
    } };
};

```

* PDShopServer/project/App/routers/posts/agent/order/modifyOrder.js

```js
import { OrderModel, ClientModel, MediaModel } from '../../../../models';
import { _T, hasAuthority, actionLog, omitNil, getMediaId } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { setting } from '../../../../manager';
import { setAgentOrderFee } from '../../libs/order';

export default async ({
    userId, // 收货部收货员
    orderId,
    senderPhone,
    senderName,
    receiverPhone,
    receiverName,
    name,
    photo,
    isCityDistribute, // 是否是同城配送
    endPoint, // 终点，精确到镇级别
    endPointLastCode, // 终点镇级代码
    sendDoorEndPoint, // 送货上门地址，精确到镇级别
    sendDoorEndPointLastCode, // 送货上门地址镇级代码
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, // 一票货总的方量
    isSendDoor, // 是否送货上门
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee, // 指定向收货人应该收多少钱
    proxyCharge, // 代收货款金额
    isInsuance, //是否保价
}) => {
    const member = await ClientModel.findById(userId)
    .populate({
        path: 'agentId',
        select: { referShopId: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_PLACE_ORDER) || !member.agent.referShopId) {
        return { msg: '你没有收货的权限' };
    }

    let senderId, sender;
    if (senderPhone) {
        senderId = await ClientModel.checkExistElseCreate(senderPhone);
        if (!senderId) {
            return { msg: '系统创建账号错误，请重试' };
        }
        sender = await ClientModel.findById(senderId)
        .populate({
            path: 'shipperId',
            select: { chairManId: 1 },
        });
    }
    let receiverId;
    if (receiverPhone) {
        receiverId = await ClientModel.checkExistElseCreate(receiverPhone);
        if (!receiverId) {
            return { msg: '系统创建账号错误，请重试' };
        }
    }

    const order = await OrderModel.findById(orderId);
    if (!order) {
        return { msg: '没有该货单' };
    }
    const state = order.stateList[0].state;
    if (state >= CONSTANTS.OS_READY_PRINT_ORDER) {
        return { msg: '该货单不能被修改' };
    }
    const _photo = getMediaId(photo);
    const __photo = order.photo;
    await order.update(omitNil({
        senderId,
        senderPhone,
        senderName,
        isSenderRepresentShipper: sender && sender.shipperId && _T(sender.shipper.chairManId) === sender.id,
        receiverId,
        receiverPhone,
        receiverName,
        name,
        photo: _photo,
        isCityDistribute,
        endPoint,
        endPointLastCode,
        sendDoorEndPoint,
        sendDoorEndPointLastCode,
        totalNumbers,
        weight,
        size,
        isSendDoor,
        proxyCharge,
        proxyChargeProfit: proxyCharge !== undefined ? Math.ceil(proxyCharge * setting.proxyChargeProfitRate) : undefined,
        isReachPay,
        payMode: isReachPay !== undefined ? (isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE) : undefined,
        totalDesignatedFee,
        isInsuance,
        'stateList.0.count': totalNumbers || order.totalNumbers,
        modifyTime: Date.now(),
        deductError: false,
    }));

    let context = await OrderModel.findById(orderId);
    const error = await setAgentOrderFee(member.agent.referShopId, context);
    if (error) {
        context.deductError = true;
    } else if (context.stateList[0].state !== CONSTANTS.OS_READY_PRINT_BAR_CODE) {
        if (context.needPayTransportFee + context.needPayInsuanceFee) { // 需要交费的情况进入待支付状态，否则到付的情况下进入待入库状态，并且划账对接
            context.stateList = [ { state: CONSTANTS.OS_READY_PAYMENT, count: context.totalNumbers } ];
        } else {
            context.stateList = [ { state: CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER, count: context.totalNumbers } ];
        }
    }
    await context.save();

    MediaModel._updateRef(
        { [_photo]: 1 },
        { [photo && __photo]: -1 },
    );
    context = context.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'Client', orderId, 'Order', 'modifyOrder');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/order/placeOrder.js

```js
import { OrderModel, ClientModel, MediaModel } from '../../../../models';
import { _T, hasAuthority, actionLog, getMediaId } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { setting } from '../../../../manager';
import { setAgentOrderFee } from '../../libs/order';

export default async ({
    userId, // 收货点下单人员
    senderPhone,
    senderName,
    receiverPhone,
    receiverName,
    name,
    photo,
    isCityDistribute, // 是否是同城配送
    endPoint, // 终点，精确到镇级别
    endPointLastCode = 0, // 终点镇级代码
    sendDoorEndPoint, // 送货上门地址，精确到镇级别
    sendDoorEndPointLastCode = 0, // 送货上门地址镇级代码
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, // 一票货总的方量
    isSendDoor, // 是否送货上门
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee = 0, // 指定向收货人应该收多少钱
    proxyCharge = 0, // 代收货款金额
    isInsuance, //是否保价
}) => {
    const member = await ClientModel.findById(userId)
    .populate({
        path: 'agentId',
        select: { referShopId: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_PLACE_ORDER) || !member.agent.referShopId) {
        return { msg: '你没有收货的权限' };
    }

    // 如果没有发送者或者接收者，就创建一个
    const senderId = await ClientModel.checkExistElseCreate(senderPhone);
    const receiverId = await ClientModel.checkExistElseCreate(receiverPhone);
    if (!senderId || !receiverId) {
        return { msg: '系统创建账号错误，请重试' };
    }

    const sender = await ClientModel.findById(senderId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    });

    const _photo = getMediaId(photo);
    const order = new OrderModel({
        agentId: member.agent.id,
        photo: _photo,
        senderId,
        senderName,
        senderPhone,
        isSenderRepresentShipper: sender.shipperId && _T(sender.shipper.chairManId) === _T(sender.id),
        receiverId,
        receiverPhone,
        receiverName,
        name,
        isCityDistribute,
        endPoint,
        endPointLastCode,
        sendDoorEndPoint,
        sendDoorEndPointLastCode,
        receiveAgentMemberId: userId,
        totalNumbers,
        weight,
        size,
        isSendDoor,
        proxyCharge: Math.floor(proxyCharge),
        proxyChargeProfit: Math.floor(proxyCharge * setting.proxyChargeProfitRate),
        isReachPay,
        payMode: isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE,
        totalDesignatedFee: Math.floor(totalDesignatedFee),
        isInsuance,
        stateList: [ { state: CONSTANTS.OS_READY_PRINT_BAR_CODE, count: totalNumbers } ],
        placeOrderTime: Date.now(),
    });

    const error = await setAgentOrderFee(member.agent.referShopId, order);
    if (error) {
        order.deductError = true;
    }
    await order.save();

    MediaModel._updateRef(
        { [_photo]: 1 },
    );
    const context = order.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'Client', order.id, 'Order', 'placeOrder');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/order/placeOrderWithPreOrder.js

```js
import { OrderModel, ClientModel, OrderGroupModel } from '../../../../models';
import { _T, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { setAgentOrderFee } from '../../libs/order';
import { setting } from '../../../../manager';

export default async ({
    userId, // 收货点下单人员
    preOrderId, // 预下单的货单号
    senderPhone,
    senderName,
    receiverPhone,
    receiverName,
    name,
    isCityDistribute, // 是否是同城配送
    endPoint, // 终点，精确到镇级别
    endPointLastCode = 0, // 终点镇级代码
    sendDoorEndPoint, // 送货上门地址，精确到镇级别
    sendDoorEndPointLastCode = 0, // 送货上门地址镇级代码
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, // 一票货总的方量
    isSendDoor, // 是否送货上门
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee = 0, // 指定向收货人应该收多少钱
    proxyCharge = 0, // 代收货款金额
    isInsuance, //是否保价
}) => {
    const member = await ClientModel.findById(userId)
    .populate({
        path: 'agentId',
        select: { referShopId: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_PLACE_ORDER) || !member.agent.referShopId) {
        return { msg: '你没有收货的权限' };
    }

    // 如果没有发送者或者接收者，就创建一个
    const senderId = await ClientModel.checkExistElseCreate(senderPhone);
    const receiverId = await ClientModel.checkExistElseCreate(receiverPhone);
    if (!senderId || !receiverId) {
        return { msg: '系统创建账号错误，请重试' };
    }

    const sender = await ClientModel.findById(senderId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    });

    const order = await OrderModel.findByIdAndUpdate(preOrderId, {
        agentId: member.agent.id,
        senderId,
        senderName,
        senderPhone,
        isSenderRepresentShipper: sender.shipperId && _T(sender.shipper.chairManId) === _T(sender.id),
        receiverId,
        receiverPhone,
        receiverName,
        name,
        isCityDistribute,
        endPoint,
        endPointLastCode,
        sendDoorEndPoint,
        sendDoorEndPointLastCode,
        receiveAgentMemberId: userId,
        totalNumbers,
        weight,
        size,
        isSendDoor,
        proxyCharge: Math.floor(proxyCharge),
        proxyChargeProfit: Math.floor(proxyCharge * setting.proxyChargeProfitRate),
        isReachPay,
        payMode: isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE,
        totalDesignatedFee: Math.floor(totalDesignatedFee),
        isInsuance,
        stateList: [ { state: CONSTANTS.OS_READY_PRINT_BAR_CODE, count: totalNumbers } ],
        placeOrderTime: Date.now(),
        $unset: { groupId: 1 },
    });
    const error = await setAgentOrderFee(member.agent.referShopId, order);
    if (error) {
        order.deductError = true;
    }
    await order.save();

    const group = await OrderGroupModel.findByIdAndUpdate(order.groupId, { $inc: {
        totalNumbers: -totalNumbers,
        totalWeight: -weight,
        totalSize: -size,
        orderCount: -1,
    }, $pull: { orderIdList: preOrderId } }, { new: true });
    if (group && !group.orderIdList.length) {
        await group.remove();
    }

    actionLog(userId, 'Client', preOrderId, 'Order', 'placeOrderWithPreOrder');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/agent/order/printBarCode.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId, // 收货点下单人员
    orderId,
}) => {
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_PLACE_ORDER)) {
        return { msg: '你没有收货的权限' };
    }
    const order = await OrderModel.findById(orderId);
    if (!order) {
        return { msg: '没有该货单' };
    }
    // if (!order.photo) {
    //     return { msg: '请先拍照上传图片' };
    // }

    if (order.needPayTransportFee + order.needPayInsuanceFee) { // 需要交费的情况进入待支付状态，否则到付的情况下进入待入库状态，并且划账对接
        order.stateList = [ { state: CONSTANTS.OS_READY_PAYMENT, count: order.totalNumbers } ];
    } else {
        order.stateList = [ { state: CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER, count: order.totalNumbers } ];
    }
    await order.save();

    let context = order.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'Client', orderId, 'Order', 'printBarCode');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/order/printOrderBill.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId, // 收货点收货员
    orderId,
}) => {
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_PLACE_ORDER)) {
        return { msg: '权限不足' };
    }
    const order = await OrderModel.findByIdAndUpdate(orderId, { 'stateList.0.state': CONSTANTS.OS_READY_SEND, modifyTime: Date.now() }, { new: true });
    if (!order) {
        return { msg: '没有该货单' };
    }
    let context = order.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'Client', orderId, 'Order', 'printOrderBill');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/order/printOrderListBill.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderIdList,
}) => {
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_PLACE_ORDER)) {
        return { msg: '权限不足' };
    }

    await OrderModel.update({ _id: { $in: orderIdList } }, { 'stateList.0.state': CONSTANTS.OS_READY_SEND, modifyTime: Date.now() }, { multi: true });

    actionLogWithList(userId, 'Client', orderIdList.map(o => ({ id: o, model: 'Order' })), 'printOrderListBill');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/agent/order/removeOrder.js

```js
import { OrderModel, ClientModel, MediaModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderId,
}) => {
    const client = await ClientModel.findById(userId);
    if (!hasAuthority(client, CONSTANTS.AH_PLACE_ORDER)) {
        return { msg: '你没有删除货单的权限' };
    }
    const order = await OrderModel.findByIdAndRemove(orderId);
    if (order && order.photo) {
        MediaModel._updateRef(
            { [ order.photo ]: -1 },
        );
    }

    actionLog(userId, 'Client', orderId, 'Order', 'removeOrder');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/agent/referShop/getReferShopList.js

```js
import { ShopModel } from '../../../../models';

export default async ({ userId }) => {
    const query = ShopModel.find({ isMasterShop: false }).sort({ createTime: 'desc' });
    const docs = await query
    .select({
        name: 1,
        addressRegion: 1,
        addressRegionLastCode: 1,
        address: 1,
        location: 1,
        profitRate: 1,
        phoneList: 1,
        chairManId: 1,
    })
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });

    return { success: true, context: {
        branchShopList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/agent/referShop/setReferShop.js

```js
import { ClientModel, AgentModel, AgentRegionProfitModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    shopId,
}) => {
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_AGENT_INFO)) {
        return { msg: '你没有修改指定收货点信息的权限' };
    }
    const doc = await AgentModel.findByIdAndUpdate(member.agentId, { referShopId: shopId });
    if (!doc) {
        return { msg: '修改失败' };
    }

    let agentRegion = await AgentRegionProfitModel.findOne({ agentId: member.agentId, shopId, regionLastCode: 0 });
    if (!agentRegion) {
        agentRegion = new AgentRegionProfitModel({ agentId: member.agentId, shopId, profitRate: 0.2, level: 1 });
        await agentRegion.save();
    }

    actionLog(userId, 'Client', shopId, 'Shop', 'setReferShop');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/client/getClientList.js

```js
import { ClientModel } from '../../../../models';
import { getKeywordCriteriaForUser } from '../../../../utils';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    const criteria = getKeywordCriteriaForUser(keyword);
    const query = ClientModel.find(criteria).sort({ modifyTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        phone: 1,
        name: 1,
        email: 1,
        head: 1,
        address: 1,
        location: 1,
        phoneList: 1,
    });

    return { success: true, context: {
        clientList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/client/account/getBillList.js

```js
import { ClientModel } from '../../../../models';
import { AccountModel, BillModel } from '../../../../mysql';
import { _T, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    pageNo,
    pageSize,
}) => {
    const client = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    })
    .populate({
        path: 'agentId',
        select: { chairManId: 1 },
    });
    if (!client) {
        return { msg: '没有该账户' };
    }

    let accountId;
    if (!client.shipper && !client.agent) {
        accountId = (await AccountModel.findOne({ where: { targetId: userId, type: CONSTANTS.AT_CLIENT } }) || {}).id;
    } else if (client.shipper && hasAuthority(client, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        accountId = (await AccountModel.findOne({ where: { targetId: _T(client.shipper.chairManId), type: CONSTANTS.AT_CLIENT } }) || {}).id;
    } else if (client.agent && hasAuthority(client, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        accountId = (await AccountModel.findOne({ where: { targetId: _T(client.agent.chairManId), type: CONSTANTS.AT_CLIENT } }) || {}).id;
    }
    if (!accountId) {
        return { msg: '你没有查看账单的权限' };
    }
    const docs = await BillModel.findAndCountAll({
        order: [['tradeTime', 'DESC']],
        where: { account: accountId },
        offset: pageNo * pageSize,
        limit: pageSize,
        attributes: [
            'tradeAmount',
            'thirdpartyAccount',
            'orderId',
            'remark',
            'tradeTime',
        ],
    });
    return { success: true, context: { count: docs.count, billList: docs.rows } };
};

```

* PDShopServer/project/App/routers/posts/client/account/getBills.js

```js
import _ from 'lodash';
import { ClientModel } from '../../../../models';
import { AccountModel, BillModel } from '../../../../mysql';
import { _T, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getPageData (accountId, type, params) {
    let { startDate, endDate, fromPC, pageNo, pageSize } = params;
    let options = (type === 'recharge' || type === 'withdraw') ? { thirdpartyAccount: { $ne: null } } : { thirdpartyAccount: { $eq: null } };
    let options1 = (type === 'recharge' || type === 'income') ? { tradeAmount: { $gt: 0 } } : { tradeAmount: { $lt: 0 } };

    let criteria = {};
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ tradeTime: { $gte: moment(startDate).toDate() } }, { tradeTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ tradeTime: { $gte: moment(startDate).toDate() } }, { tradeTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }

    const docs = await BillModel.findAndCountAll({
        order: [['tradeTime', 'DESC']],
        where: { account: accountId, ...options, ...options1, ...criteria },
        offset: pageNo * pageSize,
        limit: pageSize,
        attributes: [
            'tradeAmount',
            'thirdpartyAccount',
            'orderId',
            'truckId',
            'remark',
            'tradeTime',
        ],
    });

    return {
        count: docs.count,
        list: docs.rows,
    };
};

// ['充值账单', '提现账单', '收入账单', '支出账单']
const TYPES = ['recharge', 'withdraw', 'income', 'pay'];
export default async ({ userId, type, ...params }) => {
    const client = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    })
    .populate({
        path: 'agentId',
        select: { chairManId: 1 },
    });
    if (!client) {
        return { msg: '没有该账户' };
    }

    let accountId;
    if (!client.shipper && !client.agent) {
        accountId = (await AccountModel.findOne({ where: { targetId: userId, type: CONSTANTS.AT_CLIENT } }) || {}).id;
    } else if (client.shipper && hasAuthority(client, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        accountId = (await AccountModel.findOne({ where: { targetId: _T(client.shipper.chairManId), type: CONSTANTS.AT_CLIENT } }) || {}).id;
    } else if (client.agent && hasAuthority(client, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        accountId = (await AccountModel.findOne({ where: { targetId: _T(client.agent.chairManId), type: CONSTANTS.AT_CLIENT } }) || {}).id;
    }
    if (!accountId) {
        return { msg: '你没有查看账单的权限' };
    }

    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(accountId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                recharge: await getPageData(accountId, 'recharge', params),
                withdraw: await getPageData(accountId, 'withdraw', params),
                income: await getPageData(accountId, 'income', params),
                pay: await getPageData(accountId, 'pay', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/client/account/getRemainAmount.js

```js
import { ClientModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T, _Y, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    let amount;
    const client = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    })
    .populate({
        path: 'agentId',
        select: { chairManId: 1 },
    });
    if (!client) {
        return { msg: '没有该账户' };
    }
    if (!client.shipper && !client.agent) {
        const clientAccount = await AccountModel.findOne({ where: { targetId: userId, type: CONSTANTS.AT_CLIENT } });
        if (!clientAccount) {
            return { msg: '没有该账户' };
        }
        amount = _Y(clientAccount.amount);
    } else if (client.shipper && hasAuthority(client, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        const clientAccount = await AccountModel.findOne({ where: { targetId: _T(client.shipper.chairManId), type: CONSTANTS.AT_CLIENT } });
        if (!clientAccount) {
            return { msg: '没有该账户' };
        }
        amount = _Y(clientAccount.amount);
    } else if (client.agent && hasAuthority(client, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        const clientAccount = await AccountModel.findOne({ where: { targetId: _T(client.agent.chairManId), type: CONSTANTS.AT_CLIENT } });
        if (!clientAccount) {
            return { msg: '没有该账户' };
        }
        amount = _Y(clientAccount.amount);
    }
    if (amount === undefined) {
        return { msg: '你没有查看余额的权限' };
    }

    return { success: true, context: { amount } };
};

```

* PDShopServer/project/App/routers/posts/client/account/recharge.js

```js
import { _F, actionLog } from '../../../../utils/';
import { rechargeForClient } from '../../libs/account';

export default ({
    userId,
    amount,
}) => {
    amount = _F(amount);
    const result = rechargeForClient({ userId, amount, thirdpartyAccount: 'SIMULATION_NO' });
    result.success && actionLog(userId, 'Client', amount, 'Number', 'recharge');

    return result;
};

```

* PDShopServer/project/App/routers/posts/client/account/setPaymentPassword.js

```js
import { PaymentModel, ClientModel } from '../../../../models';
import { registerUser, setPassword, checkVerifyCode, actionLog } from '../../../../utils';

export default async ({ userId, phone, password, verifyCode }) => {
    const success = await checkVerifyCode(phone, verifyCode);
    if (!success) {
        return { msg: '无效验证码' };
    }
    const client = await ClientModel.findById(userId);
    if (!client || client.phone !== phone) {
        return { msg: '获取验证码的手机号码必须为登录的手机号码' };
    }

    let payment = await PaymentModel.findOne({ userId });
    if (!payment) {
        payment = new PaymentModel({ userId });
        const error = await registerUser(PaymentModel, payment, password);
        if (error) {
            return { msg: '设置密码失败' };
        }
        client.isSetPaymentPassword = 1;
        await client.save();
        actionLog(userId, 'Client', userId, 'Client', 'setPaymentPassword');
        return { success: true };
    }

    const error = await setPassword(payment, password);
    if (error) {
        return { msg: '设置密码失败' };
    }
    await payment.save();

    actionLog(userId, 'Client', userId, 'Client', 'setPaymentPassword');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/account/withdraw.js

```js
import { _F, authenticatePaymentPassword, actionLog } from '../../../../utils/';
import { withdrawForClient } from '../../libs/account';

export default async ({
    userId,
    amount,
    payPassword,
}) => {
    const error = await authenticatePaymentPassword(userId, payPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    amount = _F(amount);
    const result = withdrawForClient({ userId, amount, thirdpartyAccount: 'SIMULATION_NO' });
    result.success && actionLog(userId, 'Client', amount, 'Number', 'withdraw');

    return result;
};

```

* PDShopServer/project/App/routers/posts/agent/regionProfit/addRegionProfit.js

```js
import { AgentRegionProfitModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    region,
    regionLastCode = 0,
    profitRate,
    profitCount,
    type = 0,
}) => {
    const member = await ClientModel.findById(userId)
    .populate({
        path: 'agentId',
        select: { referShopId: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT)) {
        return { msg: '你没有修改路线的提成的权限' };
    }
    if (!member.agent.referShopId) {
        return { msg: '请先设置参考分店' };
    }
    let regionRate = await AgentRegionProfitModel.findOne({ agentId: member.agent.id, shopId: member.agent.referShopId, regionLastCode, type });
    if (regionRate) {
        return { msg: '这个方向的提成已经存在' };
    }
    regionRate = new AgentRegionProfitModel({
        agentId: member.agent.id,
        shopId: member.agent.referShopId,
        region,
        regionLastCode,
        profitRate,
        profitCount,
        type,
    });
    await regionRate.save();

    const context = await AgentRegionProfitModel.findById(regionRate.id)
    .select({
        shopId: 1,
        region: 1,
        regionLastCode: 1,
        profitRate: 1,
        profitCount: 1,
        type: 1,
        createTime: 1,
        modifyTime: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    actionLog(userId, 'ShopMember', regionRate.id, 'AgentRegionProfit', 'addRegionProfit');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/regionProfit/getRegionAddressWithRegion.js

```js
import { AgentRegionProfitModel, ClientModel } from '../../../../models';
import { getAddressFromLastCode, getSendDoorAddressFromLastCode } from '../../libs/address';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    regionId,
}) => {
    let region;
    if (regionId) {
        region = await AgentRegionProfitModel.findById(regionId);
    }

    let addressList = [];
    let cityAddressList = [];

    const member = await ClientModel.findById(userId).populate({ path: 'agentId', select: { addressRegionLastCode: 1 } });
    const addressRegionLastCode = ((member || {}).agent || {}).addressRegionLastCode;
    if (region) {
        if (region.type === CONSTANTS.RRT_LONG) {
            addressList = await getAddressFromLastCode(region.regionLastCode);
            cityAddressList = await getSendDoorAddressFromLastCode(0, addressRegionLastCode);
        } else {
            addressList = await getAddressFromLastCode(0);
            cityAddressList = await getSendDoorAddressFromLastCode(region.regionLastCode, addressRegionLastCode);
        }
    } else {
        addressList = await getAddressFromLastCode(0);
        cityAddressList = await getSendDoorAddressFromLastCode(0, addressRegionLastCode);
    }

    return { success: true, context: {
        addressList,
        cityAddressList,
    } };
};

```

* PDShopServer/project/App/routers/posts/agent/regionProfit/getRegionProfitDetail.js

```js
import { AgentRegionProfitModel } from '../../../../models';

export default async ({ userId, regionId }) => {
    const doc = await AgentRegionProfitModel.findById(regionId)
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });
    if (!doc) {
        return { msg: '没有该设置' };
    }

    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/agent/regionProfit/getRegionProfitList.js

```js
import { AgentRegionProfitModel, ClientModel } from '../../../../models';
import { getKeywordCriteriaForRoadmapRegion } from '../../../../utils';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    const member = await ClientModel.findById(userId)
    .populate({
        path: 'agentId',
        select: { referShopId: 1 },
    });
    if (!member || !member.agent) {
        return { msg: '没有该用户' };
    }
    const criteria = getKeywordCriteriaForRoadmapRegion(keyword, { agentId: member.agent.id, shopId: member.agent.referShopId });
    const count = (fromPC && pageNo === 0) ? await AgentRegionProfitModel.count(criteria) : undefined;
    const query = AgentRegionProfitModel.find(criteria).sort({ level: 'desc', modifyTime: 'desc', createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shopId: 1,
        region: 1,
        regionLastCode: 1,
        profitRate: 1,
        profitCount: 1,
        type: 1,
        createTime: 1,
        modifyTime: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    return { success: true, context: {
        count,
        regionRateList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/agent/regionProfit/modifyRegionProfit.js

```js
import { AgentRegionProfitModel, ClientModel } from '../../../../models';
import { _T, hasAuthority, actionLog, omitNil } from '../../../../utils';
import CONSTANTS from '../../../../constants';

// region 为必传参数，如果不传，则会修改为针对所有方向
// type 为必传参数
export default async ({
    userId,
    regionId,
    region,
    regionLastCode = 0,
    profitRate,
    profitCount,
    type = 0,
}) => {
    const member = await ClientModel.findById(userId)
    .populate({
        path: 'agentId',
        select: { referShopId: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT)) {
        return { msg: '你没有修改路线的提成的权限' };
    }

    let agentRegion = await AgentRegionProfitModel.findOne({ agentId: member.agent.id, shopId: member.agent.referShopId, regionLastCode, type });
    if (agentRegion && regionId !== _T(agentRegion.id)) {
        return { msg: '这个方向的提成已经存在' };
    }
    agentRegion = await AgentRegionProfitModel.findByIdAndUpdate(regionId, {
        ...omitNil({
            profitRate,
            profitCount,
        }),
        region,
        regionLastCode,
        type,
        modifyTime: Date.now(),
    }, { new: true });
    if (!agentRegion) {
        return { msg: '提成不存在' };
    }

    const context = await AgentRegionProfitModel.findById(agentRegion.id)
    .select({
        shopId: 1,
        region: 1,
        regionLastCode: 1,
        profitRate: 1,
        profitCount: 1,
        type: 1,
        createTime: 1,
        modifyTime: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    actionLog(userId, 'ShopMember', regionId, 'AgentRegionProfit', 'modifyRegionProfit');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/agent/regionProfit/removeRegionProfit.js

```js
import { AgentRegionProfitModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, regionId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT, true)) {
        return { msg: '你没有修改路线的提成的权限' };
    }

    await AgentRegionProfitModel.findByIdAndRemove(regionId);

    actionLog(userId, 'ShopMember', regionId, 'AgentRegionProfit', 'removeRegionProfit');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/agent/regionProfit/setRegionProfitWithList.js

```js
import { AgentRegionProfitModel } from '../../../../models';
import { hasAuthority, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';

// profitRate 为必传参数
// profitCount 为必传参数
export default async ({ userId, regionIdList, profitRate, profitCount }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT, true)) {
        return { msg: '你没有修改路线的提成的权限' };
    }

    await AgentRegionProfitModel.update({ _id: { $in: regionIdList } }, { profitRate, profitCount, modifyTime: Date.now() }, { multi: true });
    actionLogWithList(userId, 'ShopMember', regionIdList.map(o => ({ id: o, model: 'AgentRegionProfit' })), 'setRegionProfitWithList');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/order/finishOrder.js

```js
import _ from 'lodash';
import { ShipperModel, OrderModel, ClientModel, ShipperInBranchShopModel } from '../../../../models';
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { _T, _F, _Y, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

const ERROR_HAVE_REBATED = '10000';
const ERROR_OTHER = '10004';
function payment (list) {
    return new Promise(async resolve => {
        sequelize.transaction(async (transaction) => {
            for (const item of list) {
                const { isOriginOrder, order, agentChairManId, masterProfit, proxyChargeProfit, insuanceFee, shopId, branchProfit, senderId, sendShipperId, designatedFee, proxyCharge } = item;
                const orderId = _T(order.id);
                const orderPayment = await OrderPaymentModel.findOne({ where: { orderId, isRebated: true }, transaction });
                if (orderPayment) {
                    throw ERROR_HAVE_REBATED;
                }
                if (agentChairManId) { // 收货点的货单
                    // 将手续费从收货点账号划到总部账号上
                    // 如果有指定收款和代收货款需要从收货点账号划到发货人账号（划账时不需要判断钱够不够，因为下一个货单已经会划钱到发送人即为该货单的收货点）
                    // 收货点需要扣除指定收款部分
                    const agentAmount = proxyChargeProfit + designatedFee + proxyCharge;
                    const agentAccount = await AccountModel.findOne({ where: { targetId: agentChairManId, type: CONSTANTS.AT_CLIENT, amount: { $gte: agentAmount } }, transaction });
                    await agentAccount.decrement({ amount: agentAmount }, { transaction });
                    proxyChargeProfit > 0 && await BillModel.create({ account: agentAccount.id, orderId, tradeAmount: -proxyChargeProfit, remark: '退还代收货款手续费' }, { transaction });
                    designatedFee > 0 && await BillModel.create({ account: agentAccount.id, orderId, tradeAmount: -designatedFee, remark: '退还指定收款' }, { transaction });
                    proxyCharge > 0 && await BillModel.create({ account: agentAccount.id, orderId, tradeAmount: -proxyCharge, remark: '退还代收货款' }, { transaction });

                    // 总部手续费
                    proxyChargeProfit > 0 && await AccountModel.increment({ amount: proxyChargeProfit }, { where: { id: CONSTANTS.AC_MASTER_ACCOUNT }, transaction });
                    proxyChargeProfit > 0 && await BillModel.create({ account: CONSTANTS.AC_MASTER_ACCOUNT, orderId, tradeAmount: proxyChargeProfit, remark: '代收货款手续费' }, { transaction });
                    // 发货人的指定收款部分和代收货款部分
                    const senderAccount = await AccountModel.findOne({ where: { targetId: senderId, type: CONSTANTS.AT_CLIENT }, transaction });
                    await senderAccount.increment({ amount: designatedFee + proxyCharge }, { transaction });
                    designatedFee > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: designatedFee, remark: '指定收款' }, { transaction });
                    proxyCharge > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: proxyCharge, remark: '代收货款' }, { transaction });
                } else {
                    // 安全账户出账
                    const securityAccount = await AccountModel.findOne({ where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
                    await securityAccount.decrement({ amount: masterProfit + proxyChargeProfit + insuanceFee + branchProfit + designatedFee + proxyCharge }, { transaction });
                    // 总部提成、手续费和保险费
                    await AccountModel.increment({ amount: masterProfit + proxyChargeProfit + insuanceFee }, { where: { id: CONSTANTS.AC_MASTER_ACCOUNT }, transaction });
                    await BillModel.create({ account: CONSTANTS.AC_MASTER_ACCOUNT, orderId, tradeAmount: masterProfit, remark: '返利总部提成' }, { transaction });
                    proxyChargeProfit > 0 && await BillModel.create({ account: CONSTANTS.AC_MASTER_ACCOUNT, orderId, tradeAmount: proxyChargeProfit, remark: '代收货款手续费' }, { transaction });
                    insuanceFee > 0 && await BillModel.create({ account: CONSTANTS.AC_MASTER_ACCOUNT, orderId, tradeAmount: insuanceFee, remark: '保险费' }, { transaction });
                    // 分部提成
                    const shopAccount = await AccountModel.findOne({ where: { targetId: shopId, type: CONSTANTS.AT_BRANCH_SHOP }, transaction });
                    await shopAccount.increment({ amount: branchProfit }, { transaction });
                    await BillModel.create({ account: shopAccount.id, orderId, tradeAmount: branchProfit, remark: '返利分店提成' }, { transaction });
                    // 发货人的指定收款部分和代收货款部分
                    const senderAccount = await AccountModel.findOne({ where: { targetId: senderId, type: CONSTANTS.AT_CLIENT }, transaction });
                    const acountAmount = _Y(senderAccount.amount + designatedFee + proxyCharge);
                    await senderAccount.increment({ amount: designatedFee + proxyCharge }, { transaction });
                    designatedFee > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: designatedFee, remark: isOriginOrder ? '指定收款' : '退还指定收款押金' }, { transaction });
                    proxyCharge > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: proxyCharge, remark: isOriginOrder ? '代收货款' : '退还代收货款押金' }, { transaction });

                    await OrderPaymentModel.update({ isRebated: true, rebatedTime: new Date() }, { where: { orderId }, transaction });

                    // 恢复物流公司的担保金额
                    const inShop = await ShipperInBranchShopModel.findOne({ shipperId: order.shipperId, shopId });
                    if (!inShop) {
                        throw ERROR_OTHER;
                    }
                    inShop.usedBondAmount = inShop.usedBondAmount - order.needBondAmount;
                    inShop.remainBondAmount = inShop.totalBondAmount - inShop.usedBondAmount;
                    await inShop.save();

                    // 如果发货人是物流公司，需要更新物流公司的账目
                    if (sendShipperId) {
                        const doc = await ShipperModel.findByIdAndUpdate(sendShipperId, { acountAmount }).catch(e => {
                            throw e;
                        });
                        if (!doc) {
                            throw ERROR_OTHER;
                        }
                    }
                }
            }
        }).then(() => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}
/*
* 如果需要支付，1.app支付：则调用由收货人调用 payForOrderWhenReceive，2.现金支付：由物流公司调用 finishOrder
* 如果不需要支付，由收货人调用 finishOrder
*/
export default async ({
    userId,
    orderId,
    isScan, //是否是扫描，如果是扫描，则orderId传的是原始货单的id，否则就是传的当前货单的id
}) => {
    const client = await ClientModel.findById(userId);
    if (!client) {
        return { msg: '没有该用户' };
    }
    let originOrder, currentOrder;
    if (isScan) {
        originOrder = await OrderModel.findById(orderId)
        .populate({
            path: 'senderId',
            select: { shipperId: 1 },
        })
        .populate({
            path: 'agentId',
            select: { chairManId: 1 },
        });
        if (client.shipperId) {
            currentOrder = await OrderModel.getOrderFromOriginOrder(client.shipperId, orderId, 1);
        } else {
            currentOrder = await OrderModel.getOrderFromOriginOrder(userId, orderId, 3);
        }
    } else {
        const _originOrder = await OrderModel.getOriginOrderFromNode(orderId);
        originOrder = await OrderModel.findById(_originOrder.id)
        .populate({
            path: 'senderId',
            select: { shipperId: 1 },
        })
        .populate({
            path: 'agentId',
            select: { chairManId: 1 },
        });
        currentOrder = await OrderModel.findById(orderId);
    }
    if (!originOrder || !currentOrder) {
        return { msg: '没有该货单' };
    }
    if (!(userId === _T(currentOrder.receiverId) || _T(client.shipperId) === _T(currentOrder.shipperId))) {
        return { msg: '你无权收货' };
    }
    if (_.find(currentOrder.stateList, o => o.state === CONSTANTS.OS_RECEIVE_SUCCESS)) {
        return { msg: '该货单已经确认收货' };
    }
    if (!_.find(currentOrder.stateList, o => _.includes([CONSTANTS.OS_READY_RECEIVE, CONSTANTS.OS_WAIT_CLIENT_PICK, CONSTANTS.OS_ON_THE_WAY], o.state))) {
        return { msg: '不能完成该货单' };
    }
    if (userId === currentOrder.receiverId && currentOrder.totalDesignatedFee + currentOrder.proxyCharge + currentOrder.additionalFee > 0) {
        return { msg: '该货单需要支付' };
    }

    // 收货人取货时，物流公司需要推荐收货人安装app，安装app后，扫描货单号或者进入我的货单找到该货单，需要付钱的数额 order.totalDesignatedFee + order.proxyCharge，
    // 如果数额大于0，需要显示单选框（是否线下支付，默认不选中），和按钮（立即付钱），如果勾选，按钮变成（确认收货），如果输入等于0，只显示按钮（确认收货）
    // 点确认收货，调用该接口，计算出该货单和其各个子货单的账目，这时将总部的提成从安全账户划到总部账号上, 分部的提成从安全账户划到分部账号上。将货主的钱从安全账户划到货主的账号（扣除手续费），将手续费从安全账户划到总部账号上， 将发货人的收益（指定收款部分+代收货款部分）从安全账户划到发货人的账号上
    // 如果是链式的货单，需要计算出所有的货单情况，然后使用事务统一划账。
    // 需要判断货单是否是收货点的货单，如果是，需要分别处理
    let order = originOrder;
    const list = [{
        isOriginOrder: true,
        order,
        agentChairManId: order.agentId ? _T(order.agent.chairManId) : undefined,
        masterProfit: _F(order.masterProfit),
        proxyChargeProfit: _F(order.proxyChargeProfit),
        insuanceFee: _F(order.insuanceFee),
        shopId: _T(order.shopId),
        branchProfit: _F(order.branchProfit),
        senderId: _T(order.sender.id),
        sendShipperId: order.isSenderRepresentShipper && order.sender.shipperId,
        designatedFee: _F(order.designatedFee),
        proxyCharge: _F(order.proxyCharge - order.proxyChargeProfit),
    }];
    while (order.nextOrderId) {
        order = await OrderModel.findById(order.nextOrderId)
        .populate({
            path: 'senderId',
            select: { shipperId: 1 },
        });
        list.unshift({
            order,
            masterProfit: _F(order.masterProfit),
            proxyChargeProfit: 0,
            insuanceFee: 0,
            shopId: _T(order.shopId),
            branchProfit: _F(order.branchProfit),
            senderId: _T(order.sender.id),
            sendShipperId: order.isSenderRepresentShipper && order.sender.shipperId,
            designatedFee: _F(order.designatedFee),
            proxyCharge: _F(order.proxyCharge),
        });
    }
    const err = await payment(list);
    if (err === ERROR_HAVE_REBATED) {
        for (const item of list) {
            await OrderModel.findByIdAndUpdate(item.order.id, { stateList: [ { state: CONSTANTS.OS_RECEIVE_SUCCESS, count: item.order.totalNumbers } ] });
        }
        return { msg: '该货单已经确认收货过' };
    } else if (err) {
        return { msg: '系统出错，请稍后再试' };
    }
    for (const item of list) {
        await OrderModel.findByIdAndUpdate(item.order.id, { stateList: [ { state: CONSTANTS.OS_RECEIVE_SUCCESS, count: item.order.totalNumbers } ] });
    }

    actionLog(userId, 'Client', orderId, 'Order', 'finishOrder');

    return { success: true, context: list };
};

```

* PDShopServer/project/App/routers/posts/client/order/getLogisticsList.js

```js
import { OrderModel, TruckModel } from '../../../../models';
import { getFormatTime } from '../../../../utils';

export default async ({
    userId,
    orderId,
}) => {
    let order = await OrderModel.findById(orderId)
    .populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    })
    .populate({
        path: 'agentId',
        select: { name: 1, address: 1 },
    });
    if (!order) {
        return { msg: '没有该货单' };
    }
    let logisticsList = [];
    logisticsList.push({
        shopName: (order.shop || {}).name,
        agentName: (order.agent || {}).name,
        address: (order.shop || order.agent || {}).address,
        locateTime: getFormatTime(order.placeOrderTime),
    });
    const truck = await TruckModel.findById(order.truckId);
    logisticsList = [...logisticsList, ...((truck || {}).locationList || []).map(o => ({
        address: o.address,
        locateTime: getFormatTime(o.time),
    })) ];

    while (order.nextOrderId) {
        order = await OrderModel.findById(order.nextOrderId)
        .populate({
            path: 'shopId',
            select: { name: 1, address: 1 },
        });
        logisticsList.push({
            shopName: (order.shop || {}).name,
            agentName: (order.agent || {}).name,
            address: (order.shop || order.agent || {}).address,
            locateTime: getFormatTime(order.placeOrderTime),
        });
        const truck = await TruckModel.findById(order.truckId);
        logisticsList = [...((truck || {}).locationList || []).map(o => ({
            address: o.address,
            locateTime: getFormatTime(o.time),
        })), ...logisticsList];
    }

    return { success: true, logisticsList };
};

```

* PDShopServer/project/App/routers/posts/client/order/getOrderDetail.js

```js
import { OrderModel } from '../../../../models';

export default async ({ userId, orderId }) => {
    const order = await OrderModel.findById(orderId)
    .populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    })
    .populate({
        path: 'agentId',
        select: { name: 1, address: 1 },
    });
    if (!order) {
        return { msg: '没有该货单' };
    }

    const context = order.toObject();
    context.state = context.stateList[0].state;
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/client/order/getReceiveOrderList.js

```js
import { OrderModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

// type = ['全部（4-8）', '运输中（4-7）', '已完成（8）']
export default async ({ userId, type, fromPC, pageNo, pageSize }) => {
    let criteria = { receiverId: userId, isTransferOrder: false };
    if (type === 'all') {
        criteria = { ...criteria };
    } else if (type === 'unsend') {
        criteria = { ...criteria, 'stateList.state': { $gte: CONSTANTS.OS_READY_PRINT_ORDER, $lte: CONSTANTS.OS_READY_START_OFF } };
    } else if (type === 'onway') {
        criteria = { ...criteria, 'stateList.state': { $gte: CONSTANTS.OS_ON_THE_WAY, $lte: CONSTANTS.OS_ON_TRANSFER } };
    } else if (type === 'reached') {
        criteria = { ...criteria, 'stateList.state': CONSTANTS.OS_READY_RECEIVE };
    } else if (type === 'complete') {
        criteria = { ...criteria, 'stateList.state': CONSTANTS.OS_RECEIVE_SUCCESS };
    }

    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        photo: 1,
        realFee: 1,
        createTime: 1,
        placeOrderTime: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        totalNumbers: 1,
        shopId: 1,
        agentId: 1,
        endPoint: 1,
        proxyCharge: 1,
        needPayInsuanceFee: 1,
        payMode: 1,
        isSendDoor: 1,
        isClientPick: 1,
        isReachPay: 1,
        totalDesignatedFee: 1,
        isInsuance: 1,
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    }).populate({
        path: 'agentId',
        select: { name: 1, address: 1 },
    });

    return { success: true, context: {
        orderList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/client/order/getReceiveOrders.js

```js
import { OrderModel } from '../../../../models';
import { getKeywordCriteriaForOrder } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { omitNil } from '../../../../utils/';
import _ from 'lodash';
import moment from 'moment';

async function getPageData (receiverId, type, params) {
    let { keyword, startDate, endDate, fromPC, pageNo, pageSize } = params;
    let criteria = {};
    if (type === 'onway') {
        criteria = { 'stateList.state': { $gte: CONSTANTS.OS_READY_STOCK, $lt: CONSTANTS.OS_READY_RECEIVE } };
    } else if (type === 'toreceive') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_RECEIVE };
    } else if (type === 'success') {
        criteria = { 'stateList.state': CONSTANTS.OS_RECEIVE_SUCCESS };
    }
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }
    criteria = getKeywordCriteriaForOrder(keyword, omitNil({ ...criteria, receiverId }));

    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shopId: 1,
        shipperId: 1,
        senderName: 1,
        senderPhone: 1,
        receiverName: 1,
        receiverPhone: 1,
        name: 1,
        endPoint: 1,
        createTime: 1,
        modifyTime: 1,
        isReachPay: 1,
        payMode: 1,
        receiveMemberId: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        isInsuance: 1,
        insuanceMount: 1,
        insuanceFee: 1,
        fee: 1,
        profit: 1,
        masterProfit: 1,
        branchProfit: 1,
        realFee: 1,
        proxyCharge: 1,
        proxyChargeProfit: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
        totalDesignatedFee: 1,
        designatedFee: 1,
        placeOrderTime: 1,
    }).populate({
        path: 'receiveMemberId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperId',
        select: { name: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['运输中', '待收货', '已完成']
const TYPES = ['onway', 'toreceive', 'success'];
export default async ({ userId, shopId, type, ...params }) => {
    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(userId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                onway: await getPageData(userId, 'onway', params),
                toreceive: await getPageData(userId, 'toreceive', params),
                success: await getPageData(userId, 'success', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/client/order/getSendOrderList.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

// type = ['全部', '待揽货', '待发货', '运输中', '待收货']
export default async ({ userId, type, fromPC, pageNo, pageSize }) => {
    const client = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    })
    .populate({
        path: 'agentId',
        select: { chairManId: 1 },
    });
    if (!client) {
        return { msg: '没有该用户' };
    }

    let senderId = userId;
    if (client.shipper) {
        senderId = client.shipper.chairManId;
    } else if (client.agent) {
        senderId = client.agent.chairManId;
    }

    let criteria = { senderId };
    if (type === 'preorder') {
        criteria = { ...criteria, 'stateList.state': CONSTANTS.OS_PREORDER };
    } else if (type === 'waitpay') {
        criteria = { ...criteria, 'stateList.state': { $gte: CONSTANTS.OS_READY_SELECT_ROADMAP, $lte: CONSTANTS.OS_READY_PRINT_ORDER } };
    } else if (type === 'onway') {
        criteria = { ...criteria, 'stateList.state': { $gte: CONSTANTS.OS_READY_STOCK, $lte: CONSTANTS.OS_READY_RECEIVE } };
    } else if (type === 'complete') {
        criteria = { ...criteria, 'stateList.state': CONSTANTS.OS_RECEIVE_SUCCESS };
    }
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        photo: 1,
        shopId: 1,
        agentId: 1,
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        name: 1,
        roadmapId: 1,
        realFee: 1,
        createTime: 1,
        placeOrderTime: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        totalNumbers: 1,
        endPoint: 1,
        proxyCharge: 1,
        needPayInsuanceFee: 1,
        payMode: 1,
        isSendDoor: 1,
        isClientPick: 1,
        isReachPay: 1,
        totalDesignatedFee: 1,
        isInsuance: 1,
    }).populate({
        path: 'roadmapId',
        select: { startPoint: 1, endPoint: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    }).populate({
        path: 'agentId',
        select: { name: 1, address: 1 },
    });

    return { success: true, context: {
        orderList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/client/order/getSendOrders.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { getKeywordCriteriaForOrder } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { omitNil, hasAuthority } from '../../../../utils/';
import _ from 'lodash';
import moment from 'moment';

async function getPageData (senderId, type, params) {
    let { keyword, startDate, endDate, fromPC, pageNo, pageSize } = params;
    let criteria = {};
    if (type === 'topay') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_PAYMENT };
    } else if (type === 'onway') {
        criteria = { 'stateList.state': { $gte: CONSTANTS.OS_READY_STOCK, $lt: CONSTANTS.OS_READY_RECEIVE } };
    } else if (type === 'toreceive') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_RECEIVE };
    } else if (type === 'success') {
        criteria = { 'stateList.state': CONSTANTS.OS_RECEIVE_SUCCESS };
    }
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }
    criteria = getKeywordCriteriaForOrder(keyword, omitNil({ ...criteria, senderId }));

    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shopId: 1,
        shipperId: 1,
        senderName: 1,
        senderPhone: 1,
        receiverName: 1,
        receiverPhone: 1,
        name: 1,
        endPoint: 1,
        createTime: 1,
        modifyTime: 1,
        isReachPay: 1,
        payMode: 1,
        receiveMemberId: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        isInsuance: 1,
        insuanceMount: 1,
        insuanceFee: 1,
        fee: 1,
        profit: 1,
        masterProfit: 1,
        branchProfit: 1,
        realFee: 1,
        proxyCharge: 1,
        proxyChargeProfit: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
        totalDesignatedFee: 1,
        designatedFee: 1,
        placeOrderTime: 1,
    }).populate({
        path: 'receiveMemberId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperId',
        select: { name: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['待支付', '运输中', '待收货', '已完成']
const TYPES = ['topay', 'onway', 'toreceive', 'success'];
export default async ({ userId, type, ...params }) => {
    const client = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    })
    .populate({
        path: 'agentId',
        select: { chairManId: 1 },
    });

    if (!client) {
        return { msg: '没有该用户' };
    }
    if ((client.shipper || client.agent) && !hasAuthority(client, CONSTANTS.AH_LOOK_ORDERS)) {
        return { msg: '你没有查看货单的权限' };
    }

    let senderId = userId;
    if (client.shipper) {
        senderId = client.shipper.chairManId;
    } else if (client.agent) {
        senderId = client.agent.chairManId;
    }

    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(senderId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                topay: await getPageData(senderId, 'topay', params),
                onway: await getPageData(senderId, 'onway', params),
                toreceive: await getPageData(senderId, 'toreceive', params),
                success: await getPageData(senderId, 'success', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/client/order/payForAgentOrder.js

```js
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { OrderModel } from '../../../../models';
import { _T, _F, authenticatePaymentPassword, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

const ERROR_HAVE_PAYED = '10000';
const ERROR_SENDER_MONEY_NOT_ENOUGH = '10001';
function payment (orderId, senderId, agentChairManId, amount) {
    return new Promise(async resolve => {
        sequelize.transaction(async (transaction) => {
            const orderPayment = await OrderPaymentModel.findOne({ where: { orderId, isPayed: true }, transaction });
            if (orderPayment) {
                throw ERROR_HAVE_PAYED;
            }
            // 部门的部分
            const senderAccount = await AccountModel.findOne({ where: { targetId: senderId, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } }, transaction });
            if (!senderAccount) {
                throw ERROR_SENDER_MONEY_NOT_ENOUGH;
            }
            const agentAccount = await AccountModel.findOne({ where: { targetId: agentChairManId, type: CONSTANTS.AT_CLIENT }, transaction });
            await senderAccount.decrement({ amount }, { transaction });
            await agentAccount.increment({ amount }, { transaction });
            await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: -amount, remark: '支付运费' }, { transaction });
            await BillModel.create({ account: agentAccount.id, orderId, tradeAmount: amount, remark: '收货点收到运费' }, { transaction });

            await OrderPaymentModel.create({ orderId, isPayed: true, payedTime: new Date() }, { transaction });
        }).then(() => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

export default async ({
    userId,
    orderIdList, // 为货单列表支付
    payPassword,
}) => {
    const error = await authenticatePaymentPassword(userId, payPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    const failedList = [];
    for (const orderId of orderIdList) {
        const order = await OrderModel.findById(orderId)
        .populate({
            path: 'agentId',
            select: { chairManId: 1 },
        });
        if (!order || !order.agentId) {
            failedList.push({ msg: '部分货单没找到导致部分货单未完成支付' });
            continue;
        }
        if (!_.find(order.stateList, o => o.state === CONSTANTS.OS_READY_PAYMENT)) {
            failedList.push({ msg: '部分货单不能支付' });
            continue;
        }
        if (_T(order.senderId) !== userId) {
            failedList.push({ msg: '有无权支付货单，部分货单未完成支付' });
            continue;
        }
        const err = await payment(orderId, userId, _T(order.agent.chairManId), _F(order.needPayTransportFee));
        if (err === ERROR_HAVE_PAYED) {
            order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
            await order.save();
            failedList.push({ msg: '有货单无需再支付，部分货单未完成支付' });
            continue;
        } else if (err === ERROR_SENDER_MONEY_NOT_ENOUGH) {
            failedList.push({ msg: '余额不足，请先充值，部分货单未完成支付' });
            continue;
        } else if (err) {
            failedList.push({ msg: '系统出错，部分货单未完成支付' });
            continue;
        }
        order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
        await order.save();
    }

    actionLogWithList(userId, 'Client', orderIdList.map(o => ({ id: o, model: 'Order' })), 'payForAgentOrder');

    if (failedList.length) {
        return failedList[0];
    }

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/order/payForOrderWhenReceive.js

```js
import _ from 'lodash';
import { ShipperModel, OrderModel, ShipperInBranchShopModel } from '../../../../models';
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { _T, _F, _Y, actionLog, authenticatePaymentPassword } from '../../../../utils';
import CONSTANTS from '../../../../constants';

const ERROR_HAVE_REBATED = '10000';
const ERROR_RECEIVER_MONEY_NOT_ENOUGH = '10001';
const ERROR_OTHER = '10004';
function payment (list) {
    return new Promise(async resolve => {
        sequelize.transaction(async (transaction) => {
            for (const item of list) {
                const { isOriginOrder, order, agentChairManId, masterProfit, proxyChargeProfit, insuanceFee, shopId, branchProfit,
                    senderId, sendShipperId, designatedFee, proxyCharge, receiverId, shipperChairManId, shipperId, payAmount } = item;
                const orderId = _T(order.id);
                const orderPayment = await OrderPaymentModel.findOne({ where: { orderId, isRebated: true }, transaction });
                if (orderPayment) {
                    throw ERROR_HAVE_REBATED;
                }
                if (agentChairManId) { // 收货点的货单
                    // 将手续费从收货点账号划到总部账号上
                    // 如果有指定收款和代收货款需要从收货点账号划到发货人账号（划账时不需要判断钱够不够，因为下一个货单已经会划钱到发送人即为该货单的收货点）
                    // 收货点需要扣除指定收款部分
                    const agentAmount = proxyChargeProfit + designatedFee + proxyCharge;
                    const agentAccount = await AccountModel.findOne({ where: { targetId: agentChairManId, type: CONSTANTS.AT_CLIENT, amount: { $gte: agentAmount } }, transaction });
                    await agentAccount.decrement({ amount: agentAmount }, { transaction });
                    proxyChargeProfit > 0 && await BillModel.create({ account: agentAccount.id, orderId, tradeAmount: -proxyChargeProfit, remark: '退还代收货款手续费' }, { transaction });
                    designatedFee > 0 && await BillModel.create({ account: agentAccount.id, orderId, tradeAmount: -designatedFee, remark: '退还指定收款' }, { transaction });
                    proxyCharge > 0 && await BillModel.create({ account: agentAccount.id, orderId, tradeAmount: -proxyCharge, remark: '退还代收货款' }, { transaction });

                    // 总部手续费
                    proxyChargeProfit > 0 && await AccountModel.increment({ amount: proxyChargeProfit }, { where: { id: CONSTANTS.AC_MASTER_ACCOUNT }, transaction });
                    proxyChargeProfit > 0 && await BillModel.create({ account: CONSTANTS.AC_MASTER_ACCOUNT, orderId, tradeAmount: proxyChargeProfit, remark: '代收货款手续费' }, { transaction });
                    // 发货人的指定收款部分和代收货款部分
                    const senderAccount = await AccountModel.findOne({ where: { targetId: senderId, type: CONSTANTS.AT_CLIENT }, transaction });
                    await senderAccount.increment({ amount: designatedFee + proxyCharge }, { transaction });
                    designatedFee > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: designatedFee, remark: '指定收款' }, { transaction });
                    proxyCharge > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: proxyCharge, remark: '代收货款' }, { transaction });
                } else {
                    // 安全账户出账
                    const securityAccount = await AccountModel.findOne({ where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
                    await securityAccount.decrement({ amount: masterProfit + proxyChargeProfit + insuanceFee + branchProfit + designatedFee + proxyCharge }, { transaction });
                    // 总部提成、手续费和保险费
                    await AccountModel.increment({ amount: masterProfit + proxyChargeProfit + insuanceFee }, { where: { id: CONSTANTS.AC_MASTER_ACCOUNT }, transaction });
                    await BillModel.create({ account: CONSTANTS.AC_MASTER_ACCOUNT, orderId, tradeAmount: masterProfit, remark: '返利总部提成' }, { transaction });
                    proxyChargeProfit > 0 && await BillModel.create({ account: CONSTANTS.AC_MASTER_ACCOUNT, orderId, tradeAmount: proxyChargeProfit, remark: '代收货款手续费' }, { transaction });
                    insuanceFee > 0 && await BillModel.create({ account: CONSTANTS.AC_MASTER_ACCOUNT, orderId, tradeAmount: insuanceFee, remark: '保险费' }, { transaction });
                    // 分部提成
                    const shopAccount = await AccountModel.findOne({ where: { targetId: shopId, type: CONSTANTS.AT_BRANCH_SHOP }, transaction });
                    await shopAccount.increment({ amount: branchProfit }, { transaction });
                    await BillModel.create({ account: shopAccount.id, orderId, tradeAmount: branchProfit, remark: '返利分店提成' }, { transaction });
                    // 发货人的指定收款部分和代收货款部分
                    const senderAccount = await AccountModel.findOne({ where: { targetId: senderId, type: CONSTANTS.AT_CLIENT }, transaction });
                    const acountAmount = _Y(senderAccount.amount + designatedFee + proxyCharge);
                    await senderAccount.increment({ amount: designatedFee + proxyCharge }, { transaction });
                    designatedFee > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: designatedFee, remark: isOriginOrder ? '指定收款' : '退还指定收款押金' }, { transaction });
                    proxyCharge > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: proxyCharge, remark: isOriginOrder ? '代收货款' : '退还代收货款押金' }, { transaction });

                    // 将收货人要付的钱（totalDesignatedFee+proxyCharge）从收货人账号划到物流公司账号
                    let acountAmountShipper;
                    if (payAmount > 0) {
                        const receiverAccount = await AccountModel.findOne({ where: { targetId: receiverId, type: CONSTANTS.AT_CLIENT, amount: { $gte: payAmount } }, transaction });
                        if (!receiverAccount) {
                            throw ERROR_RECEIVER_MONEY_NOT_ENOUGH;
                        }
                        const shipperAccount = await AccountModel.findOne({ where: { targetId: shipperChairManId, type: CONSTANTS.AT_CLIENT }, transaction });
                        acountAmountShipper = shipperAccount.amount + payAmount;
                        await receiverAccount.decrement({ amount: payAmount }, { transaction });
                        await shipperAccount.increment({ amount: payAmount }, { transaction });
                        await BillModel.create({ account: receiverAccount.id, orderId, tradeAmount: -payAmount, remark: '支付' + (((order.totalDesignatedFee || order.additionalFee) && order.proxyCharge) ? '运费和货款' : (order.totalDesignatedFee || order.additionalFee) ? '运费' : '货款') + '给物流公司' }, { transaction });
                        await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: payAmount, remark: '收到收货人的' + (((order.totalDesignatedFee || order.additionalFee) && order.proxyCharge) ? '运费和货款' : (order.totalDesignatedFee || order.additionalFee) ? '运费' : '货款') }, { transaction });
                    }
                    await OrderPaymentModel.update({ isRebated: true, rebatedTime: new Date() }, { where: { orderId }, transaction });

                    // 恢复物流公司的担保金额
                    const inShop = await ShipperInBranchShopModel.findOne({ shipperId, shopId });
                    if (!inShop) {
                        throw ERROR_OTHER;
                    }
                    inShop.usedBondAmount = inShop.usedBondAmount - order.needBondAmount;
                    inShop.remainBondAmount = inShop.totalBondAmount - inShop.usedBondAmount;
                    await inShop.save();

                    // 如果发货人是物流公司，需要更新物流公司的账目
                    if (sendShipperId) {
                        const doc = await ShipperModel.findByIdAndUpdate(sendShipperId, { acountAmount }).catch(e => {
                            throw e;
                        });
                        if (!doc) {
                            throw ERROR_OTHER;
                        }
                    }
                    if (payAmount > 0) {
                        const doc = await ShipperModel.findByIdAndUpdate(shipperId, { acountAmount: acountAmountShipper }).catch(e => {
                            throw e;
                        });
                        if (!doc) {
                            throw ERROR_OTHER;
                        }
                    }
                }
            }
        }).then(() => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}
/*
* 如果需要支付，1.app支付：则调用由收货人调用 payForOrderWhenReceive，2.现金支付：由物流公司调用 finishOrder
* 如果不需要支付，由收货人调用 finishOrder
*/
export default async ({
    userId,
    orderId,
    payPassword,
    isScan, //是否是扫描，如果是扫描，则orderId传的是原始货单的id，否则就是传的当前货单的id
}) => {
    const error = await authenticatePaymentPassword(userId, payPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    let originOrder, currentOrder;
    if (isScan) {
        originOrder = await OrderModel.findById(orderId)
        .populate({
            path: 'senderId',
            select: { shipperId: 1 },
        })
        .populate({
            path: 'agentId',
            select: { chairManId: 1 },
        });
        currentOrder = await OrderModel.getOrderFromOriginOrder(userId, orderId, 3);
    } else {
        const _originOrder = await OrderModel.getOriginOrderFromNode(orderId);
        originOrder = await OrderModel.findById(_originOrder.id)
        .populate({
            path: 'senderId',
            select: { shipperId: 1 },
        })
        .populate({
            path: 'agentId',
            select: { chairManId: 1 },
        });
        currentOrder = await OrderModel.findById(orderId);
    }
    if (!originOrder || !currentOrder) {
        return { msg: '没有该货单' };
    }
    if (userId !== _T(currentOrder.receiverId)) {
        return { msg: '你无权收货' };
    }
    if (_.find(currentOrder.stateList, o => o.state === CONSTANTS.OS_RECEIVE_SUCCESS)) {
        return { msg: '该货单已经确认收货过' };
    }
    if (!_.find(currentOrder.stateList, o => _.includes([CONSTANTS.OS_READY_RECEIVE, CONSTANTS.OS_WAIT_CLIENT_PICK, CONSTANTS.OS_ON_THE_WAY], o.state))) {
        return { msg: '该货单不能完成支付' };
    }
    // 收货人取货时，物流公司需要推荐收货人安装app，安装app后，扫描货单号或者进入我的货单找到该货单，需要付钱的数额 order.totalDesignatedFee + order.proxyCharge，
    // 如果数额大于0，需要显示单选框（是否线下支付，默认不选中），和按钮（立即付钱），如果勾选，按钮变成（确认收货），如果输入等于0，只显示按钮（确认收货）
    // 点立即支付，调用该接口，计算出该货单和其各个子货单的账目，这时将总部的提成从安全账户划到总部账号上, 分部的提成从安全账户划到分部账号上。将货主的钱从安全账户划到货主的账号（扣除手续费），将手续费从安全账户划到总部账号上，将发货人的收益从安全账户划到发货人的账号上，将货单的totalDesignatedFee+proxyCharge从收货人账号划到最后一家物流公司账号
    // 如果是链式的货单，需要计算出所有的货单情况，然后使用事务统一划账。
    // 需要判断货单是否是收货点的货单，如果是，需要分别处理
    let order = originOrder;
    const list = [{
        isOriginOrder: true,
        order,
        agentChairManId: order.agentId ? _T(order.agent.chairManId) : undefined,
        masterProfit: _F(order.masterProfit),
        proxyChargeProfit: _F(order.proxyChargeProfit),
        insuanceFee: _F(order.insuanceFee),
        shopId: _T(order.shopId),
        branchProfit: _F(order.branchProfit),
        senderId: _T(order.sender.id),
        sendShipperId: order.isSenderRepresentShipper && order.sender.shipperId,
        designatedFee: _F(order.designatedFee),
        proxyCharge: _F(order.proxyCharge - order.proxyChargeProfit),
        receiverId: _T(order.receiverId),
        shipperChairManId: _T(order.shipperChairManId),
        shipperId: _T(order.shipperId),
        payAmount: order.nextOrderId ? 0 : _F(order.totalDesignatedFee + order.proxyCharge + order.additionalFee), //末尾的个货单
    }];
    while (order.nextOrderId) {
        order = await OrderModel.findById(order.nextOrderId)
        .populate({
            path: 'senderId',
            select: { shipperId: 1 },
        });
        list.unshift({
            order,
            masterProfit: _F(order.masterProfit),
            proxyChargeProfit: 0,
            insuanceFee: 0,
            shopId: _T(order.shopId),
            branchProfit: _F(order.branchProfit),
            senderId: _T(order.sender.id),
            sendShipperId: order.isSenderRepresentShipper && order.sender.shipperId,
            designatedFee: _F(order.designatedFee),
            proxyCharge: _F(order.proxyCharge),
            receiverId: _T(order.receiverId),
            shipperChairManId: _T(order.shipperChairManId),
            shipperId: _T(order.shipperId),
            payAmount: order.nextOrderId ? 0 : _F(order.totalDesignatedFee + order.proxyCharge + order.additionalFee), //末尾的个货单
        });
    }
    const err = await payment(list);
    if (err === ERROR_HAVE_REBATED) {
        for (const item of list) {
            await OrderModel.findByIdAndUpdate(item.order.id, { stateList: [ { state: CONSTANTS.OS_RECEIVE_SUCCESS, count: item.order.totalNumbers } ] });
        }
        return { msg: '该货单已经确认收货过' };
    } else if (err === ERROR_RECEIVER_MONEY_NOT_ENOUGH) {
        return { msg: '余额不足，请先充值' };
    } else if (err) {
        return { msg: '系统出错，请稍后再试' };
    }
    for (const item of list) {
        await OrderModel.findByIdAndUpdate(item.order.id, { stateList: [ { state: CONSTANTS.OS_RECEIVE_SUCCESS, count: item.order.totalNumbers } ] });
    }

    actionLog(userId, 'Client', orderId, 'Order', 'payForOrderWhenReceive');

    return { success: true, context: list };
};

```

* PDShopServer/project/App/routers/posts/client/order/payForOrderWhenSend.js

```js
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { OrderModel, ClientModel, ShipperModel, ShipperInBranchShopModel } from '../../../../models';
import { _T, _F, _Y, authenticatePaymentPassword, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

const ERROR_HAVE_PAYED = '10000';
const ERROR_SENDER_MONEY_NOT_ENOUGH = '10001';
const ERROR_SHIPPER_MONEY_NOT_ENOUGH = '10002';
const ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH = '10003';
const ERROR_OTHER = '10004';
function payment (order, sender, shipper) {
    return new Promise(async resolve => {
        const orderId = _T(order.id);
        sequelize.transaction(async (transaction) => {
            const orderPayment = await OrderPaymentModel.findOne({ where: { orderId, isPayed: true }, transaction });
            if (orderPayment) {
                throw ERROR_HAVE_PAYED;
            }
            // 发送者（物流公司/收货点）的部分
            let amount = sender.transportFee + sender.insuanceFee;
            const senderAccount = await AccountModel.findOne({ where: { targetId: sender.id, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } }, transaction });
            if (!senderAccount) {
                throw ERROR_SENDER_MONEY_NOT_ENOUGH;
            }
            const acountAmountSender = _Y(senderAccount.amount - amount);
            await senderAccount.decrement({ amount }, { transaction });
            // 保险的部分必须划到安全账户
            // 如果支付的运费大于总部和分部的提成，则只将提成部分划到安全账户，这时 deductAmount<0，这部分钱划到物流公司的账户上
            // 如果支付的运费小于总部和分部的提成，则将支付的所有的钱划到安全账户上，这时 deductAmount>0，物流公司需要将deductAmount抵押到安全账户左右总部和分部的提成
            const profit = sender.transportFee > sender.transportProfit ? sender.transportProfit : sender.transportFee;
            await AccountModel.increment({ amount: sender.insuanceFee + profit }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            sender.transportFee > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: -sender.transportFee, remark: '支付运费' }, { transaction });
            sender.insuanceFee > 0 && await BillModel.create({ account: senderAccount.id, orderId, tradeAmount: -sender.insuanceFee, remark: '支付保险' }, { transaction });

            // 物流公司部分
            amount = shipper.proxyCharge + shipper.deductAmount;
            const shipperAccount = await AccountModel.findOne({ where: { targetId: shipper.id, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } } });
            if (!shipperAccount) {
                throw ERROR_SHIPPER_MONEY_NOT_ENOUGH;
            }
            const acountAmount = _Y(shipperAccount.amount - amount);
            amount !== 0 && await shipperAccount.decrement({ amount }, { transaction });
            // 如果shipper.deductAmount大于0，说明需要抵押运费，抵押在安全账户的钱为amount，如果小于0，说明是运费收益，这部分钱直接进物流公司账户，这是只抵押shipper.proxyCharge
            await AccountModel.increment({ amount: shipper.deductAmount > 0 ? amount : shipper.proxyCharge }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            shipper.proxyCharge > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -shipper.proxyCharge, remark: '抵押货款' }, { transaction });
            shipper.deductAmount !== 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -shipper.deductAmount, remark: shipper.deductAmount > 0 ? '抵押指定收款' : '收取运费' }, { transaction });

            await OrderPaymentModel.create({ orderId, isPayed: true, payedTime: new Date() }, { transaction });

            // 扣除物流公司的担保金额
            const inShop = await ShipperInBranchShopModel.findOne({ shipperId: order.shipper.id, shopId: order.shopId });
            if (!inShop || inShop.remainBondAmount < order.needBondAmount) {
                throw ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH;
            }
            inShop.remainBondAmount = inShop.remainBondAmount - order.needBondAmount;
            inShop.usedBondAmount = inShop.totalBondAmount - inShop.remainBondAmount;
            await inShop.save();

            // 如果发送者是物流公司的董事长，付款成功后，需要更新该物流公司的账目
            if (sender.sendShipperId) {
                const sendShipper = await ShipperModel.findByIdAndUpdate(sender.sendShipperId, { acountAmount: acountAmountSender }).catch(e => {
                    throw e;
                });
                if (!sendShipper) {
                    throw ERROR_OTHER;
                }
            }
            // 扣款成功后，需要更新物流公司的账目
            const doc = await ShipperModel.findByIdAndUpdate(order.shipper.id, { acountAmount }).catch(e => {
                throw e;
            });
            if (!doc) {
                throw ERROR_OTHER;
            }
        }).then(() => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

export default async ({
    userId,
    orderIdList, // 为货单列表支付
    payPassword,
}) => {
    const error = await authenticatePaymentPassword(userId, payPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    const failedList = [];
    for (const orderId of orderIdList) {
        const order = await OrderModel.findById(orderId)
        .populate({
            path: 'shipperId',
            select: { chairManId: 1 },
        });
        if (!order || order.agentId) {
            failedList.push({ msg: '部分货单没找到导致部分货单未完成支付' });
            continue;
        }
        if (!_.find(order.stateList, o => o.state === CONSTANTS.OS_READY_PAYMENT)) {
            failedList.push({ msg: '有货单不能支付' });
            continue;
        }

        const client = await ClientModel.findById(userId)
        .populate({
            path: 'shipperId',
            select: { chairManId: 1 },
        })
        .populate({
            path: 'agentId',
            select: { chairManId: 1 },
        });

        let senderId = userId;
        let sendShipperId;
        if (client.shipper && _T(order.senderId) !== userId) {
            if (_T(client.shipper.chairManId) !== _T(order.sender.id)) {
                failedList.push({ msg: '有无权支付货单，部分货单未完成支付' });
                continue;
            } else {
                senderId = client.shipper.chairManId;
                sendShipperId = client.shipper.id;
            }
        } else if (client.agent && _T(order.senderId) !== userId) {
            if (_T(client.agent.chairManId) !== _T(order.sender.id)) {
                failedList.push({ msg: '有无权支付货单，部分货单未完成支付' });
                continue;
            } else {
                senderId = client.agent.chairManId;
            }
        } else if (_T(order.senderId) !== userId) {
            failedList.push({ msg: '有无权支付货单，部分货单未完成支付' });
            continue;
        }

        const err = await payment(
            order,
            { id: _T(senderId), sendShipperId, transportFee: _F(order.needPayTransportFee), insuanceFee: _F(order.needPayInsuanceFee), transportProfit: _F(order.masterProfit + order.branchProfit) },
            { id: _T(order.shipper.chairManId), proxyCharge: _F(order.proxyCharge), deductAmount: _F(order.totalDesignatedFee - order.fee) },
        );
        if (err === ERROR_HAVE_PAYED) {
            order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
            await order.save();
            failedList.push({ msg: '有货单无需再支付，部分货单未完成支付' });
            continue;
        } else if (err === ERROR_SENDER_MONEY_NOT_ENOUGH) {
            failedList.push({ msg: '余额不足，请先充值，部分货单未完成支付' });
            continue;
        } else if (err === ERROR_SHIPPER_MONEY_NOT_ENOUGH) {
            order.deductError = true;
            order.modifyTime = Date.now();
            await order.save();
            failedList.push({ msg: '该物流公司余额不足，请选择其他公司的路线，部分货单未完成支付' });
            continue;
        } else if (err === ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH) {
            order.deductError = true;
            order.modifyTime = Date.now();
            await order.save();
            failedList.push({ msg: '该物流公司保证金，请选择其他公司的路线，部分货单未完成支付' });
            continue;
        } else if (err) {
            failedList.push({ msg: '系统出错，部分货单未完成支付' });
            continue;
        }
        order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
        await order.save();
    }

    actionLogWithList(userId, 'Client', orderIdList.map(o => ({ id: o, model: 'Order' })), 'payForOrderWhenSend');

    if (failedList.length) {
        return failedList[0];
    }
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/personal/findPassword.js

```js
import { ClientModel } from '../../../../models';
import { setPassword, checkVerifyCode, actionLog } from '../../../../utils';

export default async ({ phone, password, verifyCode }) => {
    const user = await ClientModel.findOne({ phone });
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    const success = await checkVerifyCode(phone, verifyCode);
    if (!success) {
        return { msg: '无效验证码' };
    }

    const error = await setPassword(user, password);
    if (error) {
        return { msg: '服务器错误' };
    }
    await user.save();

    actionLog(user.id, 'Client', user.id, 'Client', 'findPassword');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/personal/getAgentInfo.js

```js
import { ClientModel, AgentModel } from '../../../../models';

export default async ({ userId }) => {
    const member = await ClientModel.findById(userId);
    if (!member) {
        return { msg: '没有该用户' };
    }
    const agentId = member.agentId;
    if (!agentId) {
        return { msg: '无效操作' };
    }
    const agent = await AgentModel.findById(agentId)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    })
    .populate({
        path: 'referShopId',
        select: { name: 1, address: 1 },
    });
    if (!agent) {
        return { msg: '没有该收货点' };
    }
    return { success: true, context: agent };
};

```

* PDShopServer/project/App/routers/posts/client/personal/getBranchShopInfo.js

```js
import { ShipperInBranchShopModel } from '../../../../models';
import { getOwnShipper } from '../../../../utils';

export default async ({ userId, shopId }) => {
    const shipperId = await getOwnShipper(userId);
    if (!shipperId) {
        return { msg: '你不是物流公司成员' };
    }
    const doc = await ShipperInBranchShopModel.findOne({ shipperId, shopId });
    if (!doc) {
        return { msg: '你所在的物流公司没有入住该分店' };
    }
    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/client/personal/getPersonalInfo.js

```js
import { ClientModel, ShipperInBranchShopModel, CityTruckModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T, _Y, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({ userId, fromPC }) => {
    const client = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        populate: [{
            path: 'chairManId',
            select: { name: 1, phone: 1 },
        }],
    }).populate({
        path: 'agentId',
        populate: [{
            path: 'chairManId',
            select: { name: 1, phone: 1 },
        }, {
            path: 'referShopId',
            select: { name: 1, address: 1 },
        }],
    }).populate({
        path: 'truckId',
        select: { plateNo: 1 },
    });
    if (!client) {
        return { msg: '没有该用户' };
    }

    const context = client.toObject();
    context.userId = context.id;
    delete context.id;

    if (context.shipper) {
        let registerShopList = await ShipperInBranchShopModel.find({ shipperId: client.shipper.id })
        .select({ shopId: 1, totalBondAmount: 1, remainBondAmount: 1 })
        .populate({
            path: 'shopId',
            select: { name: 1, address: 1, addressRegion: 1, addressRegionLastCode: 1 },
        });
        registerShopList = registerShopList.map(o => {
            o = o.toObject();
            o.shop.totalBondAmount = o.totalBondAmount;
            o.shop.remainBondAmount = o.remainBondAmount;
            return o.shop;
        });
        context.shipper.registerShopList = registerShopList;
        if (context.shipper.chairMan.id == userId) {
            context.post = '董事长';
        } else {
            context.post = '普通成员';
        }
    }

    if (!fromPC) {
        // 获取用户或者物流公司或者收货点的余额
        if (!client.shipper && !client.agent) {
            const clientAccount = await AccountModel.findOne({ where: { targetId: userId, type: CONSTANTS.AT_CLIENT } });
            if (!clientAccount) {
                return { msg: '没有该账户' };
            }
            context.remainAmount = _Y(clientAccount.amount);
        } else if (client.shipper && hasAuthority(client, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
            const clientAccount = await AccountModel.findOne({ where: { targetId: _T(client.shipper.chairMan.id), type: CONSTANTS.AT_CLIENT } });
            if (!clientAccount) {
                return { msg: '没有该账户' };
            }
            context.remainAmount = _Y(clientAccount.amount);
        } else if (client.agent && hasAuthority(client, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
            const clientAccount = await AccountModel.findOne({ where: { targetId: _T(client.agent.chairMan.id), type: CONSTANTS.AT_CLIENT } });
            if (!clientAccount) {
                return { msg: '没有该账户' };
            }
            context.remainAmount = _Y(clientAccount.amount);
        }
    }

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/client/personal/getShipperInfo.js

```js
import { ClientModel, ShipperModel, ShipperInBranchShopModel } from '../../../../models';

export default async ({ userId, shopId }) => {
    const member = await ClientModel.findById(userId);
    if (!member) {
        return { msg: '没有该用户' };
    }
    const shipperId = member.shipperId;
    if (!shipperId) {
        return { msg: '无效操作' };
    }

    let shipper = await ShipperModel.findById(shipperId)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    if (!shipper) {
        return { msg: '没有该物流公司' };
    }
    shipper = shipper.toObject();
    let inShop = await ShipperInBranchShopModel.findOne({ shipperId, shopId });
    if (inShop) {
        inShop = inShop.toObject();
        shipper = { ...shipper, ...inShop };
    }
    return { success: true, context: shipper };
};

```

* PDShopServer/project/App/routers/posts/client/personal/getUserNameByPhone.js

```js
import { ClientModel } from '../../../../models';

export default async ({ userId, phone }) => {
    const doc = await ClientModel.findOne({ phone });
    return { success: true, context: { name: (doc || {}).name } };
};

```

* PDShopServer/project/App/routers/posts/client/personal/login.js

```js
import { ClientModel } from '../../../../models';
import { authenticatePassword, actionLog } from '../../../../utils';

export default async ({ phone, password }) => {
    const user = await ClientModel.findOne({ phone });
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    const error = await authenticatePassword(user, password);
    if (error) {
        return { msg: '密码错误' };
    } else {
        actionLog(user.id, 'Client', user.id, 'Client', 'login');
        return { success: true, context: { userId: user.id } };
    }
};

```

* PDShopServer/project/App/routers/posts/client/personal/modifyAgentInfo.js

```js
import { AgentModel, ClientModel, MediaModel } from '../../../../models';
import { getMediaId, omitNil, hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    image, // 收货点背景图片
    sign, // 收货点签名
    phoneList, // 收货点联系电话
    address, // 收货点地址
    location, // 经纬度定位
}) => {
    const client = await ClientModel.findById(userId);
    if (!hasAuthority(client, CONSTANTS.AH_MODIFY_AGENT_INFO)) {
        return { msg: '你没有修改收货点信息的权限' };
    }

    let _image = getMediaId(image);

    let agent = await AgentModel.findByIdAndUpdate(client.agentId, omitNil({
        image: _image,
        sign,
        phoneList,
        address,
        location,
    }));
    if (!agent) {
        return { msg: '修改失败' };
    }

    MediaModel._updateRef(
        { [_image]: 1 },
        { [image && agent.image]: -1 },
    );

    agent = await AgentModel.findById(agent.id)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });

    actionLog(userId, 'Client', agent.id, 'Agent', 'modifyAgentInfo');

    return { success: true, context: agent };
};

```

* PDShopServer/project/App/routers/posts/client/personal/modifyPassword.js

```js
import { ClientModel } from '../../../../models';
import { setPassword, authenticatePassword, actionLog } from '../../../../utils';

export default async ({ userId, oldPassword, newPassword }) => {
    const user = await ClientModel.findById(userId);
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    let error = await authenticatePassword(user, oldPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    error = await setPassword(user, newPassword);
    if (error) {
        return { msg: '设置密码失败' };
    }
    await user.save();

    actionLog(userId, 'Client', '', '', 'modifyPassword');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/personal/modifyPersonalInfo.js

```js
import { ClientModel, MediaModel } from '../../../../models';
import { getMediaId, omitNil, actionLog } from '../../../../utils';
import moment from 'moment';

const YEAR_TIME = 31536000000;

export default async ({
    userId,
    name,
    email,
    sex,
    address,
    head,
    birthday,
    phoneList,
}) => {
    let _head = getMediaId(head);
    let age = birthday ? Math.floor(moment().diff(moment(birthday)) / YEAR_TIME) : undefined;
    const doc = await ClientModel.findByIdAndUpdate(userId, omitNil({
        name,
        email,
        sex,
        address,
        head: _head,
        birthday,
        age,
        phoneList,
    }));
    if (!doc) {
        return { msg: '修改失败' };
    }
    if (_head) {
        MediaModel._updateRef(
            { [_head]: 1 },
            { [head && doc.head]: -1 },
        );
    }

    let context = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        populate: [{
            path: 'chairManId',
            select: { name: 1, phone: 1 },
        }],
    }).populate({
        path: 'agentId',
        populate: [{
            path: 'chairManId',
            select: { name: 1, phone: 1 },
        }],
    });

    context = context.toObject();
    context.userId = context.id;
    delete context.id;

    actionLog(userId, 'Client', userId, 'Client', 'modifyPersonalInfo');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/client/personal/modifyShipperInfo.js

```js
import { ShipperModel, ClientModel, ShipperInBranchShopModel, MediaModel } from '../../../../models';
import { getMediaId, omitNil, hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    shopId, // 所在分店
    image, // 物流公司背景图片
    sign, // 物流公司签名
    phoneList, // 物流公司联系电话
    address, // 物流公司地址
    clientPickPrice, // 自提价格 (只有 shipperType === 1 的物流公司需要设置)
    clientPickEnable, // 是否可用 (默认为不可用，只有物流公司设置了价格后才生效)
}) => {
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_SHIPPER_INFO)) {
        return { msg: '你没有修改物流公司信息的权限' };
    }
    const shipperId = member.shipperId;
    if (!shipperId) {
        return { msg: '无效操作' };
    }

    let _image = getMediaId(image);

    let shipper = await ShipperModel.findByIdAndUpdate(shipperId, omitNil({
        image: _image,
        sign,
        phoneList,
        address,
    }));
    if (!shipper) {
        return { msg: '修改失败' };
    }
    if (!_.isNil(clientPickPrice) || !_.isNil(clientPickEnable)) {
        await ShipperInBranchShopModel.findOneAndUpdate({ shipperId, shopId }, omitNil({
            clientPickPrice,
            clientPickEnable,
        }));
    }

    MediaModel._updateRef(
        { [_image]: 1 },
        { [image && shipper.image]: -1 },
    );

    shipper = await ShipperModel.findById(shipper.id)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    shipper = shipper.toObject();
    let inShop = await ShipperInBranchShopModel.findOne({ shipperId, shopId });
    if (inShop) {
        inShop = inShop.toObject();
        shipper = { ...shipper, ...inShop };
    }

    actionLog(userId, 'Client', shipper.id, 'Shipper', 'modifyShipperInfo');

    return { success: true, context: shipper };
};

```

* PDShopServer/project/App/routers/posts/client/personal/register.js

```js
import { ClientModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T, setPassword, registerUser, checkVerifyCode, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ phone, password, verifyCode }) => {
    const success = await checkVerifyCode(phone, verifyCode);
    if (!success) {
        return { msg: '无效验证码' };
    }

    let user = await ClientModel.findOne({ phone });
    if (!user) {
        user = new ClientModel({
            phone,
            registerTime: Date.now(),
        });
        const account = await AccountModel.create({ targetId: _T(user.id), type: CONSTANTS.AT_CLIENT });
        if (!account) {
            return { msg: '注册失败' };
        }
        let error = await registerUser(ClientModel, user, password);
        if (error) {
            return { msg: '注册失败' };
        }

        actionLog(user.id, 'Client', user.id, 'Client', 'register');

        return { success: true };
    } else if (!user.registerTime) {
        let error = await setPassword(user, password);
        if (error) {
            return { msg: '注册失败' };
        }
        user.registerTime = Date.now();
        await user.save();

        actionLog(user.id, 'Client', user.id, 'Client', 'register');

        return { success: true };
    }

    return { msg: '该账号已经被占用' };
};

```

* PDShopServer/project/App/routers/posts/client/personal/submitFeedback.js

```js
import { FeedbackModel } from '../../../../models';
import { actionLog } from '../../../../utils';

export default async ({ userId, content, email }) => {
    const feedback = new FeedbackModel({ clientId: userId, content, email });
    await feedback.save();

    actionLog(userId, 'Client', userId, 'Client', 'submitFeedback');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/createPreOrderGroup.js

```js
import { OrderModel, OrderGroupModel } from '../../../../models';
import { actionLog } from '../../../../utils';

export default async ({
    userId,
    startPoint,
    startPointLastCode,
    shopId,
    agentId,
    groupName, // 如果是合并，groupName应该为第一个group的名字，这里由客户端判断
    orderGroupIdList = [], // 批次列表
    orderIdList = [], // 货单列表
}) => {
    let senderId, firstGroup, totalNumbers = 0, totalWeight = 0, totalSize = 0, orderCount = 0;

    if (orderIdList.length) {
        const orderList = await OrderModel.find({ _id: { $in: orderIdList } });
        for (const order of orderList) {
            !senderId && (senderId = order.senderId);
            totalNumbers += order.totalNumbers;
            totalWeight += order.weight;
            totalSize += order.size;
            orderCount++;
        }
    }
    if (orderGroupIdList.length) {
        const orderGroupList = await OrderGroupModel.find({ _id: { $in: orderGroupIdList } });
        for (const group of orderGroupList) {
            if (!firstGroup) {
                firstGroup = group;
                !senderId && (senderId = group.senderId);
            } else {
                await group.remove();
            }
            orderIdList = orderIdList.concat(group.orderIdList);
            totalNumbers += group.totalNumbers;
            totalWeight += group.totalNumbers;
            totalSize += group.totalSize;
            orderCount += group.orderCount;
        }
    }

    if (!firstGroup) {
        firstGroup = new OrderGroupModel({ name: groupName, senderId });
    } else {
        firstGroup.name = groupName;
        firstGroup.modifyTime = Date.now();
    }
    firstGroup.startPoint = startPoint;
    firstGroup.startPointLastCode = startPointLastCode;
    firstGroup.shopId = shopId;
    firstGroup.agentId = agentId;
    firstGroup.totalNumbers = totalNumbers;
    firstGroup.totalWeight = totalWeight;
    firstGroup.totalSize = totalSize;
    firstGroup.orderCount = orderCount;
    firstGroup.orderIdList = orderIdList;

    await firstGroup.save();
    await OrderModel.update({ _id: { $in: orderIdList } }, { groupId: firstGroup.id }, { multi: true });

    actionLog(userId, 'Client', firstGroup.id, 'OrderGroup', 'createPreOrderGroup');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/getPreOrderGroupList.js

```js
import { OrderGroupModel, ClientModel } from '../../../../models';

export default async ({ userId, fromPC, pageNo, pageSize }) => {
    const sender = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
        populate: [{
            path: 'chairManId',
            select: { phone: 1 },
        }],
    })
    .populate({
        path: 'agentId',
        select: { chairManId: 1 },
        populate: [{
            path: 'chairManId',
            select: { phone: 1 },
        }],
    });
    if (!sender) {
        return { msg: '没有该用户' };
    }
    const senderId = sender.shipper ? sender.shipper.chairMan.id : sender.agent ? sender.agent.chairMan.id : userId; // 物流公司的人员预下单以物流公司的董事长为发货人
    const orderGroupList = await OrderGroupModel.find({ senderId }).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize)
    .select({
        name: 1,
        totalNumbers: 1,
        totalWeight: 1,
        totalSize: 1,
        orderCount: 1,
        shopId: 1,
        agentId: 1,
        startPoint: 1,
        startPointLastCode: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    })
    .populate({
        path: 'agentId',
        select: { name: 1 },
    });

    return { success: true, context: {
        orderGroupList,
    } };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/getPreOrderList.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({ userId, fromPC, pageNo, pageSize }) => {
    const sender = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    });
    if (!sender) {
        return { msg: '没有该用户' };
    }
    const senderId = sender.shipperId ? sender.shipper.chairManId : userId; // 物流公司的人员预下单以物流公司的董事长为发货人
    const criteria = { senderId, 'stateList.state': CONSTANTS.OS_PREORDER, groupId: { $exists: false } };
    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        name: 1,
        isCityDistribute: 1,
        endPoint: 1,
        endPointLastCode: 1,
        sendDoorEndPoint: 1,
        sendDoorEndPointLastCode: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        proxyCharge: 1,
        isReachPay: 1,
        totalDesignatedFee: 1,
        isSendDoor: 1,
        isInsuance: 1,
        startPoint: 1,
        startPointLastCode: 1,
        shopId: 1,
        agentId: 1,
        photo: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    })
    .populate({
        path: 'agentId',
        select: { name: 1 },
    });

    return { success: true, context: {
        count,
        orderList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/getPreOrderListInGroup.js

```js
import { OrderGroupModel } from '../../../../models';

export default async ({ userId, orderGroupId }) => {
    const group = await OrderGroupModel.findById(orderGroupId)
    .populate({
        path: 'orderIdList',
        select: {
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            name: 1,
            isCityDistribute: 1,
            endPoint: 1,
            endPointLastCode: 1,
            sendDoorEndPoint: 1,
            sendDoorEndPointLastCode: 1,
            totalNumbers: 1,
            weight: 1,
            size: 1,
            proxyCharge: 1,
            isReachPay: 1,
            totalDesignatedFee: 1,
            isSendDoor: 1,
            isInsuance: 1,
            startPoint: 1,
            startPointLastCode: 1,
            shopId: 1,
            agentId: 1,
        },
        populate: [{
            path: 'shopId',
            select: { name: 1 },
        }, {
            path: 'agentId',
            select: { name: 1 },
        }],
    });
    if (!group) {
        return { msg: '没有该批次' };
    }

    return { success: true, context: {
        orderList: group.orderIdList,
    } };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/modifyPreOrder.js

```js
import _ from 'lodash';
import { OrderModel, OrderGroupModel, ClientModel, MediaModel } from '../../../../models';
import { getMediaId, omitNil, actionLog } from '../../../../utils';
import { setting } from '../../../../manager';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderId,
    orderGroupId,
    senderName,
    receiverPhone,
    receiverName,
    name,
    shopId, // 指定的某家分店 (必传参数)
    agentId, // 指定的某家收货点(必传参数)
    startPoint, // 起点
    startPointLastCode, // 起点 lastCode
    isCityDistribute, // 是否是同城配送
    endPoint, // 终点，精确到镇级别
    endPointLastCode, // 终点镇级代码
    sendDoorEndPoint,
    sendDoorEndPointLastCode,
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, // 一票货总的方量
    isSendDoor, // 是否送货上门
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee, // 指定向收货人应该收多少钱
    proxyCharge, // 代收货款金额
    isInsuance, // 是否保价
    photo, // 图片
}) => {
    let receiverId;
    if (receiverPhone) {
        receiverId = await ClientModel.checkExistElseCreate(receiverPhone, receiverName);
        if (!receiverId) {
            return { msg: '系统创建账号错误，请重试' };
        }
    }
    const _startPoint = (shopId || agentId || startPointLastCode) ?
    { shopId: undefined, agentId: undefined, startPoint, startPointLastCode, ...(shopId ? { shopId } : agentId ? { agentId } : {}) } :
    {};

    const _photo = getMediaId(photo);
    const doc = await OrderModel.findOneAndUpdate({ _id: orderId, 'stateList.state': CONSTANTS.OS_PREORDER }, {
        ..._startPoint,
        ...omitNil({
            senderName,
            receiverId,
            receiverPhone,
            receiverName,
            name,
            isCityDistribute,
            endPoint,
            endPointLastCode,
            sendDoorEndPoint,
            sendDoorEndPointLastCode,
            totalNumbers,
            weight,
            size,
            isSendDoor,
            proxyCharge,
            proxyChargeProfit: proxyCharge !== undefined ? Math.ceil(proxyCharge * setting.proxyChargeProfitRate) : undefined,
            isReachPay,
            payMode: isReachPay !== undefined ? (isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE) : undefined,
            totalDesignatedFee,
            isInsuance,
            photo: _photo,
        }),
    });
    if (!doc) {
        return { msg: '修改失败' };
    }
    if (orderGroupId) {
        const options = _.omitBy({ totalNumbers: totalNumbers - doc.totalNumbers, weight: weight - doc.weight, size: size - doc.size }, o => !o);
        if (_.size(options)) {
            await OrderGroupModel.findByIdAndUpdate(orderGroupId, { $inc: options });
        }
    }

    MediaModel._updateRef(
        { [_photo]: 1 },
        { [photo && doc.photo]: -1 },
    );
    actionLog(userId, 'Client', orderId, 'Order', 'modifyPreOrder');

    const context = await OrderModel.findById(orderId)
    .select({
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        name: 1,
        isCityDistribute: 1,
        endPoint: 1,
        endPointLastCode: 1,
        sendDoorEndPoint: 1,
        sendDoorEndPointLastCode: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        proxyCharge: 1,
        isReachPay: 1,
        totalDesignatedFee: 1,
        isSendDoor: 1,
        isInsuance: 1,
        startPoint: 1,
        startPointLastCode: 1,
        shopId: 1,
        agentId: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    })
    .populate({
        path: 'agentId',
        select: { name: 1 },
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/modifyPreOrderGroup.js

```js
import { OrderGroupModel } from '../../../../models';
import { omitNil, actionLog } from '../../../../utils';

export default async ({
    userId,
    orderGroupId,
    startPoint,
    startPointLastCode,
    shopId,
    agentId,
    groupName,
}) => {
    const _startPoint = (shopId || agentId || startPointLastCode) ?
    { shopId: undefined, agentId: undefined, startPoint, startPointLastCode, ...(shopId ? { shopId } : agentId ? { agentId } : {}) } :
    {};

    const group = await OrderGroupModel.findByIdAndUpdate(orderGroupId, {
        ..._startPoint,
        ...omitNil({
            name: groupName,
        }),
    });
    if (!group) {
        return { msg: '没有该货单批次' };
    }
    actionLog(userId, 'Client', orderGroupId, 'OrderGroup', 'modifyPreOrderGroup');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/placePreOrder.js

```js
import { OrderModel, ClientModel, MediaModel } from '../../../../models';
import { actionLog, getMediaId } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { setting } from '../../../../manager';

export default async ({
    userId,
    senderName,
    receiverPhone,
    receiverName,
    name,
    shopId, // 指定的某家分店
    agentId, // 指定的某家收货点
    startPoint, // 起点
    startPointLastCode, // 起点 lastCode
    isCityDistribute, // 是否是同城配送
    endPoint, // 终点，精确到镇级别
    endPointLastCode, // 终点镇级代码
    sendDoorEndPoint, // 送货上门地址，精确到镇级别
    sendDoorEndPointLastCode, // 送货上门地址镇级代码
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, // 一票货总的方量
    isSendDoor, // 是否送货上门
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee = 0, // 指定向收货人应该收多少钱
    proxyCharge = 0, // 代收货款金额
    isInsuance, // 是否保价
    photo, // 图片
}) => {
    const receiverId = await ClientModel.checkExistElseCreate(receiverPhone, receiverName);
    if (!receiverId) {
        return { msg: '系统创建账号错误，请重试' };
    }

    const _photo = getMediaId(photo);
    const sender = await ClientModel.findById(userId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
        populate: [{
            path: 'chairManId',
            select: { phone: 1 },
        }],
    })
    .populate({
        path: 'agentId',
        select: { chairManId: 1 },
        populate: [{
            path: 'chairManId',
            select: { phone: 1 },
        }],
    });
    const senderId = sender.shipper ? sender.shipper.chairMan.id : sender.agent ? sender.agent.chairMan.id : userId; // 物流公司的人员预下单以物流公司的董事长为发货人
    const senderPhone = sender.shipper ? sender.shipper.chairMan.phone : sender.agent ? sender.agent.chairMan.phone : sender.phone; // 物流公司的人员预下单以物流公司的董事长为发货人
    const doc = new OrderModel({
        shopId,
        agentId,
        startPoint,
        startPointLastCode,
        senderId,
        senderPhone,
        senderName,
        isSenderRepresentShipper: !!sender.shipper,
        receiverId,
        receiverPhone,
        receiverName,
        name,
        isCityDistribute,
        endPoint,
        endPointLastCode,
        sendDoorEndPoint,
        sendDoorEndPointLastCode,
        totalNumbers,
        weight,
        size,
        isSendDoor,
        proxyCharge: Math.floor(proxyCharge),
        proxyChargeProfit: Math.floor(proxyCharge * setting.proxyChargeProfitRate),
        isReachPay,
        payMode: isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE,
        totalDesignatedFee: Math.floor(totalDesignatedFee),
        isInsuance,
        stateList: [ { state: CONSTANTS.OS_PREORDER, count: totalNumbers } ],
        photo: _photo,
    });
    await doc.save();
    MediaModel._updateRef(
        { [_photo]: 1 },
    );
    actionLog(userId, 'Client', doc.id, 'Order', 'placePreOrder');

    const context = await OrderModel.findById(doc.id)
    .select({
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        name: 1,
        isCityDistribute: 1,
        endPoint: 1,
        endPointLastCode: 1,
        sendDoorEndPoint: 1,
        sendDoorEndPointLastCode: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        proxyCharge: 1,
        isReachPay: 1,
        totalDesignatedFee: 1,
        isSendDoor: 1,
        isInsuance: 1,
        startPoint: 1,
        startPointLastCode: 1,
        shopId: 1,
        agentId: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    })
    .populate({
        path: 'agentId',
        select: { name: 1 },
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/removePreOrder.js

```js
import { OrderModel } from '../../../../models';
import { actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderId,
}) => {
    await OrderModel.findOneAndRemove({ _id: orderId, 'stateList.state': CONSTANTS.OS_PREORDER });

    actionLog(userId, 'Client', orderId, 'Order', 'removePreOrder');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/preOrder/removePreOrderFromGroup.js

```js
import { OrderModel, OrderGroupModel } from '../../../../models';
import { actionLog } from '../../../../utils';

export default async ({ userId, orderIdList, orderGroupId }) => {
    const orderList = await OrderModel.find({ _id: { $in: orderIdList } });
    let totalNumbers = 0, totalWeight = 0, totalSize = 0;
    for (const order of orderList) {
        totalNumbers += order.totalNumbers;
        totalWeight += order.weight;
        totalSize += order.size;
    }

    await OrderModel.update({ _id: { $in: orderIdList } }, { $unset: { groupId: 1 } }, { multi: true });
    const group = await OrderGroupModel.findByIdAndUpdate(orderGroupId, { $inc: {
        totalNumbers: -totalNumbers,
        totalWeight: -totalWeight,
        totalSize: -totalSize,
        orderCount: -1,
    }, $pull: { orderIdList: { $in: orderIdList } } }, { new: true });
    if (!group) {
        return { msg: '没有该货单批次' };
    }

    if (!group.orderIdList.length) {
        await group.remove();
    }

    actionLog(userId, 'Client', orderGroupId, 'OrderGroup', 'removePreOrderFromGroup');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/client/roadmap/getRoadmapDetail.js

```js
import { RoadmapModel } from '../../../../models';

export default async ({ userId, roadmapId }) => {
    const context = await RoadmapModel.findById(roadmapId).select({
        name: 1,
        shipperId: 1,
        startPoint: 1,
        endPoint: 1,
        transitPoint: 1,
        type: 1,
        price: 1,
        duration: 1,
        truckId: 1,
        remark: 1,
        modifyTime: 1,
    }).populate({
        path: 'truckId',
        select: {
            name: 1,
            plateNo: 1,
            capacity: 1,
            width: 1,
            height: 1,
            length: 1,
            remark: 1,
        },
    });
    if (!context) {
        return { msg: '没有该线路' };
    }

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/client/roadmap/getRoadmapListWithEndPoint.js

```js
import mongoose from 'mongoose';
import { RoadmapModel, ShopModel, AgentModel, AgentRegionProfitModel } from '../../../../models';
import { getRegionProfitRateByEndPoint } from '../../libs/roadmap';
import { _N } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    fromPC,
    startPointLastCode, // 始发地的lastCode，如果有 agentId 或者 shopId，该字段无效
    shopId, // 分店Id
    agentId, // 收货点Id
    endPointLastCode, // 终点code
    sendDoorEndPointLastCode, // 送货上门终点code
    isCityDistribute, // 是否送货上门
    isSendDoor, // 是否送货上门
    location, // 我的位置
    orderBy, // 排序方式，0：价格排序，1：时间排序，2：亲签率排序，3：距离排序
    pageNo,
    pageSize,
}) => {
    let sort = { price: 1, duration: 1, selfSignRate: -1 };
    if (orderBy === 1) {
        sort = { duration: 1, price: 1, selfSignRate: -1 };
    } else if (orderBy === 2) {
        sort = { selfSignRate: -1, price: 1, duration: 1 };
    }
    // 始发地为分店的情况
    if (shopId) {
        const shopList = await ShopModel.aggregate()
        .near({
            near: location,
            distanceField: 'dist.calculated',
        })
        .match({ _id: new mongoose.Types.ObjectId(shopId) })
        .project({
            distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
            name: 1,
            address: 1,
        });

        const count = (fromPC && pageNo === 0) ? await RoadmapModel.count({ shopId, endPointLastCode, enable: true }) : undefined;
        const shop = shopList[0];
        if (!shop) {
            return { msg: '没有该分店' };
        }
        const regionProfitRate = await getRegionProfitRateByEndPoint(shopId, endPointLastCode, isCityDistribute);

        const roadmaps = await RoadmapModel.aggregate()
        .match({ shopId: new mongoose.Types.ObjectId(shopId), endPointLastCode, enable: true })
        .project({
            rate: { $sum: [ 1, { $ifNull: [ '$profitRate', regionProfitRate ] } ] },
            sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
            shipperId: 1,
            price: 1,
            minFee: 1,
            selfSignRate: 1,
            duration: 1,
        })
        .project({
            sendDoorEnable: '$sendDoor.enable',
            sendDoorPrice: '$sendDoor.sendDoorPrice',
            sendDoorMinFee: '$sendDoor.sendDoorMinFee',
            shipperId: 1,
            rate: 1,
            price: 1,
            minFee: 1,
            selfSignRate: 1,
            duration: 1,
        })
        .match(isSendDoor ? { sendDoorEnable: true } : {})
        .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: '_shipper' })
        .project({
            id: '$_id',
            _id: 0,
            shipperName: { $arrayElemAt: ['$_shipper.name', 0] },
            price: { $multiply: [ '$rate', '$price' ] },
            minFee: { $multiply: [ '$rate', '$minFee' ] },
            sendDoorPrice: { $multiply: [ '$rate', '$sendDoorPrice' ] },
            sendDoorMinFee: { $multiply: [ '$rate', '$sendDoorMinFee' ] },
            shopName: { $concat: shop.name },
            shopAddress: { $concat: shop.address },
            distance: { $abs: shop.distance },
            selfSignRate: 1,
            duration: 1,
        }).sort(sort)
        .skip(pageNo * pageSize)
        .limit(pageSize);

        return { success: true, context: { shop: {
            count,
            roadmapList: roadmaps,
        } } };
    };

    // 始发地为收货点的情况
    if (agentId) {
        const agents = await AgentModel.aggregate()
        .near({
            near: location,
            distanceField: 'dist.calculated',
        })
        .match({ _id: new mongoose.Types.ObjectId(agentId) })
        .project({
            distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
            name: 1,
            address: 1,
            referShopId: 1,
            roadmapProfitRate: 1,
        });
        if (!agents.length) {
            return { msg: '没有相关收货点' };
        }
        const agent = agents[0];
        const regionProfitRate = await getRegionProfitRateByEndPoint(agent.referShopId, endPointLastCode, isCityDistribute);

        const roadmaps = await RoadmapModel.aggregate()
        .match({ shopId: agent.referShopId, endPointLastCode, enable: true })
        .project({
            sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
            rate: { $sum: [ 1, { $ifNull: [ '$profitRate', regionProfitRate ] } ] },
            shipperId: 1,
            price: 1,
            minFee: 1,
            selfSignRate: 1,
            duration: 1,
        })
        .project({
            sendDoorEnable: '$sendDoor.enable',
            sendDoorPrice: '$sendDoor.sendDoorPrice',
            sendDoorMinFee: '$sendDoor.sendDoorMinFee',
            shipperId: 1,
            rate: 1,
            price: 1,
            minFee: 1,
            selfSignRate: 1,
            duration: 1,
        })
        .match(isSendDoor ? { sendDoorEnable: true } : {})
        .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
        .project({
            id: '$_id',
            _id: 0,
            shipperName: { $arrayElemAt: ['$shipper.name', 0] },
            price: { $multiply: [ '$rate', '$price' ] },
            minFee: { $multiply: [ '$rate', '$minFee' ] },
            sendDoorPrice: { $multiply: [ '$rate', '$sendDoorPrice' ] },
            sendDoorMinFee: { $multiply: [ '$rate', '$sendDoorMinFee' ] },
            selfSignRate: 1,
            duration: 1,
        })
        .sort(sort)
        .limit(1);

        const roadmapList = [];
        const roadmap = roadmaps[0];
        if (roadmap) {
            const rateModel = await AgentRegionProfitModel.findOne({ agentId: agent._id, roadmapId: roadmap.id });
            const rate = Math.max((rateModel && rateModel.profitRate || 0), agent.roadmapProfitRate) + 1;
            roadmap.price = _N(roadmap.price * rate);
            roadmap.minFee = _N(roadmap.minFee * rate);
            roadmap.distance = agent.distance;
            roadmap.agentName = agent.name;
            roadmap.agentAddress = agent.address;
            roadmap.shipperName = roadmap.shipperName;

            roadmapList.push(roadmap);
        }

        return { success: true, context: { agent: { roadmapList } } };
    }

    // 始发地为城市范围的情况
    const shopList = await ShopModel.aggregate()
    .near({
        near: location,
        distanceField: 'dist.calculated',
    })
    .match({ addressRegionLastCode: startPointLastCode, isMasterShop: false })
    .project({
        distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
        name: 1,
        address: 1,
    });
    for (const shop of shopList) {
        shop.regionProfitRate = await getRegionProfitRateByEndPoint(shop.id, endPointLastCode, isCityDistribute);
    }

    const count = (fromPC && pageNo === 0) ? await RoadmapModel.count({ shopId: { $in: shopList.map(o => o._id) }, endPointLastCode, enable: true }) : undefined;
    const roadmapListInShop = await RoadmapModel.aggregate()
    .match({ shopId: { $in: shopList.map(o => o._id) }, endPointLastCode, enable: true })
    .project({
        shop: { $arrayElemAt: [ shopList, { $indexOfArray: [ shopList.map(o => o._id), '$shopId' ] } ] },
        sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
        rate: { $sum: [ 1, { $ifNull: [ '$profitRate', '$shop.regionProfitRate' ] } ] },
        shipperId: 1,
        price: 1,
        minFee: 1,
        selfSignRate: 1,
        duration: 1,
    })
    .project({
        rate: 1,
        shopName: '$shop.name',
        shopAddress: '$shop.address',
        distance: '$shop.distance',
        sendDoorEnable: '$sendDoor.enable',
        sendDoorPrice: '$sendDoor.sendDoorPrice',
        sendDoorMinFee: '$sendDoor.sendDoorMinFee',
        shipperId: 1,
        price: 1,
        minFee: 1,
        selfSignRate: 1,
        duration: 1,
    })
    .match(isSendDoor ? { sendDoorEnable: true } : {})
    .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: '_shipper' })
    .project({
        id: '$_id',
        _id: 0,
        shipperName: { $arrayElemAt: ['$_shipper.name', 0] },
        price: { $multiply: [ '$rate', '$price' ] },
        minFee: { $multiply: [ '$rate', '$minFee' ] },
        sendDoorPrice: { $multiply: [ '$rate', '$sendDoorPrice' ] },
        sendDoorMinFee: { $multiply: [ '$rate', '$sendDoorMinFee' ] },
        shopName: 1,
        shopAddress: 1,
        distance: 1,
        selfSignRate: 1,
        duration: 1,
    })
    .sort(sort)
    .skip(pageNo * pageSize)
    .limit(pageSize);

    // 收货点的部分
    let roadmapListInAgent = [];
    if (pageNo === 0) { // 收货点不采取分页模式
        const agents = await AgentModel.aggregate()
        .near({
            near: location,
            distanceField: 'dist.calculated',
        })
        .match({ addressRegionLastCode: startPointLastCode })
        .project({
            distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
            name: 1,
            address: 1,
            referShopId: 1,
            roadmapProfitRate: 1,
        });

        for (const agent of agents) {
            const regionProfitRate = await getRegionProfitRateByEndPoint(agent.referShopId, endPointLastCode, isCityDistribute);
            const roadmaps = await RoadmapModel.aggregate()
            .match({ shopId: agent.referShopId, endPointLastCode, enable: true })
            .project({
                sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
                rate: { $sum: [ 1, { $ifNull: [ '$profitRate', regionProfitRate ] } ] },
                shipperId: 1,
                price: 1,
                minFee: 1,
                selfSignRate: 1,
                duration: 1,
            })
            .project({
                sendDoorEnable: '$sendDoor.enable',
                sendDoorPrice: '$sendDoor.sendDoorPrice',
                sendDoorMinFee: '$sendDoor.sendDoorMinFee',
                shipperId: 1,
                rate: 1,
                price: 1,
                minFee: 1,
                selfSignRate: 1,
                duration: 1,
            })
            .match(isSendDoor ? { sendDoorEnable: true } : {})
            .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
            .project({
                id: '$_id',
                _id: 0,
                shipperName: { $arrayElemAt: ['$shipper.name', 0] },
                price: { $multiply: [ '$rate', '$price' ] },
                minFee: { $multiply: [ '$rate', '$minFee' ] },
                sendDoorPrice: { $multiply: [ '$rate', '$sendDoorPrice' ] },
                sendDoorMinFee: { $multiply: [ '$rate', '$sendDoorMinFee' ] },
                selfSignRate: 1,
                duration: 1,
            })
            .sort(sort)
            .limit(1);

            const roadmap = roadmaps[0];
            if (roadmap) {
                const rateModel = await AgentRegionProfitModel.findOne({ agentId: agent._id, roadmapId: roadmap.id });
                const rate = Math.max((rateModel && rateModel.profitRate || 0), agent.roadmapProfitRate) + 1;
                roadmap.price = _N(roadmap.price * rate);
                roadmap.minFee = _N(roadmap.minFee * rate);
                roadmap.distance = agent.distance;
                roadmap.agentName = agent.name;
                roadmap.agentAddress = agent.address;
                roadmap.shipperName = roadmap.shipperName;
                roadmap.id = agent.id;

                roadmapListInAgent.push(roadmap);
            }
        }

        // 对收货点的路线排序
        if (orderBy === 0) {
            roadmapListInAgent = _.sortBy(roadmapListInAgent, o => o.price);
        } else if (orderBy === 1) {
            roadmapListInAgent = _.sortBy(roadmapListInAgent, o => o.duration);
        } else if (orderBy === 2) {
            roadmapListInAgent = _.sortBy(roadmapListInAgent, o => o.selfSignRate);
        }
    }

    return { success: true, context: {
        shop: {
            count,
            roadmapList: roadmapListInShop,
        },
        agent: {
            roadmapList: roadmapListInAgent,
        },
    } };
};

```

* PDShopServer/project/App/routers/posts/client/roadmap/getRoadmapListWithPreOrder.js

```js
import mongoose from 'mongoose';
import { OrderModel, ShopModel, AgentModel, AgentRegionProfitModel } from '../../../../models';
import { searchRoadmapListWithShop, searchRoadmapListWithShopList } from '../../libs/roadmap';
import { _N } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderId, // 预下单单号
    location, // 我的位置
    orderBy, // 排序方式，0：价格排序，1：时间排序，2：亲签率排序，3：距离排序
    fromPC,
    pageNo,
    pageSize,
}) => {
    const order = await OrderModel.findById(orderId);
    if (!order) {
        return { msg: '没有该货单' };
    }
    const {
        startPointLastCode, // 省市（只对预下单有用）
        shopId, // 指定的分店
        agentId, // 指定的收货点
        endPointLastCode, // 终点
        sendDoorEndPointLastCode, // 送货上门终点
        isCityDistribute, // 是否同城配送
        isSendDoor, // 是否送货上门
        weight, // 重量
        size, // 方量
        proxyCharge, // 代收货款金额
        isReachPay, // 是否是到付
        totalDesignatedFee, //指定向收货人应该收多少钱
    } = order;

    // 始发地为分店的情况
    if (shopId) {
        const shops = await ShopModel.aggregate()
        .near({
            near: location,
            distanceField: 'dist.calculated',
        })
        .match({ _id: new mongoose.Types.ObjectId(shopId) })
        .project({
            distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
            name: 1,
            address: 1,
        }).limit(1);
        const shop = shops[0];

        const context = await searchRoadmapListWithShop({
            shopId,
            distance: shop.distance,
            shopName: shop.name,
            shopAddress: shop.address,
            fromPC,
            pageNo,
            pageSize,
            endPointLastCode,
            sendDoorEndPointLastCode,
            isCityDistribute,
            isSendDoor,
            weight,
            size,
            proxyCharge,
            isReachPay,
            totalDesignatedFee,
            orderBy,
        });
        return { success: true, context: { shop: context } };
    };

    // 始发地为收货点的情况
    if (agentId) {
        const agents = await AgentModel.aggregate()
        .near({
            near: location,
            distanceField: 'dist.calculated',
        })
        .match({ _id: new mongoose.Types.ObjectId(agentId) })
        .lookup({ from: 'shops', localField: 'referShopId', foreignField: '_id', as: 'shop' })
        .project({
            distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
            roadmapProfitRate: 1,
            referShopId: { $arrayElemAt: ['$shop._id', 0] },
            name: 1,
            address: 1,
        });
        const agent = agents[0];

        let { roadmapList } = await searchRoadmapListWithShop({
            shopId: agent.referShopId,
            distance: agent.distance,
            pageNo: 0,
            pageSize: 1,
            endPointLastCode,
            sendDoorEndPointLastCode,
            isCityDistribute,
            isSendDoor,
            weight,
            size,
            proxyCharge,
            isReachPay,
            totalDesignatedFee,
            orderBy,
        });

        if (roadmapList.length) {
            const roadmap = roadmapList[0];
            const rateModel = await AgentRegionProfitModel.findOne({ agentId, roadmapId: roadmap.id });
            const rate = Math.max((rateModel && rateModel.profitRate || 0), agent.roadmapProfitRate) + 1;
            roadmap.id = agent._id;
            roadmap.agentName = agent.name;
            roadmap.agentAddress = agent.address;
            roadmap.transportFee = _N(roadmap.transportFee * rate);
            roadmap.price = _N(roadmap.price * rate);
            roadmap.minFee = _N(roadmap.minFee * rate);
        }

        return { success: true, context: { agent: { roadmapList } } };
    }

    // 始发地为城市范围的情况
    const shopList = await ShopModel.aggregate()
    .near({
        near: location,
        distanceField: 'dist.calculated',
    })
    .match({ addressRegionLastCode: startPointLastCode, isMasterShop: false })
    .project({
        id: '$_id',
        _id: 0,
        distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
        name: 1,
        address: 1,
    });
    const roadmapListInShop = await searchRoadmapListWithShopList({
        shopList,
        fromPC,
        pageNo,
        pageSize,
        endPointLastCode,
        sendDoorEndPointLastCode,
        isCityDistribute,
        isSendDoor,
        weight,
        size,
        proxyCharge,
        isReachPay,
        totalDesignatedFee,
        orderBy,
    });

    let roadmapListInAgent = [];
    if (pageNo === 0) { // 收货点不采取分页模式
        const agents = await AgentModel.aggregate()
        .near({
            near: location,
            distanceField: 'dist.calculated',
        })
        .match({ addressRegionLastCode: startPointLastCode })
        .lookup({ from: 'shops', localField: 'referShopId', foreignField: '_id', as: 'shop' })
        .project({
            distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
            roadmapProfitRate: 1,
            referShopId: { $arrayElemAt: ['$shop._id', 0] },
            name: 1,
            address: 1,
        });

        for (const agent of agents) {
            if (!agent.referShopId) {
                continue;
            }
            const { roadmapList } = await searchRoadmapListWithShop({
                shopId: agent.referShopId,
                distance: agent.distance,
                pageNo: 0,
                pageSize: 1,
                endPointLastCode,
                sendDoorEndPointLastCode,
                isCityDistribute,
                isSendDoor,
                weight,
                size,
                proxyCharge,
                isReachPay,
                totalDesignatedFee,
                orderBy,
            });
            const roadmap = roadmapList[0];
            if (roadmap) {
                const rateModel = await AgentRegionProfitModel.findOne({ agentId, roadmapId: roadmap.id });
                const rate = Math.max((rateModel && rateModel.profitRate || 0), agent.roadmapProfitRate) + 1;
                roadmap.id = agent._id;
                roadmap.agentName = agent.name;
                roadmap.agentAddress = agent.address;
                roadmap.transportFee = _N(roadmap.transportFee * rate);
                roadmap.price = _N(roadmap.price * rate);
                roadmap.minFee = _N(roadmap.minFee * rate);
                roadmapListInAgent.push(roadmap);
            }
        }
    }
    return { success: true, context: {
        shop: roadmapListInShop,
        agent: { roadmapList: roadmapListInAgent },
    } };
};

```

* PDShopServer/project/App/routers/posts/client/roadmap/getRoadmapListWithPreOrderGroup.js

```js
import mongoose from 'mongoose';
import { OrderGroupModel, ShopModel, AgentModel, AgentRegionProfitModel } from '../../../../models';
import { searchRoadmapListWithShop } from '../../libs/roadmap';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderGroupId, // 预下单单号
    location, // 我的位置
    fromPC,
}) => {
    const orderGroup = await OrderGroupModel.findById(orderGroupId)
    .populate({
        path: 'orderIdList',
        select: {
            name: 1,
            endPoint: 1,
            endPointLastCode: 1,
            sendDoorEndPoint: 1,
            sendDoorEndPointLastCode: 1,
            isSendDoor: 1,
            totalNumbers: 1,
            weight: 1,
            size: 1,
            proxyCharge: 1,
            isReachPay: 1,
            totalDesignatedFee: 1,
        },
    });
    if (!orderGroup) {
        return { msg: '没有该货单群组' };
    }
    const {
        startPointLastCode, // 省市（只对预下单有用）
        shopId, // 指定的分店
        agentId, // 指定的收货点
        orderIdList, //货单列表
    } = orderGroup;

    // 始发地为分店的情况
    if (shopId) {
        const shops = await ShopModel.aggregate()
        .near({
            near: location,
            distanceField: 'dist.calculated',
        })
        .match({ _id: new mongoose.Types.ObjectId(shopId) })
        .project({
            id: '$_id',
            _id: 0,
            distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
            name: 1,
            address: 1,
        }).limit(1);
        const shop = shops[0];

        const unfindOrderList = [];
        let totalTransportFee = 0;
        for (const order of orderIdList) {
            const { roadmapList } = await searchRoadmapListWithShop({
                shopId,
                distance: shop.distance,
                shopName: shop.name,
                shopAddress: shop.address,
                pageNo: 0,
                pageSize: 1,
                endPointLastCode: order.endPointLastCode,
                sendDoorEndPointLastCode: order.sendDoorEndPointLastCode,
                isCityDistribute: order.isCityDistribute,
                isSendDoor: order.isSendDoor,
                weight: order.weight,
                size: order.size,
                proxyCharge: order.proxyCharge,
                isReachPay: order.isReachPay,
                totalDesignatedFee: order.totalDesignatedFee,
                orderBy: 0,
            });
            if (!roadmapList.length) {
                unfindOrderList.push(order);
            } else {
                totalTransportFee += roadmapList[0].transportFee;
            }
        }

        return { success: true, context: { shopList: [{
            totalTransportFee,
            name: shop.name,
            address: shop.address,
            distance: shop.distance,
            unfindOrderList,
        }] } };
    };

    // 始发地为收货点的情况
    if (agentId) {
        const agents = await AgentModel.aggregate()
        .near({
            near: location,
            distanceField: 'dist.calculated',
        })
        .match({ _id: new mongoose.Types.ObjectId(agentId) })
        .lookup({ from: 'shops', localField: 'referShopId', foreignField: '_id', as: 'shop' })
        .project({
            id: '$_id',
            _id: 0,
            distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
            referShopId: { $arrayElemAt: ['$shop._id', 0] },
            name: 1,
            address: 1,
        });
        const agent = agents[0];

        const unfindOrderList = [];
        let totalTransportFee = 0;
        for (const order of orderIdList) {
            const { roadmapList } = await searchRoadmapListWithShop({
                shopId: agent.referShopId,
                distance: agent.distance,
                pageNo: 0,
                pageSize: 1,
                endPointLastCode: order.endPointLastCode,
                sendDoorEndPointLastCode: order.sendDoorEndPointLastCode,
                isCityDistribute: order.isCityDistribute,
                isSendDoor: order.isSendDoor,
                weight: order.weight,
                size: order.size,
                proxyCharge: order.proxyCharge,
                isReachPay: order.isReachPay,
                totalDesignatedFee: order.totalDesignatedFee,
                orderBy: 0,
            });
            if (!roadmapList.length) {
                unfindOrderList.push(order);
            } else {
                const roadmap = roadmapList[0];
                const profitRate = await AgentRegionProfitModel.findOne({ agentId, roadmapId: roadmap.id });
                const rate = Math.max((profitRate && profitRate.profitRate || 0), agent.roadmapProfitRate) + 1;
                totalTransportFee += roadmapList[0].transportFee * rate;
            }
        }

        return { success: true, context: { agentList: [{
            totalTransportFee,
            id: agent.id,
            name: agent.name,
            address: agent.address,
            distance: agent.distance,
            unfindOrderList,
        }] } };
    }

    // 始发地为城市范围的情况
    const shops = await ShopModel.aggregate()
    .near({
        near: location,
        distanceField: 'dist.calculated',
    })
    .match({ addressRegionLastCode: startPointLastCode, isMasterShop: false })
    .project({
        id: '$_id',
        _id: 0,
        distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
        name: 1,
        address: 1,
    });

    const shopList = [];
    for (const shop of shops) {
        const unfindOrderList = [];
        let totalTransportFee = 0;
        for (const order of orderIdList) {
            const { roadmapList } = await searchRoadmapListWithShop({
                shopId: shop.id,
                distance: shop.distance,
                shopName: shop.name,
                shopAddress: shop.address,
                pageNo: 0,
                pageSize: 1,
                endPointLastCode: order.endPointLastCode,
                sendDoorEndPointLastCode: order.sendDoorEndPointLastCode,
                isCityDistribute: order.isCityDistribute,
                isSendDoor: order.isSendDoor,
                weight: order.weight,
                size: order.size,
                proxyCharge: order.proxyCharge,
                isReachPay: order.isReachPay,
                totalDesignatedFee: order.totalDesignatedFee,
                orderBy: 0,
            });
            if (!roadmapList.length) {
                unfindOrderList.push(order);
            } else {
                totalTransportFee += roadmapList[0].transportFee;
            }
        }
        shopList.push({
            totalTransportFee,
            id: shop.id,
            name: shop.name,
            address: shop.address,
            distance: shop.distance,
            unfindOrderList,
        });
    }

    // 收货点部分
    const agents = await AgentModel.aggregate()
    .near({
        near: location,
        distanceField: 'dist.calculated',
    })
    .match({ addressRegionLastCode: startPointLastCode })
    .lookup({ from: 'shops', localField: 'referShopId', foreignField: '_id', as: 'shop' })
    .project({
        id: '$_id',
        _id: 0,
        distance: { $multiply: [ '$dist.calculated', CONSTANTS.KILOMETRE_RADIAN_RATE ] },
        referShopId: { $arrayElemAt: ['$shop._id', 0] },
        roadmapProfitRate: 1,
        name: 1,
        address: 1,
    });

    const agentList = [];
    for (const agent of agents) {
        const unfindOrderList = [];
        let totalTransportFee = 0;
        for (const order of orderIdList) {
            const { roadmapList } = await searchRoadmapListWithShop({
                shopId: agent.referShopId,
                distance: agent.distance,
                pageNo: 0,
                pageSize: 1,
                endPointLastCode: order.endPointLastCode,
                sendDoorEndPointLastCode: order.sendDoorEndPointLastCode,
                isCityDistribute: order.isCityDistribute,
                isSendDoor: order.isSendDoor,
                weight: order.weight,
                size: order.size,
                proxyCharge: order.proxyCharge,
                isReachPay: order.isReachPay,
                totalDesignatedFee: order.totalDesignatedFee,
                orderBy: 0,
            });
            if (!roadmapList.length) {
                unfindOrderList.push(order);
            } else {
                const roadmap = roadmapList[0];
                const profitRate = await AgentRegionProfitModel.findOne({ agentId, roadmapId: roadmap.id });
                const rate = Math.max((profitRate && profitRate.profitRate || 0), agent.roadmapProfitRate) + 1;
                totalTransportFee += roadmapList[0].transportFee * rate;
            }
        }

        agentList.push({
            totalTransportFee,
            id: agent.id,
            name: agent.name,
            address: agent.address,
            distance: agent.distance,
            unfindOrderList,
        });
    }
    return { success: true, context: {
        shopList,
        agentList,
    } };
};

```

* PDShopServer/project/App/routers/posts/client/weixinPay/getUnifiedOrder.js

```js
import { ClientModel, WeixinPayModel } from '../../../../models';
import { _F, _T, hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
import api from '../../libs/weixinPay/api';
import config from '../../../../../config';
import { rechargeForClient } from '../../libs/account';

export default async ({
    userId,
    amount, // 单位：元
    body, //商品描述
}, req) => {
    amount = _F(amount);
    if (config.hasNoRealPayment) {
        return rechargeForClient({ userId, amount, thirdpartyAccount: 'SIMULATION_NO' });
    }
    amount = amount / config.weixinPayRate;
    if (amount < 1) {
        return { msg: '充值金额必须大于' + config.weixinPayRate / 100 };
    }
    return new Promise(async resolve => {
        const client = await ClientModel.findById(userId);
        if (!client) {
            return resolve({ msg: '你没有充值的权限' });
        }
        if (client.shipperId && !hasAuthority(client, CONSTANTS.AH_RECHARGE)) {
            return resolve({ msg: '你没有充值的权限' });
        }

        const spbill_create_ip = req.get('X-Real-IP') || req.get('X-Forwarded-For') || req.ip;
        const order = new WeixinPayModel({
            clientId: userId,
            spbill_create_ip,
            body,
            trade_type: 'APP',
            total_fee: amount,
        });

        const params = {
            spbill_create_ip,
            body,
            out_trade_no: _T(order.out_trade_no),
            total_fee: amount,
            trade_type: 'APP',
        };
        const result = await api.unifiedorder(params);
        if (result.success) {
            order.prepay_id = result.context.prepayid;
            order.appid = result.context.appid;
            order.mch_id = result.context.partnerid;
            order.timestamp = result.context.timestamp;
            order.nonce_str = result.context.noncestr;
            order.package = result.context.package;
            await order.save();
        }

        actionLog(userId, 'Client', amount, 'Number', 'getUnifiedOrder');

        return resolve(result);
    });
};

```

* PDShopServer/project/App/routers/posts/client/weixinPay/getUnifiedOrderForPC.js

```js
import { ClientModel, WeixinPayModel } from '../../../../models';
import { _F, _T, hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
import api from '../../libs/weixinPay/api';
import config from '../../../../../config';
import { rechargeForClient } from '../../libs/account';

export default async ({
    userId,
    amount, // 单位：元
    body, //商品描述
}, req) => {
    amount = _F(amount);
    if (config.hasNoRealPayment) {
        return rechargeForClient({ userId, amount, thirdpartyAccount: 'SIMULATION_NO' });
    }
    amount = amount / config.weixinPayRate;
    if (amount < 1) {
        return { msg: '充值金额必须大于' + config.weixinPayRate / 100 };
    }
    return new Promise(async resolve => {
        const client = await ClientModel.findById(userId);
        if (!client) {
            return resolve({ msg: '你没有充值的权限' });
        }
        if (client.shipperId && !hasAuthority(client, CONSTANTS.AH_RECHARGE)) {
            return resolve({ msg: '你没有充值的权限' });
        }

        const spbill_create_ip = req.get('X-Real-IP') || req.get('X-Forwarded-For') || req.ip;
        const order = new WeixinPayModel({
            clientId: userId,
            spbill_create_ip,
            body,
            trade_type: 'NATIVE',
            total_fee: amount,
        });

        const params = {
            spbill_create_ip,
            body,
            out_trade_no: _T(order.out_trade_no),
            total_fee: amount,
            trade_type: 'NATIVE',
        };
        const result = await api.unifiedorder(params);
        if (result.success) {
            order.prepay_id = result.context.prepayid;
            order.appid = result.context.appid;
            order.mch_id = result.context.partnerid;
            order.code_url = result.context.code_url;
            await order.save();

            result.context = { qrcode: result.context.code_url };
        }

        actionLog(userId, 'Client', amount, 'Number', 'getUnifiedOrderForPC');

        return resolve(result);
    });
};

```

* PDShopServer/project/App/routers/posts/common/client/getClientNameByPhone.js

```js
import { ClientModel } from '../../../../models';

export default async ({ userId, phone }) => {
    const doc = await ClientModel.findOne({ phone });
    return { success: true, context: { name: (doc || {}).name } };
};

```

* PDShopServer/project/App/routers/posts/common/address/getRegionAddress.js

```js
import { RegionModel } from '../../../../mysql';
import { RoadmapAddressModel, ClientModel, ShopMemberModel } from '../../../../models';
import config from '../../../../../config';
import _ from 'lodash';

export default async ({
    userId,
    parentCode = 0,
    type = 0, // 0: 长途地址，1：短途地址，2：所有地址, 3: 分店路线中存在的地址, 4: 收货点路线中存在的地址
}) => {
    (!config.useOnlyExitRoadmap && (type === 3 || type === 4)) && (type = 0);
    let addressList = [];
    if (type < 3) {
        const list = await RegionModel.findAll({ where: { parentCode } });
        addressList = type === 0 ? _.reject(list, o => o.level === 8 || o.level === 9) : list;
    } else if (type === 3) {
        const member = await ShopMemberModel.findById(userId);
        addressList = await RoadmapAddressModel.find({ shopId: member.shopId, parentCode });
    } else if (type === 4) {
        const member = await ClientModel.findById(userId).populate({ path: 'agentId', select: { referShopId: 1 } });
        addressList = await RoadmapAddressModel.find({ shopId: ((member || {}).agent || {}).referShopId, parentCode });
    }

    return { success: true, context: { addressList } };
};

```

* PDShopServer/project/App/routers/posts/common/address/getRegionAddressFromLastCode.js

```js
import { ClientModel, ShopMemberModel } from '../../../../models';
import { getAddressFromLastCode, getSendDoorAddressFromLastCode, getEndPointFromLastCode } from '../../libs/address';
import config from '../../../../../config';

export default async ({
    userId,
    addressLastCode = 0,
    type = 0, // 0: 长途地址，1：短途地址，2：所有地址, 3: 分店路线中存在的地址, 4: 收货点路线中存在的地址
}) => {
    (!config.useOnlyExitRoadmap && (type === 3 || type === 4)) && (type = 0);
    let addressList = [];
    if (type === 0) {
        addressList = await getAddressFromLastCode(addressLastCode);
    } else if (type === 1) {
        addressList = await getSendDoorAddressFromLastCode(addressLastCode);
    } else if (type === 2) {
        addressList = await getAddressFromLastCode(addressLastCode, true);
    } else if (type === 3) {
        const member = await ShopMemberModel.findById(userId);
        addressList = await getEndPointFromLastCode(member.shopId, addressLastCode);
    } else if (type === 4) {
        const member = await ClientModel.findById(userId).populate({ path: 'agentId', select: { referShopId: 1 } });
        addressList = await getEndPointFromLastCode(((member || {}).agent || {}).referShopId, addressLastCode);
    }
    return { success: true, context: {
        addressList,
    } };
};

```

* PDShopServer/project/App/routers/posts/common/address/getRegionSendDoorAddressFromLastCode.js

```js
import { getSendDoorAddressFromLastCode } from '../../libs/address';

export default async ({
    userId,
    addressLastCode,
    parentCode,
}) => {
    const addressList = await getSendDoorAddressFromLastCode(addressLastCode, parentCode);

    return { success: true, context: {
        addressList,
    } };
};

```

* PDShopServer/project/App/routers/posts/common/address/getStartPointAddress.js

```js
import { ShopModel, AgentModel, StartPointAddressModel } from '../../../../models';
import _ from 'lodash';

export default async ({
    userId,
    parentCode = 0,
}) => {
    let list = [];
    const item = await StartPointAddressModel.findOne({ code: parentCode });
    if (!item || !_.includes([ 0, 4, 5, 6, 7 ], item.level)) {
        list = await StartPointAddressModel.find({ parentCode });
    } else {
        const shopList = await ShopModel.find({ isMasterShop: false, addressRegionLastCode: parentCode }).select({ name: 1, addressRegionLastCode: 1 });
        const agentList = await AgentModel.find({ addressRegionLastCode: parentCode }).select({ name: 1, addressRegionLastCode: 1 });
        list = shopList.map(o => { o = o.toObject(); o.isShop = true; o.isLeaf = true; return o; });
        list = list.concat(agentList.map(o => { o = o.toObject(); o.isAgent = true; o.isLeaf = true; return o; }));
    }
    return { success: true, context: { addressList: list } };
};

```

* PDShopServer/project/App/routers/posts/common/address/getStartPointAddressFromLastCode.js

```js
import { ShopModel, AgentModel, StartPointAddressModel } from '../../../../models';

export default async ({
    userId,
    addressLastCode = 0,
    isLeaf, //是否是分店或者收货点（该参数根据接收到的值确定）
}) => {
    if (addressLastCode === 0) {
        const list = await StartPointAddressModel.find({ parentCode: 0 });
        return { success: true, context: { addressList: [ list ] } };
    }

    const addressList = [];
    if (isLeaf) {
        let list = [];
        const shopList = await ShopModel.find({ isMasterShop: false, addressRegionLastCode: addressLastCode }).select({ name: 1, addressRegionLastCode: 1 });
        const agentList = await AgentModel.find({ addressRegionLastCode: addressLastCode }).select({ name: 1, addressRegionLastCode: 1 });
        list = shopList.map(o => { o = o.toObject(); o.isShop = true; o.isLeaf = true; return o; });
        list = list.concat(agentList.map(o => { o = o.toObject(); o.isAgent = true; o.isLeaf = true; return o; }));
        addressList.push(list);
    }
    while (true) {
        const item = await StartPointAddressModel.findOne({ code: addressLastCode });
        if (!item) {
            break;
        }
        if (item.parentCode === 0) {
            const list = await StartPointAddressModel.find({ parentCode: 0 });
            addressList.push(list);
            break;
        } else {
            const list = await StartPointAddressModel.find({ parentCode: item.parentCode });
            addressList.push(list);
            addressLastCode = item.parentCode;
        }
    }
    return { success: true, context: { addressList } };
};

```

* PDShopServer/project/App/routers/posts/common/notify/getNotifies.js

```js
import { NotifyModel } from '../../../../models';
import _ from 'lodash';

async function getPageData (type, keyword, fromPC, pageNo, pageSize) {
    let criteria = { type };
    if (keyword) {
        const regex = new RegExp('.*' + (keyword || '') + '.*', 'gim');
        criteria = { ...criteria, $or: [{ title: regex }, { content: regex }] };
    }
    const count = (fromPC && pageNo === 0) ? await NotifyModel.count(criteria) : undefined;
    const query = NotifyModel.find(criteria).sort({ time: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const list = await query
    .select({
        id: 1,
        source: 1,
        title: 1,
        content: 1,
        time: 1,
    });
    return {
        count,
        list,
    };
}

const TYPES = ['news', 'publicity', 'policy', 'notice'];
export default async ({ userId, type, keyword, fromPC, pageNo, pageSize }) => {
    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(type, keyword, fromPC, pageNo, pageSize),
            },
        };
    } else {
        return {
            success: true,
            context: {
                news: await getPageData('news', keyword, fromPC, pageNo, pageSize),
                publicity: await getPageData('publicity', keyword, fromPC, pageNo, pageSize),
                policy: await getPageData('policy', keyword, fromPC, pageNo, pageSize),
                notice: await getPageData('notice', keyword, fromPC, pageNo, pageSize),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/common/notify/sendNotify.js

```js
import { NotifyModel, ShopMemberModel } from '../../../../models';
import _ from 'lodash';

export default async ({
    adminId,
    shopId,
    memberId,
    shipperId,
    type,
    source,
    title,
    content,
}) => {
    if (memberId) {
        const member = await ShopMemberModel.findById(memberId);
        shopId = (member || {}).shopId;
    }

    const notify = new NotifyModel({ adminId, shopId, memberId, shipperId, type, source, title, content });
    await notify.save();
    return { success: true, context: _.pick(notify.toObject(), ['source', 'title', 'content', 'time', 'id']) };
};

```

* PDShopServer/project/App/routers/posts/common/upload/uploadFile.js

```js
import mongoose from 'mongoose';
import { MediaModel } from '../../../../models';
import { getMediaPath } from '../../../../utils/';

export default ({
    clientId,
    shopMemberId,
    adminId,
}, req) => {
    return new Promise(async resolve => {
        const gridId = req.file.grid._id;
        const media = new MediaModel({
            gridId,
        });
        const doc = await media.save();
        if (doc) {
            return resolve({ success: true, context: { url: getMediaPath(doc._id) } });
        } else {
            mongoose.gfs.remove({ _id: gridId });
            return resolve({ msg: '上传失败' });
        }
    });
};

```

* PDShopServer/project/App/routers/posts/common/verifyCode/requestSendVerifyCode.js

```js
import { VerifyCodeModel } from '../../../../models';
import { sendSms } from '../../../../utils';
import config from '../../../../../config';
import _ from 'lodash';

function getCodeItem () {
    let code = '';
    for (let i = 0; i < 6; i++) {
        code += _.random(0, 9);
    }
    return { code, deadTime: Date.now() + 7200000 };
}

export default async ({
    phone,
}) => {
    if (config.hasNoVerifyCode) {
        return { success: true };
    }

    let codeItem;
    let doc = await VerifyCodeModel.findOne({ phone });
    if (!doc) {
        codeItem = getCodeItem();
        doc = new VerifyCodeModel({
            phone,
            codeList: [ codeItem ],
        });
    } else {
        const codeList = _.filter(doc.codeList, o => o.deadTime.getTime() > Date.now());
        if (codeList.length > 2) {
            return { msg: '操作过于频繁，请稍后再试' };
        }
        codeItem = getCodeItem();
        codeList.unshift(codeItem);
        doc.codeList = codeList;
    }
    const success = await sendSms(phone, codeItem.code);
    if (!success) {
        return { msg: '发送短信失败，请稍后再试' };
    }
    await doc.save();
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/driver/truck/confirmReach.js

```js
import { TruckModel } from '../../../../models';
import { actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, address, longitude, latitude }) => {
    const truck = await TruckModel.findOneAndUpdate(
        { driverId: userId, state: CONSTANTS.TS_ON_THE_WAY },
        { state: CONSTANTS.TS_RECEIVE_SUCCESS, $push: { locationList: { $each: [ { address, longitude, latitude, time: Date.now() } ], $position: 0 } } }
    );
    if (!truck) {
        return { msg: '你当前没有在运输中的车辆' };
    }
    actionLog(userId, 'Driver', truck.id, 'Truck', 'confirmReach');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/driver/truck/getLocationList.js

```js
import { TruckModel } from '../../../../models';
import CONSTANTS from '../../../../constants';
import { getFormatTime } from '../../../../utils';

export default async ({ userId }) => {
    const truck = await TruckModel.findOne({ driverId: userId, state: CONSTANTS.TS_ON_THE_WAY }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });
    let locationList = [];
    if (!truck) {
        return { success: true, locationList: [] };
    } else {
        locationList.push({
            address: (truck.shop || {}).address,
            time: getFormatTime(truck.createTime),
        });
        locationList = [...(truck || {}).locationList || [], ...locationList];
    }
    return { success: true, locationList };
};

```

* PDShopServer/project/App/routers/posts/driver/truck/getOnWayTruck.js

```js
import { TruckModel } from '../../../../models';
import CONSTANTS from '../../../../constants';
import { getFormatTime } from '../../../../utils';

export default async ({ userId }) => {
    const truck = await TruckModel.findOne({ driverId: userId, state: CONSTANTS.TS_ON_THE_WAY }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });
    let locationList = [];
    if (!truck) {
        return { msg: '你当前没有在运输中的车辆' };
    } else {
        locationList.push({
            address: (truck.shop || {}).address,
            time: getFormatTime(truck.createTime),
        });
        truck.locationList = [...(truck || {}).locationList || [], ...locationList];
    }
    return { success: true, context: truck };
};

```

* PDShopServer/project/App/routers/posts/driver/truck/uploadLocation.js

```js
import { TruckModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({ userId, address, longitude, latitude }) => {
    const truck = await TruckModel.findOneAndUpdate({ driverId: userId, state: CONSTANTS.TS_ON_THE_WAY }, { $push: { locationList: { $each: [ { address, longitude, latitude, time: Date.now() } ], $position: 0 } } });
    if (!truck) {
        return { success: false };
    }
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/driver/personal/findPassword.js

```js
import { DriverModel } from '../../../../models';
import { setPassword, checkVerifyCode, actionLog } from '../../../../utils';

export default async ({ phone, password, verifyCode }) => {
    const user = await DriverModel.findOne({ phone });
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    const success = await checkVerifyCode(phone, verifyCode);
    if (!success) {
        return { msg: '无效验证码' };
    }

    const error = await setPassword(user, password);
    if (error) {
        return { msg: '服务器错误' };
    }
    await user.save();

    actionLog(user.id, 'Driver', user.id, 'Driver', 'findPassword');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/driver/personal/getPersonalInfo.js

```js
import { DriverModel } from '../../../../models';

export default async ({ userId }) => {
    const user = await DriverModel.findById(userId);
    if (!user) {
        return { msg: '没有该用户' };
    }
    const context = user.toObject();
    context.userId = context.id;
    delete context.id;

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/driver/personal/getUserNameByPhone.js

```js
import { DriverModel } from '../../../../models';

export default async ({ userId, phone }) => {
    const doc = await DriverModel.findOne({ phone });
    return { success: true, context: { name: (doc || {}).name } };
};

```

* PDShopServer/project/App/routers/posts/driver/personal/login.js

```js
import { DriverModel } from '../../../../models';
import { authenticatePassword, actionLog } from '../../../../utils';

export default async ({ phone, password }) => {
    const user = await DriverModel.findOne({ phone });
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    const error = await authenticatePassword(user, password);
    if (error) {
        return { msg: '密码错误' };
    } else {
        actionLog(user.id, 'Driver', user.id, 'Driver', 'login');
        return { success: true, context: { userId: user.id, shopId: user.shopId } };
    }
};

```

* PDShopServer/project/App/routers/posts/driver/personal/modifyPassword.js

```js
import { DriverModel } from '../../../../models';
import { setPassword, authenticatePassword, actionLog } from '../../../../utils';

export default async ({ userId, oldPassword, newPassword }) => {
    const user = await DriverModel.findById(userId);
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    let error = await authenticatePassword(user, oldPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    error = await setPassword(user, newPassword);
    if (error) {
        return { msg: '设置密码失败' };
    }
    await user.save();

    actionLog(userId, 'Driver', userId, 'Driver', 'modifyPassword');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/driver/personal/modifyPersonalInfo.js

```js
import { DriverModel, MediaModel } from '../../../../models';
import { getMediaId, omitNil, getAgeFromBirthday, actionLog } from '../../../../utils';

export default async ({
    userId,
    name,
    head,
    email,
    sex,
    birthday,
    address,
    phoneList,
    license,
    licenseNo,
}) => {
    let _head = getMediaId(head);
    let _license = getMediaId(license);
    const doc = await DriverModel.findByIdAndUpdate(userId, omitNil({
        name,
        head: _head,
        email,
        sex,
        birthday,
        address,
        phoneList,
        license: _license,
        licenseNo,
    }));
    if (!doc) {
        return { msg: '修改失败' };
    }
    MediaModel._updateRef(
        { [_head]: 1 },
        { [head && doc.head]: -1 },
        { [_license]: 1 },
        { [license && doc.license]: -1 },
    );

    actionLog(userId, 'Driver', userId, 'Driver', 'modifyPersonalInfo');

    return { success: true, context: { ...doc.toObject(), ...omitNil({
        name,
        head,
        email,
        sex,
        birthday,
        age: getAgeFromBirthday(birthday),
        address,
        phoneList,
        license,
        licenseNo,
    }) } };
};

```

* PDShopServer/project/App/routers/posts/driver/personal/register.js

```js
import { DriverModel } from '../../../../models';
import { registerUser, checkVerifyCode, actionLog } from '../../../../utils';

export default async ({ phone, password, verifyCode }) => {
    const success = await checkVerifyCode(phone, verifyCode);
    if (!success) {
        return { msg: '无效验证码' };
    }
    const user = new DriverModel({ phone });
    const error = await registerUser(DriverModel, user, password);
    if (!error) {
        actionLog(user.id, 'Driver', user.id, 'Driver', 'register');
        return { success: true };
    } else if (error === 'UserExistsError') {
        return { msg: '该账号已经被占用' };
    } else {
        return { msg: '注册失败' };
    }
};

```

* PDShopServer/project/App/routers/posts/driver/personal/submitFeedback.js

```js
import { FeedbackModel } from '../../../../models';

export default async ({ userId, content, email }) => {
    const feedback = new FeedbackModel({ driverId: userId, content, email });
    await feedback.save();
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/libs/account/index.js

```js
export rechargeForClient from './rechargeForClient'; // 客户端充值
export rechargeForShopMember from './rechargeForShopMember'; // 店面端充值
export withdrawForClient from './withdrawForClient'; // 客户端提现
export withdrawForShopMember from './withdrawForShopMember'; // 店面端提现

```

* PDShopServer/project/App/routers/posts/libs/account/rechargeForClient.js

```js
import { ShipperModel, ClientModel } from '../../../../models';
import { sequelize, AccountModel, BillModel } from '../../../../mysql';
import { _T, _Y, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

const ERROR_OTHER = '10004';
export default ({
    userId,
    amount, // 单位：分
    thirdpartyAccount, // 第三方的货单号  0：支付宝(A)， 1：财付通(C)，2：工商银行(G)，3：建设银行(J)， 4：中国银行（Z）， 5：农业银行(N)，规则：缩写字母#第三方的货单号#第三方账号
}) => {
    return new Promise(async resolve => {
        const client = await ClientModel.findById(userId)
        .populate({
            path: 'shipperId',
            select: { chairManId: 1 },
        });
        const targetId = client.shipper ? _T(client.shipper.chairManId) : userId;

        if (client.shipper && !hasAuthority(client, CONSTANTS.AH_RECHARGE)) {
            return resolve({ msg: '你没有充值的权限' });
        }
        sequelize.transaction(async (transaction) => {
            const clientAccount = await AccountModel.findOne({ where: { targetId, type: CONSTANTS.AT_CLIENT }, transaction });
            const acountAmount = _Y(clientAccount.amount + amount);
            await AccountModel.increment({ amount }, { where: { id: CONSTANTS.AC_BANK_ACCOUNT }, transaction }); // 银行对应的账户增加amount
            await clientAccount.increment({ amount }, { transaction }); // 物流公司对应的账户增加amount
            await BillModel.create({ account: clientAccount.id, thirdpartyAccount, tradeAmount: amount, remark: client.shipper ? '物流公司充值' : '个人充值' }, { transaction });

            if (client.shipper) {
                // 充值成功后，需要更新物流公司的账目
                const doc = await ShipperModel.findByIdAndUpdate(client.shipper.id, { acountAmount }).catch(e => {
                    throw e;
                });
                if (!doc) {
                    throw ERROR_OTHER;
                }
            }
        }).then(async () => {
            return resolve({ success: true });
        }).catch(function (err) {
            console.log('[mysql transaction err]:', err);
            return resolve({ msg: '充值失败' });
        });
    });
};

```

* PDShopServer/project/App/routers/posts/libs/account/rechargeForShopMember.js

```js
import { ShopMemberModel } from '../../../../models';
import { sequelize, AccountModel, BillModel } from '../../../../mysql';
import { _T, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default ({
    userId,
    amount, // 单位：分
    thirdpartyAccount, //第三方的账号  0：支付宝(A)， 1：财付通(C)，2：工商银行(G)，3：建设银行(J)， 4：中国银行（Z）， 5：农业银行(N)，规则，给定的缩写字母+账号
}) => {
    return new Promise(async resolve => {
        const member = await ShopMemberModel.findById(userId);
        if (!hasAuthority(member, CONSTANTS.AH_RECHARGE) || !member.partmentId) {
            return resolve({ msg: '你没有充值的权限' });
        }
        sequelize.transaction(async (transaction) => {
            const partmentAccount = await AccountModel.findOne({ where: { targetId: _T(member.partmentId), type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT }, transaction });
            await AccountModel.increment({ amount }, { where: { id: CONSTANTS.AC_BANK_ACCOUNT }, transaction }); // 银行对应的账户增加amount
            await partmentAccount.increment({ amount }, { transaction }); // 部门对应的账户增加amount
            await BillModel.create({ account: partmentAccount.id, thirdpartyAccount, tradeAmount: amount, remark: '部门充值' }, { transaction });
        }).then(async () => {
            return resolve({ success: true });
        }).catch(function (err) {
            console.log('[mysql transaction err]:', err);
            return resolve({ msg: '充值失败' });
        });
    });
};

```

* PDShopServer/project/App/routers/posts/libs/account/withdrawForClient.js

```js
import { ShipperModel, ClientModel } from '../../../../models';
import { sequelize, AccountModel, BillModel } from '../../../../mysql';
import { _T, _Y, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

const ERROR_OTHER = '10004';
export default ({
    userId,
    amount,
    thirdpartyAccount,  //第三方的账号  0：支付宝(A)， 1：财付通(C)，2：工商银行(G)，3：建设银行(J)， 4：中国银行（Z）， 5：农业银行(N)，规则，给定的缩写字母+账号
}) => {
    return new Promise(async resolve => {
        const client = await ClientModel.findById(userId)
        .populate({
            path: 'shipperId',
            select: { chairManId: 1 },
        })
        .populate({
            path: 'agentId',
            select: { chairManId: 1 },
        });
        if (!client) {
            return resolve({ msg: '你没有提现的权限' });
        }
        const targetId = client.shipper ? _T(client.shipper.chairManId) : client.agent ? _T(client.agent.chairManId) : userId;
        if ((client.shipper || client.agent) && !hasAuthority(client, CONSTANTS.AH_WITHDRAW)) {
            return resolve({ msg: '你没有提现的权限' });
        }
        let acountAmount = 0;
        sequelize.transaction(async (transaction) => {
            const clientAccount = await AccountModel.findOne({ where: { targetId, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } }, transaction });
            acountAmount = _Y(clientAccount.amount - amount);
            await AccountModel.increment({ amount: -amount }, { where: { id: CONSTANTS.AC_BANK_ACCOUNT }, transaction }); // 银行对应的账户减少amount
            await clientAccount.decrement({ amount }, { transaction }); // 物流公司对应的账户减少amount
            await BillModel.create({ account: clientAccount.id, thirdpartyAccount, tradeAmount: -amount, remark: client.shipper ? '物流公司提现' : '个人提现' }, { transaction });

            if (client.shipper) {
                // 提现成功后，需要更新物流公司的账目
                const doc = await ShipperModel.findByIdAndUpdate(client.shipper.id, { acountAmount }).catch(e => {
                    throw e;
                });
                if (!doc) {
                    throw ERROR_OTHER;
                }
            }
        }).then(async () => {
            return resolve({ success: true, context: { amount: acountAmount } });
        }).catch(function (err) {
            console.log('[mysql transaction err]:', err);
            return resolve({ msg: '提现失败' });
        });
    });
};

```

* PDShopServer/project/App/routers/posts/libs/account/withdrawForShopMember.js

```js
import { ShopMemberModel } from '../../../../models';
import { sequelize, AccountModel, BillModel } from '../../../../mysql';
import { _T, _Y, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default ({
    userId,
    amount,
    thirdpartyAccount, //第三方的账号  0：支付宝(A)， 1：财付通(C)，2：工商银行(G)，3：建设银行(J)， 4：中国银行（Z）， 5：农业银行(N)，规则，给定的缩写字母+账号
}) => {
    return new Promise(async resolve => {
        const member = await ShopMemberModel.findById(userId)
        .populate({
            path: 'shopId',
            select: { isMasterShop: 1 },
        });
        if (!hasAuthority(member, CONSTANTS.AH_WITHDRAW)) {
            return resolve({ msg: '你没有提现的权限' });
        }

        if (member.shop.isMasterShop) {
            let remainAmount = 0;
            sequelize.transaction(async (transaction) => {
                const masterAccount = await AccountModel.findOne({ where: { id: CONSTANTS.AC_MASTER_ACCOUNT, amount: { $gte: amount } }, transaction });
                await AccountModel.increment({ amount: -amount }, { where: { id: CONSTANTS.AC_BANK_ACCOUNT }, transaction }); // 银行对应的账户减少amount
                await masterAccount.decrement({ amount }, { transaction }); // 总部对应的账户减少amount
                await BillModel.create({ account: masterAccount.id, thirdpartyAccount, tradeAmount: -amount, remark: '总部提现' }, { transaction });
                remainAmount = _Y(masterAccount.amount - amount);
            }).then(async () => {
                return resolve({ success: true, context: { amount: remainAmount } });
            }).catch(function (err) {
                console.log('[mysql transaction err]:', err);
                return resolve({ msg: '余额不足' });
            });
        } else if (member.partmentId) {
            let remainAmount = 0;
            sequelize.transaction(async (transaction) => {
                const partmentAccount = await AccountModel.findOne({ where: { targetId: _T(member.partmentId), type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT, amount: { $gte: amount } }, transaction });
                await AccountModel.increment({ amount: -amount }, { where: { id: CONSTANTS.AC_BANK_ACCOUNT }, transaction }); // 银行对应的账户减少amount
                await partmentAccount.decrement({ amount }, { transaction }); // 部门对应的账户减少amount
                await BillModel.create({ account: partmentAccount.id, thirdpartyAccount, tradeAmount: -amount, remark: '部门提现' }, { transaction });
                remainAmount = _Y(partmentAccount.amount - amount);
            }).then(async () => {
                return resolve({ success: true, context: { amount: remainAmount } });
            }).catch(function (err) {
                console.log('[mysql transaction err]:', err);
                return resolve({ msg: '余额不足' });
            });
        } else {
            let remainAmount = 0;
            sequelize.transaction(async (transaction) => {
                const branchAccount = await AccountModel.findOne({ where: { targetId: _T(member.shop.id), type: CONSTANTS.AT_BRANCH_SHOP, amount: { $gte: amount } }, transaction });
                await AccountModel.increment({ amount: -amount }, { where: { id: CONSTANTS.AC_BANK_ACCOUNT }, transaction }); // 银行对应的账户减少amount
                await branchAccount.decrement({ amount }, { transaction }); // 分店对应的账户减少amount
                await BillModel.create({ account: branchAccount.id, thirdpartyAccount, tradeAmount: -amount, remark: '分店提现' }, { transaction });
                remainAmount = _Y(branchAccount.amount - amount);
            }).then(async () => {
                return resolve({ success: true, context: { amount: remainAmount } });
            }).catch(function (err) {
                console.log('[mysql transaction err]:', err);
                return resolve({ msg: '余额不足' });
            });
        }
    });
};

```

* PDShopServer/project/App/routers/posts/libs/address/getAddressFromLastCode.js

```js
import { RegionModel } from '../../../../mysql';
import _ from 'lodash';

export default async (addressLastCode = 0, withTown) => {
    if (addressLastCode === 0) {
        const list = await RegionModel.findAll({ where: { parentCode: 0 } });
        return [ list ];
    }

    const addressList = [];
    while (true) {
        const item = await RegionModel.findOne({ where: { code: addressLastCode } });
        if (!item) {
            break;
        }
        if (item.parentCode === 0) {
            const list = await RegionModel.findAll({ where: { parentCode: 0 } });
            addressList.push(list);
            break;
        } else {
            const list = await RegionModel.findAll({ where: { parentCode: item.parentCode } });
            if (!withTown) {
                addressList.push(_.reject(list, o => o.level === 8 || o.level === 9));
            } else {
                addressList.push(list);
            }

            addressLastCode = item.parentCode;
        }
    }
    return addressList;
};

```

* PDShopServer/project/App/routers/posts/libs/address/getEndPointFromLastCode.js

```js
import { RoadmapAddressModel } from '../../../../models';
import getAddressFromLastCode from './getAddressFromLastCode';
import config from '../../../../../config';
import _ from 'lodash';

export default async (shopId, addressLastCode = 0, withTown) => {
    if (!config.useOnlyExitRoadmap) {
        return await getAddressFromLastCode(addressLastCode, withTown);
    }
    if (addressLastCode === 0) {
        const list = await RoadmapAddressModel.find({ shopId, parentCode: 0 });
        return [ list ];
    }

    const addressList = [];
    while (true) {
        const item = await RoadmapAddressModel.findOne({ shopId, code: addressLastCode });
        if (!item) {
            break;
        }
        if (item.parentCode === 0) {
            const list = await RoadmapAddressModel.find({ shopId, parentCode: 0 });
            addressList.push(list);
            break;
        } else {
            const list = await RoadmapAddressModel.find({ shopId, parentCode: item.parentCode });
            if (!withTown) {
                addressList.push(_.reject(list, o => o.level === 8 || o.level === 9));
            } else {
                addressList.push(list);
            }
            addressLastCode = item.parentCode;
        }
    }
    if (!addressList.length) {
        const list = await RoadmapAddressModel.find({ shopId, parentCode: 0 });
        return [ list ];
    }
    return addressList;
};

```

* PDShopServer/project/App/routers/posts/libs/address/getSendDoorAddressFromLastCode.js

```js
import { RegionModel } from '../../../../mysql';
import _ from 'lodash';

export default async (addressLastCode, parentCode) => {
    if (!addressLastCode) {
        return parentCode ? [ await RegionModel.findAll({ where: { parentCode } }) ] : [];
    }

    const addressList = [];
    while (true) {
        const item = await RegionModel.findOne({ where: { code: addressLastCode } });
        if (!item || item.level === 7 || item.level === 6) {
            break;
        }
        const list = await RegionModel.findAll({ where: { parentCode: item.parentCode } });
        addressList.push(_.reject(list, o => o.level === 4 || o.level === 5 || o.level === 6 || o.level === 7));
        if (item.level === 8 || item.level === 9) {
            break;
        } else {
            addressLastCode = item.parentCode;
        }
    }
    return addressList;
};

```

* PDShopServer/project/App/routers/posts/libs/address/getSendDoorLastCodeList.js

```js
import { RegionModel } from '../../../../mysql';

const getChildList = async (code, name, list) => {
    const docs = await RegionModel.findAll({ where: { parentCode: code } });
    for (const doc of docs) {
        if (doc.level === 10) {
            list.push({ code: doc.code, address: name + doc.name, sendDoorPrice: 110, sendDoorMinFee: 60 }); // todo： 需要计算该方向的平均成交价
        } else {
            await getChildList(doc.code, name + doc.name, list);
        }
    }
};

// 获取长途路线的送货上门的地址列表
export default async (code) => {
    const list = [];
    await getChildList(code, '', list);
    return list;
};

```

* PDShopServer/project/App/routers/posts/libs/address/index.js

```js
export getSendDoorLastCodeList from './getSendDoorLastCodeList'; // 获取所有的送货上门地址列表
export getAddressFromLastCode from './getAddressFromLastCode'; // 通过最后一个code获取地址列表
export getSendDoorAddressFromLastCode from './getSendDoorAddressFromLastCode'; // 通过最后一个code获取送货上门地址列表
export registeredStartPointAddress from './registeredStartPointAddress'; // 注册发货地址（包括分店和收货点）
export registeredRoadmapAddress from './registeredRoadmapAddress'; // 注册路线地址
export getEndPointFromLastCode from './getEndPointFromLastCode'; // 通过最后一个code获取地址列表(只获取分店里面已经拥有的路线)

```

* PDShopServer/project/App/routers/posts/libs/address/registeredRoadmapAddress.js

```js
import { RoadmapAddressModel, RoadmapModel } from '../../../../models';
import { RegionModel } from '../../../../mysql';

// 该接口只注册长途的地址，同城配送的不注册
export default async (shopId, endPointLastCode, oldEndPointLastCode) => {
    if (endPointLastCode === oldEndPointLastCode) {
        return;
    }
    if (oldEndPointLastCode) {
        const item = await RoadmapAddressModel.findOne({ shopId, code: oldEndPointLastCode });
        if (item) {
            const roadmap = await RoadmapModel.findOne({ shopId, endPointLastCode: oldEndPointLastCode, enable: true });
            if (!roadmap) {
                await item.remove();
                let parentCode = item.parentCode;
                while (true) {
                    if (await RoadmapAddressModel.findOne({ shopId, parentCode })) {
                        break;
                    }
                    const parent = await RoadmapAddressModel.findOne({ shopId, code: parentCode });
                    if (!parent) {
                        break;
                    }
                    parentCode = parent.parentCode;
                    await parent.remove();
                }
            }
        }
    }
    if (endPointLastCode) {
        while (true) {
            const item = await RoadmapAddressModel.findOne({ shopId, code: endPointLastCode });
            if (item) { // 如果已经存在，则无需再添加
                break;
            }
            const node = await RegionModel.findOne({ where: { code: endPointLastCode } });
            const doc = new RoadmapAddressModel({ shopId, parentCode: node.parentCode, code: node.code, name: node.name, level: node.level });
            await doc.save();
            if (node.parentCode === 0) {
                break;
            }
            endPointLastCode = node.parentCode;
        }
    }
};

```

* PDShopServer/project/App/routers/posts/libs/address/registeredStartPointAddress.js

```js
import { StartPointAddressModel, ShopModel, AgentModel } from '../../../../models';
import { RegionModel } from '../../../../mysql';

export default async (addressLastCode, oldAddressLastCode) => {
    if (!addressLastCode || addressLastCode === oldAddressLastCode) {
        return;
    }
    if (oldAddressLastCode) {
        const item = await StartPointAddressModel.findOne({ code: oldAddressLastCode });
        if (item) {
            const shopAgent = await ShopModel.findOne({ isMasterShop: false, addressRegionLastCode: oldAddressLastCode }) ||
            await AgentModel.findOne({ addressRegionLastCode: oldAddressLastCode });
            if (!shopAgent) {
                await item.remove();
                let parentCode = item.parentCode;
                while (true) {
                    if (await StartPointAddressModel.findOne({ parentCode })) {
                        break;
                    }
                    const parent = await StartPointAddressModel.findOne({ code: parentCode });
                    if (!parent) {
                        break;
                    }
                    parentCode = parent.parentCode;
                    await parent.remove();
                }
            }
        }
    }

    while (true) {
        const item = await StartPointAddressModel.findOne({ code: addressLastCode });
        if (item) { // 如果已经存在，则无需再添加
            break;
        }
        const node = await RegionModel.findOne({ where: { code: addressLastCode } });
        const doc = new StartPointAddressModel({ parentCode: node.parentCode, code: node.code, name: node.name, level: node.level });
        await doc.save();
        if (node.parentCode === 0) {
            break;
        }
        addressLastCode = node.parentCode;
    }
};

```

* PDShopServer/project/App/routers/posts/libs/order/getAgentLatestOrder.js

```js
import { OrderModel } from '../../../../models';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async (receiveAgentMemberId) => {
    const order = await OrderModel.findOne({ receiveAgentMemberId })
    .sort({ placeOrderTime: 'desc' });
    if (!order || !_.find(order.stateList, o => _.includes([
        CONSTANTS.OS_READY_PRINT_BAR_CODE,
        CONSTANTS.OS_READY_PAYMENT,
        CONSTANTS.OS_READY_PRINT_ORDER,
        CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER,
    ], o.state))) {
        return null;
    }
    return order;
};

```

* PDShopServer/project/App/routers/posts/libs/order/getAgentOrderFeeByEndPoint.js

```js
import mongoose from 'mongoose';
import { RegionModel } from '../../../../mysql';
import { AgentRegionProfitModel, OrderModel, RoadmapModel } from '../../../../models';
import { settingMgr } from '../../../../manager';
import getRegionProfitRateByEndPoint from '../roadmap/getRegionProfitRateByEndPoint';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getProfitRate (agentId, shopId, isCityDistribute, endPointLastCode) {
    let addressList = [0];
    while (true) {
        const item = await RegionModel.findOne({ where: { code: endPointLastCode } });
        if (!item) {
            break;
        } else {
            addressList.push(item.code);
            endPointLastCode = item.parentCode;
        }
    }
    const regionRate = await AgentRegionProfitModel.find({
        agentId,
        shopId,
        regionLastCode: { $in: addressList },
        type: { $in: [CONSTANTS.RRT_ALL, !isCityDistribute ? CONSTANTS.RRT_LONG : CONSTANTS.RRT_CITY] },
    }).sort({ regionLastCode: -1, type: 1 }).limit(1);

    return regionRate[0] || {};
}

async function getAverageRoadmapPrice (shopId, isCityDistribute, isSendDoor, endPointLastCode, sendDoorEndPointLastCode) {
    let docs = [];
    const regionProfitRate = await getRegionProfitRateByEndPoint(shopId, endPointLastCode, isCityDistribute);
    if (!isSendDoor) {
        docs = await RoadmapModel.aggregate()
        .match({ shopId, endPointLastCode, enable: true })
        .project({
            profitRate: { $ifNull: [ '$profitRate', regionProfitRate ] },
            price: 1,
            minFee: 1,
        })
        .project({
            price: { $multiply: [ '$price', { $sum: [ 1, '$profitRate' ] } ] },
            minFee: { $multiply: [ '$minFee', { $sum: [ 1, '$profitRate' ] } ] },
        })
        .group({
            _id: null,
            price: { $avg: '$price' },
            minFee: { $avg: '$minFee' },
        });
    } else {
        docs = await RoadmapModel.aggregate()
        .match({ shopId, endPointLastCode, enable: true })
        .project({
            sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
            profitRate: { $ifNull: [ '$profitRate', regionProfitRate ] },
            price: 1,
            minFee: 1,
        })
        .project({
            price: { $multiply: [ '$price', { $sum: [ 1, '$profitRate' ] } ] },
            minFee: { $multiply: [ '$minFee', { $sum: [ 1, '$profitRate' ] } ] },
            sendDoorPrice: { $multiply: [ '$sendDoor.sendDoorPrice', { $sum: [ 1, '$profitRate' ] } ] },
            sendDoorMinFee: { $multiply: [ '$sendDoor.sendDoorMinFee', { $sum: [ 1, '$profitRate' ] } ] },
        })
        .group({
            _id: null,
            price: { $avg: '$price' },
            minFee: { $avg: '$minFee' },
            sendDoorPrice: { $avg: '$sendDoorPrice' },
            sendDoorMinFee: { $avg: '$sendDoorMinFee' },
        });
    }

    return docs[0];
}

async function getAverageOrderPrice (shopId, endPointLastCode, isSendDoor, sendDoorEndPointLastCode) {
    const criteria = {
        shopId: new mongoose.Types.ObjectId(shopId),
        'stateList.0.state': { $gte: CONSTANTS.OS_READY_STOCK },
        endPointLastCode,
        placeOrderTime: { $lt: moment().subtract(10, 'd').toDate() },
    };
    const params = {
        _id: null,
        price: { $avg: '$price' },
        minFee: { $avg: '$minFee' },
    };
    if (isSendDoor) {
        Object.assign(criteria, { isSendDoor, sendDoorEndPointLastCode });
        Object.assign(params, { sendDoorPrice: { $avg: '$sendDoorPrice' }, sendDoorMinFee: { $avg: '$sendDoorMinFee' } });
    }

    const docs = await OrderModel.aggregate()
    .match(criteria)
    .group(params);

    return docs[0];
}

export default async (
    agentId, // 所在所在点
    shopId, // 参考分店
    isCityDistribute, // 是否是同城配送
    endPointLastCode, // 终点
    isSendDoor, // 是否送货上门
    sendDoorEndPointLastCode, // 送货上门终点
    weight, // 重量
    size, //方量
) => {
    weight = settingMgr.getFloatWeight(weight, size);
    const rate = await getProfitRate(agentId, shopId, isCityDistribute, endPointLastCode);
    let roadmap = await getAverageOrderPrice(shopId, endPointLastCode, isSendDoor, sendDoorEndPointLastCode);
    if (!roadmap) {
        roadmap = await getAverageRoadmapPrice(shopId, isCityDistribute, isSendDoor, endPointLastCode, sendDoorEndPointLastCode);
    }
    if (!roadmap) {
        return { error: true };
    }

    // 分店显示的价格;
    const fee = Math.floor(Math.max(roadmap.price * weight, roadmap.minFee)
    + (isSendDoor ? Math.max(roadmap.sendDoorPrice * weight, roadmap.sendDoorMinFee) : 0));

    let totalFee;
    if (rate.profitCount) {
        totalFee = fee + rate.profitCount * weight;
    } else {
        totalFee = (1 + (rate.profitRate || 0)) * fee;
    }

    return {
        fee, // 分店显示的价格
        profit: totalFee - fee, //收货点的利润
    };
};

```

* PDShopServer/project/App/routers/posts/libs/order/getRPLatestOrder.js

```js
import { OrderModel } from '../../../../models';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async (receiveMemberId) => {
    const order = await OrderModel.findOne({ receiveMemberId })
    .sort({ placeOrderTime: 'desc' });
    if (!order || !_.find(order.stateList, o => _.includes([
        CONSTANTS.OS_READY_PRINT_BAR_CODE,
        CONSTANTS.OS_READY_SELECT_ROADMAP,
        CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER,
        CONSTANTS.OS_READY_PAYMENT,
        CONSTANTS.OS_READY_PRINT_ORDER,
    ], o.state))) {
        return null;
    }
    return order;
};

```

* PDShopServer/project/App/routers/posts/libs/order/index.js

```js
export getRPLatestOrder from './getRPLatestOrder'; // 获取收货部最新的货单
export getAgentLatestOrder from './getAgentLatestOrder'; // 获取收货点最新的货单
export setAgentOrderFee from './setAgentOrderFee'; // 设置收货点的货单的价格
export setClientPickShipper from './setClientPickShipper'; // 设置用户上门自提的信息

```

* PDShopServer/project/App/routers/posts/libs/order/setAgentOrderFee.js

```js
import CONSTANTS from '../../../../constants';
import { setting } from '../../../../manager';
import getAgentOrderFeeByEndPoint from './getAgentOrderFeeByEndPoint';

export default async (referShopId, order) => {
    const options = await getAgentOrderFeeByEndPoint(
        order.agentId,
        referShopId,
        order.isCityDistribute,
        order.endPointLastCode,
        order.isSendDoor,
        order.sendDoorEndPointLastCode,
        order.weight,
        order.size,
    );
    if (options.error) {
        return true;
    }

    order.realFee = options.profit + options.fee; // 实际运费.
    if (order.payMode !== CONSTANTS.PM_IMMEDIATE && !order.totalDesignatedFee) {
        order.totalDesignatedFee = order.realFee;
    }
    order.needPayTransportFee = 0;
    if (order.payMode !== CONSTANTS.PM_IMMEDIATE) { // 到付或者混合支付
        const senderProfit = order.totalDesignatedFee - order.realFee; // 发货人收益
        order.designatedFee = Math.max(senderProfit, 0);
        if (senderProfit < 0) {
            order.needPayTransportFee = -senderProfit; // 发货人需要现付的部分
        }
    } else { // 现付
        order.needPayTransportFee = order.realFee;
    }
    // 保险费（参考分店的收钱的部分买保险）
    if (order.isInsuance) {
        order.insuanceMount = options.fee * setting.insuanceMountRate;
        order.insuanceFee = order.insuanceMount * setting.insuanceRate;
        if (order.insuanceFee < setting.insuanceBaseValue) { // 如果保险
            order.insuanceFee = setting.insuanceBaseValue;
        }
        order.insuanceFee = Math.floor(order.insuanceFee);
        order.insuanceMount = Math.floor(order.insuanceFee / setting.insuanceRate);
    } else {
        order.insuanceMount = 0;
        order.insuanceFee = 0;
    }

    order.needPayInsuanceFee = 0;
    if (order.insuanceFee > 0) { // 只有初始单才需要交保险
        order.needPayInsuanceFee = order.insuanceFee;
    }
    if (order.needPayTransportFee > 0 && order.totalDesignatedFee > 0) {
        order.payMode = CONSTANTS.PM_MIXED;
    }

    return false;
};

```

* PDShopServer/project/App/routers/posts/libs/order/setClientPickShipper.js

```js
import mongoose from 'mongoose';
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { ShipperInBranchShopModel, RoadmapMaskModel, WarehouseModel, ShipperModel } from '../../../../models';
import { _T, _F, _Y } from '../../../../utils';
import { settingMgr } from '../../../../manager';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

const ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH = '10003';
const ERROR_OTHER = '10004';
function deductAmount (order, shipperId, needBondAmount, targetId, proxyCharge, totalDesignatedFee, profit) {
    return new Promise(async resolve => {
        const orderId = _T(order.id);
        const amount = proxyCharge + totalDesignatedFee + profit;
        sequelize.transaction(async (transaction) => {
            const shipperAccount = await AccountModel.findOne({ where: { targetId, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } }, transaction });
            await shipperAccount.decrement({ amount }, { transaction });
            await AccountModel.increment({ amount }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            proxyCharge > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -proxyCharge, remark: '抵押货款' }, { transaction });
            totalDesignatedFee > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -totalDesignatedFee, remark: '抵押指定收款' }, { transaction });
            profit > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -profit, remark: '扣除上门自提竞价' }, { transaction });
            const acountAmount = _Y(shipperAccount.amount - amount);

            await OrderPaymentModel.create({ orderId, isPayed: true, payedTime: new Date() }, { transaction });

            // 扣除物流公司的担保金额
            const inShop = await ShipperInBranchShopModel.findOne({ shipperId, shopId: order.shopId });
            if (!inShop || inShop.remainBondAmount < needBondAmount) {
                throw ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH;
            }
            inShop.remainBondAmount = inShop.remainBondAmount - needBondAmount;
            inShop.usedBondAmount = inShop.totalBondAmount - inShop.remainBondAmount;
            await inShop.save();

            // 扣款成功后，需要更新物流公司的账目
            const doc = await ShipperModel.findByIdAndUpdate(shipperId, { acountAmount }).catch(e => {
                throw e;
            });
            if (!doc) {
                throw ERROR_OTHER;
            }
        }).then(() => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

export default async (order, profitRate) => {
    const weight = settingMgr.getFloatWeight(order.weight, order.size);
    const needBondAmount = settingMgr.getBondAmount(order.weight, order.size);
    const docs = await ShipperInBranchShopModel.aggregate()
    .match({ shopId: new mongoose.Types.ObjectId(order.shopId) })
    .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
    .project({
        shipperId: { $arrayElemAt: ['$shipper._id', 0] },
        shipperName: { $arrayElemAt: ['$shipper.name', 0] },
        shipperChairManId: { $arrayElemAt: ['$shipper.chairManId', 0] },
        shipperType: { $arrayElemAt: ['$shipper.shipperType', 0] },
        profit: { $multiply: ['$clientPickPrice', weight] },
        hasEnoughAmount: {
            $cond: { if: {
                $gte: [ { $arrayElemAt: ['$shipper.acountAmount', 0] },
                { $sum: [ order.proxyCharge, order.totalDesignatedFee, { $multiply: ['$clientPickPrice', weight] } ] }] },
                then: true,
                else: false,
            },
        },
        remainBondAmount: 1,
        clientPickEnable: 1,
        clientPickPrice: 1,
    })
    .match({
        shipperType: CONSTANTS.ST_CITY,
        clientPickEnable: true,
        clientPickPrice: { $exists: true },
        hasEnoughAmount: true, // 需要押的钱 = 代收货款 + 指定收款 + 竞价
        remainBondAmount: { $gte: needBondAmount }, //保证金
    })
    .sort({
        clientPickPrice: -1,
    });
    const maskNumber = await RoadmapMaskModel.getMaskNumber(order.shopId, 0, docs.length);
    const item = docs[maskNumber];
    if (item) {
        const err = await deductAmount(order, item.shipperId, needBondAmount, _T(item.shipperChairManId), _F(order.proxyCharge), _F(order.totalDesignatedFee), _F(item.profit));
        if (err) {
            order.deductError = true;
        } else {
            const warehouseList = await WarehouseModel.find({ shopId: order.shopId, shipperList: item.shipperId });
            order.shipperId = item.shipperId;
            order.shipperChairManId = item.shipperChairManId;
            order.warehouse = warehouseList.length ? _.map(warehouseList, o => o.houseNo).join(';') : item.shipperName;
            order.profit = item.clientPickPrice * weight;
            order.branchProfit = order.profit * profitRate;
            order.masterProfit = order.profit - order.branchProfit;
            order.needBondAmount = needBondAmount;
            order.designatedFee = order.totalDesignatedFee;
            await RoadmapMaskModel.updateStatusList(order.shopId, 0, maskNumber, settingMgr.getRealWeight(order.weight, order.size));
        }
    } else {
        order.deductError = true;
    }
};

```

* PDShopServer/project/App/routers/posts/libs/roadmap/getRegionProfitRateByEndPoint.js

```js
import { RegionModel } from '../../../../mysql';
import { RoadmapRegionProfitRateModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async (
    shopId, // 所在分店
    endPointLastCode, // 终点
    isCityDistribute, // 是否是同城配送
) => {
    // 查找该方向的路线提成
    let addressList = [0];
    while (true) {
        const item = await RegionModel.findOne({ where: { code: endPointLastCode } });
        if (!item) {
            break;
        } else {
            addressList.push(item.code);
            endPointLastCode = item.parentCode;
        }
    }

    const regionRate = await RoadmapRegionProfitRateModel.find({
        shopId: { $in: [null, shopId] },
        regionLastCode: { $in: addressList },
        type: { $in: [CONSTANTS.RRT_ALL, !isCityDistribute ? CONSTANTS.RRT_LONG : CONSTANTS.RRT_CITY] },
    }).sort({ regionLastCode: -1, type: 1 }).limit(1);

    return regionRate.length ? regionRate[0].profitRate : 0;
};

```

* PDShopServer/project/App/routers/posts/libs/roadmap/index.js

```js
export searchRoadmapListByReceivePartment from './searchRoadmapListByReceivePartment'; // 使用收货部的身份查询路线（待屏蔽功能，限定在本店）
export searchRoadmapListWithShop from './searchRoadmapListWithShop'; // 查询分店的路线排名（不屏蔽）
export searchRoadmapListWithShopList from './searchRoadmapListWithShopList'; // 查询多家分店的路线排名（不屏蔽）
export getRegionProfitRateByEndPoint from './getRegionProfitRateByEndPoint'; // 查询多家分店的路线排名（不屏蔽）

```

* PDShopServer/project/App/routers/posts/libs/roadmap/searchRoadmapListByReceivePartment.js

```js
import mongoose from 'mongoose';
import { RoadmapModel, RoadmapMaskModel } from '../../../../models';
import { settingMgr } from '../../../../manager';
import { omitNil } from '../../../../utils';
import _ from 'lodash';

export default async ({
    shopId,
    fromPC,
    pageNo,
    pageSize,
    endPointLastCode, // 终点
    sendDoorEndPointLastCode, // 送货上门终点
    isSendDoor, // 是否送货上门
    weight, // 重量
    size, // 方量
    proxyCharge, // 代收货款金额
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee, // 指定向收货人应该收多少钱
    orderBy, // 排序方式, 0：以价格优先， 1：以时长优先
    regionProfitRate, //方向提成比例
}) => {
    weight = settingMgr.getFloatWeight(weight, size); // 通过weight和size和阶梯价格计算重量
    const orderText = orderBy === 1 ? 'fee duration' : 'duration fee';
    const needBondAmount = settingMgr.getBondAmount(weight, size);
    let count;

    if (fromPC && pageNo === 0 && pageSize !== 1) {
        const countResults = await RoadmapModel.aggregate()
        .match(omitNil({ shopId: new mongoose.Types.ObjectId(shopId), endPointLastCode, enable: true }))
        .project({
            sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
            shipperInBranchShopId: 1,
            shipperId: 1,
            price: 1,
            minFee: 1,
            profitRate: 1,
        })
        .project({
            sendDoorEnable: '$sendDoor.enable',
            sendDoorPrice: '$sendDoor.sendDoorPrice',
            sendDoorMinFee: '$sendDoor.sendDoorMinFee',
            shipperInBranchShopId: 1,
            shipperId: 1,
            price: 1,
            minFee: 1,
            profitRate: 1,
        })
        .match(isSendDoor ? { sendDoorEnable: true } : {})
        .lookup({ from: 'shipperinbranchshops', localField: 'shipperInBranchShopId', foreignField: '_id', as: 'shipperinbranchshop' })
        .project({
            remainBondAmount: { $arrayElemAt: ['$shipperinbranchshop.remainBondAmount', 0] },
            fee: {
                $floor: { $sum: [
                    { $max: [ { $multiply: ['$price', weight] }, '$minFee' ] },
                    { $cond: { if: isSendDoor, then: { $max: [ { $multiply: ['$sendDoorPrice', weight] }, '$sendDoorMinFee' ] }, else: 0 } },
                ] },
            },
            profitRate: { $ifNull: [ '$profitRate', regionProfitRate ] },
            shipperId: 1,
        })
        .match({ remainBondAmount: { $gte: needBondAmount } })
        .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
        .project({
            acountAmount: { $arrayElemAt: ['$shipper.acountAmount', 0] },
            profit: { $floor: { $multiply: [ '$fee', '$profitRate' ] } },
            fee: 1,
        })
        .project({
            hasEnoughAmount: {
                $cond: {
                    if: { $gte: [{
                        $subtract: [ '$acountAmount', {
                            $sum: [
                                proxyCharge,
                                {
                                    $cond: {
                                        if: isReachPay,
                                        then: {
                                            $cond: {
                                                if: totalDesignatedFee,
                                                // 如果有指定收款，需要扣除的钱为  totalDesignatedFee - fee
                                                then: { $subtract: [ totalDesignatedFee, '$fee' ] },
                                                // 否则，就是总部提成+分部提成，因为物流公司向收货人收取所有运费
                                                else: '$profit',
                                            },
                                        },
                                        else: 0,
                                    },
                                },
                            ],
                        } ],
                    }, 0] },
                    then: true,
                    else: false,
                },
            },
        })
        .match({ hasEnoughAmount: true })
        .group({
            _id: null,
            total: { $sum: 1 },
        });
        count = countResults.length ? countResults[0].total : 0;
    }

    const docs = await RoadmapModel.aggregate()
    .match(omitNil({ shopId: new mongoose.Types.ObjectId(shopId), endPointLastCode, enable: true }))
    .project({
        sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
        shipperInBranchShopId: 1,
        shipperId: 1,
        price: 1,
        minFee: 1,
        profitRate: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .project({
        sendDoorEnable: '$sendDoor.enable',
        sendDoorPrice: '$sendDoor.sendDoorPrice',
        sendDoorMinFee: '$sendDoor.sendDoorMinFee',
        shipperInBranchShopId: 1,
        shipperId: 1,
        price: 1,
        minFee: 1,
        profitRate: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .match(isSendDoor ? { sendDoorEnable: true } : {})
    .lookup({ from: 'shipperinbranchshops', localField: 'shipperInBranchShopId', foreignField: '_id', as: 'shipperinbranchshop' })
    .project({
        remainBondAmount: { $arrayElemAt: ['$shipperinbranchshop.remainBondAmount', 0] },
        fee: {
            $floor: { $sum: [
                { $max: [ { $multiply: ['$price', weight] }, '$minFee' ] },
                { $cond: { if: isSendDoor, then: { $max: [ { $multiply: ['$sendDoorPrice', weight] }, '$sendDoorMinFee' ] }, else: 0 } },
            ] },
        },
        profitRate: { $ifNull: [ '$profitRate', regionProfitRate ] },
        shipperId: 1,
        price: 1,
        minFee: 1,
        sendDoorPrice: 1,
        sendDoorMinFee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .match({ remainBondAmount: { $gte: needBondAmount } })
    .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
    .project({
        shipperName: { $arrayElemAt: ['$shipper.name', 0] },
        acountAmount: { $arrayElemAt: ['$shipper.acountAmount', 0] },
        profit: { $floor: { $multiply: [ '$fee', '$profitRate' ] } },
        price: { $multiply: [ '$price', { $sum: [ 1, '$profitRate' ] } ] },
        minFee: { $multiply: [ '$minFee', { $sum: [ 1, '$profitRate' ] } ] },
        sendDoorPrice: { $multiply: [ '$sendDoorPrice', { $sum: [ 1, '$profitRate' ] } ] },
        sendDoorMinFee: { $multiply: [ '$sendDoorMinFee', { $sum: [ 1, '$profitRate' ] } ] },
        fee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .project({
        id: '$_id',
        _id: 0,
        hasEnoughAmount: {
            $cond: {
                if: { $gte: [{
                    $subtract: [ '$acountAmount', {
                        $sum: [
                            proxyCharge,
                            {
                                $cond: {
                                    if: isReachPay,
                                    then: {
                                        $cond: {
                                            if: totalDesignatedFee,
                                            // 如果有指定收款，需要扣除的钱为  totalDesignatedFee - fee
                                            then: { $subtract: [ totalDesignatedFee, '$fee' ] },
                                            // 否则就是总部提成+分部提成，因为物流公司向收货人收取所有运费
                                            else: '$profit',
                                        },
                                    },
                                    else: 0,
                                },
                            },
                        ],
                    } ],
                }, 0] },
                then: true,
                else: false,
            },
        },
        transportFee: { $sum: ['$fee', '$profit'] },
        needBondAmount: { $sum: [ needBondAmount ] },
        shipperName: 1,
        price: 1,
        minFee: 1,
        sendDoorPrice: 1,
        sendDoorMinFee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
        // delete below
        profit: 1,
        acountAmount: 1,
        fee: 1,
    })
    .match({ hasEnoughAmount: true })
    .sort(orderText)
    .skip(pageNo * pageSize)
    .limit(pageSize);

    let maskNumber = 0;
    if (pageNo === 0) {
        maskNumber = await RoadmapMaskModel.getMaskNumber(shopId, endPointLastCode, docs.length);
    }
    const roadmapList = _.drop(docs, maskNumber).map((o, i) => {
        o.roadmapRankIndex = i + pageNo * pageSize + maskNumber; // 该路线的排名，选择路线的时候需要上传这个参数
        return o;
    });

    return {
        count: count ? count - maskNumber : undefined,
        roadmapList,
    };
};

```

* PDShopServer/project/App/routers/posts/libs/roadmap/searchRoadmapListWithShop.js

```js
import mongoose from 'mongoose';
import { RoadmapModel } from '../../../../models';
import { settingMgr } from '../../../../manager';
import getRegionProfitRateByEndPoint from './getRegionProfitRateByEndPoint';
import { omitNil } from '../../../../utils';

export default async ({
    shopId, // 对应的分店的Id, 如果是收货点，则对应的是收货点的referShopId
    distance, // 到分店或者到收货点的距离
    shopName, // 分店的名称，如果是收货点，不需要穿该字段
    shopAddress, // 分店的地址
    fromPC,
    pageNo,
    pageSize,
    endPointLastCode, // 终点
    sendDoorEndPointLastCode, // 送货上门终点
    isCityDistribute, // 是否是同城配送
    isSendDoor, // 是否送货上门
    weight, // 重量
    size, // 方量
    proxyCharge, // 代收货款金额
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee, // 指定向收货人应该收多少钱
    orderBy, //排序方式, 0：以价格优先， 1：以时长优先
}) => {
    weight = settingMgr.getFloatWeight(weight, size); // 通过weight和size和阶梯价格计算重量
    const orderText = orderBy === 1 ? 'fee duration' : 'duration fee';
    const needBondAmount = settingMgr.getBondAmount(weight, size);
    const regionProfitRate = await getRegionProfitRateByEndPoint(shopId, endPointLastCode, isCityDistribute);
    let count;

    if (fromPC && pageNo === 0 && pageSize !== 1) {
        const countResults = await RoadmapModel.aggregate()
        .match(omitNil({ shopId: new mongoose.Types.ObjectId(shopId), endPointLastCode, enable: true }))
        .project({
            sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
            shipperInBranchShopId: 1,
            shipperId: 1,
            price: 1,
            minFee: 1,
            profitRate: 1,
        })
        .project({
            sendDoorEnable: '$sendDoor.enable',
            sendDoorPrice: '$sendDoor.sendDoorPrice',
            sendDoorMinFee: '$sendDoor.sendDoorMinFee',
            shipperInBranchShopId: 1,
            shipperId: 1,
            price: 1,
            minFee: 1,
            profitRate: 1,
        })
        .match(isSendDoor ? { sendDoorEnable: true } : {})
        .lookup({ from: 'shipperinbranchshops', localField: 'shipperInBranchShopId', foreignField: '_id', as: 'shipperinbranchshop' })
        .project({
            remainBondAmount: { $arrayElemAt: ['$shipperinbranchshop.remainBondAmount', 0] },
            fee: {
                $floor: { $sum: [
                    { $max: [ { $multiply: ['$price', weight] }, '$minFee' ] },
                    { $cond: { if: isSendDoor, then: { $max: [ { $multiply: ['$sendDoorPrice', weight] }, '$sendDoorMinFee' ] }, else: 0 } },
                ] },
            },
            profitRate: { $ifNull: [ '$profitRate', regionProfitRate ] },
            shipperId: 1,
        })
        .match({ remainBondAmount: { $gte: needBondAmount } })
        .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
        .project({
            acountAmount: { $arrayElemAt: ['$shipper.acountAmount', 0] },
            profit: { $floor: { $multiply: [ '$fee', '$profitRate' ] } },
            fee: 1,
        })
        .project({
            hasEnoughAmount: {
                $cond: {
                    if: { $gte: [{
                        $subtract: [ '$acountAmount', {
                            $sum: [
                                proxyCharge,
                                {
                                    $cond: {
                                        if: isReachPay,
                                        then: {
                                            $cond: {
                                                if: totalDesignatedFee,
                                                // 如果有指定收款，需要扣除的钱为  totalDesignatedFee - fee
                                                then: { $subtract: [ totalDesignatedFee, '$fee' ] },
                                                // 否则，就是总部提成+分部提成，因为物流公司向收货人收取所有运费
                                                else: '$profit',
                                            },
                                        },
                                        else: 0,
                                    },
                                },
                            ],
                        } ],
                    }, 0] },
                    then: true,
                    else: false,
                },
            },
        })
        .match({ hasEnoughAmount: true })
        .group({
            _id: null,
            total: { $sum: 1 },
        });
        count = countResults.length ? countResults[0].total : 0;
    }

    const docs = await RoadmapModel.aggregate()
    .match(omitNil({ shopId: new mongoose.Types.ObjectId(shopId), endPointLastCode, enable: true }))
    .project({
        sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
        shipperInBranchShopId: 1,
        shipperId: 1,
        price: 1,
        minFee: 1,
        profitRate: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .project({
        sendDoorEnable: '$sendDoor.enable',
        sendDoorPrice: '$sendDoor.sendDoorPrice',
        sendDoorMinFee: '$sendDoor.sendDoorMinFee',
        shipperInBranchShopId: 1,
        shipperId: 1,
        price: 1,
        minFee: 1,
        profitRate: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .match(isSendDoor ? { sendDoorEnable: true } : {})
    .lookup({ from: 'shipperinbranchshops', localField: 'shipperInBranchShopId', foreignField: '_id', as: 'shipperinbranchshop' })
    .project({
        remainBondAmount: { $arrayElemAt: ['$shipperinbranchshop.remainBondAmount', 0] },
        fee: {
            $floor: { $sum: [
                { $max: [ { $multiply: ['$price', weight] }, '$minFee' ] },
                { $cond: { if: isSendDoor, then: { $max: [ { $multiply: ['$sendDoorPrice', weight] }, '$sendDoorMinFee' ] }, else: 0 } },
            ] },
        },
        profitRate: { $ifNull: [ '$profitRate', regionProfitRate ] },
        shipperId: 1,
        price: 1,
        minFee: 1,
        sendDoorPrice: 1,
        sendDoorMinFee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .match({ remainBondAmount: { $gte: needBondAmount } })
    .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
    .project({
        shipperName: { $arrayElemAt: ['$shipper.name', 0] },
        acountAmount: { $arrayElemAt: ['$shipper.acountAmount', 0] },
        profit: { $floor: { $multiply: [ '$fee', '$profitRate' ] } },
        price: { $multiply: [ '$price', { $sum: [ 1, '$profitRate' ] } ] },
        minFee: { $multiply: [ '$minFee', { $sum: [ 1, '$profitRate' ] } ] },
        sendDoorPrice: { $multiply: [ '$sendDoorPrice', { $sum: [ 1, '$profitRate' ] } ] },
        sendDoorMinFee: { $multiply: [ '$sendDoorMinFee', { $sum: [ 1, '$profitRate' ] } ] },
        fee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .project({
        id: '$_id',
        _id: 0,
        hasEnoughAmount: {
            $cond: {
                if: { $gte: [{
                    $subtract: [ '$acountAmount', {
                        $sum: [
                            proxyCharge,
                            {
                                $cond: {
                                    if: isReachPay,
                                    then: {
                                        $cond: {
                                            if: totalDesignatedFee,
                                            // 如果有指定收款，需要扣除的钱为  totalDesignatedFee - fee
                                            then: { $subtract: [ totalDesignatedFee, '$fee' ] },
                                            // 否则就是总部提成+分部提成，因为物流公司向收货人收取所有运费
                                            else: '$profit',
                                        },
                                    },
                                    else: 0,
                                },
                            },
                        ],
                    } ],
                }, 0] },
                then: true,
                else: false,
            },
        },
        transportFee: {
            $sum: ['$fee', '$profit'],
        },
        shipperName: 1,
        shopName: { $concat: shopName },
        shopAddress: { $concat: shopAddress },
        distance: { $abs: distance },
        price: 1,
        minFee: 1,
        sendDoorPrice: 1,
        sendDoorMinFee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
        // delete below
        profit: 1,
        acountAmount: 1,
        fee: 1,
    })
    .match({ hasEnoughAmount: true })
    .sort(orderText)
    .skip(pageNo * pageSize)
    .limit(pageSize);

    return {
        count,
        roadmapList: docs,
    };
};

```

* PDShopServer/project/App/routers/posts/libs/roadmap/searchRoadmapListWithShopList.js

```js
import mongoose from 'mongoose';
import { RoadmapModel } from '../../../../models';
import { settingMgr } from '../../../../manager';
import getRegionProfitRateByEndPoint from './getRegionProfitRateByEndPoint';
import { omitNil } from '../../../../utils';

export default async ({
    shopList,
    fromPC,
    pageNo,
    pageSize,
    endPointLastCode, // 终点
    sendDoorEndPointLastCode, // 送货上门终点
    isCityDistribute, // 是否是同城配送
    isSendDoor, // 是否送货上门
    weight, // 重量
    size, // 方量
    proxyCharge, // 代收货款金额
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee, // 指定向收货人应该收多少钱
    orderBy, //排序方式, 0：以价格优先， 1：以时长优先
}) => {
    weight = settingMgr.getFloatWeight(weight, size); // 通过weight和size和阶梯价格计算重量
    const orderText = orderBy === 1 ? 'fee duration' : 'duration fee';
    const needBondAmount = settingMgr.getBondAmount(weight, size);
    const shopIdList = shopList.map(o => new mongoose.Types.ObjectId(o.id));
    for (const shop of shopList) {
        shop.regionProfitRate = await getRegionProfitRateByEndPoint(shop.id, endPointLastCode, isCityDistribute);
    }
    let count;

    if (fromPC && pageNo === 0) {
        const countResults = await RoadmapModel.aggregate()
        .match(omitNil({ shopId: { $in: shopIdList }, endPointLastCode, enable: true }))
        .project({
            sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
            shipperInBranchShopId: 1,
            shipperId: 1,
            price: 1,
            minFee: 1,
            profitRate: 1,
        })
        .project({
            shop: { $arrayElemAt: [ shopList, { $indexOfArray: [ shopList.map(o => o._id), '$shopId' ] } ] },
            sendDoorEnable: '$sendDoor.enable',
            sendDoorPrice: '$sendDoor.sendDoorPrice',
            sendDoorMinFee: '$sendDoor.sendDoorMinFee',
            shipperInBranchShopId: 1,
            shipperId: 1,
            price: 1,
            minFee: 1,
            profitRate: 1,
        })
        .match(isSendDoor ? { sendDoorEnable: true } : {})
        .lookup({ from: 'shipperinbranchshops', localField: 'shipperInBranchShopId', foreignField: '_id', as: 'shipperinbranchshop' })
        .project({
            profitRate: { $ifNull: [ '$profitRate', '$shop.regionProfitRate' ] },
            remainBondAmount: { $arrayElemAt: ['$shipperinbranchshop.remainBondAmount', 0] },
            fee: {
                $floor: { $sum: [
                    { $max: [ { $multiply: ['$price', weight] }, '$minFee' ] },
                    { $cond: { if: isSendDoor, then: { $max: [ { $multiply: ['$sendDoorPrice', weight] }, '$sendDoorMinFee' ] }, else: 0 } },
                ] },
            },
            shipperId: 1,
        })
        .match({ remainBondAmount: { $gte: needBondAmount } })
        .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
        .project({
            acountAmount: { $arrayElemAt: ['$shipper.acountAmount', 0] },
            profit: { $floor: { $multiply: [ '$fee', '$profitRate' ] } },
            fee: 1,
        })
        .project({
            hasEnoughAmount: {
                $cond: {
                    if: { $gte: [{
                        $subtract: [ '$acountAmount', {
                            $sum: [
                                proxyCharge,
                                {
                                    $cond: {
                                        if: isReachPay,
                                        then: {
                                            $cond: {
                                                if: totalDesignatedFee,
                                                // 如果有指定收款，需要扣除的钱为  totalDesignatedFee - fee
                                                then: { $subtract: [ totalDesignatedFee, '$fee' ] },
                                                // 否则，就是总部提成+分部提成，因为物流公司向收货人收取所有运费
                                                else: '$profit',
                                            },
                                        },
                                        else: 0,
                                    },
                                },
                            ],
                        } ],
                    }, 0] },
                    then: true,
                    else: false,
                },
            },
        })
        .match({ hasEnoughAmount: true })
        .group({
            _id: null,
            total: { $sum: 1 },
        });
        count = countResults.length ? countResults[0].total : 0;
    }

    const docs = await RoadmapModel.aggregate()
    .match(omitNil({ shopId: { $in: shopIdList }, endPointLastCode, enable: true }))
    .project({
        sendDoor: { $arrayElemAt: [{ $filter: { input: '$sendDoorList', as: 'item', cond: { $eq: [ '$$item.sendDoorEndPointLastCode', sendDoorEndPointLastCode ] } } }, 0] },
        shipperInBranchShopId: 1,
        shipperId: 1,
        price: 1,
        minFee: 1,
        profitRate: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .project({
        shop: { $arrayElemAt: [ shopList, { $indexOfArray: [ shopList.map(o => o._id), '$shopId' ] } ] },
        sendDoorEnable: '$sendDoor.enable',
        sendDoorPrice: '$sendDoor.sendDoorPrice',
        sendDoorMinFee: '$sendDoor.sendDoorMinFee',
        shipperInBranchShopId: 1,
        shipperId: 1,
        price: 1,
        minFee: 1,
        profitRate: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .match(isSendDoor ? { sendDoorEnable: true } : {})
    .lookup({ from: 'shipperinbranchshops', localField: 'shipperInBranchShopId', foreignField: '_id', as: 'shipperinbranchshop' })
    .project({
        remainBondAmount: { $arrayElemAt: ['$shipperinbranchshop.remainBondAmount', 0] },
        fee: {
            $floor: { $sum: [
                { $max: [ { $multiply: ['$price', weight] }, '$minFee' ] },
                { $cond: { if: isSendDoor, then: { $max: [ { $multiply: ['$sendDoorPrice', weight] }, '$sendDoorMinFee' ] }, else: 0 } },
            ] },
        },
        profitRate: { $ifNull: [ '$profitRate', '$shop.regionProfitRate' ] },
        shopName: '$shop.name',
        shopAddress: '$shop.address',
        distance: '$shop.distance',
        shipperId: 1,
        price: 1,
        minFee: 1,
        sendDoorPrice: 1,
        sendDoorMinFee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .match({ remainBondAmount: { $gte: needBondAmount } })
    .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
    .project({
        shipperName: { $arrayElemAt: ['$shipper.name', 0] },
        acountAmount: { $arrayElemAt: ['$shipper.acountAmount', 0] },
        profit: { $floor: { $multiply: [ '$fee', '$profitRate' ] } },
        price: { $multiply: [ '$price', { $sum: [ 1, '$profitRate' ] } ] },
        minFee: { $multiply: [ '$minFee', { $sum: [ 1, '$profitRate' ] } ] },
        sendDoorPrice: { $multiply: [ '$sendDoorPrice', { $sum: [ 1, '$profitRate' ] } ] },
        sendDoorMinFee: { $multiply: [ '$sendDoorMinFee', { $sum: [ 1, '$profitRate' ] } ] },
        shopName: 1,
        shopAddress: 1,
        distance: 1,
        fee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
    })
    .project({
        id: '$_id',
        _id: 0,
        hasEnoughAmount: {
            $cond: {
                if: { $gte: [{
                    $subtract: [ '$acountAmount', {
                        $sum: [
                            proxyCharge,
                            {
                                $cond: {
                                    if: isReachPay,
                                    then: {
                                        $cond: {
                                            if: totalDesignatedFee,
                                            // 如果有指定收款，需要扣除的钱为  totalDesignatedFee - fee
                                            then: { $subtract: [ totalDesignatedFee, '$fee' ] },
                                            // 否则就是总部提成+分部提成，因为物流公司向收货人收取所有运费
                                            else: '$profit',
                                        },
                                    },
                                    else: 0,
                                },
                            },
                        ],
                    } ],
                }, 0] },
                then: true,
                else: false,
            },
        },
        transportFee: { $sum: ['$fee', '$profit'] },
        shipperName: 1,
        shopName: 1,
        shopAddress: 1,
        distance: 1,
        price: 1,
        minFee: 1,
        sendDoorPrice: 1,
        sendDoorMinFee: 1,
        selfSignRate: 1,
        endPoint: 1,
        duration: 1,
        // delete below
        profit: 1,
        acountAmount: 1,
        fee: 1,
    })
    .match({ hasEnoughAmount: true })
    .sort(orderText)
    .skip(pageNo * pageSize)
    .limit(pageSize);

    return {
        count,
        roadmapList: docs,
    };
};

```

* PDShopServer/project/App/routers/posts/shipper/account/getBondAmountInfo.js

```js
import { ClientModel, ShipperInBranchShopModel } from '../../../../models';

export default async ({ userId, shopId }) => {
    const client = await ClientModel.findById(userId);
    if (!client || !client.shipperId) {
        return { msg: '没有该用户' };
    }

    let inShop = await ShipperInBranchShopModel.findOne({ shipperId: client.shipperId, shopId })
    .select({ totalBondAmount: 1, remainBondAmount: 1 });
    if (!inShop) {
        return { msg: '没有入住该分店' };
    }

    return { success: true, context: { totalBondAmount: inShop.totalBondAmount, remainBondAmount: inShop.remainBondAmount } };
};

```

* PDShopServer/project/App/routers/posts/libs/weixinPay/api.js

```js
import _ from 'lodash';
import crypto from 'crypto';
import xml2js from 'xml2js';
import superagent from 'superagent';
import randomstring from 'randomstring';
import { _T } from '../../../../utils/';
const WEIXIN_SERVER = 'https://api.mch.weixin.qq.com/';
const CONFIG = {
    mch_id: '1489315622',
    mch_key: '0guiyang0simiantong0085188622803',
    appid: 'wxcbe9347be9959618',
    appsecret: 'a4ff7d6e12a170c09e0bdd8ce016f9b8',
    notify_url: 'http://120.78.65.221/api/weixinNotifyCallBack',
};

export const generateSignature = params => {
    const crypt = crypto.createHash('MD5');
    crypt.update(new Buffer(_.keys(params).sort().map(k => k + '=' + params[k]).join('&') + '&key=' + CONFIG.mch_key));
    params.sign = crypt.digest('hex').toUpperCase();
    return params;
};

const request = (url, params, cb, ssl) => {
    params.appid = CONFIG.appid;
    params.mch_id = CONFIG.mch_id;
    params.notify_url = CONFIG.notify_url;
    params.nonce_str = randomstring.generate();
    generateSignature(params);
    const xml = '<xml>' + _.values(_.mapValues(params, (v, k) => !v ? '' : _.isNumber(v) ? `<${k}>${v}</${k}>` : `<${k}><![CDATA[${v}]]></${k}>`)).join('') + '</xml>';
    const onRequest = (error, res) => {
        if (!error && res.statusCode === 200) {
            xml2js.parseString(res.text, { explicitArray: false, ignoreAttrs: true }, (error, json) => {
                if (error) {
                    cb(true, res.text);
                } else {
                    const result = json.xml;
                    if (result.return_code === 'SUCCESS') {
                        cb(false, result);
                    } else {
                        cb(true, result.return_msg);
                    }
                }
            });
        } else {
            cb(true, res.text);
        }
    };
    superagent.post(url).set({ 'Content-Type': 'text/xml' }).send(xml).end(onRequest);
};

export default {
    unifiedorder (params) {
        return new Promise(async resolve => {
            request(WEIXIN_SERVER + 'pay/unifiedorder', params, (error, data) => {
                if (error) {
                    return resolve({ msg: data });
                } else {
                    if (data.trade_type === 'NATIVE') {
                        return resolve({
                            success: true,
                            context: {
                                appid: CONFIG.appid,
                                partnerid: CONFIG.mch_id,
                                prepayid: data.prepay_id,
                                code_url: data.code_url,
                            },
                        });
                    } else {
                        return resolve({
                            success: true,
                            context: generateSignature({
                                appid: CONFIG.appid,
                                partnerid: CONFIG.mch_id,
                                prepayid: data.prepay_id,
                                package: 'Sign=WXPay',
                                noncestr: randomstring.generate(),
                                timestamp: _T(Math.floor((new Date().getTime() / 1000))),
                            }),
                        });
                    }
                }
            });
        });
    },
    orderquery (params, cb) {
        params = _.pick(params, 'transaction_id', 'out_trade_no');
        request(WEIXIN_SERVER + 'pay/orderquery', params, cb);
    },
    closeorder (params, cb) {
        params = _.pick(WEIXIN_SERVER + 'pay/closeorder', 'out_trade_no');
        request(WEIXIN_SERVER + 'secapi/pay/closeorder', params, cb);
    },
    refund (params, cb) {
        request(WEIXIN_SERVER + 'secapi/pay/refund', params, cb, true);
    },
    refundquery (params, cb) {
        request(WEIXIN_SERVER + 'pay/refundquery', params, cb);
    },
    downloadbill (params, cb) {
        request(WEIXIN_SERVER + 'pay/downloadbill', params, cb);
    },
    report (params, cb) {
        request(WEIXIN_SERVER + 'payitil/report', params, cb);
    },
    sendredpack (params, cb) {
        request(WEIXIN_SERVER + 'mmpaymkttransfers/sendredpack', params, cb, true);
    },
    sendgroupredpack (params, cb) {
        request(WEIXIN_SERVER + 'mmpaymkttransfers/sendgroupredpack', params, cb, true);
    },
    gethbinfo (params, cb) {
        request(WEIXIN_SERVER + 'mmpaymkttransfers/gethbinfo', params, cb, true);
    },
    transfers (params, cb) {
        request(WEIXIN_SERVER + 'mmpaymkttransfers/promotion/transfers', params, cb, true);
    },
    gettransferinfo (params, cb) {
        request(WEIXIN_SERVER + 'mmpaymkttransfers/gettransferinfo', params, cb, true);
    },
};

```

* PDShopServer/project/App/routers/posts/libs/weixinPay/notifyCallBack.js

```js
import { WeixinPayModel } from '../../../../models';
import { _T, omitNil } from '../../../../utils/';
import moment from 'moment';
import CONSTANTS from '../../../../constants';
import { rechargeForClient, rechargeForShopMember } from '../account';
import { generateSignature } from './api';
import config from '../../../../../config';

export default async ({ xml }) => {
    const { sign, ...obj } = xml;
    generateSignature(obj);
    if (obj.sign !== sign) {
        return '<xml><return_code><![CDATA[FAIL]]></return_code></xml>';
    }
    const {
        return_code,
        // return_msg,
        result_code,
        out_trade_no,
        appid,
        mch_id,
        // nonce_str,
        openid,
        trade_type,
        bank_type,
        total_fee,
        cash_fee,
        transaction_id,
        time_end,
    } = xml;
    if (return_code === 'SUCCESS' && result_code === 'SUCCESS') {
        const order = await WeixinPayModel.findOne({
            _id: out_trade_no,
            state: CONSTANTS.PS_READY_PAY,
            appid,
            mch_id,
            total_fee,
            trade_type,
        });
        if (order) {
            await order.update(omitNil({
                state: CONSTANTS.PS_READY_SAVE,
                openid,
                bank_type,
                cash_fee,
                transaction_id,
                payedTime: moment(time_end, 'YYYYMMDDHHmmss').valueOf(),
            }));
            const userId = order.clientId || order.shopMemberId;
            const recharge = order.clientId ? rechargeForClient : rechargeForShopMember;
            const result = await recharge({
                userId: _T(userId),
                amount: total_fee * (config.weixinPayRate || 1), // 单位：分
                // 第三方的货单号  0：支付宝(A)， 1：财付通(C)，2：工商银行(G)，3：建设银行(J)， 4：中国银行（Z）， 5：农业银行(N)，规则：缩写字母#第三方的货单号#第三方账号
                thirdpartyAccount: `C#${transaction_id}#${openid}`,
            });
            if (result.success) {
                await order.update({ state: CONSTANTS.PS_SUCCESS });
            }
        } else {
            return '<xml><return_code><![CDATA[FAIL]]></return_code></xml>';
        }
    }

    return '<xml><return_code><![CDATA[SUCCESS]]></return_code></xml>';
};

```

* PDShopServer/project/App/routers/posts/shipper/cityDistribute/getCityTruckDetail.js

```js
import { CityTruckModel, ClientModel } from '../../../../models';
import _ from 'lodash';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    const client = await ClientModel.findById(userId);
    if (!client || !client.truckId) {
        return { msg: '你没有货车' };
    }
    const truck = await CityTruckModel.findById(client.truckId)
    .populate({
        path: 'unloadAllOrderList',
        select: {
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            endPoint: 1,
            stateList: 1,
            totalNumbers: 1,
        },
    });
    if (!truck) {
        return { msg: '没有该货车' };
    }

    const context = truck.toObject();
    _.forEach(context.unloadAllOrderList, item => {
        item.unloadNumber = (_.find(item.stateList, o => o.state === CONSTANTS.OS_READY_LOAD) || {}).count || 0;
        delete item.stateList;
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/cityDistribute/getClientPickShipperList.js

```js
import mongoose from 'mongoose';
import { ShipperInBranchShopModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    shopId,
}) => {
    const docs = await ShipperInBranchShopModel.aggregate()
    .match({ shopId: new mongoose.Types.ObjectId(shopId) })
    .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
    .project({
        _id: 0,
        id: { $arrayElemAt: ['$shipper._id', 0] },
        name: { $arrayElemAt: ['$shipper.name', 0] },
        shipperType: { $arrayElemAt: ['$shipper.shipperType', 0] },
        clientPickEnable: 1,
        clientPickPrice: 1,
    })
    .match({
        shipperType: CONSTANTS.ST_CITY,
        clientPickEnable: true,
        clientPickPrice: { $exists: true },
    })
    .sort({
        clientPickPrice: -1,
    });
    return { success: true, context: { shipperList: docs } };
};

```

* PDShopServer/project/App/routers/posts/shipper/cityDistribute/getOrderListInCityTruck.js

```js
import { CityTruckModel, ClientModel } from '../../../../models';

export default async ({ userId }) => {
    const client = await ClientModel.findById(userId);
    if (!client || !client.truckId) {
        return { msg: '你没有货车' };
    }
    const truck = await CityTruckModel.findById(client.truckId)
    .populate({
        path: 'orderList',
        select: {
            photo: 1,
            shopId: 1,
            agentId: 1,
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            name: 1,
            receiverId: 1,
            roadmapId: 1,
            realFee: 1,
            createTime: 1,
            placeOrderTime: 1,
            weight: 1,
            size: 1,
            stateList: 1,
            totalNumbers: 1,
            startPoint: 1,
            endPoint: 1,
            proxyCharge: 1,
            needPayInsuanceFee: 1,
            payMode: 1,
            isSendDoor: 1,
            isReachPay: 1,
            totalDesignatedFee: 1,
            isInsuance: 1,
        },
        populate: [{
            path: 'shopId',
            select: { name: 1, address: 1 },
        }, {
            path: 'agentId',
            select: { name: 1, address: 1 },
        }],
    });

    return { success: true, context: {
        orderList: (truck || {}).orderList || [],
    } };
};

```

* PDShopServer/project/App/routers/posts/shipper/cityDistribute/getOrders.js

```js
import _ from 'lodash';
import { OrderModel, ClientModel } from '../../../../models';
import { getKeywordCriteriaForOrder, omitNil, hasAuthority } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getPageData (shopId, shipperId, type, params) {
    let { keyword, startDate, endDate, fromPC, pageNo, pageSize } = params;
    let criteria = {};
    if (type === 'tostore') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_STOCK };
    } else if (type === 'stored') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_LOAD };
    } else if (type === 'onway') {
        criteria = { 'stateList.state': CONSTANTS.OS_ON_THE_WAY };
    } else if (type === 'success') {
        criteria = { 'stateList.state': CONSTANTS.OS_RECEIVE_SUCCESS };
    }
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }
    criteria = getKeywordCriteriaForOrder(keyword, omitNil({ ...criteria, shopId, shipperId }));

    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shopId: 1,
        shipperId: 1,
        senderName: 1,
        senderPhone: 1,
        receiverName: 1,
        receiverPhone: 1,
        name: 1,
        endPoint: 1,
        createTime: 1,
        modifyTime: 1,
        isReachPay: 1,
        payMode: 1,
        receiveMemberId: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        isInsuance: 1,
        insuanceMount: 1,
        insuanceFee: 1,
        fee: 1,
        profit: 1,
        masterProfit: 1,
        branchProfit: 1,
        realFee: 1,
        proxyCharge: 1,
        proxyChargeProfit: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
        totalDesignatedFee: 1,
        designatedFee: 1,
        placeOrderTime: 1,
    }).populate({
        path: 'receiveMemberId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperId',
        select: { name: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['待入库', '已入库', '运输中', '成功']
const TYPES = ['tostore', 'stored', 'onway', 'success'];
export default async ({ userId, shopId, type, ...params }) => {
    const client = await ClientModel.findById(userId);
    if (!client || !client.shipperId || !hasAuthority(client, CONSTANTS.AH_LOOK_ORDERS)) {
        return { msg: '你没有查看货单的权限' };
    }
    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(shopId, client.shipperId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                tostore: await getPageData(shopId, client.shipperId, 'tostore', params),
                stored: await getPageData(shopId, client.shipperId, 'stored', params),
                onway: await getPageData(shopId, client.shipperId, 'onway', params),
                success: await getPageData(shopId, client.shipperId, 'success', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/shipper/cityDistribute/placeStorage.js

```js
import _ from 'lodash';
import { ClientModel, OrderModel } from '../../../../models';
import { actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderId,
    count = 1,
}) => {
    const member = await ClientModel.findById(userId);
    if (!member || !member.shipperId) {
        return { msg: '无效操作' };
    }
    const order = await OrderModel.getOrderFromOriginOrder(member.shipperId, orderId, 1);
    if (!order) {
        return { msg: '没有该货单' };
    }

    const stateList = order.stateList;
    let item = _.find(stateList, (o) => o.state === CONSTANTS.OS_READY_STOCK);
    if (!item) {
        return { msg: '该货单没有待入库的货物' };
    }
    item.count -= count;
    if (item.count < 0) {
        return { msg: '数量无效' };
    }
    if (order.isClientPick) {
        item = _.find(stateList, (o) => o.state === CONSTANTS.OS_READY_PHONE_CONFIRM);
        if (item) {
            item.count += count;
        } else {
            stateList.unshift({ state: CONSTANTS.OS_READY_PHONE_CONFIRM, count });
        }
    } else {
        item = _.find(stateList, (o) => o.state === CONSTANTS.OS_READY_LOAD);
        if (item) {
            item.count += count;
        } else {
            stateList.unshift({ state: CONSTANTS.OS_READY_LOAD, count });
        }
    }
    order.stateList = _.filter(stateList, o => o.count > 0);
    order.shipperStoreScannerId = userId;
    order.placeStoreTime = Date.now();
    await order.save();

    actionLog(userId, 'Client', orderId, 'Order', 'placeStorage');

    return { success: true, order };
};

```

* PDShopServer/project/App/routers/posts/shipper/cityDistribute/scanLoadOrderForCityDistribute.js

```js
import { CityTruckModel, OrderModel, ClientModel } from '../../../../models';
import { _T, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    orderId,
    count = 1,
}) => {
    const member = await ClientModel.findById(userId);
    if (!member || !member.shipperId) {
        return { msg: '无效操作' };
    }
    if (!hasAuthority(member, CONSTANTS.AH_CITY_DISTRIBUTE)) {
        return { msg: '你没有扫描装车的权限' };
    }
    if (!member.truckId) {
        return { msg: '请现在个人中心设置货车' };
    }
    let truck = await CityTruckModel.findById(member.truckId);
    if (!truck) {
        return { msg: '没有该货车' };
    }
    const order = await OrderModel.getOrderFromOriginOrder(member.shipperId, orderId, 1);
    if (!order) {
        return { msg: '没有该货单' };
    }
    if (_T(order.shipperId) !== _T(member.shipperId)) {
        return { msg: '你无权扫描该货单' };
    }
    const stateList = order.stateList;
    let item = _.find(stateList, (o) => o.state === CONSTANTS.OS_READY_LOAD);
    if (!item) {
        return { msg: '该货单没有待装车的货物' };
    }
    item.count -= count;
    if (item.count < 0) {
        return { msg: '数量无效' };
    } else if (item.count === 0) {
        truck.unloadAllOrderList = _.reject(truck.unloadAllOrderList, o => _T(o) === _T(order.id));
    } else {
        truck.unloadAllOrderList = _.unionWith(truck.unloadAllOrderList, [order.id], (m, n) => _T(m) === _T(n));
    }
    item = _.find(stateList, (o) => o.state === CONSTANTS.OS_ON_THE_WAY);
    truck.totalNumbers += count;
    truck.totalWeight += order.weight * count / order.totalNumbers;
    truck.totalSize += order.size * count / order.totalNumbers;
    if (item) {
        item.count += count;
    } else {
        stateList.unshift({ state: CONSTANTS.OS_ON_THE_WAY, count });
    }
    order.stateList = _.filter(stateList, o => o.count > 0);
    order.loadScannerId = userId;
    order.loadScanTime = Date.now();
    order.truckId = truck.id;
    await order.save();

    if (!_.find(truck.orderList, o => _T(o) === _T(order.id))) {
        truck.orderList.unshift(order.id);
        truck.orderCount++;
    }

    await truck.save();

    truck = await CityTruckModel.findById(truck.id)
    .populate({
        path: 'unloadAllOrderList',
        select: {
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            endPoint: 1,
            stateList: 1,
            totalNumbers: 1,
        },
    });

    const context = truck.toObject();
    _.forEach(context.unloadAllOrderList, item => {
        item.unloadNumber = (_.find(item.stateList, o => o.state === CONSTANTS.OS_READY_LOAD) || {}).count || 0;
        delete item.stateList;
    });
    context.latestOrder = await OrderModel.findById(context.orderList[0])
    .select({
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        createTime: 1,
        photo: 1,
        endPoint: 1,
        totalNumbers: 1,
        size: 1,
        weight: 1,
    });
    delete context.orderList;

    actionLog(userId, 'Client', orderId, 'Order', 'scanLoadOrder');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/cityDistribute/setCityTruck.js

```js
import { CityTruckModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    plateNo, // 车牌号码
}) => {
    const client = await ClientModel.findById(userId);
    if (!hasAuthority(client, CONSTANTS.AH_CITY_DISTRIBUTE)) {
        return { msg: '你没有创建货车的权限' };
    }
    let truck;
    if (client.truckId) {
        truck = await CityTruckModel.findById(client.truckId);
        truck.plateNo = plateNo;
    } else {
        truck = new CityTruckModel({
            shipperId: client.shipperId,
            plateNo,
            driverId: userId,
        });
        client.truckId = truck.id;
        await client.save();
    }
    await truck.save();

    actionLog(userId, 'Client', truck.id, 'CityTruck', 'setCityTruck');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/cityDistribute/setClientPickOrderTransportFee.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { _T, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderId,
    isTransport, // 是否运送，如果打电话确认后需要运送，则为true，否则为false，等待用户上门自提
    endPoint, // 送货地
    transportFee, // 运费
    isScan, //是否是扫描，如果是扫描，则orderId传的是原始货单的id，否则就是传的当前货单的id
}) => {
    const member = await ClientModel.findById(userId);
    if (!member || !member.shipperId) {
        return { msg: '无效操作' };
    }
    let order;
    if (isScan) {
        order = await OrderModel.getOrderFromOriginOrder(member.shipperId, orderId, 1);
    } else {
        order = await OrderModel.findById(orderId);
    }
    if (!order) {
        return { msg: '没有该货单' };
    }
    if (_T(member.shipperId) !== _T(order.shipperId)) {
        return { msg: '你无权操作' };
    }
    order.confirmHandOverId = userId;
    if (!isTransport) {
        order.stateList = [ { state: CONSTANTS.OS_WAIT_CLIENT_PICK, count: order.totalNumbers } ];
    } else {
        order.stateList = [ { state: CONSTANTS.OS_READY_LOAD, count: order.totalNumbers } ];
        order.additionalFee = transportFee;
        order.endPoint = endPoint;
    }
    await order.save();

    actionLog(userId, 'Client', orderId, 'Order', 'setClientPickOrderTransportFee');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/loadCargo/continueScanOrder.js

```js
import { TruckModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_SCAN_LOAD_TRUCK, true)) {
        return { msg: '你没有扫描装车的权限' };
    }
    const truck = await TruckModel.findOne({
        scannerId: userId,
        state: CONSTANTS.TS_READY_PAY_FOR_CARRY_PARTMENT,
    });
    if (!truck) {
        return { msg: '你没有继续扫描的货车' };
    }
    truck.state = CONSTANTS.TS_SCAN_LOADING;
    await truck.save();

    actionLog(userId, 'Client', truck.id, 'Truck', 'continueScanOrder');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/loadCargo/finishScanOrder.js

```js
import { TruckModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_SCAN_LOAD_TRUCK, true)) {
        return { msg: '你没有扫描装车的权限' };
    }
    const truck = await TruckModel.findOne({
        scannerId: userId,
        state: CONSTANTS.TS_SCAN_LOADING,
    })
    .populate({
        path: 'carryPartmentId',
        select: { name: 1 },
    });
    if (!truck) {
        return { msg: '你没有正在扫描的货车' };
    }
    if (truck.unloadAllOrderList.length) {
        return { msg: '你还有一些货单没有全部装车' };
    }
    truck.state = CONSTANTS.TS_READY_PAY_FOR_CARRY_PARTMENT;
    await truck.save();
    actionLog(userId, 'Client', truck.id, 'Truck', 'finishScanOrder');

    return { success: true, context: truck };
};

```

* PDShopServer/project/App/routers/posts/shipper/loadCargo/getCarryPartmentList.js

```js
import { TruckModel, ShopPartmentModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({ userId, truckId }) => {
    const truck = await TruckModel.findById(truckId);
    const partmenList = await ShopPartmentModel.find({
        shopId: truck.shopId,
        type: CONSTANTS.SP_CARRY_PARTMENT,
        enable: true,
        workTruckId: { $exists: false },
        price: { $exists: true },
    }).sort({ price: 'asc' });

    return { success: true, context: {
        partmenList,
    } };
};

```

* PDShopServer/project/App/routers/posts/shipper/loadCargo/payForCarryPartment.js

```js
import { TruckModel, ShopPartmentModel, ShipperModel } from '../../../../models';
import { sequelize, AccountModel, BillModel, TruckPaymentModel } from '../../../../mysql';
import { _T, _F, _Y, hasAuthority, actionLog, authenticatePaymentPassword } from '../../../../utils';
import CONSTANTS from '../../../../constants';

const ERROR_HAVE_PAYED = '10000';
const ERROR_SHIPPER_MONEY_NOT_ENOUGH = '10002';
const ERROR_OTHER = '10004';
function payment (shipperId, truckId, shipperChairManId, carryPartmentId, amount) {
    return new Promise(async resolve => {
        sequelize.transaction(async (transaction) => {
            const truckPayment = await TruckPaymentModel.findOne({ where: { truckId, isPayedForCarryPartment: true }, transaction });
            if (truckPayment) {
                throw ERROR_HAVE_PAYED;
            }
            const shipperAccount = await AccountModel.findOne({ where: { targetId: shipperChairManId, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } }, transaction });
            if (!shipperAccount) {
                throw ERROR_SHIPPER_MONEY_NOT_ENOUGH;
            }
            const acountAmount = _Y(shipperAccount.amount - amount);
            await shipperAccount.decrement({ amount }, { transaction });
            const partmentAccount = await AccountModel.findOne({ where: { targetId: carryPartmentId, type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT }, transaction });
            await partmentAccount.increment({ amount }, { transaction });
            await BillModel.create({ account: shipperAccount.id, truckId, tradeAmount: -amount, remark: '付搬运款' }, { transaction });
            await BillModel.create({ account: partmentAccount.id, truckId, tradeAmount: amount, remark: '收到搬运款' }, { transaction });

            await TruckPaymentModel.create({ truckId, isPayedForCarryPartment: true, payedForCarryPartmentTime: new Date() }, { transaction });
            // 扣款成功后，需要更新物流公司的账目
            const doc = await ShipperModel.findByIdAndUpdate(shipperId, { acountAmount }).catch(e => {
                throw e;
            });
            if (!doc) {
                throw ERROR_OTHER;
            }
        }).then((result) => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

export default async ({ userId, truckId, payPassword }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_SCAN_LOAD_TRUCK, true)) {
        return { msg: '你没有扫描装车的权限' };
    }
    const criteria = truckId ? { _id: truckId } : { scannerId: userId };
    const truck = await TruckModel.findOne({
        ...criteria,
        state: CONSTANTS.TS_READY_PAY_FOR_CARRY_PARTMENT,
    }).populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    });
    if (!truck) {
        return { msg: '你没有完成扫描的货车' };
    }
    const error = await authenticatePaymentPassword(userId, payPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    const amount = _F(truck.totalWeight * truck.carryPrice);
    const err = await payment(truck.shipper.id, _T(truck.id), _T(truck.shipper.chairManId), _T(truck.carryPartmentId), amount);
    if (err === ERROR_HAVE_PAYED) {
        truck.state = CONSTANTS.TS_READY_EXIT_WAREHOUSE;
        await truck.save();
        return { msg: '该货单无需再支付' };
    } else if (err === ERROR_SHIPPER_MONEY_NOT_ENOUGH) {
        return { msg: '余额不足，请先充值' };
    } else if (err) {
        return { msg: '系统出错，请稍后再试' };
    }
    truck.state = CONSTANTS.TS_READY_EXIT_WAREHOUSE;
    await truck.save();
    await ShopPartmentModel.findByIdAndUpdate(truck.carryPartmentId, { $unset: { workTruckId: 1 } });

    actionLog(userId, 'Client', truck.id, 'Truck', 'payForCarryPartment');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/loadCargo/scanLoadOrder.js

```js
import { TruckModel, OrderModel, ClientModel } from '../../../../models';
import { _T, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    orderId,
    count = 1,
}) => {
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_SCAN_LOAD_TRUCK)) {
        return { msg: '你没有扫描装车的权限' };
    }
    let truck = await TruckModel.findOne({
        scannerId: userId,
        state: CONSTANTS.TS_SCAN_LOADING,
    });
    if (!truck) {
        return { msg: '你没有正在扫描的货车' };
    }

    const order = await OrderModel.getOrderFromOriginOrder(truck.shopId, orderId);
    if (!order) {
        return { msg: '没有找到该货单' };
    }
    if (_T(order.shipperId) !== _T(member.shipperId)) {
        return { msg: '你无权扫描该货单' };
    }
    const stateList = order.stateList;
    let item = _.find(stateList, (o) => o.state === CONSTANTS.OS_READY_LOAD);
    if (!item) {
        return { msg: '该货单没有待装车的货物' };
    }
    item.count -= count;
    if (item.count < 0) {
        return { msg: '数量无效' };
    } else if (item.count === 0) {
        truck.unloadAllOrderList = _.reject(truck.unloadAllOrderList, o => _T(o) === _T(order.id));
    } else {
        truck.unloadAllOrderList = _.unionWith(truck.unloadAllOrderList, [order.id], (m, n) => _T(m) === _T(n));
    }
    item = _.find(stateList, (o) => o.state === CONSTANTS.OS_READY_START_OFF);
    truck.totalNumbers += count;
    truck.totalWeight += order.weight * count / order.totalNumbers;
    truck.totalSize += order.size * count / order.totalNumbers;
    if (item) {
        item.count += count;
    } else {
        stateList.unshift({ state: CONSTANTS.OS_READY_START_OFF, count });
    }
    order.stateList = _.filter(stateList, o => o.count > 0);
    order.loadScannerId = userId;
    order.loadScanTime = Date.now();
    order.truckId = truck.id;
    await order.save();

    if (!_.find(truck.orderList, o => _T(o) === _T(order.id))) {
        truck.orderList.unshift(order.id);
        truck.orderCount++;
    }

    await truck.save();

    truck = await TruckModel.findById(truck.id)
    .populate({
        path: 'unloadAllOrderList',
        select: {
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            endPoint: 1,
            stateList: 1,
            totalNumbers: 1,
        },
    });

    const context = truck.toObject();
    _.forEach(context.unloadAllOrderList, item => {
        item.unloadNumber = (_.find(item.stateList, o => o.state === CONSTANTS.OS_READY_LOAD) || {}).count || 0;
        delete item.stateList;
    });
    context.latestOrder = await OrderModel.findById(context.orderList[0])
    .select({
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        createTime: 1,
        photo: 1,
        endPoint: 1,
        totalNumbers: 1,
        size: 1,
        weight: 1,
    });
    delete context.orderList;

    actionLog(userId, 'Client', orderId, 'Order', 'scanOrder');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/loadCargo/selectCarryPartment.js

```js
import { TruckModel, ShopPartmentModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, truckId, carryPartmentId }) => {
    if (!await hasAuthority(userId, CONSTANTS.SELECT_CARRY_PARTMENT, true)) {
        return { msg: '你没有选择搬运队的权限' };
    }
    const truck = await TruckModel.findById(truckId);
    if (!truck) {
        return { msg: '没有该货车' };
    }
    if (truck.state !== CONSTANTS.TS_READY_SEARCH_CARRY_PARTMENT) {
        return { msg: '该货车不处于待找搬运队状态' };
    }
    const carryPartment = await ShopPartmentModel.findById(carryPartmentId);
    if (!carryPartment) {
        return { msg: '没有该搬运队' };
    }
    if (!carryPartment.enable) {
        return { msg: '该搬运队已经停运，请选择其他搬运队' };
    }
    if (carryPartment.workTruckId) {
        return { msg: '该搬运队已经在搬运中，请选择其他搬运队' };
    }
    carryPartment.workTruckId = truckId;
    await carryPartment.save();
    await truck.update({ carryPartmentId, carryPrice: carryPartment.price, state: CONSTANTS.TS_READY_SCAN_LOAD });

    actionLog(userId, 'Client', truckId, 'Truck', 'selectCarryPartment');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/loadCargo/startScanOrder.js

```js
import { TruckModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, truckId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_SCAN_LOAD_TRUCK, true)) {
        return { msg: '你没有扫描装车的权限' };
    }
    const truck = await TruckModel.findById(truckId);
    if (!truck) {
        return { msg: '没有该货车' };
    }
    if (truck.state !== CONSTANTS.TS_READY_SCAN_LOAD) {
        return { msg: '该货车处于待装车状态' };
    }
    await truck.update({ scannerId: userId, state: CONSTANTS.TS_SCAN_LOADING });

    actionLog(userId, 'Client', truckId, 'Truck', 'startScanOrder');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/order/confirmHandOverOrder.js

```js
import { ClientModel, OrderModel, TruckModel, StartPointAddressModel } from '../../../../models';
import { _T, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

// 该接口只有在物流公司到达地没有分店的情况使用,否则必须由分店进行分发货物
export default async ({
    userId,
    orderId,
    isScan, //是否是扫描，如果是扫描，则orderId传的是原始货单的id，否则就是传的当前货单的id
}) => {
    const client = await ClientModel.findById(userId);
    if (!client || !client.shipperId) {
        return { msg: '无效操作' };
    }
    let order;
    if (isScan) {
        order = await OrderModel.getOrderFromOriginOrder(client.shipperId, orderId, 1);
    } else {
        order = await OrderModel.findById(orderId);
    }
    if (!order) {
        return { msg: '没有该货单' };
    }
    if (order.stateList[0].state !== CONSTANTS.OS_ON_THE_WAY) {
        return { msg: '货单状态错误' };
    }
    if (_T(client.shipperId) !== _T(order.shipperId)) {
        return { msg: '你无权确认' };
    }
    // 判断货单的终点地方是否有分店
    if (await StartPointAddressModel.findOne({ code: order.endPointLastCode })) {
        return { msg: '你无权确认，该货单必须拉到分店进行分发' };
    }
    order.stateList = [ { state: CONSTANTS.OS_READY_RECEIVE, count: order.totalNumbers } ];
    order.confirmHandOverId = userId;
    await order.save();
    // 当物流公司确认卸货后为待交货状态，需要修改它之前所有的货单的状态
    const orderIdList = await OrderModel.getOrderIdListFromNode(order);
    if (orderIdList.length) {
        await OrderModel.update({ _id: { $in: orderIdList } }, { 'stateList.0.state': CONSTANTS.OS_READY_RECEIVE }, { multi: true });
    }

    // 如果货车没有确认到达，需要强制确认到达
    await TruckModel.findByIdAndUpdate(order.truckId, { state: CONSTANTS.TS_RECEIVE_SUCCESS });

    actionLog(userId, 'Client', orderId, 'Order', 'confirmHandOver');

    return { success: true, context: { order } };
};

```

* PDShopServer/project/App/routers/posts/shipper/order/getNeedSendOrderListByEndPoint.js

```js
import { OrderModel } from '../../../../models';
import { getOwnShipper } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, shopId, endPoint, fromPC, pageNo, pageSize }) => {
    const shipperId = await getOwnShipper(userId);
    const criteria = { shipperId, shopId, endPoint, 'stateList.state': { $in: [ CONSTANTS.OS_READY_STOCK, CONSTANTS.OS_READY_LOAD ] } };
    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ weight: 'desc', size: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        photo: 1,
        shopId: 1,
        agentId: 1,
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        name: 1,
        roadmapId: 1,
        realFee: 1,
        createTime: 1,
        placeOrderTime: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        totalNumbers: 1,
        startPoint: 1,
        endPoint: 1,
        sendDoorEndPoint: 1,
        isSendDoor: 1,
        proxyCharge: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
        payMode: 1,
        isReachPay: 1,
        totalDesignatedFee: 1,
        isInsuance: 1,
    }).populate({
        path: 'roadmapId',
        select: { startPoint: 1, endPoint: 1 },
    });

    return { success: true, context: {
        count,
        orderList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shipper/order/getNeedSendOrderSummaryList.js

```js
import { OrderModel } from '../../../../models';
import { getKeywordCriteriaForOrder, getOwnShipper } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import mongoose from 'mongoose';

export default async ({ userId, shopId, keyword, fromPC, pageNo, pageSize }) => {
    const shipperId = await getOwnShipper(userId);
    const criteria = getKeywordCriteriaForOrder(keyword, {
        shipperId: new mongoose.Types.ObjectId(shipperId),
        shopId: new mongoose.Types.ObjectId(shopId),
        'stateList.state': { $in: [ CONSTANTS.OS_READY_STOCK, CONSTANTS.OS_READY_LOAD ] },
    });
    let count;
    if (fromPC && pageNo === 0) {
        const countResults = await OrderModel.aggregate()
        .match(criteria)
        .group({
            _id: '$endPoint',
        })
        .group({
            _id: null,
            total: { $sum: 1 },
        });
        count = countResults.length ? countResults[0].total : 0;
    }

    const docs = await OrderModel.aggregate()
    .match(criteria)
    .group({
        _id: '$endPoint',
        orderCount: { $sum: 1 },
        totalNumbers: { $sum: '$totalNumbers' },
        totalSize: { $sum: '$size' },
        totalWeight: { $sum: '$weight' },
        totalFee: { $sum: '$fee' },
    })
    .project({
        endPoint: '$_id',
        _id: 0,
        orderCount: 1,
        totalNumbers: 1,
        totalSize: 1,
        totalWeight: 1,
        totalFee: 1,
    })
    .sort('totalWeight totalSize')
    .skip(pageNo * pageSize)
    .limit(pageSize);

    return { success: true, context: {
        count,
        orderList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shipper/order/getOrders.js

```js
import _ from 'lodash';
import { OrderModel, ClientModel } from '../../../../models';
import { getKeywordCriteriaForOrder, omitNil, hasAuthority } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getPageData (shopId, shipperId, type, params) {
    let { keyword, startDate, endDate, fromPC, pageNo, pageSize } = params;
    let criteria = {};
    if (type === 'tostore') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_STOCK };
    } else if (type === 'stored') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_LOAD };
    } else if (type === 'tostartoff') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_START_OFF };
    } else if (type === 'onway') {
        criteria = { 'stateList.state': CONSTANTS.OS_ON_THE_WAY };
    } else if (type === 'success') {
        criteria = { 'stateList.state': CONSTANTS.OS_RECEIVE_SUCCESS };
    }
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }
    criteria = getKeywordCriteriaForOrder(keyword, omitNil({ ...criteria, shopId, shipperId }));

    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shopId: 1,
        shipperId: 1,
        senderName: 1,
        senderPhone: 1,
        receiverName: 1,
        receiverPhone: 1,
        name: 1,
        endPoint: 1,
        createTime: 1,
        modifyTime: 1,
        isReachPay: 1,
        payMode: 1,
        receiveMemberId: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        isInsuance: 1,
        insuanceMount: 1,
        insuanceFee: 1,
        fee: 1,
        profit: 1,
        masterProfit: 1,
        branchProfit: 1,
        realFee: 1,
        proxyCharge: 1,
        proxyChargeProfit: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
        totalDesignatedFee: 1,
        designatedFee: 1,
        placeOrderTime: 1,
    }).populate({
        path: 'receiveMemberId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperId',
        select: { name: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['待入库', '已入库', '待出发', '运输中', '成功']
const TYPES = ['tostore', 'stored', 'tostartoff', 'onway', 'success'];
export default async ({ userId, shopId, type, ...params }) => {
    const client = await ClientModel.findById(userId);
    if (!client || !client.shipperId || !hasAuthority(client, CONSTANTS.AH_LOOK_ORDERS)) {
        return { msg: '你没有查看货单的权限' };
    }
    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(shopId, client.shipperId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                tostore: await getPageData(shopId, client.shipperId, 'tostore', params),
                stored: await getPageData(shopId, client.shipperId, 'stored', params),
                tostartoff: await getPageData(shopId, client.shipperId, 'tostartoff', params),
                onway: await getPageData(shopId, client.shipperId, 'onway', params),
                success: await getPageData(shopId, client.shipperId, 'success', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/getRoadmapDetail.js

```js
import { RoadmapModel } from '../../../../models';

export default async ({ userId, roadmapId }) => {
    const context = await RoadmapModel.findById(roadmapId)
    .populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });
    if (!context) {
        return { msg: '没有该线路' };
    }

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/getRoadmapList.js

```js
import { RoadmapModel } from '../../../../models';
import { getKeywordCriteriaForRoadmap, getOwnShipper } from '../../../../utils';
import _ from 'lodash';

export default async ({ userId, shopId, isCityDistribute = false, keyword, fromPC, pageNo, pageSize }) => {
    const shipperId = await getOwnShipper(userId);
    const criteria = getKeywordCriteriaForRoadmap(keyword, { shipperId, shopId, isCityDistribute });
    const count = (fromPC && pageNo === 0) ? await RoadmapModel.count(criteria) : undefined;
    const query = RoadmapModel.find(criteria).sort({ modifyTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        endPoint: 1,
        endPointLastCode: 1,
        price: 1,
        basePrice: 1,
        updatePriceTime: 1,
        minFee: 1,
        baseMinFee: 1,
        updateMinFeeTime: 1,
        duration: 1,
        selfSignRate: 1,
        shopId: 1,
        enable: 1,
        sendDoorEnable: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    return { success: true, context: {
        count,
        roadmapList: docs.map(o => _.omit(o.toObject(), 'shop')),
    } };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/modifyRoadmap.js

```js
import { RoadmapModel } from '../../../../models';
import { omitNil, hasAuthority, actionLog } from '../../../../utils/';
import { registeredRoadmapAddress } from '../../libs/address';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    roadmapId,
    endPoint,
    endPointLastCode,
    price, // 单价
    basePrice, // 价格保底价
    minFee, // 起步价
    baseMinFee, // 起步价保底价
}) => {
    const roadmap = await RoadmapModel.findById(roadmapId);
    if (!roadmap) {
        return { msg: '没有该路线' };
    }
    if (!await hasAuthority(userId, !roadmap.isCityDistribute ? CONSTANTS.AH_MODIFY_ROADMAP : CONSTANTS.AH_MODIFY_SEND_DOOR_ROADMAP, true)) {
        return { msg: '你没有修改路线的权限' };
    }

    if (endPointLastCode) {
        if (await RoadmapModel.findOne({ _id: { $ne: roadmapId }, endPointLastCode, shopId: roadmap.shopId, shipperId: roadmap.shipperId })) {
            return { msg: '你已经在该店创建过该方向的路线' };
        }
    }
    let updatePriceTime, updateMinFeeTime;
    const now = Date.now();
    if (!_.isNil(price) && price !== roadmap.price) {
        updatePriceTime = now;
    }
    if (!_.isNil(minFee) && minFee !== roadmap.minFee) {
        updateMinFeeTime = now;
    }

    await roadmap.update(omitNil({
        endPoint,
        endPointLastCode,
        price,
        basePrice,
        updatePriceTime,
        minFee,
        baseMinFee,
        updateMinFeeTime,
        modifyTime: now,
    }));
    (!roadmap.isCityDistribute && roadmap.enable && (endPointLastCode && endPointLastCode !== roadmap.endPointLastCode)) &&
    await registeredRoadmapAddress(roadmap.shopId, endPointLastCode, roadmap.endPointLastCode); // 只有roadmap为enable的时候注册地址

    const context = await RoadmapModel.findById(roadmapId)
    .select({
        endPoint: 1,
        endPointLastCode: 1,
        price: 1,
        basePrice: 1,
        updatePriceTime: 1,
        minFee: 1,
        baseMinFee: 1,
        updateMinFeeTime: 1,
        duration: 1,
        selfSignRate: 1,
        shopId: 1,
        enable: 1,
        sendDoorEnable: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    actionLog(userId, 'Client', roadmapId, 'Roadmap', 'modifyRoadmap');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/publishRoadmap.js

```js
import { RoadmapModel, ShipperInBranchShopModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils/';
import { getSendDoorLastCodeList } from '../../libs/address';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    shopId,
    endPoint, // 终点，精确到镇级别
    endPointLastCode, // 终点县级代码
    price, // 单价
    basePrice, // 价格保底价
    minFee, // 起步价
    baseMinFee, // 起步价保底价
    isCityDistribute, //是否是同城配送的路线
}) => {
    const client = await ClientModel.findById(userId);
    if (!hasAuthority(client, !isCityDistribute ? CONSTANTS.AH_CREATE_ROADMAP : CONSTANTS.AH_CREATE_SEND_DOOR_ROADMAP)) {
        return { msg: '你没有创建路线的权限' };
    }
    const inShop = await ShipperInBranchShopModel.findOne({ shipperId: client.shipperId, shopId });
    if (!inShop) {
        return { msg: '你没有入驻该分店' };
    }
    const roadmap = await RoadmapModel.findOne({ shipperId: client.shipperId, shopId, endPointLastCode });
    if (roadmap) {
        return { msg: '你已经在该店创建过该方向的路线' };
    }

    // 如果是长途运送，需要为该路线添加所有的同城配送的列表，但是不设置价格，enable设置为false
    const data = {
        shipperId: client.shipperId,
        shopId,
        shipperInBranchShopId: inShop.id,
        endPoint,
        endPointLastCode,
        price,
        basePrice,
        minFee,
        baseMinFee,
        isCityDistribute,
        enable: isCityDistribute, //同城配送的路线默认为开启状态
    };
    if (!isCityDistribute) {
        const now = Date.now();
        const endPointLastCodeList = await getSendDoorLastCodeList(endPointLastCode);
        data.sendDoorList = endPointLastCodeList.map(o => ({
            sendDoorEndPoint: o.address,
            sendDoorEndPointLastCode: o.code,
            enable: false,
            sendDoorPrice: o.sendDoorPrice,
            sendDoorMinFee: o.sendDoorMinFee,
            baseSendDoorPrice: 0,
            baseSendDoorMinFee: 0,
            updateSendDoorPriceTime: now,
            updateSendDoorMinFeeTime: now,
        }));
    }

    const doc = new RoadmapModel(data);
    await doc.save();

    const context = await RoadmapModel.findById(doc.id).select({
        endPoint: 1,
        endPointLastCode: 1,
        price: 1,
        basePrice: 1,
        updatePriceTime: 1,
        minFee: 1,
        baseMinFee: 1,
        updateMinFeeTime: 1,
        duration: 1,
        selfSignRate: 1,
        shopId: 1,
        enable: 1,
        sendDoorEnable: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    actionLog(userId, 'Client', doc.id, 'Roadmap', 'publishRoadmap');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/removeRoadmap.js

```js
import { RoadmapModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    roadmapId,
}) => {
    const roadmap = await RoadmapModel.findById(roadmapId);
    if (!roadmap) {
        return { msg: '没有该路线' };
    }
    if (!await hasAuthority(userId, !roadmap.isCityDistribute ? CONSTANTS.AH_REMOVE_ROADMAP : CONSTANTS.AH_REMOVE_SEND_DOOR_ROADMAP, true)) {
        return { msg: '你没有删除路线的权限' };
    }
    await roadmap.remove();

    actionLog(userId, 'Client', roadmapId, 'Roadmap', 'removeRoadmap');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/setRoadmapEnable.js

```js
import { RoadmapModel, ShipperModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLogWithList } from '../../../../utils';
import { registeredRoadmapAddress } from '../../libs/address';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    roadmapIdList,
    enable,
}) => {
    const user = await ClientModel.findById(userId);
    if (!user.shipperId) {
        return { msg: '你不是物流公司' };
    }
    const shipper = await ShipperModel.findById(user.shipperId);
    if (shipper.shipperType === 1) {
        if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_SEND_DOOR_ROADMAP, true)) {
            return { msg: '你没有修改同城配送路线的权限' };
        }
    } else {
        if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP, true)) {
            return { msg: '你没有修改路线的权限' };
        }
    }

    const result = await RoadmapModel.update({ _id: { $in: roadmapIdList }, sendDoorEnable: true }, { enable }, { multi: true });
    if (result.n) {
        for (const roadmapId of roadmapIdList) {
            const roadmap = await RoadmapModel.findById(roadmapId);
            if (roadmap.enable) {
                await registeredRoadmapAddress(roadmap.shopId, roadmap.endPointLastCode);
            } else {
                await registeredRoadmapAddress(roadmap.shopId, undefined, roadmap.endPointLastCode);
            }
        }
    }

    if (roadmapIdList.length === 1) {
        if (!result.n) {
            return { msg: '必须保证每条送货上门的路线正常运营' };
        }
    } else {
        if (!result.n) {
            return { msg: '修改失败，必须保证每条路线的送货上门的路线正常运营' };
        } else if (roadmapIdList.length !== result.n) {
            return { msg: '修改失败，部分路线的送货上门的路线为非正常运营状态' };
        }
    }

    actionLogWithList(userId, 'Client', roadmapIdList.map(o => ({ id: o, model: 'Roadmap' })), 'setRoadmapEnable');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/setRoadmapPrice.js

```js
import { RoadmapModel, ClientModel, ShipperModel } from '../../../../models';
import { _T, hasAuthority, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    roadmapIdList,
    mode, // 0: 按照价格调整  1: 按照百分比调整  2: 按照名次调整
    typeList, // 数组，0：长途运费单价  1：长途运费起价
    value, // 如果mode为0和1时，正数为增加，负数为减少
}) => {
    if (!value || !typeList || !typeList.length) {
        return { msg: '参数错误' };
    }
    const user = await ClientModel.findById(userId);
    if (!user.shipperId) {
        return { msg: '你不是物流公司' };
    }
    const shipper = await ShipperModel.findById(user.shipperId);
    if (shipper.shipperType === 1) {
        if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_SEND_DOOR_ROADMAP, true)) {
            return { msg: '你没有修改同城配送路线的权限' };
        }
    } else {
        if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP, true)) {
            return { msg: '你没有修改路线的权限' };
        }
    }
    const keys = [ 'price', 'minFee' ];
    const baseKeys = [ 'basePrice', 'baseMinFee' ];
    const timeKeys = [ 'updatePriceTime', 'updateMinFeeTime' ];
    const now = Date.now();

    if (mode === 0) {
        const incKeys = Object.assign(...typeList.map(o => ({ [keys[o]]: value })));
        const setKeys = Object.assign(...typeList.map(o => ({ [timeKeys[o]]: now })));
        await RoadmapModel.update({ _id: { $in: roadmapIdList } }, { $inc: incKeys, ...setKeys }, { multi: true });
    } else if (mode === 1) {
        const incKeys = Object.assign(...typeList.map(o => ({ [keys[o]]: value / 100 + 1, [timeKeys[o]]: now })));
        const setKeys = Object.assign(...typeList.map(o => ({ [timeKeys[o]]: now })));
        await RoadmapModel.update({ _id: { $in: roadmapIdList } }, { $mul: incKeys, ...setKeys }, { multi: true });
    } else {
        let successCount = 0;
        for (const i in roadmapIdList) {
            const roadmap = await RoadmapModel.findById(roadmapIdList[i]);
            if (!roadmap) {
                continue;
            }
            const updateOptions = {};
            for (const j in typeList) {
                const key = keys[typeList[j]];
                const baseKey = baseKeys[typeList[j]];
                const timeKey = timeKeys[typeList[j]];
                const relateRoadmapList = await RoadmapModel.find({ shopId: roadmap.shopId, endPointLastCode: roadmap.endPointLastCode })
                .sort({ [key]: 'asc', [timeKey]: 'asc' }).limit(value);
                const relateRoadmap = relateRoadmapList[value - 1];
                const newPrice = relateRoadmap[key] - 0.01; // 注意： 这里每次加分减少1分钱
                if (relateRoadmap && _T(relateRoadmap.id) !== roadmapIdList[i] && !roadmap[baseKey] && newPrice > roadmap[baseKey]) {
                    updateOptions[key] = newPrice;
                    updateOptions[timeKey] = now;
                }
            }
            if (_.keys(updateOptions).length) {
                await roadmap.update(updateOptions);
                successCount++;
            }
        }
        if (successCount === 0) {
            return { msg: '设置失败，可能是没有设置底价、或者价格已经超过底价、或者已经是第' + value + '名' };
        }
        if (successCount !== roadmapIdList.length) {
            return { msg: '部分设置失败，可能是没有设置底价、或者价格已经超过底价、或者已经是第' + value + '名' };
        }
    }

    actionLogWithList(userId, 'Client', roadmapIdList.map(o => ({ id: o, model: 'Roadmap' })), 'setRoadmapPrice');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/setRoadmapSendDoorBasePrice.js

```js
import { RoadmapModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    roadmapId,
    lastCodeList,
    mode, //  0: 设置底价, 1: 按照价格调整  2: 按照百分比调整
    typeList, // 数组，0：同城配送运费单价的底价  1：同城配送运费起价的底价
    value, // 如果mode为0和1时，正数为增加，负数为减少
}) => {
    if (!value || !typeList || !typeList.length) {
        return { msg: '参数错误' };
    }
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP, true)) {
        return { msg: '你没有修改路线的权限' };
    }
    const roadmap = await RoadmapModel.findById(roadmapId);
    if (!roadmap) {
        return { msg: '没有该路线' };
    }
    const sendDoorList = roadmap.sendDoorList;
    const keys = [ 'baseSendDoorPrice', 'baseSendDoorMinFee' ];

    if (mode === 0) {
        _.forEach(lastCodeList, o => {
            const item = _.find(sendDoorList, m => m.sendDoorEndPointLastCode === o);
            item && _.forEach(typeList, k => { item[keys[k]] = value; });
        });
        await roadmap.save();
    } else if (mode === 1) {
        _.forEach(lastCodeList, o => {
            const item = _.find(sendDoorList, m => m.sendDoorEndPointLastCode === o);
            item && _.forEach(typeList, k => { item[keys[k]] += value; });
        });
        await roadmap.save();
    } else if (mode === 2) {
        _.forEach(lastCodeList, o => {
            const item = _.find(sendDoorList, m => m.sendDoorEndPointLastCode === o);
            item && _.forEach(typeList, k => { item[keys[k]] *= (value / 100 + 1); });
        });
        await roadmap.save();
    }

    actionLog(userId, 'Client', roadmapId, 'Roadmap', 'setRoadmapSendDoorBasePrice');

    return { success: true, context: { sendDoorList: _.filter(roadmap.toObject().sendDoorList, o => _.includes(lastCodeList, o.sendDoorEndPointLastCode)) } };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/setRoadmapSendDoorEnable.js

```js
import { RoadmapModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    roadmapId,
    lastCodeList,
    enable,
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP, true)) {
        return { msg: '你没有修改路线的权限' };
    }
    const roadmap = await RoadmapModel.findById(roadmapId);
    if (!roadmap) {
        return { msg: '没有该路线' };
    }
    _.forEach(lastCodeList, o => { const item = _.find(roadmap.sendDoorList, m => m.sendDoorEndPointLastCode === o); item && (item.enable = enable); });
    roadmap.sendDoorEnable = _.every(roadmap.sendDoorList, o => o.enable);
    if (roadmap.enable && !roadmap.sendDoorEnable) {
        roadmap.enable = false;
    }
    await roadmap.save();

    actionLog(userId, 'Client', roadmapId, 'Roadmap', 'setRoadmapSendDoorEnable');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shipper/roadmap/setRoadmapSendDoorPrice.js

```js
import { RoadmapModel } from '../../../../models';
import { _T, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    roadmapId,
    lastCodeList,
    mode, // 0: 按照价格调整  1: 按照百分比调整  2: 按照名次调整
    typeList, // 数组，0：送货上门单价  1：送货上门起价
    value, // 如果mode为0和1时，正数为增加，负数为减少
}) => {
    if (!value || !typeList || !typeList.length) {
        return { msg: '参数错误' };
    }
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP, true)) {
        return { msg: '你没有修改路线的权限' };
    }
    const roadmap = await RoadmapModel.findById(roadmapId);
    if (!roadmap) {
        return { msg: '没有该路线' };
    }
    const sendDoorList = roadmap.sendDoorList;
    const keys = [ 'sendDoorPrice', 'sendDoorMinFee' ];
    const baseKeys = [ 'baseSendDoorPrice', 'baseSendDoorMinFee' ];
    const timeKeys = [ 'updateSendDoorPriceTime', 'updateSendDoorMinFeeTime' ];
    const now = Date.now();

    if (mode === 0) {
        _.forEach(lastCodeList, o => {
            const item = _.find(sendDoorList, m => m.sendDoorEndPointLastCode === o);
            item && _.forEach(typeList, k => { item[keys[k]] += value; item[timeKeys[k]] = now; });
        });
        await roadmap.save();
    } else if (mode === 1) {
        _.forEach(lastCodeList, o => {
            const item = _.find(sendDoorList, m => m.sendDoorEndPointLastCode === o);
            item && _.forEach(typeList, k => { item[keys[k]] *= (value / 100 + 1); item[timeKeys[k]] = now; });
        });
        await roadmap.save();
    } else {
        let successCount = 0;
        const relateRoadmapList = await RoadmapModel.find({ shopId: roadmap.shopId, endPointLastCode: roadmap.endPointLastCode });
        for (const i in lastCodeList) {
            const item = _.find(sendDoorList, m => m.sendDoorEndPointLastCode === lastCodeList[i]);
            if (!item) {
                continue;
            }
            let updateCount = 0;
            for (const j in typeList) {
                const key = keys[typeList[j]];
                const baseKey = baseKeys[typeList[j]];
                const timeKey = timeKeys[typeList[j]];
                if (item[baseKey]) { // 只有设置了底价的才能安装名次排名
                    const _sendDoorListList = _.sortBy(
                        _.map(relateRoadmapList, o => {
                            const node = _.find(o.sendDoorList, m => lastCodeList[i] === m.sendDoorEndPointLastCode);
                            const _node = _.cloneDeep(node);
                            _node.roadmapId = o.id;
                            return _node;
                        }),
                        n => n[key]
                    );
                    const relateNode = _sendDoorListList[value - 1];
                    const newPrice = relateNode[key] - 0.01; // 注意： 这里每次加分减少1分钱
                    if (relateNode && _T(relateNode.roadmapId) !== roadmapId && newPrice > item[baseKey]) {
                        updateCount++;
                        item[key] = newPrice;
                        item[timeKey] = now;
                    }
                }
            }
            if (updateCount) {
                successCount++;
            }
        }
        await roadmap.save();
        if (successCount === 0) {
            return { msg: '设置失败，可能是没有设置底价、或者价格已经超过底价、或者已经是第' + value + '名' };
        }
        if (successCount !== lastCodeList.length) {
            return { msg: '部分设置失败，可能是没有设置底价、或者价格已经超过底价、或者已经是第' + value + '名' };
        }
    }

    actionLog(userId, 'Client', roadmapId, 'Roadmap', 'setRoadmapSendDoorPrice');

    return { success: true, context: { sendDoorList: _.filter(roadmap.toObject().sendDoorList, o => _.includes(lastCodeList, o.sendDoorEndPointLastCode)) } };
};

```

* PDShopServer/project/App/routers/posts/shipper/statistics/getStatistics.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import CONSTANTS from '../../../../constants';
import { hasAuthority } from '../../../../utils';
import mongoose from 'mongoose';
import moment from 'moment';
import _ from 'lodash';
const MAX_DAYS = 30;

export default async ({ userId, days = 7 }) => {
    const client = await ClientModel.findById(userId);
    if (!client) {
        return { msg: '你没有查看统计的权限' };
    }
    if (!client.shipperId || !hasAuthority(client, CONSTANTS.AH_LOOK_STATISTICS)) {
        return { msg: '你没有查看统计的权限' };
    }

    days = (days > MAX_DAYS ? MAX_DAYS : days < 1 ? 1 : days) + 1;
    const now = moment().startOf('d').add(1, 'd');
    const timeList = _.map(_.rangeRight(-days), o => now.clone().add(o, 'd'));
    const getCond = (name, value) => _.dropRight(_.map(timeList, (o, k) => timeList[k + 1] && { [name + k]: { $sum: { $cond: { if: { $and: [{ $gte: ['$placeOrderTime', o.toDate()] }, { $lt: ['$placeOrderTime', timeList[k + 1].toDate()] }] }, then: value, else: 0 } } } }));

    const cond = [
        ...getCond('count', 1),
        ...getCond('isReachPay', '$isReachPay'),
        ...getCond('fee', '$fee'),
        ...getCond('totalDesignatedFee', '$totalDesignatedFee'),
        ...getCond('proxyCharge', '$proxyCharge'),
        ...getCond('weight', '$weight'),
        ...getCond('size', '$size'),
    ];

    const daysInfo = await OrderModel.aggregate()
    .match({ shipperId: new mongoose.Types.ObjectId(client.shipperId), placeOrderTime: { $gt: timeList[0].toDate() }, 'stateList.0.state': { $gte: CONSTANTS.OS_READY_STOCK } })
    .project({ placeOrderTime: 1, isReachPay: { $cond: { if: '$isReachPay', then: 1, else: 0 } }, fee: 1, totalDesignatedFee: 1, proxyCharge: 1, weight: 1, size: 1 })
    .group({
        _id: null,
        ..._.reduce(cond, (r, o) => Object.assign(r, o)),
    });

    daysInfo[0] && (delete daysInfo[0]._id);
    const context = _.transform(daysInfo[0], (r, v, k) => {
        const key = k.replace(/\d+/, '');
        r[key] || (r[key] = []);
        r[key].push(v);
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/member/getMemberByPhone.js

```js
import { ClientModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    memberPhone,
}) => {
    const member = await ClientModel.findById(userId);
    const client = await ClientModel.findOne({ phone: memberPhone });
    if (!client || !client.registerTime) {
        return { msg: '没有该用户' };
    }
    if (client.agentId) {
        return { msg: '该用户已经是收货点的成员' };
    }
    if (client.shipperId) {
        if (_T(member.shipperId) === _T(client.shipperId)) {
            return { msg: '该用户已经是物流公司成员，无需再添加' };
        } else if (_T(client.shipperId) !== _T(member.shipperId)) {
            return { msg: '该用户已经是其他物流公司的成员' };
        }
    }

    const clientAccount = await AccountModel.findOne({ where: { targetId: client.id, type: CONSTANTS.AT_CLIENT } });
    if (clientAccount && clientAccount.amount > 0) {
        return { msg: '请通知该用户先将其账户中的余额提现后再加入物流公司' };
    }

    return { success: true, context: client };
};

```

* PDShopServer/project/App/routers/posts/shipper/member/getMemberDetail.js

```js
import { ClientModel } from '../../../../models';

export default async ({
    userId,
    memberId,
}) => {
    const member = await ClientModel.findById(memberId);
    return { success: true, context: member };
};

```

* PDShopServer/project/App/routers/posts/shipper/member/getMemberList.js

```js
import { ClientModel } from '../../../../models';

export default async ({
    userId,
}) => {
    const member = await ClientModel.findById(userId);
    if (!member || !member.shipperId) {
        return { msg: '你不是物流公司成员' };
    }
    const docs = await ClientModel.find({ shipperId: member.shipperId }).sort({ registerTime: 'asc' });

    return { success: true, context: { memberList: docs } };
};

```

* PDShopServer/project/App/routers/posts/shipper/member/modifyMemberAuthority.js

```js
import { ClientModel, CityTruckModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T, omitNil, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    memberId,
    authority,
}) => {
    if (authority) {
        authority = _.sortBy(_.uniq(authority));
    }
    const member = await ClientModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_SHIPPER_MEMBER_AUTHORITY)) {
        return { msg: '你没有修改成员的权限' };
    }
    const client = await ClientModel.findById(memberId);
    if (!client || !client.registerTime) {
        return { msg: '没有该用户' };
    }
    if (client.agentId) {
        return { msg: '该用户是收货点的成员，你不能修改他的权限' };
    }
    if (client.shipperId && _T(client.shipperId) !== _T(member.shipperId)) {
        return { msg: '该用户是其他物流公司的成员，你不能修改他的权限' };
    }
    const clientAccount = await AccountModel.findOne({ where: { targetId: memberId, type: CONSTANTS.AT_CLIENT } });
    if (clientAccount && clientAccount.amount > 0) {
        return { msg: '请通知该用户先将其账户中的余额提现后再加入物流公司' };
    }

    // 删除权限
    if (!authority || !authority.length) {
        // 如果该成员拥有同城配送的权限，则需要删除将该成员对应的货车设置为 disable
        if (_.includes(client.authority, CONSTANTS.AH_CITY_DISTRIBUTE)) {
            await CityTruckModel.findByIdAndUpdate(client.truckId, { enable: false });
        }
        await client.update({ $unset: { shipperId: 1 }, authority: [] });
    } else {
        // 如果为该成员添加同城配送的权限，需要添加相应的车辆
        let truckId;
        if (_.includes(authority, CONSTANTS.AH_CITY_DISTRIBUTE) && !_.includes(client.authority, CONSTANTS.AH_CITY_DISTRIBUTE)) {
            if (client.truckId) {
                await CityTruckModel.findByIdAndUpdate(client.truckId, { enable: true });
            } else {
                const truck = new CityTruckModel({
                    shipperId: member.shipperId,
                    driverId: memberId,
                });
                await truck.save();
                truckId = truck.id;
            }
        }
        await client.update(omitNil({ authority, shipperId: member.shipperId, truckId }));
    }

    actionLog(userId, 'Client', memberId, 'Client', 'modifyMemberAuthority');
    const context = client.toObject();
    context.authority = authority || [];
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/createTruck.js

```js
import { TruckModel, ClientModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    shopId,
    plateNo, // 车牌号码
    drivingLicense, // 行驶证编号
    truckType, // 货车类型（包括车长）
    insuanceMount, // 保险
    driverId, //司机信息
}) => {
    const client = await ClientModel.findById(userId);
    if (!hasAuthority(client, CONSTANTS.AH_CREATE_TRUCK)) {
        return { msg: '你没有创建货车的权限' };
    }
    const truckList = await TruckModel.find({ driverId, state: CONSTANTS.TS_RECEIVE_SUCCESS });
    if (!truckList) {
        return { msg: '司机当前不可用' };
    }
    const doc = new TruckModel({
        shipperId: client.shipperId,
        shopId,
        plateNo,
        drivingLicense,
        truckType,
        insuanceMount,
        driverId,
    });
    await doc.save();

    const context = await TruckModel.findById(doc.id)
    .select({
        plateNo: 1,
        drivingLicense: 1,
        truckType: 1,
        driverId: 1,
        locationList: 1,
        insuanceMount: 1,
        state: 1,
    })
    .populate({
        path: 'driverId',
        select: { name: 1, phone: 1 },
    });

    actionLog(userId, 'Client', doc.id, 'Truck', 'createTruck');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/getDriverInfoByPhone.js

```js
import { DriverModel, TruckModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({ userId, phone }) => {
    const doc = await DriverModel.findOne({ phone });
    if (!doc) {
        return { msg: '没有对应的司机' };
    }
    const truckList = await TruckModel.find({ driverId: doc.id, state: CONSTANTS.TS_RECEIVE_SUCCESS });
    if (!truckList) {
        return { msg: '司机当前不可用' };
    }
    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/getHistoryTruckList.js

```js
import { TruckModel, ClientModel } from '../../../../models';
import { getKeywordCriteriaForTruck } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, shopId, keyword, fromPC, pageNo, pageSize }) => {
    const client = await ClientModel.findById(userId);
    const criteria = getKeywordCriteriaForTruck(keyword, { shipperId: client.shipperId, shopId, state: CONSTANTS.TS_RECEIVE_SUCCESS });
    const count = (fromPC && pageNo === 0) ? await TruckModel.count(criteria) : undefined;
    const query = TruckModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        plateNo: 1,
        drivingLicense: 1,
        truckType: 1,
        driverId: 1,
        locationList: 1,
        insuanceMount: 1,
        createTime: 1,
    })
    .populate({
        path: 'driverId',
        select: { name: 1, phone: 1, licenseNo: 1 },
    });

    return { success: true, context: {
        count,
        truckList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/getOrderListInTruck.js

```js
import { TruckModel } from '../../../../models';

export default async ({ userId, truckId }) => {
    const truck = await TruckModel.findById(truckId)
    .populate({
        path: 'orderList',
        select: {
            photo: 1,
            shopId: 1,
            agentId: 1,
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            name: 1,
            receiverId: 1,
            roadmapId: 1,
            realFee: 1,
            createTime: 1,
            placeOrderTime: 1,
            weight: 1,
            size: 1,
            stateList: 1,
            totalNumbers: 1,
            startPoint: 1,
            endPoint: 1,
            proxyCharge: 1,
            needPayInsuanceFee: 1,
            payMode: 1,
            isSendDoor: 1,
            isReachPay: 1,
            totalDesignatedFee: 1,
            isInsuance: 1,
        },
        populate: [{
            path: 'shopId',
            select: { name: 1, address: 1 },
        }, {
            path: 'agentId',
            select: { name: 1, address: 1 },
        }],
    });

    return { success: true, context: {
        orderList: (truck || {}).orderList || [],
    } };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/getTruckDetail.js

```js
import { TruckModel } from '../../../../models';
import _ from 'lodash';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    truckId,
}) => {
    const doc = await TruckModel.findById(truckId)
    .populate({
        path: 'driverId',
        select: { name: 1, phone: 1 },
    })
    .populate({
        path: 'scannerId',
        select: { name: 1, phone: 1 },
    })
    .populate({
        path: 'carryPartmentId',
        select: { name: 1, phoneList: 1 },
    })
    .populate({
        path: 'unloadAllOrderList',
        select: {
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            endPoint: 1,
            stateList: 1,
            totalNumbers: 1,
        },
    });
    if (!doc) {
        return { msg: '没有该货车' };
    }

    const context = doc.toObject();
    _.forEach(context.unloadAllOrderList, item => {
        item.unloadNumber = (_.find(item.stateList, o => o.state === CONSTANTS.OS_READY_LOAD) || {}).count || 0;
        delete item.stateList;
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/getTruckType.js

```js
export default async ({ userId }) => {
    const context = [
        { name: '车长', list: [ '3.5米', '4米', '4.5米', '5米', '5.5米', '6米', '6.5米', '7米' ] },
        { name: '车型', list: [ '不限', '高栏', '平板', '箱式', '高低板', '保温' ] },
    ];

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/getTrucks.js

```js
import _ from 'lodash';
import { TruckModel, ClientModel } from '../../../../models';
import { getKeywordCriteriaForTruck } from '../../../../utils';
import CONSTANTS from '../../../../constants';

async function getPageData (shipperId, shopId, type, keyword, fromPC, pageNo, pageSize) {
    let criteria = getKeywordCriteriaForTruck(keyword, { shipperId, shopId });
    if (type === 'onway') {
        criteria = { ...criteria, state: CONSTANTS.TS_ON_THE_WAY };
    } else if (type === 'complete') {
        criteria = { ...criteria, state: CONSTANTS.TS_RECEIVE_SUCCESS };
    }
    const count = (fromPC && pageNo === 0) ? await TruckModel.count() : undefined;
    const query = TruckModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        plateNo: 1,
        drivingLicense: 1,
        truckType: 1,
        driverId: 1,
        locationList: 1,
        insuanceMount: 1,
    })
    .populate({
        path: 'driverId',
        select: { name: 1, phone: 1, licenseNo: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['运输中', '已完成']
const TYPES = ['onway', 'complete'];
export default async ({ userId, shopId, type, keyword, fromPC, pageNo, pageSize }) => {
    const client = await ClientModel.findById(userId);
    if (!client || !client.shipperId) {
        return { msg: '权限不足' };
    }
    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(client.shipperId, shopId, type, keyword, fromPC, pageNo, pageSize),
            },
        };
    } else {
        return {
            success: true,
            context: {
                onway: await getPageData(client.shipperId, shopId, 'onway', keyword, fromPC, pageNo, pageSize),
                complete: await getPageData(client.shipperId, shopId, 'complete', keyword, fromPC, pageNo, pageSize),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/getUnfinishTruck.js

```js
import { OrderModel, ClientModel, TruckModel } from '../../../../models';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({ userId, shopId }) => {
    const client = await ClientModel.findById(userId);
    const truck = await TruckModel.findOne({
        shopId,
        shipperId: client.shipperId,
        scannerId: userId,
        state: { $in: [ CONSTANTS.TS_SCAN_LOADING, CONSTANTS.TS_READY_PAY_FOR_CARRY_PARTMENT ] },
    })
    .populate({
        path: 'unloadAllOrderList',
        select: {
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            endPoint: 1,
            stateList: 1,
            totalNumbers: 1,
        },
    });
    if (!truck) {
        return { success: false };
    }
    const context = truck.toObject();
    _.forEach(context.unloadAllOrderList, item => {
        item.unloadNumber = (_.find(item.stateList, o => o.state === CONSTANTS.OS_READY_LOAD) || {}).count || 0;
        delete item.stateList;
    });
    context.latestOrder = await OrderModel.findById(context.orderList[0])
    .select({
        createTime: 1,
        photo: 1,
        endPoint: 1,
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        totalNumbers: 1,
        size: 1,
        weight: 1,
    });
    delete context.orderList;

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/getWorkTruckList.js

```js
import { TruckModel, ClientModel, OrderModel } from '../../../../models';
import { getKeywordCriteriaForTruck } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

// 该接口如果返回 truck, 根据truck的状态显示不同的界面，否则显示列表
export default async ({ userId, shopId, keyword, fromPC, pageNo, pageSize }) => {
    const client = await ClientModel.findById(userId);
    if (!fromPC) {
        const truck = await TruckModel.findOne({
            shopId,
            shipperId: client.shipperId,
            scannerId: userId,
            state: { $in: [ CONSTANTS.TS_SCAN_LOADING, CONSTANTS.TS_READY_PAY_FOR_CARRY_PARTMENT ] },
        })
        .populate({
            path: 'unloadAllOrderList',
            select: {
                endPoint: 1,
                senderPhone: 1,
                senderName: 1,
                receiverPhone: 1,
                receiverName: 1,
                stateList: 1,
                totalNumbers: 1,
            },
        });
        if (truck) {
            const context = truck.toObject();
            _.forEach(context.unloadAllOrderList, item => {
                item.unloadNumber = (_.find(item.stateList, o => o.state === CONSTANTS.OS_READY_LOAD) || {}).count || 0;
                delete item.stateList;
            });
            context.latestOrder = await OrderModel.findById(context.orderList[0])
            .select({
                createTime: 1,
                photo: 1,
                endPoint: 1,
                senderPhone: 1,
                senderName: 1,
                receiverPhone: 1,
                receiverName: 1,
                totalNumbers: 1,
                size: 1,
                weight: 1,
            });
            delete context.orderList;
            return { success: true, context };
        }
    }
    const criteria = getKeywordCriteriaForTruck(keyword, { shipperId: client.shipperId, shopId, state: { $lte: CONSTANTS.TS_READY_EXIT_WAREHOUSE } });
    const count = (fromPC && pageNo === 0) ? await TruckModel.count(criteria) : undefined;
    const query = TruckModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        plateNo: 1,
        drivingLicense: 1,
        truckType: 1,
        driverId: 1,
        locationList: 1,
        insuanceMount: 1,
        state: 1,
    })
    .populate({
        path: 'driverId',
        select: { name: 1, phone: 1 },
    });

    return { success: true, context: {
        count,
        truckList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/modifyTruck.js

```js
import { TruckModel } from '../../../../models';
import { omitNil, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    truckId,
    plateNo, // 车牌号码
    drivingLicense, // 行驶证编号
    truckType, // 货车类型（包括车长）
    insuanceMount, // 保险
    driverId, //司机信息
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_TRUCK, true)) {
        return { msg: '你没有修改货车的权限' };
    }
    const doc = await TruckModel.findByIdAndUpdate(truckId, omitNil({
        plateNo,
        drivingLicense,
        truckType,
        insuanceMount,
        driverId,
    }), { new: true })
    .select({
        plateNo: 1,
        drivingLicense: 1,
        truckType: 1,
        driverId: 1,
        locationList: 1,
        insuanceMount: 1,
        state: 1,
    })
    .populate({
        path: 'driverId',
        select: { name: 1, phone: 1 },
    });
    if (!doc) {
        return { msg: '修改失败' };
    }

    actionLog(userId, 'Client', truckId, 'Truck', 'modifyTruck');

    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shipper/truck/removeTruck.js

```js
import { TruckModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    truckId,
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_REMOVE_TRUCK, true)) {
        return { msg: '你没有删除货车的权限' };
    }
    await TruckModel.findByIdAndRemove(truckId);
    actionLog(userId, 'Client', truckId, 'Truck', 'removeTruck');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/account/getBillList.js

```js
import { ShopMemberModel } from '../../../../models';
import { AccountModel, BillModel } from '../../../../mysql';
import { _T, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    pageNo,
    pageSize,
}) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1 },
    });
    if (!hasAuthority(member, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        return { msg: '你没有查看账单的权限' };
    }

    let accountId = CONSTANTS.AC_MASTER_ACCOUNT;
    if (member.partmentId) {
        accountId = (await AccountModel.findOne({ where: { targetId: _T(member.partmentId), type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT } }) || {}).id;
    } else if (!member.shop.isMasterShop) {
        accountId = (await AccountModel.findOne({ where: { targetId: _T(member.shop.id), type: CONSTANTS.AT_BRANCH_SHOP } }) || {}).id;
    }
    if (!accountId) {
        return { msg: '没有该账户' };
    }
    const docs = await BillModel.findAndCountAll({
        order: [['tradeTime', 'DESC']],
        where: { account: accountId },
        offset: pageNo * pageSize,
        limit: pageSize,
        attributes: [
            'tradeAmount',
            'thirdpartyAccount',
            'orderId',
            'remark',
            'tradeTime',
        ],
    });
    return { success: true, context: { count: docs.count, billList: docs.rows } };
};

```

* PDShopServer/project/App/routers/posts/shop/account/getBills.js

```js
import _ from 'lodash';
import { ShopMemberModel } from '../../../../models';
import { AccountModel, BillModel } from '../../../../mysql';
import { _T, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getPageData (accountId, type, params) {
    let { startDate, endDate, fromPC, pageNo, pageSize } = params;
    let options = (type === 'recharge' || type === 'withdraw') ? { thirdpartyAccount: { $ne: null } } : { thirdpartyAccount: { $eq: null } };
    let options1 = (type === 'recharge' || type === 'income') ? { tradeAmount: { $gt: 0 } } : { tradeAmount: { $lt: 0 } };

    let criteria = {};
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ tradeTime: { $gte: moment(startDate).toDate() } }, { tradeTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ tradeTime: { $gte: moment(startDate).toDate() } }, { tradeTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }

    const docs = await BillModel.findAndCountAll({
        order: [['tradeTime', 'DESC']],
        where: { account: accountId, ...options, ...options1, ...criteria },
        offset: pageNo * pageSize,
        limit: pageSize,
        attributes: [
            'tradeAmount',
            'thirdpartyAccount',
            'orderId',
            'truckId',
            'remark',
            'tradeTime',
        ],
    });

    return {
        count: docs.count,
        list: docs.rows,
    };
};

// ['充值账单', '提现账单', '收入账单', '支出账单']
const TYPES = ['recharge', 'withdraw', 'income', 'pay'];
export default async ({ userId, type, ...params }) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1 },
    });
    if (!hasAuthority(member, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        return { msg: '你没有查看账单的权限' };
    }

    let accountId = CONSTANTS.AC_MASTER_ACCOUNT;
    if (member.partmentId) {
        accountId = (await AccountModel.findOne({ where: { targetId: _T(member.partmentId), type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT } }) || {}).id;
    } else if (!member.shop.isMasterShop) {
        accountId = (await AccountModel.findOne({ where: { targetId: _T(member.shop.id), type: CONSTANTS.AT_BRANCH_SHOP } }) || {}).id;
    }
    if (!accountId) {
        return { msg: '没有该账户' };
    }

    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(accountId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                recharge: await getPageData(accountId, 'recharge', params),
                withdraw: await getPageData(accountId, 'withdraw', params),
                income: await getPageData(accountId, 'income', params),
                pay: await getPageData(accountId, 'pay', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/shop/account/getRemainAmount.js

```js
import { ShopMemberModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T, _Y, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    let amount;
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1 },
    });
    if (!hasAuthority(member, [CONSTANTS.AH_LOOK_AMOUNT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW])) {
        return { msg: '你没有查看余额的权限' };
    }
    if (member.shop.isMasterShop) {
        const masterAccount = await AccountModel.findOne({ where: { id: CONSTANTS.AC_MASTER_ACCOUNT } });
        if (!masterAccount) {
            return { msg: '没有该账户' };
        }
        amount = _Y(masterAccount.amount);
    } else if (member.partmentId) {
        const partmentAccount = await AccountModel.findOne({ where: { targetId: _T(member.partmentId), type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT } });
        if (!partmentAccount) {
            return { msg: '没有该账户' };
        }
        amount = _Y(partmentAccount.amount);
    } else {
        const branchAccount = await AccountModel.findOne({ where: { targetId: _T(member.shop.id), type: CONSTANTS.AT_BRANCH_SHOP } });
        if (!branchAccount) {
            return { msg: '没有该账户' };
        }
        amount = _Y(branchAccount.amount);
    }
    if (amount === undefined) {
        return { msg: '你没有查看余额的权限' };
    }

    return { success: true, context: { amount } };
};

```

* PDShopServer/project/App/routers/posts/shop/account/recharge.js

```js
import { _F, actionLog } from '../../../../utils/';
import { rechargeForShopMember } from '../../libs/account';

export default ({
    userId,
    amount,
}) => {
    amount = _F(amount);
    const result = rechargeForShopMember({ userId, amount, thirdpartyAccount: 'SIMULATION_NO' });
    result.success && actionLog(userId, 'ShopMember', amount, 'Number', 'recharge');

    return result;
};

```

* PDShopServer/project/App/routers/posts/shop/account/setPaymentPassword.js

```js
import { PaymentModel, ShopMemberModel } from '../../../../models';
import { registerUser, setPassword, checkVerifyCode, actionLog } from '../../../../utils';

export default async ({ userId, phone, password, verifyCode }) => {
    const success = await checkVerifyCode(phone, verifyCode);
    if (!success) {
        return { msg: '无效验证码' };
    }
    const member = await ShopMemberModel.findById(userId);
    if (!member || member.phone !== phone) {
        return { msg: '获取验证码的手机号码必须为登录的手机号码' };
    }

    let payment = await PaymentModel.findOne({ userId });
    if (!payment) {
        payment = new PaymentModel({ userId });
        const error = await registerUser(PaymentModel, payment, password);
        if (error) {
            return { msg: '设置密码失败' };
        }
        member.isSetPaymentPassword = 1;
        await member.save();
        actionLog(userId, 'ShopMember', userId, 'ShopMember', 'setPaymentPassword');
        return { success: true };
    }

    const error = await setPassword(payment, password);
    if (error) {
        return { msg: '设置密码失败' };
    }
    await payment.save();

    actionLog(userId, 'ShopMember', userId, 'ShopMember', 'setPaymentPassword');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/account/withdraw.js

```js
import { _F, authenticatePaymentPassword, actionLog } from '../../../../utils/';
import { withdrawForShopMember } from '../../libs/account';

export default async ({
    userId,
    amount,
    payPassword,
}) => {
    const error = await authenticatePaymentPassword(userId, payPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    amount = _F(amount);
    const result = withdrawForShopMember({ userId, amount, thirdpartyAccount: 'SIMULATION_NO' });
    result.success && actionLog(userId, 'ShopMember', amount, 'Number', 'withdraw');

    return result;
};

```

* PDShopServer/project/App/routers/posts/shop/client/getClientDetail.js

```js
import { ClientModel } from '../../../../models';

export default async ({ userId, clientId }) => {
    const context = await ClientModel.findById(clientId);
    if (!context) {
        return { msg: '没有该线路' };
    }

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/client/getClientList.js

```js
import { ClientModel } from '../../../../models';
import { getKeywordCriteriaForUser } from '../../../../utils';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    const criteria = getKeywordCriteriaForUser(keyword);
    const count = (fromPC && pageNo === 0) ? await ClientModel.count(criteria) : undefined;
    const query = ClientModel.find(criteria).sort({ modifyTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        phone: 1,
        name: 1,
        email: 1,
        head: 1,
        address: 1,
        phoneList: 1,
    });

    return { success: true, context: {
        count,
        clientList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/branchShop/createAndRegisterShipper.js

```js
import { ShipperModel, ClientModel, ShopMemberModel, ShipperInBranchShopModel, MediaModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _Y, _T, getMediaId, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    shipperType = 0, // 0：长途物流公司 1：同城配送物流公司（默认为0）
    chairManId, // 物流公司董事长 Id
    name, // 物流公司名称
    image, // 物流公司背景图片
    sign, // 物流公司签名
    phoneList, // 物流公司联系电话
    address, // 商铺地址
    capital, // 注册资金
    legalName, // 法人姓名
    legalPhone, // 法人电话
    legalIDCard, // 法人身份证
    bondCompanyList, //担保公司列表
}) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_CREATE_SHIPPER)) {
        return { msg: '你没有注册物流超市的权限' };
    }

    let chairMan = await ClientModel.findById(chairManId);
    if (!chairMan) {
        return { msg: '必须先注册董事长账号' };
    }
    if (chairMan.shipperId) {
        return { msg: '该董事长账号只能注册一家物流公司' };
    }
    if (chairMan.agentId) {
        return { msg: '该董事长账号已经注册了一家收货点，不能再注册物流公司' };
    }
    // 创建物流公司
    let _image = getMediaId(image);
    let _legalIDCard = _.map(legalIDCard, item => getMediaId(item));
    const _bondCompanyList = _.map(bondCompanyList, item => {
        item.certificate = _.map(item.certificate, o => getMediaId(o));
        item.legalIDCard = _.map(item.legalIDCard, o => getMediaId(o));
        return item;
    });
    const totalBondAmount = _.sumBy(_bondCompanyList, o => o.bondAmount);

    const clientAccount = await AccountModel.findOne({ where: { targetId: _T(chairMan.id), type: CONSTANTS.AT_CLIENT } });
    const acountAmount = _Y(clientAccount ? clientAccount.amount : 0);

    const shipper = new ShipperModel({
        shipperType,
        chairManId: chairMan.id,
        name,
        image: _image,
        sign,
        phoneList,
        address,
        capital,
        legalName,
        legalPhone,
        legalIDCard: _legalIDCard,
        acountAmount,
    });
    const commonAuthority = [
        CONSTANTS.AH_MODIFY_SHIPPER_INFO, // 修改物流公司信息的权限
        CONSTANTS.AH_MODIFY_SHIPPER_MEMBER_AUTHORITY, // 修改物流公司成员权限的权限

        // 充值，提现，余额
        CONSTANTS.AH_RECHARGE, // 充值的权限
        CONSTANTS.AH_WITHDRAW, // 提现的权限
        CONSTANTS.AH_LOOK_AMOUNT, // 查看余额的权限
        // 统计
        CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
        CONSTANTS.AH_LOOK_ORDERS, // 查看综合货单的权限
    ];

    // 赋予物流公司董事长权限
    if (shipperType === CONSTANTS.ST_LONG) {
        chairMan.authority = [
            ...commonAuthority,
            // 路线
            CONSTANTS.AH_CREATE_ROADMAP, // 创建路线的权限
            CONSTANTS.AH_MODIFY_ROADMAP, // 修改路线的权限
            CONSTANTS.AH_REMOVE_ROADMAP, // 删除路线的权限
            CONSTANTS.AH_LOOK_ROADMAP, // 查看路线的权限
            // 货车
            CONSTANTS.AH_CREATE_TRUCK, // 创建货车的权限
            CONSTANTS.AH_MODIFY_TRUCK, // 修改货车的权限
            CONSTANTS.AH_REMOVE_TRUCK, // 删除货车的权限
            CONSTANTS.AH_LOOK_TRUCK, // 查看货车的权限
            // 装车
            CONSTANTS.SELECT_CARRY_PARTMENT, // 选择搬运队的权限
            CONSTANTS.AH_SCAN_LOAD_TRUCK, // 扫描装车的权限
        ];
    } else {
        chairMan.authority = [
            ...commonAuthority,
            // 同城配送路线
            CONSTANTS.AH_CREATE_SEND_DOOR_ROADMAP, // 创建同城配送路线的权限
            CONSTANTS.AH_MODIFY_SEND_DOOR_ROADMAP, // 修改同城配送路线的权限
            CONSTANTS.AH_REMOVE_SEND_DOOR_ROADMAP, // 删除同城配送路线的权限
            CONSTANTS.AH_LOOK_SEND_DOOR_ROADMAP, // 查看同城配送路线的权限
            // 同城配送
            CONSTANTS.AH_CITY_DISTRIBUTE, // 同城配送的权限
        ];
    }

    chairMan.post = CONSTANTS.PO_CHAIR_MAN;
    chairMan.shipperId = shipper.id;
    // 保存
    await chairMan.save();
    await shipper.save();

    const inShop = new ShipperInBranchShopModel({
        shopId: member.shop.id,
        shipperId: shipper.id,
        totalBondAmount,
        remainBondAmount: totalBondAmount,
        bondCompanyList: _bondCompanyList,
    });
    await inShop.save();

    MediaModel._updateRef(
        { [_image]: 1 },
        ..._legalIDCard.map(item => ({ [item]: 1 })),
        ..._.flatten(_bondCompanyList.map(item => {
            const list = [...item.certificate, ...item.legalIDCard];
            return list.map(o => ({ [o]: 1 }));
        })),
    );

    actionLog(userId, 'ShopMember', shipper.id, 'Shipper', 'createAndRegisterShipper');

    return { success: true, context: {
        id: shipper.id,
        shipperType,
        shopId: member.shop.id,
        shopName: member.shop.name,
        name,
        chairMan: { name: chairMan.name, phone: chairMan.phone },
        chairManId,
        acountAmount,
        capital,
        totalBondAmount,
        remainBondAmount: totalBondAmount,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/branchShop/getShipperByChairManPhone.js

```js
import { ShopMemberModel, ShipperInBranchShopModel, ClientModel, ShipperModel } from '../../../../models';
import { _T, hasAuthority } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
export default async ({
    userId,
    chairManPhone,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_CREATE_SHIPPER)) {
        return { msg: '你没有注册物流超市的权限' };
    }
    const chairMan = await ClientModel.findOne({ phone: chairManPhone });
    if (!chairMan) {
        return { msg: '必须先注册董事长账号' };
    }
    if (chairMan.shipperId) {
        const inShop = await ShipperInBranchShopModel.findOne({ shipperId: chairMan.shipperId, shopId: member.shopId });
        const shipper = await ShipperModel.findById(chairMan.shipperId);
        if (_T(shipper.chairManId) === _T(chairMan.id)) {
            if (inShop) {
                return { msg: '该物流公司已经在分店注册' };
            } else {
                const context = shipper.toObject();
                Object.assign(context, { chairMan: { id: chairMan.id, name: chairMan.name, phone: chairManPhone } });
                return { success: true, context };
            }
        } else {
            return { msg: '请使用董事长的账户进行检测' };
        }
    }
    return { success: true, context: { chairMan: { id: chairMan.id, name: chairMan.name, phone: chairManPhone } } };
};

```

* PDShopServer/project/App/routers/posts/shop/branchShop/getToExamineTruckList.js

```js
import { TruckModel, ClientModel, ShopMemberModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({ userId, phone }) => {
    const member = await ShopMemberModel.findById(userId);
    const client = await ClientModel.findOne({ phone });
    if (!client || !client.shipperId) {
        return { msg: '请确认电话号码' };
    }
    const truckList = await TruckModel.find({ shipperId: client.shipperId, shopId: member.shopId, state: CONSTANTS.TS_READY_EXAMINE })
    .sort([['modifyTime', 'desc'], ['createTime', 'desc']])
    .select({
        plateNo: 1,
        drivingLicense: 1,
        truckType: 1,
        driverId: 1,
        locationList: 1,
        insuanceMount: 1,
        state: 1,
    })
    .populate({
        path: 'driverId',
        select: { name: 1, phone: 1 },
    });

    return { success: true, context: {
        truckList,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/branchShop/registerShipper.js

```js
import { ShopMemberModel, ShipperInBranchShopModel, ShipperModel, MediaModel } from '../../../../models';
import { getMediaId, hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    shipperId, // 注册的物流公司
    bondCompanyList, //担保公司列表
}) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_CREATE_SHIPPER)) {
        return { msg: '你没有注册物流超市的权限' };
    }

    let inShop = await ShipperInBranchShopModel.findOne({ shipperId, shopId: member.shop.id });
    if (inShop) {
        return { msg: '该物流公司已经在分店注册' };
    }

    const shipper = await ShipperModel.findById(shipperId)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    if (!shipper) {
        return { msg: '没有该物流公司' };
    }

    const _bondCompanyList = _.map(bondCompanyList, item => {
        item.certificate = _.map(item.certificate, o => getMediaId(o));
        item.legalIDCard = _.map(item.legalIDCard, o => getMediaId(o));
        return item;
    });
    const totalBondAmount = _.sumBy(_bondCompanyList, o => o.bondAmount);
    inShop = new ShipperInBranchShopModel({
        shopId: member.shop.id,
        shipperId,
        totalBondAmount,
        remainBondAmount: totalBondAmount,
        bondCompanyList: _bondCompanyList,
    });
    await inShop.save();

    MediaModel._updateRef(
        ..._.flatten(_bondCompanyList.map(item => {
            const list = [...item.certificate, ...item.legalIDCard];
            return list.map(o => ({ [o]: 1 }));
        })),
    );

    actionLog(userId, 'ShopMember', shipperId, 'Shipper', 'registerShipper');

    return { success: true, context: {
        id: shipperId,
        shopId: member.shop.id,
        shopName: member.shop.name,
        name: shipper.name,
        chairMan: { name: shipper.chairMan.name, phone: shipper.chairMan.phone },
        chairManId: shipper.chairMan.id,
        acountAmount: shipper.acountAmount,
        capital: shipper.capital,
        totalBondAmount,
        remainBondAmount: totalBondAmount,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/agent/checkAgentByChairManPhone.js

```js
import { ClientModel } from '../../../../models';
import { _T } from '../../../../utils/';

export default async ({
    userId,
    chairManPhone, // 收货点董事长 Id
}) => {
    const chairMan = await ClientModel.findOne({ phone: chairManPhone })
    .populate({
        path: 'agentId',
    });
    if (!chairMan) {
        return { msg: '必须先注册董事长账号' };
    }
    if (chairMan.agent && _T(chairMan.agent.chairManId) === _T(chairMan.id)) {
        return { msg: '该号码已经拥有收货点，请使用其他号码' };
    }
    return { success: true, context: { chairMan: { id: chairMan.id, name: chairMan.name, phone: chairManPhone } } };
};

```

* PDShopServer/project/App/routers/posts/shop/agent/createAgent.js

```js
import { AgentModel, ClientModel, MediaModel } from '../../../../models';
import { getMediaId, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    chairManId, // 收货点董事长 Id
    name, // 收货点名称
    image, // 收货点背景图片
    sign, // 收货点签名
    phoneList, // 收货点联系电话
    addressRegion, // 物流超市所在城市
    addressRegionLastCode, // 物流超市所在城市的lastCode
    address, // 商铺地址（包含经纬度）
    location, // 经纬度定位
    legalName, // 法人姓名
    legalPhone, // 法人电话
    legalIDCard, //法人身份证
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_CREATE_AGENT)) {
        return { msg: '你没有创建收货点的权限' };
    }

    let chairMan = await ClientModel.findById(chairManId);
    if (!chairMan) {
        return { msg: '必须先注册董事长账号' };
    }
    if (chairMan.agentId) {
        return { msg: '该董事长账号只能注册一家收货点' };
    }
    if (chairMan.shipperId) {
        return { msg: '该董事长账号已经注册了一家物流公司，不能再注册收货点' };
    }
    // 创建收货点
    let _image = getMediaId(image);
    let _legalIDCard = _.map(legalIDCard, item => getMediaId(item));

    const agent = new AgentModel({
        chairManId: chairMan.id,
        name,
        image: _image,
        sign,
        phoneList,
        addressRegion,
        addressRegionLastCode,
        address,
        location,
        legalName,
        legalPhone,
        legalIDCard: _legalIDCard,
    });
    // 赋予收货点董事长权限
    chairMan.authority = [
        CONSTANTS.AH_MODIFY_AGENT_INFO, // 修改收货点信息的权限
        CONSTANTS.AH_MODIFY_AGENT_MEMBER_AUTHORITY, // 修改收货点成员权限的权限
        CONSTANTS.AH_PLACE_ORDER, // 收货下单的权限
        // 公共权限
        CONSTANTS.AH_MODIFY_ROADMAP_PROFIT, // 修改路线的提成的权限
        CONSTANTS.AH_RECHARGE, // 充值的权限
        CONSTANTS.AH_WITHDRAW, // 提现的权限
        CONSTANTS.AH_LOOK_AMOUNT, // 查看余额的权限
        // 统计
        CONSTANTS.AH_LOOK_ORDERS, // 查看综合货单的权限
        CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
    ];
    chairMan.agentId = agent.id;
    // 保存
    await chairMan.save();
    await agent.save();

    MediaModel._updateRef(
        { [_image]: 1 },
        ..._legalIDCard.map(item => ({ [item]: 1 })),
    );

    const context = await AgentModel.findById(agent.id)
    .select({
        name: 1,
        addressRegion: 1,
        addressRegionLastCode: 1,
        address: 1,
        location: 1,
        phoneList: 1,
        chairManId: 1,
    })
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });

    actionLog(userId, 'ShopMember', agent.id, 'Agent', 'createAgent');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/agent/getAgentDetail.js

```js
import { AgentModel } from '../../../../models';
import { hasAuthority } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, agentId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_LOOK_AGENT)) {
        return { msg: '你没有查看收货点的权限' };
    }

    const agent = await AgentModel.findById(agentId)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    if (!agent) {
        return { msg: '没有该收货点' };
    }
    return { success: true, context: agent };
};

```

* PDShopServer/project/App/routers/posts/shop/agent/getAgentList.js

```js
import { AgentModel } from '../../../../models';
import { getKeywordCriteriaForShipper, hasAuthority } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_LOOK_AGENT)) {
        return { msg: '你没有查看收货点的权限' };
    }

    const criteria = getKeywordCriteriaForShipper(keyword);
    const count = (fromPC && pageNo === 0) ? await AgentModel.count(criteria) : undefined;
    const query = AgentModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        name: 1,
        addressRegion: 1,
        addressRegionLastCode: 1,
        address: 1,
        location: 1,
        phoneList: 1,
        chairManId: 1,
    })
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });

    return { success: true, context: {
        count,
        agentList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/agent/modifyAgent.js

```js
import _ from 'lodash';
import { AgentModel, ShopMemberModel, MediaModel } from '../../../../models';
import { getMediaId, hasAuthority, omitNil, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    agentId,
    name, // 物流公司名称
    image, // 物流公司背景图片
    sign, // 物流公司签名
    phoneList, // 物流公司联系电话
    addressRegion, // 物流超市所在城市
    addressRegionLastCode, // 物流超市所在城市的lastCode
    address, // 商铺地址
    location, // 经纬度定位
    legalName, // 法人姓名
    legalPhone, // 法人电话
    legalIDCard, // 法人身份证
    bondCompanyList, //担保公司列表
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_AGENT)) {
        return { msg: '你没有修改收货点信息的权限' };
    }

    let _image = getMediaId(image);
    let _legalIDCard = _.map(legalIDCard, o => getMediaId(o));

    const agent = await AgentModel.findByIdAndUpdate(agentId, omitNil({
        name,
        image: _image,
        sign,
        phoneList,
        addressRegion,
        addressRegionLastCode,
        address,
        location,
        legalName,
        legalPhone,
        legalIDCard: legalIDCard && _legalIDCard,
    }));

    MediaModel._updateRef(
        { [_image]: 1 },
        { [image && agent.image]: -1 },
        ..._legalIDCard.map(item => ({ [item]: 1 })),
        ...(legalIDCard ? agent.legalIDCard : []).map(item => ({ [item]: -1 })),
    );

    const context = await AgentModel.findById(agentId)
    .select({
        name: 1,
        addressRegion: 1,
        addressRegionLastCode: 1,
        address: 1,
        location: 1,
        phoneList: 1,
        chairManId: 1,
    })
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });

    actionLog(userId, 'ShopMember', agentId, 'Agent', 'modifyAgent');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/agent/removeAgent.js

```js
import { ShopMemberModel, AgentModel, MediaModel } from '../../../../models';
import { hasAuthority, authenticatePassword, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    agentId,
    password,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_REMOVE_AGENT)) {
        return { msg: '你没有删除收货点的权限' };
    }
    const error = await authenticatePassword(member, password);
    if (error) {
        return { msg: '密码错误' };
    }

    const agent = await AgentModel.findByIdAndRemove(agentId);
    if (agent) {
        MediaModel._updateRef(
            { [agent.image]: -1 },
            ...agent.legalIDCard.map(item => ({ [item]: -1 })),
        );
    }

    actionLog(userId, 'ShopMember', agentId, 'Agent', 'removeAgent');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/carryPartment/getCarryList.js

```js
import { ShopMemberModel, TruckModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    pageNo,
    pageSize,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!member || !member.partmentId) {
        return { msg: '没有正在搬运的车辆' };
    }
    const criteria = { carryPartmentId: member.partmentId, state: { $gte: CONSTANTS.TS_READY_EXIT_WAREHOUSE } };
    const count = pageNo === 0 ? await TruckModel.count(criteria) : undefined;
    const query = TruckModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        plateNo: 1,
        drivingLicense: 1,
        orderCount: 1,
        carryPrice: 1,
        totalWeight: 1,
        createTime: 1,
    });
    if (!docs) {
        return { msg: '没有历史搬运信息' };
    }
    return { success: true, context: {
        count,
        truckList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/carryPartment/getCarryPartmentList.js

```js
import { ShopPartmentModel } from '../../../../models';
import { getOwnShop } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    const shopId = await getOwnShop(userId);
    const partmentList = await ShopPartmentModel.find({ shopId, type: CONSTANTS.SP_CARRY_PARTMENT });
    return { success: true, context: { partmentList } };
};

```

* PDShopServer/project/App/routers/posts/shop/carryPartment/getOrderListInTruck.js

```js
import { TruckModel } from '../../../../models';

export default async ({ userId, truckId }) => {
    const truck = await TruckModel.findById(truckId)
    .populate({
        path: 'orderList',
        select: {
            photo: 1,
            shopId: 1,
            agentId: 1,
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            name: 1,
            receiverId: 1,
            realFee: 1,
            createTime: 1,
            placeOrderTime: 1,
            weight: 1,
            size: 1,
            stateList: 1,
            totalNumbers: 1,
            startPoint: 1,
            endPoint: 1,
            proxyCharge: 1,
            needPayInsuanceFee: 1,
            payMode: 1,
            isSendDoor: 1,
            isReachPay: 1,
            totalDesignatedFee: 1,
            isInsuance: 1,
        },
        populate: [{
            path: 'shopId',
            select: { name: 1, address: 1 },
        }, {
            path: 'agentId',
            select: { name: 1, address: 1 },
        }],
    });

    return { success: true, context: {
        orderList: truck.orderList,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/carryPartment/getWaitScanTruckInfo.js

```js
import { ShopMemberModel, TruckModel } from '../../../../models';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!member || !member.partmentId) {
        return { msg: '没有待扫描的车辆' };
    }
    const query = TruckModel.find({ carryPartmentId: member.partmentId, state: CONSTANTS.TS_READY_SCAN_LOAD });
    const doc = await query
    .select({
        plateNo: 1,
        drivingLicense: 1,
        orderCount: 1,
        totalWeight: 1,
        createTime: 1,
    });
    if (!doc || doc.length == 0) {
        return { msg: '没有待扫描信息' };
    }
    return { success: true, context: doc[0] };
};

```

* PDShopServer/project/App/routers/posts/shop/carryPartment/getWorkTruckInfo.js

```js
import { ShopMemberModel, TruckModel } from '../../../../models';

export default async ({
    userId,
}) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'partmentId',
        select: { workTruckId: 1 },
    });
    if (!member || !member.partment || !member.partment.workTruckId) {
        return { msg: '没有正在搬运的车辆' };
    }
    const truck = await TruckModel.findById(member.partment.workTruckId);
    if (!truck) {
        return { msg: '没有正在搬运的车辆' };
    }
    return { success: true, context: truck };
};

```

* PDShopServer/project/App/routers/posts/shop/masterShop/createBranchShop.js

```js
import { ShopMemberModel, ShopModel, MediaModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T, getMediaId, registerUser, hasAuthority, getDefaultPassWord, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { registeredStartPointAddress } from '../../libs/address';

export default async ({
    userId,
    chairManPhone, // 分店董事长登录电话
    chairManName,  // 分店董事长姓名
    chairManPassword, // 分店董事长登录密码（不传入该参数，默认为手机号码后6位）
    name, // 分店名称
    image, // 分店背景图片
    sign, // 分店签名
    phoneList, // 分店联系电话
    addressRegion, // 物流超市所在城市
    addressRegionLastCode, // 物流超市所在城市的lastCode
    address, // 分店地址
    location, // 经纬度定位
    profitRate, // 分层比例
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_CREATE_BRANCH_SHOP)) {
        return { msg: '你没有创建分店的权限' };
    }
    if (await ShopModel.findOne({ name })) {
        return { msg: '该分店名已经被使用' };
    }
    // 注册董事长账号
    const chairMan = new ShopMemberModel({
        phone: chairManPhone,
        name: chairManName,
        post: CONSTANTS.PO_CHAIR_MAN,
        authority: [
            // 物流公司
            CONSTANTS.AH_CREATE_SHIPPER, // 创建物流公司
            CONSTANTS.AH_MODIFY_SHIPPER, // 修改物流公司
            CONSTANTS.AH_REMOVE_SHIPPER, // 删除物流公司
            CONSTANTS.AH_LOOK_SHIPPER, // 查看物流公司
            // 部门
            CONSTANTS.AH_CREATE_PARTMENT, // 创建部门的权限
            CONSTANTS.AH_MODIFY_PARTMENT, // 修改部门信息的权限
            CONSTANTS.AH_REMOVE_PARTMENT, // 删除部门的权限
            CONSTANTS.AH_LOOK_PARTMENT, // 查看部门的权限
            // 路线
            CONSTANTS.AH_LOOK_ROADMAP, // 查看路线的权限
            CONSTANTS.AH_TO_EXAMINE_TRUCK, // 审核货车
            // 公共权限
            CONSTANTS.AH_MODIFY_OWN_SHOP, // 修改自身分店的权限
            // 成员
            CONSTANTS.AH_CREATE_MEMBER, // 创建成员的权限
            CONSTANTS.AH_MODIFY_MEMBER, // 修改成员信息的权限
            CONSTANTS.AH_REMOVE_MEMBER, // 删除成员的权限
            CONSTANTS.AH_LOOK_MEMBER, // 查看成员的权限
            // 仓库
            CONSTANTS.AH_CREATE_WAREHOUSE, // 创建仓库的权限
            CONSTANTS.AH_MODIFY_WAREHOUSE, // 修改仓库信息的权限
            CONSTANTS.AH_REMOVE_WAREHOUSE, // 删除仓库的权限
            CONSTANTS.AH_LOOK_WAREHOUSE, // 查看仓库的权限
            // 提现，余额
            CONSTANTS.AH_WITHDRAW, // 提现的权限
            CONSTANTS.AH_LOOK_AMOUNT, // 查看余额的权限
            // 统计
            CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
            CONSTANTS.AH_LOOK_ORDERS, // 查看综合货单的权限
        ],
    });

    // 创建总部
    let _image = getMediaId(image);
    const shop = new ShopModel({
        chairManId: chairMan.id,
        name,
        image: _image,
        sign,
        phoneList,
        addressRegion,
        addressRegionLastCode,
        address,
        profitRate,
        location,
    });
    chairMan.shopId = shop.id;

    // 保存
    const error = await registerUser(ShopMemberModel, chairMan, getDefaultPassWord(chairManPhone, chairManPassword));
    if (error === 'UserExistsError') {
        return { msg: '分店总经理账号已经被占用' };
    } else if (error) {
        return { msg: '分店总经理账号注册失败' };
    }

    // 创建分店账号
    const account = await AccountModel.create({ targetId: _T(shop.id), type: CONSTANTS.AT_BRANCH_SHOP });
    if (!account) {
        return { msg: '创建分店账号失败' };
    }
    await shop.save();
    await registeredStartPointAddress(addressRegionLastCode); // 将分店的地址进行注册

    actionLog(userId, 'ShopMember', shop.id, 'Shop', 'createBranchShop');
    MediaModel._updateRef(
        { [_image]: 1 },
    );
    const context = await ShopModel.findById(shop.id)
    .select({
        name: 1,
        addressRegion: 1,
        addressRegionLastCode: 1,
        address: 1,
        location: 1,
        profitRate: 1,
        phoneList: 1,
        chairManId: 1,
    })
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/masterShop/getBranchShopDetail.js

```js
import { ShopModel } from '../../../../models';
import { hasAuthority } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, shopId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_LOOK_BRANCH_SHOP)) {
        return { msg: '你没有查看分店的权限' };
    }

    const shop = await ShopModel.findById(shopId)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    if (!shop) {
        return { msg: '没有该物流超市' };
    }
    return { success: true, context: shop };
};

```

* PDShopServer/project/App/routers/posts/shop/masterShop/getBranchShopList.js

```js
import { ShopModel } from '../../../../models';
import { hasAuthority } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_LOOK_BRANCH_SHOP)) {
        return { msg: '你没有查看分店的权限' };
    }

    const query = ShopModel.find({ isMasterShop: false }).sort({ createTime: 'desc' });
    const docs = await query
    .select({
        name: 1,
        addressRegion: 1,
        addressRegionLastCode: 1,
        address: 1,
        location: 1,
        profitRate: 1,
        phoneList: 1,
        chairManId: 1,
    })
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });

    return { success: true, context: {
        branchShopList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/masterShop/getSettingInfo.js

```js
import { SettingModel } from '../../../../models';
import { hasAuthority } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_SETTING)) {
        return { msg: '权限不足' };
    }
    const doc = await SettingModel.findOne();
    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/masterShop/modifyBranchShop.js

```js
import { ShopModel, ShopMemberModel, MediaModel } from '../../../../models';
import { getMediaId, omitNil, hasAuthority, actionLog } from '../../../../utils/';
import { registeredStartPointAddress } from '../../libs/address';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    shopId,
    name, // 物流超市名称
    image, // 物流超市背景图片
    sign, // 物流超市签名
    phoneList, // 物流超市联系电话
    addressRegion, // 物流超市所在城市
    addressRegionLastCode, // 物流超市所在城市的lastCode
    address, // 商铺地址
    location, // 经纬度定位
    profitRate, // 分层比例
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_BRANCH_SHOP)) {
        return { msg: '你没有修改分店的权限' };
    }
    if (name && await ShopModel.findOne({ name, _id: { $ne: shopId } })) {
        return { msg: '该分店名已经被使用' };
    }

    let _image = getMediaId(image);
    const doc = await ShopModel.findByIdAndUpdate(shopId, omitNil({
        name,
        image: _image,
        sign,
        phoneList,
        addressRegion,
        addressRegionLastCode,
        address,
        location,
        profitRate,
    }));
    if (!doc) {
        return { msg: '修改失败' };
    }
    await registeredStartPointAddress(addressRegionLastCode, doc.addressRegionLastCode); // 将分店的地址进行注册

    MediaModel._updateRef(
        { [_image]: 1 },
        { [image && doc.image]: -1 },
    );

    actionLog(userId, 'ShopMember', shopId, 'Shop', 'modifyBranchShop');

    const context = await ShopModel.findById(shopId)
    .select({
        name: 1,
        address: 1,
        addressRegion: 1,
        addressRegionLastCode: 1,
        location: 1,
        profitRate: 1,
        phoneList: 1,
        chairManId: 1,
    })
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/masterShop/modifySettingInfo.js

```js
import { SettingModel } from '../../../../models';
import { settingMgr } from '../../../../manager';
import { hasAuthority, omitNil, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    sizeWeightRate,
    insuanceRate,
    insuanceMountRate,
    insuanceBaseValue,
    proxyChargeProfitRate,
    gradientPriceList,
    additionalDeliverTime,
    noticeShipperStorageWeight,
    bondAmountWeightRate,
    rankedMaskFirstRankWeight,
    rankedMaskRateList,
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_SETTING)) {
        return { msg: '你没有修改配置的权限' };
    }
    const doc = await SettingModel.findOneAndUpdate({}, omitNil({
        sizeWeightRate,
        insuanceRate,
        insuanceMountRate,
        insuanceBaseValue,
        proxyChargeProfitRate,
        gradientPriceList,
        additionalDeliverTime,
        noticeShipperStorageWeight,
        bondAmountWeightRate,
        rankedMaskFirstRankWeight,
        rankedMaskRateList,
    }), { new: true });
    settingMgr.set(doc);

    actionLog(userId, 'ShopMember', JSON.stringify(omitNil({
        sizeWeightRate,
        insuanceRate,
        insuanceMountRate,
        insuanceBaseValue,
        proxyChargeProfitRate,
        gradientPriceList,
        additionalDeliverTime,
        noticeShipperStorageWeight,
        bondAmountWeightRate,
        rankedMaskFirstRankWeight,
        rankedMaskRateList,
    })), 'Data', 'modifySettingInfo');

    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/masterShop/removeBranchShop.js

```js
import { ShopMemberModel, ShopPartmentModel, ShopModel, MediaModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

// 这个接口是硬删除，千万谨慎使用，最好不要对外提供，如果要对外提供，可以提供软删除，添加删除标记，这种软删除是可以恢复的
export default async ({
    userId,
    shopId,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_REMOVE_BRANCH_SHOP)) {
        return { msg: '权限不足' };
    }

    const doc = await ShopModel.findByIdAndRemove(shopId);
    if (doc) {
        await ShopPartmentModel.remove({ shopId }); // 删除和分店的所有部门
        await ShopMemberModel.remove({ shopId }); // 删除和分店的所有人
        // todo 删除和其他所有和分店相关的东西
        MediaModel._updateRef(
            { [doc.image]: -1 },
        );
    }

    actionLog(userId, 'ShopMember', shopId, 'Shop', 'removeBranchShop');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/member/createMember.js

```js
import { ShopMemberModel, ShopPartmentModel } from '../../../../models';
import { registerUser, hasAuthority, actionLog, getDefaultPassWord } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId,
    name,
    post,
    phone,
    password,
    authority,
}) => {
    if (authority) {
        authority = _.sortBy(_.uniq(authority));
    }
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_CREATE_MEMBER)) {
        return { msg: '你没有创建成员的权限' };
    }
    const doc = new ShopMemberModel({
        shopId: member.shopId,
        partmentId: member.partmentId,
        name,
        post,
        phone,
        authority,
    });
    const error = await registerUser(ShopMemberModel, doc, getDefaultPassWord(phone, password));
    if (error === 'UserExistsError') {
        return { msg: '该电话号码已经被人使用' };
    } else if (error) {
        return { msg: '创建失败' };
    }
    await ShopPartmentModel.findByIdAndUpdate(member.partmentId, { $inc: { memberCount: 1 } });

    let context = await ShopMemberModel.findById(doc.id)
    .select({
        phone: 1,
        email: 1,
        name: 1,
        head: 1,
        post: 1,
        authority: 1,
        phoneList: 1,
    });

    actionLog(userId, 'ShopMember', doc.id, 'ShopMember', 'createMember');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/member/getMemberDetail.js

```js
import { ShopMemberModel } from '../../../../models';

export default async ({
    userId,
    memberId,
}) => {
    const doc = await ShopMemberModel.findById(memberId);
    if (!doc) {
        return { msg: '没有该成员' };
    }
    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/member/getMemberList.js

```js
import { ShopMemberModel } from '../../../../models';
import { getKeywordCriteriaForUser } from '../../../../utils';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    const member = await ShopMemberModel.findById(userId);
    const criteria = { ...getKeywordCriteriaForUser(keyword, { shopId: member.shopId }), partmentId: member.partmentId };
    const count = (fromPC && pageNo === 0) ? await ShopMemberModel.count(criteria) : undefined;
    const query = ShopMemberModel.find(criteria).sort({ registerTime: 'asc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        phone: 1,
        email: 1,
        name: 1,
        head: 1,
        post: 1,
        partmentId: 1,
        authority: 1,
        phoneList: 1,
    }).populate({
        path: 'partmentId',
        select: { name: 1 },
    });

    return { success: true, context: {
        count,
        memberList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/member/getWarehouseMemberList.js

```js
import { ShopMemberModel, ShopPartmentModel } from '../../../../models';
import { getKeywordCriteriaForUser } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    const member = await ShopMemberModel.findById(userId);
    const partmentList = await ShopPartmentModel.find({ shopId: member.shopId, type: CONSTANTS.SP_WARE_HOUSE_PARTMENT });
    const criteria = getKeywordCriteriaForUser(keyword, { shopId: member.shopId, partmentId: { $in: partmentList.map(o => o.id) } });
    const count = (fromPC && pageNo === 0) ? await ShopMemberModel.count(criteria) : undefined;
    const query = ShopMemberModel.find(criteria).sort({ registerTime: 'asc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        phone: 1,
        email: 1,
        name: 1,
        head: 1,
        post: 1,
        partmentId: 1,
        authority: 1,
        phoneList: 1,
    }).populate({
        path: 'partmentId',
        select: { name: 1 },
    });

    return { success: true, context: {
        count: (count || docs.length),
        memberList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/member/modifyMember.js

```js
import { ShopMemberModel } from '../../../../models';
import { omitNil, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default ({
    userId,
    memberId,
    name,
    post,
    phone,
    authority,
}) => {
    if (authority) {
        authority = _.sortBy(_.uniq(authority));
    }
    return new Promise(async resolve => {
        if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_MEMBER)) {
            return resolve({ msg: '你没有修改成员信息的权限' });
        }
        const doc = await ShopMemberModel.findByIdAndUpdate(memberId, omitNil({
            name,
            phone,
            post,
            authority,
        }), { new: true }).select({
            phone: 1,
            email: 1,
            name: 1,
            head: 1,
            post: 1,
            authority: 1,
            phoneList: 1,
        }).catch((err) => {
            return resolve({ msg: '登录电话号码(' + phone + ')已经被其他人使用' });
        });

        if (!doc) {
            return resolve({ msg: '修改失败' });
        }

        actionLog(userId, 'ShopMember', memberId, 'ShopMember', 'modifyMember');

        return resolve({ success: true, context: doc });
    });
};

```

* PDShopServer/project/App/routers/posts/shop/member/removeMember.js

```js
import { ShopMemberModel, ShopPartmentModel } from '../../../../models';
import { hasAuthority, authenticatePassword, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    memberId,
    password,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_REMOVE_MEMBER)) {
        return { msg: '你没有删除成员的权限' };
    }
    const error = await authenticatePassword(member, password);
    if (error) {
        return { msg: '密码错误' };
    }

    await ShopMemberModel.findByIdAndRemove(memberId);
    await ShopPartmentModel.findByIdAndUpdate(member.partmentId, { $inc: { memberCount: -1 } });

    actionLog(userId, 'ShopMember', memberId, 'ShopMember', 'removeMember');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/order/getOrderDetail.js

```js
import { OrderModel } from '../../../../models';

export default async ({ userId, orderId }) => {
    const order = await OrderModel.findById(orderId)
    .populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });
    if (!order) {
        return { msg: '没有该货单' };
    }

    const context = order.toObject();
    context.state = context.stateList[0].state;
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/order/getOrders.js

```js
import _ from 'lodash';
import { OrderModel, ShopMemberModel } from '../../../../models';
import { getKeywordCriteriaForOrder, omitNil, hasAuthority } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getPageData (shopId, type, params) {
    let { keyword, startDate, endDate, fromPC, pageNo, pageSize } = params;
    let criteria = {};
    if (type === 'toprintbarcode') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_PRINT_BAR_CODE };
    } else if (type === 'toselectroadmap') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_SELECT_ROADMAP };
    } else if (type === 'topay') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_PAYMENT };
    } else if (type === 'toprintbill') {
        criteria = { 'stateList.state': { $in: [ CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER, CONSTANTS.OS_READY_PRINT_ORDER ] } };
    } else if (type === 'tostore') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_STOCK };
    } else if (type === 'stored') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_LOAD };
    } else if (type === 'tostartoff') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_START_OFF };
    } else if (type === 'onway') {
        criteria = { 'stateList.state': CONSTANTS.OS_ON_THE_WAY };
    } else if (type === 'success') {
        criteria = { 'stateList.state': CONSTANTS.OS_RECEIVE_SUCCESS };
    }
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }
    criteria = getKeywordCriteriaForOrder(keyword, omitNil({ ...criteria, shopId }));

    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shopId: 1,
        shipperId: 1,
        senderName: 1,
        senderPhone: 1,
        receiverName: 1,
        receiverPhone: 1,
        name: 1,
        endPoint: 1,
        sendDoorEndPoint: 1,
        createTime: 1,
        modifyTime: 1,
        isReachPay: 1,
        payMode: 1,
        receiveMemberId: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        isSendDoor: 1,
        isClientPick: 1,
        isInsuance: 1,
        insuanceMount: 1,
        insuanceFee: 1,
        fee: 1,
        profit: 1,
        masterProfit: 1,
        branchProfit: 1,
        realFee: 1,
        proxyCharge: 1,
        proxyChargeProfit: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
        totalDesignatedFee: 1,
        designatedFee: 1,
        placeOrderTime: 1,
    }).populate({
        path: 'receiveMemberId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperId',
        select: { name: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['待打印二维码', '待选路线', '待支付', '待打印货单', '待入库', '已入库', '待出发', '运输中', '成功']
const TYPES = ['toprintbarcode', 'toselectroadmap', 'topay', 'toprintbill', 'tostore', 'stored', 'tostartoff', 'onway', 'success'];
export default async ({ userId, shopId, type, ...params }) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1 },
    });
    if (member.partmentId || !hasAuthority(member, CONSTANTS.AH_LOOK_ORDERS)) {
        return { msg: '你没有查看货单的权限' };
    }
    if (!member.shop.isMasterShop) {
        shopId = member.shop.id;
    }

    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(shopId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                toprintbarcode: await getPageData(shopId, 'toprintbarcode', params),
                toselectroadmap: await getPageData(shopId, 'toselectroadmap', params),
                topay: await getPageData(shopId, 'topay', params),
                toprintbill: await getPageData(shopId, 'toprintbill', params),
                tostore: await getPageData(shopId, 'tostore', params),
                stored: await getPageData(shopId, 'stored', params),
                tostartoff: await getPageData(shopId, 'tostartoff', params),
                onway: await getPageData(shopId, 'onway', params),
                success: await getPageData(shopId, 'success', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/shop/partment/createPartment.js

```js
import { ShopPartmentModel, ShopMemberModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import { _T, registerUser, hasAuthority, getDefaultPassWord, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    chargeManPhone, // 部门负责人登录电话
    chargeManName,  // 部门负责人姓名
    chargeManPassword, // 部门负责人登录密码（不传入该参数，默认为手机号码后6位）
    name,
    type,
    descript,
    phoneList,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_CREATE_PARTMENT)) {
        return { msg: '你没有创建部门的权限' };
    }

    const authorities = {
        [CONSTANTS.SP_RECEIVE_PARTMENT]: [CONSTANTS.AH_RECEIVE_PARTMENT, CONSTANTS.AH_RECHARGE, CONSTANTS.AH_WITHDRAW, CONSTANTS.AH_LOOK_AMOUNT],
        [CONSTANTS.SP_WARE_HOUSE_PARTMENT]: [CONSTANTS.AH_WARE_HOUSE_PARTMENT],
        [CONSTANTS.SP_CARRY_PARTMENT]: [CONSTANTS.AH_CARRY_PARTMENT, CONSTANTS.AH_WITHDRAW, CONSTANTS.AH_LOOK_AMOUNT],
        [CONSTANTS.SP_SECURITY_CHECK_PARTMENT]: [CONSTANTS.AH_SECURITY_CHECK_PARTMENT],
        [CONSTANTS.SP_DISTRIBUTION_PARTMENT]: [CONSTANTS.AH_DISTRIBUTION_PARTMENT],
    };

    // 注册部门负责人号
    const chargeMan = new ShopMemberModel({
        shopId: member.shopId,
        phone: chargeManPhone,
        name: chargeManName,
        post: CONSTANTS.PO_PARTMENT_CHARGE_MAN,
        authority: [
            ...(authorities[type] || []), // 部门的权限
            // 部门
            CONSTANTS.AH_MODIFY_OWN_PARTMENT, // 修改所在部门信息的权限
            // 成员
            CONSTANTS.AH_CREATE_MEMBER, // 创建成员的权限
            CONSTANTS.AH_MODIFY_MEMBER, // 修改成员信息的权限
            CONSTANTS.AH_REMOVE_MEMBER, // 删除成员的权限
            CONSTANTS.AH_LOOK_MEMBER, // 查看成员的权限
            // 统计
            CONSTANTS.AH_LOOK_STATISTICS, // 查看统计信息的权限
        ],
    });

    // 创建部门
    const partment = new ShopPartmentModel({
        shopId: member.shopId,
        chargeManId: chargeMan.id,
        name,
        type,
        descript,
        phoneList,
    });
    chargeMan.partmentId = partment.id;

    // 保存
    const error = await registerUser(ShopMemberModel, chargeMan, getDefaultPassWord(chargeManPhone, chargeManPassword));
    if (error === 'UserExistsError') {
        return { msg: '部门负责人账号已经被占用' };
    } else if (error) {
        return { msg: '部门负责人账号注册失败' };
    }

    // 创建部门
    const account = await AccountModel.create({ targetId: _T(partment.id), type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT });
    if (!account) {
        return { msg: '创建部门账号失败' };
    }
    await partment.save();

    actionLog(userId, 'ShopMember', partment.id, 'ShopPartment', 'createPartment');

    const context = await ShopPartmentModel.findById(partment.id)
    .select({
        name: 1,
        type: 1,
        descript: 1,
        phoneList: 1,
        chargeManId: 1,
    }).populate({
        path: 'chargeManId',
        select: { name: 1, phone: 1 },
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/partment/getOwnPartmentInfo.js

```js
import { ShopPartmentModel } from '../../../../models';
import { getPartmentIdByMember } from '../../../../utils';

export default async ({
    userId,
}) => {
    const partmentId = await getPartmentIdByMember(userId);
    if (!partmentId) {
        return { msg: '你没有加入任何部门' };
    }
    const doc = await ShopPartmentModel.findById(partmentId)
    .populate({
        path: 'chargeManId',
        select: { name: 1, phone: 1 },
    });
    if (!doc) {
        return { msg: '你没有加入任何部门' };
    }
    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/partment/getPartmentDetail.js

```js
import { ShopPartmentModel } from '../../../../models';

export default async ({
    userId,
    partmentId,
}) => {
    const doc = await ShopPartmentModel.findById(partmentId)
    .populate({
        path: 'chargeManId',
        select: { name: 1, phone: 1, head: 1, email: 1, phoneList: 1 },
    });
    if (!doc) {
        return { msg: '没有该部门' };
    }
    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/partment/getPartmentList.js

```js
import { ShopPartmentModel } from '../../../../models';
import { getKeywordCriteriaForPartment, getOwnShop } from '../../../../utils';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    const shopId = await getOwnShop(userId);
    const criteria = getKeywordCriteriaForPartment(keyword, { shopId });
    const count = (fromPC && pageNo === 0) ? await ShopPartmentModel.count(criteria) : undefined;
    const query = ShopPartmentModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        name: 1,
        type: 1,
        descript: 1,
        phoneList: 1,
        chargeManId: 1,
    }).populate({
        path: 'chargeManId',
        select: { name: 1, phone: 1 },
    });

    return { success: true, context: {
        count,
        partmentList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/partment/modifyOwnPartment.js

```js
import { ShopPartmentModel, ShopMemberModel } from '../../../../models';
import { omitNil, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    descript,
    phoneList,
    price,
    enable,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_OWN_PARTMENT)) {
        return { msg: '你没有修改部门的权限' };
    }

    const doc = await ShopPartmentModel.findByIdAndUpdate(member.partmentId, omitNil({
        descript,
        phoneList,
        price,
        enable,
        modifyTime: Date.now(),
    }), { new: true }).select({
        chargeManId: 1,
        name: 1,
        type: 1,
        descript: 1,
        phoneList: 1,
        price: 1,
        enable: 1,
    }).populate({
        path: 'chargeManId',
        select: { name: 1, phone: 1 },
    });
    if (!doc) {
        return { msg: '修改失败' };
    }

    actionLog(userId, 'ShopMember', member.partmentId, 'ShopPartment', 'modifyOwnPartment');

    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/partment/modifyPartment.js

```js
import { ShopPartmentModel } from '../../../../models';
import { omitNil, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    partmentId,
    name,
    type,
    descript,
    phoneList,
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_PARTMENT)) {
        return { msg: '你没有修改部门的权限' };
    }

    const doc = await ShopPartmentModel.findByIdAndUpdate(partmentId, omitNil({
        name,
        type,
        descript,
        phoneList,
        modifyTime: Date.now(),
    }), { new: true }).select({
        name: 1,
        descript: 1,
        phoneList: 1,
        chargeManId: 1,
    }).populate({
        path: 'chargeManId',
        select: { name: 1, phone: 1 },
    });
    if (!doc) {
        return { msg: '修改失败' };
    }

    actionLog(userId, 'ShopMember', partmentId, 'ShopPartment', 'modifyPartment');

    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/partment/removePartment.js

```js
import { ShopPartmentModel, ShopMemberModel } from '../../../../models';
import { authenticatePassword, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    partmentId,
    password,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_REMOVE_PARTMENT)) {
        return { msg: '你没有删除部门的权限' };
    }
    const error = await authenticatePassword(member, password);
    if (error) {
        return { msg: '密码错误' };
    }
    await ShopPartmentModel.findByIdAndRemove(partmentId);

    actionLog(userId, 'ShopMember', partmentId, 'ShopPartment', 'removePartment');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/personal/findPassword.js

```js
import { ShopMemberModel } from '../../../../models';
import { setPassword, checkVerifyCode, actionLog } from '../../../../utils';

export default async ({ phone, password, verifyCode }) => {
    const user = await ShopMemberModel.findOne({ phone });
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    const success = await checkVerifyCode(phone, verifyCode);
    if (!success) {
        return { msg: '无效验证码' };
    }

    const error = await setPassword(user, password);
    if (error) {
        return { msg: '服务器错误' };
    }
    await user.save();

    actionLog(user.id, 'ShopMember', user.id, 'ShopMember', 'findPassword');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/personal/getPersonalInfo.js

```js
import { ShopMemberModel } from '../../../../models';
import { AccountModel } from '../../../../mysql';
import CONSTANTS from '../../../../constants';
import { _T, _Y } from '../../../../utils/';

export default async ({ userId, fromPC }) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'partmentId',
        populate: [{
            path: 'chargeManId',
            select: { name: 1, phone: 1 },
        }],
    })
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1, chairManId: 1 },
        populate: [{
            path: 'chairManId',
            select: { name: 1, phone: 1 },
        }],
    });
    if (!member) {
        return { msg: '没有该用户' };
    }
    const context = member.toObject();
    context.userId = context.id;
    delete context.id;

    if (member.shop.isMasterShop) {
        const masterAccount = await AccountModel.findOne({ where: { id: CONSTANTS.AC_MASTER_ACCOUNT } });
        if (!masterAccount) {
            return { msg: '没有该账户' };
        }
        context.remainAmount = _Y(masterAccount.amount);
    } else if (member.partmentId) {
        const partmentAccount = await AccountModel.findOne({ where: { targetId: _T(member.partment.id), type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT } });
        if (!partmentAccount) {
            return { msg: '没有该账户' };
        }
        context.remainAmount = _Y(partmentAccount.amount);
    } else {
        const branchAccount = await AccountModel.findOne({ where: { targetId: _T(member.shop.id), type: CONSTANTS.AT_BRANCH_SHOP } });
        if (!branchAccount) {
            return { msg: '没有该账户' };
        }
        context.remainAmount = _Y(branchAccount.amount);
    }

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/personal/login.js

```js
import { ShopMemberModel } from '../../../../models';
import { authenticatePassword, actionLog } from '../../../../utils';

export default async ({ phone, password }) => {
    const user = await ShopMemberModel.findOne({ phone });
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    const error = await authenticatePassword(user, password);
    if (error) {
        return { msg: '密码错误' };
    } else {
        actionLog(user.id, 'ShopMember', user.id, 'ShopMember', 'login');
        return { success: true, context: { userId: user.id, shopId: user.shopId } };
    }
};

```

* PDShopServer/project/App/routers/posts/shop/personal/modifyPassword.js

```js
import { ShopMemberModel } from '../../../../models';
import { setPassword, authenticatePassword, actionLog } from '../../../../utils';

export default async ({ userId, oldPassword, newPassword }) => {
    const user = await ShopMemberModel.findById(userId);
    if (!user) {
        return { msg: '该电话号码没有注册' };
    }
    let error = await authenticatePassword(user, oldPassword);
    if (error) {
        return { msg: '密码错误' };
    }
    error = await setPassword(user, newPassword);
    if (error) {
        return { msg: '设置密码失败' };
    }
    await user.save();

    actionLog(userId, 'ShopMember', userId, 'ShopMember', 'modifyPassword');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/personal/modifyPersonalInfo.js

```js
import { ShopMemberModel, MediaModel } from '../../../../models';
import { getMediaId, omitNil, getAgeFromBirthday, actionLog } from '../../../../utils';

export default async ({
    userId,
    name,
    head,
    email,
    sex,
    birthday,
    address,
    phoneList,
}) => {
    let _head = getMediaId(head);
    const doc = await ShopMemberModel.findByIdAndUpdate(userId, omitNil({
        name,
        head: _head,
        email,
        sex,
        birthday,
        address,
        phoneList,
    }));
    if (!doc) {
        return { msg: '修改失败' };
    }
    MediaModel._updateRef(
        { [_head]: 1 },
        { [head && doc.head]: -1 },
    );

    actionLog(userId, 'ShopMember', userId, 'ShopMember', 'modifyPersonalInfo');

    return { success: true, context: { ...doc.toObject(), ...omitNil({
        name,
        head,
        email,
        sex,
        birthday,
        age: getAgeFromBirthday(birthday),
        address,
        phoneList,
    }) } };
};

```

* PDShopServer/project/App/routers/posts/shop/personal/submitFeedback.js

```js
import { FeedbackModel } from '../../../../models';
import { actionLog } from '../../../../utils';

export default async ({ userId, content, email }) => {
    const feedback = new FeedbackModel({ shopMemberId: userId, content, email });
    await feedback.save();

    actionLog(userId, 'ShopMember', userId, 'ShopMember', 'submitFeedback');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/securityCheckPartment/checkTruckPass.js

```js
import { ShopMemberModel, TruckModel, OrderModel, DriverModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    driverId,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_SECURITY_CHECK_PARTMENT)) {
        return { msg: '权限不足' };
    }
    const truck = await TruckModel.findOne({ driverId, shopId: member.shopId, state: { $in: [ CONSTANTS.TS_READY_ENTER_WAREHOUSE, CONSTANTS.TS_READY_EXIT_WAREHOUSE ] } });
    if (!truck) {
        return { msg: '该货车未完成审核或者未付搬运款' };
    }
    if (truck.state === CONSTANTS.TS_READY_ENTER_WAREHOUSE) {
        await truck.update({ state: CONSTANTS.TS_READY_SEARCH_CARRY_PARTMENT });
    } else {
        await OrderModel.update({ _id: { $in: truck.orderList } }, { 'stateList.0.state': CONSTANTS.OS_ON_THE_WAY }, { multi: true });
        await truck.update({ state: CONSTANTS.TS_ON_THE_WAY });
    }
    const doc = await DriverModel.findById(driverId);

    actionLog(userId, 'ShopMember', driverId, 'Driver', 'checkTruckPass');

    return { success: true, context: {
        isEnter: truck.state === CONSTANTS.TS_READY_ENTER_WAREHOUSE,
        plateNo: truck.plateNo,
        driver: doc,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/shipper/getNeedExamineTruckList.js

```js
import { TruckModel, ShopMemberModel } from '../../../../models';
import { getKeywordCriteriaForTruck } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    const member = await ShopMemberModel.findById(userId);
    const criteria = getKeywordCriteriaForTruck(keyword, { shopId: member.shopId, state: CONSTANTS.TS_READY_EXAMINE });
    const count = (fromPC && pageNo === 0) ? await TruckModel.count(criteria) : undefined;
    const query = TruckModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        plateNo: 1,
        drivingLicense: 1,
        truckType: 1,
        driverId: 1,
        locationList: 1,
        insuanceMount: 1,
        createTime: 1,
    })
    .populate({
        path: 'driverId',
        select: { name: 1, phone: 1, licenseNo: 1 },
    });

    return { success: true, context: {
        count,
        truckList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/shipper/getShipperDetail.js

```js
import { ShipperModel, ShipperInBranchShopModel } from '../../../../models';

export default async ({ userId, shipperId, shopId }) => {
    let shipper = await ShipperModel.findById(shipperId)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    if (!shipper) {
        return { msg: '没有该物流公司' };
    }
    shipper = shipper.toObject();
    let inShop = await ShipperInBranchShopModel.findOne({ shipperId, shopId });
    if (!inShop) {
        return { msg: '该物流公司没有入住该分店' };
    }
    inShop = inShop.toObject();
    shipper = { ...shipper, ...inShop };

    return { success: true, context: shipper };
};

```

* PDShopServer/project/App/routers/posts/shop/shipper/getShipperList.js

```js
import mongoose from 'mongoose';
import { ShipperInBranchShopModel, ShopMemberModel } from '../../../../models';
import { getKeywordCriteriaForShipper } from '../../../../utils';

export default async ({ userId, shopId, keyword, fromPC, pageNo, pageSize }) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1 },
    });
    if (!member.shop.isMasterShop) {
        shopId = member.shop.id;
    }
    const criteria = shopId ? { shopId: new mongoose.Types.ObjectId(shopId) } : {};
    let count;
    if (fromPC && pageNo === 0) {
        const countResults = await ShipperInBranchShopModel.aggregate()
        .match(criteria)
        .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
        .project({
            name: { $arrayElemAt: ['$shipper.name', 0] },
        })
        .match(getKeywordCriteriaForShipper(keyword))
        .group({
            _id: null,
            total: { $sum: 1 },
        });
        count = countResults.length ? countResults[0].total : 0;
    }

    const docs = await ShipperInBranchShopModel.aggregate()
    .match(criteria)
    .lookup({ from: 'shippers', localField: 'shipperId', foreignField: '_id', as: 'shipper' })
    .project({
        id: { $arrayElemAt: ['$shipper._id', 0] },
        name: { $arrayElemAt: ['$shipper.name', 0] },
        chairManId: { $arrayElemAt: ['$shipper.chairManId', 0] },
        acountAmount: { $arrayElemAt: ['$shipper.acountAmount', 0] },
        capital: { $arrayElemAt: ['$shipper.capital', 0] },
        shipperType: { $arrayElemAt: ['$shipper.shipperType', 0] },
        shopId: 1,
        totalBondAmount: 1,
        remainBondAmount: 1,
    })
    .match(getKeywordCriteriaForShipper(keyword))
    .lookup({ from: 'shops', localField: 'shopId', foreignField: '_id', as: 'shop' })
    .lookup({ from: 'clients', localField: 'chairManId', foreignField: '_id', as: '_chairMan' })
    .project({
        _id: 0,
        shopId: { $arrayElemAt: ['$shop._id', 0] },
        shopName: { $arrayElemAt: ['$shop.name', 0] },
        chairMan: { name: { $arrayElemAt: ['$_chairMan.name', 0] }, phone: { $arrayElemAt: ['$_chairMan.phone', 0] } },
        id: 1,
        name: 1,
        shipperType: 1,
        chairManId: 1,
        acountAmount: 1,
        capital: 1,
        totalBondAmount: 1,
        remainBondAmount: 1,
    });

    return { success: true, context: {
        count,
        shipperList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/shipper/modifyShipper.js

```js
import _ from 'lodash';
import { ShipperModel, ShipperInBranchShopModel, ShopMemberModel, MediaModel } from '../../../../models';
import { getMediaId, hasAuthority, omitNil, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    shipperId,
    name, // 物流公司名称
    image, // 物流公司背景图片
    sign, // 物流公司签名
    phoneList, // 物流公司联系电话
    address, // 商铺地址
    capital, // 注册资金
    legalName, // 法人姓名
    legalPhone, // 法人电话
    legalIDCard, // 法人身份证
    bondCompanyList, //担保公司列表
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_SHIPPER)) {
        return { msg: '你没有修改物流公司信息的权限' };
    }

    let _image = getMediaId(image);
    let _legalIDCard = _.map(legalIDCard, o => getMediaId(o));
    let _bondCompanyList = _.map(bondCompanyList, item => {
        item.certificate = _.map(item.certificate, o => getMediaId(o));
        item.legalIDCard = _.map(item.legalIDCard, o => getMediaId(o));
        return item;
    });

    const totalBondAmount = _.sumBy(_bondCompanyList, o => o.bondAmount) || 0;
    let inShop = await ShipperInBranchShopModel.findOne({ shipperId, shopId: member.shopId });
    if (!inShop) {
        return { msg: '该物流公司没有入住分店' };
    }
    await inShop.update(omitNil({
        bondCompanyList: bondCompanyList && _bondCompanyList,
        totalBondAmount: bondCompanyList && totalBondAmount,
        remainBondAmount: bondCompanyList && (totalBondAmount - inShop.usedBondAmount),
    }));
    let shipper = await ShipperModel.findByIdAndUpdate(shipperId, omitNil({
        name,
        image: _image,
        sign,
        phoneList,
        address,
        capital,
        legalName,
        legalPhone,
        legalIDCard: legalIDCard && _legalIDCard,
    }));

    MediaModel._updateRef(
        { [_image]: 1 },
        { [image && shipper.image]: -1 },
        ..._legalIDCard.map(item => ({ [item]: 1 })),
        ...(legalIDCard ? shipper.legalIDCard : []).map(item => ({ [item]: -1 })),
        ..._.flatten(_bondCompanyList.map(item => {
            const list = [...item.certificate, ...item.legalIDCard];
            return list.map(o => ({ [o]: 1 }));
        })),
        ..._.flatten((bondCompanyList ? inShop.bondCompanyList : []).map(item => {
            const list = [...item.certificate, ...item.legalIDCard];
            return list.map(o => ({ [o]: -1 }));
        })),
    );

    shipper = await ShipperModel.findById(shipperId)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    shipper = shipper.toObject();
    inShop = await ShipperInBranchShopModel.findOne({ shipperId, shopId: member.shopId });
    inShop = inShop.toObject();
    shipper = { ...shipper, ...inShop, shopId: member.shopId, id: shipper.id };

    actionLog(userId, 'ShopMember', shipperId, 'Shipper', 'modifyShipper');

    return { success: true, context: shipper };
};

```

* PDShopServer/project/App/routers/posts/shop/shipper/passExamineTruck.js

```js
import { TruckModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, truckId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_TO_EXAMINE_TRUCK)) {
        return { msg: '你没有审核货车的权限' };
    }

    const truck = await TruckModel.findById(truckId);
    if (!truck) {
        return { msg: '没有该货车' };
    }
    if (truck.state !== CONSTANTS.TS_READY_EXAMINE) {
        return { msg: '该货车无需再审核' };
    }
    await truck.update({ state: CONSTANTS.TS_READY_ENTER_WAREHOUSE });

    actionLog(userId, 'ShopMember', truckId, 'Truck', 'passExamineTruck');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/shipper/removeBondCompany.js

```js
import _ from 'lodash';
import { ShipperModel, MediaModel } from '../../../../models';
import { actionLog } from '../../../../utils';

export default async ({
    userId,
    shipperId,
    name, //担保公司名称
}) => {
    const doc = await ShipperModel.findById(shipperId);
    if (!doc) {
        return { msg: '没有找到该物流公司' };
    }
    const company = _.find(doc.bondCompanyList, item => item.name === name);
    if (!company) {
        return { msg: '没有找到该担保公司' };
    }
    let certificate_ = company.certificate;
    let legalIDCard_ = company.legalIDCard;
    doc.bondCompanyList = _.reject(doc.bondCompanyList, item => item.name === name);
    doc.payAmount -= company.amount;
    await doc.save();

    MediaModel._updateRef(
        ...certificate_.map(item => ({ [item]: -1 })),
        ...legalIDCard_.map(item => ({ [item]: -1 })),
    );

    actionLog(userId, 'ShopMember', shipperId, 'Shipper', 'removeBondCompany');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/shipper/setBondCompany.js

```js
import _ from 'lodash';
import { ShipperModel, MediaModel } from '../../../../models';
import { getMediaId, actionLog } from '../../../../utils';

export default async ({
    userId,
    shipperId,
    name, // 担保公司名称
    phone, // 担保公司电话
    address, // 担保公司背景图片
    certificate, // 担保公司签名
    amount, // 担保公司承担的保额
    legalName, // 担保公司法人姓名
    legalIDCard, //担保公司法人身份证书
}) => {
    let _certificate = certificate.map(o => getMediaId(o));
    let _legalIDCard = legalIDCard.map(o => getMediaId(o));

    const doc = await ShipperModel.findById(shipperId);
    if (!doc) {
        return { msg: '没有找到该物流公司' };
    }
    const bondCompany = {
        name,
        phone,
        address,
        certificate: _certificate,
        amount,
        legalName,
        legalIDCard: _legalIDCard,
    };
    let certificate_ = [], legalIDCard_ = [];
    const company = _.find(doc.bondCompanyList, item => item.name === name);
    if (!company) {
        doc.bondCompanyList.push(bondCompany);
        doc.payAmount += amount;
    } else {
        certificate_ = company.certificate;
        legalIDCard_ = company.legalIDCard;
        doc.payAmount += amount - company.amount;
        Object.assign(company, bondCompany);
    }
    await doc.save();

    MediaModel._updateRef(
        ..._certificate.map(item => ({ [item]: 1 })),
        ..._legalIDCard.map(item => ({ [item]: 1 })),
        ...certificate_.map(item => ({ [item]: -1 })),
        ...legalIDCard_.map(item => ({ [item]: -1 })),
    );

    actionLog(userId, 'ShopMember', shipperId, 'Shipper', 'setBondCompany');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/addRoadmapRegionProfitRate.js

```js
import { RoadmapRegionProfitRateModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    shopId,
    region = '',
    regionLastCode = 0,
    profitRate,
    type = 0,
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT)) {
        return { msg: '你没有修改路线的提成的权限' };
    }
    let regionRate = await RoadmapRegionProfitRateModel.findOne({ shopId, regionLastCode, type });
    if (regionRate) {
        return { msg: '这个方向的提成已经存在' };
    }

    regionRate = new RoadmapRegionProfitRateModel({
        shopId,
        region,
        regionLastCode,
        profitRate,
        type,
    });
    await regionRate.save();

    const context = await RoadmapRegionProfitRateModel.findById(regionRate.id)
    .select({
        shopId: 1,
        region: 1,
        regionLastCode: 1,
        profitRate: 1,
        type: 1,
        createTime: 1,
        modifyTime: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    actionLog(userId, 'ShopMember', regionRate.id, 'RoadmapRegionProfitRate', 'addRoadmapRegionProfitRate');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/getRoadmapDetail.js

```js
import { RoadmapModel } from '../../../../models';

export default async ({ userId, roadmapId }) => {
    const context = await RoadmapModel.findById(roadmapId)
    .populate({
        path: 'truckId',
        select: {
            name: 1,
            plateNo: 1,
            capacity: 1,
            size: 1,
            remark: 1,
        },
    });
    if (!context) {
        return { msg: '没有该线路' };
    }

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/getRoadmapList.js

```js
import { RoadmapModel, ShopMemberModel } from '../../../../models';
import { getKeywordCriteriaForRoadmap } from '../../../../utils';
import { getRegionProfitRateByEndPoint } from '../../libs/roadmap';
import _ from 'lodash';

export default async ({ userId, keyword, shopId, fromPC, pageNo, pageSize }) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1 },
    });
    if (!member.shop.isMasterShop) {
        shopId = member.shop.id;
    }
    const criteria = getKeywordCriteriaForRoadmap(keyword, shopId ? { shopId } : {});
    const count = (fromPC && pageNo === 0) ? await RoadmapModel.count(criteria) : undefined;
    const query = RoadmapModel.find(criteria).sort({ modifyTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shipperId: 1,
        shopId: 1,
        endPoint: 1,
        endPointLastCode: 1,
        transitPoint: 1,
        price: 1,
        minFee: 1,
        duration: 1,
        profitRate: 1,
    })
    .populate({
        path: 'shipperId',
        select: { name: 1 },
    })
    .populate({
        path: 'shopId',
        select: { name: 1, profitRate: 1, address: 1 },
    });

    const roadmapList = [];
    for (const doc of docs) {
        const item = doc.toObject();
        _.isNil(item.profitRate) && (item.defaultProfitRate = await getRegionProfitRateByEndPoint(item.shop.id, item.endPointLastCode, item.isCityDistribute));
        roadmapList.push(item);
    }

    return { success: true, context: {
        count,
        roadmapList,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/getRoadmapRegionProfitRateDetail.js

```js
import { RoadmapRegionProfitRateModel } from '../../../../models';

export default async ({ userId, regionRateId }) => {
    const doc = await RoadmapRegionProfitRateModel.findById(regionRateId)
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });
    if (!doc) {
        return { msg: '没有该设置' };
    }

    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/getRoadmapRegionProfitRateList.js

```js
import { RoadmapRegionProfitRateModel } from '../../../../models';
import { getKeywordCriteriaForRoadmapRegion } from '../../../../utils';

export default async ({ userId, shopId, keyword, fromPC, pageNo, pageSize }) => {
    const criteria = getKeywordCriteriaForRoadmapRegion(keyword, shopId ? { shopId: { $in: [ shopId, null ] } } : undefined);
    const count = (fromPC && pageNo === 0) ? await RoadmapRegionProfitRateModel.count(criteria) : undefined;
    const query = RoadmapRegionProfitRateModel.find(criteria).sort({ level: 'desc', modifyTime: 'desc', createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shopId: 1,
        region: 1,
        regionLastCode: 1,
        profitRate: 1,
        type: 1,
        createTime: 1,
        modifyTime: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    return { success: true, context: {
        count,
        regionRateList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/modifyRoadmapRegionProfitRate.js

```js
import { RoadmapRegionProfitRateModel } from '../../../../models';
import { _T, hasAuthority, actionLog, omitNil } from '../../../../utils';
import CONSTANTS from '../../../../constants';

// shopId 为必传参数，如果不传，则会修改为针对所有分店
// region 为必传参数，如果不传，则会修改为针对所有方向
// type 为必传参数，如果不传，则会修改为针对所有类型
export default async ({
    userId,
    regionRateId,
    shopId,
    region = '',
    regionLastCode = 0,
    profitRate,
    type = 0,
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT)) {
        return { msg: '你没有修改路线的提成的权限' };
    }

    let regionRate = await RoadmapRegionProfitRateModel.findOne({ shopId, regionLastCode, type });
    if (regionRate && regionRateId !== _T(regionRate.id)) {
        return { msg: '这个方向的提成已经存在' };
    }

    regionRate = await RoadmapRegionProfitRateModel.findByIdAndUpdate(regionRateId, {
        ...omitNil({
            profitRate,
        }),
        region,
        regionLastCode,
        type,
        shopId,
        modifyTime: Date.now(),
    }, { new: true });

    if (!regionRate) {
        return { msg: '提成不存在' };
    }

    const context = await RoadmapRegionProfitRateModel.findById(regionRate.id)
    .select({
        shopId: 1,
        region: 1,
        regionLastCode: 1,
        profitRate: 1,
        type: 1,
        createTime: 1,
        modifyTime: 1,
    })
    .populate({
        path: 'shopId',
        select: { name: 1 },
    });

    actionLog(userId, 'ShopMember', regionRateId, 'RoadmapRegionProfitRate', 'modifyRoadmapRegionProfitRate');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/removeRoadmapRegionProfitRate.js

```js
import { RoadmapRegionProfitRateModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, regionRateId }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT)) {
        return { msg: '你没有修改路线的提成的权限' };
    }

    await RoadmapRegionProfitRateModel.findByIdAndRemove(regionRateId);

    actionLog(userId, 'ShopMember', regionRateId, 'RoadmapRegionProfitRate', 'removeRoadmapRegionProfitRate');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/setRegionRateProfit.js

```js
import { RoadmapRegionProfitRateModel } from '../../../../models';
import { hasAuthority, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, regionRateIdList, profitRate = 0 }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT)) {
        return { msg: '你没有修改路线的提成的权限' };
    }

    await RoadmapRegionProfitRateModel.update({ _id: { $in: regionRateIdList } }, { profitRate, modifyTime: Date.now() }, { multi: true, upsert: true });
    actionLogWithList(userId, 'ShopMember', regionRateIdList.map(o => ({ id: o, model: 'RoadmapRegionProfitRate' })), 'setRegionRateProfit');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/roadmap/setRoadmapProfit.js

```js
import { RoadmapModel } from '../../../../models';
import { hasAuthority, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({ userId, roadmapIdList, profitRate }) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_ROADMAP_PROFIT)) {
        return { msg: '你没有修改路线的提成的权限' };
    }

    let options = { profitRate };
    if (_.isNil(profitRate)) {
        options = { $unset: { profitRate: true } };
    }
    await RoadmapModel.update({ _id: { $in: roadmapIdList } }, { ...options, setProfitRateTime: Date.now() }, { multi: true, upsert: true });
    actionLogWithList(userId, 'ShopMember', roadmapIdList.map(o => ({ id: o, model: 'Roadmap' })), 'setRoadmapProfit');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/getLastestOrder.js

```js
import { OrderModel } from '../../../../models';
import { getRPLatestOrder } from '../../libs/order';

export default async ({ userId }) => {
    let order = await getRPLatestOrder(userId);
    if (!order) {
        return { msg: '暂无货单' };
    }

    order = await OrderModel.findById(order.id)
    .populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });

    const context = order.toObject();
    context.state = context.stateList[0].state;
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/getOrders.js

```js
import _ from 'lodash';
import { OrderModel } from '../../../../models';
import { getKeywordCriteriaForOrder } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getPageData (userId, type, params) {
    let { keyword, startDate, endDate, fromPC, pageNo, pageSize } = params;
    let criteria = {};
    if (type === 'toselectroadmap') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_SELECT_ROADMAP };
    } else if (type === 'topay') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_PAYMENT };
    } else if (type === 'toprintbill') {
        criteria = { 'stateList.state': { $in: [ CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER, CONSTANTS.OS_READY_PRINT_ORDER ] } };
    } else if (type === 'tostore') {
        criteria = { 'stateList.state': CONSTANTS.OS_READY_STOCK };
    } else if (type === 'stored') {
        criteria = { 'stateList.state': { $gte: CONSTANTS.OS_READY_LOAD } };
    }
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }
    criteria = getKeywordCriteriaForOrder(keyword, { ...criteria, receiveMemberId: userId });
    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        senderName: 1,
        senderPhone: 1,
        receiverName: 1,
        receiverPhone: 1,
        name: 1,
        photo: 1,
        shopId: 1,
        shipperId: 1,
        isCityDistribute: 1,
        endPoint: 1,
        sendDoorEndPoint: 1,
        isSendDoor: 1,
        isClientPick: 1,
        createTime: 1,
        placeOrderTime: 1,
        modifyTime: 1,
        payMode: 1,
        receiveMemberId: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        stateList: 1,
        warehouse: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
        totalDesignatedFee: 1,
        proxyCharge: 1,
    }).populate({
        path: 'receiveMemberId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperId',
        select: { name: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['待选路线', '待支付', '待打印货单', '待入库', '已入库']
const TYPES = ['toselectroadmap', 'topay', 'toprintbill', 'tostore', 'stored'];
export default async ({ userId, type, ...params }) => {
    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(userId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                toselectroadmap: await getPageData(userId, 'toselectroadmap', params),
                topay: await getPageData(userId, 'topay', params),
                toprintbill: await getPageData(userId, 'toprintbill', params),
                tostore: await getPageData(userId, 'tostore', params),
                stored: await getPageData(userId, 'stored', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/getPreOrderList.js

```js
import { OrderModel, ClientModel } from '../../../../models';
import { getKeywordCriteriaForOrder } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({ userId, senderPhone, keyword, fromPC, pageNo, pageSize }) => {
    const client = await ClientModel.findOne({ phone: senderPhone });
    if (!client) {
        return { msg: '没有该用户' };
    }
    const criteria = getKeywordCriteriaForOrder(keyword, { senderId: client.id, 'stateList.state': CONSTANTS.OS_PREORDER });

    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const docs = await OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);

    return { success: true, context: {
        count,
        orderList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/getRegionAddressWithOrder.js

```js
import { OrderModel, ShopMemberModel } from '../../../../models';
import { getRPLatestOrder } from '../../libs/order';
import { getEndPointFromLastCode, getSendDoorAddressFromLastCode } from '../../libs/address';

export default async ({
    userId,
    orderId,
}) => {
    const member = await ShopMemberModel.findById(userId).populate({ path: 'shopId', select: { addressRegionLastCode: 1 } });
    const { addressRegionLastCode, id } = (member || {}).shop || {};

    let order;
    if (orderId) {
        order = await OrderModel.findById(orderId);
    } else {
        order = await getRPLatestOrder(userId);
    }

    let addressList = [];
    let cityAddressList = [];

    if (order) {
        if (!order.isCityDistribute) {
            addressList = await getEndPointFromLastCode(id, order.endPointLastCode);
            cityAddressList = await getSendDoorAddressFromLastCode(0, addressRegionLastCode);
        } else {
            addressList = await getEndPointFromLastCode(id, 0);
            cityAddressList = await getSendDoorAddressFromLastCode(order.endPointLastCode);
        }
    } else {
        addressList = await getEndPointFromLastCode(id, 0);
        cityAddressList = await getSendDoorAddressFromLastCode(0, addressRegionLastCode);
    }

    return { success: true, context: {
        addressList,
        cityAddressList,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/getRegionSendDoorAddressWithOrder.js

```js
import { OrderModel } from '../../../../models';
import { getRPLatestOrder } from '../../libs/order';
import { getSendDoorAddressFromLastCode } from '../../libs/address';

export default async ({
    userId,
    orderId,
}) => {
    let order;
    if (orderId) {
        order = await OrderModel.findById(orderId);
    } else {
        order = await getRPLatestOrder(userId);
    }

    const addressList = await getSendDoorAddressFromLastCode((order || {}).sendDoorEndPointLastCode);

    return { success: true, context: {
        addressList,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/getRoadmapListWithOrder.js

```js
import { OrderModel } from '../../../../models';
import { searchRoadmapListByReceivePartment, getRegionProfitRateByEndPoint } from '../../libs/roadmap';

export default async ({
    userId,
    fromPC,
    pageNo,
    pageSize,
    orderId,
    orderBy, //排序方式, 0：以价格优先， 1：以时长优先
}) => {
    const order = await OrderModel.findById(orderId);
    if (!order) {
        return { msg: '没有该货单' };
    }
    const {
        endPointLastCode, // 终点
        sendDoorEndPointLastCode, // 送货上门终点
        isSendDoor, // 是否送货上门
        weight, // 重量
        size, // 方量
        proxyCharge, // 代收货款金额
        isCityDistribute, // 是否同城配送
        isReachPay, // 是否是到付
        totalDesignatedFee, //指定向收货人应该收多少钱
    } = order;
    const regionProfitRate = await getRegionProfitRateByEndPoint(order.shopId, endPointLastCode, isCityDistribute);
    const context = await searchRoadmapListByReceivePartment({
        shopId: order.shopId,
        fromPC,
        pageNo,
        pageSize,
        endPointLastCode,
        sendDoorEndPointLastCode,
        isSendDoor,
        weight,
        size,
        proxyCharge,
        isReachPay,
        totalDesignatedFee,
        orderBy,
        regionProfitRate,
    });
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/modifyOriginOrder.js

```js
import { ShopMemberModel, OrderModel, ClientModel } from '../../../../models';
import { _T, hasAuthority, actionLog, omitNil } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { setting } from '../../../../manager';

export default async ({
    userId, // 收货部收货员
    orderId,
    senderPhone,
    senderName,
    receiverPhone,
    receiverName,
    name,
    isCityDistribute, // 是否是同城配送
    endPoint, // 终点，精确到镇级别
    endPointLastCode, // 终点镇级代码
    sendDoorEndPoint, // 送货上门地址，精确到镇级别
    sendDoorEndPointLastCode, // 送货上门地址镇级代码
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, // 一票货总的方量
    isSendDoor, // 是否送货上门
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee, // 指定向收货人应该收多少钱
    proxyCharge, // 代收货款金额
    isInsuance, //是否保价
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '你没有收货的权限' };
    }

    let senderId, sender;
    if (senderPhone) {
        senderId = await ClientModel.checkExistElseCreate(senderPhone);
        if (!senderId) {
            return { msg: '系统创建账号错误，请重试' };
        }
        sender = await ClientModel.findById(senderId)
        .populate({
            path: 'shipperId',
            select: { chairManId: 1 },
        });
    }
    let receiverId;
    if (receiverPhone) {
        receiverId = await ClientModel.checkExistElseCreate(receiverPhone);
        if (!receiverId) {
            return { msg: '系统创建账号错误，请重试' };
        }
    }

    const order = await OrderModel.findById(orderId);
    if (!order) {
        return { msg: '没有该货单' };
    }
    const state = order.stateList[0].state;
    await order.update(omitNil({
        senderId,
        senderPhone,
        senderName,
        isSenderRepresentShipper: sender && sender.shipperId && _T(sender.shipper.chairManId) === sender.id,
        receiverId,
        receiverPhone,
        receiverName,
        name,
        isCityDistribute,
        endPoint,
        endPointLastCode,
        sendDoorEndPoint,
        sendDoorEndPointLastCode,
        totalNumbers,
        weight,
        size,
        isSendDoor,
        proxyCharge,
        proxyChargeProfit: proxyCharge !== undefined ? Math.ceil(proxyCharge * setting.proxyChargeProfitRate) : undefined,
        isReachPay,
        payMode: isReachPay !== undefined ? (isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE) : undefined,
        totalDesignatedFee,
        isInsuance,
        'stateList.0.state': state === CONSTANTS.OS_READY_PRINT_BAR_CODE ? CONSTANTS.OS_READY_PRINT_BAR_CODE : CONSTANTS.OS_READY_SELECT_ROADMAP,
        'stateList.0.count': totalNumbers || order.totalNumbers,
        modifyTime: Date.now(),
    }));

    let context = await OrderModel.findById(orderId);
    context = context.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'ShopMember', orderId, 'Order', 'modifyOriginOrder');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/placeOriginOrder.js

```js
import { ShopMemberModel, OrderModel, ClientModel } from '../../../../models';
import { _T, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { setting } from '../../../../manager';

export default async ({
    userId, // 收货部收货员
    senderPhone,
    senderName,
    receiverPhone,
    receiverName,
    name,
    isCityDistribute, // 是否是同城配送
    endPoint, // 终点，精确到镇级别
    endPointLastCode = 0, // 终点镇级代码
    sendDoorEndPoint, // 送货上门地址，精确到镇级别
    sendDoorEndPointLastCode = 0, // 送货上门地址镇级代码
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, // 一票货总的方量
    isSendDoor, // 是否送货上门
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee = 0, // 指定向收货人应该收多少钱
    proxyCharge = 0, // 代收货款金额
    isInsuance, //是否保价
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '你没有收货的权限' };
    }

    if (isSendDoor && !sendDoorEndPointLastCode) {
        return { msg: '需要送货上门必须填写送货上门的地址' };
    }
    if (!isReachPay && totalDesignatedFee) {
        return { msg: '现付的情况下不能有指定收款' };
    }

    // 如果没有发送者或者接收者，就创建一个
    const senderId = await ClientModel.checkExistElseCreate(senderPhone);
    const receiverId = await ClientModel.checkExistElseCreate(receiverPhone);
    if (!senderId || !receiverId) {
        return { msg: '系统创建账号错误，请重试' };
    }

    const sender = await ClientModel.findById(senderId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    });

    const order = new OrderModel({
        shopId: member.shopId,
        senderId,
        senderName,
        senderPhone,
        isSenderRepresentShipper: sender.shipperId && _T(sender.shipper.chairManId) === _T(sender.id),
        receiverId,
        receiverPhone,
        receiverName,
        name,
        isCityDistribute,
        endPoint,
        endPointLastCode,
        sendDoorEndPoint,
        sendDoorEndPointLastCode,
        receivePartmentId: member.partmentId,
        receiveMemberId: userId,
        totalNumbers,
        weight,
        size,
        isSendDoor,
        proxyCharge: Math.floor(proxyCharge),
        proxyChargeProfit: Math.floor(proxyCharge * setting.proxyChargeProfitRate),
        isReachPay,
        payMode: isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE,
        totalDesignatedFee: Math.floor(totalDesignatedFee),
        isInsuance,
        stateList: [ { state: CONSTANTS.OS_READY_PRINT_BAR_CODE, count: totalNumbers } ],
        placeOrderTime: Date.now(),
    });
    await order.save();

    const context = order.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'ShopMember', order.id, 'Order', 'placeOriginOrder');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/placeOriginOrderWithPreOrder.js

```js
import { ShopMemberModel, OrderModel, ClientModel, OrderGroupModel } from '../../../../models';
import { _T, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { setting } from '../../../../manager';

export default async ({
    userId, // 收货部收货员
    preOrderId, // 预下单的货单号
    senderPhone,
    senderName,
    receiverPhone,
    receiverName,
    name,
    isCityDistribute, // 是否是同城配送
    endPoint, // 终点，精确到镇级别
    endPointLastCode = 0, // 终点镇级代码
    sendDoorEndPoint, // 送货上门地址，精确到镇级别
    sendDoorEndPointLastCode = 0, // 送货上门地址镇级代码
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, // 一票货总的方量
    isSendDoor, // 是否送货上门
    isReachPay, // 是否是到付 (如果是到付，并且设置了totalDesignatedFee，为指定向收货人收totalDesignatedFee的运费，否则向收货人收初始单计算出来的运费)
    totalDesignatedFee = 0, // 指定向收货人应该收多少钱
    proxyCharge = 0, // 代收货款金额
    isInsuance, //是否保价
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '你没有收货的权限' };
    }
    // 如果没有发送者或者接收者，就创建一个
    const senderId = await ClientModel.checkExistElseCreate(senderPhone);
    const receiverId = await ClientModel.checkExistElseCreate(receiverPhone);
    if (!senderId || !receiverId) {
        return { msg: '系统创建账号错误，请重试' };
    }

    const sender = await ClientModel.findById(senderId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    });

    const order = await OrderModel.findByIdAndUpdate(preOrderId, {
        shopId: member.shopId,
        senderId,
        senderName,
        senderPhone,
        isSenderRepresentShipper: sender.shipperId && _T(sender.shipper.chairManId) === _T(sender.id),
        receiverId,
        receiverPhone,
        receiverName,
        name,
        isCityDistribute,
        endPoint,
        endPointLastCode,
        sendDoorEndPoint,
        sendDoorEndPointLastCode,
        receivePartmentId: member.partmentId,
        receiveMemberId: userId,
        totalNumbers,
        weight,
        size,
        isSendDoor,
        proxyCharge: Math.floor(proxyCharge),
        proxyChargeProfit: Math.floor(proxyCharge * setting.proxyChargeProfitRate),
        isReachPay,
        payMode: isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE,
        totalDesignatedFee: Math.floor(totalDesignatedFee),
        isInsuance,
        stateList: [ { state: CONSTANTS.OS_READY_PRINT_BAR_CODE, count: totalNumbers } ],
        placeOrderTime: Date.now(),
        $unset: { groupId: 1 },
    });
    await order.save();

    const group = await OrderGroupModel.findByIdAndUpdate(order.groupId, { $inc: {
        totalNumbers: -totalNumbers,
        totalWeight: -weight,
        totalSize: -size,
        orderCount: -1,
    }, $pull: { orderIdList: preOrderId } }, { new: true });
    if (group && !group.orderIdList.length) {
        await group.remove();
    }

    actionLog(userId, 'ShopMember', preOrderId, 'Order', 'placeOriginOrderWithPreOrder');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/placeTransferOrder.js

```js
import { ShopMemberModel, OrderModel, TruckModel, MediaModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import { setClientPickShipper } from '../../libs/order';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({
    userId, // 收货部收货员
    orderId,
    totalNumbers, // 一票货总的件数
    weight, // 一票货总的重量
    size, //一票货总的方量
}) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { addressRegionLastCode: 1, profitRate: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '你没有收货的权限' };
    }

    const undoOrder = await OrderModel.findOne({ receiveMemberId: userId }).sort({ placeOrderTime: 'desc' });
    if (undoOrder && _.find(undoOrder.stateList, o => o.state === CONSTANTS.OS_READY_PRINT_BAR_CODE)) {
        return { msg: '请先打印上一个货单的二维码' };
    }

    let preOrder = await OrderModel.getLatestOrderFromOriginOrder(orderId);
    preOrder = await OrderModel.findById(preOrder.id)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    }).populate({
        path: 'agentId',
        select: { chairManId: 1 },
    });
    if (!preOrder) {
        return { msg: '没有该货单' };
    }
    if (!preOrder.agentId && !preOrder.shipperId) {
        return { msg: '错误的货单' };
    }
    if (_.find(preOrder.stateList, o => o.state === CONSTANTS.OS_ON_TRANSFER)) {
        return { msg: '该货单已经存在中转单' };
    }

    let isCityDistribute = false;
    // 如果上一单的终点是该店所在的城市，则为同城配送
    if (preOrder.endPointLastCode === member.shop.addressRegionLastCode) {
        isCityDistribute = true;
    }
    const hasReadyReceive = !!_.find(preOrder.stateList, o => o.state === CONSTANTS.OS_READY_RECEIVE);

    const isClientPick = isCityDistribute && !preOrder.isSendDoor;
    // 如果不是送货上门，则为自提，如果是同城配送，但是又不是送货上门，则需要物流公司自提竞价
    const order = new OrderModel({
        isTransferOrder: true,
        preOrderId: orderId,
        shopId: member.shop.id,
        senderId: preOrder.shipperId ? preOrder.shipper.chairManId : preOrder.agent.chairManId,
        senderPhone: preOrder.senderPhone,
        senderName: preOrder.senderName,
        isSenderRepresentShipper: !!preOrder.shipperId,
        receiverId: preOrder.receiverId,
        receiverPhone: preOrder.receiverPhone,
        receiverName: preOrder.receiverName,
        name: preOrder.name,
        isCityDistribute,
        endPoint: isCityDistribute ? preOrder.sendDoorEndPoint : preOrder.endPoint,
        endPointLastCode: isCityDistribute ? preOrder.sendDoorEndPointLastCode : preOrder.endPointLastCode,
        sendDoorEndPoint: isCityDistribute ? undefined : preOrder.sendDoorEndPoint,
        sendDoorEndPointLastCode: isCityDistribute ? 0 : preOrder.sendDoorEndPointLastCode,
        receivePartmentId: member.partmentId,
        receiveMemberId: userId,
        totalNumbers: totalNumbers || preOrder.totalNumbers,
        weight: weight || preOrder.weight,
        size: size || preOrder.size,
        isSendDoor: isCityDistribute ? false : preOrder.isSendDoor,
        isClientPick,
        proxyCharge: preOrder.proxyCharge,
        proxyChargeProfit: preOrder.proxyChargeProfit,
        isReachPay: preOrder.isReachPay,
        payMode: preOrder.isReachPay ? CONSTANTS.PM_REACH : CONSTANTS.PM_IMMEDIATE,
        totalDesignatedFee: preOrder.totalDesignatedFee,
        isInsuance: preOrder.isInsuance,
        insuanceFee: preOrder.insuanceFee,
        insuanceMount: preOrder.insuanceMount,
        stateList: [ { state: isClientPick ? CONSTANTS.OS_READY_STOCK : CONSTANTS.OS_READY_SELECT_ROADMAP, count: totalNumbers } ],
        photo: preOrder.photo,
        placeOrderTime: Date.now(),
    });
    !isClientPick && await order.save();
    preOrder.nextOrderId = order.id;
    preOrder.stateList = [ { state: CONSTANTS.OS_ON_TRANSFER, count: preOrder.totalNumbers } ];
    await preOrder.save();

    // 当该货单已经被物流公司确认卸货过，再拿来中转，需要将之前的货单全部变为在中转中
    if (hasReadyReceive) {
        const orderIdList = await OrderModel.getOrderIdListFromNode(preOrder);
        if (orderIdList.length) {
            await OrderModel.update({ _id: { $in: orderIdList } }, { 'stateList.0.state': CONSTANTS.OS_ON_TRANSFER }, { multi: true });
        }
    }

    // 如果有下了中转单，则前一个货单的货车需要强制确认到达
    preOrder.truckId && await TruckModel.findByIdAndUpdate(preOrder.truckId, { state: CONSTANTS.TS_RECEIVE_SUCCESS });

    MediaModel._updateRef(
        { [ preOrder.photo ]: 1 },
    );

    // 如果是用户自提的情况
    if (isClientPick) {
        await setClientPickShipper(order, member.shop.profitRate);
        await order.save();
    }

    const context = order.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'ShopMember', order.id, 'Order', 'placeTransferOrder');
    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/printBarCode.js

```js
import { OrderModel, ShopMemberModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId, // 收货部收货员
    orderId,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '权限不足' };
    }
    const order = await OrderModel.findById(orderId);
    if (!order) {
        return { msg: '没有该货单' };
    }
    if (order.stateList[0].state !== CONSTANTS.OS_READY_PRINT_BAR_CODE) {
        return { msg: '该货单状态不正确' };
    }

    // if (!order.photo) {
    //     return { msg: '请先拍照上传图片' };
    // }

    order.stateList = [ { state: CONSTANTS.OS_READY_SELECT_ROADMAP, count: order.totalNumbers } ];
    order.modifyTime = Date.now();
    await order.save();

    let context = order.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'ShopMember', orderId, 'Order', 'printBarCode');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/printOrderBill.js

```js
import { OrderModel, ShopMemberModel, RoadmapMaskModel, ShipperModel, ShipperInBranchShopModel } from '../../../../models';
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { _T, _F, _Y, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { settingMgr } from '../../../../manager';

const ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH = '10003';
const ERROR_OTHER = '10004';
function deductAmount (order, targetId, shipperId, proxyCharge, deductAmount) {
    return new Promise(async resolve => {
        const orderId = _T(order.id);
        const amount = proxyCharge + deductAmount;
        sequelize.transaction(async (transaction) => {
            const shipperAccount = await AccountModel.findOne({ where: { targetId, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } }, transaction });
            await shipperAccount.decrement({ amount }, { transaction });
            await AccountModel.increment({ amount }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            proxyCharge > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -proxyCharge, remark: '抵押货款' }, { transaction });
            deductAmount !== 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -deductAmount, remark: deductAmount < 0 ? '收取运费' : '抵押指定收款' }, { transaction });
            const acountAmount = _Y(shipperAccount.amount - amount);

            await OrderPaymentModel.create({ orderId, isPayed: true, payedTime: new Date() }, { transaction });

            // 扣除物流公司的担保金额
            const inShop = await ShipperInBranchShopModel.findOne({ shipperId: order.shipper.id, shopId: order.shopId });
            if (!inShop || inShop.remainBondAmount < order.needBondAmount) {
                throw ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH;
            }
            inShop.remainBondAmount = inShop.remainBondAmount - order.needBondAmount;
            inShop.usedBondAmount = inShop.totalBondAmount - inShop.remainBondAmount;
            await inShop.save();

            // 扣款成功后，需要更新物流公司的账目
            const doc = await ShipperModel.findByIdAndUpdate(shipperId, { acountAmount }).catch(e => {
                throw e;
            });
            if (!doc) {
                throw ERROR_OTHER;
            }
        }).then(() => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

export default async ({
    userId, // 收货部收货员
    orderId,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '权限不足' };
    }
    const order = await OrderModel.findById(orderId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    });
    if (!order) {
        return { msg: '没有该货单' };
    }
    const state = order.stateList[0].state;
    if (state !== CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER && state !== CONSTANTS.OS_READY_PRINT_ORDER) {
        return { msg: '该货单状态不正确' };
    }
    // 物流公司需要抵押总部和分店的提成部分划到总部账号
    if (state === CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER) {
        const err = await deductAmount(order, _T(order.shipper.chairManId), order.shipper.id, _F(order.proxyCharge), _F(order.totalDesignatedFee - order.fee));
        if (err === ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH) {
            order.deductError = true;
            order.modifyTime = Date.now();
            await order.save();
            return { msg: '该物流公司保证金，请选择其他公司的路线' };
        } else if (err) {
            order.deductError = true;
            order.modifyTime = Date.now();
            await order.save();
            return { msg: '物流公司扣款失败, 请选择其他路线' };
        }
    }
    order.stateList = [ { state: CONSTANTS.OS_READY_STOCK, count: order.totalNumbers } ];
    order.modifyTime = Date.now();
    await order.save();
    await RoadmapMaskModel.updateStatusList(order.shopId, order.endPointLastCode, order.roadmapRankIndex, settingMgr.getRealWeight(order.weight, order.size));

    let context = await OrderModel.findById(orderId);
    context = context.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'ShopMember', orderId, 'Order', 'printOrderBill');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/printOrderListBill.js

```js
import { OrderModel, ShopMemberModel, RoadmapMaskModel, ShipperModel, ShipperInBranchShopModel } from '../../../../models';
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { _T, _F, _Y, hasAuthority, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import { settingMgr } from '../../../../manager';

const ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH = '10003';
const ERROR_OTHER = '10004';
function deductAmount (order, targetId, shipperId, proxyCharge, deductAmount) {
    return new Promise(async resolve => {
        const orderId = _T(order.id);
        const amount = proxyCharge + deductAmount;
        sequelize.transaction(async (transaction) => {
            const shipperAccount = await AccountModel.findOne({ where: { targetId, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } }, transaction });
            await shipperAccount.decrement({ amount }, { transaction });
            await AccountModel.increment({ amount }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            proxyCharge > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -proxyCharge, remark: '抵押货款' }, { transaction });
            deductAmount !== 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -deductAmount, remark: deductAmount < 0 ? '收取运费' : '抵押指定收款' }, { transaction });
            const acountAmount = _Y(shipperAccount.amount - amount);

            await OrderPaymentModel.create({ orderId, isPayed: true, payedTime: new Date() }, { transaction });

            // 扣除物流公司的担保金额
            const inShop = await ShipperInBranchShopModel.findOne({ shipperId: order.shipper.id, shopId: order.shopId });
            if (!inShop || inShop.remainBondAmount < order.needBondAmount) {
                throw ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH;
            }
            inShop.remainBondAmount = inShop.remainBondAmount - order.needBondAmount;
            inShop.usedBondAmount = inShop.totalBondAmount - inShop.remainBondAmount;
            await inShop.save();

            // 扣款成功后，需要更新物流公司的账目
            const doc = await ShipperModel.findByIdAndUpdate(shipperId, { acountAmount }).catch(e => {
                throw e;
            });
            if (!doc) {
                throw ERROR_OTHER;
            }
        }).then(() => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

export default async ({
    userId, // 收货部收货员
    orderIdList,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '权限不足' };
    }
    const failedList = [];
    for (const orderId of orderIdList) {
        const order = await OrderModel.findById(orderId)
        .populate({
            path: 'shipperId',
            select: { chairManId: 1 },
        });
        if (!order) {
            failedList.push({ msg: '某些货单不存在' });
            continue;
        }
        const state = order.stateList[0].state;
        if (state !== CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER && state !== CONSTANTS.OS_READY_PRINT_ORDER) {
            failedList.push({ msg: '某些货单状态不正确' });
            continue;
        }
        // 物流公司需要抵押总部和分店的提成部分划到总部账号
        if (order.stateList[0].state === CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER) {
            const err = await deductAmount(order, _T(order.shipper.chairManId), order.shipper.id, _F(order.proxyCharge), _F(order.totalDesignatedFee - order.fee));
            if (err === ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH) {
                order.deductError = true;
                order.modifyTime = Date.now();
                await order.save();
                return { msg: '该物流公司保证金，请选择其他公司的路线' };
            } else if (err) {
                failedList.push({ msg: '物流公司扣款失败, 请选择其他路线' });
                order.deductError = true;
                order.modifyTime = Date.now();
                await order.save();
                continue;
            }
        }
        order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
        order.modifyTime = Date.now();
        await order.save();
    }

    if (failedList.length) {
        return failedList[0];
    }

    for (const orderId of orderIdList) {
        const order = await OrderModel.findById(orderId);
        order.stateList = [ { state: CONSTANTS.OS_READY_STOCK, count: order.totalNumbers } ];
        order.modifyTime = Date.now();
        await order.save();
        await RoadmapMaskModel.updateStatusList(order.shopId, order.endPointLastCode, order.roadmapRankIndex, settingMgr.getRealWeight(order.weight, order.size));
    }
    actionLogWithList(userId, 'ShopMember', orderIdList.map(o => ({ id: o, model: 'Order' })), 'printOrderListBill');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/proxyPay.js

```js
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { ShopMemberModel, OrderModel, ShipperModel, ShipperInBranchShopModel } from '../../../../models';
import { _T, _F, _Y, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

const ERROR_HAVE_PAYED = '10000';
const ERROR_PARTMENT_MONEY_NOT_ENOUGH = '10001';
const ERROR_SHIPPER_MONEY_NOT_ENOUGH = '10002';
const ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH = '10003';
const ERROR_OTHER = '10004';

function payment (order, partment, shipper) {
    return new Promise(async resolve => {
        const orderId = _T(order.id);
        sequelize.transaction(async (transaction) => {
            const orderPayment = await OrderPaymentModel.findOne({ where: { orderId, isPayed: true }, transaction });
            if (orderPayment) {
                throw ERROR_HAVE_PAYED;
            }
            // 部门的部分
            let amount = partment.transportFee + partment.insuanceFee;
            const partmentAccount = await AccountModel.findOne({ where: { targetId: partment.id, type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT, amount: { $gte: amount } }, transaction });
            if (!partmentAccount) {
                throw ERROR_PARTMENT_MONEY_NOT_ENOUGH;
            }
            await partmentAccount.decrement({ amount }, { transaction });
            // 部门需要将运费部分中总部的提成和分店的提出优先划到安全账户
            const profit = partment.transportFee > partment.transportProfit ? partment.transportProfit : partment.transportFee;
            await AccountModel.increment({ amount: partment.insuanceFee + profit }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            partment.transportFee > 0 && await BillModel.create({ account: partmentAccount.id, orderId, tradeAmount: -partment.transportFee, remark: '代支付运费' }, { transaction });
            partment.insuanceFee > 0 && await BillModel.create({ account: partmentAccount.id, orderId, tradeAmount: -partment.insuanceFee, remark: '代支付保险' }, { transaction });
            // 物流公司部分
            amount = shipper.proxyCharge + shipper.deductAmount;
            const shipperAccount = await AccountModel.findOne({ where: { targetId: shipper.id, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } } });
            if (!shipperAccount) {
                throw ERROR_SHIPPER_MONEY_NOT_ENOUGH;
            }
            const acountAmount = _Y(shipperAccount.amount - amount);
            amount !== 0 && await shipperAccount.decrement({ amount }, { transaction });
            // 如果shipper.deductAmount大于0，说明需要抵押运费，抵押在安全账户的钱为amount，如果小于0，说明是运费收益，这部分钱直接进物流公司账户，这是只抵押shipper.proxyCharge
            await AccountModel.increment({ amount: shipper.deductAmount > 0 ? amount : shipper.proxyCharge }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            shipper.proxyCharge > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -shipper.proxyCharge, remark: '抵押货款' }, { transaction });
            shipper.deductAmount !== 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -shipper.deductAmount, remark: shipper.deductAmount > 0 ? '抵押指定收款' : '收取运费' }, { transaction });

            await OrderPaymentModel.create({ orderId, isPayed: true, payedTime: new Date() }, { transaction });

            // 扣除物流公司的担保金额
            const inShop = await ShipperInBranchShopModel.findOne({ shipperId: order.shipper.id, shopId: order.shopId });
            if (!inShop || inShop.remainBondAmount < order.needBondAmount) {
                throw ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH;
            }
            inShop.remainBondAmount = inShop.remainBondAmount - order.needBondAmount;
            inShop.usedBondAmount = inShop.totalBondAmount - inShop.remainBondAmount;
            await inShop.save();

            // 扣款成功后，需要更新物流公司的账目
            const doc = await ShipperModel.findByIdAndUpdate(order.shipper.id, { acountAmount }).catch(e => {
                throw e;
            });
            if (!doc) {
                throw ERROR_OTHER;
            }
        }).then((result) => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

export default async ({
    userId,
    orderId, //为某个货单支付
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '权限不足' };
    }
    const order = await OrderModel.findById(orderId)
    .populate({
        path: 'shipperId',
        select: { chairManId: 1 },
    });
    const state = order.stateList[0].state;
    if (state !== CONSTANTS.OS_READY_PAYMENT) {
        if (state === CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER || state > CONSTANTS.OS_READY_PAYMENT) {
            return { msg: '该货单无需再支付' };
        }
        return { msg: '该货单状态不正确' };
    }
    const err = await payment(
        order,
        { id: _T(member.partmentId), transportFee: _F(order.needPayTransportFee), insuanceFee: _F(order.needPayInsuanceFee), transportProfit: _F(order.masterProfit + order.branchProfit) },
        { id: _T(order.shipper.chairManId), proxyCharge: _F(order.proxyCharge), deductAmount: _F(order.totalDesignatedFee - order.fee) },
    );
    if (err === ERROR_HAVE_PAYED) {
        order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
        order.modifyTime = Date.now();
        await order.save();
        return { msg: '该货单无需再支付' };
    } else if (err === ERROR_PARTMENT_MONEY_NOT_ENOUGH) {
        return { msg: '余额不足，请先充值' };
    } else if (err === ERROR_SHIPPER_MONEY_NOT_ENOUGH) {
        order.deductError = true;
        order.modifyTime = Date.now();
        await order.save();
        return { msg: '该物流公司余额不足，请选择其他公司的路线' };
    } else if (err === ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH) {
        order.deductError = true;
        order.modifyTime = Date.now();
        await order.save();
        return { msg: '该物流公司保证金，请选择其他公司的路线' };
    } else if (err) {
        return { msg: '系统出错，请稍后再试' };
    }

    order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
    order.modifyTime = Date.now();
    await order.save();

    let context = await OrderModel.findById(orderId);
    context = context.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'ShopMember', orderId, 'Order', 'proxyOrder');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/proxyPayForOrderList.js

```js
import { sequelize, AccountModel, BillModel, OrderPaymentModel } from '../../../../mysql';
import { ShopMemberModel, OrderModel, ShipperModel, ShipperInBranchShopModel } from '../../../../models';
import { _T, _F, _Y, hasAuthority, actionLogWithList } from '../../../../utils';
import CONSTANTS from '../../../../constants';

const ERROR_HAVE_PAYED = '10000';
const ERROR_PARTMENT_MONEY_NOT_ENOUGH = '10001';
const ERROR_SHIPPER_MONEY_NOT_ENOUGH = '10002';
const ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH = '10003';
const ERROR_OTHER = '10004';

function payment (order, partment, shipper) {
    return new Promise(async resolve => {
        const orderId = _T(order.id);
        sequelize.transaction(async (transaction) => {
            const orderPayment = await OrderPaymentModel.findOne({ where: { orderId, isPayed: true }, transaction });
            if (orderPayment) {
                throw ERROR_HAVE_PAYED;
            }
            // 部门的部分
            let amount = partment.transportFee + partment.insuanceFee;
            const partmentAccount = await AccountModel.findOne({ where: { targetId: partment.id, type: CONSTANTS.AT_BRANCH_SHOP_PARTMENT, amount: { $gte: amount } }, transaction });
            if (!partmentAccount) {
                throw ERROR_PARTMENT_MONEY_NOT_ENOUGH;
            }
            await partmentAccount.decrement({ amount }, { transaction });
            // 部门需要将运费部分中总部的提成和分店的提出优先划到安全账户
            const profit = partment.transportFee > partment.transportProfit ? partment.transportProfit : partment.transportFee;
            await AccountModel.increment({ amount: partment.insuanceFee + profit }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            partment.transportFee > 0 && await BillModel.create({ account: partmentAccount.id, orderId, tradeAmount: -partment.transportFee, remark: '代支付运费' }, { transaction });
            partment.insuanceFee > 0 && await BillModel.create({ account: partmentAccount.id, orderId, tradeAmount: -partment.insuanceFee, remark: '代支付保险' }, { transaction });
            // 物流公司部分
            amount = shipper.proxyCharge + shipper.deductAmount;
            const shipperAccount = await AccountModel.findOne({ where: { targetId: shipper.id, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } } });
            if (!shipperAccount) {
                throw ERROR_SHIPPER_MONEY_NOT_ENOUGH;
            }
            const acountAmount = _Y(shipperAccount.amount - amount);
            amount !== 0 && await shipperAccount.decrement({ amount }, { transaction });
            // 如果shipper.deductAmount大于0，说明需要抵押运费，抵押在安全账户的钱为amount，如果小于0，说明是运费收益，这部分钱直接进物流公司账户，这是只抵押shipper.proxyCharge
            await AccountModel.increment({ amount: shipper.deductAmount > 0 ? amount : shipper.proxyCharge }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            shipper.proxyCharge > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -shipper.proxyCharge, remark: '抵押货款' }, { transaction });
            shipper.deductAmount !== 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -shipper.deductAmount, remark: shipper.deductAmount > 0 ? '抵押指定收款' : '收取运费' }, { transaction });

            await OrderPaymentModel.create({ orderId, isPayed: true, payedTime: new Date() }, { transaction });

            // 扣除物流公司的担保金额
            const inShop = await ShipperInBranchShopModel.findOne({ shipperId: order.shipper.id, shopId: order.shopId });
            if (!inShop || inShop.remainBondAmount < order.needBondAmount) {
                throw ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH;
            }
            inShop.remainBondAmount = inShop.remainBondAmount - order.needBondAmount;
            inShop.usedBondAmount = inShop.totalBondAmount - inShop.remainBondAmount;
            await inShop.save();

            // 扣款成功后，需要更新物流公司的账目
            const doc = await ShipperModel.findByIdAndUpdate(order.shipper.id, { acountAmount }).catch(e => {
                throw e;
            });
            if (!doc) {
                throw ERROR_OTHER;
            }
        }).then((result) => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

function deductAmount (order, targetId, shipperId, proxyCharge, deductAmount) {
    return new Promise(async resolve => {
        const orderId = _T(order.id);
        const amount = proxyCharge + deductAmount;
        sequelize.transaction(async (transaction) => {
            const shipperAccount = await AccountModel.findOne({ where: { targetId, type: CONSTANTS.AT_CLIENT, amount: { $gte: amount } }, transaction });
            await shipperAccount.decrement({ amount }, { transaction });
            await AccountModel.increment({ amount }, { where: { id: CONSTANTS.AC_SECURITY_ACCOUNT }, transaction });
            proxyCharge > 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -proxyCharge, remark: '抵押货款' }, { transaction });
            deductAmount !== 0 && await BillModel.create({ account: shipperAccount.id, orderId, tradeAmount: -deductAmount, remark: deductAmount < 0 ? '收取运费' : '抵押指定收款' }, { transaction });
            const acountAmount = _Y(shipperAccount.amount - amount);

            await OrderPaymentModel.create({ orderId, isPayed: true, payedTime: new Date() }, { transaction });

            // 扣除物流公司的担保金额
            const inShop = await ShipperInBranchShopModel.findOne({ shipperId: order.shipper.id, shopId: order.shopId });
            if (!inShop || inShop.remainBondAmount < order.needBondAmount) {
                throw ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH;
            }
            inShop.remainBondAmount = inShop.remainBondAmount - order.needBondAmount;
            inShop.usedBondAmount = inShop.totalBondAmount - inShop.remainBondAmount;
            await inShop.save();

            // 扣款成功后，需要更新物流公司的账目
            const doc = await ShipperModel.findByIdAndUpdate(shipperId, { acountAmount }).catch(e => {
                throw e;
            });
            if (!doc) {
                throw ERROR_OTHER;
            }
        }).then(() => {
            return resolve();
        }).catch(err => {
            console.log('[transaction]:', err);
            return resolve(err);
        });
    });
}

export default async ({
    userId,
    orderIdList,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '权限不足' };
    }
    const failedList = [];
    for (const orderId of orderIdList) {
        const order = await OrderModel.findById(orderId)
        .populate({
            path: 'shipperId',
            select: { chairManId: 1 },
        });
        if (!order) {
            failedList.push({ msg: '某些货单不存在' });
            continue;
        }
        if (order.stateList[0].state === CONSTANTS.OS_READY_PAYMENT) {
            const err = await payment(
                order,
                { id: _T(member.partmentId), transportFee: _F(order.needPayTransportFee), insuanceFee: _F(order.needPayInsuanceFee), transportProfit: _F(order.masterProfit + order.branchProfit) },
                { id: _T(order.shipper.chairManId), proxyCharge: _F(order.proxyCharge), deductAmount: _F(order.totalDesignatedFee - order.fee) },
            );
            if (err === ERROR_HAVE_PAYED) {
                order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
                order.modifyTime = Date.now();
                await order.save();
                continue;
            } else if (err === ERROR_PARTMENT_MONEY_NOT_ENOUGH) {
                return { msg: '余额不足，部分货单未完成支付，请先充值' };
            } else if (err === ERROR_SHIPPER_MONEY_NOT_ENOUGH) {
                order.deductError = true;
                order.modifyTime = Date.now();
                await order.save();
                failedList.push({ msg: '物流公司余额不足, 部分货单未完成支付' });
                continue;
            } else if (err === ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH) {
                order.deductError = true;
                order.modifyTime = Date.now();
                await order.save();
                failedList.push({ msg: '该物流公司保证金, 部分货单未完成支付' });
            } else if (err) {
                failedList.push({ msg: '系统出错, 部分货单未完成支付' });
                continue;
            }
        } else if (order.stateList[0].state === CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER) {
            const err = await deductAmount(order, _T(order.shipper.chairManId), order.shipper.id, _F(order.proxyCharge), _F(order.totalDesignatedFee - order.fee));
            if (err === ERROR_SHIPPER_BOND_AMOUNT_NOT_ENOUGH) {
                order.deductError = true;
                order.modifyTime = Date.now();
                await order.save();
                failedList.push({ msg: '该物流公司保证金, 部分货单未完成支付' });
            } else if (err) {
                order.deductError = true;
                order.modifyTime = Date.now();
                await order.save();
                failedList.push({ msg: '部分货单未扣款失败' });
                continue;
            }
        }
        order.stateList = [ { state: CONSTANTS.OS_READY_PRINT_ORDER, count: order.totalNumbers } ];
        order.modifyTime = Date.now();
        await order.save();
    }

    actionLogWithList(userId, 'ShopMember', orderIdList.map(o => ({ id: o, model: 'Order' })), 'proxyOrderForOrderList');

    if (failedList.length) {
        return failedList[0];
    }

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/removeOrder.js

```js
import { OrderModel, ShopMemberModel, MediaModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderId,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '你没有删除货单的权限' };
    }
    const order = await OrderModel.findByIdAndRemove(orderId);
    if (order && order.photo) {
        MediaModel._updateRef(
            { [ order.photo ]: -1 },
        );
    }

    actionLog(userId, 'ShopMember', orderId, 'Order', 'removeOrder');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/selectRoadmap.js

```js
import { OrderModel, ShopMemberModel, RoadmapModel, ShipperInBranchShopModel, WarehouseModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import { getRegionProfitRateByEndPoint } from '../../libs/roadmap';
import CONSTANTS from '../../../../constants';
import { setting, settingMgr } from '../../../../manager';
import _ from 'lodash';

export default async ({
    userId,
    orderId,
    roadmapId,
    roadmapRankIndex, //路线的排名
}) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { profitRate: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '权限不足' };
    }
    const order = await OrderModel.findById(orderId);
    if (!order) {
        return { msg: '没有该货单' };
    }
    if (order.stateList[0].state !== CONSTANTS.OS_READY_SELECT_ROADMAP) {
        return { msg: '该货单状态不正确' };
    }
    const roadmap = await RoadmapModel.findById(roadmapId)
    .populate({
        path: 'shipperId',
        select: { acountAmount: 1, chairManId: 1, name: 1 },
    });
    if (!roadmap) {
        return { msg: '没有该路线' };
    }
    if (!roadmap.enable) {
        return { msg: '该路线停运中' };
    }
    const inShop = await ShipperInBranchShopModel.findById(roadmap.shipperInBranchShopId);
    if (!inShop) {
        return { msg: '该路线无效' };
    }
    const needBondAmount = settingMgr.getBondAmount(order.weight, order.size);
    if (inShop.remainBondAmount < needBondAmount) {
        return { msg: '该路线的保证金不足' };
    }
    const weight = settingMgr.getFloatWeight(order.weight, order.size);
    const regionProfitRate = !_.isNil(roadmap.profitRate) ? roadmap.profitRate : await getRegionProfitRateByEndPoint(roadmap.shopId, roadmap.endPointLastCode, roadmap.isCityDistribute);
    const sendDoor = order.isSendDoor && _.find(roadmap.sendDoorList, o => o.sendDoorEndPointLastCode === order.sendDoorEndPointLastCode);
    const warehouseList = await WarehouseModel.find({ shopId: roadmap.shopId, shipperList: roadmap.shipper.id });

    order.warehouse = warehouseList.length ? _.map(warehouseList, o => o.houseNo).join(';') : roadmap.shipper.name;
    order.price = roadmap.price * (regionProfitRate + 1);
    order.minFee = roadmap.minFee * (regionProfitRate + 1);
    order.sendDoorPrice = order.isSendDoor ? sendDoor.sendDoorPrice * (regionProfitRate + 1) : 0;
    order.sendDoorMinFee = order.isSendDoor ? sendDoor.sendDoorMinFee * (regionProfitRate + 1) : 0;
    order.needBondAmount = needBondAmount;
    order.roadmapId = roadmapId;
    order.roadmapRankIndex = roadmapRankIndex;
    order.shipperId = roadmap.shipper.id;
    order.shipperChairManId = roadmap.shipper.chairManId;
    order.fee = Math.floor(Math.max(roadmap.price * weight, roadmap.minFee) + (order.isSendDoor ? Math.max(sendDoor.sendDoorPrice * weight, sendDoor.sendDoorMinFee) : 0)); // 起价
    order.profit = Math.floor(order.fee * regionProfitRate);
    order.branchProfit = Math.floor(order.profit * member.shop.profitRate);
    order.masterProfit = order.profit - order.branchProfit;
    order.realFee = order.profit + order.fee; // 实际运费.
    if (order.payMode !== CONSTANTS.PM_IMMEDIATE && !order.totalDesignatedFee) {
        order.totalDesignatedFee = order.realFee;
    }
    const needDeductAmount = order.proxyCharge + (order.payMode !== CONSTANTS.PM_IMMEDIATE ? order.totalDesignatedFee - order.fee : 0);
    if (roadmap.shipper.acountAmount < needDeductAmount) {
        return { msg: '该物流公司资金不足' };
    }
    order.needPayTransportFee = 0;
    if (order.payMode !== CONSTANTS.PM_IMMEDIATE) { // 到付或者混合支付
        const senderProfit = order.totalDesignatedFee - order.realFee; // 发货人收益
        order.designatedFee = Math.max(senderProfit, 0);
        if (senderProfit < 0) {
            order.needPayTransportFee = -senderProfit; // 发货人需要现付的部分
        }
    } else { // 现付
        order.needPayTransportFee = order.realFee;
    }
    // 保险费
    if (order.isInsuance) {
        order.insuanceMount = order.realFee * setting.insuanceMountRate;
        order.insuanceFee = order.insuanceMount * setting.insuanceRate;
        if (order.insuanceFee < setting.insuanceBaseValue) { // 如果保险
            order.insuanceFee = setting.insuanceBaseValue;
        }
        order.insuanceFee = Math.floor(order.insuanceFee);
        order.insuanceMount = Math.floor(order.insuanceFee / setting.insuanceRate);
    } else {
        order.insuanceMount = 0;
        order.insuanceFee = 0;
    }

    order.needPayInsuanceFee = 0;
    if (order.insuanceFee > 0) { // 只有初始单才需要交保险(但是如果是收货点的单，需要交纳保险费，因为他收取了用户的保险费)
        if (!order.isTransferOrder) {
            order.needPayInsuanceFee = order.insuanceFee;
        } else {
            const preOrder = await OrderModel.findById(order.preOrderId);
            if (preOrder && preOrder.agentId) {
                order.needPayInsuanceFee = order.insuanceFee;
            }
        }
    }
    if (order.needPayTransportFee > 0 && order.totalDesignatedFee > 0) {
        order.payMode = CONSTANTS.PM_MIXED;
    }
    if (order.needPayTransportFee + order.needPayInsuanceFee) { // 需要交费的情况进入待支付状态，否则到付的情况下进入待入库状态，并且划账对接
        order.stateList = [ { state: CONSTANTS.OS_READY_PAYMENT, count: order.totalNumbers } ];
    } else {
        order.stateList = [ { state: CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER, count: order.totalNumbers } ];
    }
    order.deductError = false;
    order.modifyTime = Date.now();
    await order.save();

    let context = await OrderModel.findById(orderId);
    context = context.toObject();
    context.state = context.stateList[0].state;

    actionLog(userId, 'ShopMember', orderId, 'Order', 'selectRoadmap');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/selectRoadmapForOrderList.js

```js
import { OrderModel, ShopMemberModel, RoadmapModel, WarehouseModel } from '../../../../models';
import { hasAuthority, actionLogWithList } from '../../../../utils';
import { searchRoadmapListByReceivePartment, getRegionProfitRateByEndPoint } from '../../libs/roadmap';
import CONSTANTS from '../../../../constants';
import { setting, settingMgr } from '../../../../manager';
import _ from 'lodash';

export default async ({
    userId,
    orderIdList,
}) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { profitRate: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '权限不足' };
    }

    const failedList = [];
    for (const orderId of orderIdList) {
        const order = await OrderModel.findById(orderId);
        if (!order) {
            failedList.push({ msg: '某些货单不存在' });
            continue;
        }
        if (order.stateList[0].state !== CONSTANTS.OS_READY_SELECT_ROADMAP) {
            return { msg: '该货单状态不正确' };
        }
        let {
            endPointLastCode, // 终点
            sendDoorEndPointLastCode, // 送货上门终点
            isSendDoor, // 是否送货上门
            weight, // 重量
            size, // 方量
            proxyCharge, // 代收货款金额
            isCityDistribute, // 是否是同城配送
            isReachPay, // 是否是到付
            totalDesignatedFee, //指定向收货人应该收多少钱
        } = order;
        const regionProfitRate = await getRegionProfitRateByEndPoint(member.shop.id, endPointLastCode, isCityDistribute);
        const { roadmapList } = await searchRoadmapListByReceivePartment({
            shopId: member.shop.id,
            pageNo: 0,
            pageSize: 1,
            endPointLastCode,
            sendDoorEndPointLastCode,
            isSendDoor,
            weight,
            size,
            proxyCharge,
            isReachPay,
            totalDesignatedFee,
            orderBy: 0,
            regionProfitRate,
        });

        if (!roadmapList || !roadmapList.length) {
            failedList.push({ msg: '某些货单没有找到适合的路线' });
            continue;
        }

        const roadmap = await RoadmapModel.findById(roadmapList[0].id)
        .populate({
            path: 'shipperId',
            select: { acountAmount: 1, chairManId: 1, name: 1 },
        });
        weight = settingMgr.getFloatWeight(order.weight, order.size);
        const sendDoor = order.isSendDoor && _.find(roadmap.sendDoorList, o => o.sendDoorEndPointLastCode === order.sendDoorEndPointLastCode);
        const profitRate = !_.isNil(roadmap.profitRate) ? roadmap.profitRate : regionProfitRate;
        const warehouseList = await WarehouseModel.find({ shopId: roadmap.shopId, shipperList: roadmap.shipper.id });
        order.warehouse = warehouseList.length ? _.map(warehouseList, o => o.houseNo).join(';') : roadmap.shipper.name;
        order.price = roadmap.price * (profitRate + 1);
        order.minFee = roadmap.minFee * (profitRate + 1);
        order.sendDoorPrice = order.isSendDoor ? sendDoor.sendDoorPrice * (profitRate + 1) : 0;
        order.sendDoorMinFee = order.isSendDoor ? sendDoor.sendDoorMinFee * (profitRate + 1) : 0;
        order.needBondAmount = roadmapList[0].needBondAmount;
        order.roadmapId = roadmap.id;
        order.roadmapRankIndex = roadmapList[0].roadmapRankIndex;
        order.shipperId = roadmap.shipper.id;
        order.shipperChairManId = roadmap.shipper.chairManId;
        order.fee = Math.floor(Math.max(roadmap.price * weight, roadmap.minFee) + (order.isSendDoor ? Math.max(sendDoor.sendDoorPrice * weight, sendDoor.sendDoorMinFee) : 0)); // 起价
        order.profit = Math.floor(order.fee * profitRate);
        order.branchProfit = Math.floor(order.profit * member.shop.profitRate);
        order.masterProfit = order.profit - order.branchProfit;
        order.realFee = order.profit + order.fee; // 实际运费.
        if (order.payMode !== CONSTANTS.PM_IMMEDIATE && !order.totalDesignatedFee) {
            order.totalDesignatedFee = order.realFee;
        }
        order.needPayTransportFee = 0;
        if (order.payMode !== CONSTANTS.PM_IMMEDIATE) { // 到付或者混合支付
            const senderProfit = order.totalDesignatedFee - order.realFee; // 发货人收益
            order.designatedFee = Math.max(senderProfit, 0);
            if (senderProfit < 0) {
                order.needPayTransportFee = -senderProfit; // 发货人需要现付的部分
            }
        } else { // 现付
            order.needPayTransportFee = order.realFee;
        }
        // 保险费
        if (order.isInsuance) {
            order.insuanceMount = order.realFee * setting.insuanceMountRate;
            order.insuanceFee = order.insuanceMount * setting.insuanceRate;
            if (order.insuanceFee < setting.insuanceBaseValue) { // 如果保险
                order.insuanceFee = setting.insuanceBaseValue;
            }
            order.insuanceFee = Math.floor(order.insuanceFee);
            order.insuanceMount = Math.floor(order.insuanceFee / setting.insuanceRate);
        } else {
            order.insuanceMount = 0;
            order.insuanceFee = 0;
        }

        order.needPayInsuanceFee = 0;
        if (order.insuanceFee > 0) { // 只有初始单才需要交保险(但是如果是收货点的单，需要交纳保险费，因为他收取了用户的保险费)
            if (!order.isTransferOrder) {
                order.needPayInsuanceFee = order.insuanceFee;
            } else {
                const preOrder = await OrderModel.findById(order.preOrderId);
                if (preOrder && preOrder.agentId) {
                    order.needPayInsuanceFee = order.insuanceFee;
                }
            }
        }
        if (order.needPayTransportFee > 0 && order.totalDesignatedFee > 0) {
            order.payMode = CONSTANTS.PM_MIXED;
        }
        if (order.needPayTransportFee + order.needPayInsuanceFee) { // 需要交费的情况进入待支付状态，否则到付的情况下进入待入库状态，并且划账对接
            order.stateList = [ { state: CONSTANTS.OS_READY_PAYMENT, count: order.totalNumbers } ];
        } else {
            order.stateList = [ { state: CONSTANTS.OS_READY_DEDUCT_AND_PRINT_ORDER, count: order.totalNumbers } ];
        }
        order.deductError = false;
        order.modifyTime = Date.now();
        await order.save();
    }

    actionLogWithList(userId, 'ShopMember', orderIdList.map(o => ({ id: o, model: 'Order' })), 'selectRoadmapForOrderList');

    if (failedList.length) {
        return failedList[0];
    }

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/receivePartment/setPhotoForOriginOrder.js

```js
import { ShopMemberModel, OrderModel, MediaModel } from '../../../../models';
import { getMediaId, hasAuthority, actionLog } from '../../../../utils';
import { getRPLatestOrder } from '../../libs/order';
import CONSTANTS from '../../../../constants';

export default async ({
    userId, // 收货部收货员
    orderId,
    photo,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_RECEIVE_PARTMENT)) {
        return { msg: '你没有收货的权限' };
    }
    let order;
    const _photo = getMediaId(photo);
    if (orderId) {
        order = await OrderModel.findById(orderId);
    } else {
        order = await getRPLatestOrder(userId);
    }
    if (!order) {
        return { msg: '没有该货单' };
    }
    const __photo = order.photo;
    order.photo = _photo;
    order.modifyTime = Date.now();
    await order.save();

    MediaModel._updateRef(
        { [_photo]: 1 },
        { [photo && __photo]: -1 },
    );
    actionLog(userId, 'ShopMember', orderId, 'Order', 'setPhotoForOriginOrder');

    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/shop/getOwnShopDetail.js

```js
import { ShopModel, ShopMemberModel } from '../../../../models';

export default async ({ userId }) => {
    const user = await ShopMemberModel.findById(userId);
    if (!user) {
        return { msg: '没有该用户' };
    }
    const shop = await ShopModel.findById(user.shopId)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });
    if (!shop) {
        return { msg: '没有该物流超市' };
    }
    return { success: true, context: shop };
};

```

* PDShopServer/project/App/routers/posts/shop/shop/modifyOwnShop.js

```js
import { ShopModel, ShopMemberModel, MediaModel } from '../../../../models';
import { getMediaId, omitNil, hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    name, // 物流超市名称
    image, // 物流超市背景图片
    sign, // 物流超市签名
    phoneList, // 物流超市联系电话
    address, // 商铺地址
    location, // // 经纬度定位
}) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1 },
    });
    if (!hasAuthority(member, CONSTANTS.AH_MODIFY_OWN_SHOP)) {
        return { msg: `你没有权限修改${member.shop.isMasterShop ? '四面通总部' : '物流超市'}信息` };
    }

    let _image = getMediaId(image);
    const doc = await ShopModel.findByIdAndUpdate(member.shop.id, omitNil({
        name,
        image: _image,
        sign,
        phoneList,
        address,
        location,
    }));
    if (!doc) {
        return { msg: '修改失败' };
    }
    MediaModel._updateRef(
        { [_image]: 1 },
        { [image && doc.image]: -1 },
    );

    const context = await ShopModel.findById(member.shop.id)
    .populate({
        path: 'chairManId',
        select: { name: 1, phone: 1 },
    });

    actionLog(userId, 'ShopMember', member.shop.id, 'Shop', 'modifyOwnShop');

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/statistics/getStatistics.js

```js
import { OrderModel, ShopMemberModel } from '../../../../models';
import CONSTANTS from '../../../../constants';
import { hasAuthority } from '../../../../utils';
import mongoose from 'mongoose';
import moment from 'moment';
import _ from 'lodash';
const MAX_DAYS = 30;

export default async ({ userId, shopId, days = 7 }) => {
    const member = await ShopMemberModel.findById(userId)
    .populate({
        path: 'shopId',
        select: { isMasterShop: 1 },
    });
    if (member.partmentId || !hasAuthority(member, CONSTANTS.AH_LOOK_STATISTICS)) {
        return { msg: '你没有查看统计的权限' };
    }
    if (!member.shop.isMasterShop) {
        shopId = member.shop.id;
    }

    days = (days > MAX_DAYS ? MAX_DAYS : days < 1 ? 1 : days) + 1;
    const now = moment().startOf('d').add(1, 'd');
    const timeList = _.map(_.rangeRight(-days), o => now.clone().add(o, 'd'));
    const getCond = (name, value) => _.dropRight(_.map(timeList, (o, k) => timeList[k + 1] && { [name + k]: { $sum: { $cond: { if: { $and: [{ $gte: ['$placeOrderTime', o.toDate()] }, { $lt: ['$placeOrderTime', timeList[k + 1].toDate()] }] }, then: value, else: 0 } } } }));

    const cond = [
        ...getCond('count', 1),
        ...getCond('isReachPay', '$isReachPay'),
        ...getCond('isInsuance', '$isInsuance'),
        ...getCond('insuanceMount', '$insuanceMount'),
        ...getCond('insuanceFee', '$insuanceFee'),
        ...getCond('realFee', '$realFee'),
        ...getCond('totalDesignatedFee', '$totalDesignatedFee'),
        ...getCond('proxyCharge', '$proxyCharge'),
        ...getCond('masterProfit', '$masterProfit'),
        ...getCond('branchProfit', '$branchProfit'),
        ...getCond('weight', '$weight'),
        ...getCond('size', '$size'),
    ];

    const daysInfo = await OrderModel.aggregate()
    .match({
        ...(shopId ? { shopId: new mongoose.Types.ObjectId(shopId) } : {}),
        placeOrderTime: { $gt: timeList[0].toDate() },
        'stateList.0.state': { $gte: CONSTANTS.OS_READY_STOCK },
    })
    .project({
        placeOrderTime: 1,
        isReachPay: { $cond: { if: '$isReachPay', then: 1, else: 0 } },
        isInsuance: { $cond: { if: '$isInsuance', then: 1, else: 0 } },
        insuanceMount: 1,
        insuanceFee: 1,
        realFee: 1,
        totalDesignatedFee: 1,
        proxyCharge: 1,
        masterProfit: 1,
        branchProfit: 1,
        weight: 1,
        size: 1,
    })
    .group({
        _id: null,
        ..._.reduce(cond, (r, o) => Object.assign(r, o)),
    });

    daysInfo[0] && (delete daysInfo[0]._id);
    const context = _.transform(daysInfo[0], (r, v, k) => {
        const key = k.replace(/\d+/, '');
        r[key] || (r[key] = []);
        r[key].push(v);
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/warehouse/createWarehouse.js

```js
import { WarehouseModel, ShopMemberModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    shipperList,
    houseManId,
    houseNo,
    maxStoreWeight,
    maxStoreSize,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_CREATE_WAREHOUSE)) {
        return { msg: '你没有创建仓库的权限' };
    }

    let warehouse = await WarehouseModel.findOne({ shopId: member.shopId, houseNo });
    if (warehouse) {
        return { msg: '该仓库号已经存在' };
    }
    warehouse = new WarehouseModel({
        shopId: member.shopId,
        shipperList,
        houseManId,
        houseNo,
        maxStoreWeight,
        maxStoreSize,
    });
    await warehouse.save();

    actionLog(userId, 'ShopMember', warehouse.id, 'Warehouse', 'createWarehouse');

    const context = await WarehouseModel.findById(warehouse.id)
    .select({
        houseManId: 1,
        houseNo: 1,
        maxStoreWeight: 1,
        maxStoreSize: 1,
        orderCount: 1,
        totalNumbers: 1,
        totalWeight: 1,
        totalSize: 1,
        shipperList: 1,
    }).populate({
        path: 'houseManId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperList',
        select: { name: 1 },
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/warehouse/getWarehouseDetail.js

```js
import { WarehouseModel } from '../../../../models';

export default async ({
    userId,
    warehouseId,
}) => {
    const doc = await WarehouseModel.findById(warehouseId)
    .populate({
        path: 'houseManId',
        select: { name: 1, phone: 1 },
    })
    .populate({
        path: 'shipperList',
        select: { name: 1 },
    });
    if (!doc) {
        return { msg: '没有该仓库' };
    }

    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/warehouse/getWarehouseList.js

```js
import { WarehouseModel } from '../../../../models';
import { getKeywordCriteriaForWarehouse, getOwnShop } from '../../../../utils';

export default async ({ userId, keyword, fromPC, pageNo, pageSize }) => {
    const shopId = await getOwnShop(userId);
    const criteria = getKeywordCriteriaForWarehouse(keyword, { shopId });
    const count = (fromPC && pageNo === 0) ? await WarehouseModel.count(criteria) : undefined;
    const query = WarehouseModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        houseManId: 1,
        houseNo: 1,
        maxStoreWeight: 1,
        maxStoreSize: 1,
        orderCount: 1,
        totalNumbers: 1,
        totalWeight: 1,
        totalSize: 1,
        shipperList: 1,
    })
    .populate({
        path: 'houseManId',
        select: { name: 1, phone: 1 },
    })
    .populate({
        path: 'shipperList',
        select: { name: 1 },
    });

    return { success: true, context: {
        count,
        warehouseList: docs,
    } };
};

```

* PDShopServer/project/App/routers/posts/shop/warehouse/modifyWarehouse.js

```js
import { WarehouseModel } from '../../../../models';
import { omitNil, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    warehouseId,
    shipperList,
    houseManId,
    houseNo,
    maxStoreWeight,
    maxStoreSize,
}) => {
    if (!await hasAuthority(userId, CONSTANTS.AH_MODIFY_WAREHOUSE)) {
        return { msg: '你没有修改仓库的权限' };
    }

    const doc = await WarehouseModel.findByIdAndUpdate(warehouseId, omitNil({
        shipperList,
        houseManId,
        houseNo,
        maxStoreWeight,
        maxStoreSize,
        modifyTime: Date.now(),
    }), { new: true }).select({
        houseManId: 1,
        houseNo: 1,
        maxStoreWeight: 1,
        maxStoreSize: 1,
        orderCount: 1,
        totalNumbers: 1,
        totalWeight: 1,
        totalSize: 1,
        shipperList: 1,
    }).populate({
        path: 'houseManId',
        select: { name: 1, phone: 1 },
    })
    .populate({
        path: 'shipperList',
        select: { name: 1 },
    });
    if (!doc) {
        return { msg: '修改失败' };
    }

    actionLog(userId, 'ShopMember', warehouseId, 'Warehouse', 'modifyWarehouse');

    return { success: true, context: doc };
};

```

* PDShopServer/project/App/routers/posts/shop/warehouse/removeWarehouse.js

```js
import { WarehouseModel, ShopMemberModel } from '../../../../models';
import { authenticatePassword, hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    warehouseId,
    password,
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_REMOVE_WAREHOUSE)) {
        return { msg: '你没有删除仓库的权限' };
    }
    const error = await authenticatePassword(member, password);
    if (error) {
        return { msg: '密码错误' };
    }
    await WarehouseModel.findByIdAndRemove(warehouseId);

    actionLog(userId, 'ShopMember', warehouseId, 'Warehouse', 'removeWarehouse');
    return { success: true };
};

```

* PDShopServer/project/App/routers/posts/shop/warehousePartment/getLoadingOrderList.js

```js
import { ShopMemberModel, TruckModel } from '../../../../models';
import CONSTANTS from '../../../../constants';
import _ from 'lodash';

export default async ({ userId }) => {
    const member = await ShopMemberModel.findById(userId);
    const truck = await TruckModel.findOne({
        carryPartmentId: member.partmentId,
        state: { $in: [ CONSTANTS.TS_SCAN_LOADING, CONSTANTS.TS_READY_PAY_FOR_CARRY_PARTMENT ] },
    })
    .populate({
        path: 'unloadAllOrderList',
        select: {
            endPoint: 1,
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            stateList: 1,
            totalNumbers: 1,
        },
    })
    .populate({
        path: 'orderList',
        select: {
            createTime: 1,
            photo: 1,
            endPoint: 1,
            senderPhone: 1,
            senderName: 1,
            receiverPhone: 1,
            receiverName: 1,
            totalNumbers: 1,
            size: 1,
            weight: 1,
        },
    });
    if (!truck) {
        return { msg: '目前没有正在装车的货车' };
    }
    const context = truck.toObject();
    _.forEach(context.unloadAllOrderList, item => {
        item.unloadNumber = (_.find(item.stateList, o => o.state === CONSTANTS.OS_READY_LOAD) || {}).count || 0;
        delete item.stateList;
    });

    return { success: true, context };
};

```

* PDShopServer/project/App/routers/posts/shop/warehousePartment/getOrders.js

```js
import _ from 'lodash';
import { OrderModel } from '../../../../models';
import { getKeywordCriteriaForOrder } from '../../../../utils';
import CONSTANTS from '../../../../constants';
import moment from 'moment';

async function getPageData (userId, type, params) {
    let { keyword, startDate, endDate, fromPC, pageNo, pageSize } = params;
    let criteria = getKeywordCriteriaForOrder(keyword, {
        storeScannerId: userId,
    });
    if (type === 'stored') {
        criteria = { ...criteria, 'stateList.state': CONSTANTS.OS_READY_LOAD };
    } else if (type === 'loaded') {
        criteria = { ...criteria, 'stateList.state': { $gte: CONSTANTS.OS_READY_START_OFF } };
    }
    if (fromPC) {
        if (startDate && endDate) {
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        } else {
            startDate = endDate = moment().format('YYYY-MM-DD');
            criteria = { ...criteria, $and: [{ placeOrderTime: { $gte: moment(startDate).toDate() } }, { placeOrderTime: { $lt: moment(endDate).add(1, 'd').toDate() } }] };
        }
    }
    const count = (fromPC && pageNo === 0) ? await OrderModel.count(criteria) : undefined;
    const query = OrderModel.find(criteria).sort({ createTime: 'desc' }).skip(pageNo * pageSize).limit(pageSize);
    const docs = await query
    .select({
        shopId: 1,
        shipperId: 1,
        senderPhone: 1,
        senderName: 1,
        receiverPhone: 1,
        receiverName: 1,
        endPoint: 1,
        sendDoorEndPoint: 1,
        isSendDoor: 1,
        createTime: 1,
        placeOrderTime: 1,
        modifyTime: 1,
        payMode: 1,
        receiveMemberId: 1,
        totalNumbers: 1,
        weight: 1,
        size: 1,
        photo: 1,
        warehouse: 1,
        stateList: 1,
        needPayTransportFee: 1,
        needPayInsuanceFee: 1,
    }).populate({
        path: 'receiveMemberId',
        select: { name: 1, phone: 1 },
    }).populate({
        path: 'shipperId',
        select: { name: 1 },
    }).populate({
        path: 'shopId',
        select: { name: 1, address: 1 },
    });

    return {
        count,
        list: docs,
    };
};

// ['待入库', '已入库']
const TYPES = ['stored', 'loaded'];
export default async ({ userId, type, ...params }) => {
    if (_.includes(TYPES, type)) {
        return {
            success: true,
            context: {
                [type]: await getPageData(userId, type, params),
            },
        };
    } else {
        return {
            success: true,
            context: {
                stored: await getPageData(userId, 'stored', params),
                loaded: await getPageData(userId, 'loaded', params),
            },
        };
    }
};

```

* PDShopServer/project/App/routers/posts/shop/warehousePartment/placeStorage.js

```js
import _ from 'lodash';
import { ShopMemberModel, OrderModel, WarehouseModel } from '../../../../models';
import { hasAuthority, actionLog } from '../../../../utils';
import CONSTANTS from '../../../../constants';

export default async ({
    userId,
    orderId,
    count = 1,
    force, //强制入库
}) => {
    const member = await ShopMemberModel.findById(userId);
    if (!hasAuthority(member, CONSTANTS.AH_WARE_HOUSE_PARTMENT)) {
        return { msg: '权限不足' };
    }
    const order = await OrderModel.getOrderFromOriginOrder(member.shopId, orderId);
    if (!order) {
        return { msg: '没有该货单' };
    }
    if (!force) {
        if (!order.warehouse) {
            return { msg: '该货单没有分配仓库，请谨慎入库', retry: true };
        }
        const warehouseNoList = order.warehouse.split(';');
        const warehouse = await WarehouseModel.findOne({ shopId: member.shopId, houseNo: { $in: warehouseNoList }, houseManId: userId });
        if (!warehouse) {
            return { msg: '你不是该货单分配库管员，请谨慎入库', retry: true };
        }
    }

    const stateList = order.stateList;
    let item = _.find(stateList, (o) => o.state === CONSTANTS.OS_READY_STOCK);
    if (!item) {
        return { msg: '该货单没有待入库的货物' };
    }
    item.count -= count;
    if (item.count < 0) {
        return { msg: '数量无效' };
    }
    item = _.find(stateList, (o) => o.state === CONSTANTS.OS_READY_LOAD);
    if (item) {
        item.count += count;
    } else {
        stateList.unshift({ state: CONSTANTS.OS_READY_LOAD, count });
    }
    order.stateList = _.filter(stateList, o => o.count > 0);
    order.storeScannerId = userId;
    order.placeStoreTime = Date.now();
    await order.save();

    actionLog(userId, 'ShopMember', orderId, 'Order', 'placeStorage');

    return { success: true, order };
};

```

* PDShopServer/project/App/routers/posts/shop/weixinPay/getUnifiedOrder.js

```js
import { ShopMemberModel, WeixinPayModel } from '../../../../models';
import { _F, _T, hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
import api from '../../libs/weixinPay/api';
import config from '../../../../../config';
import { rechargeForShopMember } from '../../libs/account';

export default async ({
    userId,
    amount, // 单位：元
    body, //商品描述
}, req) => {
    amount = _F(amount);
    if (config.hasNoRealPayment) {
        return rechargeForShopMember({ userId, amount, thirdpartyAccount: 'SIMULATION_NO' });
    }
    amount = amount / config.weixinPayRate;
    if (amount < 1) {
        return { msg: '充值金额必须大于' + config.weixinPayRate / 100 };
    }
    return new Promise(async resolve => {
        const member = await ShopMemberModel.findById(userId);
        if (!hasAuthority(member, CONSTANTS.AH_RECHARGE) || !member.partmentId) {
            return resolve({ msg: '你没有充值的权限' });
        }

        const spbill_create_ip = req.get('X-Real-IP') || req.get('X-Forwarded-For') || req.ip;
        const order = new WeixinPayModel({
            shopMemberId: userId,
            spbill_create_ip,
            body,
            trade_type: 'APP',
            total_fee: amount,
        });

        const params = {
            spbill_create_ip,
            body,
            out_trade_no: _T(order.out_trade_no),
            total_fee: amount,
            trade_type: 'APP',
        };
        const result = await api.unifiedorder(params);
        if (result.success) {
            order.prepay_id = result.context.prepayid;
            order.appid = result.context.appid;
            order.mch_id = result.context.partnerid;
            order.timestamp = result.context.timestamp;
            order.nonce_str = result.context.noncestr;
            order.package = result.context.package;
            await order.save();
        }
        actionLog(userId, 'ShopMember', amount, 'Number', 'getUnifiedOrder');

        return resolve(result);
    });
};

```

* PDShopServer/project/App/routers/posts/shop/weixinPay/getUnifiedOrderForPC.js

```js
import { ShopMemberModel, WeixinPayModel } from '../../../../models';
import { _F, _T, hasAuthority, actionLog } from '../../../../utils/';
import CONSTANTS from '../../../../constants';
import api from '../../libs/weixinPay/api';
import config from '../../../../../config';
import { rechargeForShopMember } from '../../libs/account';

export default async ({
    userId,
    amount, // 单位：元
    body, //商品描述
}, req) => {
    amount = _F(amount);
    if (config.hasNoRealPayment) {
        return rechargeForShopMember({ userId, amount, thirdpartyAccount: 'SIMULATION_NO' });
    }
    amount = amount / config.weixinPayRate;
    if (amount < 1) {
        return { msg: '充值金额必须大于' + config.weixinPayRate / 100 };
    }
    return new Promise(async resolve => {
        const member = await ShopMemberModel.findById(userId);
        if (!hasAuthority(member, CONSTANTS.AH_RECHARGE) || !member.partmentId) {
            return resolve({ msg: '你没有充值的权限' });
        }

        const spbill_create_ip = req.get('X-Real-IP') || req.get('X-Forwarded-For') || req.ip;
        const order = new WeixinPayModel({
            shopMemberId: userId,
            spbill_create_ip,
            body,
            trade_type: 'NATIVE',
            total_fee: amount,
        });

        const params = {
            spbill_create_ip,
            body,
            out_trade_no: _T(order.out_trade_no),
            total_fee: amount,
            trade_type: 'NATIVE',
        };
        const result = await api.unifiedorder(params);
        if (result.success) {
            order.prepay_id = result.context.prepayid;
            order.appid = result.context.appid;
            order.mch_id = result.context.partnerid;
            order.code_url = result.context.code_url;
            await order.save();

            result.context = { qrcode: result.context.code_url };
        }

        actionLog(userId, 'ShopMember', amount, 'Number', 'getUnifiedOrderForPC');

        return resolve(result);
    });
};

```

* PDShop_Shop_PC/project/App/shared/pages/auth/pages/login/index.js

```js
import { connect } from 'react-redux';
import React from 'react';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import Login from './contents';

@connect(
    (state) => ({ phone: state.router.location.state ? state.router.location.state.phone : '' }),
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
)
export default class LoginContainer extends React.Component {
    render () {
        return (
            <Login {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/auth/pages/forgotPwd/index.js

```js
import React from 'react';
import { connect } from 'react-redux';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import ForgotPwd from './contents';

@connect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
)
export default class ForgotPwdContainer extends React.Component {
    render () {
        return (
            <ForgotPwd {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/auth/pages/register/index.js

```js
import React from 'react';
import { connect } from 'react-redux';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';

import Register from './contents';

@connect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
)
export default class RegisterContainer extends React.Component {
    render () {
        return (
            <Register {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/components/form/config.js

```js
export function getFormItemLayout (layout, formGroup, hasOffset) {
    if (formGroup) {
        return {};
    }
    return {
        labelCol: { span: layout && layout[0] ? layout[0] : 4 },
        wrapperCol: { span: layout ? (layout[1] ? layout[1] : 16 - layout[0]) : 12, offset: hasOffset ? (layout && layout[0] ? layout[0] : 4) : 0 },
    };
}
export function getDefaultRules (label, required, rules = [], word = '填写') {
    const defaultRules = required ? [{ required, message: `请${word}${label}` }] : [];
    return [ ...defaultRules, ...rules ];
}
export function isNullValue (value) {
    if (!value) {
        if (value === 0) {
            return false;
        }
        return true;
    }
    return false;
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/components/table/config.js

```js
import React from 'react';
import { _N } from 'utils';
import _ from 'lodash';
import styles from './index.less';

export function fixColumns (columns) {
    columns = _.cloneDeep(columns);
    return columns.map((o) => {
        let unitRender;
        if (o.unit) {
            unitRender = (data = 0, record, index) => <span>{ _N(o.value ? o.value(data, record, index) : data) }<span className={styles.unit}>{_.isFunction(o.unit) ? o.unit(data, record, index) : o.unit}</span></span>;
        }

        let valuesRender;
        if (o.values) {
            valuesRender = (data, record, index) => {
                const values = _.reject(o.values(data, record, index), k => _.isNil(k));
                if (values[1]) {
                    return <div className={styles.baseValueContainer}><span>{values[0]}</span><span className={styles.baseValue}>{values[1]}</span></div>;
                }
                return <span>{values[0]}</span>;
            };
        }
        if (!o.render) {
            o.render = (data, record, index) => {
                if (valuesRender) {
                    data = valuesRender(data, record, index);
                } else if (unitRender) {
                    data = unitRender(data, record, index);
                } else if (o.value) {
                    data = o.value(data, record, index);
                } else if (_.isNil(data)) {
                    data = '无';
                }
                return data;
            };
        } else {
            const render = o.render;
            o.render = (data, record, index) => {
                data = render(data, record, index);
                if (o.unit) {
                    data = <span>{data}<span className={styles.unit}>{_.isFunction(o.unit) ? o.unit(data, record, index) : o.unit}</span></span>;
                }
                return data;
            };
        }

        if (o.totalUnit) {
            const title = o.title;
            o.title = <span>{title}<span className={styles.unit}>({o.totalUnit})</span></span>;
            delete o.totalUnit;
        }
        return o;
    });
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/pages/SelectBranchShop/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectBranchShop from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectBranchShop.fragments,
        variablesTypes: {
            branchShops: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            branchShops: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class SelectBranchShopContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                branchShops: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.branchShops) {
                    showError('没有相关分店');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, branchShops } = this.props;
        const property = 'branchShopList';
        if (needLoadPage(branchShops, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    branchShops: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SelectBranchShop {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/pages/SelectMember/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectMember from './contents';

@dataConnect(
    (state) => ({ states: state.members, pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectMember.fragments,
        variablesTypes: {
            members: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            members: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class SelectMemberContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                members: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.members) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, members } = this.props;
        const property = 'memberList';
        if (needLoadPage(members, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    members: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SelectMember {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/pages/SelectPartment/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectPartment from './contents';

@dataConnect(
    (state) => ({ states: state.partments, pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectPartment.fragments,
        variablesTypes: {
            partments: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            partments: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class SelectPartmentContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                partments: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.partments) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, partments } = this.props;
        const property = 'partmentList';
        if (needLoadPage(partments, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    partments: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SelectPartment {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/pages/SelectPreOrder/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectPreOrder from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectPreOrder.fragments,
        variablesTypes: {
            selectPreOrders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                senderPhone: 'ID!',
                keyword: 'String',
            },
        },
        initialVariables: {
            selectPreOrders: {
                pageNo: 0,
                pageSize: props.pageSize,
                senderPhone: props.senderPhone,
            },
        },
    })
)
export default class SelectPreOrderContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize, senderPhone } = this.props;
        relate.refresh({
            variables: {
                selectPreOrders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    senderPhone,
                },
            },
            callback (data) {
                if (!data.selectPreOrders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, selectPreOrders, senderPhone } = this.props;
        const property = 'orderList';
        if (needLoadPage(selectPreOrders, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    selectPreOrders: {
                        pageNo,
                        pageSize,
                        keyword,
                        senderPhone,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SelectPreOrder {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/pages/SelectRoadmap/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectRoadmap from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectRoadmap.fragments,
        variablesTypes: {
            onOrderRoadmaps: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                orderId: 'ID!',
                orderBy: 'Int!',
            },
        },
        initialVariables: {
            onOrderRoadmaps: {
                pageNo: 0,
                pageSize: props.pageSize,
                orderId: props.orderId,
                orderBy: 0,
            },
        },
    })
)
export default class SelectRoadmapContainer extends React.Component {
    refresh (orderBy) {
        const { relate, pageSize, orderId } = this.props;
        relate.refresh({
            variables: {
                onOrderRoadmaps: {
                    pageNo: 0,
                    pageSize,
                    orderId,
                    orderBy,
                },
            },
            callback (data) {
                if (!data.onOrderRoadmaps) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (orderBy, pageNo) {
        const { relate, pageSize, orderId, onOrderRoadmaps } = this.props;
        const property = 'clientList';
        if (needLoadPage(onOrderRoadmaps, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    onOrderRoadmaps: {
                        pageNo,
                        pageSize,
                        orderId,
                        orderBy,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SelectRoadmap {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/pages/SelectShipper/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectShipper from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectShipper.fragments,
        variablesTypes: {
            shippers: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
                shopId: 'ID!',
            },
        },
        initialVariables: {
            shippers: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
                shopId: props.shopId,
            },
        },
    })
)
export default class SelectShipperShopContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                shippers: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    shopId: this.props.shopId,
                },
            },
            callback (data) {
                if (!data.shippers) {
                    showError('没有相关物流');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, shippers, shopId } = this.props;
        const property = 'shipperList';
        if (needLoadPage(shippers, shopId, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    shippers: {
                        pageNo,
                        pageSize,
                        keyword,
                        shopId,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            < SelectShipper {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/pages/SelectWareHouseMember/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectWareHouseMember from './contents';

@dataConnect(
    (state) => ({ states: state.wareHouseMembers, pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectWareHouseMember.fragments,
        variablesTypes: {
            wareHouseMembers: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            wareHouseMembers: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class SelectWareHouseMemberContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                wareHouseMembers: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.wareHouseMembers) {
                    showError('没有相关成员');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, wareHouseMembers } = this.props;
        const property = 'memberList';
        if (needLoadPage(wareHouseMembers, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    wareHouseMembers: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SelectWareHouseMember {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/agents/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as agentActions from 'actions/agents';
import { needLoadPage, showError } from 'utils';
import Agents from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(agentActions, dispatch),
    }),
    (props) => ({
        fragments: Agents.fragments,
        variablesTypes: {
            agents: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            agents: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class AgentsContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                agents: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.agents) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, agents } = this.props;
        const property = 'agentList';
        if (needLoadPage(agents, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    agents: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Agents {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/bills/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage, showError } from 'utils';
import Bills from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: Bills.fragments,
        variablesTypes: {
            bills: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            bills: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class BillsContainer extends React.Component {
    refresh (keyword, startDate, endDate) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                bills: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.bills) {
                    showError('没有相关账单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, startDate, endDate) {
        const { relate, pageSize, bills } = this.props;
        if (needLoadPage(bills[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    bills: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        startDate,
                        endDate,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <Bills {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/branchShops/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as shopActions from 'actions/shops';
import { needLoadPage, showError } from 'utils';
import BranchShops from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(shopActions, dispatch),
    }),
    (props) => ({
        fragments: BranchShops.fragments,
        variablesTypes: {
            branchShops: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            branchShops: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class BranchShopsContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                branchShops: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.branchShops) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, branchShops } = this.props;
        const property = 'branchShopList';
        if (needLoadPage(branchShops, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    branchShops: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <BranchShops {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/clients/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as clientActions from 'actions/clients';
import { needLoadPage, showError } from 'utils';
import Clients from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(clientActions, dispatch),
    }),
    (props) => ({
        fragments: Clients.fragments,
        variablesTypes: {
            clients: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            clients: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class ClientsContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                clients: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.clients) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, clients } = this.props;
        const property = 'clientList';
        if (needLoadPage(clients, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    clients: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Clients {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/feedback/index.js

```js
import React from 'react';
import { connect } from 'react-redux';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import Feedback from './contents';

@connect(
    null,
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
)
export default class FeedbackContainer extends React.Component {
    render () {
        return (
            <Feedback {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/home/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import Home from './contents';

@dataConnect(
    (state) => ({}),
    null,
    (props) => ({
        fragments: Home.fragments,
    })
)
export default class HomeContainer extends React.Component {
    render () {
        return (
            <Home {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/members/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as memberActions from 'actions/members';
import { needLoadPage, showError } from 'utils';
import Members from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(memberActions, dispatch),
    }),
    (props) => ({
        fragments: Members.fragments,
        variablesTypes: {
            members: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            members: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class MembersContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                members: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.members) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, members } = this.props;
        const property = 'memberList';
        if (needLoadPage(members, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    members: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Members {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/notifies/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import { needLoadPage } from 'utils';
import * as notifyActions from 'actions/notifies';
import Notify from './contents';

@dataConnect(
    (state) => {
        const { activeType } = state.router.location.state || state.router.location.query || { activeType: 'news' };
        return {
            activeType,
            pageSize: 20,
        };
    },
    (dispatch) => ({
        actions : bindActionCreators(notifyActions, dispatch),
    }),
    (props) => ({
        fragments: Notify.fragments,
        variablesTypes: {
            notifies: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            notifies: {
                pageNo: 0,
                pageSize: props.pageSize,
                type: '',
                keyword: '',
            },
        },
    })
)
export default class NotifyContainer extends React.Component {
    refresh (keyword = '') {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                notifies: {
                    pageNo: 0,
                    pageSize,
                    type: '',
                    keyword,
                },
            },
        });
    }
    loadListPage (keyword = '', type, pageNo) {
        const { relate, pageSize, notifies } = this.props;
        if (needLoadPage(notifies[type], pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    notifies: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <Notify {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/orders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage, showError } from 'utils';
import BROrders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: BROrders.fragments,
        variablesTypes: {
            orders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                shopId: 'ID',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            orders: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class BROrdersContainer extends React.Component {
    refresh (keyword, shopId, startDate, endDate) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                orders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    shopId,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.orders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, shopId, startDate, endDate) {
        const { relate, pageSize, orders } = this.props;
        if (needLoadPage(orders[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    orders: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        shopId,
                        startDate,
                        endDate,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <BROrders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/ownShop/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as shopActions from 'actions/shops';
import * as accountActions from 'actions/accounts';
import OwnShop from './contents';

@dataConnect(
    null,
    (dispatch) => ({
        actions : bindActionCreators({ ...shopActions, ...accountActions }, dispatch),
    }),
    (props) => ({
        fragments: OwnShop.fragments,
    })
)
export default class ShopContainer extends React.Component {
    refreshRemainAmount () {
        const { relate } = this.props;
        relate.refresh({
            property: 'remainAmount',
        });
    }
    render () {
        return (
            <OwnShop {...this.props} refreshRemainAmount={::this.refreshRemainAmount} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/partment/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as partmentActions from 'actions/partments';
import * as accountActions from 'actions/accounts';
import OwnPartment from './contents';

@dataConnect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators({ ...partmentActions, ...accountActions }, dispatch),
    }),
    (props) => ({
        fragments: OwnPartment.fragments,
    })
)
export default class OwnPartmentContainer extends React.Component {
    refreshRemainAmount () {
        const { relate } = this.props;
        relate.refresh({
            property: 'remainAmount',
        });
    }
    render () {
        return (
            <OwnPartment {...this.props} refreshRemainAmount={::this.refreshRemainAmount} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/partments/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as partmentActions from 'actions/partments';
import { needLoadPage, showError } from 'utils';
import Partments from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(partmentActions, dispatch),
    }),
    (props) => ({
        fragments: Partments.fragments,
        variablesTypes: {
            partments: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            partments: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class PartmentsContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                partments: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.partments) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, partments } = this.props;
        const property = 'partmentList';
        if (needLoadPage(partments, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    partments: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Partments {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/personal/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import Personal from './contents';

@dataConnect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
    (props) => ({
        fragments: Personal.fragments,
    })
)
export default class PersonalContainer extends React.Component {
    render () {
        return (
            <Personal {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/placeOrder/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import * as clientActions from 'actions/clients';
import PlaceOrder from './contents';

@dataConnect(
    null,
    (dispatch) => ({
        actions : bindActionCreators({ ...orderActions, ...clientActions }, dispatch),
    }),
    (props) => {
        return {
            fragments: PlaceOrder.fragments,
        };
    }
)
export default class PlaceOrderContainer extends React.Component {
    refresh () {
        const { relate } = this.props;
        relate.refresh({
            property: ['rporder', 'addressWithOrder', 'sendDoorAddressWithOrder'],
        });
    }
    render () {
        return (
            <PlaceOrder {...this.props} refresh={::this.refresh} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/regionRates/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import { needLoadPage, showError } from 'utils';
import RegionRates from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => ({
        fragments: RegionRates.fragments,
        variablesTypes: {
            regionRates: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String',
                shopId: 'ID',
            },
        },
        initialVariables: {
            regionRates: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class RegionRatesContainer extends React.Component {
    refresh (keyword, shopId) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                regionRates: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    shopId,
                },
            },
            callback (data) {
                if (!data.regionRates) {
                    showError('没有相关方向的设置');
                }
            },
        });
    }
    loadListPage (keyword, shopId, pageNo) {
        const { relate, pageSize, regionRates } = this.props;
        const property = 'list';
        if (needLoadPage(regionRates, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    regionRates: {
                        pageNo,
                        pageSize,
                        keyword,
                        shopId,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <RegionRates {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/roadmaps/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import { needLoadPage, showError } from 'utils';
import Roadmaps from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => ({
        fragments: Roadmaps.fragments,
        variablesTypes: {
            roadmaps: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String',
                shopId: 'ID',
            },
        },
        initialVariables: {
            roadmaps: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class RoadmapsContainer extends React.Component {
    refresh (keyword, shopId) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                roadmaps: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    shopId,
                },
            },
            callback (data) {
                if (!data.roadmaps) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (keyword, shopId, pageNo) {
        const { relate, pageSize, roadmaps } = this.props;
        const property = 'roadmapList';
        if (needLoadPage(roadmaps, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    roadmaps: {
                        pageNo,
                        pageSize,
                        keyword,
                        shopId,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Roadmaps {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/rporders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage, showError } from 'utils';
import RPOrders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: RPOrders.fragments,
        variablesTypes: {
            rporders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            rporders: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class RPOrdersContainer extends React.Component {
    refresh (keyword, startDate, endDate) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                rporders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.rporders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, startDate, endDate) {
        const { relate, pageSize, rporders } = this.props;
        if (needLoadPage(rporders[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    rporders: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        startDate,
                        endDate,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <RPOrders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/setting/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as settingActions from 'actions/settings';
import Setting from './contents';

@dataConnect(
    null,
    (dispatch) => ({
        actions : bindActionCreators(settingActions, dispatch),
    }),
    (props) => {
        return {
            fragments: Setting.fragments,
        };
    }
)
export default class SettingContainer extends React.Component {
    refreshSetting () {
        const { relate } = this.props;
        relate.refresh({
            property: 'setting',
        });
    }
    render () {
        return (
            <Setting {...this.props} refreshSetting={::this.refreshSetting} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/shippers/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as shipperActions from 'actions/shippers';
import { needLoadPage, showError } from 'utils';
import Shippers from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(shipperActions, dispatch),
    }),
    (props) => ({
        fragments: Shippers.fragments,
        variablesTypes: {
            shippers: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
                shopId: 'ID!',
            },
        },
        initialVariables: {
            shippers: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
                shopId: '',
            },
        },
    })
)
export default class ShippersContainer extends React.Component {
    refresh (keyword, shopId = '') {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                shippers: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    shopId,
                },
            },
            callback (data) {
                if (!data.shippers) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (keyword, shopId = '', pageNo) {
        const { relate, pageSize, shippers } = this.props;
        const property = 'shipperList';
        if (needLoadPage(shippers, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    shippers: {
                        pageNo,
                        pageSize,
                        keyword,
                        shopId,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Shippers {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/statistics/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import Statistics from './contents';

@dataConnect(
    null,
    null,
    (props) => ({
        fragments: Statistics.fragments,
        variablesTypes: {
            shopStatistics: {
                shopId: 'ID',
            },
        },
    })
)
export default class StatisticsContainer extends React.Component {
    refresh (shopId) {
        const { relate } = this.props;
        relate.refresh({
            variables: {
                shopStatistics: {
                    shopId,
                },
            },
        });
    }
    render () {
        return (
            <Statistics {...this.props} refresh={::this.refresh} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/warehouse/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as warehouseActions from 'actions/warehouses';
import { needLoadPage, showError } from 'utils';
import Warehouses from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(warehouseActions, dispatch),
    }),
    (props) => ({
        fragments: Warehouses.fragments,
        variablesTypes: {
            warehouses: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String',
            },
        },
        initialVariables: {
            warehouses: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class WarehouseContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                warehouses: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.warehouses) {
                    showError('没有相关仓库');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, warehouses } = this.props;
        const property = 'list';
        if (needLoadPage(warehouses, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    warehouses: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Warehouses {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/trucks/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as shipperActions from 'actions/shippers';
import { needLoadPage, showError } from 'utils';
import Trucks from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(shipperActions, dispatch),
    }),
    (props) => ({
        fragments: Trucks.fragments,
        variablesTypes: {
            trucks: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            trucks: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class TrucksContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                trucks: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.trucks) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, trucks } = this.props;
        const property = 'truckList';
        if (needLoadPage(trucks, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    trucks: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Trucks {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/whorders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage, showError } from 'utils';
import WHOrders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: WHOrders.fragments,
        variablesTypes: {
            whorders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            whorders: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class WHOrdersContainer extends React.Component {
    refresh (keyword, startDate, endDate) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                whorders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.whorders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, startDate, endDate) {
        const { relate, pageSize, whorders } = this.props;
        if (needLoadPage(whorders[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    whorders: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        startDate,
                        endDate,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <WHOrders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/agents/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as agentActions from 'actions/agents';
import AgentDetail from './contents';

@dataConnect(
    (state) => {
        const { addressRegionLastCode, agentId, record, agents } = state.router.location.state || state.router.location.query;
        return { addressRegionLastCode, agentId, record, agents, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(agentActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.agent || !props.agentId,
            fragments: AgentDetail.fragments,
            variablesTypes: {
                agent: {
                    agentId: 'ID!',
                },
                addressFromLastCode: {
                    addressLastCode: 'Int',
                },
            },
            initialVariables: {
                agent: {
                    agentId: props.agentId,
                },
                addressFromLastCode: {
                    addressLastCode: props.addressRegionLastCode,
                },
            },
            mutations: {
                modifyAgent ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeAgent ({ state, data, _ }) {
                    if (data.success) {
                        props.agents.count--;
                        _.remove(props.agents.agentList, (item) => item.id === props.agentId);
                    }
                },
            },
        };
    }
)
export default class AgentDetailContainer extends React.Component {
    render () {
        return (
            <AgentDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/agents/pages/register/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as agentActions from 'actions/agents';
import AgentRegister from './contents';

@dataConnect(
    (state) => {
        const { agentId, record, agents } = state.router.location.state || state.router.location.query;
        return { agentId, record, agents, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(agentActions, dispatch),
    }),
    null,
)
export default class AgentRegisterContainer extends React.Component {
    render () {
        return (
            <AgentRegister {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/branchShops/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as shopActions from 'actions/shops';
import BranchShopDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, addressRegionLastCode, shopId, record, branchShops } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, addressRegionLastCode, shopId, record, branchShops, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(shopActions, dispatch),
    }),
    (props) => {
        return {
            fragments: BranchShopDetail.fragments,
            variablesTypes: {
                branchShop: {
                    shopId: 'ID',
                },
                addressFromLastCode: {
                    addressLastCode: 'Int',
                },
            },
            initialVariables: {
                branchShop: {
                    shopId: props.shopId,
                },
                addressFromLastCode: {
                    addressLastCode: props.addressRegionLastCode,
                },
            },
            mutations: {
                modifyBranchShop ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeBranchShop ({ state, data, _ }) {
                    if (data.success) {
                        props.branchShops.count--;
                        _.remove(props.branchShops.branchShopList, (item) => item.id === props.shopId);
                    }
                },
            },
        };
    }
)
export default class BranchShopDetailContainer extends React.Component {
    render () {
        return (
            <BranchShopDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/clients/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as clientActions from 'actions/clients';
import ClientDetail from './contents';

@dataConnect(
    (state) => {
        const { clientId } = state.router.location.state;
        return { clientId, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(clientActions, dispatch),
    }),
    (props) => {
        return {
            fragments: ClientDetail.fragments,
            variablesTypes: {
                client: {
                    clientId: 'ID!',
                },
            },
            initialVariables: {
                client: {
                    clientId: props.clientId,
                },
            },
        };
    }
)
export default class ClientDetailContainer extends React.Component {
    render () {
        return (
            <ClientDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/members/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as memberActions from 'actions/members';
import MemberDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, memberId, record, members } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, memberId, record, members, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(memberActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.member || !props.memberId,
            fragments: MemberDetail.fragments,
            variablesTypes: {
                member: {
                    memberId: 'ID!',
                },
            },
            initialVariables: {
                member: {
                    memberId: props.memberId,
                },
            },
            mutations: {
                modifyMember ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeMember ({ state, data, _ }) {
                    if (data.success) {
                        props.members.count--;
                        _.remove(props.members.memberList, (item) => item.id === props.memberId);
                    }
                },
            },
        };
    }
)
export default class MemberDetailContainer extends React.Component {
    render () {
        return (
            <MemberDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/notifies/pages/sendNotify/index.js

```js
import React from 'react';
import { connect } from 'react-redux';
import { bindActionCreators } from 'redux';
import * as notifyActions from 'actions/notifies';
import SendNotify from './contents';

@connect(
    (state) => {
        const { notifies, activeType } = state.router.location.state;
        return { notifies, activeType, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(notifyActions, dispatch),
    }),
)
export default class SendNotifyContainer extends React.Component {
    render () {
        return (
            <SendNotify {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/orders/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import RPOrderDetail from './contents';

@dataConnect(
    (state) => {
        const { orderId, activeType } = state.router.location.state || state.router.location.query;
        return { orderId, activeType, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.order || !props.orderId,
            fragments: RPOrderDetail.fragments,
            variablesTypes: {
                order: {
                    orderId: 'ID!',
                },
            },
            initialVariables: {
                order: {
                    orderId: props.orderId,
                },
            },
        };
    }
)
export default class RPOrderDetailContainer extends React.Component {
    refreshRPOrder () {
        const { relate, orderId } = this.props;
        relate.refresh({
            variables: {
                order: {
                    orderId,
                },
            },
        });
    }
    render () {
        return (
            <RPOrderDetail {...this.props} refreshRPOrder={::this.refreshRPOrder} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/personal/pages/paymentPwd/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import PaymentPwd from './contents';

@dataConnect(
    null,
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    })
)
export default class PaymentPwdContainer extends React.Component {
    render () {
        return (
            <PaymentPwd {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/partments/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as partmentActions from 'actions/partments';
import PartmentDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, partmentId, record, partments } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, partmentId, record, partments, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(partmentActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.partment || !props.partmentId,
            fragments: PartmentDetail.fragments,
            variablesTypes: {
                partment: {
                    partmentId: 'ID!',
                },
            },
            initialVariables: {
                partment: {
                    partmentId: props.partmentId,
                },
            },
            mutations: {
                modifyPartment ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removePartment ({ state, data, _ }) {
                    if (data.success) {
                        props.partments.count--;
                        _.remove(props.partments.partmentList, (item) => item.id === props.partmentId);
                    }
                },
            },
        };
    }
)
export default class PartmentDetailContainer extends React.Component {
    render () {
        return (
            <PartmentDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/regionRates/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import RegionRateDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, regionLastCode, regionRateId, record, regionRates } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, regionLastCode, regionRateId, record, regionRates, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => {
        return {
            fragments: RegionRateDetail.fragments,
            variablesTypes: {
                regionRate: {
                    regionRateId: 'ID',
                },
                addressFromLastCode: {
                    addressLastCode: 'Int',
                    type: 'Int',
                },
            },
            initialVariables: {
                regionRate: {
                    regionRateId: props.regionRateId,
                },
                addressFromLastCode: {
                    addressLastCode: props.regionLastCode,
                    type: 2,
                },
            },
            mutations: {
                modifyRoadmapRegionProfitRate ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeRoadmapRegionProfitRate ({ state, data, _ }) {
                    if (data.success) {
                        props.regionRates.count--;
                        _.remove(props.regionRates.regionRateList, (item) => item.id === props.regionRateId);
                    }
                },
            },
        };
    }
)
export default class RegionRateDetailContainer extends React.Component {
    render () {
        return (
            <RegionRateDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/rporders/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import RPOrderDetail from './contents';

@dataConnect(
    (state) => {
        const { orderId, record, rporders, activeType } = state.router.location.state || state.router.location.query;
        return { orderId, record, rporders, activeType, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.order || !props.orderId,
            fragments: RPOrderDetail.fragments,
            variablesTypes: {
                order: {
                    orderId: 'ID!',
                },
                addressWithOrder: {
                    orderId: 'ID!',
                },
                sendDoorAddressWithOrder: {
                    orderId: 'ID!',
                },
            },
            initialVariables: {
                order: {
                    orderId: props.orderId,
                },
                addressWithOrder: {
                    orderId: props.orderId,
                },
                sendDoorAddressWithOrder: {
                    orderId: props.orderId,
                },
            },
        };
    }
)
export default class RPOrderDetailContainer extends React.Component {
    refresh () {
        const { relate, orderId } = this.props;
        relate.refresh({
            variables: {
                order: {
                    orderId,
                },
                addressWithOrder: {
                    orderId,
                },
                sendDoorAddressWithOrder: {
                    orderId,
                },
            },
        });
    }
    render () {
        return (
            <RPOrderDetail {...this.props} refresh={::this.refresh} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/roadmaps/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import RoadmapDetail from './contents';

@dataConnect(
    (state) => {
        const { roadmapId } = state.router.location.state;
        return { roadmapId, keepLastKeepData: true };
    },
    null,
    (props) => {
        return {
            fragments: RoadmapDetail.fragments,
            variablesTypes: {
                roadmap: {
                    roadmapId: 'ID!',
                },
            },
            initialVariables: {
                roadmap: {
                    roadmapId: props.roadmapId,
                },
            },
        };
    }
)
export default class RoadmapDetailContainer extends React.Component {
    render () {
        return (
            <RoadmapDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/shippers/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as shipperActions from 'actions/shippers';
import ShipperDetail from './contents';

@dataConnect(
    (state) => {
        const { shipperId, record, shippers } = state.router.location.state || state.router.location.query;
        return { shipperId, record, shippers, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(shipperActions, dispatch),
    }),
    (props) => {
        return {
            fragments: ShipperDetail.fragments,
            variablesTypes: {
                shipper: {
                    shipperId: 'ID!',
                    shopId: 'ID!',
                },
            },
            initialVariables: {
                shipper: {
                    shipperId: props.shipperId,
                    shopId: props.record.shopId,
                },
            },
            mutations: {
                modifyShipper ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeShipper ({ state, data, _ }) {
                    if (data.success) {
                        props.shippers.count--;
                        _.remove(props.shippers.shipperList, (item) => item.id === props.record.id);
                    }
                },
            },
        };
    }
)
export default class ShipperDetailContainer extends React.Component {
    render () {
        return (
            <ShipperDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/shippers/pages/register/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as shipperActions from 'actions/shippers';
import ShipperRegister from './contents';

@dataConnect(
    (state) => {
        const { shippers } = state.router.location.state || state.router.location.query;
        return { shippers, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(shipperActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: true,
            fragments: ShipperRegister.fragments,
            variablesTypes: {
                shipper: {
                    shipperId: 'ID!',
                    shopId: 'ID!',
                },
            },
            initialVariables: {
                shipper: {
                    shipperId: '',
                    shopId: '',
                },
            },
        };
    }
)
export default class ShipperRegisterContainer extends React.Component {
    render () {
        return (
            <ShipperRegister {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/warehouse/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as warehouseActions from 'actions/warehouses';
import WarehouseDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, warehouseId, record, warehouses } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, warehouseId, record, warehouses, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(warehouseActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.warehouse || !props.warehouseId,
            fragments: WarehouseDetail.fragments,
            variablesTypes: {
                warehouse: {
                    warehouseId: 'ID',
                },
            },
            initialVariables: {
                warehouse: {
                    warehouseId: props.warehouseId,
                },
            },
            mutations: {
                modifyWarehouse ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeWarehouse ({ state, data, _ }) {
                    if (data.success) {
                        props.warehouses.count--;
                        _.remove(props.warehouses.warehouseList, (item) => item.id === props.warehouseId);
                    }
                },
            },
        };
    }
)
export default class WarehouseDetailContainer extends React.Component {
    render () {
        return (
            <WarehouseDetail {...this.props} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shop/pages/whorders/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import WHOrderDetail from './contents';

@dataConnect(
    (state) => {
        const { orderId, activeType } = state.router.location.state || state.router.location.query;
        return { orderId, activeType, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.order || !props.orderId,
            fragments: WHOrderDetail.fragments,
            variablesTypes: {
                order: {
                    orderId: 'ID!',
                },
            },
            initialVariables: {
                order: {
                    orderId: props.orderId,
                },
            },
        };
    }
)
export default class WHOrderDetailContainer extends React.Component {
    refreshWHOrder () {
        const { relate, orderId } = this.props;
        relate.refresh({
            variables: {
                order: {
                    orderId,
                },
            },
        });
    }
    render () {
        return (
            <WHOrderDetail {...this.props} refreshWHOrder={::this.refreshWHOrder} />
        );
    }
}

```

* PDShop_Shop_PC/project/App/client/auth.js

```js
import routes from 'routers/auth';
import renderRoutes from './helpers/render-routes';

renderRoutes(routes);

```

* PDShop_Shop_PC/project/App/client/public.js

```js
import routes from 'routers/public';
import renderRoutes from './helpers/render-routes';

renderRoutes(routes);

```

* PDShop_Shop_PC/project/App/client/shop.js

```js
import 'babel-polyfill';

import routes from 'routers/shop';
import renderRoutes from './helpers/render-routes';

renderRoutes(routes);

```

* PDShop_Shop_PC/project/App/server/index.js

```js
import bodyParser from 'body-parser';
import express from 'express';
import graphqlHTTP from 'express-graphql';
import morgan from 'morgan';
import path from 'path';
import passport from 'passport';
import { Strategy as LocalStrategy } from 'passport-local';
import connectMongo from 'connect-mongo';
import session from 'express-session';

import { post, urls } from 'helpers/api';
import config from '../../config';
import routers from './routers';
import schema from './schema';

const app = express();

app.use(morgan('short'));
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json({ limit: 100000000 }));

// session
const MongoStore = connectMongo(session);
app.use(session({
    secret: '88164657simiantong_shop', // session的密码
    resave: true,
    saveUninitialized: false,
    store: new MongoStore({
        url: config.dbServer,
        collection: 'sessions_shop',
    }),
}));

// Passport
app.use(passport.initialize());
app.use(passport.session());
passport.use('local', new LocalStrategy({
    usernameField: 'phone',
}, async (phone, password, done) => {
    const user = { phone, password };
    console.log('[login]: LocalStrategy', user);
    const data = await post(urls.login, user) || { msg: '服务器错误' };
    if (!data.success) {
        return done({ message: data.msg });
    }

    return done(null, Object.assign({}, data.context));
}));
passport.serializeUser((user, done) => { // 保存 user 到 sessoon
    console.log('[login]: serializeUser', user, done);
    done(null, user);// 可以通过数据库方式操作
});
passport.deserializeUser((user, done) => { // 通过保存的 user 信息到 sessoon 获取 user
    console.log('[login]: deserializeUser', user, done);
    done(null, user);// 可以通过数据库方式操作
});

// Static files
app.use(express.static(path.resolve('public')));
app.use(['/shop/favicon.ico', '/shop/images*', '/shop/media*', '/shop/css*', '/shop/fonts*', '/shop/assets*'], (req, res) => {
    res.status(404).end();
});

// GraphqQL server
app.use('/shop/graphql', graphqlHTTP(req => ({
    schema: schema.getSchema(),
    rootValue: {
        isAuthenticated: req.isAuthenticated(),
        user: req.user,
        req: req,
    },
    graphiql: true,
})));

app.use(async (req, res, next) => {
    res.locals.header = [
        {
            tag: 'title',
            content: '四面通物流大超市行政端',
        },
    ];

    if (process.env.NODE_ENV !== 'production') {
        res.baseScriptsURL = `http://localhost:${config.devPort}`;
        res.locals.header.push({
            tag: 'script',
            props: {
                src: `${res.baseScriptsURL}/webpack-dev-server.js`,
            },
        });
    } else {
        res.baseScriptsURL = '';
    }

    // footer
    res.locals.footer = [{
        tag: 'script',
        props: {
            src: `${res.baseScriptsURL}/shop/assets/common.js`,
        },
    }, {
        tag: 'script',
        props: {
            src: `http://api.map.baidu.com/api?v=2.0&ak=${config.baiduMapSK}`,
        },
    } ];

    next();
});

app.use(routers.authRouter);
app.use(routers.shopRouter);
app.use(routers.publicRouter);

app.use((req, res) => {
    res.status(404).end();
});

app.use((error, req, res) => {
    const statusCode = error.statusCode || 500;
    const err = {
        error: statusCode,
        message: error.message,
    };
    if (!res.headersSent) {
        res.status(statusCode).send(err);
    }
});

export default app;

```

* PDShop_Shop_PC/project/App/server/schema.js

```js
import _ from 'lodash';
import {
    GraphQLObjectType,
    GraphQLSchema,
} from 'graphql';

import mutations from './graphql/mutations';
import queries from './graphql/queries';

class SchemaManager {
    constructor () {
        this.init();
    }

    async init () {
        this.queryFields = _.clone(queries);
        this.mutationFields = _.clone(mutations);

        this.rootQuery = new GraphQLObjectType({
            name: 'Query',
            fields: () => (this.queryFields),
        });
        this.rootMutation = new GraphQLObjectType({
            name: 'Mutation',
            fields: () => (this.mutationFields),
        });
    }

    getSchema () {
        const schema = {
            query: this.rootQuery,
        };

        if (Object.keys(this.mutationFields).length) {
            schema.mutation = this.rootMutation;
        }

        return new GraphQLSchema(schema);
    }
}

export default new SchemaManager();

```

* PDShop_Shop_PC/project/App/client/helpers/render-routes.js

```js
import configureStore from 'helpers/configure-store';
import createHistory from 'history/lib/createBrowserHistory';
import React from 'react';
import { render } from 'react-dom';
import { Provider } from 'react-redux';
import { reduxReactRouter, ReduxRouter } from 'redux-router';
import getMuiTheme from 'material-ui/styles/getMuiTheme';
import MuiThemeProvider from 'material-ui/styles/MuiThemeProvider';
import injectTapEventPlugin from 'react-tap-event-plugin';

injectTapEventPlugin();

export default function renderRoutes (routes) {
    const state = window.__initialState;
    state.router = undefined;
    const store = configureStore(
        reduxReactRouter({ createHistory, routes }),
        state
    );
    const muiTheme = getMuiTheme({ userAgent: navigator.userAgent });

    render(
        <MuiThemeProvider muiTheme={muiTheme}>
            <Provider store={store}>
                <ReduxRouter routes={routes} />
            </Provider>
        </MuiThemeProvider>,
        document.getElementById('view')
    );
}

```

* PDShop_Shop_PC/project/App/shared/actions/accounts.js

```js
import { apiQuery } from 'relatejs';

export function weixinPayGetUnifiedOrder (data, callback) {
    return () => {
        return apiQuery({
            fragments: {
                weixinPayGetUnifiedOrder: { success: 1, msg: 1, context: { qrcode: 1 } },
            },
            variables: {
                weixinPayGetUnifiedOrder: {
                    data: {
                        value: data,
                        type: 'accountInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.weixinPayGetUnifiedOrder);
        })();
    };
}
export function weixinPayWithDraw (data, callback) {
    return () => {
        return apiQuery({
            fragments: {
                weixinPayWithDraw: { success: 1, msg: 1, context: { qrcode: 1 } },
            },
            variables: {
                weixinPayWithDraw: {
                    data: {
                        value: data,
                        type: 'accountInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.weixinPayWithDraw);
        })();
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/agents.js

```js
import { mutation } from 'relatejs';

export function checkAgentByChairManPhone (chairManPhone, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                checkAgentByChairManPhone: { success: 1, msg: 1, context },
            },
            variables: {
                checkAgentByChairManPhone: {
                    chairManPhone: {
                        value: chairManPhone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.checkAgentByChairManPhone);
        })(dispatch, getState);
    };
}
export function createAgent (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                createAgent: { success: 1, msg: 1, context },
            },
            variables: {
                createAgent: {
                    data: {
                        value: data,
                        type: 'agentInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.createAgent);
        })(dispatch, getState);
    };
}
export function modifyAgent (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyAgent: { success: 1, msg: 1, context },
            },
            variables: {
                modifyAgent: {
                    data: {
                        value: data,
                        type: 'agentInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyAgent);
        })(dispatch, getState);
    };
}
export function removeAgent (agentId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeAgent: { success: 1, msg: 1 },
            },
            variables: {
                removeAgent: {
                    agentId: {
                        value: agentId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeAgent);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/clients.js

```js
import { apiQuery } from 'relatejs';

export function getClientNameByPhone (phone, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getClientNameByPhone: { success: 1, msg: 1, context: { name: 1 } },
            },
            variables: {
                getClientNameByPhone: {
                    phone: {
                        value: phone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getClientNameByPhone);
        })();
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/members.js

```js
import { mutation } from 'relatejs';

export function createMember (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                createMember: { success: 1, msg: 1, context },
            },
            variables: {
                createMember: {
                    data: {
                        value: data,
                        type: 'memberInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.createMember);
        })(dispatch, getState);
    };
}
export function modifyMember (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyMember: { success: 1, msg: 1, context },
            },
            variables: {
                modifyMember: {
                    data: {
                        value: data,
                        type: 'memberInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyMember);
        })(dispatch, getState);
    };
}
export function removeMember (memberId, password, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeMember: { success: 1, msg: 1 },
            },
            variables: {
                removeMember: {
                    memberId: {
                        value: memberId,
                        type: 'ID!',
                    },
                    password: {
                        value: password,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeMember);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/notifies.js

```js
import { mutation } from 'relatejs';

export function sendNotify (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                sendNotify: { success: 1, msg: 1, context },
            },
            variables: {
                sendNotify: {
                    data: {
                        value: data,
                        type: 'notifyInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.sendNotify);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/orders.js

```js
import { mutation } from 'relatejs';

export function placeOriginOrder (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                placeOriginOrder: { success: 1, msg: 1, context },
            },
            variables: {
                placeOriginOrder: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.placeOriginOrder);
        })(dispatch, getState);
    };
}
export function placeOriginOrderWithPreOrder (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                placeOriginOrderWithPreOrder: { success: 1, msg: 1, context },
            },
            variables: {
                placeOriginOrderWithPreOrder: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.placeOriginOrderWithPreOrder);
        })(dispatch, getState);
    };
}
export function modifyOriginOrder (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyOriginOrder: { success: 1, msg: 1, context },
            },
            variables: {
                modifyOriginOrder: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyOriginOrder);
        })(dispatch, getState);
    };
}
export function removeOrder (orderId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeOrder: { success: 1, msg: 1 },
            },
            variables: {
                removeOrder: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeOrder);
        })(dispatch, getState);
    };
}

export function selectRoadmap (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                selectRoadmap: { success: 1, msg: 1, context },
            },
            variables: {
                selectRoadmap: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.selectRoadmap);
        })(dispatch, getState);
    };
}
export function selectRoadmapForOrderList (orderIdList, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                selectRoadmapForOrderList: { success: 1, msg: 1 },
            },
            variables: {
                selectRoadmapForOrderList: {
                    orderIdList: {
                        value: orderIdList,
                        type: '[ID]!',
                    },
                },
            },
        }, (result) => {
            callback(result.selectRoadmapForOrderList);
        })(dispatch, getState);
    };
}
export function proxyPay (orderId, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                proxyPay: { success: 1, msg: 1, context },
            },
            variables: {
                proxyPay: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.proxyPay);
        })(dispatch, getState);
    };
}
export function proxyPayForOrderList (orderIdList, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                proxyPayForOrderList: { success: 1, msg: 1 },
            },
            variables: {
                proxyPayForOrderList: {
                    orderIdList: {
                        value: orderIdList,
                        type: '[ID]!',
                    },
                },
            },
        }, (result) => {
            callback(result.proxyPayForOrderList);
        })(dispatch, getState);
    };
}
export function printOrderBill (orderId, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                printOrderBill: { success: 1, msg: 1, context },
            },
            variables: {
                printOrderBill: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.printOrderBill);
        })(dispatch, getState);
    };
}
export function printOrderListBill (orderIdList, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                printOrderListBill: { success: 1, msg: 1 },
            },
            variables: {
                printOrderListBill: {
                    orderIdList: {
                        value: orderIdList,
                        type: '[ID]!',
                    },
                },
            },
        }, (result) => {
            callback(result.printOrderListBill);
        })(dispatch, getState);
    };
}
export function printBarCode (orderId, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                printBarCode: { success: 1, msg: 1, context },
            },
            variables: {
                printBarCode: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.printBarCode);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/partments.js

```js
import { mutation } from 'relatejs';

export function createPartment (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                createPartment: { success: 1, msg: 1, context },
            },
            variables: {
                createPartment: {
                    data: {
                        value: data,
                        type: 'partmentInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.createPartment);
        })(dispatch, getState);
    };
}
export function modifyPartment (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyPartment: { success: 1, msg: 1, context },
            },
            variables: {
                modifyPartment: {
                    data: {
                        value: data,
                        type: 'partmentInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyPartment);
        })(dispatch, getState);
    };
}
export function removePartment (partmentId, password, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removePartment: { success: 1, msg: 1 },
            },
            variables: {
                removePartment: {
                    partmentId: {
                        value: partmentId,
                        type: 'ID!',
                    },
                    password: {
                        value: password,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.removePartment);
        })(dispatch, getState);
    };
}
export function modifyOwnPartment (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyOwnPartment: { success: 1, msg: 1, context },
            },
            variables: {
                modifyOwnPartment: {
                    data: {
                        value: data,
                        type: 'partmentInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyOwnPartment);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/personals.js

```js
import { apiQuery, apiMutation, mutation } from 'relatejs';

export function getVerifyCode (phone, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getVerifyCode: { success: 1, msg: 1 },
            },
            variables: {
                getVerifyCode: {
                    phone: {
                        value: phone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getVerifyCode);
        })();
    };
}
export function register (data, callback) {
    return () => {
        return apiMutation({
            fragments: {
                register: { success: 1, msg: 1 },
            },
            variables: {
                register: {
                    data: {
                        value: data,
                        type: 'memberInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.register);
        })();
    };
}
export function login (phone, password, callback) {
    return () => {
        return apiQuery({
            fragments: {
                login: { success: 1, msg: 1 },
            },
            variables: {
                login: {
                    phone: {
                        value: phone,
                        type: 'String!',
                    },
                    password: {
                        value: password,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.login);
        })();
    };
}
export function forgotPwd (data, callback) {
    return () => {
        return apiMutation({
            fragments: {
                forgotPwd: { success: 1, msg: 1 },
            },
            variables: {
                forgotPwd: {
                    data: {
                        value: data,
                        type: 'memberInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.forgotPwd);
        })();
    };
}
export function setPaymentPassword (data, callback) {
    return () => {
        return apiMutation({
            fragments: {
                setPaymentPassword: { success: 1, msg: 1 },
            },
            variables: {
                setPaymentPassword: {
                    data: {
                        value: data,
                        type: 'memberInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.setPaymentPassword);
        })();
    };
}
export function feedback (content, email, callback) {
    return () => {
        return apiMutation({
            fragments: {
                feedback: { success: 1, msg: 1 },
            },
            variables: {
                feedback: {
                    content: {
                        value: content,
                        type: 'String!',
                    },
                    email: {
                        value: email,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.feedback);
        })();
    };
}
export function modifyPersonalInfo (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyPersonalInfo: { success: 1, msg: 1, context },
            },
            variables: {
                modifyPersonalInfo: {
                    data: {
                        value: data,
                        type: 'memberInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyPersonalInfo);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/roadmaps.js

```js
import { mutation } from 'relatejs';

export function setRoadmapProfit (data, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setRoadmapProfit: { success: 1, msg: 1 },
            },
            variables: {
                setRoadmapProfit: {
                    data: {
                        value: data,
                        type: 'roadmapInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.setRoadmapProfit);
        })(dispatch, getState);
    };
}
export function setRegionRateProfit (data, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setRegionRateProfit: { success: 1, msg: 1 },
            },
            variables: {
                setRegionRateProfit: {
                    data: {
                        value: data,
                        type: 'regionRateInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.setRegionRateProfit);
        })(dispatch, getState);
    };
}
export function addRoadmapRegionProfitRate (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                addRoadmapRegionProfitRate: { success: 1, msg: 1, context },
            },
            variables: {
                addRoadmapRegionProfitRate: {
                    data: {
                        value: data,
                        type: 'regionRateInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.addRoadmapRegionProfitRate);
        })(dispatch, getState);
    };
}
export function modifyRoadmapRegionProfitRate (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyRoadmapRegionProfitRate: { success: 1, msg: 1, context },
            },
            variables: {
                modifyRoadmapRegionProfitRate: {
                    data: {
                        value: data,
                        type: 'regionRateInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyRoadmapRegionProfitRate);
        })(dispatch, getState);
    };
}
export function removeRoadmapRegionProfitRate (regionRateId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeRoadmapRegionProfitRate: { success: 1, msg: 1 },
            },
            variables: {
                removeRoadmapRegionProfitRate: {
                    regionRateId: {
                        value: regionRateId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeRoadmapRegionProfitRate);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/settings.js

```js
import { mutation } from 'relatejs';

export function modifySetting (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifySetting: { success: 1, msg: 1, context },
            },
            variables: {
                modifySetting: {
                    data: {
                        value: data,
                        type: 'settingInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifySetting);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/shippers.js

```js
import { mutation, apiQuery } from 'relatejs';

export function modifyShipper (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyShipper: { success: 1, msg: 1, context },
            },
            variables: {
                modifyShipper: {
                    data: {
                        value: data,
                        type: 'shipperInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyShipper);
        })(dispatch, getState);
    };
}
export function createAndRegisterShipper (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                createAndRegisterShipper: { success: 1, msg: 1, context },
            },
            variables: {
                createAndRegisterShipper: {
                    data: {
                        value: data,
                        type: 'shipperInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.createAndRegisterShipper);
        })(dispatch, getState);
    };
}
export function registerShipper (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                registerShipper: { success: 1, msg: 1, context },
            },
            variables: {
                registerShipper: {
                    data: {
                        value: data,
                        type: 'shipperInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.registerShipper);
        })(dispatch, getState);
    };
}
export function getShipperByChairManPhone (chairManPhone, context, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getShipperByChairManPhone: { success: 1, msg: 1, context },
            },
            variables: {
                getShipperByChairManPhone: {
                    chairManPhone: {
                        value: chairManPhone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getShipperByChairManPhone);
        })();
    };
}
export function passExamineTruck (truckId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                passExamineTruck: { success: 1, msg: 1 },
            },
            variables: {
                passExamineTruck: {
                    truckId: {
                        value: truckId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.passExamineTruck);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/shops.js

```js
import { mutation } from 'relatejs';

export function modifyOwnShop (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyOwnShop: { success: 1, msg: 1, context },
            },
            variables: {
                modifyOwnShop: {
                    data: {
                        value: data,
                        type: 'shopInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyOwnShop);
        })(dispatch, getState);
    };
}

export function createBranchShop (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                createBranchShop: { success: 1, msg: 1, context },
            },
            variables: {
                createBranchShop: {
                    data: {
                        value: data,
                        type: 'shopInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.createBranchShop);
        })(dispatch, getState);
    };
}
export function modifyBranchShop (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyBranchShop: { success: 1, msg: 1, context },
            },
            variables: {
                modifyBranchShop: {
                    data: {
                        value: data,
                        type: 'shopInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyBranchShop);
        })(dispatch, getState);
    };
}
export function removeBranchShop (shopId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeBranchShop: { success: 1, msg: 1 },
            },
            variables: {
                removeBranchShop: {
                    shopId: {
                        value: shopId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeBranchShop);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/actions/warehouses.js

```js
import { mutation } from 'relatejs';

export function createWarehouse (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                createWarehouse: { success: 1, msg: 1, context },
            },
            variables: {
                createWarehouse: {
                    data: {
                        value: data,
                        type: 'warehouseInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.createWarehouse);
        })(dispatch, getState);
    };
}
export function modifyWarehouse (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyWarehouse: { success: 1, msg: 1, context },
            },
            variables: {
                modifyWarehouse: {
                    data: {
                        value: data,
                        type: 'warehouseInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyWarehouse);
        })(dispatch, getState);
    };
}
export function removeWarehouse (regionRateId, password, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeWarehouse: { success: 1, msg: 1 },
            },
            variables: {
                removeWarehouse: {
                    warehouseId: {
                        value: regionRateId,
                        type: 'ID!',
                    },
                    password:{
                        value: password,
                        type:'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeWarehouse);
        })(dispatch, getState);
    };
}

```

* PDShop_Shop_PC/project/App/shared/config/menu.js

```js
import AH from '../constants/authority';
import _ from 'lodash';

export default [
    {
        label: '部门',
        link: '/shop/partments',
        auth: [AH.AH_LOOK_PARTMENT, AH.AH_CREATE_PARTMENT, AH.AH_MODIFY_PARTMENT, AH.AH_REMOVE_PARTMENT],
    },
    {
        label: '分店',
        link: '/shop/branchShops',
        auth: [AH.AH_LOOK_BRANCH_SHOP, AH.AH_CREATE_BRANCH_SHOP, AH.AH_MODIFY_BRANCH_SHOP, AH.AH_REMOVE_BRANCH_SHOP],
    },
    {
        label: '收货点',
        link: '/shop/agents',
        auth: [AH.AH_LOOK_AGENT, AH.AH_CREATE_AGENT, AH.AH_MODIFY_AGENT, AH.AH_REMOVE_AGENT],
    },
    {
        label: '参数设置',
        link: '/shop/setting',
        auth: [AH.AH_MODIFY_SETTING],
    },
    {
        label: '物流公司',
        link: '/shop/shippers',
        auth: [AH.AH_LOOK_SHIPPER, AH.AH_CREATE_SHIPPER, AH.AH_MODIFY_SHIPPER, AH.AH_REMOVE_SHIPPER],
    },
    {
        label: '路线提成',
        link: '/shop/roadmaps',
        auth: [AH.AH_MODIFY_ROADMAP_PROFIT, AH.AH_LOOK_ROADMAP],
    },
    {
        label: '方向提成',
        link: '/shop/regionRates',
        auth: [AH.AH_MODIFY_ROADMAP_PROFIT],
    },
    {
        label: '货车审核',
        link: '/shop/trucks',
        auth: [AH.AH_TO_EXAMINE_TRUCK],
    },
    {
        label: '仓库管理',
        link: '/shop/warehouses',
        auth: [AH.AH_CREATE_WAREHOUSE, AH.AH_MODIFY_WAREHOUSE, AH.AH_REMOVE_WAREHOUSE, AH.AH_LOOK_WAREHOUSE],
    },
    {
        label: '货单',
        link: '/shop/orders',
        auth: member => !member.partment && _.includes(member.authority, AH.AH_LOOK_ORDERS),
    },
    {
        label: '下单',
        link: '/shop/placeOrder',
        auth: [AH.AH_RECEIVE_PARTMENT],
    },
    {
        label: '货单',
        link: '/shop/rporders',
        auth: [AH.AH_RECEIVE_PARTMENT],
    },
    {
        label: '货单',
        link: '/shop/whorders',
        auth: [AH.AH_WARE_HOUSE_PARTMENT],
    },
    {
        label: '客户',
        link: '/shop/clients',
        auth: false,
    },
    {
        label: '业务统计',
        link: '/shop/statistics',
        auth: member => !member.partment && _.includes(member.authority, AH.AH_LOOK_STATISTICS),
    },
];

```

* PDShop_Shop_PC/project/App/shared/config/topmenu.js

```js
import AH from '../constants/authority';

export default [
    {
        label: '人员管理',
        link: '/shop/members',
        auth: [AH.AH_LOOK_MEMBER, AH.AH_CREATE_MEMBER, AH.AH_MODIFY_MEMBER, AH.AH_REMOVE_MEMBER],
    },
    {
        label: '个人中心',
        link: '/shop/personal',
    },
    {
        label: '意见反馈',
        link: '/shop/feedback',
    },
    {
        label: '退出',
        link: '/shop/logout',
    },
];

```

* PDShop_Shop_PC/project/App/shared/constants/authority.js

```js
// 注意：常量部分必须和服务器保持一致
// 总部权限
const AH_CREATE_BRANCH_SHOP = 0; // 创建分店的权限
const AH_MODIFY_BRANCH_SHOP = 1; // 修改分店信息的权限
const AH_REMOVE_BRANCH_SHOP = 2; // 删除分店的权限
const AH_LOOK_BRANCH_SHOP = 3; // 查看分店列表的权限
const AH_MODIFY_SETTING = 4; // 修改设置的权限
const AH_CREATE_AGENT = 5; // 创建收货点的权限
const AH_MODIFY_AGENT = 6; // 修改收货点的权限
const AH_REMOVE_AGENT = 7; // 删除收货点的权限
const AH_LOOK_AGENT = 8; // 查看收货点的权限

// 公共权限
const AH_MODIFY_OWN_SHOP = 10000; // 修改所在物流超市信息的权限
const AH_CREATE_MEMBER = 10001; // 创建成员的权限
const AH_MODIFY_MEMBER = 10002; // 修改成员信息的权限
const AH_REMOVE_MEMBER = 10003; // 删除成员的权限
const AH_LOOK_MEMBER = 10004; // 查看成员的权限
const AH_RECHARGE = 10005; // 充值的权限
const AH_WITHDRAW = 10006; // 提现的权限
const AH_LOOK_AMOUNT = 10007; // 查看余额的权限
const AH_MODIFY_ROADMAP_PROFIT = 10008; // 修改路线的提成
const AH_LOOK_STATISTICS = 10009; // 查看统计信息的权限
const AH_LOOK_ORDERS = 10010; // 查看综合货单的权限

// 分店权限
const AH_CREATE_SHIPPER = 20000; // 创建物流公司的权限
const AH_MODIFY_SHIPPER = 20001; // 修改物流公司的权限
const AH_REMOVE_SHIPPER = 20002; // 删除物流公司的权限
const AH_LOOK_SHIPPER = 20003; // 查看物流公司的权限
const AH_CREATE_PARTMENT = 20004; // 创建部门的权限
const AH_MODIFY_PARTMENT = 20005; // 修改部门信息的权限
const AH_REMOVE_PARTMENT = 20006; // 删除部门的权限
const AH_LOOK_PARTMENT = 20007; // 查看部门的权限
const AH_MODIFY_OWN_PARTMENT = 20008; // 修改所在部门信息的权限
const AH_RECEIVE_PARTMENT = 20009; // 收货的权限（收货部人员）
const AH_WARE_HOUSE_PARTMENT = 20010; // 库管的权限（库管部人员）
const AH_CARRY_PARTMENT = 20011; // 搬货的权限（搬运部人员）
const AH_SECURITY_CHECK_PARTMENT = 20012; // 安检的权限（保安部人员）
const AH_DISTRIBUTION_PARTMENT = 20013; // 配送的权限（配送部人员）
const AH_TO_EXAMINE_TRUCK = 20014; // 审核货车的权限
const AH_CREATE_WAREHOUSE = 20015; // 创建仓库的权限
const AH_MODIFY_WAREHOUSE = 20016; // 修改仓库信息的权限
const AH_REMOVE_WAREHOUSE = 20017; // 删除仓库的权限
const AH_LOOK_WAREHOUSE = 20018; // 查看仓库的权限

// 物流公司
const AH_MODIFY_SHIPPER_INFO = 30000; // 修改物流公司信息的权限
const AH_MODIFY_SHIPPER_MEMBER_AUTHORITY = 30001; // 修改物流公司成员权限的权限
const AH_CREATE_ROADMAP = 30002; // 创建路线的权限
const AH_MODIFY_ROADMAP = 30003; // 修改路线的权限
const AH_REMOVE_ROADMAP = 30004; // 删除路线的权限
const AH_LOOK_ROADMAP = 30005; // 查看路线的权限 (分店共享该权限)
const AH_CREATE_SEND_DOOR_ROADMAP = 30006; // 创建同城配送路线的权限
const AH_MODIFY_SEND_DOOR_ROADMAP = 30007; // 修改同城配送路线的权限
const AH_REMOVE_SEND_DOOR_ROADMAP = 30008; // 删除同城配送路线的权限
const AH_LOOK_SEND_DOOR_ROADMAP = 30009; // 查看同城配送路线的权限 (分店共享该权限)
const AH_CREATE_TRUCK = 30010; // 创建货车的权限
const AH_MODIFY_TRUCK = 30011; // 修改货车的权限
const AH_REMOVE_TRUCK = 30012; // 删除货车的权限
const AH_LOOK_TRUCK = 30013; // 查看货车的权限
const SELECT_CARRY_PARTMENT = 30014; // 选择搬运队的权限
const AH_SCAN_LOAD_TRUCK = 30015; // 扫描装车的权限

// 收货点
const AH_MODIFY_AGENT_INFO = 40000; // 修改收货点信息的权限
const AH_MODIFY_AGENT_MEMBER_AUTHORITY = 40001; // 修改收货点成员权限的权限
const AH_PLACE_ORDER = 40002; // 收货点下单的权限

export default {
    // 总部权限
    AH_CREATE_BRANCH_SHOP,
    AH_MODIFY_BRANCH_SHOP,
    AH_REMOVE_BRANCH_SHOP,
    AH_LOOK_BRANCH_SHOP,
    AH_MODIFY_SETTING,
    AH_CREATE_AGENT,
    AH_MODIFY_AGENT,
    AH_REMOVE_AGENT,
    AH_LOOK_AGENT,

    // 公共权限
    AH_MODIFY_OWN_SHOP,
    AH_CREATE_MEMBER,
    AH_MODIFY_MEMBER,
    AH_REMOVE_MEMBER,
    AH_LOOK_MEMBER,
    AH_RECHARGE,
    AH_WITHDRAW,
    AH_LOOK_AMOUNT,
    AH_MODIFY_ROADMAP_PROFIT,
    AH_LOOK_STATISTICS,
    AH_LOOK_ORDERS,

    // 分店权限
    AH_CREATE_SHIPPER,
    AH_MODIFY_SHIPPER,
    AH_REMOVE_SHIPPER,
    AH_LOOK_SHIPPER,
    AH_CREATE_PARTMENT,
    AH_MODIFY_PARTMENT,
    AH_REMOVE_PARTMENT,
    AH_LOOK_PARTMENT,
    AH_MODIFY_OWN_PARTMENT,
    AH_RECEIVE_PARTMENT,
    AH_WARE_HOUSE_PARTMENT,
    AH_CARRY_PARTMENT,
    AH_SECURITY_CHECK_PARTMENT,
    AH_DISTRIBUTION_PARTMENT,
    AH_TO_EXAMINE_TRUCK,
    AH_CREATE_WAREHOUSE,
    AH_MODIFY_WAREHOUSE,
    AH_REMOVE_WAREHOUSE,
    AH_LOOK_WAREHOUSE,

    // 物流公司
    AH_MODIFY_SHIPPER_INFO,
    AH_MODIFY_SHIPPER_MEMBER_AUTHORITY,
    AH_CREATE_ROADMAP,
    AH_MODIFY_ROADMAP,
    AH_REMOVE_ROADMAP,
    AH_LOOK_ROADMAP,
    AH_CREATE_SEND_DOOR_ROADMAP,
    AH_MODIFY_SEND_DOOR_ROADMAP,
    AH_REMOVE_SEND_DOOR_ROADMAP,
    AH_LOOK_SEND_DOOR_ROADMAP,
    AH_CREATE_TRUCK,
    AH_MODIFY_TRUCK,
    AH_REMOVE_TRUCK,
    AH_LOOK_TRUCK,
    SELECT_CARRY_PARTMENT,
    AH_SCAN_LOAD_TRUCK,

    // 收货点
    AH_MODIFY_AGENT_INFO,
    AH_MODIFY_AGENT_MEMBER_AUTHORITY,
    AH_PLACE_ORDER,

    // mapper
    MAP: {
        // 总部权限
        [AH_CREATE_BRANCH_SHOP]: '创建分店的权限',
        [AH_MODIFY_BRANCH_SHOP]: '修改分店信息的权限',
        [AH_REMOVE_BRANCH_SHOP]: '删除分店的权限',
        [AH_LOOK_BRANCH_SHOP]: '查看分店的权限',
        [AH_MODIFY_SETTING]: '修改设置的权限',
        [AH_CREATE_AGENT]: '创建收货点的权限',
        [AH_MODIFY_AGENT]: '修改收货点的权限',
        [AH_REMOVE_AGENT]: '删除收货点的权限',
        [AH_LOOK_AGENT]: '查看收货点的权限',

        // 公共权限
        [AH_MODIFY_OWN_SHOP]: '修改自身店铺信息的权限',
        [AH_CREATE_MEMBER]: '创建成员的权限',
        [AH_MODIFY_MEMBER]: '修改成员信息的权限',
        [AH_REMOVE_MEMBER]: '删除成员的权限',
        [AH_LOOK_MEMBER]: '查看成员的权限',
        [AH_RECHARGE]: '充值的权限',
        [AH_WITHDRAW]: '提现的权限',
        [AH_LOOK_AMOUNT]: '查看余额的权限',
        [AH_MODIFY_ROADMAP_PROFIT]: '修改路线的提成的权限',
        [AH_LOOK_STATISTICS]: '查看统计信息的权限',
        [AH_LOOK_ORDERS]: '查看综合货单的权限',

        // 分店权限
        [AH_CREATE_SHIPPER]: '创建物流公司',
        [AH_MODIFY_SHIPPER]: '修改物流公司',
        [AH_REMOVE_SHIPPER]: '删除物流公司',
        [AH_LOOK_SHIPPER]: '查看物流公司',
        [AH_CREATE_PARTMENT]: '创建部门的权限',
        [AH_MODIFY_PARTMENT]: '修改部门信息的权限',
        [AH_REMOVE_PARTMENT]: '删除部门的权限',
        [AH_LOOK_PARTMENT]: '查看部门的权限',
        [AH_MODIFY_OWN_PARTMENT]: '修改所在部门信息的权限',
        [AH_RECEIVE_PARTMENT]: '收货的权限',
        [AH_WARE_HOUSE_PARTMENT]: '库管的权限',
        [AH_CARRY_PARTMENT]: '搬货的权限',
        [AH_SECURITY_CHECK_PARTMENT]: '安检的权限',
        [AH_DISTRIBUTION_PARTMENT]: '配送的权限',
        [AH_TO_EXAMINE_TRUCK]: '审核货车的权限',
        [AH_CREATE_WAREHOUSE]: '创建仓库的权限',
        [AH_MODIFY_WAREHOUSE]: '修改仓库信息的权限',
        [AH_REMOVE_WAREHOUSE]: '删除仓库的权限',
        [AH_LOOK_WAREHOUSE]: '查看仓库的权限',

        // 物流公司
        [AH_MODIFY_SHIPPER_INFO]: '修改物流公司信息的权限',
        [AH_MODIFY_SHIPPER_MEMBER_AUTHORITY]: '修改物流公司成员权限的权限',
        [AH_CREATE_ROADMAP]: '创建路线的权限',
        [AH_MODIFY_ROADMAP]: '修改路线的权限',
        [AH_REMOVE_ROADMAP]: '删除路线的权限',
        [AH_LOOK_ROADMAP]: '查看路线的权限',
        [AH_CREATE_SEND_DOOR_ROADMAP]: '创建同城配送路线的权限',
        [AH_MODIFY_SEND_DOOR_ROADMAP]: '修改同城配送路线的权限',
        [AH_REMOVE_SEND_DOOR_ROADMAP]: '删除同城配送路线的权限',
        [AH_LOOK_SEND_DOOR_ROADMAP]: '查看同城配送路线的权限',
        [AH_CREATE_TRUCK]: '创建货车的权限',
        [AH_MODIFY_TRUCK]: '修改货车的权限',
        [AH_REMOVE_TRUCK]: '删除货车的权限',
        [AH_LOOK_TRUCK]: '查看货车的权限',
        [SELECT_CARRY_PARTMENT]: '选择搬运队的权限',
        [AH_SCAN_LOAD_TRUCK]: '扫描装车的权限',

        // 收货点
        [AH_MODIFY_AGENT_INFO]: '修改收货点信息的权限',
        [AH_MODIFY_AGENT_MEMBER_AUTHORITY]: '修改收货点成员权限的权限',
        [AH_PLACE_ORDER]: '收货点下单的权限',
    },
};

```

* PDShop_Shop_PC/project/App/shared/constants/common.js

```js
// 注意：常量部分必须和服务器保持一致

const ST_LONG = 0; // 长途物流公司
const ST_CITY = 1; // 同城配送物流公司

// 方向设置的类型
export const RRT_ALL = 0; // 所有
export const RRT_LONG = 1; // 长途
export const RRT_CITY = 2; // 同城配送

export default {
    ST_LONG,
    ST_CITY,

    RRT_ALL,
    RRT_LONG,
    RRT_CITY,

    // mapper
    SHIPPER_TYPE_MAP: {
        [ST_LONG]: '长途运输',
        [ST_CITY]: ' 同城配送',
    },

    RRT_MAP: {
        [RRT_ALL]: '长途 & 同城',
        [RRT_LONG]: ' 长途运输',
        [RRT_CITY]: ' 同城配送',
    },
};

```

* PDShop_Shop_PC/project/App/shared/constants/index.js

```js
export AH from './authority';
export PO from './post';
export SP from './partment';
export OS from './orderState';
export CO from './common';

```

* PDShop_Shop_PC/project/App/shared/constants/orderState.js

```js
// 注意：常量部分必须和服务器保持一致
// 订单的状态
/*
===========
长途运输状态图:
(0->)1->2->5    |
                |->6->7->8(->11)->14->15
(0->)1->3->4->5 |
===========
收货点状态图:
0->2->9    |
           |(->10)->11->14->15
0->3->4->9 |
===========
同城配送状态图: (当同城配送的在运输中，那么它之前的货单就在待交货状态)
(0->)1->2    |
             |->6->8->15
(0->)1->3->4 |
===========
上门自提状态图:(当上门自提的在运输中或者等待上门自提，那么它之前的货单就在待交货状态)
      |->13->15
1->12 |
      |->6->8->15
*/
const OS_PREORDER = -1; // 预下单状态，需要将货拉到分店后不显示（件数，重量，方量），由收货员填写确认后进入待选线路状态
const OS_READY_PRINT_BAR_CODE = 0; // 待打印二维码
const OS_READY_SELECT_ROADMAP = 1; // 待选物流公司
const OS_READY_DEDUCT_AND_PRINT_ORDER = 2; // 待扣款并打印打印货单（用来区别需要付款的情况）
const OS_READY_PAYMENT = 3; // 待付款
const OS_READY_PRINT_ORDER = 4; // 待打印货单
const OS_READY_STOCK = 5; // 待入库
const OS_READY_LOAD = 6; // 待装车
const OS_READY_START_OFF = 7; // 待出发
const OS_ON_THE_WAY = 8; // 运输中
const OS_READY_SEND = 9; // 待发货 (收货点专用)
const OS_ON_SENDING = 10; // 发货中 (收货点专用)
const OS_ON_TRANSFER = 11; // 中转中
const OS_READY_PHONE_CONFIRM = 12; // 待打电话确认
const OS_WAIT_CLIENT_PICK = 13; // 等待上门自提
const OS_READY_RECEIVE = 14; // 待交货
const OS_RECEIVE_SUCCESS = 15; // 交货成功

export default {
    OS_PREORDER,
    OS_READY_PRINT_BAR_CODE,
    OS_READY_SELECT_ROADMAP,
    OS_READY_DEDUCT_AND_PRINT_ORDER,
    OS_READY_PAYMENT,
    OS_READY_PRINT_ORDER,
    OS_READY_STOCK,
    OS_READY_LOAD,
    OS_READY_START_OFF,
    OS_ON_THE_WAY,
    OS_READY_SEND,
    OS_ON_SENDING,
    OS_ON_TRANSFER,
    OS_READY_PHONE_CONFIRM,
    OS_WAIT_CLIENT_PICK,
    OS_READY_RECEIVE,
    OS_RECEIVE_SUCCESS,

    // mapper
    MAP: {
        [OS_PREORDER]: '预下单状态',
        [OS_READY_PRINT_BAR_CODE]: '待打印二维码',
        [OS_READY_SELECT_ROADMAP]: '待选线路',
        [OS_READY_DEDUCT_AND_PRINT_ORDER]: '待打印收据',
        [OS_READY_PAYMENT]: '待付款',
        [OS_READY_PRINT_ORDER]: '待打印收据',
        [OS_READY_STOCK]: '待入库',
        [OS_READY_LOAD]: '待装车',
        [OS_READY_START_OFF]: '待出发',
        [OS_ON_THE_WAY]: '运输中',
        [OS_READY_SEND]: '待发货',
        [OS_ON_SENDING]: '发货中',
        [OS_ON_TRANSFER]: '运输中',
        [OS_READY_PHONE_CONFIRM]: '待打电话确认',
        [OS_WAIT_CLIENT_PICK]: '等待上门自提',
        [OS_READY_RECEIVE]: '待交货',
        [OS_RECEIVE_SUCCESS]: '交货成功',
    },
};

```

* PDShop_Shop_PC/project/App/shared/constants/partment.js

```js
// 注意：常量部分必须和服务器保持一致
const SP_RECEIVE_PARTMENT = 0; // 收货部
const SP_WARE_HOUSE_PARTMENT = 1; // 库管部
const SP_CARRY_PARTMENT = 2; // 搬运部
const SP_SECURITY_CHECK_PARTMENT = 3; // 保安部

export default {
    SP_RECEIVE_PARTMENT,
    SP_WARE_HOUSE_PARTMENT,
    SP_CARRY_PARTMENT,
    SP_SECURITY_CHECK_PARTMENT,

    // mapper
    MAP: {
        [SP_RECEIVE_PARTMENT]: '收货部',
        [SP_WARE_HOUSE_PARTMENT]: '库管部',
        [SP_CARRY_PARTMENT]: '搬运部',
        [SP_SECURITY_CHECK_PARTMENT]: '保安部',
    },
};

```

* PDShop_Shop_PC/project/App/shared/constants/post.js

```js
const PO_CHAIR_MAN = '董事长';
const PO_PARTMENT_CHARGE_MAN = '部门经理';
const PO_CEO = '总经理';
const PO_PARTMENT_LEADER = '部门主管';
const PO_STAFF = '员工';

export default {
    PO_CHAIR_MAN,
    PO_PARTMENT_CHARGE_MAN,
    PO_CEO,
    PO_PARTMENT_LEADER,
    PO_STAFF,

    // 公司职位
    SHOP_MAP: [PO_STAFF, PO_CEO, PO_PARTMENT_LEADER],
    // 部门职位
    PARTMENT_MAP: [PO_STAFF],
};

```

* PDShop_Shop_PC/project/App/shared/decorators/antd_form_create.js

```js
import { Form } from 'antd';
export default (target) => {
    const Component = Form.create()(target);
    Component.fragments = target.fragments;
    return Component;
};

```

* PDShop_Shop_PC/project/App/shared/helpers/configure-store.js

```js
import combineActionsMiddleware from 'redux-combine-actions';
import createLogger from 'redux-logger';
import reducer from 'reducers';
import thunkMiddleware from 'redux-thunk';
import { createStore, applyMiddleware, compose } from 'redux';

const middleware = [];

middleware.push(combineActionsMiddleware);
middleware.push(thunkMiddleware);

if (typeof window !== 'undefined' && module.hot) {
    middleware.push(createLogger());
}

export default function configureStore (routerMiddleware, initialState) {
    const store = compose(
    applyMiddleware(
      ...middleware
    ),
    routerMiddleware
  )(createStore)(reducer, initialState);

    if (module.hot) {
    // Enable Webpack hot module replacement for reducers
        module.hot.accept('../reducers', () => {
            const nextReducer = require('../reducers');
            store.replaceReducer(nextReducer);
        });
    }

    return store;
}

```

* PDShop_Shop_PC/project/App/shared/helpers/ga-send.js

```js
export default function gaSend () {
    if (typeof window !== 'undefined') {
        window.ga && window.ga('send', 'pageview');
    }
}

```

* PDShop_Shop_PC/project/App/shared/reducers/index.js

```js
import { combineReducers } from 'redux';
import { routerStateReducer as router } from 'redux-router';
import { relateReducer } from 'relatejs';

export const reducersToCombine = {
    relateReducer,
    router,
};
const rootReducer = combineReducers(reducersToCombine);

export default rootReducer;

```

* PDShop_Shop_PC/project/App/server/graphql/authorize.js

```js
export function authorize (root) {
    if (!root.user) {
        throw new Error('unauthorized');
    }
}

```

* PDShop_Shop_PC/project/App/shared/routers/auth.js

```js
import React from 'react';
import { Route } from 'react-router';
import gaSend from 'helpers/ga-send';
import Auth from 'pages/auth';
import Login from 'pages/auth/pages/login';
import ForgotPwd from 'pages/auth/pages/forgotPwd';

export default [
    <Route component={Auth}>
        <Route path='/shop/login' component={Login} onEnter={gaSend} />
        <Route path='/shop/forgotPwd' component={ForgotPwd} onEnter={gaSend} />
    </Route>,
];

```

* PDShop_Shop_PC/project/App/shared/routers/public.js

```js
// import React from 'react';
// import {Route} from 'react-router';

export default [];

```

* PDShop_Shop_PC/project/App/shared/routers/shop.js

```js
import React from 'react';
import { Route, IndexRoute } from 'react-router';
import request from 'superagent';
import Shop from 'pages/shop';
import Home from 'pages/shop/pages/home';
import Personal from 'pages/shop/pages/personal';
import PaymentPwd from 'pages/shop/pages/personal/pages/paymentPwd';
import OwnShop from 'pages/shop/pages/ownShop';
import Partment from 'pages/shop/pages/partment';
import Partments from 'pages/shop/pages/partments';
import PartmentDetail from 'pages/shop/pages/partments/pages/detail';
import Members from 'pages/shop/pages/members';
import MemberDetail from 'pages/shop/pages/members/pages/detail';
import BranchShops from 'pages/shop/pages/branchShops';
import BranchShopDetail from 'pages/shop/pages/branchShops/pages/detail';
import Agents from 'pages/shop/pages/agents';
import AgentDetail from 'pages/shop/pages/agents/pages/detail';
import AgentRegister from 'pages/shop/pages/agents/pages/register';
import Shippers from 'pages/shop/pages/shippers';
import ShipperDetail from 'pages/shop/pages/shippers/pages/detail';
import ShipperRegister from 'pages/shop/pages/shippers/pages/register';
import Clients from 'pages/shop/pages/clients';
import ClientDetail from 'pages/shop/pages/clients/pages/detail';
import Roadmaps from 'pages/shop/pages/roadmaps';
import RoadmapDetail from 'pages/shop/pages/roadmaps/pages/detail';
import RegionRates from 'pages/shop/pages/regionRates';
import RegionRateDetail from 'pages/shop/pages/regionRates/pages/detail';
import PlaceOrder from 'pages/shop/pages/placeOrder';
import BROrders from 'pages/shop/pages/orders';
import BROrderDetail from 'pages/shop/pages/orders/pages/detail';
import RPOrders from 'pages/shop/pages/rporders';
import RPOrderDetail from 'pages/shop/pages/rporders/pages/detail';
import WHOrders from 'pages/shop/pages/whorders';
import WHOrderDetail from 'pages/shop/pages/whorders/pages/detail';
import Trucks from 'pages/shop/pages/trucks';
import Bills from 'pages/shop/pages/bills';
import Feedback from 'pages/shop/pages/feedback';
import Setting from 'pages/shop/pages/setting';
import Notify from 'pages/shop/pages/notifies';
import Statistics from 'pages/shop/pages/statistics';
import SendNotify from 'pages/shop/pages/notifies/pages/sendNotify';
import Warehouses from 'pages/shop/pages/warehouse';
import WarehouseDetail from 'pages/shop/pages/warehouse/pages/detail';

let firstEntry = true;

function authenticate (nextState, replaceState, callback) {
    if (typeof window !== 'undefined' && !firstEntry) {
        request
        .post('/shop/graphql')
        .set('Content-Type', 'application/json')
        .set('Accept', 'application/json')
        .send({
            query: 'query { session }',
        })
        .end((error, result) => {
            if (error || !result.body.data.session) {
                window.location.href = '/shop/login';
            } else {
                callback();
            }
        });
    } else {
        firstEntry = false;
        callback();
    }
}

export default [
    <Route name='shop' path='/shop' component={Shop}>
        <IndexRoute component={Home} onEnter={authenticate} />
        <Route name='shopPersonal' path='personal'>
            <IndexRoute component={Personal} onEnter={authenticate} />
            <Route name='shopPaymentPwd' path='paymentPwd' component={PaymentPwd} onEnter={authenticate} />
        </Route>
        <Route name='shopOwnShop' path='ownShop' component={OwnShop} onEnter={authenticate} />
        <Route name='shopPartment' path='partment' component={Partment} onEnter={authenticate} />
        <Route name='shopPartments' path='partments'>
            <IndexRoute component={Partments} onEnter={authenticate} />
            <Route name='shopPartmentDetail' path='detail' component={PartmentDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopMembers' path='members'>
            <IndexRoute component={Members} onEnter={authenticate} />
            <Route name='shopMemberDetail' path='detail' component={MemberDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopBranchShops' path='branchShops'>
            <IndexRoute component={BranchShops} onEnter={authenticate} />
            <Route name='shopBranchShopDetail' path='detail' component={BranchShopDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopAgents' path='agents'>
            <IndexRoute component={Agents} onEnter={authenticate} />
            <Route name='shopAgentDetail' path='detail' component={AgentDetail} onEnter={authenticate} />
            <Route name='shopAgentRegister' path='register' component={AgentRegister} onEnter={authenticate} />
        </Route>
        <Route name='shopShippers' path='shippers'>
            <IndexRoute component={Shippers} onEnter={authenticate} />
            <Route name='shopShipperDetail' path='detail' component={ShipperDetail} onEnter={authenticate} />
            <Route name='shopShipperRegister' path='register' component={ShipperRegister} onEnter={authenticate} />
        </Route>
        <Route name='shopClients' path='clients'>
            <IndexRoute component={Clients} onEnter={authenticate} />
            <Route name='shopClientDetail' path='detail' component={ClientDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopRoadmaps' path='roadmaps'>
            <IndexRoute component={Roadmaps} onEnter={authenticate} />
            <Route name='shopRoadmapDetail' path='detail' component={RoadmapDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopRegionRates' path='regionRates'>
            <IndexRoute component={RegionRates} onEnter={authenticate} />
            <Route name='shopRegionRateDetail' path='detail' component={RegionRateDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopPlaceOrder' path='placeOrder' component={PlaceOrder} onEnter={authenticate} />
        <Route name='shopBROrders' path='orders'>
            <IndexRoute component={BROrders} onEnter={authenticate} />
            <Route name='shopBROrderDetail' path='detail' component={BROrderDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopRPOrders' path='rporders'>
            <IndexRoute component={RPOrders} onEnter={authenticate} />
            <Route name='shopRPOrderDetail' path='detail' component={RPOrderDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopWHOrders' path='whorders'>
            <IndexRoute component={WHOrders} onEnter={authenticate} />
            <Route name='shopWHOrderDetail' path='detail' component={WHOrderDetail} onEnter={authenticate} />
        </Route>
        <Route name='shopTrucks' path='trucks' component={Trucks} onEnter={authenticate} />
        <Route name='shopBills' path='bills' component={Bills} onEnter={authenticate} />
        <Route name='shopSetting' path='setting' component={Setting} onEnter={authenticate} />
        <Route name='shopStatistics' path='statistics' component={Statistics} onEnter={authenticate} />
        <Route name='shopFeedback' path='feedback' component={Feedback} onEnter={authenticate} />
        <Route name='shopNotify' path='notifies'>
            <IndexRoute component={Notify} onEnter={authenticate} />
            <Route name='shopSendNotify' path='sendNotify' component={SendNotify} onEnter={authenticate} />
        </Route>
        <Route name='warehouse' path='warehouses' onEnter={authenticate} >
            <IndexRoute component={Warehouses} onEnter={authenticate} />
            <Route name='warehouseDetail' path='detail' component={WarehouseDetail} onEnter={authenticate} />
        </Route>
    </Route>,
];

```

* PDShop_Shop_PC/project/App/shared/relatejs/index.js

```js
import { mergeFragments } from './helpers/fragments';

import actionTypes from './actions/types';
import capture from './helpers/capture';
import dataConnect from './decorators/data-connect';
import getDataDependencies from './server/get-data-dependencies';
import mutation from './actions/mutation';
import rootDataConnect from './decorators/root-data-connect';
import { setHeader, removeHeader, setEndpoint, setBody, removeBody } from './actions/settings';
import { relateReducer, relateReducerInit } from './reducer/reducer';
import { apiQuery, apiMutation } from './redirect-graphql';
import KeepData from './store/keep-data';
import GlobalData from './store/global-data';

export {
    dataConnect,
    rootDataConnect,
    relateReducer,
    relateReducerInit,
    actionTypes,
    mutation,
    mergeFragments,
    setHeader,
    removeHeader,
    setEndpoint,
    setBody,
    removeBody,
    getDataDependencies,
    capture,
    apiQuery,
    apiMutation,
    KeepData,
    GlobalData,
};

export default {
    dataConnect,
    rootDataConnect,
    relateReducer,
    relateReducerInit,
    actionTypes,
    mutation,
    mergeFragments,
    setHeader,
    removeHeader,
    setEndpoint,
    setBody,
    removeBody,
    getDataDependencies,
    capture,
    apiQuery,
    apiMutation,
    KeepData,
    GlobalData,
};

```

* PDShop_Shop_PC/project/App/server/routers/auth.js

```js
import getDefaultFavicon from 'helpers/default-favicon';
import getMarkup from 'helpers/get-markup';
import routeHandler from 'helpers/route-handler';
import routes from 'routers/auth';
import { Router } from 'express';

const authRouter = new Router();

function injectScript (req, res, next) {
    if (process.env.NODE_ENV === 'production') {
        res.locals.header.push({
            tag: 'link',
            props: {
                rel: 'stylesheet',
                type: 'text/css',
                href: '/shop/assets/auth.css',
            },
        });
        // res.locals.header.push({
        //     tag: 'link',
        //     props: {
        //         rel: 'stylesheet',
        //         type: 'text/css',
        //         href: '/shop/assets/common.js.css',
        //     },
        // });
    }
    res.locals.header.push(getDefaultFavicon(res));
    res.locals.footer.push({
        tag: 'script',
        props: {
            src: `${res.baseScriptsURL}/shop/assets/auth.js`,
        },
    });
    next();
}

authRouter.get('/shop/login', (req, res, next) => {
    if (req.isAuthenticated()) {
        res.redirect('/shop');
    } else {
        routeHandler(routes, req, res, next);
    }
});

authRouter.get('/shop/logout', (req, res) => {
    req.logout();
    res.redirect('/shop/login');
});

authRouter.get(/^\/shop\/(register|forgotPwd)$/, (req, res, next) => {
    routeHandler(routes, req, res, next);
});

// Register | ForgotPwd
authRouter.get(/^\/shop\/(register|forgotPwd)$/, injectScript, async (req, res, next) => {
    res.status(200).send(getMarkup(req, res));
});

// Login
authRouter.get('/shop/login', injectScript, (req, res) => {
    if (req.isAuthenticated()) {
        res.redirect('/shop');
    } else {
        res.status(200).send(getMarkup(req, res));
    }
});

export default authRouter;

```

* PDShop_Shop_PC/project/App/server/routers/index.js

```js
import shopRouter from './shop';
import authRouter from './auth';
import publicRouter from './public';

export default {
    shopRouter,
    authRouter,
    publicRouter,
};

```

* PDShop_Shop_PC/project/App/server/routers/public.js

```js
import { Router } from 'express';
import request from 'request';
import { urls } from 'helpers/api';

const publicRouter = new Router();

publicRouter.post('/api/uploadFile', (req, res) => {
    req.pipe(request(urls.uploadFile)).pipe(res);
});

export default publicRouter;

```

* PDShop_Shop_PC/project/App/server/routers/shop.js

```js
import getBaseComponent from 'helpers/get-base-component';
import getDefaultFavicon from 'helpers/default-favicon';
import renderHtml from 'helpers/render-html';
import routeHandler from 'helpers/route-handler';
import routes from 'routers/shop';
import { Router } from 'express';
import { graphql } from 'graphql';
import { getDataDependencies } from 'relatejs';

import schema from '../schema';

const shopRouter = new Router();

shopRouter.get(/^\/shop\/.+/, (req, res, next) => {
    if (req.isAuthenticated()) {
        res.redirect('/shop');
    } else {
        next();
    }
});

shopRouter.get('/shop*', (req, res, next) => {
    if (req.isAuthenticated()) {
        if (process.env.NODE_ENV === 'production') {
            res.locals.header.push(getDefaultFavicon(res));
            res.locals.header.push({
                tag: 'link',
                props: {
                    rel: 'stylesheet',
                    type: 'text/css',
                    href: '/shop/assets/shop.css',
                },
            });
            // res.locals.header.push({
            //     tag: 'link',
            //     props: {
            //         rel: 'stylesheet',
            //         type: 'text/css',
            //         href: '/shop/assets/common.js.css',
            //     },
            // });
        }
        res.locals.footer.push({
            tag: 'script',
            props: {
                src: `${res.baseScriptsURL}/shop/assets/shop.js`,
            },
        });
        next();
    } else {
        res.redirect('/shop/login');
    }
});

shopRouter.get('/shop*', (req, res, next) => {
    if (req.isAuthenticated()) {
        routeHandler(routes, req, res, next);
    } else {
        next();
    }
});

shopRouter.get('/shop*', async (req, res, next) => {
    if (req.isAuthenticated() && req.routerState) {
        // get component with redux provider and react router
        const component = getBaseComponent(req);
        // get relate js data dependencies
        await getDataDependencies(component, async (request) => await graphql(
            schema.getSchema(),
            request.query,
            {
                isAuthenticated: true,
                user: req.user,
            },
            request.variables
        ));

        // final render html
        res.status(200).send(renderHtml({
            component,
            store: req.store,
            locals: res.locals,
        }));
    } else {
        next();
    }
});

export default shopRouter;

```

* PDShop_Shop_PC/project/App/shared/pages/shop/index.js

```js
import React from 'react';
import { rootDataConnect } from 'relatejs';
import Shop from './contents';
import _ from 'lodash';

@rootDataConnect()
export default class ShopContainer extends React.Component {
    state = {
        personal: {},
        shop : {},
        printShow: false,
    };
    updatePersonal (personal) {
        this.setState({ personal });
    }
    updateShop (shop) {
        this.setState({ shop });
    }
    updatePrintShow (printShow) {
        this.setState({ printShow });
    }
    hasAuthority (...authority) {
        const { personal } = this.state;
        return !!_.intersection(personal.authority, authority).length;
    }
    render () {
        const { personal, shop, printShow } = this.state;
        return (
            <Shop {...this.props} printShow={printShow} rootPersonal={personal} rootShop={shop} hasAuthority={::this.hasAuthority}>
                {
                    React.cloneElement(this.props.children, {
                        rootPersonal: personal,
                        updatePersonal: ::this.updatePersonal,
                        rootShop: shop,
                        updateShop: ::this.updateShop,
                        updatePrintShow: ::this.updatePrintShow,
                        hasAuthority: ::this.hasAuthority,
                    })
                }
            </Shop>
        );
    }
}

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/index.js

```js
import * as personal from './personal';
import * as member from './member';
import * as shop from './shop';
import * as shipper from './shipper';
import * as agent from './agent';
import * as partment from './partment';
import * as order from './order';
import * as roadmap from './roadmap';
import * as setting from './setting';
import * as notify from './notify';
import * as warehouse from './warehouse';

export default {
    ...personal,
    ...member,
    ...shop,
    ...shipper,
    ...agent,
    ...partment,
    ...order,
    ...roadmap,
    ...setting,
    ...notify,
    ...warehouse,
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/index.js

```js
import * as common from './common';
import * as personal from './personal';
import * as account from './account';
import * as shop from './shop';
import * as partment from './partment';
import * as member from './member';
import * as shipper from './shipper';
import * as agent from './agent';
import * as client from './client';
import * as roadmap from './roadmap';
import * as order from './order';
import * as setting from './setting';
import * as statistic from './statistic';
import * as notify from './notify';
import * as warehouse from './warehouse';

export default {
    ...common,
    ...account,
    ...personal,
    ...shop,
    ...partment,
    ...member,
    ...shipper,
    ...agent,
    ...client,
    ...roadmap,
    ...order,
    ...setting,
    ...statistic,
    ...notify,
    ...warehouse,
};

```

* PDShop_Shop_PC/project/App/server/graphql/types/account.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
} from 'graphql';
import { makeResultType } from './common';

export const accountType = new GraphQLObjectType({
    name: 'accountType',
    fields: {
        amount: { type: GraphQLFloat },
        qrcode: { type: GraphQLString },
    },
});
export const accountResultType = makeResultType('accountResultType', accountType);

export const accountInputType = new GraphQLInputObjectType({
    name: 'accountInputType',
    fields: {
        amount: { type: GraphQLFloat },
        body: { type: GraphQLString },
        payPassword: { type: GraphQLString },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/agent.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType, descriptType, descriptInputType } from './common';
import { clientType } from './client';

export const agentType = new GraphQLObjectType({
    name: 'agentType',
    fields: {
        // 列表的字段
        id: { type: GraphQLID },
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        addressRegion: { type: GraphQLString },
        addressRegionLastCode: { type: GraphQLInt },
        address: { type: GraphQLString },
        location: { type: new GraphQLList(GraphQLFloat) },
        phoneList:  { type: GraphQLString },
        name: { type: GraphQLString },
        chairMan: { type: clientType },
        // 基本信息
        sign: { type: GraphQLString },
        descriptList:  { type: new GraphQLList(descriptType) },
        registerTime: { type: GraphQLString },
        // 法人
        legalName: { type: GraphQLString },
        legalPhone: { type: GraphQLString },
        legalIDCard: { type: new GraphQLList(GraphQLString) },
    },
});
export const agentResultType = makeResultType('agentResultType', agentType);
export const agentListType = makeListType('agentListType', agentType);

export const agentInputType = new GraphQLInputObjectType({
    name: 'agentInputType',
    fields: {
        agentId: { type: GraphQLID },
        chairManId: { type: GraphQLString },
        name: { type: GraphQLString },
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        addressRegion: { type: GraphQLString },
        addressRegionLastCode: { type: GraphQLInt },
        address: { type: GraphQLString },
        location: { type: new GraphQLList(GraphQLFloat) },
        phoneList:  { type: GraphQLString },
        descriptList:  { type: new GraphQLList(descriptInputType) },
        legalName: { type: GraphQLString },
        legalPhone: { type: GraphQLString },
        legalIDCard: { type: new GraphQLList(GraphQLString) },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/bill.js

```js
import {
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
} from 'graphql';

import { makeListType } from './common';

export const billType = new GraphQLObjectType({
    name: 'billType',
    fields: {
        tradeAmountYuan: { type: GraphQLFloat },
        tradeTime: { type: GraphQLString },
        thirdpartyAccount: { type: GraphQLString },
        remark: { type: GraphQLString },
    },
});
export const billItemListType = makeListType('billItemListType', billType, 'list');

```

* PDShop_Shop_PC/project/App/server/graphql/types/client.js

```js
import {
    GraphQLObjectType,
    GraphQLString,
    GraphQLInt,
    GraphQLID,
} from 'graphql';

import { makeResultType, makeListType } from './common';
export const clientType = new GraphQLObjectType({
    name: 'clientType',
    fields: {
        id: { type: GraphQLID },
        name: { type: GraphQLString },
        phone: { type: GraphQLString },
        email: { type: GraphQLString },
        head: { type: GraphQLString },
        birthday: { type: GraphQLString },
        age: { type: GraphQLInt },
        sex: { type: GraphQLInt },
        phoneList: { type: GraphQLString },
    },
});
export const clientResultType = makeResultType('clientResultType', clientType);
export const clientListType = makeListType('clientListType', clientType);

```

* PDShop_Shop_PC/project/App/server/graphql/types/common.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLBoolean,
    GraphQLInt,
    GraphQLList,
} from 'graphql';

export function makeResultType (name, type) {
    const base = {
        success: { type: GraphQLBoolean },
        msg: { type: GraphQLString },
    };
    const fields = type ? { ...base, context: { type: type } } : base;
    return new GraphQLObjectType({ name, fields });
}

export function makeListType (name, type, listName) {
    return new GraphQLObjectType({
        name,
        fields: {
            count: { type: GraphQLInt },
            [listName || name.replace(/Type$/, '')]: { type: new GraphQLList(type) },
        },
    });
}

export const successType = new GraphQLObjectType({
    name: 'successType',
    fields: {
        success: { type: GraphQLBoolean },
        msg: { type: GraphQLString },
    },
});

export const descriptType = new GraphQLObjectType({
    name: 'descriptType',
    fields: {
        img: { type: GraphQLString }, // 图片
        text: { type: GraphQLString }, // 描述
    },
});

export const descriptInputType = new GraphQLInputObjectType({
    name: 'descriptInputType',
    fields: {
        img: { type: GraphQLString }, // 图片
        text: { type: GraphQLString }, // 描述
    },
});

export const pointType = new GraphQLObjectType({
    name: 'pointType',
    fields: {
        name: { type: GraphQLString }, // 地名
        longitude: { type: GraphQLFloat }, // 经度
        latitude: { type: GraphQLFloat }, // 纬度
        locateTime: { type: GraphQLString }, // 定位时间
    },
});

export const pointInputType = new GraphQLInputObjectType({
    name: 'pointInputType',
    fields: {
        name: { type: GraphQLString }, // 地名
        longitude: { type: GraphQLFloat }, // 经度
        latitude: { type: GraphQLFloat }, // 纬度
    },
});

export const driverType = new GraphQLObjectType({
    name: 'driverType',
    fields: {
        name: { type: GraphQLString }, // 司机名字
        phone: { type: GraphQLString }, // 司机电话
    },
});

export const driverInputType = new GraphQLInputObjectType({
    name: 'driverInputType',
    fields: {
        name: { type: GraphQLString }, // 司机名字
        phone: { type: GraphQLString }, // 司机电话
    },
});

export const sizeType = new GraphQLObjectType({
    name: 'sizeType',
    fields: {
        length: { type: GraphQLFloat }, // 长度
        width: { type: GraphQLFloat }, // 宽度
        height: { type: GraphQLFloat }, // 高度
    },
});

export const sizeInputType = new GraphQLInputObjectType({
    name: 'sizeInputType',
    fields: {
        length: { type: GraphQLFloat }, // 长度
        width: { type: GraphQLFloat }, // 宽度
        height: { type: GraphQLFloat }, // 高度
    },
});

export const addressType = new GraphQLObjectType({
    name: 'addressType',
    fields: {
        parentCode: { type: GraphQLInt },
        code: { type: GraphQLInt },
        name: { type: GraphQLString },
        level: { type: GraphQLInt },
        isLeaf: { type: GraphQLBoolean },
    },
});

export const orderAddressType = new GraphQLObjectType({
    name: 'orderAddressType',
    fields: {
        addressList: { type: new GraphQLList(new GraphQLList(addressType)) },
        cityAddressList: { type: new GraphQLList(new GraphQLList(addressType)) },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/member.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { makeResultType, makeListType } from './common';

const innerPartmentType = new GraphQLObjectType({
    name: 'innerPartmentType',
    fields: {
        id: { type: GraphQLID },
        name:  { type: GraphQLString },
        type:  { type: GraphQLInt },
    },
});

export const memberType = new GraphQLObjectType({
    name: 'memberType',
    fields: {
        id: { type: GraphQLID },
        userId: { type: GraphQLID },
        name: { type: GraphQLString },
        phone: { type: GraphQLString },
        email: { type: GraphQLString },
        head: { type: GraphQLString },
        age: { type: GraphQLInt },
        sex: { type: GraphQLInt },
        post: { type: GraphQLString },
        authority: { type: new GraphQLList(GraphQLInt) },
        birthday: { type: GraphQLString },
        phoneList: { type: GraphQLString },
        partment: { type: innerPartmentType },
    },
});
export const memberResultType = makeResultType('memberResultType', memberType);
export const memberListType = makeListType('memberListType', memberType);

export const memberInputType = new GraphQLInputObjectType({
    name: 'memberInputType',
    fields: {
        userId: { type: GraphQLString },
        memberId: { type: GraphQLID },
        name: { type: GraphQLString },
        phone: { type: GraphQLString },
        password: { type: GraphQLString },
        email: { type: GraphQLString },
        head: { type: GraphQLString },
        sex: { type: GraphQLInt },
        post: { type: GraphQLString },
        authority: { type: new GraphQLList(GraphQLInt) },
        birthday: { type: GraphQLString },
        phoneList: { type: GraphQLString },
        partmentId: { type: GraphQLID },
        shopId: { type: GraphQLID },
        verifyCode: { type: GraphQLString },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/notify.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLID,
} from 'graphql';
import { makeResultType, makeListType } from './common';

export const notifyType = new GraphQLObjectType({
    name: 'notifyType',
    fields: {
        id: { type: GraphQLID },
        title: { type: GraphQLString },
        content: { type: GraphQLString },
        time: { type: GraphQLString },
        source: { type: GraphQLString },
    },
});
export const notifyResultType = makeResultType('notifyResultType', notifyType);
export const notifyListType = makeListType('notifyListType', notifyType);

export const notifyInputType = new GraphQLInputObjectType({
    name: 'notifyInputType',
    fields: {
        notifyId: { type: GraphQLID },
        type: { type: GraphQLString },
        title: { type: GraphQLString },
        content: { type: GraphQLString },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/order.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLBoolean,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType } from './common';
import { memberType } from './member';

const stateListType = new GraphQLObjectType({
    name: 'stateListType',
    fields: {
        state: { type: GraphQLInt },
        count: { type: GraphQLInt },
    },
});
export const orderType = new GraphQLObjectType({
    name: 'orderType',
    fields: {
        id: { type: GraphQLID },
        senderPhone: { type: GraphQLString },
        senderName: { type: GraphQLString },
        receiverPhone: { type: GraphQLString },
        receiverName: { type: GraphQLString },
        name: { type: GraphQLString },
        endPoint: { type: GraphQLString },
        endPointLastCode: { type: GraphQLInt },
        sendDoorEndPoint: { type: GraphQLString },
        sendDoorEndPointLastCode: { type: GraphQLInt },
        totalNumbers: { type: GraphQLInt },
        weight: { type: GraphQLFloat },
        size: { type: GraphQLFloat },
        proxyCharge: { type: GraphQLFloat },
        proxyChargeProfit: { type: GraphQLFloat },
        totalDesignatedFee: { type: GraphQLFloat },
        isReachPay: { type: GraphQLBoolean },
        isSendDoor: { type: GraphQLBoolean },
        isClientPick: { type: GraphQLBoolean },
        state: { type: GraphQLInt },
        placeOrderTime: { type: GraphQLString },
        // 价格
        realFee: { type: GraphQLFloat }, // 实际运费
        designatedFee: { type: GraphQLFloat }, // 指定收款
        needPayTransportFee: { type: GraphQLFloat }, // 应该付的运费
        needPayInsuanceFee: { type: GraphQLFloat }, // 应该付的保险金额
        photo: { type: GraphQLString }, // 图片
        // 保险
        isInsuance: { type: GraphQLBoolean },
        insuanceFee: { type: GraphQLFloat },
        insuanceMount: { type: GraphQLFloat },
        // 提成
        profit: { type: GraphQLFloat },
        masterProfit: { type: GraphQLFloat },
        branchProfit: { type: GraphQLFloat },
        // 其他
        warehouse: { type: GraphQLString }, // 仓库
        isCityDistribute: { type: GraphQLBoolean }, // 是否是同城配送
        payMode: { type: GraphQLInt }, // 支付方式 0：现付（PM_IMMEDIATE），1：到付（PM_REACH），2：混合支付（PM_MIXED 指定收款的部分到付，其余的现付）
        isTransferOrder: { type: GraphQLBoolean }, // 是否是中转单
        receiveMember: { type: memberType }, // 收货员
        stateList: { type: new GraphQLList(stateListType) }, // 状态列表
        deductError: { type: GraphQLBoolean }, // 扣款是否失败
    },
});
export const orderResultType = makeResultType('orderResultType', orderType);
export const orderListType = makeListType('orderListType', orderType);
export const orderItemListType = makeListType('orderItemListType', orderType, 'list');

export const orderInputType = new GraphQLInputObjectType({
    name: 'orderInputType',
    fields: {
        orderId: { type: GraphQLID },
        preOrderId: { type: GraphQLID },
        senderPhone: { type: GraphQLString },
        senderName: { type: GraphQLString },
        receiverPhone: { type: GraphQLString },
        receiverName: { type: GraphQLString },
        name: { type: GraphQLString },
        endPoint: { type: GraphQLString },
        endPointLastCode: { type: GraphQLInt },
        sendDoorEndPoint: { type: GraphQLString },
        sendDoorEndPointLastCode: { type: GraphQLInt },
        totalNumbers: { type: GraphQLInt },
        weight: { type: GraphQLFloat },
        size: { type: GraphQLFloat },
        proxyCharge: { type: GraphQLInt },
        totalDesignatedFee: { type: GraphQLInt },
        isCityDistribute: { type: GraphQLBoolean },
        isReachPay: { type: GraphQLBoolean },
        isSendDoor: { type: GraphQLBoolean },
        isInsuance: { type: GraphQLBoolean },
        roadmapId: { type: GraphQLID },
        roadmapRankIndex: { type: GraphQLInt },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/partment.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLBoolean,
    GraphQLInt,
    GraphQLID,
} from 'graphql';
import { makeResultType, makeListType } from './common';
import { memberType } from './member';

export const partmentType = new GraphQLObjectType({
    name: 'partmentType',
    fields: {
        id: { type: GraphQLID },
        name:  { type: GraphQLString },
        descript: { type: GraphQLString },
        type:  { type: GraphQLInt },
        phoneList: { type: GraphQLString },
        chargeMan: { type: memberType },
        price: { type: GraphQLFloat },
        enable: { type: GraphQLBoolean },
    },
});
export const partmentResultType = makeResultType('partmentResultType', partmentType);
export const partmentListType = makeListType('partmentListType', partmentType);

export const partmentInputType = new GraphQLInputObjectType({
    name: 'partmentInputType',
    fields: {
        partmentId: { type: GraphQLID },
        name:  { type: GraphQLString },
        descript: { type: GraphQLString },
        type:  { type: GraphQLInt },
        phoneList: { type: GraphQLString },
        chargeManPhone: { type: GraphQLString },
        chargeManName: { type: GraphQLString },
        chargeManPassword: { type: GraphQLString },
        price: { type: GraphQLFloat },
        enable: { type: GraphQLBoolean },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/roadmap.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType } from './common';
import { shipperType } from './shipper';
import { shopType } from './shop';

export const roadmapType = new GraphQLObjectType({
    name: 'roadmapType',
    fields: {
        id: { type: GraphQLID },
        // 选择物流公司的参数
        shipperName: { type: GraphQLString },
        transportFee: { type: GraphQLFloat },
        duration: { type: GraphQLFloat },
        price: { type: GraphQLFloat },
        minFee: { type: GraphQLFloat },
        sendDoorPrice: { type: GraphQLFloat },
        sendDoorMinFee: { type: GraphQLFloat },
        roadmapRankIndex: { type: GraphQLInt },
        // 路线列表的参数
        startPoint: { type: GraphQLString },
        endPoint: { type: GraphQLString },
        shipper: { type: shipperType },
        shop: { type: shopType },
        // 提成
        profitRate: { type: GraphQLFloat },
        defaultProfitRate: { type: GraphQLFloat },
        // 其他
        selfSignRate: { type: GraphQLFloat },
        createTime: { type: GraphQLString },
        setProfitRateTime: { type: GraphQLString },
    },
});
export const roadmapResultType = makeResultType('roadmapResultType', roadmapType);
export const roadmapListType = makeListType('roadmapListType', roadmapType);
export const roadmapInputType = new GraphQLInputObjectType({
    name: 'roadmapInputType',
    fields: {
        roadmapId: { type: GraphQLID },
        roadmapIdList: { type: new GraphQLList(GraphQLID) },
        profitRate: { type: GraphQLFloat },
    },
});

export const regionRateType = new GraphQLObjectType({
    name: 'regionRateType',
    fields: {
        id: { type: GraphQLID },
        // 路线列表的参数
        shop: { type: shopType },
        region: { type: GraphQLString },
        regionLastCode: { type: GraphQLInt },
        profitRate: { type: GraphQLFloat },
        type: { type: GraphQLInt },
        createTime: { type: GraphQLString },
        modifyTime: { type: GraphQLString },
    },
});
export const regionRateResultType = makeResultType('regionRateResultType', regionRateType);
export const regionRateListType = makeListType('regionRateListType', regionRateType);
export const regionRateInputType = new GraphQLInputObjectType({
    name: 'regionRateInputType',
    fields: {
        regionRateId: { type: GraphQLID },
        regionRateIdList: { type: new GraphQLList(GraphQLID) },
        shopId: { type: GraphQLID },
        region: { type: GraphQLString },
        regionLastCode: { type: GraphQLInt },
        profitRate: { type: GraphQLFloat },
        type: { type: GraphQLInt },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/setting.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLFloat,
    GraphQLList,
} from 'graphql';

import { makeResultType } from './common';

const gradientPriceType = new GraphQLObjectType({
    name: 'gradientPriceType',
    fields: {
        rate: { type: GraphQLFloat },
        min:  { type: GraphQLFloat },
    },
});

const gradientPriceInputType = new GraphQLInputObjectType({
    name: 'gradientPriceInputType',
    fields: {
        rate: { type: GraphQLFloat },
        min:  { type: GraphQLFloat },
    },
});

export const settingType = new GraphQLObjectType({
    name: 'settingType',
    fields: {
        sizeWeightRate: { type: GraphQLFloat }, // 方量和重量的计算比
        insuanceRate:  { type: GraphQLFloat }, // 担保保险的费用（客户实际付的钱）= 担保保险额度（需要赔偿用户的钱）* insuanceRate
        insuanceMountRate:  { type: GraphQLFloat }, // 保额相对于运费的多少倍，默认为10
        insuanceBaseValue:  { type: GraphQLFloat }, // 保险的最低值（默认为最低10元）
        proxyChargeProfitRate:  { type: GraphQLFloat }, //  手续费 = 代收货款 * proxyChargeProfitRate
        // 设置min必须从0开始，默认： [ {rate: 1.1, min: 0}, {rate: 1, min: 10}, {rate: 0.9, min: 20 } ] 如果物流公司设置的是100元/吨，表示0-10为110元/吨，10-20为100元/吨，20以上为90元/吨
        gradientPriceList: { type: new GraphQLList(gradientPriceType) }, // 每吨的价格，单位为元/吨（采用阶梯价格）
        additionalDeliverTime: { type: GraphQLFloat }, // 物流公司没有让货主确认附加的交易成功时间，单位小时(h)
        noticeShipperStorageWeight: { type: GraphQLFloat }, // 没多少吨货物放置后通知物流公司
        bondAmountWeightRate: { type: GraphQLFloat }, // 每吨货需要的保证金
        rankedMaskFirstRankWeight: { type: GraphQLFloat }, // 用来判断排名第一的物流公司的收购多少吨货被屏蔽的依据
        rankedMaskRateList: { type: new GraphQLList(GraphQLFloat) }, // 为了防止物流公司垄断，排在前3（数组的长度+1）名的需要轮流收货，第一名收货的量为rankedMaskFirstRankWeight*1，第二名为rankedMaskFirstRankWeight*0.8，第三名为rankedMaskFirstRankWeight*0.6。默认： [ 1, 0.8, 0.6 ]，屏蔽规则：见 RoadmapMaskModel
    },
});

export const settingInputType = new GraphQLInputObjectType({
    name: 'settingInputType',
    fields: {
        sizeWeightRate: { type: GraphQLFloat }, // 方量和重量的计算比
        insuanceRate:  { type: GraphQLFloat }, // 担保保险的费用（客户实际付的钱）= 担保保险额度（需要赔偿用户的钱）* insuanceRate
        insuanceMountRate:  { type: GraphQLFloat }, // 保额相对于运费的多少倍，默认为10
        insuanceBaseValue:  { type: GraphQLFloat }, // 保险的最低值（默认为最低10元）
        proxyChargeProfitRate:  { type: GraphQLFloat }, //  手续费 = 代收货款 * proxyChargeProfitRate
        // 设置min必须从0开始，默认： [ {rate: 1.1, min: 0}, {rate: 1, min: 10}, {rate: 0.9, min: 20 } ] 如果物流公司设置的是100元/吨，表示0-10为110元/吨，10-20为100元/吨，20以上为90元/吨
        gradientPriceList: { type: new GraphQLList(gradientPriceInputType) }, // 每吨的价格，单位为元/吨（采用阶梯价格）
        additionalDeliverTime: { type: GraphQLFloat }, // 物流公司没有让货主确认附加的交易成功时间，单位小时(h)
        noticeShipperStorageWeight: { type: GraphQLFloat }, // 没多少吨货物放置后通知物流公司
        bondAmountWeightRate: { type: GraphQLFloat }, // 每吨货需要的保证金
        rankedMaskFirstRankWeight: { type: GraphQLFloat }, // 用来判断排名第一的物流公司的收购多少吨货被屏蔽的依据
        rankedMaskRateList: { type: new GraphQLList(GraphQLFloat) }, // 为了防止物流公司垄断，排在前3（数组的长度+1）名的需要轮流收货，第一名收货的量为rankedMaskFirstRankWeight*1，第二名为rankedMaskFirstRankWeight*0.8，第三名为rankedMaskFirstRankWeight*0.6。默认： [ 1, 0.8, 0.6 ]，屏蔽规则：见 RoadmapMaskModel
    },
});
export const settingResultType = makeResultType('settingResultType', settingType);

```

* PDShop_Shop_PC/project/App/server/graphql/types/shipper.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType, descriptType, descriptInputType } from './common';
import { clientType } from './client';

export const bondCompanyType = new GraphQLObjectType({
    name: 'bondCompanyType',
    fields: {
        capital: { type: GraphQLFloat }, // 担保公司注册资金
        bondAmount: { type: GraphQLFloat }, // 担保金额
        name: { type: GraphQLString }, // 担保公司名称
        address: { type: GraphQLString }, // 担保公司地址
        phoneList: { type: GraphQLString }, // 担保公司电话
        legalName: { type: GraphQLString }, // 法人姓名
        legalPhone: { type: GraphQLString }, // 法人电话
        certificate: { type: new GraphQLList(GraphQLString) }, // 担保公司资格证书
        legalIDCard: { type: new GraphQLList(GraphQLString) }, // 法人身份证
    },
});
export const shipperType = new GraphQLObjectType({
    name: 'shipperType',
    fields: {
        // 列表的字段
        id: { type: GraphQLID },
        shipperType: { type: GraphQLInt },
        shopId: { type: GraphQLID },
        shopName: { type: GraphQLString },
        name: { type: GraphQLString },
        chairMan: { type: clientType },
        acountAmount: { type: GraphQLFloat },
        totalBondAmount: { type: GraphQLFloat },
        remainBondAmount: { type: GraphQLFloat },
        capital: { type: GraphQLFloat },
        // 基本信息
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        address: { type: GraphQLString },
        phoneList:  { type: GraphQLString },
        descriptList:  { type: new GraphQLList(descriptType) },
        registerTime: { type: GraphQLString },
        // 法人
        legalName: { type: GraphQLString },
        legalPhone: { type: GraphQLString },
        legalIDCard: { type: new GraphQLList(GraphQLString) },
        // 担保公司
        bondCompanyList: { type: new GraphQLList(bondCompanyType) },
    },
});
export const shipperResultType = makeResultType('shipperResultType', shipperType);
export const shipperListType = makeListType('shipperListType', shipperType);

export const bondCompanyInputType = new GraphQLInputObjectType({
    name: 'bondCompanyInputType',
    fields: {
        capital: { type: GraphQLFloat }, // 担保公司注册资金
        bondAmount: { type: GraphQLFloat }, // 担保金额
        name: { type: GraphQLString }, // 担保公司名称
        address: { type: GraphQLString }, // 担保公司地址
        phoneList: { type: GraphQLString }, // 担保公司电话
        legalName: { type: GraphQLString }, // 法人姓名
        legalPhone: { type: GraphQLString }, // 法人电话
        certificate: { type: new GraphQLList(GraphQLString) }, // 担保公司资格证书
        legalIDCard: { type: new GraphQLList(GraphQLString) }, // 法人身份证
    },
});
export const shipperInputType = new GraphQLInputObjectType({
    name: 'shipperInputType',
    fields: {
        shipperId: { type: GraphQLID },
        shipperType: { type: GraphQLInt },
        chairManId: { type: GraphQLString },
        name: { type: GraphQLString },
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        address: { type: GraphQLString },
        phoneList:  { type: GraphQLString },
        descriptList:  { type: new GraphQLList(descriptInputType) },
        capital: { type: GraphQLFloat },
        legalName: { type: GraphQLString },
        legalPhone: { type: GraphQLString },
        legalIDCard: { type: new GraphQLList(GraphQLString) },
        bondCompanyList: { type: new GraphQLList(bondCompanyInputType) },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/shop.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLBoolean,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { makeResultType, makeListType, descriptType, descriptInputType } from './common';

const memberInShopType = new GraphQLObjectType({
    name: 'memberInShopType',
    fields: {
        id: { type: GraphQLID },
        name: { type: GraphQLString },
        phone: { type: GraphQLString },
        head: { type: GraphQLString },
    },
});
export const shopType = new GraphQLObjectType({
    name: 'shopType',
    fields: {
        id: { type: GraphQLID },
        name: { type: GraphQLString },
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        phoneList: { type: GraphQLString },
        addressRegion: { type: GraphQLString },
        addressRegionLastCode: { type: GraphQLInt },
        address: { type: GraphQLString },
        location: { type: new GraphQLList(GraphQLFloat) },
        descriptList: { type: new GraphQLList(descriptType) },
        chairMan: { type: memberInShopType },
        profitRate: { type: GraphQLFloat },
        isMasterShop: { type: GraphQLBoolean },
    },
});
export const shopResultType = makeResultType('shopResultType', shopType);
export const branchShopListType = makeListType('branchShopListType', shopType);

export const shopInputType = new GraphQLInputObjectType({
    name: 'shopInputType',
    fields: {
        shopId: { type: GraphQLID },
        name: { type: GraphQLString },
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        phoneList: { type: GraphQLString },
        addressRegion: { type: GraphQLString },
        addressRegionLastCode: { type: GraphQLInt },
        address: { type: GraphQLString },
        location: { type: new GraphQLList(GraphQLFloat) },
        descriptList:  { type: new GraphQLList(descriptInputType) },
        profitRate: { type: GraphQLFloat },
        chairManPhone: { type: GraphQLString },
        chairManName: { type: GraphQLString },
        chairManPassword: { type: GraphQLString },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/statistic.js

```js
import {
    GraphQLObjectType,
    GraphQLFloat,
    GraphQLInt,
    GraphQLList,
} from 'graphql';

export const shopStatisticType = new GraphQLObjectType({
    name: 'shopStatisticType',
    fields: {
        count: { type: new GraphQLList(GraphQLInt) },
        isReachPay: { type: new GraphQLList(GraphQLInt) },
        isInsuance: { type: new GraphQLList(GraphQLInt) },
        insuanceMount: { type: new GraphQLList(GraphQLFloat) },
        insuanceFee: { type: new GraphQLList(GraphQLFloat) },
        realFee: { type: new GraphQLList(GraphQLFloat) },
        totalDesignatedFee: { type: new GraphQLList(GraphQLFloat) },
        proxyCharge: { type: new GraphQLList(GraphQLFloat) },
        masterProfit: { type: new GraphQLList(GraphQLFloat) },
        branchProfit: { type: new GraphQLList(GraphQLFloat) },
        weight: { type: new GraphQLList(GraphQLFloat) },
        size: { type: new GraphQLList(GraphQLFloat) },
    },
});

```

* PDShop_Shop_PC/project/App/server/graphql/types/truck.js

```js
import {
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
} from 'graphql';

import { makeResultType, makeListType, driverType } from './common';

export const truckType = new GraphQLObjectType({
    name: 'truckType',
    fields: {
        id: { type: GraphQLID }, // Id
        // 基本信息
        plateNo: { type: GraphQLString }, // 车牌号码
        drivingLicense: { type: GraphQLString }, // 行驶证编号
        truckType: { type: GraphQLString }, // 车型
        insuanceMount: { type: GraphQLFloat }, // 保险
        driver: { type: driverType }, // 司机的Id
        state: { type: GraphQLInt }, // 货车状态
    },
});

export const truckResultType = makeResultType('truckResultType', truckType);
export const truckListType = makeListType('truckListType', truckType);

```

* PDShop_Shop_PC/project/App/server/graphql/types/warehouse.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
    GraphQLFloat,
} from 'graphql';
import { makeResultType, makeListType } from './common';
import { memberType } from './member';
import { shipperType } from './shipper';

export const warehouseType = new GraphQLObjectType({
    name: 'warehouseType',
    fields: {
        id: { type: GraphQLID },
        shopId: { type: GraphQLID },
        shipperList: { type: new GraphQLList(shipperType) },
        houseMan: { type: memberType },
        houseNo: { type: GraphQLString },
        maxStoreWeight: { type: GraphQLFloat },
        maxStoreSize: { type: GraphQLFloat },
        orderCount: { type: GraphQLInt },
        totalNumbers: { type: GraphQLInt },
        totalWeight: { type: GraphQLFloat },
        totalSize: { type: GraphQLString },
    },
});
export const warehouseResultType = makeResultType('warehouseResultType', warehouseType);
export const warehouseListType = makeListType('warehouseListType', warehouseType);

export const warehouseInputType = new GraphQLInputObjectType({
    name: 'warehouseInputType',
    fields: {
        warehouseId: { type: GraphQLID },
        shopId: { type: GraphQLID },
        shipperList: { type: new GraphQLList(GraphQLID) },
        houseManId: { type: GraphQLID },
        houseNo: { type: GraphQLString },
        maxStoreWeight: { type: GraphQLFloat },
        maxStoreSize: { type: GraphQLFloat },
        orderCount: { type: GraphQLInt },
        totalNumbers: { type: GraphQLInt },
        totalWeight: { type: GraphQLFloat },
        totalSize: { type: GraphQLString },
    },
});

```

* PDShop_Shop_PC/project/App/shared/relatejs/actions/mutation.js

```js
import invariant from 'invariant';
import { buildQueryAndVariables } from '../helpers/fragments';

import actionTypes from './types';
import request from '../helpers/request';

export default function (options, callback = false) {
    return (dispatch, getState) => {
        invariant(options.fragments, 'Relate: Mutation needs fragments defined');

        const mutation = buildQueryAndVariables(options.fragments, options.variables, 'mutation');
        const { headers, endpoint, body, withCredentials } = getState().relateReducer;
        return request({
            dispatch,
            type: actionTypes.mutation,
            query: mutation.query,
            variables: mutation.variables,
            fragments: options.fragments,
            headers: options.headers || headers,
            body: options.body || body,
            endpoint: options.endpoint || endpoint,
            withCredentials,
        }).then((result) => {
            if (callback !== false) {
                callback(result, dispatch);
            }
        });
    };
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/actions/query.js

```js
import q from 'q';
import warning from 'warning';

import actionTypes from './types';
import request from '../helpers/request';

export default function graphql (
    { query, variables },
    fragments,
    connectors,
    scopes,
    config,
    relateSSR = false
) {
    return (dispatch, getState) => {
        let result;

        if (relateSSR) {
            result = q()
            .then(() => relateSSR({
                query,
                variables,
            }))
            .then(({ data, errors }) => {
                dispatch({
                    type: actionTypes.query,
                    data,
                    errors,
                    variables,
                    connectors,
                    scopes,
                    fragments,
                    isIntrospection: true,
                });
            })
            .catch((err) => {
                warning(false, err);
            });
        } else {
            const { headers, endpoint, body, withCredentials } = getState().relateReducer;
            result = request({
                dispatch,
                type: actionTypes.query,
                query,
                variables,
                connectors,
                scopes,
                fragments,
                headers: config && config.headers || headers,
                body: config && config.body || body,
                endpoint: config && config.endpoint || endpoint,
                withCredentials,
            });
        }

        return result;
    };
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/actions/remove-connector.js

```js
import actionTypes from './types';

export default function removeConnector (id) {
    return {
        type: actionTypes.removeConnector,
        id,
    };
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/actions/settings.js

```js
import actionTypes from './types';

export function setHeader (key, value) {
    return {
        type: actionTypes.setHeader,
        key,
        value,
    };
}

export function removeHeader (key) {
    return {
        type: actionTypes.removeHeader,
        key,
    };
}

export function setEndpoint (endpoint) {
    return {
        type: actionTypes.setEndpoint,
        endpoint,
    };
}

export function setBody (key, value) {
    return {
        type: actionTypes.setBody,
        key,
        value,
    };
}

export function removeBody (key) {
    return {
        type: actionTypes.removeBody,
        key,
    };
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/actions/types.js

```js
export default {
    query: 'RELATE_QUERY',
    mutation: 'RELATE_MUTATION',
    removeConnector: 'RELATE_REMOVE_CONNECTOR',
    setHeader: 'RELATE_SET_HEADER',
    removeHeader: 'RELATE_REMOVE_HEADER',
    setEndpoint: 'RELATE_SET_ENDPOINT',
    setBody: 'RELATE_SET_BODY',
    removeBody: 'RELATE_REMOVE_BODY',
};

```

* PDShop_Shop_PC/project/App/shared/relatejs/decorators/data-connect.js

```js
import React, { Component, PropTypes } from 'react';

import { connect } from 'react-redux';
import { generateConnectorId } from '../helpers/connectors-ids';
import getVariables from '../helpers/get-variables';
import hoistStatics from 'hoist-non-react-statics';
import invariant from 'invariant';
import removeConnector from '../actions/remove-connector';
import KeepData from '../store/keep-data';
import _ from 'lodash';

export default function dataConnect (...args) {
    const { length } = args;
    let getReduxState, getReduxDispatches, getBundle;
    invariant(length, 'Relate: a dataConnect does not have arguments specified');
    if (length === 1) {
        getBundle = args[0];
    } else {
        getReduxState = args[0];
        getReduxDispatches = args[1];
        getBundle = args[2];
    }

    return function wrapWithDataConnect (WrappedComponent) {
        class ConnectData extends Component {
            static propTypes = {
                relateConnectorData: PropTypes.object,
                CONNECTOR_ID: PropTypes.string.isRequired,
            };

            static contextTypes = {
                fetchData: PropTypes.func.isRequired,
                store: PropTypes.any.isRequired,
                relate_ssr: PropTypes.func,
            };

            static defaultProps = {
                relateConnectorData: {},
            };

            static relateIdentifier = 'DATA_CONNECT';

            constructor (props, context) {
                super(props, context);

                this.constructor.displayName = WrappedComponent.name;

                // Relate connector info
                this.relate = {
                    setKeepData: ::this.setKeepData,
                    refresh: ::this.refresh,
                    loadMore: ::this.loadMore,
                    loadPage: ::this.loadPage,
                    variables: {},
                    hasMore: true,
                    pageNo: 0,
                };

                // Set keepData
                if (props.keepData) {
                    this.setKeepData(props.keepData);
                }

                // get bundle
                this.initialBundle = this.processBundle(props);
                if (!props.relateConnectorData || Object.keys(props.relateConnectorData).length === 0) {
                    this.initialHasDataToFetch = !!(
                        this.initialBundle &&
                        !this.initialBundle.manualLoad &&
                        this.hasDataToFetch(this.initialBundle.fragments)
                    );
                    if (this.context.relate_ssr) {
                        this.initialFetchData();
                    }
                    // Set initial state
                    this.state = {
                        loading: this.initialHasDataToFetch,
                        error: false,
                    };
                } else {
                    this.state = {
                        loading: false,
                        error: false,
                    };
                }
            }

            componentWillMount () {
                this.initialFetchData();
            }

            shouldComponentUpdate (nextProps, nextState) {
                return (
                    !this.state.loading ||
                    this.state.loading && !nextState.loading ||
                    this.state.error !== nextState.error
                );
            }

            componentWillUnmount () {
                const { pathname } = this.props.location || {};
                // 如果有保留数据，则不删除 CONNECTOR_ID，否则会删除 CONNECTOR_ID， 同时会删除 keepData
                if (!KeepData.getHasKeepData(pathname)) {
                    this.context.store.dispatch(removeConnector(this.props.CONNECTOR_ID));
                }
            }

            /*
            * 如果进入其他页面需要保留该页面的数据的时候，使用该接口
            * keepData 为需要额外保留的数据，如果没有，使用 setKeepData(true);
            * 需要保留的额外数据的情况
            * relate.setKeepData({ lastSelectIndex: index, lastCurrent: current });
            * 如果想要手动删除 keepData, 使用 setKeepData();
            *
            * 如果想设置一个全局的保留数据，需要在 @dataConnect 里面设置，如下：
            * @dataConnect(
            *    (state, props) => ({ states: state.tests, keepData: true })
            * }
            *
            * 如果不设置pathname，则使用 location.pathname， 只有 IndexRoute 的时候才需要设置
            */
            setKeepData (keepData, pathname) {
                KeepData.update(this.props.location.pathname, keepData, this.props.CONNECTOR_ID, this.context.store, pathname);
            }

            initialFetchData () {
                if (this.initialHasDataToFetch) {
                    this.fetchData({
                        fragments: this.initialBundle.fragments,
                        variables: this.initialBundle.initialVariables,
                        mutations: this.initialBundle.mutations,
                    });
                }
            }

            /* 如果没有设置 property，则取 variables 的键值，如果不需要请求参数的时候使用 property ,需要的时候必须使用 variables
            * 不需要参数的情况
            * relate.refresh({
            *     property: 'personal',
            * });
            *
            * 要参数的情况
            * relate.refresh({
            *     variables: {
            *         clients: {
            *             pageNo: 0,
            *             pageSize,
            *             keyword,
            *         },
            *     },
            * });
            */
            refresh ({ variables, property, callback }) {
                const properties = [...(variables ? _.keys(variables) : []), ...(_.isArray(property) ? property : [property])];
                const bundle = this.processBundle(this.props, variables);

                // Fetch data
                if (bundle) {
                    this.setState({
                        loading: true,
                    }, () => {
                        this.fetchData({
                            fragments: _.pick(bundle.fragments, properties),
                            variables,
                            mutations: bundle.mutations,
                            callback,
                        });
                    });
                }
            }

            // 适合做上拉加载更多的列表
            loadMore ({ variables, property, callback }) {
                const key = _.keys(variables)[0];
                const bundle = this.processBundle(this.props, variables);
                // Fetch data
                if (bundle && !this.lock) {
                    this.lock = true;
                    this.setState({
                        loading: true,
                        loadingMore: true,
                    }, () => {
                        this.fetchData({
                            fragments: _.pick(bundle.fragments, key),
                            variables,
                            mutations: bundle.mutations,
                            loadingMoreProperty: property || true,
                            callback,
                        });
                    });
                }
            }

            // 适合做分页的表格
            loadPage ({ variables, property, callback }) {
                const key = _.keys(variables)[0];
                const bundle = this.processBundle(this.props, variables);
                const { pageNo, pageSize } = variables[key];
                // Fetch data
                if (bundle && !this.lock) {
                    this.lock = true;
                    this.setState({
                        loadingPage: true,
                    }, () => {
                        this.fetchData({
                            fragments: _.pick(bundle.fragments, key),
                            variables,
                            mutations: bundle.mutations,
                            loadingPageProperty: property || true,
                            loadingPageStartIndex: pageNo * pageSize,
                            callback,
                        });
                    });
                }
            }

            hasDataToFetch (fragments) {
                return typeof fragments === 'object' && Object.keys(fragments).length > 0;
            }

            processBundle (props, variables) {
                const bundle = getBundle && getBundle(props);

                this.variablesTypes = bundle && bundle.variablesTypes || {};
                this.relate.variables = variables || bundle && bundle.initialVariables || {};

                return bundle;
            }

            fetchData ({ fragments, variables, mutations, loadingMoreProperty = false, loadingPageProperty = false, loadingPageStartIndex = 0, callback }) {
                console.log('[relatejs] fetchData:', { fragments, variables, mutations, loadingMoreProperty, loadingPageProperty, loadingPageStartIndex });
                const { fetchData } = this.context;

                if (fetchData && this.hasDataToFetch(fragments)) {
                    const fetchOptions = {
                        fragments,
                        variables: getVariables({
                            variables,
                            variablesTypes: this.variablesTypes,
                            fragments,
                            displayName: typeof WrappedComponent !== 'undefined' && WrappedComponent.displayName,
                        }),
                        ID: this.props.CONNECTOR_ID,
                        mutations,
                        loadingMoreProperty,
                        loadingPageProperty,
                        loadingPageStartIndex,
                    };
                    if (this.context.relate_ssr) {
                        fetchData(fetchOptions);
                    } else {
                        fetchData(fetchOptions)
                        .then((data) => {
                            callback && callback(data);
                            const { loadingMore } = this.state;
                            if (loadingMoreProperty && loadingMore) {
                                const key = _.keys(variables)[0];
                                const { pageNo, pageSize } = variables[key];
                                const item = (loadingMoreProperty === true) ? data[key] : data[key][loadingMoreProperty];
                                if (item) {
                                    this.relate.hasMore = item.length >= pageSize;
                                    this.relate.pageNo = pageNo;
                                }
                            }

                            this.setState({
                                loading: false,
                                loadingMore: false,
                                loadingPage: false,
                                error: false,
                            });

                            this.lock = false;
                        })
                        .catch(() => {
                            this.setState({
                                loading: false,
                                loadingMore: false,
                                loadingPage: false,
                                error: true,
                            });
                        });
                    }
                } else {
                    if (!this.context.relate_ssr) {
                        this.setState({
                            loading: false,
                            loadingMore: false,
                            loadingPage: false,
                            error: false,
                        });
                    }
                }
            }

            render () {
                const { relateConnectorData, ...otherProps } = this.props;
                const { loading, loadingMore, loadingPage } = this.state;
                return (
                    <WrappedComponent
                        {...otherProps}
                        {...relateConnectorData}
                        relate={this.relate}
                        loading={loading}
                        loadingMore={loadingMore}
                        loadingPage={loadingPage}
                        />
                );
            }
        }

        const Connected = connect(
            () => function map (state, props) {
                const { pathname } = props.location || {};
                const refuxProps = getReduxState && getReduxState(state, props) || {};
                const keepData = KeepData.get(pathname, refuxProps);
                if (!this.CONNECTOR_ID) {
                    this.CONNECTOR_ID = keepData.connectorId;
                }
                if (!this.CONNECTOR_ID) {
                    if (state.relateReducer.server) {
                        const finalProps = Object.assign({}, props, refuxProps);
                        const initialBundle = getBundle(finalProps);
                        const thisCompare = {
                            fragments: initialBundle.fragments,
                            variables: getVariables({
                                variables: initialBundle.initialVariables,
                                variablesTypes: initialBundle.variablesTypes,
                                fragments: initialBundle.fragments,
                            }),
                        };

                        _.forEach(state.relateReducer.server, (compare, id) => {
                            if (_.isEqual(compare, thisCompare)) {
                                this.CONNECTOR_ID = id;
                                return false;
                            }
                            return true;
                        });

                        if (!this.CONNECTOR_ID) {
                            this.CONNECTOR_ID = generateConnectorId();
                        }
                    } else {
                        this.CONNECTOR_ID = generateConnectorId();
                    }
                }
                return Object.assign(
                    refuxProps,
                    {
                        relateConnectorData: state.relateReducer[this.CONNECTOR_ID],
                        CONNECTOR_ID: this.CONNECTOR_ID,
                    },
                    keepData.data,
                );
            },
            (dispatch) => Object.assign(
                getReduxDispatches && getReduxDispatches(dispatch) || {},
                {
                    removeConnector: dispatch(removeConnector),
                }
            )
        )(ConnectData);

        return hoistStatics(Connected, WrappedComponent, {
            relateIdentifier: true,
        });
    };
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/decorators/root-data-connect.js

```js
import hoistStatics from 'hoist-non-react-statics';
import warning from 'warning';
import Q from 'q';
import _ from 'lodash';
import React, { Component, PropTypes } from 'react';
import { mergeFragments, buildQueryAndVariables } from '../helpers/fragments';

import queryAction from '../actions/query';

export default function rootDataConnect (config) {
    return function wrapWithDataConnect (WrappedComponent) {
        class RootConnectData extends Component {
            static contextTypes = {
                store: PropTypes.any.isRequired,
                relate_ssr: PropTypes.func,
            };

            static childContextTypes = {
                fetchData: PropTypes.func.isRequired,
            };

            static relateIdentifier = 'ROOT_DATA_CONNECT';

            constructor (props, context) {
                super(props, context);
                this.bundle = {};
                this.childFetchDataBind = ::this.childFetchData;
                this.fetchDebounce = _.debounce(::this.fetchData, 10);
                this.scopeID = 0;
            }

            getChildContext () {
                return {
                    fetchData: this.childFetchDataBind,
                };
            }

            componentDidMount () {
                this.mounted = true;
                if (this.bundle && this.bundle.fragments) {
                    this.fetchData();
                }
            }

            childFetchData ({ fragments, variables = {}, ID, mutations, loadingMoreProperty = false, loadingPageProperty = false, loadingPageStartIndex = 0 }) {
                // Check for same query with different variables
                const scopes = {};
                const resultFragments = Object.assign({}, fragments || {});
                const resultVariables = Object.assign({}, variables || {});

                if (this.bundle.fragments) {
                    _.forEach(fragments, (fragment, queryName) => {
                        if (this.bundle.fragments[queryName]) {
                            // Same query name detected, will have to check if variables are the same
                            const sameVariables = _.isEqual(
                                variables && variables[queryName],
                                this.bundle.variables && this.bundle.variables[queryName]
                            );

                            if (!sameVariables) {
                                // Will have to scope it
                                const scope = `relate_${this.scopeID++}`;
                                const newQueryName = `${scope}: ${queryName}`;
                                resultFragments[newQueryName] = Object.assign({}, fragments[queryName]);
                                scopes[scope] = queryName;
                                delete resultFragments[queryName];

                                if (resultVariables[queryName]) {
                                    resultVariables[newQueryName] = Object.assign({}, variables[queryName]);
                                    delete resultVariables[queryName];
                                }
                            }
                        }
                    });
                }

                this.bundle = {
                    fragments: mergeFragments(this.bundle.fragments || {}, resultFragments),
                    variables: Object.assign(this.bundle.variables || {}, resultVariables),
                    connectors: Object.assign(this.bundle.connectors || {}, {
                        [ID]: { fragments, variables, mutations, scopes, loadingMoreProperty, loadingPageProperty, loadingPageStartIndex },
                    }),
                    scopes: Object.assign(this.bundle.scopes || {}, scopes),
                };

                let result = null;
                if (!this.context || !this.context.relate_ssr) {
                    if (this.fetchingData && this.deferred) {
                        if (!this.nextDeferred) {
                            this.nextDeferred = Q.defer();

                            this.deferred.promise.fin(() => {
                                this.deferred = this.nextDeferred;
                                this.nextDeferred = null;
                                this.fetchData();
                            });
                        }

                        result = this.nextDeferred.promise;
                    } else {
                        if (this.mounted) {
                            this.fetchDebounce();
                        }

                        this.deferred = this.deferred || Q.defer();
                        result = this.deferred.promise;
                    }
                }

                return result;
            }

            fetchData () {
                const { store, relate_ssr } = this.context;
                const { dispatch } = store;
                const { fragments, variables, connectors, scopes } = this.bundle;
                this.bundle = {};
                this.deferred = this.deferred || Q.defer();
                if (fragments && Object.keys(fragments).length) {
                    this.fetchingData = true;
                    dispatch(
                        queryAction(
                            buildQueryAndVariables(fragments, variables),
                            fragments,
                            connectors,
                            scopes,
                            typeof config === 'function' ? config(this.props) : config,
                            relate_ssr
                        )
                    ).then((data) => {
                        this.deferred.resolve(data);
                    }).catch((err) => {
                        warning(false, err);
                        this.deferred.reject();
                    }).fin(() => {
                        this.deferred = null;
                        this.fetchingData = false;
                    });
                } else {
                    this.deferred.resolve();
                    this.fetchingData = false;
                }

                return this.deferred.promise;
            }

            render () {
                return <WrappedComponent {...this.props} />;
            }
        }

        return hoistStatics(RootConnectData, WrappedComponent, {
            relateIdentifier: true,
        });
    };
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/helpers/capture.js

```js
import _ from 'lodash';

/**
* Captures a relate query or mutation values (concats scoped queries)
*
* @param {Object} action
* @param {String||Array} test
*/
export default (action, test) => {
    if (!test) {
        return null;
    }

    const querieTestNames = test.constructor === Array ? test : [test];
    let result = null;

    _.forEach(action.data, (queryValue, key) => {
        if (queryValue && querieTestNames.indexOf(key) !== -1 ||
        querieTestNames.indexOf(action.scopes[key]) !== -1) {
            // is in query test values

            if (queryValue.constructor === Array) {
                result = result && [...result, ...queryValue] || [...queryValue];
            } else {
                result = queryValue;
            }
        }
    });

    return result;
};

```

* PDShop_Shop_PC/project/App/shared/relatejs/helpers/connectors-ids.js

```js
let ID_COUNTER = 0;
let PREFIX = '';

export function generateConnectorId () {
    return `${PREFIX}connector_${ID_COUNTER++}`;
}

export function resetConnectorsIds (prefix = '') {
    PREFIX = prefix;
    ID_COUNTER = 0;
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/helpers/fragments.js

```js
import _ from 'lodash';

//
// Example usage:
//
//     mergeFragments({
//       page: {
//         _id: 1,
//         name: 1,
//         createdBy: {
//           _id: 1
//         }
//       }
//     }, {
//       page: {
//         title: 1,
//         createdBy: {
//           name: 1
//         }
//       }
//     }))
//
// Outputs:
//
//     { page: { _id: 1, name: 1, createdBy: { _id: 1, name: 1 }, title: 1 } }
//
export function mergeFragments () {
    return _.merge({}, ...arguments);
}

//
// Example usage:
//
//     fragmentToQL({
//       _id: 1,
//       name: 1,
//       createdBy: {
//         _id: 1
//       }
//     })
//
// Outputs:
//
//     _id,name,createdBy { _id }
//
export function fragmentToQL (fragment) {
    const iterate = (i) => {
        return Object
        .keys(i)
        .map((key) => {
            let result;
            const value = i[key];
            if (typeof value === 'object') {
                result = `${key} { ${iterate(value)} }`;
            } else {
                result = key;
            }
            return result;
        })
        .join(',');
    };
    return iterate(fragment);
}

// Example usage:
//
//     const {query, variables} = buildQueryAndVariables(
//       {
//         session: {
//           _id: 1,
//           email: 1
//         },
//         page: {
//           _id: 1,
//           title: 1,
//           slug: 1,
//           createdBy: {
//             name: 1
//           }
//         }
//       },
//       {
//         page: {
//           slug: {
//             value: 'landing',
//             type: 'String!'
//           }
//         }
//       }
//     );
//
// Outputs:
//
// {
//   query: `
//     query ($slug0: String!) {
//       session {
//         _id,
//         email
//       },
//       page (slug: $slug0) {
//         _id,
//         title,
//         slug,
//         createdBy {
//           name
//         }
//       }
//     }
//   `,
//   variables: {
//     slug0: 'landing'
//   }
// }
//
let iterator;
let variables;
let variablesTypes;

function _buildQuery (fragments, inputVariables = {}) {
    const queries = [];

    _.forIn(fragments, (fragment, key) => {
        let queryStr = '';
        const vars = inputVariables[key];
        const variablesMap = []; // slug: $slug
        const hasFragments = typeof fragment === 'object';

        // variables calculation
        if (vars) {
            _.forIn(vars, (varValue, varKey) => {
                if (varValue.hasOwnProperty('type') && varValue.hasOwnProperty('value') && typeof varValue.type === 'string') {
                    const name = varKey + iterator;
                    variablesTypes.push(`$${name}: ${varValue.type}`);
                    variablesMap.push(`${varKey}: $${name}`);
                    variables[name] = varValue.value;
                    iterator++;
                }
            });
        }

        // Make query variables string
        let variablesString = '';
        if (variablesMap.length) {
            variablesString = ` (${variablesMap.join(',')})`;
        }

        queryStr += `${key}${variablesString}`;

        if (hasFragments) {
            queryStr += ` { ${_buildQuery(fragment, vars)} }`;
        }

        queries.push(queryStr);
    });

    return queries.join(',');
}

export function buildQueryAndVariables (fragments, inputVariables = {}, type = 'query') {
    variables = {};
    variablesTypes = [];
    iterator = 0;

    const queries = _buildQuery(fragments, inputVariables);

    let query;
    if (variablesTypes.length) {
        query = `${type} (${variablesTypes.join(',')}) { ${queries} }`;
    } else {
        query = `${type} { ${queries} }`;
    }

    return {
        query,
        variables,
    };
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/helpers/get-variables.js

```js
import invariant from 'invariant';
import _ from 'lodash';

export default function getVariables ({ variables, fragments, variablesTypes, displayName }) {
    const resultVariables = {};
    if (variables) {
        _.forEach(variables, (vars, queryName) => {
            if (fragments[queryName]) { // if not in fragments, ignore
                resultVariables[queryName] = {};
                const queryVariablesTypes = variablesTypes[queryName];

                // No variables types defined for this query
                invariant(
                    queryVariablesTypes,
                    'Relate: Query to %s doesn\'t have variables types defined in %s!',
                    queryName,
                    displayName || 'a component'
                );

                // Check if every variable has a type
                _.forEach(vars, (value, variable) => {
                    invariant(
                        queryVariablesTypes[variable],
                        'Relate: Query to %s does not have variable "%s" type defined in %s!',
                        queryName,
                        variable,
                        displayName || 'a component'
                    );

                    // add variable prepared for query e.g. {type: 'String', value: 'something'}
                    const type = queryVariablesTypes[variable];

                    if (typeof type === 'object') {
                        // deep query
                        Object.assign(resultVariables[queryName], getVariables({
                            variables: { [variable]: value },
                            fragments: { [variable]: fragments[queryName] },
                            variablesTypes: { [variable]: type },
                        }));
                    } else {
                        resultVariables[queryName][variable] = {
                            type: queryVariablesTypes[variable],
                            value,
                        };
                    }
                });

                // Check if every required variable type is met
                _.forEach(queryVariablesTypes, (type, variable) => {
                    if (typeof type !== 'object') {
                        invariant(
                            type.slice(-1) !== '!' || vars[variable] !== undefined,
                            'Relate: Query to %s requires the variable "%s" in %s!',
                            queryName,
                            variable,
                            displayName || 'a component'
                        );
                    }
                });
            }
        });
    }
    return resultVariables;
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/helpers/request.js

```js
import request from 'superagent';
import _ from 'lodash';
import Q from 'q';

function omitAll (obj) {
    if (_.isPlainObject(obj)) {
        return _.mapValues(obj, (o) => omitAll(o));
    } else if (_.isArray(obj)) {
        return _.map(obj, (o) => omitAll(o));
    } else if (obj === null) {
        return undefined;
    }
    return obj;
}

export default function doRequest ({ dispatch, query, variables, type, endpoint, headers, body, ...params }) {
    console.log('[relatejs]: doRequest', { dispatch, query, variables, type, endpoint, headers, body, ...params });
    return new Q()
    .then(() => {
        const deferred = Q.defer();
        let promise = deferred.promise;
        const dataObj = { query, variables, ...body };
        const payload =
        headers['Content-Type'] === 'text/plain' ?
        JSON.stringify(dataObj) :
        dataObj;

        const req = request
        .post(endpoint || '/shop/graphql')
        .set(headers)
        .send(payload);

        if (params.withCredentials) {
            req.withCredentials();
        }

        req
        .end((error, res) => {
            if (error) {
                console.error('[relatejs]:', res.text);
                deferred.reject(error);
            } else {
                const data = omitAll(res.body);
                console.log('[relatejs]: body', data);
                const { errors } = data;
                if (errors && errors.length && _.find(errors, (item) => (item.message === 'unauthorized'))) {
                    window.location.href = '/shop/login';
                } else {
                    deferred.resolve(data);
                }
            }
        });

        if (dispatch) {
            console.log('[relatejs]: start dispatch');
            promise = promise.then(({ data, errors }) => {
                console.log('[relatejs]: dispatch', { type, data, errors, ...params });
                dispatch({ type, data, errors, ...params });
                return data;
            });
        }

        return promise;
    });
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/redirect-graphql/index.js

```js
import { buildQueryAndVariables } from '../helpers/fragments';
import request from '../helpers/request';

const headers = {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
};

export function apiQuery (options, callback) {
    const mutation = buildQueryAndVariables(options.fragments, options.variables, 'query');
    const params = { ...mutation, headers };
    return () => {
        return request(params).then(({ data }) => {
            callback(data);
        });
    };
}

export function apiMutation (options, callback) {
    const mutation = buildQueryAndVariables(options.fragments, options.variables, 'mutation');
    const params = { ...mutation, headers };
    return () => {
        return request(params).then(({ data }) => {
            callback(data);
        });
    };
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/reducer/reducer.js

```js
import actionTypes from '../actions/types';
import Store from '../store';
import KeepData from '../store/keep-data';
import _ from 'lodash';

const store = new Store();

// Default state
// state will be composed of connectors data, e.g.
// {
//   connector_1: {
//     pages: [{...}, {...}]
//   },
//   connector_2: {
//     page: {...}
//   }
// }
const defaultState = {
    headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
    },
    body: {},
    endpoint: '/shop/graphql',
    withCredentials: false,
};

export function relateReducer (_state = defaultState, action = {}) {
    const isIntrospection = action.isIntrospection;
    let state = _state;

    // Server store hydration
    if (!isIntrospection && state.serverConnectors) {
        store.connectors.connectors = state.serverConnectors;
        state = Object.assign({}, state);
        delete state.serverConnectors;
    }

    if ((action.type === actionTypes.query || action.type === actionTypes.mutation) &&
    action.data &&
    action.fragments) {
        const isMutation = action.type === actionTypes.mutation;

        const changes = store.processIncoming({
            data: action.data,
            fragments: action.fragments,
            connectors: action.connectors,
            isMutation,
        });

        let result;
        if (isIntrospection) {
            // is introspection (server side), so save connectors mapping for later re hydration
            const connectorsMap = {};
            _.forEach(action.connectors, (connectorData, connectorId) => {
                connectorsMap[connectorId] = {
                    fragments: connectorData.fragments,
                    variables: connectorData.variables,
                };
            });
            result = Object.assign({}, state, changes, {
                server: connectorsMap,
                serverConnectors: store.connectors.connectors,
            });
        } else {
            // client side
            result = Object.assign({}, state, changes);
        }

        return result;
    }

    if (action.type === actionTypes.removeConnector) {
        const newState = Object.assign({}, state);
        delete newState[action.id];
        KeepData.removeConnectorId(action.id);
        store.deleteConnector(action.id);

        if (state.server) {
            // server mapping no longer needed
            delete newState.server;
        }

        // TODO Delete no longer needed data from state? or maintain for future cache?
        return newState;
    }

    if (action.type === actionTypes.setHeader) {
        return Object.assign({}, state, {
            headers: Object.assign({}, state.headers, {
                [action.key]: action.value,
            }),
        });
    }

    if (action.type === actionTypes.removeHeader) {
        const headers = Object.assign({}, state.headers);
        delete headers[action.key];
        return Object.assign({}, state, {
            headers,
        });
    }

    if (action.type === actionTypes.setEndpoint) {
        return Object.assign({}, state, {
            endpoint: action.endpoint,
        });
    }

    if (action.type === actionTypes.setBody) {
        return Object.assign({}, state, {
            body: Object.assign({}, state.body, {
                [action.key]: action.value,
            }),
        });
    }

    if (action.type === actionTypes.removeBody) {
        const body = Object.assign({}, state.body);
        delete body[action.key];
        return Object.assign({}, state, {
            body,
        });
    }

    return state;
}

export function relateReducerInit (settings) {
    Object.assign(defaultState, settings);
    return relateReducer;
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/server/get-data-dependencies.js

```js
import invariant from 'invariant';
import q from 'q';
import React from 'react';

import { resetConnectorsIds } from '../helpers/connectors-ids';

function processElement ({ element, context, rootDataConnectors, dataConnectors }) {
    try {
        if (element !== null) {
            const { props, type } = element;
            if (typeof type === 'function') {
                const ElementClass = element.type;
                let finalProps = props;
                if (ElementClass.defaultProps) {
                    finalProps = Object.assign({}, ElementClass.defaultProps, props);
                }
                // console.log("=============1", element);
                // console.log("=============2", ElementClass);
                const Element = new ElementClass(
                    finalProps,
                    context
                );

                if (type.relateIdentifier === 'ROOT_DATA_CONNECT') {
                    rootDataConnectors.push(Element);
                } else if (type.relateIdentifier === 'DATA_CONNECT') {
                    dataConnectors.push(Element);
                }

                // Generate context for children
                let newContext = context;
                if (Element.getChildContext) {
                    newContext = Object.assign({}, context, Element.getChildContext());
                }
                // console.log("=============3", !!Element.render);
                // go through children
                const renderResult = Element.render ? Element.render() : ElementClass(finalProps, context);
                // console.log("=============4", renderResult);
                processElement({
                    element: renderResult,
                    context: newContext,
                    rootDataConnectors,
                    dataConnectors,
                });
            } else if (props && props.children) {
                React.Children.forEach(props.children, (childElement) => {
                    processElement({
                        element: childElement,
                        context,
                        rootDataConnectors,
                        dataConnectors,
                    });
                });
            }
        }
    } catch (err) {
        console.log('=============5', err);
        invariant(false, 'Relate: error traversing components tree');
    }
}

export default function getAllDataDependencies (rootElement, getData) {
    const rootDataConnectors = [];
    const dataConnectors = [];

    // Ensure connectors ids are reset
    resetConnectorsIds('server_');

    // traverse tree
    processElement({
        element: rootElement,
        context: {
            relate_ssr: getData,
        },
        rootDataConnectors,
        dataConnectors,
    });

    // fetch data for each root data connector
    return q()
    .then(() => {
        let result;

        if (rootDataConnectors.length) {
            result = rootDataConnectors[0].fetchData();
        } else {
            result = null;
        }

        return result;
    })
    .then(() => resetConnectorsIds())
    .catch(() => {
        invariant(false, 'Relate: error getting data');
    });
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/store/connectors.js

```js
import _ from 'lodash';

export default class Connectors {
    constructor () {
        this.connectors = {};
    }

    connectorExists (connectorId) {
        return this.connectors[connectorId] && true;
    }

    generateConnectorData (connectorId) {
        const connector = this.connectors[connectorId];
        return connector.data;
    }

    // Process a query through the connectors that requested it
    processConnectors (queryConnectors, queryName, relativeNodes) {
        console.log('[relatejs]: processConnectors', { queryConnectors, queryName, relativeNodes });
        _.forEach(queryConnectors, (connectorQuery, connectorId) => {
            // Check if queryName is a scoped one
            const actualQueryName = connectorQuery.scopes && connectorQuery.scopes[queryName] || queryName;
            const isInConnectorFragments = connectorQuery.fragments[actualQueryName] && true;
            const isScopedQuery = actualQueryName !== queryName;
            const scopedOther =
            !isScopedQuery && // is not a scoped query
            connectorQuery.scopes && // has scopes
            _.values(connectorQuery.scopes).indexOf(actualQueryName) !== -1; // query has not been scoped

            // check if query was triggered by this connector
            // 1st case for scoped queries
            // 2nd case for non scope queries (they cannot be a value in scope)
            if ((isInConnectorFragments && isScopedQuery) ||
            (isInConnectorFragments && !isScopedQuery && !scopedOther)) {
                this.connectors[connectorId] = this.connectors[connectorId] || {
                    data: {},
                    fragments: {},
                    mutations: {},
                };
                const conn = this.connectors[connectorId];
                const { loadingMoreProperty, loadingPageProperty } = connectorQuery;
                // Add query data
                if (loadingMoreProperty) {
                    if (loadingMoreProperty === true) {
                        conn.data[actualQueryName] = [...conn.data[actualQueryName], ...relativeNodes];
                    } else {
                        _.set(conn.data[actualQueryName], loadingMoreProperty, [..._.get(conn.data[actualQueryName], loadingMoreProperty), ..._.get(relativeNodes, loadingMoreProperty)]);
                    }
                } else if (loadingPageProperty) {
                    let index = connectorQuery.loadingPageStartIndex;
                    if (loadingPageProperty === true) {
                        const list = conn.data[actualQueryName] || [];
                        _.forEach(relativeNodes, (item) => {
                            list[index++] = item;
                        });
                        for (let i = 0; i < index; i++) {
                            if (list[i] === undefined) {
                                list[i] = false;
                            }
                        }
                        conn.data[actualQueryName] = list;
                    } else {
                        const list = _.get(conn.data[actualQueryName], loadingPageProperty) || [];
                        _.forEach(_.get(relativeNodes, loadingPageProperty), (item) => {
                            list[index++] = item;
                        });
                        for (let i = 0; i < index; i++) {
                            if (list[i] === undefined) {
                                list[i] = false;
                            }
                        }
                        _.set(conn.data[actualQueryName], loadingPageProperty, list);
                    }
                } else {
                    Object.assign(conn.data, { [actualQueryName]: relativeNodes });
                }

                // fragments
                Object.assign(conn.fragments, {
                    [actualQueryName]: connectorQuery.fragments[actualQueryName],
                });

                // mutations listeners
                conn.mutations = connectorQuery.mutations || {};
            }
        });
    }

    // Check if any connector is listening to the mutation passed as argument
    checkMutationListeners (mutationName, relativeNodes) {
        const connsToUpdate = [];
        console.log('[relatejs]: checkMutationListeners', { mutationName, relativeNodes, connectors: this.connectors });
        _.forEach(this.connectors, (connector, connectorId) => {
            const mutation = connector.mutations && connector.mutations[mutationName];
            if (mutation && mutation.constructor === Function) {
                connsToUpdate.push(connectorId);
                mutation({ state:connector.data, data:relativeNodes, connector, _ });
            }
        });
        return connsToUpdate;
    }

    deleteConnector (connectorId) {
        this.connectors[connectorId] && delete this.connectors[connectorId];
    }
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/store/global-data.js

```js
export default {
    data: {},
    get (key, value) {
        const ret = this.data[key];
        if (value !== undefined) {
            this.data[key] = value;
        }
        return ret;
    },
    set (key, value) {
        this.data[key] = value;
    },
};

```

* PDShop_Shop_PC/project/App/shared/relatejs/store/index.js

```js
import _ from 'lodash';
import Connectors from './connectors';

export default class Store {
    constructor () {
        // Connectors interface
        this.connectors = new Connectors();
    }

    // #isMutation - Boolean
    processIncoming ({ data, fragments, connectors, isMutation }) {
        console.log('[relatejs]: processIncoming', { data, fragments, connectors, isMutation });
        let connectorsToUpdate = connectors && Object.keys(connectors) || [];

        _.forEach(fragments, (fragment, queryName) => {
            const relativeNodes = data[queryName];

            // Process data to connectors
            if (connectors) {
                this.connectors.processConnectors(
                    connectors,
                    queryName,
                    relativeNodes,
                );
            }

            // If mutation check if some connector is listening
            if (isMutation) {
                connectorsToUpdate = _.union(
                    connectorsToUpdate,
                    this.connectors.checkMutationListeners(queryName, relativeNodes)
                );
            }
        });

        // Calculate connectors that need to be changed
        const changes = {};
        _.forEach(connectorsToUpdate, (connectorId) => {
            if (this.connectors.connectorExists(connectorId)) {
                changes[connectorId] = this.connectors.generateConnectorData(connectorId);
            }
        });
        return changes;
    }

    // Remove a data connector
    deleteConnector (connectorId) {
        this.connectors.deleteConnector(connectorId);
    }
}

```

* PDShop_Shop_PC/project/App/shared/relatejs/store/keep-data.js

```js
import _ from 'lodash';
import removeConnector from '../actions/remove-connector';

export default {
    list: {},
    redirectPathnameList: {},
    update (location, data, connectorId, store, pathname) {
        if (pathname) {
            this.redirectPathnameList[location] = pathname;
            location = pathname;
        }
        if (data) {
            if (this.list[location] && typeof data === 'object') {
                this.list[location].data = Object.assign(this.list[location].data || {}, data, _.omitBy({ connectorId, store, hasKeepData: true }, _.isNil));
            } else {
                let obj = { connectorId, store, hasKeepData: true };
                if (typeof data === 'object') {
                    obj.data = data;
                }
                this.list[location] = obj;
            }
        } else if (this.list[location]) {
            delete this.list[location];
        }
    },
    get (location, props) {
        location = this.redirectPathnameList[location] || location;
        let obj = this.list[location] || {};
        if (!props.keepLastKeepData) {
            _.forEach(this.list, (o, key) => {
                if (key !== location) {
                    o.store.dispatch(removeConnector(o.connectorId));
                }
            });
        }
        return obj;
    },
    getHasKeepData (location) {
        location = this.redirectPathnameList[location] || location;
        return (this.list[location] || {}).hasKeepData;
    },
    getKeepData (location) {
        location = this.redirectPathnameList[location] || location;
        return (this.list[location] || {}).data;
    },
    removeConnectorId (connectorId) {
        const item = _.find(this.list, (o) => o.connectorId === connectorId);
        if (item) {
            if (item.onlyClearConnector) {
                delete item.onlyClearConnector;
                delete item.connectorId;
            } else {
                this.list = _.omitBy(this.list, (o) => o.connectorId === connectorId);
            }
        }
    },
    // 只清除location的所有数据
    forceClear (location) {
        location = this.redirectPathnameList[location] || location;
        const obj = this.list[location];
        if (obj) {
            obj.store.dispatch(removeConnector(obj.connectorId));
        }
    },
    // 只清除location的connectorId， 其他的数据保留
    forceClearConnector (location) {
        location = this.redirectPathnameList[location] || location;
        const obj = this.list[location];
        if (obj) {
            obj.onlyClearConnector = true;
            obj.store.dispatch(removeConnector(obj.connectorId));
        }
    },
};

```

* PDShop_Shop_PC/project/App/server/shared/helpers/bind-error-type.js

```js
import {
    GraphQLUnionType,
} from 'graphql';
import _ from 'lodash';
import { errorType } from '../../graphql/types/error';

export default function bindErrorType (obj) {
    let key = _.keys(obj)[0];
    let type = obj[key];
    return new GraphQLUnionType({
        name: key + 'BindErrorType',
        types: [type, errorType],
        resolveType: (value) => {
            if (value.error) {
                return errorType;
            }
            return type;
        },
    });
}

```

* PDShop_Shop_PC/project/App/server/shared/helpers/default-favicon.js

```js
export default function getDefaultIcon (res) {
    return {
        tag: 'link',
        props: {
            rel: 'shortcut icon',
            type: 'image/vnd.microsoft.icon',
            href: `${res.baseScriptsURL}/shop/favicon.ico`,
        },
    };
}

```

* PDShop_Shop_PC/project/App/server/shared/helpers/get-base-component.js

```js
import React from 'react';
import { Provider } from 'react-redux';
import { ReduxRouter } from 'redux-router';
import getMuiTheme from 'material-ui/styles/getMuiTheme';
import MuiThemeProvider from 'material-ui/styles/MuiThemeProvider';

export default (req) => {
    const { store, headers } = req;
    const muiTheme = getMuiTheme({ userAgent: headers['user-agent'] });
    return (
        <MuiThemeProvider muiTheme={muiTheme}>
            <Provider store={store}>
                <ReduxRouter />
            </Provider>
        </MuiThemeProvider>
    );
};

```

* PDShop_Shop_PC/project/App/server/shared/helpers/get-markup.js

```js
import serialize from 'serialize-javascript';
import Html from 'components/html';
import React from 'react';
import { renderToString } from 'react-dom/server';
import { Provider } from 'react-redux';
import { ReduxRouter } from 'redux-router';
import getMuiTheme from 'material-ui/styles/getMuiTheme';
import MuiThemeProvider from 'material-ui/styles/MuiThemeProvider';

export default function getMarkup (req, res) {
    const { store, headers } = req;
    const state = store.getState();
    const initialState = serialize(state);
    const muiTheme = getMuiTheme({ userAgent: headers['user-agent'] });

    const markup = renderToString(
        <MuiThemeProvider muiTheme={muiTheme}>
            <Provider store={store}>
                <ReduxRouter />
            </Provider>
        </MuiThemeProvider>
    );

    const htmlMarkup = renderToString(
        <Html
            body={markup}
            props={initialState}
            locals={res.locals}
            />
    );

    return htmlMarkup;
}

```

* PDShop_Shop_PC/project/App/server/shared/helpers/get-projection.js

```js
export function getProjection (fieldASTs) {
    return fieldASTs.selectionSet.selections.reduce((projections, selection) => {
        projections[selection.name.value] = 1;
        return projections;
    }, {});
}

export function getInlineProjection (fieldASTs) {
    return fieldASTs.selectionSet.selections[0].selectionSet.selections.reduce((projections, selection) => {
        projections[selection.name.value] = 1;
        return projections;
    }, {});
}

```

* PDShop_Shop_PC/project/App/server/shared/helpers/render-html.js

```js
import serialize from 'serialize-javascript';
import Html from 'components/html';
import React from 'react';
import { renderToString } from 'react-dom/server';

export default ({ component, store, locals }) => {
    const state = store.getState();
    const initialState = serialize(state);

    const markup = renderToString(component);

    const htmlMarkup = renderToString(
        <Html
            body={markup}
            props={initialState}
            locals={locals}
            />
    );

    return htmlMarkup;
};

```

* PDShop_Shop_PC/project/App/server/shared/helpers/route-handler.js

```js
import configureStore from 'helpers/configure-store';
import { createMemoryHistory } from 'history';
import { match, reduxReactRouter } from 'redux-router/server';

export default function routeHandler (routes, req, res, next) {
    const store = configureStore(reduxReactRouter({
        createHistory: createMemoryHistory,
        routes,
    }));
    const url = req.originalUrl;

    store.dispatch(match(url, async (error, redirectLocation, routerState) => {
        if (error) {
            next(error);
        } else if (redirectLocation) {
            res.redirect(302, redirectLocation.pathname + redirectLocation.search);
        } else if (routerState) {
            req.routerState = routerState;
            req.store = store;
            next();
        } else {
            res.status(404).send('Not found');
        }
    }));
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/components/index.js

```js
// form
export FromGroup from './form/FromGroup';
export PlainFormItem from './form/PlainFormItem';
export TextFormItem from './form/TextFormItem';
export NumberFormItem from './form/NumberFormItem';
export ButtonFormItem from './form/ButtonFormItem';
export SelectFormItem from './form/SelectFormItem';
export EditFormItem from './form/EditFormItem';
export TableFormItem from './form/TableFormItem';
export ImageFormItem from './form/ImageFormItem';
export ImageListFormItem from './form/ImageListFormItem';
export LocateFormItem from './form/LocateFormItem';
export ChildFormItem from './form/ChildFormItem';
export DateFormItem from './form/DateFormItem';
export SizeFormItem from './form/SizeFormItem';
export CheckFormItem from './form/CheckFormItem';
export RadioFormItem from './form/RadioFormItem';
export AddressFormItem from './form/AddressFormItem';
export StartPointFormItem from './form/StartPointFormItem';
export PriceFormItem from './form/PriceFormItem';

// button
export DetailDeleteButton from './button/DetailDeleteButton';

// title
export TableContainer from './layout/TableContainer';
export DetailContainer from './layout/DetailContainer';

// table
export PlainTable from './table/PlainTable';
export TabsTable from './table/TabsTable';

// config
export * from './form/config';

```

* PDShop_Shop_PC/project/App/shared/pages/shared/utils/account.js

```js
export function getPayTool (str = '') {
    if (str === 'SIMULATION_NO') {
        return '模拟';
    }
    const options = {
        'A': '支付宝',
        'C': '财付通',
        'G': '工商银行',
        'J': '建设银行',
        'Z': '中国银行',
        'N': '农业银行',
    };
    const list = str.split('#');
    return options[list[0]];
}
export function getPayAccount (str = '') {
    if (str === 'SIMULATION_NO') {
        return 'SIMULATION_ACCOUNT';
    }
    const list = str.split('#');
    return list[2];
}
export function getPayBill (str = '') {
    if (str === 'SIMULATION_NO') {
        return 'SIMULATION_NO';
    }
    const list = str.split('#');
    return list[1];
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/utils/check.js

```js
import _ from 'lodash';

export function testTelePhone (phone) {
    return /^1\d{10}$/.test(phone);
}
export function testPhone (phone) {
    return /^(0\d{2}-?\d{8}(-?\d{1,4})?)|(0\d{3}-?\d{7,8}(-?\d{1,4})?)$/.test(phone);
}

export function checkTelePhone (rule, value, callback) {
    if (!testTelePhone(value)) {
        callback('请输入正确的手机号码');
    } else {
        callback();
    }
}
export function checkPhone (rule, value, callback) {
    if (!testPhone(value) && !testTelePhone(value)) {
        callback('请输入正确的电话号码');
    } else {
        callback();
    }
}

export function checkPhoneList (rule, value = '', callback) {
    const phoneList = _.reject(_.map(value.split(/;|；/), m => m.trim()), o => !o.length);
    if (phoneList.length && !_.every(phoneList, o => testPhone(o) || testTelePhone(o))) {
        callback('请输入正确的电话号码');
    } else {
        callback();
    }
}
export function checkEmail (rule, value, callback) {
    if (value && !/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(value)) {
        callback('请输入正确的邮箱地址');
    } else {
        callback();
    }
}
export function checkBankCard (rule, value, callback) {
    if (value && !/^(\d{16}|\d{19})$/.test(value)) {
        callback('请输入正确的银行卡卡号');
    } else {
        callback();
    }
}
export function checkVerifyCode (rule, value, callback) {
    if (value && !/^\d{6}$/.test(value)) {
        callback('请输入正确的验证码');
    } else {
        callback();
    }
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/utils/common.js

```js
import _ from 'lodash';

export function _N (num, rank = 2) {
    typeof num !== 'number' && (num = 0);
    return parseFloat(num.toFixed(rank));
}
export function omitNil (obj) {
    return _.omitBy(obj, _.isNil);
}
export function needLoadPage (data, property, pageNo, pageSize) {
    const count = _.get(data, 'count');
    const list = _.get(data, property);
    const maxFullPage = Math.floor((count - 1) / pageSize);
    const maxDetectListSize = pageNo < maxFullPage ? pageSize : count - maxFullPage * pageSize;
    const detectList = _.slice(list, pageNo * pageSize, (pageNo + 1) * pageSize);
    let needLoad = true;
    if (detectList.length === maxDetectListSize) {
        needLoad = !_.every(detectList);
    }
    return needLoad;
}
export function until (test, iterator, callback) {
    if (!test()) {
        iterator((err) => {
            if (err) {
                return callback(err);
            }
            until(test, iterator, callback);
        });
    } else {
        callback();
    }
}
export function toThousands (num) {
    return (num || 0).toString().replace(/(\d)(?=(?:\d{3})+$)/g, '$1,');
}
export function getPercentages (list) {
    const sum = _.sum(list);
    return list.map((v) => Math.round(v * 100 / sum) + '%');
}
export function formatPhoneList (phoneList = '', phone = '') {
    phoneList = phone + ';' + phoneList.replace('；', ';');
    phoneList = _.uniq(_.filter(_.map(phoneList.split(';'), m => m.trim()), o => !!o));
    return phoneList.join(';');
}
export function getAddressOptions (list = [], lastCode, withTown) { // withTown为true，会一直选择到镇级和街道级
    let options;
    let value = [];
    for (const item of list) {
        const parent = _.find(item, o => o.code === lastCode) || {};
        parent.children = options;
        lastCode = parent.parentCode;
        parent.name && (value.unshift(parent.name));
        options = item.map(o => ({ value: o.name, label: o.name, code: o.code, level: o.level, isLeaf: !withTown ? o.isLeaf : o.level === 10, children: o.children }));
    }
    return {
        value,
        options: options || [],
    };
}
export function getStartPointOptions (list = [], lastCode, id) { // 如果始发地是分店或者收货点，则传id，否则不传，一旦传了id，lastCode则无效
    let options;
    let value = [];
    for (const item of list) {
        const parent = _.find(item, o => !id ? o.code === lastCode : o.id === id) || {};
        parent.children = options;
        lastCode = parent.isLeaf ? parent.addressRegionLastCode : parent.parentCode;
        (parent.id || parent.name) && (value.unshift(parent.id || parent.name));
        options = item.map(o => ({ value: o.id || o.name, label: o.name + (o.isShop ? '（分店）' : o.isAgent ? '（收货点）' : ''), code: o.code, level: o.level, isLeaf: o.isLeaf || false, isShop: o.isShop, isAgent: o.isAgent, children: o.children }));
        id = undefined;
    }
    return {
        value,
        options: options || [],
    };
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/utils/confirm.js

```js
import React from 'react';
import _ from 'lodash';
import { Modal, Input, notification } from 'antd';

export function confirm ({ pre, name, post = '' }, onOk) {
    Modal.confirm({
        title: '确认',
        content: (
            <div style={{ paddingTop: 10, fontSize: 14 }}>
                确定{pre}{name && <span style={{ color: 'red' }}>{name}</span>}{post}吗？
            </div>
        ),
        okText: '确定',
        cancelText: '取消',
        onOk,
    });
}
export function confirmWithPassword ({ pre, name, post = '', type = '登录' }, onOk) {
    let password = '';
    Modal.confirm({
        title: '确认',
        content: (
            <div style={{ paddingTop: 10, fontSize: 14 }}>
                {pre}{name && <span style={{ color: 'red' }}>{name}</span>}{post} 需要输入确认身份，请输入{type}密码。
                <Input style={{ marginTop: 10 }} placeholder={`请输入${type}密码`} maxLength={20}
                    type='password' autoComplete='off' onContextMenu={_.noop} onPaste={_.noop}
                    onCopy={_.noop} onCut={_.noop} onChange={(e) => {
                        password = e.target.value;
                    }} />
            </div>
        ),
        okText: '确定',
        cancelText: '取消',
        onOk: () => { onOk(password); },
    });
}
export function handleEditCancel () {
    Modal.confirm({
        title: '提示',
        content: (
            <div style={{ paddingTop: 10, fontSize: 14 }}>
                确定取消修改吗？
            </div>
        ),
        okText: '确定',
        cancelText: '取消',
        onOk: () => {
            this.setState({ pageData: _.cloneDeep(this.state.origin), editing: false });
        },
    });
}
export function showSuccess (info, title) {
    notification.success({ placement: 'bottomRight', key:'success', description: info, message: title });
}
export function showError (info, title) {
    notification.error({ placement: 'bottomRight', key:'error', description: info, message: title });
}

```

* PDShop_Shop_PC/project/App/shared/pages/shared/utils/index.js

```js
export * from './common';
export * from './check';
export * from './confirm';
export * from './account';
export * from './qrcode';

```

* PDShop_Shop_PC/project/App/shared/pages/shared/utils/qrcode.js

```js
export function genQRString (id, type) {
    const str = JSON.stringify({ c: 's', t: type, d: id });
    let output = '';
    for (let x = 0, y = str.length, charCode, hexCode; x < y; ++x) {
        charCode = str.charCodeAt(x);
        if (charCode < 128) {
            charCode += 128;
        } else if (charCode > 127) {
            charCode -= 128;
        }
        charCode = 255 - charCode;
        hexCode = charCode.toString(16);
        if (hexCode.length < 2) {
            hexCode = '0' + hexCode;
        }
        output += hexCode;
    }
    return output;
}
export function getQRResult (str) {
    let output = '';
    for (let x = 0, y = str.length, charCode, hexCode; x < y; x += 2) {
        hexCode = str.substr(x, 2);
        charCode = parseInt(hexCode, 16);
        charCode = 255 - charCode;
        if (charCode < 128) {
            charCode += 128;
        } else if (charCode > 127) {
            charCode -= 128;
        }
        output += String.fromCharCode(charCode);
    }
    try {
        const result = JSON.parse(output);
        if (result.c !== 's') {
            return undefined;
        }
        return { type: result.t, id: result.d };
    } catch (e) {
        return undefined;
    }
}

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/agent/checkAgentByChairManPhone.js

```js
import {
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { agentResultType } from '../../types/agent';
import { post, urls } from 'helpers/api';

export default {
    type: agentResultType,
    args: {
        chairManPhone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.checkAgentByChairManPhone, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/agent/createAgent.js

```js
import { authorize } from '../../authorize';
import { agentInputType, agentResultType } from '../../types/agent';
import { post, urls } from 'helpers/api';

export default {
    type: agentResultType,
    args: {
        data: {
            type: agentInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.createAgent, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/agent/index.js

```js
export createAgent from './createAgent';
export modifyAgent from './modifyAgent';
export removeAgent from './removeAgent';
export checkAgentByChairManPhone from './checkAgentByChairManPhone';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/agent/modifyAgent.js

```js
import { authorize } from '../../authorize';
import { agentInputType, agentResultType } from '../../types/agent';
import { post, urls } from 'helpers/api';

export default {
    type: agentResultType,
    args: {
        data: {
            type: agentInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyAgent, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/agent/removeAgent.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        agentId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeAgent, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/member/createMember.js

```js
import { authorize } from '../../authorize';
import { memberInputType, memberResultType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: memberResultType,
    args: {
        data: {
            type: memberInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.createMember, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/member/index.js

```js
export createMember from './createMember';
export modifyMember from './modifyMember';
export removeMember from './removeMember';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/member/modifyMember.js

```js
import { authorize } from '../../authorize';
import { memberInputType, memberResultType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: memberResultType,
    args: {
        data: {
            type: memberInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyMember, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/member/removeMember.js

```js
import {
    GraphQLID,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        memberId: {
            type: GraphQLID,
        },
        password: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeMember, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/notify/index.js

```js
export sendNotify from './sendNotify';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/notify/sendNotify.js

```js
import { notifyResultType, notifyInputType } from '../../types/notify';
import { post, urls } from 'helpers/api';

export default {
    type: notifyResultType,
    args: {
        data: {
            type: notifyInputType,
        },
    },
    async resolve (root, params, options) {
        params.data.source = '物流超市平台';
        params.data.memberId = root.user.userId;
        return await post(urls.sendNotify, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/index.js

```js
export placeOriginOrder from './placeOriginOrder';
export placeOriginOrderWithPreOrder from './placeOriginOrderWithPreOrder';
export modifyOriginOrder from './modifyOriginOrder';
export selectRoadmap from './selectRoadmap';
export selectRoadmapForOrderList from './selectRoadmapForOrderList';
export proxyPay from './proxyPay';
export proxyPayForOrderList from './proxyPayForOrderList';
export printOrderBill from './printOrderBill';
export printOrderListBill from './printOrderListBill';
export printBarCode from './printBarCode';
export removeOrder from './removeOrder';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/modifyOriginOrder.js

```js
import { authorize } from '../../authorize';
import { orderInputType, orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyOriginOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/placeOriginOrder.js

```js
import { authorize } from '../../authorize';
import { orderInputType, orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.placeOriginOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/placeOriginOrderWithPreOrder.js

```js
import { authorize } from '../../authorize';
import { orderInputType, orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.placeOriginOrderWithPreOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/printBarCode.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.printBarCode, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/printOrderBill.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.printOrderBill, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/printOrderListBill.js

```js
import {
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderIdList: {
            type: new GraphQLList(GraphQLID),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.printOrderListBill, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/proxyPay.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.proxyPay, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/proxyPayForOrderList.js

```js
import {
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderIdList: {
            type: new GraphQLList(GraphQLID),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.proxyPayForOrderList, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/removeOrder.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeOrder, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/selectRoadmap.js

```js
import { authorize } from '../../authorize';
import { orderInputType, orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.selectRoadmap, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/order/selectRoadmapForOrderList.js

```js
import {
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderIdList: {
            type: new GraphQLList(GraphQLID),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.selectRoadmapForOrderList, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/roadmap/addRoadmapRegionProfitRate.js

```js
import { authorize } from '../../authorize';
import { regionRateInputType, regionRateResultType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: regionRateResultType,
    args: {
        data: {
            type: regionRateInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.addRoadmapRegionProfitRate, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/roadmap/index.js

```js
export setRoadmapProfit from './setRoadmapProfit';
export setRegionRateProfit from './setRegionRateProfit';
export addRoadmapRegionProfitRate from './addRoadmapRegionProfitRate';
export modifyRoadmapRegionProfitRate from './modifyRoadmapRegionProfitRate';
export removeRoadmapRegionProfitRate from './removeRoadmapRegionProfitRate';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/roadmap/modifyRoadmapRegionProfitRate.js

```js
import { authorize } from '../../authorize';
import { regionRateInputType, regionRateResultType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: regionRateResultType,
    args: {
        data: {
            type: regionRateInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyRoadmapRegionProfitRate, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/roadmap/removeRoadmapRegionProfitRate.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        regionRateId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeRoadmapRegionProfitRate, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/roadmap/setRegionRateProfit.js

```js
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { regionRateInputType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: regionRateInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.setRegionRateProfit, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/roadmap/setRoadmapProfit.js

```js
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { roadmapInputType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: roadmapInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.setRoadmapProfit, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/partment/createPartment.js

```js
import { authorize } from '../../authorize';
import { partmentInputType, partmentResultType } from '../../types/partment';
import { post, urls } from 'helpers/api';

export default {
    type: partmentResultType,
    args: {
        data: {
            type: partmentInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.createPartment, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/partment/index.js

```js
export createPartment from './createPartment';
export modifyPartment from './modifyPartment';
export removePartment from './removePartment';
export modifyOwnPartment from './modifyOwnPartment';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/partment/modifyOwnPartment.js

```js
import { authorize } from '../../authorize';
import { partmentInputType, partmentResultType } from '../../types/partment';
import { post, urls } from 'helpers/api';

export default {
    type: partmentResultType,
    args: {
        data: {
            type: partmentInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyOwnPartment, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/partment/modifyPartment.js

```js
import { authorize } from '../../authorize';
import { partmentInputType, partmentResultType } from '../../types/partment';
import { post, urls } from 'helpers/api';

export default {
    type: partmentResultType,
    args: {
        data: {
            type: partmentInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyPartment, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/partment/removePartment.js

```js
import {
    GraphQLID,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        partmentId: {
            type: GraphQLID,
        },
        password: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removePartment, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/personal/feedback.js

```js
import {
    GraphQLString,
} from 'graphql';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        content: {
            type: GraphQLString,
        },
        email: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.feedback, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/personal/forgotPwd.js

```js
import { successType } from '../../types/common';
import { memberInputType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: memberInputType,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.forgotPwd, params.data) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/personal/index.js

```js
export register from './register';
export forgotPwd from './forgotPwd';
export setPaymentPassword from './setPaymentPassword';
export modifyPersonalInfo from './modifyPersonalInfo';
export feedback from './feedback';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/personal/modifyPersonalInfo.js

```js
import { authorize } from '../../authorize';
import { memberResultType, memberInputType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: memberResultType,
    args: {
        data: {
            type: memberInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyPersonalInfo, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/personal/register.js

```js
import { successType } from '../../types/common';
import { memberInputType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: memberInputType,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.register, params.data) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/personal/setPaymentPassword.js

```js
import { successType } from '../../types/common';
import { memberInputType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: memberInputType,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.setPaymentPassword, params.data) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shipper/createAndRegisterShipper.js

```js
import { authorize } from '../../authorize';
import { shipperResultType, shipperInputType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperResultType,
    args: {
        data: {
            type: shipperInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.createAndRegisterShipper, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shipper/index.js

```js
export registerShipper from './registerShipper';
export createAndRegisterShipper from './createAndRegisterShipper';
export modifyShipper from './modifyShipper';
export passExamineTruck from './passExamineTruck';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shipper/modifyShipper.js

```js
import { authorize } from '../../authorize';
import { shipperResultType, shipperInputType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperResultType,
    args: {
        data: {
            type: shipperInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyShipper, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shipper/passExamineTruck.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        truckId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.passExamineTruck, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shipper/registerShipper.js

```js
import { authorize } from '../../authorize';
import { shipperResultType, shipperInputType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperResultType,
    args: {
        data: {
            type: shipperInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.registerShipper, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/warehouse/createWarehouse.js

```js
import { authorize } from '../../authorize';
import { warehouseInputType, warehouseResultType } from '../../types/warehouse';
import { post, urls } from 'helpers/api';

export default {
    type: warehouseResultType,
    args: {
        data: {
            type: warehouseInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.createWarehouse, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/warehouse/index.js

```js
export createWarehouse from './createWarehouse';
export modifyWarehouse from './modifyWarehouse';
export removeWarehouse from './removeWarehouse';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/warehouse/modifyWarehouse.js

```js
import { authorize } from '../../authorize';
import { warehouseInputType, warehouseResultType } from '../../types/warehouse';
import { post, urls } from 'helpers/api';

export default {
    type: warehouseResultType,
    args: {
        data: {
            type: warehouseInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyWarehouse, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/warehouse/removeWarehouse.js

```js
import { authorize } from '../../authorize';
import { warehouseResultType } from '../../types/warehouse';
import { post, urls } from 'helpers/api';
import { GraphQLID, GraphQLString } from 'graphql';

export default {
    type: warehouseResultType,
    args: {
        warehouseId: {
            type: GraphQLID,
        },
        password: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeWarehouse, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shop/createBranchShop.js

```js
import { authorize } from '../../authorize';
import { shopInputType, shopResultType } from '../../types/shop';
import { post, urls } from 'helpers/api';

export default {
    type: shopResultType,
    args: {
        data: {
            type: shopInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.createBranchShop, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shop/index.js

```js
export modifyOwnShop from './modifyOwnShop';
export createBranchShop from './createBranchShop';
export modifyBranchShop from './modifyBranchShop';
export removeBranchShop from './removeBranchShop';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shop/modifyBranchShop.js

```js
import { authorize } from '../../authorize';
import { shopInputType, shopResultType } from '../../types/shop';
import { post, urls } from 'helpers/api';

export default {
    type: shopResultType,
    args: {
        data: {
            type: shopInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyBranchShop, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shop/modifyOwnShop.js

```js
import { authorize } from '../../authorize';
import { shopInputType, shopResultType } from '../../types/shop';
import { post, urls } from 'helpers/api';

export default {
    type: shopResultType,
    args: {
        data: {
            type: shopInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyOwnShop, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/shop/removeBranchShop.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        shopId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeBranchShop, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/account/bills.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { billItemListType } from '../../types/bill';
import { post, urls } from 'helpers/api';

const billsType = new GraphQLObjectType({
    name: 'billsType',
    fields: {
        recharge: { type: billItemListType },
        withdraw: { type: billItemListType },
        income: { type: billItemListType },
        pay: { type: billItemListType },
    },
});

export default {
    type: billsType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.bills, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/account/index.js

```js
export remainAmount from './remainAmount';
export weixinPayGetUnifiedOrder from './weixinPayGetUnifiedOrder';
export weixinPayWithDraw from './weixinPayWithDraw';
export bills from './bills';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/account/remainAmount.js

```js
import { authorize } from '../../authorize';
import { accountType } from '../../types/account';
import { post, urls } from 'helpers/api';

export default {
    type: accountType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.remainAmount, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/account/weixinPayGetUnifiedOrder.js

```js
import { authorize } from '../../authorize';
import { accountResultType, accountInputType } from '../../types/account';
import { post, urls } from 'helpers/api';

export default {
    type: accountResultType,
    args: {
        data: {
            type: accountInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.weixinPayGetUnifiedOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/account/weixinPayWithDraw.js

```js
import { authorize } from '../../authorize';
import { accountResultType, accountInputType } from '../../types/account';
import { post, urls } from 'helpers/api';

export default {
    type: accountResultType,
    args: {
        data: {
            type: accountInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.weixinPayWithDraw, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/agent/agent.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { agentType } from '../../types/agent';
import { post, urls } from 'helpers/api';

export default {
    type: agentType,
    args: {
        agentId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let agent = await post(urls.agent, params, root) || {};
        return agent.context || {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/agent/agents.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { agentListType } from '../../types/agent';
import { post, urls } from 'helpers/api';

export default {
    type: agentListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.agents, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/agent/index.js

```js
export agent from './agent';
export agents from './agents';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/client/client.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { clientType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: clientType,
    args: {
        clientId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.client, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/client/clients.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { clientListType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: clientListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.clients, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/client/getClientNameByPhone.js

```js
import {
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { clientResultType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: clientResultType,
    args: {
        phone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.getClientNameByPhone, params, root) || {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/client/index.js

```js
export client from './client';
export clients from './clients';
export getClientNameByPhone from './getClientNameByPhone';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/common/address.js

```js
import {
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { addressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(addressType),
    args: {
        parentCode: {
            type: GraphQLInt,
        },
        type: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.address, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/common/addressFromLastCode.js

```js
import {
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { addressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(new GraphQLList(addressType)),
    args: {
        addressLastCode: {
            type: GraphQLInt,
        },
        type: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.addressFromLastCode, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/common/addressWithOrder.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderAddressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: orderAddressType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.addressWithOrder, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/common/index.js

```js
export address from './address';
export addressWithOrder from './addressWithOrder';
export addressFromLastCode from './addressFromLastCode';
export sendDoorAddressWithOrder from './sendDoorAddressWithOrder';
export sendDoorAddressFromLastCode from './sendDoorAddressFromLastCode';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/common/sendDoorAddressFromLastCode.js

```js
import {
    GraphQLList,
    GraphQLInt,
} from 'graphql';
import { authorize } from '../../authorize';
import { addressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(new GraphQLList(addressType)),
    args: {
        addressLastCode: {
            type: GraphQLInt,
        },
        parentCode: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.sendDoorAddressFromLastCode, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/common/sendDoorAddressWithOrder.js

```js
import {
    GraphQLList,
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { addressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(new GraphQLList(addressType)),
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.sendDoorAddressWithOrder, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/member/index.js

```js
export members from './members';
export member from './member';
export wareHouseMembers from './wareHouseMembers';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/member/member.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: memberType,
    args: {
        memberId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.member, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/member/members.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberListType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: memberListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.members, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/member/warehouseMembers.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberListType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: memberListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.warehouseMemberList, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/notify/index.js

```js
export notifies from './notifies';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/notify/notifies.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { notifyListType } from '../../types/notify';
import { post, urls } from 'helpers/api';

const notifiesType = new GraphQLObjectType({
    name: 'notifiesType',
    fields: {
        news: { type: notifyListType },
        publicity: { type: notifyListType },
        policy: { type: notifyListType },
        notice: { type: notifyListType },
    },
});

export default {
    type: notifiesType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.notifies, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/order/index.js

```js
export order from './order';
export orders from './orders';
export rporder from './rporder';
export rporders from './rporders';
export whorders from './whorders';
export selectPreOrders from './selectPreOrders';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/order/order.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.order, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/order/orders.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLID,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderItemListType } from '../../types/order';
import { post, urls } from 'helpers/api';

const ordersType = new GraphQLObjectType({
    name: 'ordersType',
    fields: {
        toselectroadmap: { type: orderItemListType },
        toprintbarcode: { type: orderItemListType },
        topay: { type: orderItemListType },
        toprintbill: { type: orderItemListType },
        tostore: { type: orderItemListType },
        stored: { type: orderItemListType },
        tostartoff: { type: orderItemListType },
        onway: { type: orderItemListType },
        success: { type: orderItemListType },
    },
});

export default {
    type: ordersType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        shopId: {
            type: GraphQLID,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.orders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/order/rporder.js

```js
import { authorize } from '../../authorize';
import { orderType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.rporder, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/order/rporders.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderItemListType } from '../../types/order';
import { post, urls } from 'helpers/api';

const rpordersType = new GraphQLObjectType({
    name: 'rpordersType',
    fields: {
        toselectroadmap: { type: orderItemListType },
        topay: { type: orderItemListType },
        toprintbill: { type: orderItemListType },
        tostore: { type: orderItemListType },
        stored: { type: orderItemListType },
    },
});

export default {
    type: rpordersType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.rporders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/order/selectPreOrders.js

```js
import {
    GraphQLInt,
    GraphQLString,
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderListType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        senderPhone: {
            type: GraphQLID,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.selectPreOrders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/order/whorders.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderItemListType } from '../../types/order';
import { post, urls } from 'helpers/api';

const whordersType = new GraphQLObjectType({
    name: 'whordersType',
    fields: {
        stored: { type: orderItemListType },
        loaded: { type: orderItemListType },
    },
});

export default {
    type: whordersType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.whorders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/partment/index.js

```js
export partments from './partments';
export partment from './partment';
export ownPartment from './ownPartment';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/partment/ownPartment.js

```js
import { authorize } from '../../authorize';
import { partmentType } from '../../types/partment';
import { post, urls } from 'helpers/api';

export default {
    type: partmentType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.ownPartment, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/partment/partment.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { partmentType } from '../../types/partment';
import { post, urls } from 'helpers/api';

export default {
    type: partmentType,
    args: {
        partmentId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.partment, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/partment/partments.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { partmentListType } from '../../types/partment';
import { post, urls } from 'helpers/api';

export default {
    type: partmentListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.partments, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/personal/getVerifyCode.js

```js
import {
    GraphQLString,
} from 'graphql';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        phone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.getVerifyCode, params) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/personal/index.js

```js
export session from './session';
export login from './login';
export personal from './personal';
export getVerifyCode from './getVerifyCode';
export statistics from './statistics';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/personal/login.js

```js
import {
    GraphQLString,
} from 'graphql';
import passport from 'passport';
import { successType } from '../../types/common';

export default {
    type: successType,
    args: {
        phone: {
            type: GraphQLString,
        },
        password: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        return new Promise((resolve) => {
            const { req } = root;
            req.body = params;
            console.log('[login]: start', params);
            passport.authenticate('local', (err, user) => {
                console.log('[login]: authenticate', err, user);
                if (err) {
                    resolve({ msg: err.message });
                } else {
                    req.logIn(user, (error) => {
                        console.log('[login] logIn:', error);
                        if (error) {
                            resolve({ msg: '服务器错误' });
                        } else {
                            resolve({ success: true });
                        }
                    });
                }
            })(req);
        });
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/personal/personal.js

```js
import { authorize } from '../../authorize';
import { memberType } from '../../types/member';
import { post, urls } from 'helpers/api';

export default {
    type: memberType,
    async resolve (root, params, options) {
        authorize(root);
        let personal = await post(urls.personal, params, root) || {};
        return personal.context || {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/personal/session.js

```js
import { GraphQLBoolean } from 'graphql';

export default {
    type: GraphQLBoolean,
    resolve (root) {
        return root.isAuthenticated;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/personal/statistics.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { post, urls } from 'helpers/api';

const releaseCardInfoType = new GraphQLObjectType({
    name: 'releaseCardInfoType',
    fields: {
        today: { type: GraphQLInt },
        past: { type: GraphQLInt },
        remain: { type: GraphQLInt },
    },
});
const consumeInfoType = new GraphQLObjectType({
    name: 'consumeInfoType',
    fields: {
        today: { type: new GraphQLList(GraphQLInt) },
        week: { type: new GraphQLList(GraphQLInt) },
        month: { type: new GraphQLList(GraphQLInt) },
    },
});
const userSexInfoType = new GraphQLObjectType({
    name: 'userSexInfoType',
    fields: {
        male: { type: GraphQLInt },
        female: { type: GraphQLInt },
    },
});
const statisticsType = new GraphQLObjectType({
    name: 'statisticsType',
    fields: {
        releaseCardInfo: { type: releaseCardInfoType },
        consumeInfo: { type: consumeInfoType },
        userSexInfo: { type: userSexInfoType },
        userAgeInfo: { type: new GraphQLList(GraphQLInt) },
    },
});

export default {
    type: statisticsType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.statistics, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/roadmap/index.js

```js
export roadmap from './roadmap';
export roadmaps from './roadmaps';
export onOrderRoadmaps from './onOrderRoadmaps';
export regionRate from './regionRate';
export regionRates from './regionRates';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/roadmap/onOrderRoadmaps.js

```js
import {
    GraphQLInt,
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { roadmapListType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapListType,
    args: {
        orderId: {
            type: GraphQLID,
        },
        orderBy: {
            type: GraphQLInt,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.onOrderRoadmaps, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/roadmap/regionRate.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { regionRateType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: regionRateType,
    args: {
        regionRateId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.regionRate, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/roadmap/regionRates.js

```js
import {
    GraphQLInt,
    GraphQLID,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { regionRateListType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: regionRateListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        shopId: {
            type: GraphQLID,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.regionRates, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/roadmap/roadmap.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { roadmapType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapType,
    args: {
        roadmapId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.roadmap, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/roadmap/roadmaps.js

```js
import {
    GraphQLInt,
    GraphQLID,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { roadmapListType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        shopId: {
            type: GraphQLID,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.roadmaps, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/setting/index.js

```js
export setting from './setting';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/setting/setting.js

```js
import { authorize } from '../../authorize';
import { settingType } from '../../types/setting';
import { post, urls } from 'helpers/api';

export default {
    type: settingType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.setting, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shipper/getShipperByChairManPhone.js

```js
import {
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { shipperResultType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperResultType,
    args: {
        chairManPhone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.getShipperByChairManPhone, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shipper/index.js

```js
export shipper from './shipper';
export shippers from './shippers';
export getShipperByChairManPhone from './getShipperByChairManPhone';
export trucks from './trucks';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shipper/shipper.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { shipperType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperType,
    args: {
        shipperId: {
            type: GraphQLID,
        },
        shopId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.shipper, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shipper/shippers.js

```js
import {
    GraphQLInt,
    GraphQLID,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { shipperListType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        shopId: {
            type: GraphQLID,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.shippers, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shipper/trucks.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { truckListType } from '../../types/truck';
import { post, urls } from 'helpers/api';

export default {
    type: truckListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.trucks, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shop/branchShop.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { shopType } from '../../types/shop';
import { post, urls } from 'helpers/api';

export default {
    type: shopType,
    args: {
        shopId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        if (!params.shopId) {
            return undefined;
        }
        let shop = await post(urls.branchShop, params, root) || {};
        return shop.context || undefined;
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shop/branchShops.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { branchShopListType } from '../../types/shop';
import { post, urls } from 'helpers/api';

export default {
    type: branchShopListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.branchShops, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shop/index.js

```js
export shop from './shop';
export branchShop from './branchShop';
export branchShops from './branchShops';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/shop/shop.js

```js
import { authorize } from '../../authorize';
import { shopType } from '../../types/shop';
import { post, urls } from 'helpers/api';

export default {
    type: shopType,
    async resolve (root, params, options) {
        authorize(root);
        let shop = await post(urls.shop, params, root) || {};
        return shop.context || {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/statistic/index.js

```js
export shopStatistics from './shopStatistics';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/statistic/shopStatistics.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { shopStatisticType } from '../../types/statistic';
import { post, urls } from 'helpers/api';

export default {
    type: shopStatisticType,
    args: {
        shopId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.shopStatistics, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/shared/helpers/api/index.js

```js
export urls from './urls';
export post from './post';

```

* PDShop_Shop_PC/project/App/server/shared/helpers/api/post.js

```js
import request from 'superagent';

export default function doRequest (url, data, root) {
    return new Promise((resolve) => {
        if (root && root.user) {
            Object.assign(data, { userId: root.user.userId, fromPC: true });
        }
        const req = request
        .post(url)
        .set({
            'Content-Type': 'application/json',
            'Accept': 'application/json',
        })
        .send(data);

        req.end((error, res) => {
            if (error) {
                console.error('recv error[' + url + ']:', error);
                resolve();
            } else {
                console.log('recv[' + url + ']:', res.body);
                resolve(res.body);
            }
        });
    });
}

```

* PDShop_Shop_PC/project/App/server/shared/helpers/api/urls.js

```js
const { apiServer } = require('../../../../../config.js');
const server = apiServer + 'shop/';
module.exports = {
    // common
    address: apiServer + 'getRegionAddress', // 获取地址列表
    addressFromLastCode: apiServer + 'getRegionAddressFromLastCode', // 通过最后一个code地址列表
    sendDoorAddressFromLastCode: server + 'getRegionSendDoorAddressFromLastCode', // 通过最后一个code获取送货上门地址列表

    // 个人中心
    getVerifyCode: apiServer + 'requestSendVerifyCode', // 请求发送验证码
    login: server + 'login', // 登录
    register: server + 'register', // 注册
    forgotPwd: server + 'findPassword', // 忘记密码
    setPaymentPassword: server + 'setPaymentPassword', // 设置支付密码
    modifyPassword: server + 'modifyPassword', // 修改密码
    personal: server + 'getPersonalInfo', // 获取物流公司信息
    modifyPersonalInfo: server + 'modifyPersonalInfo', // 修改个人信息
    feedback: server + 'submitFeedback', // 意见反馈

    // 账目
    remainAmount: server + 'getRemainAmount', // 获取余额
    weixinPayGetUnifiedOrder: server + 'weixinPayGetUnifiedOrderForPC', // 统一下单
    weixinPayWithDraw: server + 'withdraw', // 提现
    bills: server + 'getBills', // 获取账单

    // 店铺
    shop: server + 'getOwnShopDetail', // 获取自身所在物流超市详情（总部和分店）
    modifyOwnShop: server + 'modifyOwnShop', // 修改自身所在物流超市详情（总部和分店）
    branchShop: server + 'getBranchShopDetail', // 获取分店详情（总部）
    branchShops: server + 'getBranchShopList', // 获取分店列表（总部）
    createBranchShop: server + 'createBranchShop', // 创建分店（总部）
    modifyBranchShop: server + 'modifyBranchShop', // 修改分店（总部）
    removeBranchShop: server + 'removeBranchShop', // 删除分店（总部）

    // 货单
    orders: server + 'getOrders', // 分店获取货单综合列表
    order: server + 'getOrderDetail', // 获取货单详情

    // 部门
    partments: server + 'getPartmentList', // 获取部门列表
    ownPartment: server + 'getOwnPartmentInfo', // 获取所在部门的信息
    partment: server + 'getPartmentDetail', // 获取部门详情
    createPartment: server + 'createPartment', // 创建部门
    modifyPartment: server + 'modifyPartment', // 修改部门信息
    modifyOwnPartment: server + 'modifyOwnPartment', // 修改所在部门信息
    removePartment: server + 'removePartment', // 删除部门

    // 人员
    members: server + 'getMemberList', // 获取人员列表
    member: server + 'getMemberDetail', // 获取人员详情
    createMember: server + 'createMember', // 创建人员
    modifyMember: server + 'modifyMember', // 修改人员信息
    removeMember: server + 'removeMember', // 删除人员
    warehouseMemberList: server + 'getWarehouseMemberList',  // 获取分店库管人员

    // 设置
    setting: server + 'getSettingInfo', // 获取设置信息
    modifySetting: server + 'modifySettingInfo', // 修改设置信息

    // 物流公司
    shippers: server + 'getShipperList', // 获取物流公司列表
    shipper: server + 'getShipperDetail', // 获取物流公司详情
    registerShipper: server + 'registerShipper', // 注册物流公司
    createAndRegisterShipper: server + 'createAndRegisterShipper', // 创建并注册物流公司
    modifyShipper: server + 'modifyShipper', // 修改物流公司信息
    getShipperByChairManPhone: server + 'getShipperByChairManPhone', // 通过董事长电话获取物流公司
    passExamineTruck: server + 'passExamineTruck', // 通过汽车的审核

    // 收货点
    agents: server + 'getAgentList', // 获取收货点列表
    agent: server + 'getAgentDetail', // 获取收货点详情
    createAgent: server + 'createAgent', // 创建收货点
    modifyAgent: server + 'modifyAgent', // 修改收货点信息
    removeAgent: server + 'removeAgent', // 删除收货点
    checkAgentByChairManPhone: server + 'checkAgentByChairManPhone', // 检测收货点董事长
    trucks: server + 'getNeedExamineTruckList', // 获取需要审核的货车

    // 客户
    clients: server + 'getClientList', // 获取路线列表
    client: server + 'getClientDetail', // 获取路线详情
    getClientNameByPhone: apiServer + 'getClientNameByPhone', // 通过电话号码获取用户名

    // 路线
    onOrderRoadmaps: server + 'getRoadmapListWithOrderByReceivePartment', // 根据货单获取路线列表
    roadmap: server + 'getRoadmapDetail', // 获取路线详情
    roadmaps: server + 'getRoadmapList', // 获取路线列表
    setRoadmapProfit: server + 'setRoadmapProfit', // 批量修改路线提成比例
    regionRate: server + 'getRoadmapRegionProfitRateDetail', // 获取区域的路线提成详情
    regionRates: server + 'getRoadmapRegionProfitRateList', // 获取区域的路线提成列表
    addRoadmapRegionProfitRate: server + 'addRoadmapRegionProfitRate', // 添加区域的路线提成
    removeRoadmapRegionProfitRate: server + 'removeRoadmapRegionProfitRate', // 删除区域的路线提成
    modifyRoadmapRegionProfitRate: server + 'modifyRoadmapRegionProfitRate', // 修改区域的路线提成
    setRegionRateProfit: server + 'setRegionRateProfit', // 批量修改区域的路线提成

    // 收货部
    addressWithOrder: server + 'getRegionAddressWithOrder', // 通过货单获取地址列表
    sendDoorAddressWithOrder: server + 'getRegionSendDoorAddressWithOrder', // 通过货单获取送货上门地址列表
    rporders: server + 'getOrdersByReceivePartment', // 收货部获取货单综合列表
    rporder: server + 'getLastestOrderByReceivePartment', // 获取收货部需要的货单
    placeOriginOrder: server + 'placeOriginOrder', // 下初始货单
    placeOriginOrderWithPreOrder: server + 'placeOriginOrderWithPreOrder', // 通过预下单下初始货单
    modifyOriginOrder: server + 'modifyOriginOrder', // 修改初始货单
    removeOrder: server + 'removeOrder', // 删除货单
    selectRoadmap: server + 'selectRoadmap', // 选择物流公司
    selectRoadmapForOrderList: server + 'selectRoadmapForOrderList', // 批量为订单选择物流公司
    proxyPay: server + 'proxyPay', // 待支付
    proxyPayForOrderList: server + 'proxyPayForOrderList', // 待支付多个货单
    printOrderBill: server + 'printOrderBill', // 打印收据
    printOrderListBill: server + 'printOrderListBill', // 打印多个货单
    printBarCode: server + 'printBarCode', // 打印二维码
    selectPreOrders: server + 'getPreOrderList', // 收货部获取用户预下单列表

    // 仓库管理
    getWarehouseList: server + 'getWarehouseList', // 获取仓库列表
    getWarehouseDetail: server + 'getWarehouseDetail', // 获取仓库详细信息
    createWarehouse: server + 'createWarehouse', // 修改仓库信息
    modifyWarehouse: server + 'modifyWarehouse', // 修改仓库信息
    removeWarehouse: server + 'removeWarehouse', // 删除仓库信息

    // 库管部
    whorders: server + 'getOrdersByWareHousePartment', // 库管部获取货单综合列表

    // 统计
    shopStatistics: server + 'getStatistics', // 获取统计数据

    // 通知
    notifies: apiServer + 'getNotifies', // 获取通知列表
    sendNotify: apiServer + 'sendNotify', // 发布通知接口

    uploadFile: apiServer + 'uploadFile', // 上传文件

};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/warehouse/index.js

```js
export warehouses from './warehouses';
export warehouse from './warehouse';

```

* PDShop_Shop_PC/project/App/server/graphql/queries/warehouse/warehouse.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { warehouseType } from '../../types/warehouse';
import { post, urls } from 'helpers/api';

export default {
    type: warehouseType,
    args: {
        warehouseId:{
            type:GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.getWarehouseDetail, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/queries/warehouse/warehouses.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { warehouseListType } from '../../types/warehouse';
import { post, urls } from 'helpers/api';

export default {
    type: warehouseListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.getWarehouseList, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/setting/index.js

```js
export modifySetting from './modifySetting';

```

* PDShop_Shop_PC/project/App/server/graphql/mutations/setting/modifySetting.js

```js
import { authorize } from '../../authorize';
import { settingInputType, settingResultType } from '../../types/setting';
import { post, urls } from 'helpers/api';

export default {
    type: settingResultType,
    args: {
        data: {
            type: settingInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifySetting, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/index.js

```js
import bodyParser from 'body-parser';
import express from 'express';
import graphqlHTTP from 'express-graphql';
import morgan from 'morgan';
import path from 'path';
import passport from 'passport';
import { Strategy as LocalStrategy } from 'passport-local';
import connectMongo from 'connect-mongo';
import session from 'express-session';

import { post, urls } from 'helpers/api';
import config from '../../config';
import routers from './routers';
import schema from './schema';

const app = express();

app.use(morgan('short'));
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json({ limit: 100000000 }));

// session
const MongoStore = connectMongo(session);
app.use(session({
    secret: '88164657simiantong_shipper', // session的密码
    resave: true,
    saveUninitialized: false,
    store: new MongoStore({
        url: config.dbServer,
        collection: 'sessions_shipper',
    }),
}));

// Passport
app.use(passport.initialize());
app.use(passport.session());
passport.use('local', new LocalStrategy({
    usernameField: 'phone',
}, async (phone, password, done) => {
    const user = { phone, password };
    console.log('[login]: LocalStrategy', user);
    const data = await post(urls.login, user) || { msg: '服务器错误' };
    if (!data.success) {
        return done({ message: data.msg });
    }

    return done(null, Object.assign({}, data.context));
}));
passport.serializeUser((user, done) => { // 保存 user 到 sessoon
    console.log('[login]: serializeUser', user, done);
    done(null, user);// 可以通过数据库方式操作
});
passport.deserializeUser((user, done) => { // 通过保存的 user 信息到 sessoon 获取 user
    console.log('[login]: deserializeUser', user, done);
    done(null, user);// 可以通过数据库方式操作
});

// Static files
app.use(express.static(path.resolve('public')));
app.use(['/client/favicon.ico', '/client/images*', '/client/media*', '/client/css*', '/client/fonts*', '/client/assets*'], (req, res) => {
    res.status(404).end();
});

// GraphqQL server
app.use('/client/graphql', graphqlHTTP(req => ({
    schema: schema.getSchema(),
    rootValue: {
        isAuthenticated: req.isAuthenticated(),
        user: req.user,
        req: req,
    },
    graphiql: true,
})));

app.use(async (req, res, next) => {
    res.locals.header = [
        {
            tag: 'title',
            content: '四面通物流大超市客户端',
        },
    ];

    if (process.env.NODE_ENV !== 'production') {
        res.baseScriptsURL = `http://localhost:${config.devPort}`;
        res.locals.header.push({
            tag: 'script',
            props: {
                src: `${res.baseScriptsURL}/webpack-dev-server.js`,
            },
        });
    } else {
        res.baseScriptsURL = '';
    }

    // footer
    res.locals.footer = [{
        tag: 'script',
        props: {
            src: `${res.baseScriptsURL}/client/assets/common.js`,
        },
    }, /* {
        tag: 'script',
        props: {
            src: `http://api.map.baidu.com/api?v=2.0&ak=${config.baiduMapSK}`,
        },
    }*/];

    next();
});

app.use(routers.authRouter);
app.use(routers.clientRouter);
app.use(routers.publicRouter);

app.use((req, res) => {
    res.status(404).end();
});

app.use((error, req, res) => {
    const statusCode = error.statusCode || 500;
    const err = {
        error: statusCode,
        message: error.message,
    };
    if (!res.headersSent) {
        res.status(statusCode).send(err);
    }
});

export default app;

```

* PDShop_Client_PC/project/App/server/schema.js

```js
import clone from 'lodash/clone';
import {
    GraphQLObjectType,
    GraphQLSchema,
} from 'graphql';

import mutations from './graphql/mutations';
import queries from './graphql/queries';

class SchemaManager {
    constructor () {
        this.init();
    }

    async init () {
        this.queryFields = clone(queries);
        this.mutationFields = clone(mutations);

        this.rootQuery = new GraphQLObjectType({
            name: 'Query',
            fields: () => (this.queryFields),
        });
        this.rootMutation = new GraphQLObjectType({
            name: 'Mutation',
            fields: () => (this.mutationFields),
        });
    }

    getSchema () {
        const schema = {
            query: this.rootQuery,
        };

        if (Object.keys(this.mutationFields).length) {
            schema.mutation = this.rootMutation;
        }

        return new GraphQLSchema(schema);
    }
}

export default new SchemaManager();

```

* PDShop_Client_PC/project/App/client/auth.js

```js
import routes from 'routers/auth';
import renderRoutes from './helpers/render-routes';

renderRoutes(routes);

```

* PDShop_Client_PC/project/App/client/client.js

```js
import 'babel-polyfill';

import routes from 'routers/client';
import renderRoutes from './helpers/render-routes';

renderRoutes(routes);

```

* PDShop_Client_PC/project/App/client/public.js

```js
import routes from 'routers/public';
import renderRoutes from './helpers/render-routes';

renderRoutes(routes);

```

* PDShop_Client_PC/project/App/server/graphql/authorize.js

```js
export function authorize (root) {
    if (!root.user) {
        throw new Error('unauthorized');
    }
}

```

* PDShop_Client_PC/project/App/server/routers/auth.js

```js
import getDefaultFavicon from 'helpers/default-favicon';
import getMarkup from 'helpers/get-markup';
import routeHandler from 'helpers/route-handler';
import routes from 'routers/auth';
import { Router } from 'express';

const authRouter = new Router();

function injectScript (req, res, next) {
    if (process.env.NODE_ENV === 'production') {
        res.locals.header.push({
            tag: 'link',
            props: {
                rel: 'stylesheet',
                type: 'text/css',
                href: '/client/assets/auth.css',
            },
        });
        // res.locals.header.push({
        //     tag: 'link',
        //     props: {
        //         rel: 'stylesheet',
        //         type: 'text/css',
        //         href: '/client/assets/common.js.css',
        //     },
        // });
    }
    res.locals.header.push(getDefaultFavicon(res));
    res.locals.footer.push({
        tag: 'script',
        props: {
            src: `${res.baseScriptsURL}/client/assets/auth.js`,
        },
    });
    next();
}

authRouter.get('/client/login', (req, res, next) => {
    if (req.isAuthenticated()) {
        res.redirect('/client');
    } else {
        routeHandler(routes, req, res, next);
    }
});

authRouter.get('/client/logout', (req, res) => {
    req.logout();
    res.redirect('/client/login');
});

authRouter.get(/^\/client\/(register|forgotPwd)$/, (req, res, next) => {
    routeHandler(routes, req, res, next);
});

// Register | ForgotPwd
authRouter.get(/^\/client\/(register|forgotPwd)$/, injectScript, async (req, res, next) => {
    res.status(200).send(getMarkup(req, res));
});

// Login
authRouter.get('/client/login', injectScript, (req, res) => {
    if (req.isAuthenticated()) {
        res.redirect('/client');
    } else {
        res.status(200).send(getMarkup(req, res));
    }
});

export default authRouter;

```

* PDShop_Client_PC/project/App/server/routers/client.js

```js
import getBaseComponent from 'helpers/get-base-component';
import getDefaultFavicon from 'helpers/default-favicon';
import renderHtml from 'helpers/render-html';
import routeHandler from 'helpers/route-handler';
import routes from 'routers/client';
import { Router } from 'express';
import { graphql } from 'graphql';
import { getDataDependencies } from 'relatejs';

import schema from '../schema';

const clientRouter = new Router();

clientRouter.get(/^\/client\/.+/, (req, res, next) => {
    if (req.isAuthenticated()) {
        res.redirect('/client');
    } else {
        next();
    }
});

clientRouter.get('/client*', (req, res, next) => {
    if (req.isAuthenticated()) {
        if (process.env.NODE_ENV === 'production') {
            res.locals.header.push(getDefaultFavicon(res));
            res.locals.header.push({
                tag: 'link',
                props: {
                    rel: 'stylesheet',
                    type: 'text/css',
                    href: '/client/assets/client.css',
                },
            });
            // res.locals.header.push({
            //     tag: 'link',
            //     props: {
            //         rel: 'stylesheet',
            //         type: 'text/css',
            //         href: '/client/assets/common.js.css',
            //     },
            // });
        }
        res.locals.footer.push({
            tag: 'script',
            props: {
                src: `${res.baseScriptsURL}/client/assets/client.js`,
            },
        });
        next();
    } else {
        res.redirect('/client/login');
    }
});

clientRouter.get('/client*', (req, res, next) => {
    if (req.isAuthenticated()) {
        routeHandler(routes, req, res, next);
    } else {
        next();
    }
});

clientRouter.get('/client*', async (req, res, next) => {
    if (req.isAuthenticated() && req.routerState) {
        // get component with redux provider and react router
        const component = getBaseComponent(req);
        // get relate js data dependencies
        await getDataDependencies(component, async (request) => await graphql(
            schema.getSchema(),
            request.query,
            {
                isAuthenticated: true,
                user: req.user,
            },
            request.variables
        ));

        // final render html
        res.status(200).send(renderHtml({
            component,
            store: req.store,
            locals: res.locals,
        }));
    } else {
        next();
    }
});

export default clientRouter;

```

* PDShop_Client_PC/project/App/server/routers/index.js

```js
import clientRouter from './client';
import authRouter from './auth';
import publicRouter from './public';

export default {
    clientRouter,
    authRouter,
    publicRouter,
};

```

* PDShop_Client_PC/project/App/server/routers/public.js

```js
import { Router } from 'express';
import request from 'request';
import { urls } from 'helpers/api';

const publicRouter = new Router();

publicRouter.post('/api/uploadFile', (req, res) => {
    req.pipe(request(urls.uploadFile)).pipe(res);
});

export default publicRouter;

```

* PDShop_Client_PC/project/App/shared/actions/accounts.js

```js
import { apiQuery } from 'relatejs';

export function weixinPayGetUnifiedOrder (data, callback) {
    return () => {
        return apiQuery({
            fragments: {
                weixinPayGetUnifiedOrder: { success: 1, msg: 1, context: { qrcode: 1 } },
            },
            variables: {
                weixinPayGetUnifiedOrder: {
                    data: {
                        value: data,
                        type: 'accountInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.weixinPayGetUnifiedOrder);
        })();
    };
}
export function weixinPayWithDraw (data, callback) {
    return () => {
        return apiQuery({
            fragments: {
                weixinPayWithDraw: { success: 1, msg: 1, context: { qrcode: 1 } },
            },
            variables: {
                weixinPayWithDraw: {
                    data: {
                        value: data,
                        type: 'accountInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.weixinPayWithDraw);
        })();
    };
}

```

* PDShop_Client_PC/project/App/shared/actions/agentOrders.js

```js
import { mutation } from 'relatejs';

export function placeClientOrder (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                placeClientOrder: { success: 1, msg: 1, context },
            },
            variables: {
                placeClientOrder: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.placeClientOrder);
        })(dispatch, getState);
    };
}
export function placeClientOrderWithPreOrder (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                placeClientOrderWithPreOrder: { success: 1, msg: 1, context },
            },
            variables: {
                placeClientOrderWithPreOrder: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.placeClientOrderWithPreOrder);
        })(dispatch, getState);
    };
}
export function modifyClientOrder (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyClientOrder: { success: 1, msg: 1, context },
            },
            variables: {
                modifyClientOrder: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyClientOrder);
        })(dispatch, getState);
    };
}
export function removeClientOrder (orderId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeClientOrder: { success: 1, msg: 1 },
            },
            variables: {
                removeClientOrder: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeClientOrder);
        })(dispatch, getState);
    };
}
export function confirmCachPayed (orderId, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                confirmCachPayed: { success: 1, msg: 1, context },
            },
            variables: {
                confirmCachPayed: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.confirmCachPayed);
        })(dispatch, getState);
    };
}
export function confirmCachPayedForOrderList (orderIdList, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                confirmCachPayedForOrderList: { success: 1, msg: 1 },
            },
            variables: {
                confirmCachPayedForOrderList: {
                    orderIdList: {
                        value: orderIdList,
                        type: '[ID]!',
                    },
                },
            },
        }, (result) => {
            callback(result.confirmCachPayedForOrderList);
        })(dispatch, getState);
    };
}
export function printOrderBill (orderId, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                printOrderBill: { success: 1, msg: 1, context },
            },
            variables: {
                printOrderBill: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.printOrderBill);
        })(dispatch, getState);
    };
}
export function printOrderListBill (orderIdList, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                printOrderListBill: { success: 1, msg: 1 },
            },
            variables: {
                printOrderListBill: {
                    orderIdList: {
                        value: orderIdList,
                        type: '[ID]!',
                    },
                },
            },
        }, (result) => {
            callback(result.printOrderListBill);
        })(dispatch, getState);
    };
}
export function printBarCode (orderId, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                printBarCode: { success: 1, msg: 1, context },
            },
            variables: {
                printBarCode: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.printBarCode);
        })(dispatch, getState);
    };
}

```

* PDShop_Client_PC/project/App/shared/actions/clients.js

```js
import { apiQuery } from 'relatejs';

export function getClientNameByPhone (phone, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getClientNameByPhone: { success: 1, msg: 1, context: { name: 1 } },
            },
            variables: {
                getClientNameByPhone: {
                    phone: {
                        value: phone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getClientNameByPhone);
        })();
    };
}

```

* PDShop_Client_PC/project/App/shared/actions/members.js

```js
import { mutation, apiQuery } from 'relatejs';

export function modifyShipperMemberAuthority (memberId, authority, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyShipperMemberAuthority: { success: 1, msg: 1, context },
            },
            variables: {
                modifyShipperMemberAuthority: {
                    memberId: {
                        value: memberId,
                        type: 'ID!',
                    },
                    authority: {
                        value: authority,
                        type: '[Int]!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyShipperMemberAuthority);
        })(dispatch, getState);
    };
}

export function getShipperMemberByPhone (memberPhone, context, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getShipperMemberByPhone: { success: 1, msg: 1, context },
            },
            variables: {
                getShipperMemberByPhone: {
                    memberPhone: {
                        value: memberPhone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getShipperMemberByPhone);
        })();
    };
}

// 收货点
export function modifyAgentMemberAuthority (memberId, authority, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyAgentMemberAuthority: { success: 1, msg: 1, context },
            },
            variables: {
                modifyAgentMemberAuthority: {
                    memberId: {
                        value: memberId,
                        type: 'ID!',
                    },
                    authority: {
                        value: authority,
                        type: '[Int]!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyAgentMemberAuthority);
        })(dispatch, getState);
    };
}

export function getAgentMemberByPhone (memberPhone, context, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getAgentMemberByPhone: { success: 1, msg: 1, context },
            },
            variables: {
                getAgentMemberByPhone: {
                    memberPhone: {
                        value: memberPhone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getAgentMemberByPhone);
        })();
    };
}

```

* PDShop_Client_PC/project/App/shared/actions/orders.js

```js
import { mutation } from 'relatejs';

export function placePreOrder (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                placePreOrder: { success: 1, msg: 1, context },
            },
            variables: {
                placePreOrder: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.placePreOrder);
        })(dispatch, getState);
    };
}

export function modifyPreOrder (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyPreOrder: { success: 1, msg: 1, context },
            },
            variables: {
                modifyPreOrder: {
                    data: {
                        value: data,
                        type: 'orderInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyPreOrder);
        })(dispatch, getState);
    };
}
export function removePreOrder (orderId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removePreOrder: { success: 1, msg: 1 },
            },
            variables: {
                removePreOrder: {
                    orderId: {
                        value: orderId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removePreOrder);
        })(dispatch, getState);
    };
}
export function createPreOrderGroup (data, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                createPreOrderGroup: { success: 1, msg: 1 },
            },
            variables: {
                createPreOrderGroup: {
                    data: {
                        value: data,
                        type: 'orderGroupInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.createPreOrderGroup);
        })(dispatch, getState);
    };
}
export function modifyPreOrderGroup (data, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyPreOrderGroup: { success: 1, msg: 1 },
            },
            variables: {
                modifyPreOrderGroup: {
                    data: {
                        value: data,
                        type: 'orderGroupInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyPreOrderGroup);
        })(dispatch, getState);
    };
}
export function removePreOrderFromGroup (orderIdList, orderGroupId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removePreOrderFromGroup: { success: 1, msg: 1 },
            },
            variables: {
                removePreOrderFromGroup: {
                    orderIdList: {
                        value: orderIdList,
                        type: '[ID]!',
                    },
                    orderGroupId: {
                        value: orderGroupId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removePreOrderFromGroup);
        })(dispatch, getState);
    };
}

export function payForOrderWhenSend (orderIdList, payPassword, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                payForOrderWhenSend: { success: 1, msg: 1 },
            },
            variables: {
                payForOrderWhenSend: {
                    orderIdList: {
                        value: orderIdList,
                        type: '[ID]!',
                    },
                    payPassword: {
                        value: payPassword,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.payForOrderWhenSend);
        })(dispatch, getState);
    };
}

```

* PDShop_Client_PC/project/App/shared/actions/personals.js

```js
import { apiQuery, apiMutation, mutation } from 'relatejs';

export function getVerifyCode (phone, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getVerifyCode: { success: 1, msg: 1 },
            },
            variables: {
                getVerifyCode: {
                    phone: {
                        value: phone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getVerifyCode);
        })();
    };
}
export function register (data, callback) {
    return () => {
        return apiMutation({
            fragments: {
                register: { success: 1, msg: 1 },
            },
            variables: {
                register: {
                    data: {
                        value: data,
                        type: 'personalInfoInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.register);
        })();
    };
}
export function login (phone, password, callback) {
    return () => {
        return apiQuery({
            fragments: {
                login: { success: 1, msg: 1 },
            },
            variables: {
                login: {
                    phone: {
                        value: phone,
                        type: 'String!',
                    },
                    password: {
                        value: password,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.login);
        })();
    };
}
export function forgotPwd (data, callback) {
    return () => {
        return apiMutation({
            fragments: {
                forgotPwd: { success: 1, msg: 1 },
            },
            variables: {
                forgotPwd: {
                    data: {
                        value: data,
                        type: 'personalInfoInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.forgotPwd);
        })();
    };
}
export function setPaymentPassword (data, callback) {
    return () => {
        return apiMutation({
            fragments: {
                setPaymentPassword: { success: 1, msg: 1 },
            },
            variables: {
                setPaymentPassword: {
                    data: {
                        value: data,
                        type: 'personalInfoInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.setPaymentPassword);
        })();
    };
}
export function feedback (content, email, callback) {
    return () => {
        return apiMutation({
            fragments: {
                feedback: { success: 1, msg: 1 },
            },
            variables: {
                feedback: {
                    content: {
                        value: content,
                        type: 'String!',
                    },
                    email: {
                        value: email,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.feedback);
        })();
    };
}
export function modifyPersonalInfo (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyPersonalInfo: { success: 1, msg: 1, context },
            },
            variables: {
                modifyPersonalInfo: {
                    data: {
                        value: data,
                        type: 'personalInfoInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyPersonalInfo);
        })(dispatch, getState);
    };
}
export function modifyShipperInfo (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyShipperInfo: { success: 1, msg: 1, context },
            },
            variables: {
                modifyShipperInfo: {
                    data: {
                        value: data,
                        type: 'shipperInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyShipperInfo);
        })(dispatch, getState);
    };
}
export function modifyAgentInfo (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyAgentInfo: { success: 1, msg: 1, context },
            },
            variables: {
                modifyAgentInfo: {
                    data: {
                        value: data,
                        type: 'agentInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyAgentInfo);
        })(dispatch, getState);
    };
}
export function getUserNameByPhone (phone, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getUserNameByPhone: { success: 1, msg: 1, context: { name: 1 } },
            },
            variables: {
                getUserNameByPhone: {
                    phone: {
                        value: phone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getUserNameByPhone);
        })();
    };
}

export function setReferShop (shopId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setReferShop: { success: 1, msg: 1 },
            },
            variables: {
                setReferShop: {
                    shopId: {
                        value: shopId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.setReferShop);
        })(dispatch, getState);
    };
}

```

* PDShop_Client_PC/project/App/shared/actions/roadmaps.js

```js
import { mutation } from 'relatejs';

export function publishRoadmap (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                publishRoadmap: { success: 1, msg: 1, context },
            },
            variables: {
                publishRoadmap: {
                    data: {
                        value: data,
                        type: 'roadmapInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.publishRoadmap);
        })(dispatch, getState);
    };
}
export function modifyRoadmap (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyRoadmap: { success: 1, msg: 1, context },
            },
            variables: {
                modifyRoadmap: {
                    data: {
                        value: data,
                        type: 'roadmapInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyRoadmap);
        })(dispatch, getState);
    };
}
export function removeRoadmap (roadmapId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeRoadmap: { success: 1, msg: 1 },
            },
            variables: {
                removeRoadmap: {
                    roadmapId: {
                        value: roadmapId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeRoadmap);
        })(dispatch, getState);
    };
}
export function setRoadmapPrice (data, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setRoadmapPrice: { success: 1, msg: 1 },
            },
            variables: {
                setRoadmapPrice: {
                    data: {
                        value: data,
                        type: 'setRoadmapPriceType!',
                    },
                },
            },
        }, (result) => {
            callback(result.setRoadmapPrice);
        })(dispatch, getState);
    };
}
export function setRoadmapSendDoorPrice (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setRoadmapSendDoorPrice: { success: 1, msg: 1, context },
            },
            variables: {
                setRoadmapSendDoorPrice: {
                    data: {
                        value: data,
                        type: 'setRoadmapSendDoorPriceType!',
                    },
                },
            },
        }, (result) => {
            callback(result.setRoadmapSendDoorPrice);
        })(dispatch, getState);
    };
}
export function setRoadmapSendDoorBasePrice (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setRoadmapSendDoorBasePrice: { success: 1, msg: 1, context },
            },
            variables: {
                setRoadmapSendDoorBasePrice: {
                    data: {
                        value: data,
                        type: 'setRoadmapSendDoorPriceType!',
                    },
                },
            },
        }, (result) => {
            callback(result.setRoadmapSendDoorBasePrice);
        })(dispatch, getState);
    };
}
export function setRoadmapEnable (roadmapIdList, enable, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setRoadmapEnable: { success: 1, msg: 1 },
            },
            variables: {
                setRoadmapEnable: {
                    roadmapIdList: {
                        value: roadmapIdList,
                        type: '[ID]!',
                    },
                    enable: {
                        value: enable,
                        type: 'Boolean!',
                    },
                },
            },
        }, (result) => {
            callback(result.setRoadmapEnable);
        })(dispatch, getState);
    };
}
export function setRoadmapSendDoorEnable (roadmapId, lastCodeList, enable, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setRoadmapSendDoorEnable: { success: 1, msg: 1 },
            },
            variables: {
                setRoadmapSendDoorEnable: {
                    roadmapId: {
                        value: roadmapId,
                        type: 'ID!',
                    },
                    lastCodeList: {
                        value: lastCodeList,
                        type: '[Int]!',
                    },
                    enable: {
                        value: enable,
                        type: 'Boolean!',
                    },
                },
            },
        }, (result) => {
            callback(result.setRoadmapSendDoorEnable);
        })(dispatch, getState);
    };
}

export function addRegionProfit (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                addRegionProfit: { success: 1, msg: 1, context },
            },
            variables: {
                addRegionProfit: {
                    data: {
                        value: data,
                        type: 'regionRateInputType',
                    },
                },
            },
        }, (result) => {
            callback(result.addRegionProfit);
        })(dispatch, getState);
    };
}

export function modifyRegionProfit (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyRegionProfit: { success: 1, msg: 1, context },
            },
            variables: {
                modifyRegionProfit: {
                    data: {
                        value: data,
                        type: 'regionRateInputType',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyRegionProfit);
        })(dispatch, getState);
    };
}

export function removeRegionProfit (regionId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeRegionProfit: { success: 1, msg: 1 },
            },
            variables: {
                removeRegionProfit: {
                    regionId: {
                        value: regionId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeRegionProfit);
        })(dispatch, getState);
    };
}

export function setRegionProfitWithList (data, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setRegionProfitWithList: { success: 1, msg: 1 },
            },
            variables: {
                setRegionProfitWithList: {
                    regionIdList: {
                        value: data.regionIdList,
                        type: '[ID]!',
                    },
                    profitRate: {
                        value: data.profitRate,
                        type: 'Float',
                    },
                    profitCount: {
                        value: data.profitCount,
                        type: 'Float',
                    },
                },
            },
        }, (result) => {
            callback(result.setRegionProfitWithList);
        })(dispatch, getState);
    };
}


```

* PDShop_Client_PC/project/App/shared/actions/trucks.js

```js
import { mutation, apiQuery, apiMutation } from 'relatejs';

export function createTruck (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                createTruck: { success: 1, msg: 1, context },
            },
            variables: {
                createTruck: {
                    data: {
                        value: data,
                        type: 'truckInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.createTruck);
        })(dispatch, getState);
    };
}
export function modifyTruck (data, context, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                modifyTruck: { success: 1, msg: 1, context },
            },
            variables: {
                modifyTruck: {
                    data: {
                        value: data,
                        type: 'truckInputType!',
                    },
                },
            },
        }, (result) => {
            callback(result.modifyTruck);
        })(dispatch, getState);
    };
}
export function removeTruck (truckId, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                removeTruck: { success: 1, msg: 1 },
            },
            variables: {
                removeTruck: {
                    truckId: {
                        value: truckId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.removeTruck);
        })(dispatch, getState);
    };
}
export function getDriverNameByPhone (phone, callback) {
    return () => {
        return apiQuery({
            fragments: {
                getDriverNameByPhone: { id: 1, name: 1, phone: 1 },
            },
            variables: {
                getDriverNameByPhone: {
                    phone: {
                        value: phone,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.getDriverNameByPhone);
        })();
    };
}
export function selectCarryPartment (truckId, carryPartmentId, callback) {
    return () => {
        return apiMutation({
            fragments: {
                selectCarryPartment: { success: 1, msg: 1 },
            },
            variables: {
                selectCarryPartment: {
                    truckId: {
                        value: truckId,
                        type: 'ID!',
                    },
                    carryPartmentId: {
                        value: carryPartmentId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.selectCarryPartment);
        })();
    };
}
export function payforCarryPartment (truckId, callback) {
    return () => {
        return apiMutation({
            fragments: {
                payforCarryPartment: { success: 1, msg: 1 },
            },
            variables: {
                payforCarryPartment: {
                    truckId: {
                        value: truckId,
                        type: 'ID!',
                    },
                },
            },
        }, (result) => {
            callback(result.payforCarryPartment);
        })();
    };
}
export function setCityTruck (data, callback) {
    return (dispatch, getState) => {
        return mutation({
            fragments: {
                setCityTruck: { success: 1, msg: 1 },
            },
            variables: {
                setCityTruck: {
                    plateNo: {
                        value: data,
                        type: 'String!',
                    },
                },
            },
        }, (result) => {
            callback(result.setCityTruck);
        })(dispatch, getState);
    };
}

```

* PDShop_Client_PC/project/App/shared/config/menu.js

```js
import AH from '../constants/authority';

export default [
    {
        label: '下单',
        link: '/client/placeOrder',
        auth: [AH.AH_PLACE_ORDER],
    },
    {
        label: '货单列表',
        link: '/client/rcorders',
        auth: [AH.AH_PLACE_ORDER],
    },
    {
        label: '路线设置',
        link: '/client/roadmaps',
        auth: [AH.AH_LOOK_ROADMAP, AH.AH_CREATE_ROADMAP, AH.AH_MODIFY_ROADMAP, AH.AH_REMOVE_ROADMAP],
    },
    {
        label: '路线设置',
        link: '/client/sendDoorRoadmaps',
        auth: [AH.AH_LOOK_SEND_DOOR_ROADMAP, AH.AH_CREATE_SEND_DOOR_ROADMAP, AH.AH_MODIFY_SEND_DOOR_ROADMAP, AH.AH_REMOVE_SEND_DOOR_ROADMAP],
    },
    {
        label: '竞得货物',
        link: '/client/needSendOrders',
        auth: [AH.AH_LOOK_TRUCK, AH.AH_CREATE_TRUCK, AH.AH_MODIFY_TRUCK, AH.AH_REMOVE_TRUCK],
    },
    {
        label: '我的货车',
        link: '/client/trucks',
        auth: [AH.AH_LOOK_TRUCK, AH.AH_CREATE_TRUCK, AH.AH_MODIFY_TRUCK, AH.AH_REMOVE_TRUCK],
    },
    {
        label: '方向提成',
        link: '/client/regionRates',
        auth: [AH.AH_MODIFY_ROADMAP_PROFIT],
    },
    {
        label: '货单',
        link: '/client/sporders',
        auth: [AH.AH_LOOK_ORDERS],
    },
    {
        label: '业务统计',
        link: '/client/statistics',
        auth: [AH.AH_LOOK_STATISTICS],
    },
    {
        label: '我要发货',
        link: '/client/preOrders',
    },
    {
        label: '查看行情',
        link: '/client/quotations',
    },
    {
        label: '发货货单',
        link: '/client/sendOrders',
    },
    {
        label: '收货货单',
        link: '/client/receiveOrders',
    },
];

```

* PDShop_Client_PC/project/App/shared/config/topmenu.js

```js
import AH from '../constants/authority';

export default [
    {
        label: '人员管理',
        link: '/client/shipperMembers',
        auth: [AH.AH_MODIFY_SHIPPER_MEMBER_AUTHORITY],
    },
    {
        label: '人员管理',
        link: '/client/agentMembers',
        auth: [AH.AH_MODIFY_AGENT_MEMBER_AUTHORITY],
    },
    {
        label: '个人中心',
        link: '/client/personal',
    },
    {
        label: '意见反馈',
        link: '/client/feedback',
    },
    {
        label: '退出',
        link: '/client/logout',
    },
];

```

* PDShop_Client_PC/project/App/shared/decorators/antd_form_create.js

```js
import { Form } from 'antd';
export default (target) => {
    const Component = Form.create()(target);
    Component.fragments = target.fragments;
    return Component;
};

```

* PDShop_Client_PC/project/App/shared/constants/authority.js

```js
// 注意：常量部分必须和服务器保持一致
// 总部权限
const AH_CREATE_BRANCH_SHOP = 0; // 创建分店的权限
const AH_MODIFY_BRANCH_SHOP = 1; // 修改分店信息的权限
const AH_REMOVE_BRANCH_SHOP = 2; // 删除分店的权限
const AH_LOOK_BRANCH_SHOP = 3; // 查看分店列表的权限
const AH_MODIFY_SETTING = 4; // 修改设置的权限
const AH_CREATE_AGENT = 5; // 创建收货点的权限
const AH_MODIFY_AGENT = 6; // 修改收货点的权限
const AH_REMOVE_AGENT = 7; // 删除收货点的权限
const AH_LOOK_AGENT = 8; // 查看收货点的权限

// 公共权限
const AH_MODIFY_OWN_SHOP = 10000; // 修改所在物流超市信息的权限
const AH_CREATE_MEMBER = 10001; // 创建成员的权限
const AH_MODIFY_MEMBER = 10002; // 修改成员信息的权限
const AH_REMOVE_MEMBER = 10003; // 删除成员的权限
const AH_LOOK_MEMBER = 10004; // 查看成员的权限
const AH_RECHARGE = 10005; // 充值的权限
const AH_WITHDRAW = 10006; // 提现的权限
const AH_LOOK_AMOUNT = 10007; // 查看余额的权限
const AH_MODIFY_ROADMAP_PROFIT = 10008; // 修改路线的提成
const AH_LOOK_STATISTICS = 10009; // 查看统计信息的权限
const AH_LOOK_ORDERS = 10010; // 查看综合货单的权限

// 分店权限
const AH_CREATE_SHIPPER = 20000; // 创建物流公司的权限
const AH_MODIFY_SHIPPER = 20001; // 修改物流公司的权限
const AH_REMOVE_SHIPPER = 20002; // 删除物流公司的权限
const AH_LOOK_SHIPPER = 20003; // 查看物流公司的权限
const AH_CREATE_PARTMENT = 20004; // 创建部门的权限
const AH_MODIFY_PARTMENT = 20005; // 修改部门信息的权限
const AH_REMOVE_PARTMENT = 20006; // 删除部门的权限
const AH_LOOK_PARTMENT = 20007; // 查看部门的权限
const AH_MODIFY_OWN_PARTMENT = 20008; // 修改所在部门信息的权限
const AH_RECEIVE_PARTMENT = 20009; // 收货的权限（收货部人员）
const AH_WARE_HOUSE_PARTMENT = 20010; // 库管的权限（库管部人员）
const AH_CARRY_PARTMENT = 20011; // 搬货的权限（搬运部人员）
const AH_SECURITY_CHECK_PARTMENT = 20012; // 安检的权限（保安部人员）
const AH_DISTRIBUTION_PARTMENT = 20013; // 配送的权限（配送部人员）
const AH_TO_EXAMINE_TRUCK = 20014; // 审核货车的权限

// 物流公司
const AH_MODIFY_SHIPPER_INFO = 30000; // 修改物流公司信息的权限
const AH_MODIFY_SHIPPER_MEMBER_AUTHORITY = 30001; // 修改物流公司成员权限的权限
const AH_CREATE_ROADMAP = 30002; // 创建路线的权限
const AH_MODIFY_ROADMAP = 30003; // 修改路线的权限
const AH_REMOVE_ROADMAP = 30004; // 删除路线的权限
const AH_LOOK_ROADMAP = 30005; // 查看路线的权限 (分店共享该权限)
const AH_CREATE_SEND_DOOR_ROADMAP = 30006; // 创建同城配送路线的权限
const AH_MODIFY_SEND_DOOR_ROADMAP = 30007; // 修改同城配送路线的权限
const AH_REMOVE_SEND_DOOR_ROADMAP = 30008; // 删除同城配送路线的权限
const AH_LOOK_SEND_DOOR_ROADMAP = 30009; // 查看同城配送路线的权限 (分店共享该权限)
const AH_CREATE_TRUCK = 30010; // 创建货车的权限
const AH_MODIFY_TRUCK = 30011; // 修改货车的权限
const AH_REMOVE_TRUCK = 30012; // 删除货车的权限
const AH_LOOK_TRUCK = 30013; // 查看货车的权限
const SELECT_CARRY_PARTMENT = 30014; // 选择搬运队的权限
const AH_SCAN_LOAD_TRUCK = 30015; // 扫描装车的权限
export const AH_CITY_DISTRIBUTE = 30016; // 同城配送的权限

// 收货点
const AH_MODIFY_AGENT_INFO = 40000; // 修改收货点信息的权限
const AH_MODIFY_AGENT_MEMBER_AUTHORITY = 40001; // 修改收货点成员权限的权限
const AH_PLACE_ORDER = 40002; // 收货点下单的权限

export default {
    // 总部权限
    AH_CREATE_BRANCH_SHOP,
    AH_MODIFY_BRANCH_SHOP,
    AH_REMOVE_BRANCH_SHOP,
    AH_LOOK_BRANCH_SHOP,
    AH_MODIFY_SETTING,
    AH_CREATE_AGENT,
    AH_MODIFY_AGENT,
    AH_REMOVE_AGENT,
    AH_LOOK_AGENT,

    // 公共权限
    AH_MODIFY_OWN_SHOP,
    AH_CREATE_MEMBER,
    AH_MODIFY_MEMBER,
    AH_REMOVE_MEMBER,
    AH_LOOK_MEMBER,
    AH_RECHARGE,
    AH_WITHDRAW,
    AH_LOOK_AMOUNT,
    AH_MODIFY_ROADMAP_PROFIT,
    AH_LOOK_STATISTICS,
    AH_LOOK_ORDERS,

    // 分店权限
    AH_CREATE_SHIPPER,
    AH_MODIFY_SHIPPER,
    AH_REMOVE_SHIPPER,
    AH_LOOK_SHIPPER,
    AH_CREATE_PARTMENT,
    AH_MODIFY_PARTMENT,
    AH_REMOVE_PARTMENT,
    AH_LOOK_PARTMENT,
    AH_MODIFY_OWN_PARTMENT,
    AH_RECEIVE_PARTMENT,
    AH_WARE_HOUSE_PARTMENT,
    AH_CARRY_PARTMENT,
    AH_SECURITY_CHECK_PARTMENT,
    AH_DISTRIBUTION_PARTMENT,
    AH_TO_EXAMINE_TRUCK,

    // 物流公司
    AH_MODIFY_SHIPPER_INFO,
    AH_MODIFY_SHIPPER_MEMBER_AUTHORITY,
    AH_CREATE_ROADMAP,
    AH_MODIFY_ROADMAP,
    AH_REMOVE_ROADMAP,
    AH_LOOK_ROADMAP,
    AH_CREATE_SEND_DOOR_ROADMAP,
    AH_MODIFY_SEND_DOOR_ROADMAP,
    AH_REMOVE_SEND_DOOR_ROADMAP,
    AH_LOOK_SEND_DOOR_ROADMAP,
    AH_CREATE_TRUCK,
    AH_MODIFY_TRUCK,
    AH_REMOVE_TRUCK,
    AH_LOOK_TRUCK,
    SELECT_CARRY_PARTMENT,
    AH_SCAN_LOAD_TRUCK,
    AH_CITY_DISTRIBUTE,

    // 收货点
    AH_MODIFY_AGENT_INFO,
    AH_MODIFY_AGENT_MEMBER_AUTHORITY,
    AH_PLACE_ORDER,

    // mapper
    MAP: {
        // 总部权限
        [AH_CREATE_BRANCH_SHOP]: '创建分店的权限',
        [AH_MODIFY_BRANCH_SHOP]: '修改分店信息的权限',
        [AH_REMOVE_BRANCH_SHOP]: '删除分店的权限',
        [AH_LOOK_BRANCH_SHOP]: '查看分店的权限',
        [AH_MODIFY_SETTING]: '修改设置的权限',
        [AH_CREATE_AGENT]: '创建收货点的权限',
        [AH_MODIFY_AGENT]: '修改收货点的权限',
        [AH_REMOVE_AGENT]: '删除收货点的权限',
        [AH_LOOK_AGENT]: '查看收货点的权限',

        // 公共权限
        [AH_MODIFY_OWN_SHOP]: '修改自身店铺信息的权限',
        [AH_CREATE_MEMBER]: '创建成员的权限',
        [AH_MODIFY_MEMBER]: '修改成员信息的权限',
        [AH_REMOVE_MEMBER]: '删除成员的权限',
        [AH_LOOK_MEMBER]: '查看成员的权限',
        [AH_RECHARGE]: '充值的权限',
        [AH_WITHDRAW]: '提现的权限',
        [AH_LOOK_AMOUNT]: '查看余额的权限',
        [AH_MODIFY_ROADMAP_PROFIT]: '修改路线的提成的权限',
        [AH_LOOK_STATISTICS]: '查看统计信息的权限',
        [AH_LOOK_ORDERS]: '查看综合货单的权限',

        // 分店权限
        [AH_CREATE_SHIPPER]: '创建物流公司',
        [AH_MODIFY_SHIPPER]: '修改物流公司',
        [AH_REMOVE_SHIPPER]: '删除物流公司',
        [AH_LOOK_SHIPPER]: '查看物流公司',
        [AH_CREATE_PARTMENT]: '创建部门的权限',
        [AH_MODIFY_PARTMENT]: '修改部门信息的权限',
        [AH_REMOVE_PARTMENT]: '删除部门的权限',
        [AH_LOOK_PARTMENT]: '查看部门的权限',
        [AH_MODIFY_OWN_PARTMENT]: '修改所在部门信息的权限',
        [AH_RECEIVE_PARTMENT]: '收货的权限',
        [AH_WARE_HOUSE_PARTMENT]: '库管的权限',
        [AH_CARRY_PARTMENT]: '搬货的权限',
        [AH_SECURITY_CHECK_PARTMENT]: '安检的权限',
        [AH_DISTRIBUTION_PARTMENT]: '配送的权限',
        [AH_TO_EXAMINE_TRUCK]: '审核货车的权限',

        // 物流公司
        [AH_MODIFY_SHIPPER_INFO]: '修改物流公司信息的权限',
        [AH_MODIFY_SHIPPER_MEMBER_AUTHORITY]: '修改物流公司成员权限的权限',
        [AH_CREATE_ROADMAP]: '创建路线的权限',
        [AH_MODIFY_ROADMAP]: '修改路线的权限',
        [AH_REMOVE_ROADMAP]: '删除路线的权限',
        [AH_LOOK_ROADMAP]: '查看路线的权限',
        [AH_CREATE_SEND_DOOR_ROADMAP]: '创建同城配送路线的权限',
        [AH_MODIFY_SEND_DOOR_ROADMAP]: '修改同城配送路线的权限',
        [AH_REMOVE_SEND_DOOR_ROADMAP]: '删除同城配送路线的权限',
        [AH_LOOK_SEND_DOOR_ROADMAP]: '查看同城配送路线的权限',
        [AH_CREATE_TRUCK]: '创建货车的权限',
        [AH_MODIFY_TRUCK]: '修改货车的权限',
        [AH_REMOVE_TRUCK]: '删除货车的权限',
        [AH_LOOK_TRUCK]: '查看货车的权限',
        [SELECT_CARRY_PARTMENT]: '选择搬运队的权限',
        [AH_SCAN_LOAD_TRUCK]: '扫描装车的权限',
        [AH_CITY_DISTRIBUTE]: '同城配送的权限',

        // 收货点
        [AH_MODIFY_AGENT_INFO]: '修改收货点信息的权限',
        [AH_MODIFY_AGENT_MEMBER_AUTHORITY]: '修改收货点成员权限的权限',
        [AH_PLACE_ORDER]: '收货点下单的权限',
    },
};

```

* PDShop_Client_PC/project/App/shared/constants/common.js

```js
// 注意：常量部分必须和服务器保持一致

const ST_LONG = 0; // 长途物流公司
const ST_CITY = 1; // 同城配送物流公司

// 方向设置的类型
export const RRT_ALL = 0; // 所有
export const RRT_LONG = 1; // 长途
export const RRT_CITY = 2; // 同城配送

export default {
    ST_LONG,
    ST_CITY,

    RRT_ALL,
    RRT_LONG,
    RRT_CITY,

    // mapper
    SHIPPER_TYPE_MAP: {
        [ST_LONG]: '长途运输',
        [ST_CITY]: ' 同城配送',
    },
    RRT_MAP: {
        [RRT_ALL]: '长途 & 同城',
        [RRT_LONG]: ' 长途运输',
        [RRT_CITY]: ' 同城配送',
    },
};

```

* PDShop_Client_PC/project/App/shared/constants/index.js

```js
export AH from './authority';
export OS from './orderState';
export TS from './truckState';
export CO from './common';

```

* PDShop_Client_PC/project/App/shared/constants/orderState.js

```js
// 注意：常量部分必须和服务器保持一致
// 订单的状态
/*
===========
长途运输状态图:
(0->)1->2->5    |
                |->6->7->8(->11)->14->15
(0->)1->3->4->5 |
===========
收货点状态图:
0->2->9    |
           |(->10)->11->14->15
0->3->4->9 |
===========
同城配送状态图: (当同城配送的在运输中，那么它之前的货单就在待交货状态)
(0->)1->2    |
             |->6->8->15
(0->)1->3->4 |
===========
上门自提状态图:(当上门自提的在运输中或者等待上门自提，那么它之前的货单就在待交货状态)
      |->13->15
1->12 |
      |->6->8->15
*/
const OS_PREORDER = -1; // 预下单状态，需要将货拉到分店后不显示（件数，重量，方量），由收货员填写确认后进入待选线路状态
const OS_READY_PRINT_BAR_CODE = 0; // 待打印二维码
const OS_READY_SELECT_ROADMAP = 1; // 待选物流公司
const OS_READY_DEDUCT_AND_PRINT_ORDER = 2; // 待扣款并打印打印货单（用来区别需要付款的情况）
const OS_READY_PAYMENT = 3; // 待付款
const OS_READY_PRINT_ORDER = 4; // 待打印货单
const OS_READY_STOCK = 5; // 待入库
const OS_READY_LOAD = 6; // 待装车
const OS_READY_START_OFF = 7; // 待出发
const OS_ON_THE_WAY = 8; // 运输中
const OS_READY_SEND = 9; // 待发货 (收货点专用)
const OS_ON_SENDING = 10; // 发货中 (收货点专用)
const OS_ON_TRANSFER = 11; // 中转中
const OS_READY_PHONE_CONFIRM = 12; // 待打电话确认
const OS_WAIT_CLIENT_PICK = 13; // 等待上门自提
const OS_READY_RECEIVE = 14; // 待交货
const OS_RECEIVE_SUCCESS = 15; // 交货成功

export default {
    OS_PREORDER,
    OS_READY_PRINT_BAR_CODE,
    OS_READY_SELECT_ROADMAP,
    OS_READY_DEDUCT_AND_PRINT_ORDER,
    OS_READY_PAYMENT,
    OS_READY_PRINT_ORDER,
    OS_READY_STOCK,
    OS_READY_LOAD,
    OS_READY_START_OFF,
    OS_ON_THE_WAY,
    OS_READY_SEND,
    OS_ON_SENDING,
    OS_ON_TRANSFER,
    OS_READY_PHONE_CONFIRM,
    OS_WAIT_CLIENT_PICK,
    OS_READY_RECEIVE,
    OS_RECEIVE_SUCCESS,

    // mapper
    MAP: {
        [OS_PREORDER]: '预下单状态',
        [OS_READY_PRINT_BAR_CODE]: '待打印二维码',
        [OS_READY_SELECT_ROADMAP]: '待选线路',
        [OS_READY_DEDUCT_AND_PRINT_ORDER]: '待打印收据',
        [OS_READY_PAYMENT]: '待付款',
        [OS_READY_PRINT_ORDER]: '待打印收据',
        [OS_READY_STOCK]: '待入库',
        [OS_READY_LOAD]: '待装车',
        [OS_READY_START_OFF]: '待出发',
        [OS_ON_THE_WAY]: '运输中',
        [OS_READY_SEND]: '待发货',
        [OS_ON_SENDING]: '发货中',
        [OS_ON_TRANSFER]: '运输中',
        [OS_READY_PHONE_CONFIRM]: '待打电话确认',
        [OS_WAIT_CLIENT_PICK]: '等待上门自提',
        [OS_READY_RECEIVE]: '待交货',
        [OS_RECEIVE_SUCCESS]: '交货成功',
    },
};

```

* PDShop_Client_PC/project/App/shared/constants/truckState.js

```js
// 注意：常量部分必须和服务器保持一致

const TS_READY_EXAMINE = 0; // 待审核
const TS_READY_ENTER_WAREHOUSE = 1; // 待入库
const TS_READY_SEARCH_CARRY_PARTMENT = 2; // 待找搬运队
const TS_READY_SCAN_LOAD = 3; // 待扫描装车
const TS_SCAN_LOADING = 4; // 装车中
const TS_READY_PAY_FOR_CARRY_PARTMENT = 5; // 待付搬运部的款
const TS_READY_EXIT_WAREHOUSE = 6; // 待出库
const TS_ON_THE_WAY = 7; // 运输中
const TS_RECEIVE_SUCCESS = 8; // 交货成功

export default {
    TS_READY_EXAMINE,
    TS_READY_ENTER_WAREHOUSE,
    TS_READY_SEARCH_CARRY_PARTMENT,
    TS_READY_SCAN_LOAD,
    TS_SCAN_LOADING,
    TS_READY_PAY_FOR_CARRY_PARTMENT,
    TS_READY_EXIT_WAREHOUSE,
    TS_ON_THE_WAY,
    TS_RECEIVE_SUCCESS,

    // mapper
    MAP: {
        [TS_READY_EXAMINE]: '待审核',
        [TS_READY_ENTER_WAREHOUSE]: '待入库',
        [TS_READY_SEARCH_CARRY_PARTMENT]: '待找搬运队',
        [TS_READY_SCAN_LOAD]: '待扫描装车',
        [TS_SCAN_LOADING]: '装车中',
        [TS_READY_PAY_FOR_CARRY_PARTMENT]: '待付搬运部的款',
        [TS_READY_EXIT_WAREHOUSE]: '待出库',
        [TS_ON_THE_WAY]: '运输中',
        [TS_RECEIVE_SUCCESS]: '交货成功',
    },
};

```

* PDShop_Client_PC/project/App/shared/helpers/configure-store.js

```js
import combineActionsMiddleware from 'redux-combine-actions';
import createLogger from 'redux-logger';
import reducer from 'reducers';
import thunkMiddleware from 'redux-thunk';
import { createStore, applyMiddleware, compose } from 'redux';

const middleware = [];

middleware.push(combineActionsMiddleware);
middleware.push(thunkMiddleware);

if (typeof window !== 'undefined' && module.hot) {
    middleware.push(createLogger());
}

export default function configureStore (routerMiddleware, initialState) {
    const store = compose(
    applyMiddleware(
      ...middleware
    ),
    routerMiddleware
  )(createStore)(reducer, initialState);

    if (module.hot) {
    // Enable Webpack hot module replacement for reducers
        module.hot.accept('../reducers', () => {
            const nextReducer = require('../reducers');
            store.replaceReducer(nextReducer);
        });
    }

    return store;
}

```

* PDShop_Client_PC/project/App/shared/helpers/ga-send.js

```js
export default function gaSend () {
    if (typeof window !== 'undefined') {
        window.ga && window.ga('send', 'pageview');
    }
}

```

* PDShop_Client_PC/project/App/shared/reducers/index.js

```js
import { combineReducers } from 'redux';
import { routerStateReducer as router } from 'redux-router';
import { relateReducer } from 'relatejs';

export const reducersToCombine = {
    relateReducer,
    router,
};
const rootReducer = combineReducers(reducersToCombine);

export default rootReducer;

```

* PDShop_Client_PC/project/App/shared/relatejs/index.js

```js
import { mergeFragments } from './helpers/fragments';

import actionTypes from './actions/types';
import capture from './helpers/capture';
import dataConnect from './decorators/data-connect';
import getDataDependencies from './server/get-data-dependencies';
import mutation from './actions/mutation';
import rootDataConnect from './decorators/root-data-connect';
import { setHeader, removeHeader, setEndpoint, setBody, removeBody } from './actions/settings';
import { relateReducer, relateReducerInit } from './reducer/reducer';
import { apiQuery, apiMutation } from './redirect-graphql';
import KeepData from './store/keep-data';
import GlobalData from './store/global-data';

export {
    dataConnect,
    rootDataConnect,
    relateReducer,
    relateReducerInit,
    actionTypes,
    mutation,
    mergeFragments,
    setHeader,
    removeHeader,
    setEndpoint,
    setBody,
    removeBody,
    getDataDependencies,
    capture,
    apiQuery,
    apiMutation,
    KeepData,
    GlobalData,
};

export default {
    dataConnect,
    rootDataConnect,
    relateReducer,
    relateReducerInit,
    actionTypes,
    mutation,
    mergeFragments,
    setHeader,
    removeHeader,
    setEndpoint,
    setBody,
    removeBody,
    getDataDependencies,
    capture,
    apiQuery,
    apiMutation,
    KeepData,
    GlobalData,
};

```

* PDShop_Client_PC/project/App/shared/routers/auth.js

```js
import React from 'react';
import { Route } from 'react-router';
import gaSend from 'helpers/ga-send';
import Auth from 'pages/auth';
import Register from 'pages/auth/pages/register';
import Login from 'pages/auth/pages/login';
import ForgotPwd from 'pages/auth/pages/forgotPwd';

export default [
    <Route component={Auth}>
        <Route path='/client/register' component={Register} onEnter={gaSend} />
        <Route path='/client/login' component={Login} onEnter={gaSend} />
        <Route path='/client/forgotPwd' component={ForgotPwd} onEnter={gaSend} />
    </Route>,
];

```

* PDShop_Client_PC/project/App/shared/routers/client.js

```js
import React from 'react';
import { Route, IndexRoute } from 'react-router';
import request from 'superagent';
import Client from 'pages/client';
import Home from 'pages/client/pages/home';
import Personal from 'pages/client/pages/personal';
import PaymentPwd from 'pages/client/pages/personal/pages/paymentPwd';
import Shipper from 'pages/client/pages/personal/pages/shipper';
import Agent from 'pages/client/pages/personal/pages/agent';
import ShipperMembers from 'pages/client/pages/shipperMembers';
import ShipperMemberDetail from 'pages/client/pages/shipperMembers/pages/detail';
import ShipperMemberRegister from 'pages/client/pages/shipperMembers/pages/register';
import Roadmaps from 'pages/client/pages/roadmaps';
import RoadmapDetail from 'pages/client/pages/roadmaps/pages/detail';
import RoadmapSendDoorList from 'pages/client/pages/roadmaps/pages/sendDoorList';
import SendDoorRoadmaps from 'pages/client/pages/sendDoorRoadmaps';
import SendDoorRoadmapDetail from 'pages/client/pages/sendDoorRoadmaps/pages/detail';
import Trucks from 'pages/client/pages/trucks';
import TruckDetail from 'pages/client/pages/trucks/pages/detail';
import PayForCarryPartment from 'pages/client/pages/trucks/pages/payForCarryPartment';
import SelectCarryPartment from 'pages/client/pages/trucks/pages/selectCarryPartment';
import TruckShowDetail from 'pages/client/pages/trucks/pages/showDetail';
import OrderListInTruck from 'pages/client/pages/trucks/pages/orderList';
import PreOrders from 'pages/client/pages/preOrders';
import PreOrderDetail from 'pages/client/pages/preOrders/pages/detail';
import PreOrderGroupDetail from 'pages/client/pages/preOrders/pages/groupDetail';
import PreOrderLookFee from 'pages/client/pages/preOrders/pages/lookFee';
import PreOrderLookGroupFee from 'pages/client/pages/preOrders/pages/lookGroupFee';
import Quotations from 'pages/client/pages/quotations';
import NeedSendOrders from 'pages/client/pages/needSendOrders';
import OrderListByEndPoint from 'pages/client/pages/needSendOrders/pages/orderListByEndPoint';
import OrderDetail from 'pages/client/pages/orderDetail';
import SPOrders from 'pages/client/pages/sporders';
import Bills from 'pages/client/pages/bills';
import Statistics from 'pages/client/pages/statistics';
import Feedback from 'pages/client/pages/feedback';
import Notify from 'pages/client/pages/notify';
import AgentMembers from 'pages/client/pages/agentMembers';
import AgentMemberDetail from 'pages/client/pages/agentMembers/pages/detail';
import AgentMemberRegister from 'pages/client/pages/agentMembers/pages/register';
import RegionRates from 'pages/client/pages/regionRates';
import RegionRate from 'pages/client/pages/regionRates/pages/detail';
import PlaceOrder from 'pages/client/pages/placeOrder';
import RCOrders from 'pages/client/pages/rcorders';
import RCOrderDetail from 'pages/client/pages/rcorders/pages/detail';
import SendOrders from 'pages/client/pages/sendOrders';
import ReceiveOrders from 'pages/client/pages/receiveOrders';

let firstEntry = true;

function authenticate (nextState, replaceState, callback) {
    if (typeof window !== 'undefined' && !firstEntry) {
        request
        .post('/client/graphql')
        .set('Content-Type', 'application/json')
        .set('Accept', 'application/json')
        .send({
            query: 'query { session }',
        })
        .end((error, result) => {
            if (error || !result.body.data.session) {
                window.location.href = '/client/login';
            } else {
                callback();
            }
        });
    } else {
        firstEntry = false;
        callback();
    }
}

export default [
    <Route name='client' path='/client' component={Client}>
        <IndexRoute component={Home} onEnter={authenticate} />
        <Route name='clientPersonal' path='personal'>
            <IndexRoute component={Personal} onEnter={authenticate} />
            <Route name='clientPaymentPwd' path='paymentPwd' component={PaymentPwd} onEnter={authenticate} />
            <Route name='clientShipper' path='shipper' component={Shipper} onEnter={authenticate} />
            <Route name='clientAgent' path='agent' component={Agent} onEnter={authenticate} />
        </Route>
        <Route name='shipperMembers' path='shipperMembers'>
            <IndexRoute component={ShipperMembers} onEnter={authenticate} />
            <Route name='shipperMemberDetail' path='detail' component={ShipperMemberDetail} onEnter={authenticate} />
            <Route name='shipperMemberRegister' path='register' component={ShipperMemberRegister} onEnter={authenticate} />
        </Route>
        <Route name='clientRoadmaps' path='roadmaps'>
            <IndexRoute component={Roadmaps} onEnter={authenticate} />
            <Route name='clientRoadmapDetail' path='detail' component={RoadmapDetail} onEnter={authenticate} />
            <Route name='clientRoadmapSendDoorList' path='sendDoorList' component={RoadmapSendDoorList} onEnter={authenticate} />
        </Route>
        <Route name='clientSendDoorRoadmaps' path='sendDoorRoadmaps'>
            <IndexRoute component={SendDoorRoadmaps} onEnter={authenticate} />
            <Route name='clientSendDoorRoadmapDetail' path='detail' component={SendDoorRoadmapDetail} onEnter={authenticate} />
        </Route>
        <Route name='clientTrucks' path='trucks'>
            <IndexRoute component={Trucks} onEnter={authenticate} />
            <Route name='clientTruckDetail' path='detail' component={TruckDetail} onEnter={authenticate} />
            <Route name='clientPayForCarryPartment' path='payForCarryPartment' component={PayForCarryPartment} onEnter={authenticate} />
            <Route name='clientSelectCarryPartment' path='selectCarryPartment' component={SelectCarryPartment} onEnter={authenticate} />
            <Route name='clientTruckShowDetail' path='showDetail' component={TruckShowDetail} onEnter={authenticate} />
            <Route name='clientOrderListInTruck' path='orderList' component={OrderListInTruck} onEnter={authenticate} />
        </Route>
        <Route name='clientPreOrders' path='preOrders'>
            <IndexRoute component={PreOrders} onEnter={authenticate} />
            <Route name='clientPreOrderDetail' path='detail' component={PreOrderDetail} onEnter={authenticate} />
            <Route name='clientPreOrderGroupDetail' path='groupDetail' component={PreOrderGroupDetail} onEnter={authenticate} />
            <Route name='clientPreOrderLookFee' path='lookFee' component={PreOrderLookFee} onEnter={authenticate} />
            <Route name='clientPreOrderLookGroupFee' path='lookGroupFee' component={PreOrderLookGroupFee} onEnter={authenticate} />
        </Route>
        <Route name='clientQuotations' path='quotations' component={Quotations} onEnter={authenticate} />
        <Route name='clientNeedSendOrders' path='needSendOrders' >
            <IndexRoute component={NeedSendOrders} onEnter={authenticate} />
            <Route name='clientOrderListByEndPoint' path='orderListByEndPoint' component={OrderListByEndPoint} onEnter={authenticate} />
        </Route>
        <Route name='clientOrderDetail' path='orderDetail' component={OrderDetail} onEnter={authenticate} />
        <Route name='clientBills' path='bills' component={Bills} onEnter={authenticate} />
        <Route name='clientSPOrders' path='sporders' component={SPOrders} onEnter={authenticate} />
        <Route name='clientStatistics' path='statistics' component={Statistics} onEnter={authenticate} />
        <Route name='clientFeedback' path='feedback' component={Feedback} onEnter={authenticate} />
        <Route name='clientNotify' path='notify' component={Notify} onEnter={authenticate} />
        <Route name='agentMembers' path='agentMembers'>
            <IndexRoute component={AgentMembers} onEnter={authenticate} />
            <Route name='agentMemberDetail' path='detail' component={AgentMemberDetail} onEnter={authenticate} />
            <Route name='agentMemberRegister' path='register' component={AgentMemberRegister} onEnter={authenticate} />
        </Route>
        <Route name='agentRegionRates' path='regionRates'>
            <IndexRoute component={RegionRates} onEnter={authenticate} />
            <Route name={'regionRateDetail'} path={'detail'} component={RegionRate} onEnter={authenticate} />
        </Route>
        <Route name='clientPlaceOrder' path='placeOrder' component={PlaceOrder} onEnter={authenticate} />
        <Route name='clientRCOrders' path='rcorders'>
            <IndexRoute component={RCOrders} onEnter={authenticate} />
            <Route name='clientRCOrderDetail' path='detail' component={RCOrderDetail} onEnter={authenticate} />
        </Route>
        <Route name='sendOrders' path='sendOrders' component={SendOrders} onEnter={authenticate} />
        <Route name='receiveOrders' path='receiveOrders' component={ReceiveOrders} onEnter={authenticate} />
    </Route>,
];

```

* PDShop_Client_PC/project/App/shared/routers/public.js

```js
// import React from 'react';
// import {Route} from 'react-router';

export default [];

```

* PDShop_Client_PC/project/App/client/helpers/render-routes.js

```js
import configureStore from 'helpers/configure-store';
import createHistory from 'history/lib/createBrowserHistory';
import React from 'react';
import { render } from 'react-dom';
import { Provider } from 'react-redux';
import { reduxReactRouter, ReduxRouter } from 'redux-router';
import getMuiTheme from 'material-ui/styles/getMuiTheme';
import MuiThemeProvider from 'material-ui/styles/MuiThemeProvider';
import injectTapEventPlugin from 'react-tap-event-plugin';

injectTapEventPlugin();

export default function renderRoutes (routes) {
    const state = window.__initialState;
    state.router = undefined;
    const store = configureStore(
        reduxReactRouter({ createHistory, routes }),
        state
    );
    const muiTheme = getMuiTheme({ userAgent: navigator.userAgent });

    render(
        <MuiThemeProvider muiTheme={muiTheme}>
            <Provider store={store}>
                <ReduxRouter routes={routes} />
            </Provider>
        </MuiThemeProvider>,
        document.getElementById('view')
    );
}

```

* PDShop_Client_PC/project/App/server/graphql/mutations/index.js

```js
import * as personal from './personal';
import * as member from './member';
import * as roadmap from './roadmap';
import * as truck from './truck';
import * as order from './order';
import * as agentOrder from './agentOrder';
import * as regionRate from './regionRate';

export default {
    ...personal,
    ...member,
    ...truck,
    ...roadmap,
    ...order,
    ...agentOrder,
    ...regionRate,
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/index.js

```js
import * as common from './common';
import * as personal from './personal';
import * as account from './account';
import * as member from './member';
import * as roadmap from './roadmap';
import * as order from './order';
import * as agentOrder from './agentOrder';
import * as quotation from './quotation';
import * as truck from './truck';
import * as statistic from './statistic';
import * as client from './client';
import * as regionRate from './regionRate';

export default {
    ...common,
    ...personal,
    ...account,
    ...member,
    ...roadmap,
    ...order,
    ...agentOrder,
    ...quotation,
    ...truck,
    ...statistic,
    ...client,
    ...regionRate,
};

```

* PDShop_Client_PC/project/App/shared/pages/client/index.js

```js
import React from 'react';
import { rootDataConnect } from 'relatejs';
import Client from './contents';
import _ from 'lodash';

@rootDataConnect()
export default class ClientContainer extends React.Component {
    state = {
        personal: {},
        currentShop: {},
        printShow: false,
    };
    updatePersonal (personal) {
        this.setState({ personal });
    }
    updateCurrentShop (currentShop) {
        this.setState({ currentShop });
    }
    updatePrintShow (printShow) {
        this.setState({ printShow });
    }
    hasAuthority (...authority) {
        const { personal } = this.state;
        return !!_.intersection(personal.authority, authority).length;
    }
    render () {
        const { personal, currentShop, printShow } = this.state;
        return (
            <Client {...this.props} printShow={printShow} rootPersonal={personal} rootShop={currentShop} hasAuthority={::this.hasAuthority}>
                {
                    React.cloneElement(this.props.children, {
                        rootPersonal: personal,
                        updatePersonal: ::this.updatePersonal,
                        rootShop: currentShop,
                        updateCurrentShop: ::this.updateCurrentShop,
                        updatePrintShow: ::this.updatePrintShow,
                        hasAuthority: ::this.hasAuthority,
                    })
                }
            </Client>
        );
    }
}

```

* PDShop_Client_PC/project/App/server/shared/helpers/bind-error-type.js

```js
import {
    GraphQLUnionType,
} from 'graphql';
import _ from 'lodash';
import { errorType } from '../../graphql/types/error';

export default function bindErrorType (obj) {
    let key = _.keys(obj)[0];
    let type = obj[key];
    return new GraphQLUnionType({
        name: key + 'BindErrorType',
        types: [type, errorType],
        resolveType: (value) => {
            if (value.error) {
                return errorType;
            }
            return type;
        },
    });
}

```

* PDShop_Client_PC/project/App/server/shared/helpers/default-favicon.js

```js
export default function getDefaultIcon (res) {
    return {
        tag: 'link',
        props: {
            rel: 'shortcut icon',
            type: 'image/vnd.microsoft.icon',
            href: `${res.baseScriptsURL}/client/favicon.ico`,
        },
    };
}

```

* PDShop_Client_PC/project/App/server/shared/helpers/get-base-component.js

```js
import React from 'react';
import { Provider } from 'react-redux';
import { ReduxRouter } from 'redux-router';
import getMuiTheme from 'material-ui/styles/getMuiTheme';
import MuiThemeProvider from 'material-ui/styles/MuiThemeProvider';

export default (req) => {
    const { store, headers } = req;
    const muiTheme = getMuiTheme({ userAgent: headers['user-agent'] });
    return (
        <MuiThemeProvider muiTheme={muiTheme}>
            <Provider store={store}>
                <ReduxRouter />
            </Provider>
        </MuiThemeProvider>
    );
};

```

* PDShop_Client_PC/project/App/server/shared/helpers/get-markup.js

```js
import serialize from 'serialize-javascript';
import Html from 'components/html';
import React from 'react';
import { renderToString } from 'react-dom/server';
import { Provider } from 'react-redux';
import { ReduxRouter } from 'redux-router';
import getMuiTheme from 'material-ui/styles/getMuiTheme';
import MuiThemeProvider from 'material-ui/styles/MuiThemeProvider';

export default function getMarkup (req, res) {
    const { store, headers } = req;
    const state = store.getState();
    const initialState = serialize(state);
    const muiTheme = getMuiTheme({ userAgent: headers['user-agent'] });

    const markup = renderToString(
        <MuiThemeProvider muiTheme={muiTheme}>
            <Provider store={store}>
                <ReduxRouter />
            </Provider>
        </MuiThemeProvider>
    );

    const htmlMarkup = renderToString(
        <Html
            body={markup}
            props={initialState}
            locals={res.locals}
            />
    );

    return htmlMarkup;
}

```

* PDShop_Client_PC/project/App/server/shared/helpers/get-projection.js

```js
export function getProjection (fieldASTs) {
    return fieldASTs.selectionSet.selections.reduce((projections, selection) => {
        projections[selection.name.value] = 1;
        return projections;
    }, {});
}

export function getInlineProjection (fieldASTs) {
    return fieldASTs.selectionSet.selections[0].selectionSet.selections.reduce((projections, selection) => {
        projections[selection.name.value] = 1;
        return projections;
    }, {});
}

```

* PDShop_Client_PC/project/App/server/shared/helpers/render-html.js

```js
import serialize from 'serialize-javascript';
import Html from 'components/html';
import React from 'react';
import { renderToString } from 'react-dom/server';

export default ({ component, store, locals }) => {
    const state = store.getState();
    const initialState = serialize(state);

    const markup = renderToString(component);

    const htmlMarkup = renderToString(
        <Html
            body={markup}
            props={initialState}
            locals={locals}
            />
    );

    return htmlMarkup;
};

```

* PDShop_Client_PC/project/App/server/shared/helpers/route-handler.js

```js
import configureStore from 'helpers/configure-store';
import { createMemoryHistory } from 'history';
import { match, reduxReactRouter } from 'redux-router/server';

export default function routeHandler (routes, req, res, next) {
    const store = configureStore(reduxReactRouter({
        createHistory: createMemoryHistory,
        routes,
    }));
    const url = req.originalUrl;

    store.dispatch(match(url, async (error, redirectLocation, routerState) => {
        if (error) {
            next(error);
        } else if (redirectLocation) {
            res.redirect(302, redirectLocation.pathname + redirectLocation.search);
        } else if (routerState) {
            req.routerState = routerState;
            req.store = store;
            next();
        } else {
            res.status(404).send('Not found');
        }
    }));
}

```

* PDShop_Client_PC/project/App/server/graphql/types/account.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
} from 'graphql';
import { makeResultType } from './common';

export const accountType = new GraphQLObjectType({
    name: 'accountType',
    fields: {
        amount: { type: GraphQLFloat },
        qrcode: { type: GraphQLString },
    },
});
export const accountResultType = makeResultType('accountResultType', accountType);

export const accountInputType = new GraphQLInputObjectType({
    name: 'accountInputType',
    fields: {
        amount: { type: GraphQLFloat },
        body: { type: GraphQLString },
        payPassword: { type: GraphQLString },
    },
});

```

* PDShop_Client_PC/project/App/server/graphql/types/agent.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, descriptType, descriptInputType } from './common';
import { clientType } from './client';
import { shopType } from './shop';

export const agentType = new GraphQLObjectType({
    name: 'agentType',
    fields: {
        // 列表的字段
        id: { type: GraphQLID },
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        addressRegion: { type: GraphQLString },
        addressRegionLastCode: { type: GraphQLInt },
        address: { type: GraphQLString },
        location: { type: new GraphQLList(GraphQLFloat) },
        phoneList:  { type: GraphQLString },
        name: { type: GraphQLString },
        chairMan: { type: clientType },
        // 基本信息
        sign: { type: GraphQLString },
        descriptList:  { type: new GraphQLList(descriptType) },
        registerTime: { type: GraphQLString },
        // 法人
        legalName: { type: GraphQLString },
        legalPhone: { type: GraphQLString },
        legalIDCard: { type: new GraphQLList(GraphQLString) },
        // 分店
        referShop: { type: shopType },
    },
});
export const agentResultType = makeResultType('agentResultType', agentType);

export const agentInputType = new GraphQLInputObjectType({
    name: 'agentInputType',
    fields: {
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        addressRegion: { type: GraphQLString },
        addressRegionLastCode: { type: GraphQLInt },
        address: { type: GraphQLString },
        location: { type: new GraphQLList(GraphQLFloat) },
        phoneList:  { type: GraphQLString },
        descriptList:  { type: new GraphQLList(descriptInputType) },

    },
});

```

* PDShop_Client_PC/project/App/server/graphql/types/bill.js

```js
import {
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
} from 'graphql';

import { makeListType } from './common';

export const billType = new GraphQLObjectType({
    name: 'billType',
    fields: {
        tradeAmountYuan: { type: GraphQLFloat },
        tradeTime: { type: GraphQLString },
        thirdpartyAccount: { type: GraphQLString },
        remark: { type: GraphQLString },
    },
});
export const billItemListType = makeListType('billItemListType', billType, 'list');

```

* PDShop_Client_PC/project/App/server/graphql/types/client.js

```js
import {
    GraphQLObjectType,
    GraphQLString,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType } from './common';

export const clientType = new GraphQLObjectType({
    name: 'clientType',
    fields: {
        id: { type: GraphQLID },
        name: { type: GraphQLString },
        phone: { type: GraphQLString },
        email: { type: GraphQLString },
        address: { type: GraphQLString },
        phoneList: { type: GraphQLString },
        authority: { type: new GraphQLList(GraphQLInt) },
    },
});
export const memberResultType = makeResultType('memberResultType', clientType);
export const memberListType = makeListType('memberListType', clientType);

```

* PDShop_Client_PC/project/App/server/graphql/types/common.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLBoolean,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

export function makeResultType (name, type) {
    const base = {
        success: { type: GraphQLBoolean },
        msg: { type: GraphQLString },
    };
    const fields = type ? { ...base, context: { type: type } } : base;
    return new GraphQLObjectType({ name, fields });
}

export function makeListType (name, type, listName) {
    return new GraphQLObjectType({
        name,
        fields: {
            count: { type: GraphQLInt },
            [listName || name.replace(/Type$/, '')]: { type: new GraphQLList(type) },
        },
    });
}

export const successType = new GraphQLObjectType({
    name: 'successType',
    fields: {
        success: { type: GraphQLBoolean },
        msg: { type: GraphQLString },
    },
});

export const descriptType = new GraphQLObjectType({
    name: 'descriptType',
    fields: {
        img: { type: GraphQLString }, // 图片
        text: { type: GraphQLString }, // 描述
    },
});

export const descriptInputType = new GraphQLInputObjectType({
    name: 'descriptInputType',
    fields: {
        img: { type: GraphQLString }, // 图片
        text: { type: GraphQLString }, // 描述
    },
});

export const pointType = new GraphQLObjectType({
    name: 'pointType',
    fields: {
        name: { type: GraphQLString }, // 地名
        longitude: { type: GraphQLFloat }, // 经度
        latitude: { type: GraphQLFloat }, // 纬度
        locateTime: { type: GraphQLString }, // 定位时间
    },
});

export const pointInputType = new GraphQLInputObjectType({
    name: 'pointInputType',
    fields: {
        name: { type: GraphQLString }, // 地名
        longitude: { type: GraphQLFloat }, // 经度
        latitude: { type: GraphQLFloat }, // 纬度
    },
});

export const driverType = new GraphQLObjectType({
    name: 'driverType',
    fields: {
        name: { type: GraphQLString }, // 司机名字
        phone: { type: GraphQLString }, // 司机电话
    },
});

export const driverInputType = new GraphQLInputObjectType({
    name: 'driverInputType',
    fields: {
        name: { type: GraphQLString }, // 司机名字
        phone: { type: GraphQLString }, // 司机电话
    },
});

export const sizeType = new GraphQLObjectType({
    name: 'sizeType',
    fields: {
        length: { type: GraphQLFloat }, // 长度
        width: { type: GraphQLFloat }, // 宽度
        height: { type: GraphQLFloat }, // 高度
    },
});

export const sizeInputType = new GraphQLInputObjectType({
    name: 'sizeInputType',
    fields: {
        length: { type: GraphQLFloat }, // 长度
        width: { type: GraphQLFloat }, // 宽度
        height: { type: GraphQLFloat }, // 高度
    },
});

export const addressType = new GraphQLObjectType({
    name: 'addressType',
    fields: {
        parentCode: { type: GraphQLInt },
        code: { type: GraphQLInt },
        name: { type: GraphQLString },
        level: { type: GraphQLInt },
        isLeaf: { type: GraphQLBoolean },
    },
});

export const startPointType = new GraphQLObjectType({
    name: 'startPointType',
    fields: {
        parentCode: { type: GraphQLInt },
        code: { type: GraphQLInt },
        level: { type: GraphQLInt },
        name: { type: GraphQLString },
        id: { type: GraphQLID },
        isShop: { type: GraphQLBoolean },
        isAgent: { type: GraphQLBoolean },
        addressRegionLastCode: { type: GraphQLInt },
        isLeaf: { type: GraphQLBoolean },
    },
});

export const orderAddressType = new GraphQLObjectType({
    name: 'orderAddressType',
    fields: {
        addressList: { type: new GraphQLList(new GraphQLList(addressType)) },
        cityAddressList: { type: new GraphQLList(new GraphQLList(addressType)) },
    },
});

```

* PDShop_Client_PC/project/App/server/graphql/types/order.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLBoolean,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType } from './common';
import { clientType } from './client';
import { shopType } from './shop';
import { agentType } from './agent';
import { shipperType } from './shipper';

const stateListType = new GraphQLObjectType({
    name: 'stateListType',
    fields: {
        state: { type: GraphQLInt },
        count: { type: GraphQLInt },
    },
});
export const orderType = new GraphQLObjectType({
    name: 'orderType',
    fields: {
        id: { type: GraphQLID },
        senderPhone: { type: GraphQLString },
        senderName: { type: GraphQLString },
        receiverPhone: { type: GraphQLString },
        receiverName: { type: GraphQLString },
        name: { type: GraphQLString },
        startPoint: { type: GraphQLString },
        startPointLastCode: { type: GraphQLInt },
        shop: { type: shopType },
        shipper: { type: shipperType },
        agent: { type: agentType },
        endPoint: { type: GraphQLString },
        endPointLastCode: { type: GraphQLInt },
        sendDoorEndPoint: { type: GraphQLString },
        sendDoorEndPointLastCode: { type: GraphQLInt },
        totalNumbers: { type: GraphQLInt },
        weight: { type: GraphQLFloat },
        size: { type: GraphQLFloat },
        proxyCharge: { type: GraphQLFloat },
        proxyChargeProfit: { type: GraphQLFloat },
        totalDesignatedFee: { type: GraphQLFloat },
        isReachPay: { type: GraphQLBoolean },
        isSendDoor: { type: GraphQLBoolean },
        isInsuance: { type: GraphQLBoolean },
        state: { type: GraphQLInt },
        placeOrderTime: { type: GraphQLString },
        // 价格
        realFee: { type: GraphQLFloat }, // 实际运费
        designatedFee: { type: GraphQLFloat }, // 指定收款
        needPayTransportFee: { type: GraphQLFloat }, // 应该付的运费
        needPayInsuanceFee: { type: GraphQLFloat }, // 应该付的保险金额
        photo: { type: GraphQLString }, // 图片
        // 提成
        profit: { type: GraphQLFloat },
        // 其他
        isCityDistribute: { type: GraphQLBoolean }, // 是否是同城配送
        payMode: { type: GraphQLInt }, // 支付方式 0：现付（PM_IMMEDIATE），1：到付（PM_REACH），2：混合支付（PM_MIXED 指定收款的部分到付，其余的现付）
        isTransferOrder: { type: GraphQLBoolean }, // 是否是中转单
        receiveAgentMember: { type: clientType }, // 收货员
        stateList: { type: new GraphQLList(stateListType) }, // 状态列表
        deductError: { type: GraphQLBoolean }, // 扣款是否失败
    },
});
export const orderResultType = makeResultType('orderResultType', orderType);
export const orderListType = makeListType('orderListType', orderType);
export const orderItemListType = makeListType('orderItemListType', orderType, 'list');

export const orderInputType = new GraphQLInputObjectType({
    name: 'orderInputType',
    fields: {
        orderId: { type: GraphQLID },
        orderGroupId: { type: GraphQLID },
        preOrderId: { type: GraphQLID },
        senderPhone: { type: GraphQLString },
        senderName: { type: GraphQLString },
        receiverPhone: { type: GraphQLString },
        receiverName: { type: GraphQLString },
        name: { type: GraphQLString },
        startPoint: { type: GraphQLString },
        startPointLastCode: { type: GraphQLInt },
        shopId: { type: GraphQLID },
        agentId: { type: GraphQLID },
        endPoint: { type: GraphQLString },
        endPointLastCode: { type: GraphQLInt },
        sendDoorEndPoint: { type: GraphQLString },
        sendDoorEndPointLastCode: { type: GraphQLInt },
        totalNumbers: { type: GraphQLInt },
        weight: { type: GraphQLFloat },
        size: { type: GraphQLFloat },
        proxyCharge: { type: GraphQLInt },
        totalDesignatedFee: { type: GraphQLInt },
        isCityDistribute: { type: GraphQLBoolean },
        isReachPay: { type: GraphQLBoolean },
        isSendDoor: { type: GraphQLBoolean },
        isInsuance: { type: GraphQLBoolean },
    },
});

export const orderFeeType = new GraphQLObjectType({
    name: 'orderFeeType',
    fields: {
        id: { type: GraphQLID },
        endPoint: { type: GraphQLString },
        selfSignRate: { type: GraphQLFloat },
        duration: { type: GraphQLFloat },
        distance: { type: GraphQLFloat },
        shipperName: { type: GraphQLString },
        shopName: { type: GraphQLString },
        shopAddress: { type: GraphQLString },
        agentName: { type: GraphQLString },
        agentAddress: { type: GraphQLString },
        transportFee: { type: GraphQLFloat },
        price: { type: GraphQLFloat },
        minFee: { type: GraphQLFloat },
        sendDoorPrice: { type: GraphQLFloat },
        sendDoorMinFee: { type: GraphQLFloat },
    },
});
export const orderFeeListType = makeListType('orderFeeListType', orderFeeType, 'roadmapList');
export const orderFeesType = new GraphQLObjectType({
    name: 'orderFeesType',
    fields: {
        shop: { type: orderFeeListType },
        agent: { type: orderFeeListType },
    },
});

export const needSendOrderType = new GraphQLObjectType({
    name: 'needSendOrderType',
    fields: {
        endPoint: { type: GraphQLString },
        orderCount: { type: GraphQLInt },
        totalNumbers: { type: GraphQLInt },
        totalWeight: { type: GraphQLFloat },
        totalSize: { type: GraphQLFloat },
        totalFee: { type: GraphQLFloat },
    },
});
export const needSendOrderListType = makeListType('needSendOrderListType', needSendOrderType, 'orderList');

```

* PDShop_Client_PC/project/App/server/graphql/types/orderGroup.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType } from './common';
import { orderType } from './order';
import { shopType } from './shop';
import { agentType } from './agent';

export const orderGroupType = new GraphQLObjectType({
    name: 'orderGroupType',
    fields: {
        id: { type: GraphQLID },
        startPoint: { type: GraphQLString },
        startPointLastCode: { type: GraphQLInt },
        shop: { type: shopType },
        agent: { type: agentType },
        name: { type: GraphQLString },
        orderCount: { type: GraphQLInt },
        totalNumbers: { type: GraphQLInt },
        totalWeight: { type: GraphQLFloat },
        totalSize: { type: GraphQLFloat },
    },
});
export const orderGroupResultType = makeResultType('orderGroupResultType', orderGroupType);
export const orderGroupListType = makeListType('orderGroupListType', orderGroupType);

export const orderGroupInputType = new GraphQLInputObjectType({
    name: 'orderGroupInputType',
    fields: {
        orderGroupId: { type: GraphQLID },
        groupName: { type: GraphQLString },
        startPoint: { type: GraphQLString },
        startPointLastCode: { type: GraphQLInt },
        shopId: { type: GraphQLID },
        agentId: { type: GraphQLID },
        orderGroupIdList:  { type: new GraphQLList(GraphQLID) },
        orderIdList:  { type: new GraphQLList(GraphQLID) },
    },
});

export const orderGroupFeeType = new GraphQLObjectType({
    name: 'orderGroupFeeType',
    fields: {
        id: { type: GraphQLID },
        totalTransportFee: { type: GraphQLFloat },
        name: { type: GraphQLString },
        address: { type: GraphQLString },
        distance: { type: GraphQLFloat },
        unfindOrderList: { type: new GraphQLList(orderType) },
    },
});
export const orderGroupFeesType = new GraphQLObjectType({
    name: 'orderGroupFeesType',
    fields: {
        shopList: { type: new GraphQLList(orderGroupFeeType) },
        agentList: { type: new GraphQLList(orderGroupFeeType) },
    },
});

```

* PDShop_Client_PC/project/App/server/graphql/types/personal.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLID,
    GraphQLString,
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { makeResultType } from './common';
import { shipperType } from './shipper';
import { agentType } from './agent';
import { truckType } from './truck';

export const personalInfoType = new GraphQLObjectType({
    name: 'personalInfoType',
    fields: {
        userId: { type: GraphQLID },
        phone: { type: GraphQLString },
        email: { type: GraphQLString },
        name: { type: GraphQLString },
        sex: { type: GraphQLInt },
        head: { type: GraphQLString },
        birthday: { type: GraphQLString },
        age: { type: GraphQLInt },
        address: { type: GraphQLString },
        phoneList: { type: GraphQLString },
        authority: { type: new GraphQLList(GraphQLInt) },
        shipper: { type: shipperType },
        agent: { type: agentType },
        truck: { type: truckType },
    },
});
export const personalInfoResultType = makeResultType('personalInfoResultType', personalInfoType);

export const personalInfoInputType = new GraphQLInputObjectType({
    name: 'personalInfoInputType',
    fields: {
        userId: { type: GraphQLID },
        phone: { type: GraphQLString },
        email: { type: GraphQLString },
        name: { type: GraphQLString },
        sex: { type: GraphQLInt },
        head: { type: GraphQLString },
        birthday: { type: GraphQLString },
        address: { type: GraphQLString },
        phoneList: { type: GraphQLString },
        password: { type: GraphQLString },
        verifyCode: { type: GraphQLString },
    },
});

```

* PDShop_Client_PC/project/App/server/graphql/types/roadmap.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLBoolean,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType } from './common';
import { shopType } from './shop';

const sendDoorRoadmapType = new GraphQLObjectType({
    name: 'sendDoorRoadmapType',
    fields: {
        enable: { type: GraphQLBoolean },
        sendDoorEndPoint: { type: GraphQLString },
        sendDoorEndPointLastCode: { type: GraphQLInt },
        sendDoorPrice: { type: GraphQLFloat },
        baseSendDoorPrice: { type: GraphQLFloat },
        updateSendDoorPriceTime: { type: GraphQLString },
        sendDoorMinFee: { type: GraphQLFloat },
        baseSendDoorMinFee: { type: GraphQLFloat },
        updateSendDoorMinFeeTime: { type: GraphQLString },
    },
});

export const roadmapType = new GraphQLObjectType({
    name: 'roadmapType',
    fields: {
        id: { type: GraphQLID },
        startPoint: { type: GraphQLString },
        endPoint: { type: GraphQLString },
        endPointLastCode: { type: GraphQLInt },
        price: { type: GraphQLFloat },
        basePrice: { type: GraphQLFloat },
        updatePriceTime: { type: GraphQLString },
        minFee: { type: GraphQLFloat },
        baseMinFee: { type: GraphQLFloat },
        updateMinFeeTime: { type: GraphQLString },
        duration: { type: GraphQLFloat },
        selfSignRate: { type: GraphQLFloat },
        modifyTime: { type: GraphQLString },
        enable: { type: GraphQLBoolean },
        sendDoorEnable: { type: GraphQLBoolean },
        sendDoorList: { type: new GraphQLList(sendDoorRoadmapType) },
    },
});
export const roadmapResultType = makeResultType('roadmapResultType', roadmapType);
export const roadmapListType = makeListType('roadmapListType', roadmapType);

export const roadmapInputType = new GraphQLInputObjectType({
    name: 'roadmapInputType',
    fields: {
        roadmapId: { type: GraphQLID },
        shopId: { type: GraphQLID },
        enable: { type: GraphQLBoolean },
        endPoint: { type: GraphQLString },
        endPointLastCode: { type: GraphQLInt },
        price: { type: GraphQLFloat },
        basePrice: { type: GraphQLFloat },
        minFee: { type: GraphQLFloat },
        baseMinFee: { type: GraphQLFloat },
        isCityDistribute: { type: GraphQLBoolean },
    },
});
export const setRoadmapPriceType = new GraphQLInputObjectType({
    name: 'setRoadmapPriceType',
    fields: {
        roadmapIdList: { type: new GraphQLList(GraphQLID) },
        mode: { type: GraphQLInt },
        typeList: { type: new GraphQLList(GraphQLInt) },
        value: { type: GraphQLFloat },
    },
});
export const setRoadmapSendDoorPriceType = new GraphQLInputObjectType({
    name: 'setRoadmapSendDoorPriceType',
    fields: {
        roadmapId: { type: GraphQLID },
        lastCodeList: { type: new GraphQLList(GraphQLInt) },
        mode: { type: GraphQLInt },
        typeList: { type: new GraphQLList(GraphQLInt) },
        value: { type: GraphQLFloat },
    },
});

export const regionRateType = new GraphQLObjectType({
    name: 'regionRateType',
    fields: {
        id: { type: GraphQLID },
        // 路线列表的参数
        shop: { type: shopType },
        region: { type: GraphQLString },
        type: { type: GraphQLInt },
        regionLastCode: { type: GraphQLInt },
        profitRate: { type: GraphQLFloat },
        profitCount: { type: GraphQLFloat },
        createTime: { type: GraphQLString },
        modifyTime: { type: GraphQLString },
    },
});
export const regionRateResultType = makeResultType('regionRateResultType', regionRateType);
export const regionRateListType = makeListType('regionRateListType', regionRateType);
export const regionRateInputType = new GraphQLInputObjectType({
    name: 'regionRateInputType',
    fields: {
        regionId:  { type: GraphQLID },
        regionRateIdList: { type: new GraphQLList(GraphQLID) },
        shopId: { type: GraphQLID },
        region: { type: GraphQLString },
        regionLastCode: { type: GraphQLInt },
        profitRate: { type: GraphQLFloat },
        profitCount: { type: GraphQLFloat },
        type: { type: GraphQLInt },
    },
});

```

* PDShop_Client_PC/project/App/server/graphql/types/shipper.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLID,
    GraphQLInt,
    GraphQLList,
    GraphQLBoolean,
} from 'graphql';

import { makeResultType, makeListType, descriptType, descriptInputType } from './common';
import { clientType } from './client';
import { shopType } from './shop';

export const bondCompanyType = new GraphQLObjectType({
    name: 'bondCompanyType',
    fields: {
        capital: { type: GraphQLFloat }, // 担保公司注册资金
        bondAmount: { type: GraphQLFloat }, // 担保金额
        name: { type: GraphQLString }, // 担保公司名称
        address: { type: GraphQLString }, // 担保公司地址
        phoneList: { type: GraphQLString }, // 担保公司电话
        legalName: { type: GraphQLString }, // 法人姓名
        legalPhone: { type: GraphQLString }, // 法人电话
        certificate: { type: new GraphQLList(GraphQLString) }, // 担保公司资格证书
        legalIDCard: { type: new GraphQLList(GraphQLString) }, // 法人身份证
    },
});
export const shipperType = new GraphQLObjectType({
    name: 'shipperType',
    fields: {
        // 列表的字段
        id: { type: GraphQLID },
        shipperType: { type: GraphQLInt },
        name: { type: GraphQLString },
        chairMan: { type: clientType },
        acountAmount: { type: GraphQLFloat },
        totalBondAmount: { type: GraphQLFloat },
        remainBondAmount: { type: GraphQLFloat },
        capital: { type: GraphQLFloat },
        // 基本信息
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        address: { type: GraphQLString },
        phoneList:  { type: GraphQLString },
        descriptList:  { type: new GraphQLList(descriptType) },
        registerTime: { type: GraphQLString },
        // 法人
        legalName: { type: GraphQLString },
        legalPhone: { type: GraphQLString },
        legalIDCard: { type: new GraphQLList(GraphQLString) },
        // 入驻分店性信息
        registerShopList: { type: new GraphQLList(shopType) },
        // 上门自提
        clientPickPrice: { type: GraphQLFloat },
        clientPickEnable: { type: GraphQLBoolean },
        // 担保公司
        bondCompanyList: { type: new GraphQLList(bondCompanyType) },
    },
});
export const shipperListType = makeListType('shipperListType', shipperType);
export const shipperResultType = makeResultType('shipperResultType', shipperType);

export const shipperInputType = new GraphQLInputObjectType({
    name: 'shipperInputType',
    fields: {
        shopId: { type: GraphQLID },
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        address: { type: GraphQLString },
        phoneList:  { type: GraphQLString },
        descriptList:  { type: new GraphQLList(descriptInputType) },
        clientPickPrice: { type: GraphQLFloat },
        clientPickEnable: { type: GraphQLBoolean },
    },
});

```

* PDShop_Client_PC/project/App/server/graphql/types/shop.js

```js
import {
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { makeListType } from './common';

export const carryPartmentType = new GraphQLObjectType({
    name: 'carryPartmentType',
    fields: {
        id: { type: GraphQLID },
        name: { type: GraphQLString },
        price: { type: GraphQLFloat },
        memberCount: { type: GraphQLInt },
        descript: { type: GraphQLString },
        phoneList: { type: GraphQLString },
    },
});

const memberInShopType = new GraphQLObjectType({
    name: 'memberInShopType',
    fields: {
        id: { type: GraphQLID },
        name: { type: GraphQLString },
        phone: { type: GraphQLString },
        head: { type: GraphQLString },
    },
});
export const shopType = new GraphQLObjectType({
    name: 'shopType',
    fields: {
        id: { type: GraphQLID },
        name: { type: GraphQLString },
        logo: { type: GraphQLString },
        image: { type: GraphQLString },
        sign: { type: GraphQLString },
        phoneList: { type: GraphQLString },
        addressRegion: { type: GraphQLString },
        addressRegionLastCode: { type: GraphQLInt },
        address: { type: GraphQLString },
        location: { type: new GraphQLList(GraphQLFloat) },
        chairMan: { type: memberInShopType },
        // 担保公司信息
        totalBondAmount: { type: GraphQLFloat }, // 总的担保金额
        remainBondAmount: { type: GraphQLFloat }, // 剩余可用的担保金额
        registerTime: { type: GraphQLString }, // 注册时间
    },
});

export const branchShopListType = makeListType('branchShopListType', shopType);

```

* PDShop_Client_PC/project/App/server/graphql/types/statistic.js

```js
import {
    GraphQLObjectType,
    GraphQLFloat,
    GraphQLInt,
    GraphQLList,
} from 'graphql';

export const shipperStatisticType = new GraphQLObjectType({
    name: 'shipperStatisticType',
    fields: {
        count: { type: new GraphQLList(GraphQLInt) },
        isReachPay: { type: new GraphQLList(GraphQLInt) },
        fee: { type: new GraphQLList(GraphQLFloat) },
        totalDesignatedFee: { type: new GraphQLList(GraphQLFloat) },
        proxyCharge: { type: new GraphQLList(GraphQLFloat) },
        weight: { type: new GraphQLList(GraphQLFloat) },
        size: { type: new GraphQLList(GraphQLFloat) },
    },
});

```

* PDShop_Client_PC/project/App/server/graphql/types/truck.js

```js
import {
    GraphQLInputObjectType,
    GraphQLObjectType,
    GraphQLString,
    GraphQLFloat,
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';

import { makeResultType, makeListType } from './common';
import { carryPartmentType } from './shop';
import { clientType } from './client';
import { orderType } from './order';

export const truckTypeType = new GraphQLObjectType({
    name: 'truckTypeType',
    fields: {
        name: { type: GraphQLString }, // 名称
        list: { type: new GraphQLList(GraphQLString) }, // 类型
    },
});
export const driverType = new GraphQLObjectType({
    name: 'driverType',
    fields: {
        id: { type: GraphQLID }, // Id
        name: { type: GraphQLString }, // 姓名
        phone: { type: GraphQLString }, // 手机号码
    },
});

export const truckType = new GraphQLObjectType({
    name: 'truckType',
    fields: {
        id: { type: GraphQLID }, // Id
        // 基本信息
        plateNo: { type: GraphQLString }, // 车牌号码
        drivingLicense: { type: GraphQLString }, // 行驶证编号
        truckType: { type: GraphQLString }, // 车型
        insuanceMount: { type: GraphQLFloat }, // 保险
        driver: { type: driverType }, // 司机的Id
        state: { type: GraphQLInt }, // 货车状态
        // 搬运信息
        orderCount: { type: GraphQLInt }, // 总单数
        totalNumbers: { type: GraphQLInt }, // 总件数
        totalWeight: { type: GraphQLFloat }, // 总重量
        totalSize: { type: GraphQLFloat }, // 总方量
        carryPrice: { type: GraphQLFloat }, // 搬运价格
        unloadAllOrderList: { type: new GraphQLList(orderType) }, // 只上了一部分订单列表
        scanner: { type: clientType }, // 扫描员
        carryPartment: { type: carryPartmentType }, // 选择的搬运部
    },
});

export const truckResultType = makeResultType('truckResultType', truckType);
export const truckItemListType = makeListType('truckItemListType', truckType, 'list');
export const trucksType = new GraphQLObjectType({
    name: 'trucksType',
    fields: {
        onway: { type: truckItemListType },
        complete: { type: truckItemListType },
    },
});

export const truckInputType = new GraphQLInputObjectType({
    name: 'truckInputType',
    fields: {
        truckId: { type: GraphQLID }, // 货车 Id
        shopId: { type: GraphQLID }, // 所在分店 Id
        plateNo: { type: GraphQLString }, // 车牌号码
        drivingLicense: { type: GraphQLString }, // 行驶证编号
        truckType: { type: GraphQLString }, // 车型
        insuanceMount: { type: GraphQLFloat }, // 保险
        driverId: { type: GraphQLID }, // 司机的Id
    },
});

```

* PDShop_Client_PC/project/App/shared/relatejs/actions/mutation.js

```js
import invariant from 'invariant';
import { buildQueryAndVariables } from '../helpers/fragments';

import actionTypes from './types';
import request from '../helpers/request';

export default function (options, callback = false) {
    return (dispatch, getState) => {
        invariant(options.fragments, 'Relate: Mutation needs fragments defined');

        const mutation = buildQueryAndVariables(options.fragments, options.variables, 'mutation');
        const { headers, endpoint, body, withCredentials } = getState().relateReducer;
        return request({
            dispatch,
            type: actionTypes.mutation,
            query: mutation.query,
            variables: mutation.variables,
            fragments: options.fragments,
            headers: options.headers || headers,
            body: options.body || body,
            endpoint: options.endpoint || endpoint,
            withCredentials,
        }).then((result) => {
            if (callback !== false) {
                callback(result, dispatch);
            }
        });
    };
}

```

* PDShop_Client_PC/project/App/shared/relatejs/actions/query.js

```js
import q from 'q';
import warning from 'warning';

import actionTypes from './types';
import request from '../helpers/request';

export default function graphql (
    { query, variables },
    fragments,
    connectors,
    scopes,
    config,
    relateSSR = false
) {
    return (dispatch, getState) => {
        let result;

        if (relateSSR) {
            result = q()
            .then(() => relateSSR({
                query,
                variables,
            }))
            .then(({ data, errors }) => {
                dispatch({
                    type: actionTypes.query,
                    data,
                    errors,
                    variables,
                    connectors,
                    scopes,
                    fragments,
                    isIntrospection: true,
                });
            })
            .catch((err) => {
                warning(false, err);
            });
        } else {
            const { headers, endpoint, body, withCredentials } = getState().relateReducer;
            result = request({
                dispatch,
                type: actionTypes.query,
                query,
                variables,
                connectors,
                scopes,
                fragments,
                headers: config && config.headers || headers,
                body: config && config.body || body,
                endpoint: config && config.endpoint || endpoint,
                withCredentials,
            });
        }

        return result;
    };
}

```

* PDShop_Client_PC/project/App/shared/relatejs/actions/remove-connector.js

```js
import actionTypes from './types';

export default function removeConnector (id) {
    return {
        type: actionTypes.removeConnector,
        id,
    };
}

```

* PDShop_Client_PC/project/App/shared/relatejs/actions/settings.js

```js
import actionTypes from './types';

export function setHeader (key, value) {
    return {
        type: actionTypes.setHeader,
        key,
        value,
    };
}

export function removeHeader (key) {
    return {
        type: actionTypes.removeHeader,
        key,
    };
}

export function setEndpoint (endpoint) {
    return {
        type: actionTypes.setEndpoint,
        endpoint,
    };
}

export function setBody (key, value) {
    return {
        type: actionTypes.setBody,
        key,
        value,
    };
}

export function removeBody (key) {
    return {
        type: actionTypes.removeBody,
        key,
    };
}

```

* PDShop_Client_PC/project/App/shared/relatejs/actions/types.js

```js
export default {
    query: 'RELATE_QUERY',
    mutation: 'RELATE_MUTATION',
    removeConnector: 'RELATE_REMOVE_CONNECTOR',
    setHeader: 'RELATE_SET_HEADER',
    removeHeader: 'RELATE_REMOVE_HEADER',
    setEndpoint: 'RELATE_SET_ENDPOINT',
    setBody: 'RELATE_SET_BODY',
    removeBody: 'RELATE_REMOVE_BODY',
};

```

* PDShop_Client_PC/project/App/shared/relatejs/helpers/capture.js

```js
import _ from 'lodash';

/**
* Captures a relate query or mutation values (concats scoped queries)
*
* @param {Object} action
* @param {String||Array} test
*/
export default (action, test) => {
    if (!test) {
        return null;
    }

    const querieTestNames = test.constructor === Array ? test : [test];
    let result = null;

    _.forEach(action.data, (queryValue, key) => {
        if (queryValue && querieTestNames.indexOf(key) !== -1 ||
        querieTestNames.indexOf(action.scopes[key]) !== -1) {
            // is in query test values

            if (queryValue.constructor === Array) {
                result = result && [...result, ...queryValue] || [...queryValue];
            } else {
                result = queryValue;
            }
        }
    });

    return result;
};

```

* PDShop_Client_PC/project/App/shared/relatejs/helpers/connectors-ids.js

```js
let ID_COUNTER = 0;
let PREFIX = '';

export function generateConnectorId () {
    return `${PREFIX}connector_${ID_COUNTER++}`;
}

export function resetConnectorsIds (prefix = '') {
    PREFIX = prefix;
    ID_COUNTER = 0;
}

```

* PDShop_Client_PC/project/App/shared/relatejs/helpers/fragments.js

```js
import _ from 'lodash';

//
// Example usage:
//
//     mergeFragments({
//       page: {
//         _id: 1,
//         name: 1,
//         createdBy: {
//           _id: 1
//         }
//       }
//     }, {
//       page: {
//         title: 1,
//         createdBy: {
//           name: 1
//         }
//       }
//     }))
//
// Outputs:
//
//     { page: { _id: 1, name: 1, createdBy: { _id: 1, name: 1 }, title: 1 } }
//
export function mergeFragments () {
    return _.merge({}, ...arguments);
}

//
// Example usage:
//
//     fragmentToQL({
//       _id: 1,
//       name: 1,
//       createdBy: {
//         _id: 1
//       }
//     })
//
// Outputs:
//
//     _id,name,createdBy { _id }
//
export function fragmentToQL (fragment) {
    const iterate = (i) => {
        return Object
        .keys(i)
        .map((key) => {
            let result;
            const value = i[key];
            if (typeof value === 'object') {
                result = `${key} { ${iterate(value)} }`;
            } else {
                result = key;
            }
            return result;
        })
        .join(',');
    };
    return iterate(fragment);
}

// Example usage:
//
//     const {query, variables} = buildQueryAndVariables(
//       {
//         session: {
//           _id: 1,
//           email: 1
//         },
//         page: {
//           _id: 1,
//           title: 1,
//           slug: 1,
//           createdBy: {
//             name: 1
//           }
//         }
//       },
//       {
//         page: {
//           slug: {
//             value: 'landing',
//             type: 'String!'
//           }
//         }
//       }
//     );
//
// Outputs:
//
// {
//   query: `
//     query ($slug0: String!) {
//       session {
//         _id,
//         email
//       },
//       page (slug: $slug0) {
//         _id,
//         title,
//         slug,
//         createdBy {
//           name
//         }
//       }
//     }
//   `,
//   variables: {
//     slug0: 'landing'
//   }
// }
//
let iterator;
let variables;
let variablesTypes;

function _buildQuery (fragments, inputVariables = {}) {
    const queries = [];

    _.forIn(fragments, (fragment, key) => {
        let queryStr = '';
        const vars = inputVariables[key];
        const variablesMap = []; // slug: $slug
        const hasFragments = typeof fragment === 'object';

        // variables calculation
        if (vars) {
            _.forIn(vars, (varValue, varKey) => {
                if (varValue.hasOwnProperty('type') && varValue.hasOwnProperty('value') && typeof varValue.type === 'string') {
                    const name = varKey + iterator;
                    variablesTypes.push(`$${name}: ${varValue.type}`);
                    variablesMap.push(`${varKey}: $${name}`);
                    variables[name] = varValue.value;
                    iterator++;
                }
            });
        }

        // Make query variables string
        let variablesString = '';
        if (variablesMap.length) {
            variablesString = ` (${variablesMap.join(',')})`;
        }

        queryStr += `${key}${variablesString}`;

        if (hasFragments) {
            queryStr += ` { ${_buildQuery(fragment, vars)} }`;
        }

        queries.push(queryStr);
    });

    return queries.join(',');
}

export function buildQueryAndVariables (fragments, inputVariables = {}, type = 'query') {
    variables = {};
    variablesTypes = [];
    iterator = 0;

    const queries = _buildQuery(fragments, inputVariables);

    let query;
    if (variablesTypes.length) {
        query = `${type} (${variablesTypes.join(',')}) { ${queries} }`;
    } else {
        query = `${type} { ${queries} }`;
    }

    return {
        query,
        variables,
    };
}

```

* PDShop_Client_PC/project/App/shared/relatejs/helpers/get-variables.js

```js
import invariant from 'invariant';
import _ from 'lodash';

export default function getVariables ({ variables, fragments, variablesTypes, displayName }) {
    const resultVariables = {};
    if (variables) {
        _.forEach(variables, (vars, queryName) => {
            if (fragments[queryName]) { // if not in fragments, ignore
                resultVariables[queryName] = {};
                const queryVariablesTypes = variablesTypes[queryName];

                // No variables types defined for this query
                invariant(
                    queryVariablesTypes,
                    'Relate: Query to %s doesn\'t have variables types defined in %s!',
                    queryName,
                    displayName || 'a component'
                );

                // Check if every variable has a type
                _.forEach(vars, (value, variable) => {
                    invariant(
                        queryVariablesTypes[variable],
                        'Relate: Query to %s does not have variable "%s" type defined in %s!',
                        queryName,
                        variable,
                        displayName || 'a component'
                    );

                    // add variable prepared for query e.g. {type: 'String', value: 'something'}
                    const type = queryVariablesTypes[variable];

                    if (typeof type === 'object') {
                        // deep query
                        Object.assign(resultVariables[queryName], getVariables({
                            variables: { [variable]: value },
                            fragments: { [variable]: fragments[queryName] },
                            variablesTypes: { [variable]: type },
                        }));
                    } else {
                        resultVariables[queryName][variable] = {
                            type: queryVariablesTypes[variable],
                            value,
                        };
                    }
                });

                // Check if every required variable type is met
                _.forEach(queryVariablesTypes, (type, variable) => {
                    if (typeof type !== 'object') {
                        invariant(
                            type.slice(-1) !== '!' || vars[variable] !== undefined,
                            'Relate: Query to %s requires the variable "%s" in %s!',
                            queryName,
                            variable,
                            displayName || 'a component'
                        );
                    }
                });
            }
        });
    }
    return resultVariables;
}

```

* PDShop_Client_PC/project/App/shared/relatejs/helpers/request.js

```js
import request from 'superagent';
import _ from 'lodash';
import Q from 'q';

function omitAll (obj) {
    if (_.isPlainObject(obj)) {
        return _.mapValues(obj, (o) => omitAll(o));
    } else if (_.isArray(obj)) {
        return _.map(obj, (o) => omitAll(o));
    } else if (obj === null) {
        return undefined;
    }
    return obj;
}

export default function doRequest ({ dispatch, query, variables, type, endpoint, headers, body, ...params }) {
    console.log('[relatejs]: doRequest', { dispatch, query, variables, type, endpoint, headers, body, ...params });
    return new Q()
    .then(() => {
        const deferred = Q.defer();
        let promise = deferred.promise;
        const dataObj = { query, variables, ...body };
        const payload =
        headers['Content-Type'] === 'text/plain' ?
        JSON.stringify(dataObj) :
        dataObj;

        const req = request
        .post(endpoint || '/client/graphql')
        .set(headers)
        .send(payload);

        if (params.withCredentials) {
            req.withCredentials();
        }

        req
        .end((error, res) => {
            if (error) {
                console.error('[relatejs]:', res.text);
                deferred.reject(error);
            } else {
                const data = omitAll(res.body);
                console.log('[relatejs]: body', data);
                const { errors } = data;
                if (errors && errors.length && _.find(errors, (item) => (item.message === 'unauthorized'))) {
                    window.location.href = '/client/login';
                } else {
                    deferred.resolve(data);
                }
            }
        });

        if (dispatch) {
            console.log('[relatejs]: start dispatch');
            promise = promise.then(({ data, errors }) => {
                console.log('[relatejs]: dispatch', { type, data, errors, ...params });
                dispatch({ type, data, errors, ...params });
                return data;
            });
        }

        return promise;
    });
}

```

* PDShop_Client_PC/project/App/shared/relatejs/decorators/data-connect.js

```js
import React, { Component, PropTypes } from 'react';

import { connect } from 'react-redux';
import { generateConnectorId } from '../helpers/connectors-ids';
import getVariables from '../helpers/get-variables';
import hoistStatics from 'hoist-non-react-statics';
import invariant from 'invariant';
import removeConnector from '../actions/remove-connector';
import KeepData from '../store/keep-data';
import _ from 'lodash';

export default function dataConnect (...args) {
    const { length } = args;
    let getReduxState, getReduxDispatches, getBundle;
    invariant(length, 'Relate: a dataConnect does not have arguments specified');
    if (length === 1) {
        getBundle = args[0];
    } else {
        getReduxState = args[0];
        getReduxDispatches = args[1];
        getBundle = args[2];
    }

    return function wrapWithDataConnect (WrappedComponent) {
        class ConnectData extends Component {
            static propTypes = {
                relateConnectorData: PropTypes.object,
                CONNECTOR_ID: PropTypes.string.isRequired,
            };

            static contextTypes = {
                fetchData: PropTypes.func.isRequired,
                store: PropTypes.any.isRequired,
                relate_ssr: PropTypes.func,
            };

            static defaultProps = {
                relateConnectorData: {},
            };

            static relateIdentifier = 'DATA_CONNECT';

            constructor (props, context) {
                super(props, context);

                this.constructor.displayName = WrappedComponent.name;

                // Relate connector info
                this.relate = {
                    setKeepData: ::this.setKeepData,
                    refresh: ::this.refresh,
                    loadMore: ::this.loadMore,
                    loadPage: ::this.loadPage,
                    variables: {},
                    hasMore: true,
                    pageNo: 0,
                };

                // Set keepData
                if (props.keepData) {
                    this.setKeepData(props.keepData);
                }

                // get bundle
                this.initialBundle = this.processBundle(props);
                if (!props.relateConnectorData || Object.keys(props.relateConnectorData).length === 0) {
                    this.initialHasDataToFetch = !!(
                        this.initialBundle &&
                        !this.initialBundle.manualLoad &&
                        this.hasDataToFetch(this.initialBundle.fragments)
                    );
                    if (this.context.relate_ssr) {
                        this.initialFetchData();
                    }
                    // Set initial state
                    this.state = {
                        loading: this.initialHasDataToFetch,
                        error: false,
                    };
                } else {
                    this.state = {
                        loading: false,
                        error: false,
                    };
                }
            }

            componentWillMount () {
                this.initialFetchData();
            }

            shouldComponentUpdate (nextProps, nextState) {
                return (
                    !this.state.loading ||
                    this.state.loading && !nextState.loading ||
                    this.state.error !== nextState.error
                );
            }

            componentWillUnmount () {
                const { pathname } = this.props.location || {};
                // 如果有保留数据，则不删除 CONNECTOR_ID，否则会删除 CONNECTOR_ID， 同时会删除 keepData
                if (!KeepData.getHasKeepData(pathname)) {
                    this.context.store.dispatch(removeConnector(this.props.CONNECTOR_ID));
                }
            }

            /*
            * 如果进入其他页面需要保留该页面的数据的时候，使用该接口
            * keepData 为需要额外保留的数据，如果没有，使用 setKeepData(true);
            * 需要保留的额外数据的情况
            * relate.setKeepData({ lastSelectIndex: index, lastCurrent: current });
            * 如果想要手动删除 keepData, 使用 setKeepData();
            *
            * 如果想设置一个全局的保留数据，需要在 @dataConnect 里面设置，如下：
            * @dataConnect(
            *    (state, props) => ({ states: state.tests, keepData: true })
            * }
            *
            * 如果不设置pathname，则使用 location.pathname， 只有 IndexRoute 的时候才需要设置
            */
            setKeepData (keepData, pathname) {
                KeepData.update(this.props.location.pathname, keepData, this.props.CONNECTOR_ID, this.context.store, pathname);
            }

            initialFetchData () {
                if (this.initialHasDataToFetch) {
                    this.fetchData({
                        fragments: this.initialBundle.fragments,
                        variables: this.initialBundle.initialVariables,
                        mutations: this.initialBundle.mutations,
                    });
                }
            }

            /* 如果没有设置 property，则取 variables 的键值，如果不需要请求参数的时候使用 property ,需要的时候必须使用 variables
            * 不需要参数的情况
            * relate.refresh({
            *     property: 'personal',
            * });
            *
            * 要参数的情况
            * relate.refresh({
            *     variables: {
            *         clients: {
            *             pageNo: 0,
            *             pageSize,
            *             keyword,
            *         },
            *     },
            * });
            */
            refresh ({ variables, property, callback }) {
                const properties = [...(variables ? _.keys(variables) : []), ...(_.isArray(property) ? property : [property])];
                const bundle = this.processBundle(this.props, variables);

                // Fetch data
                if (bundle) {
                    this.setState({
                        loading: true,
                    }, () => {
                        this.fetchData({
                            fragments: _.pick(bundle.fragments, properties),
                            variables,
                            mutations: bundle.mutations,
                            callback,
                        });
                    });
                }
            }

            // 适合做上拉加载更多的列表
            loadMore ({ variables, property, callback }) {
                const key = _.keys(variables)[0];
                const bundle = this.processBundle(this.props, variables);
                // Fetch data
                if (bundle && !this.lock) {
                    this.lock = true;
                    this.setState({
                        loading: true,
                        loadingMore: true,
                    }, () => {
                        this.fetchData({
                            fragments: _.pick(bundle.fragments, key),
                            variables,
                            mutations: bundle.mutations,
                            loadingMoreProperty: property || true,
                            callback,
                        });
                    });
                }
            }

            // 适合做分页的表格
            loadPage ({ variables, property, callback }) {
                const key = _.keys(variables)[0];
                const bundle = this.processBundle(this.props, variables);
                const { pageNo, pageSize } = variables[key];
                // Fetch data
                if (bundle && !this.lock) {
                    this.lock = true;
                    this.setState({
                        loadingPage: true,
                    }, () => {
                        this.fetchData({
                            fragments: _.pick(bundle.fragments, key),
                            variables,
                            mutations: bundle.mutations,
                            loadingPageProperty: property || true,
                            loadingPageStartIndex: pageNo * pageSize,
                            callback,
                        });
                    });
                }
            }

            hasDataToFetch (fragments) {
                return typeof fragments === 'object' && Object.keys(fragments).length > 0;
            }

            processBundle (props, variables) {
                const bundle = getBundle && getBundle(props);

                this.variablesTypes = bundle && bundle.variablesTypes || {};
                this.relate.variables = variables || bundle && bundle.initialVariables || {};

                return bundle;
            }

            fetchData ({ fragments, variables, mutations, loadingMoreProperty = false, loadingPageProperty = false, loadingPageStartIndex = 0, callback }) {
                console.log('[relatejs] fetchData:', { fragments, variables, mutations, loadingMoreProperty, loadingPageProperty, loadingPageStartIndex });
                const { fetchData } = this.context;

                if (fetchData && this.hasDataToFetch(fragments)) {
                    const fetchOptions = {
                        fragments,
                        variables: getVariables({
                            variables,
                            variablesTypes: this.variablesTypes,
                            fragments,
                            displayName: typeof WrappedComponent !== 'undefined' && WrappedComponent.displayName,
                        }),
                        ID: this.props.CONNECTOR_ID,
                        mutations,
                        loadingMoreProperty,
                        loadingPageProperty,
                        loadingPageStartIndex,
                    };
                    if (this.context.relate_ssr) {
                        fetchData(fetchOptions);
                    } else {
                        fetchData(fetchOptions)
                        .then((data) => {
                            callback && callback(data);
                            const { loadingMore } = this.state;
                            if (loadingMoreProperty && loadingMore) {
                                const key = _.keys(variables)[0];
                                const { pageNo, pageSize } = variables[key];
                                const item = (loadingMoreProperty === true) ? data[key] : data[key][loadingMoreProperty];
                                if (item) {
                                    this.relate.hasMore = item.length >= pageSize;
                                    this.relate.pageNo = pageNo;
                                }
                            }

                            this.setState({
                                loading: false,
                                loadingMore: false,
                                loadingPage: false,
                                error: false,
                            });

                            this.lock = false;
                        })
                        .catch(() => {
                            this.setState({
                                loading: false,
                                loadingMore: false,
                                loadingPage: false,
                                error: true,
                            });
                        });
                    }
                } else {
                    if (!this.context.relate_ssr) {
                        this.setState({
                            loading: false,
                            loadingMore: false,
                            loadingPage: false,
                            error: false,
                        });
                    }
                }
            }

            render () {
                const { relateConnectorData, ...otherProps } = this.props;
                const { loading, loadingMore, loadingPage } = this.state;
                return (
                    <WrappedComponent
                        {...otherProps}
                        {...relateConnectorData}
                        relate={this.relate}
                        loading={loading}
                        loadingMore={loadingMore}
                        loadingPage={loadingPage}
                        />
                );
            }
        }

        const Connected = connect(
            () => function map (state, props) {
                const { pathname } = props.location || {};
                const refuxProps = getReduxState && getReduxState(state, props) || {};
                const keepData = KeepData.get(pathname, refuxProps);
                if (!this.CONNECTOR_ID) {
                    this.CONNECTOR_ID = keepData.connectorId;
                }
                if (!this.CONNECTOR_ID) {
                    if (state.relateReducer.server) {
                        const finalProps = Object.assign({}, props, refuxProps);
                        const initialBundle = getBundle(finalProps);
                        const thisCompare = {
                            fragments: initialBundle.fragments,
                            variables: getVariables({
                                variables: initialBundle.initialVariables,
                                variablesTypes: initialBundle.variablesTypes,
                                fragments: initialBundle.fragments,
                            }),
                        };

                        _.forEach(state.relateReducer.server, (compare, id) => {
                            if (_.isEqual(compare, thisCompare)) {
                                this.CONNECTOR_ID = id;
                                return false;
                            }
                            return true;
                        });

                        if (!this.CONNECTOR_ID) {
                            this.CONNECTOR_ID = generateConnectorId();
                        }
                    } else {
                        this.CONNECTOR_ID = generateConnectorId();
                    }
                }
                return Object.assign(
                    refuxProps,
                    {
                        relateConnectorData: state.relateReducer[this.CONNECTOR_ID],
                        CONNECTOR_ID: this.CONNECTOR_ID,
                    },
                    keepData.data,
                );
            },
            (dispatch) => Object.assign(
                getReduxDispatches && getReduxDispatches(dispatch) || {},
                {
                    removeConnector: dispatch(removeConnector),
                }
            )
        )(ConnectData);

        return hoistStatics(Connected, WrappedComponent, {
            relateIdentifier: true,
        });
    };
}

```

* PDShop_Client_PC/project/App/shared/relatejs/decorators/root-data-connect.js

```js
import hoistStatics from 'hoist-non-react-statics';
import warning from 'warning';
import Q from 'q';
import _ from 'lodash';
import React, { Component, PropTypes } from 'react';
import { mergeFragments, buildQueryAndVariables } from '../helpers/fragments';

import queryAction from '../actions/query';

export default function rootDataConnect (config) {
    return function wrapWithDataConnect (WrappedComponent) {
        class RootConnectData extends Component {
            static contextTypes = {
                store: PropTypes.any.isRequired,
                relate_ssr: PropTypes.func,
            };

            static childContextTypes = {
                fetchData: PropTypes.func.isRequired,
            };

            static relateIdentifier = 'ROOT_DATA_CONNECT';

            constructor (props, context) {
                super(props, context);
                this.bundle = {};
                this.childFetchDataBind = ::this.childFetchData;
                this.fetchDebounce = _.debounce(::this.fetchData, 10);
                this.scopeID = 0;
            }

            getChildContext () {
                return {
                    fetchData: this.childFetchDataBind,
                };
            }

            componentDidMount () {
                this.mounted = true;
                if (this.bundle && this.bundle.fragments) {
                    this.fetchData();
                }
            }

            childFetchData ({ fragments, variables = {}, ID, mutations, loadingMoreProperty = false, loadingPageProperty = false, loadingPageStartIndex = 0 }) {
                // Check for same query with different variables
                const scopes = {};
                const resultFragments = Object.assign({}, fragments || {});
                const resultVariables = Object.assign({}, variables || {});

                if (this.bundle.fragments) {
                    _.forEach(fragments, (fragment, queryName) => {
                        if (this.bundle.fragments[queryName]) {
                            // Same query name detected, will have to check if variables are the same
                            const sameVariables = _.isEqual(
                                variables && variables[queryName],
                                this.bundle.variables && this.bundle.variables[queryName]
                            );

                            if (!sameVariables) {
                                // Will have to scope it
                                const scope = `relate_${this.scopeID++}`;
                                const newQueryName = `${scope}: ${queryName}`;
                                resultFragments[newQueryName] = Object.assign({}, fragments[queryName]);
                                scopes[scope] = queryName;
                                delete resultFragments[queryName];

                                if (resultVariables[queryName]) {
                                    resultVariables[newQueryName] = Object.assign({}, variables[queryName]);
                                    delete resultVariables[queryName];
                                }
                            }
                        }
                    });
                }

                this.bundle = {
                    fragments: mergeFragments(this.bundle.fragments || {}, resultFragments),
                    variables: Object.assign(this.bundle.variables || {}, resultVariables),
                    connectors: Object.assign(this.bundle.connectors || {}, {
                        [ID]: { fragments, variables, mutations, scopes, loadingMoreProperty, loadingPageProperty, loadingPageStartIndex },
                    }),
                    scopes: Object.assign(this.bundle.scopes || {}, scopes),
                };

                let result = null;
                if (!this.context || !this.context.relate_ssr) {
                    if (this.fetchingData && this.deferred) {
                        if (!this.nextDeferred) {
                            this.nextDeferred = Q.defer();

                            this.deferred.promise.fin(() => {
                                this.deferred = this.nextDeferred;
                                this.nextDeferred = null;
                                this.fetchData();
                            });
                        }

                        result = this.nextDeferred.promise;
                    } else {
                        if (this.mounted) {
                            this.fetchDebounce();
                        }

                        this.deferred = this.deferred || Q.defer();
                        result = this.deferred.promise;
                    }
                }

                return result;
            }

            fetchData () {
                const { store, relate_ssr } = this.context;
                const { dispatch } = store;
                const { fragments, variables, connectors, scopes } = this.bundle;
                this.bundle = {};
                this.deferred = this.deferred || Q.defer();
                if (fragments && Object.keys(fragments).length) {
                    this.fetchingData = true;
                    dispatch(
                        queryAction(
                            buildQueryAndVariables(fragments, variables),
                            fragments,
                            connectors,
                            scopes,
                            typeof config === 'function' ? config(this.props) : config,
                            relate_ssr
                        )
                    ).then((data) => {
                        this.deferred.resolve(data);
                    }).catch((err) => {
                        warning(false, err);
                        this.deferred.reject();
                    }).fin(() => {
                        this.deferred = null;
                        this.fetchingData = false;
                    });
                } else {
                    this.deferred.resolve();
                    this.fetchingData = false;
                }

                return this.deferred.promise;
            }

            render () {
                return <WrappedComponent {...this.props} />;
            }
        }

        return hoistStatics(RootConnectData, WrappedComponent, {
            relateIdentifier: true,
        });
    };
}

```

* PDShop_Client_PC/project/App/shared/relatejs/redirect-graphql/index.js

```js
import { buildQueryAndVariables } from '../helpers/fragments';
import request from '../helpers/request';

const headers = {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
};

export function apiQuery (options, callback) {
    const mutation = buildQueryAndVariables(options.fragments, options.variables, 'query');
    const params = { ...mutation, headers };
    return () => {
        return request(params).then(({ data }) => {
            callback(data);
        });
    };
}

export function apiMutation (options, callback) {
    const mutation = buildQueryAndVariables(options.fragments, options.variables, 'mutation');
    const params = { ...mutation, headers };
    return () => {
        return request(params).then(({ data }) => {
            callback(data);
        });
    };
}

```

* PDShop_Client_PC/project/App/shared/relatejs/server/get-data-dependencies.js

```js
import invariant from 'invariant';
import q from 'q';
import React from 'react';

import { resetConnectorsIds } from '../helpers/connectors-ids';

function processElement ({ element, context, rootDataConnectors, dataConnectors }) {
    try {
        if (element !== null) {
            const { props, type } = element;
            if (typeof type === 'function') {
                const ElementClass = element.type;
                let finalProps = props;
                if (ElementClass.defaultProps) {
                    finalProps = Object.assign({}, ElementClass.defaultProps, props);
                }
                // console.log("=============1", element);
                // console.log("=============2", ElementClass);
                const Element = new ElementClass(
                    finalProps,
                    context
                );

                if (type.relateIdentifier === 'ROOT_DATA_CONNECT') {
                    rootDataConnectors.push(Element);
                } else if (type.relateIdentifier === 'DATA_CONNECT') {
                    dataConnectors.push(Element);
                }

                // Generate context for children
                let newContext = context;
                if (Element.getChildContext) {
                    newContext = Object.assign({}, context, Element.getChildContext());
                }
                // console.log("=============3", !!Element.render);
                // go through children
                const renderResult = Element.render ? Element.render() : ElementClass(finalProps, context);
                // console.log("=============4", renderResult);
                processElement({
                    element: renderResult,
                    context: newContext,
                    rootDataConnectors,
                    dataConnectors,
                });
            } else if (props && props.children) {
                React.Children.forEach(props.children, (childElement) => {
                    processElement({
                        element: childElement,
                        context,
                        rootDataConnectors,
                        dataConnectors,
                    });
                });
            }
        }
    } catch (err) {
        console.log('=============5', err);
        invariant(false, 'Relate: error traversing components tree');
    }
}

export default function getAllDataDependencies (rootElement, getData) {
    const rootDataConnectors = [];
    const dataConnectors = [];

    // Ensure connectors ids are reset
    resetConnectorsIds('server_');

    // traverse tree
    processElement({
        element: rootElement,
        context: {
            relate_ssr: getData,
        },
        rootDataConnectors,
        dataConnectors,
    });

    // fetch data for each root data connector
    return q()
    .then(() => {
        let result;

        if (rootDataConnectors.length) {
            result = rootDataConnectors[0].fetchData();
        } else {
            result = null;
        }

        return result;
    })
    .then(() => resetConnectorsIds())
    .catch(() => {
        invariant(false, 'Relate: error getting data');
    });
}

```

* PDShop_Client_PC/project/App/shared/relatejs/store/connectors.js

```js
import _ from 'lodash';

export default class Connectors {
    constructor () {
        this.connectors = {};
    }

    connectorExists (connectorId) {
        return this.connectors[connectorId] && true;
    }

    generateConnectorData (connectorId) {
        const connector = this.connectors[connectorId];
        return connector.data;
    }

    // Process a query through the connectors that requested it
    processConnectors (queryConnectors, queryName, relativeNodes) {
        console.log('[relatejs]: processConnectors', { queryConnectors, queryName, relativeNodes });
        _.forEach(queryConnectors, (connectorQuery, connectorId) => {
            // Check if queryName is a scoped one
            const actualQueryName = connectorQuery.scopes && connectorQuery.scopes[queryName] || queryName;
            const isInConnectorFragments = connectorQuery.fragments[actualQueryName] && true;
            const isScopedQuery = actualQueryName !== queryName;
            const scopedOther =
            !isScopedQuery && // is not a scoped query
            connectorQuery.scopes && // has scopes
            _.values(connectorQuery.scopes).indexOf(actualQueryName) !== -1; // query has not been scoped

            // check if query was triggered by this connector
            // 1st case for scoped queries
            // 2nd case for non scope queries (they cannot be a value in scope)
            if ((isInConnectorFragments && isScopedQuery) ||
            (isInConnectorFragments && !isScopedQuery && !scopedOther)) {
                this.connectors[connectorId] = this.connectors[connectorId] || {
                    data: {},
                    fragments: {},
                    mutations: {},
                };
                const conn = this.connectors[connectorId];
                const { loadingMoreProperty, loadingPageProperty } = connectorQuery;
                // Add query data
                if (loadingMoreProperty) {
                    if (loadingMoreProperty === true) {
                        conn.data[actualQueryName] = [...conn.data[actualQueryName], ...relativeNodes];
                    } else {
                        _.set(conn.data[actualQueryName], loadingMoreProperty, [..._.get(conn.data[actualQueryName], loadingMoreProperty), ..._.get(relativeNodes, loadingMoreProperty)]);
                    }
                } else if (loadingPageProperty) {
                    let index = connectorQuery.loadingPageStartIndex;
                    if (loadingPageProperty === true) {
                        const list = conn.data[actualQueryName] || [];
                        _.forEach(relativeNodes, (item) => {
                            list[index++] = item;
                        });
                        for (let i = 0; i < index; i++) {
                            if (list[i] === undefined) {
                                list[i] = false;
                            }
                        }
                        conn.data[actualQueryName] = list;
                    } else {
                        const list = _.get(conn.data[actualQueryName], loadingPageProperty) || [];
                        _.forEach(_.get(relativeNodes, loadingPageProperty), (item) => {
                            list[index++] = item;
                        });
                        for (let i = 0; i < index; i++) {
                            if (list[i] === undefined) {
                                list[i] = false;
                            }
                        }
                        _.set(conn.data[actualQueryName], loadingPageProperty, list);
                    }
                } else {
                    Object.assign(conn.data, { [actualQueryName]: relativeNodes });
                }

                // fragments
                Object.assign(conn.fragments, {
                    [actualQueryName]: connectorQuery.fragments[actualQueryName],
                });

                // mutations listeners
                conn.mutations = connectorQuery.mutations || {};
            }
        });
    }

    // Check if any connector is listening to the mutation passed as argument
    checkMutationListeners (mutationName, relativeNodes) {
        const connsToUpdate = [];
        console.log('[relatejs]: checkMutationListeners', { mutationName, relativeNodes, connectors: this.connectors });
        _.forEach(this.connectors, (connector, connectorId) => {
            const mutation = connector.mutations && connector.mutations[mutationName];
            if (mutation && mutation.constructor === Function) {
                connsToUpdate.push(connectorId);
                mutation({ state:connector.data, data:relativeNodes, connector, _ });
            }
        });
        return connsToUpdate;
    }

    deleteConnector (connectorId) {
        this.connectors[connectorId] && delete this.connectors[connectorId];
    }
}

```

* PDShop_Client_PC/project/App/shared/relatejs/store/global-data.js

```js
export default {
    data: {},
    get (key, value) {
        const ret = this.data[key];
        if (value !== undefined) {
            this.data[key] = value;
        }
        return ret;
    },
    set (key, value) {
        this.data[key] = value;
    },
};

```

* PDShop_Client_PC/project/App/shared/relatejs/store/index.js

```js
import _ from 'lodash';
import Connectors from './connectors';

export default class Store {
    constructor () {
        // Connectors interface
        this.connectors = new Connectors();
    }

    // #isMutation - Boolean
    processIncoming ({ data, fragments, connectors, isMutation }) {
        console.log('[relatejs]: processIncoming', { data, fragments, connectors, isMutation });
        let connectorsToUpdate = connectors && Object.keys(connectors) || [];

        _.forEach(fragments, (fragment, queryName) => {
            const relativeNodes = data[queryName];

            // Process data to connectors
            if (connectors) {
                this.connectors.processConnectors(
                    connectors,
                    queryName,
                    relativeNodes,
                );
            }

            // If mutation check if some connector is listening
            if (isMutation) {
                connectorsToUpdate = _.union(
                    connectorsToUpdate,
                    this.connectors.checkMutationListeners(queryName, relativeNodes)
                );
            }
        });

        // Calculate connectors that need to be changed
        const changes = {};
        _.forEach(connectorsToUpdate, (connectorId) => {
            if (this.connectors.connectorExists(connectorId)) {
                changes[connectorId] = this.connectors.generateConnectorData(connectorId);
            }
        });
        return changes;
    }

    // Remove a data connector
    deleteConnector (connectorId) {
        this.connectors.deleteConnector(connectorId);
    }
}

```

* PDShop_Client_PC/project/App/shared/relatejs/store/keep-data.js

```js
import _ from 'lodash';
import removeConnector from '../actions/remove-connector';

export default {
    list: {},
    redirectPathnameList: {},
    update (location, data, connectorId, store, pathname) {
        if (pathname) {
            this.redirectPathnameList[location] = pathname;
            location = pathname;
        }
        if (data) {
            if (this.list[location] && typeof data === 'object') {
                this.list[location].data = Object.assign(this.list[location].data || {}, data, _.omitBy({ connectorId, store, hasKeepData: true }, _.isNil));
            } else {
                let obj = { connectorId, store, hasKeepData: true };
                if (typeof data === 'object') {
                    obj.data = data;
                }
                this.list[location] = obj;
            }
        } else if (this.list[location]) {
            delete this.list[location];
        }
    },
    get (location, props) {
        location = this.redirectPathnameList[location] || location;
        let obj = this.list[location] || {};
        if (!props.keepLastKeepData) {
            _.forEach(this.list, (o, key) => {
                if (key !== location) {
                    o.store.dispatch(removeConnector(o.connectorId));
                }
            });
        }
        return obj;
    },
    getHasKeepData (location) {
        location = this.redirectPathnameList[location] || location;
        return (this.list[location] || {}).hasKeepData;
    },
    getKeepData (location) {
        location = this.redirectPathnameList[location] || location;
        return (this.list[location] || {}).data;
    },
    removeConnectorId (connectorId) {
        const item = _.find(this.list, (o) => o.connectorId === connectorId);
        if (item) {
            if (item.onlyClearConnector) {
                delete item.onlyClearConnector;
                delete item.connectorId;
            } else {
                this.list = _.omitBy(this.list, (o) => o.connectorId === connectorId);
            }
        }
    },
    // 只清除location的所有数据
    forceClear (location) {
        location = this.redirectPathnameList[location] || location;
        const obj = this.list[location];
        if (obj) {
            obj.store.dispatch(removeConnector(obj.connectorId));
        }
    },
    // 只清除location的connectorId， 其他的数据保留
    forceClearConnector (location) {
        location = this.redirectPathnameList[location] || location;
        const obj = this.list[location];
        if (obj) {
            obj.onlyClearConnector = true;
            obj.store.dispatch(removeConnector(obj.connectorId));
        }
    },
};

```

* PDShop_Client_PC/project/App/shared/relatejs/reducer/reducer.js

```js
import actionTypes from '../actions/types';
import Store from '../store';
import KeepData from '../store/keep-data';
import _ from 'lodash';

const store = new Store();

// Default state
// state will be composed of connectors data, e.g.
// {
//   connector_1: {
//     pages: [{...}, {...}]
//   },
//   connector_2: {
//     page: {...}
//   }
// }
const defaultState = {
    headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
    },
    body: {},
    endpoint: '/client/graphql',
    withCredentials: false,
};

export function relateReducer (_state = defaultState, action = {}) {
    const isIntrospection = action.isIntrospection;
    let state = _state;

    // Server store hydration
    if (!isIntrospection && state.serverConnectors) {
        store.connectors.connectors = state.serverConnectors;
        state = Object.assign({}, state);
        delete state.serverConnectors;
    }

    if ((action.type === actionTypes.query || action.type === actionTypes.mutation) &&
    action.data &&
    action.fragments) {
        const isMutation = action.type === actionTypes.mutation;

        const changes = store.processIncoming({
            data: action.data,
            fragments: action.fragments,
            connectors: action.connectors,
            isMutation,
        });

        let result;
        if (isIntrospection) {
            // is introspection (server side), so save connectors mapping for later re hydration
            const connectorsMap = {};
            _.forEach(action.connectors, (connectorData, connectorId) => {
                connectorsMap[connectorId] = {
                    fragments: connectorData.fragments,
                    variables: connectorData.variables,
                };
            });
            result = Object.assign({}, state, changes, {
                server: connectorsMap,
                serverConnectors: store.connectors.connectors,
            });
        } else {
            // client side
            result = Object.assign({}, state, changes);
        }

        return result;
    }

    if (action.type === actionTypes.removeConnector) {
        const newState = Object.assign({}, state);
        delete newState[action.id];
        KeepData.removeConnectorId(action.id);
        store.deleteConnector(action.id);

        if (state.server) {
            // server mapping no longer needed
            delete newState.server;
        }

        // TODO Delete no longer needed data from state? or maintain for future cache?
        return newState;
    }

    if (action.type === actionTypes.setHeader) {
        return Object.assign({}, state, {
            headers: Object.assign({}, state.headers, {
                [action.key]: action.value,
            }),
        });
    }

    if (action.type === actionTypes.removeHeader) {
        const headers = Object.assign({}, state.headers);
        delete headers[action.key];
        return Object.assign({}, state, {
            headers,
        });
    }

    if (action.type === actionTypes.setEndpoint) {
        return Object.assign({}, state, {
            endpoint: action.endpoint,
        });
    }

    if (action.type === actionTypes.setBody) {
        return Object.assign({}, state, {
            body: Object.assign({}, state.body, {
                [action.key]: action.value,
            }),
        });
    }

    if (action.type === actionTypes.removeBody) {
        const body = Object.assign({}, state.body);
        delete body[action.key];
        return Object.assign({}, state, {
            body,
        });
    }

    return state;
}

export function relateReducerInit (settings) {
    Object.assign(defaultState, settings);
    return relateReducer;
}

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/confirmCachPayed.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.confirmCachPayed, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/confirmCachPayedForOrderList.js

```js
import {
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderIdList: {
            type: new GraphQLList(GraphQLID),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.confirmCachPayedForOrderList, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/index.js

```js
export placeClientOrder from './placeClientOrder';
export placeClientOrderWithPreOrder from './placeClientOrderWithPreOrder';
export modifyClientOrder from './modifyClientOrder';
export confirmCachPayed from './confirmCachPayed';
export confirmCachPayedForOrderList from './confirmCachPayedForOrderList';
export printOrderBill from './printOrderBill';
export printOrderListBill from './printOrderListBill';
export printBarCode from './printBarCode';
export removeClientOrder from './removeClientOrder';

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/modifyClientOrder.js

```js
import { authorize } from '../../authorize';
import { orderInputType, orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyClientOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/placeClientOrder.js

```js
import { authorize } from '../../authorize';
import { orderInputType, orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.placeClientOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/placeClientOrderWithPreOrder.js

```js
import { authorize } from '../../authorize';
import { orderInputType, orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.placeClientOrderWithPreOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/printBarCode.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.printBarCode, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/printOrderBill.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderResultType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.printOrderBill, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/printOrderListBill.js

```js
import {
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderIdList: {
            type: new GraphQLList(GraphQLID),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.printOrderListBill, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/agentOrder/removeClientOrder.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeClientOrder, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/member/index.js

```js
export modifyShipperMemberAuthority from './modifyShipperMemberAuthority';
export modifyAgentMemberAuthority from './modifyAgentMemberAuthority';

```

* PDShop_Client_PC/project/App/server/graphql/mutations/member/modifyAgentMemberAuthority.js

```js
import {
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberResultType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: memberResultType,
    args: {
        memberId: {
            type: GraphQLID,
        },
        authority: {
            type: new GraphQLList(GraphQLInt),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let res = await post(urls.modifyAgentMemberAuthority, params, root) || { msg: '服务器错误' };

        return res;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/member/modifyshipperMemberAuthority.js

```js
import {
    GraphQLInt,
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberResultType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: memberResultType,
    args: {
        memberId: {
            type: GraphQLID,
        },
        authority: {
            type: new GraphQLList(GraphQLInt),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyShipperMemberAuthority, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/regionRate/addRegionProfit.js

```js
import { authorize } from '../../authorize';
import { regionRateResultType, regionRateInputType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: regionRateResultType,
    args: {
        data:{
            type:regionRateInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.addRegionProfit, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/regionRate/index.js

```js
export addRegionProfit from './addRegionProfit';
export modifyRegionProfit from './modifyRegionProfit';
export removeRegionProfit from './removeRegionProfit';
export setRegionProfitWithList from './setRegionProfitWithList';

```

* PDShop_Client_PC/project/App/server/graphql/mutations/regionRate/modifyRegionProfit.js

```js
import { authorize } from '../../authorize';
import { regionRateResultType, regionRateInputType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: regionRateResultType,
    args: {
        data:{
            type:regionRateInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyRegionProfit, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/regionRate/removeRegionProfit.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        regionId:{
            type:GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeRegionProfit, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/regionRate/setRegionProfitWithList.js

```js
import {
    GraphQLFloat,
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        regionIdList: {
            type: new GraphQLList(GraphQLID),
        },
        profitRate: {
            type: GraphQLFloat,
        },
        profitCount: {
            type: GraphQLFloat,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.setRegionProfitWithList, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/truck/createTruck.js

```js
import { authorize } from '../../authorize';
import { truckInputType, truckResultType } from '../../types/truck';
import { post, urls } from 'helpers/api';

export default {
    type: truckResultType,
    args: {
        data: {
            type: truckInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.createTruck, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/truck/index.js

```js
export createTruck from './createTruck';
export modifyTruck from './modifyTruck';
export removeTruck from './removeTruck';
export selectCarryPartment from './selectCarryPartment';
export payforCarryPartment from './payforCarryPartment';
export setCityTruck from './setCityTruck';

```

* PDShop_Client_PC/project/App/server/graphql/mutations/truck/modifyTruck.js

```js
import { authorize } from '../../authorize';
import { truckInputType, truckResultType } from '../../types/truck';
import { post, urls } from 'helpers/api';

export default {
    type: truckResultType,
    args: {
        data: {
            type: truckInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyTruck, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/truck/payforCarryPartment.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        truckId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.payforCarryPartment, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/truck/removeTruck.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        truckId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeTruck, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/truck/selectCarryPartment.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        truckId: {
            type: GraphQLID,
        },
        carryPartmentId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.selectCarryPartment, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/truck/setCityTruck.js

```js
import {
    GraphQLString,
} from 'graphql';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        plateNo: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.setCityTruck, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/order/createPreOrderGroup.js

```js
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { orderGroupInputType } from '../../types/orderGroup';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: orderGroupInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.createPreOrderGroup, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/order/index.js

```js
export placePreOrder from './placePreOrder';
export modifyPreOrder from './modifyPreOrder';
export removePreOrder from './removePreOrder';
export createPreOrderGroup from './createPreOrderGroup';
export modifyPreOrderGroup from './modifyPreOrderGroup';
export removePreOrderFromGroup from './removePreOrderFromGroup';
export payForOrderWhenSend from './payForOrderWhenSend';

```

* PDShop_Client_PC/project/App/server/graphql/mutations/order/modifyPreOrder.js

```js
import { authorize } from '../../authorize';
import { orderResultType, orderInputType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyPreOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/order/modifyPreOrderGroup.js

```js
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { orderGroupInputType } from '../../types/orderGroup';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: orderGroupInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyPreOrderGroup, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/order/payForOrderWhenSend.js

```js
import {
    GraphQLID,
    GraphQLList,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        payPassword: {
            type: GraphQLString,
        },
        orderIdList: {
            type: new GraphQLList(GraphQLID),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.payForOrderWhenSend, params, root) || { msg: '服务器繁忙,请稍后重试' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/order/placePreOrder.js

```js
import { authorize } from '../../authorize';
import { orderResultType, orderInputType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderResultType,
    args: {
        data: {
            type: orderInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.placePreOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/order/removePreOrder.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removePreOrder, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/order/removePreOrderFromGroup.js

```js
import {
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        orderIdList: {
            type: new GraphQLList(GraphQLID),
        },
        orderGroupId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removePreOrderFromGroup, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/index.js

```js
export publishRoadmap from './publishRoadmap';
export modifyRoadmap from './modifyRoadmap';
export removeRoadmap from './removeRoadmap';
export setRoadmapPrice from './setRoadmapPrice';
export setRoadmapSendDoorPrice from './setRoadmapSendDoorPrice';
export setRoadmapSendDoorBasePrice from './setRoadmapSendDoorBasePrice';
export setRoadmapEnable from './setRoadmapEnable';
export setRoadmapSendDoorEnable from './setRoadmapSendDoorEnable';

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/modifyRoadmap.js

```js
import { authorize } from '../../authorize';
import { roadmapInputType, roadmapResultType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapResultType,
    args: {
        data: {
            type: roadmapInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyRoadmap, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/publishRoadmap.js

```js
import { authorize } from '../../authorize';
import { roadmapInputType, roadmapResultType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapResultType,
    args: {
        data: {
            type: roadmapInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.publishRoadmap, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/removeRoadmap.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        roadmapId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.removeRoadmap, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/setRoadmapEnable.js

```js
import {
    GraphQLID,
    GraphQLBoolean,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        roadmapIdList: {
            type: new GraphQLList(GraphQLID),
        },
        enable: {
            type: GraphQLBoolean,
        },

    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.setRoadmapEnable, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/setRoadmapPrice.js

```js
import { authorize } from '../../authorize';
import { setRoadmapPriceType, roadmapResultType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapResultType,
    args: {
        data: {
            type: setRoadmapPriceType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.setRoadmapPrice, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/setRoadmapSendDoorBasePrice.js

```js
import { authorize } from '../../authorize';
import { setRoadmapSendDoorPriceType, roadmapResultType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapResultType,
    args: {
        data: {
            type: setRoadmapSendDoorPriceType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.setRoadmapSendDoorBasePrice, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/setRoadmapSendDoorEnable.js

```js
import {
    GraphQLID,
    GraphQLInt,
    GraphQLBoolean,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        roadmapId: {
            type: GraphQLID,
        },
        lastCodeList: {
            type: new GraphQLList(GraphQLInt),
        },
        enable: {
            type: GraphQLBoolean,
        },

    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.setRoadmapSendDoorEnable, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/roadmap/setRoadmapSendDoorPrice.js

```js
import { authorize } from '../../authorize';
import { setRoadmapSendDoorPriceType, roadmapResultType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapResultType,
    args: {
        data: {
            type: setRoadmapSendDoorPriceType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.setRoadmapSendDoorPrice, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/feedback.js

```js
import {
    GraphQLString,
} from 'graphql';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        content: {
            type: GraphQLString,
        },
        email: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.feedback, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/forgotPwd.js

```js
import { successType } from '../../types/common';
import { personalInfoInputType } from '../../types/personal';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: personalInfoInputType,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.forgotPwd, params.data) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/index.js

```js
export register from './register';
export forgotPwd from './forgotPwd';
export setPaymentPassword from './setPaymentPassword';
export modifyPersonalInfo from './modifyPersonalInfo';
export modifyShipperInfo from './modifyShipperInfo';
export modifyAgentInfo from './modifyAgentInfo';
export feedback from './feedback';
export setReferShop from './setReferShop';

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/modifyAgentInfo.js

```js
import { authorize } from '../../authorize';
import { agentResultType, agentInputType } from '../../types/agent';
import { post, urls } from 'helpers/api';

export default {
    type: agentResultType,
    args: {
        data: {
            type: agentInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyAgentInfo, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/modifyPersonalInfo.js

```js
import { authorize } from '../../authorize';
import { personalInfoResultType, personalInfoInputType } from '../../types/personal';
import { post, urls } from 'helpers/api';

export default {
    type: personalInfoResultType,
    args: {
        data: {
            type: personalInfoInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyPersonalInfo, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/modifyShipperInfo.js

```js
import { authorize } from '../../authorize';
import { shipperResultType, shipperInputType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperResultType,
    args: {
        data: {
            type: shipperInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.modifyShipperInfo, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/register.js

```js
import { successType } from '../../types/common';
import { personalInfoInputType } from '../../types/personal';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: personalInfoInputType,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.register, params.data) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/setPaymentPassword.js

```js
import { successType } from '../../types/common';
import { personalInfoInputType } from '../../types/personal';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        data: {
            type: personalInfoInputType,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.setPaymentPassword, params.data) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/mutations/personal/setReferShop.js

```js
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';
import {
    GraphQLID,
} from 'graphql';

export default {
    type: successType,
    args: {
        shopId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.setReferShop, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/agentOrder/addressWithOrder.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderAddressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: orderAddressType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.addressWithOrder, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/agentOrder/index.js

```js
export rcorder from './rcorder';
export rcorders from './rcorders';
export selectPreOrders from './selectPreOrders';
export addressWithOrder from './addressWithOrder';
export sendDoorAddressWithOrder from './sendDoorAddressWithOrder';

```

* PDShop_Client_PC/project/App/server/graphql/queries/agentOrder/rcorder.js

```js
import { authorize } from '../../authorize';
import { orderType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.rcorder, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/agentOrder/rcorders.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderItemListType } from '../../types/order';
import { post, urls } from 'helpers/api';

const rcordersType = new GraphQLObjectType({
    name: 'rcordersType',
    fields: {
        topay: { type: orderItemListType },
        toprintbill: { type: orderItemListType },
        tosend: { type: orderItemListType },
        onway: { type: orderItemListType },
        success: { type: orderItemListType },
    },
});

export default {
    type: rcordersType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.rcorders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/agentOrder/selectPreOrders.js

```js
import {
    GraphQLInt,
    GraphQLString,
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderListType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        senderPhone: {
            type: GraphQLID,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.selectPreOrders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/agentOrder/sendDoorAddressWithOrder.js

```js
import {
    GraphQLList,
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { addressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(new GraphQLList(addressType)),
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.sendDoorAddressWithOrder, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/member/agentMember.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { clientType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: clientType,
    args: {
        memberId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.agentMember, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/member/agentMembers.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberListType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: memberListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.agentMembers, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/member/getAgentMemberByPhone.js

```js
import {
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberResultType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: memberResultType,
    args: {
        memberPhone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.getAgentMemberByPhone, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/member/getShipperMemberByPhone.js

```js
import {
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberResultType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: memberResultType,
    args: {
        memberPhone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.getShipperMemberByPhone, params, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/member/index.js

```js
// shipper
export shipperMembers from './shipperMembers';
export shipperMember from './shipperMember';
export getShipperMemberByPhone from './getShipperMemberByPhone';

// agent
export agentMembers from './agentMembers';
export agentMember from './agentMember';
export getAgentMemberByPhone from './getAgentMemberByPhone';

```

* PDShop_Client_PC/project/App/server/graphql/queries/member/shipperMember.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { clientType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: clientType,
    args: {
        memberId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.shipperMember, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/member/shipperMembers.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberListType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: memberListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.shipperMembers, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/clientReceiveOrders.js

```js
import { GraphQLString, GraphQLInt, GraphQLObjectType } from 'graphql';
import { authorize } from '../../authorize';
import { orderItemListType } from '../../types/order';
import { post, urls } from 'helpers/api';

const receiveOrdersType = new GraphQLObjectType({
    name: 'receiveOrdersType',
    fields: {
        topay: { type: orderItemListType },
        toreceive: { type: orderItemListType },
        onway: { type: orderItemListType },
        success: { type: orderItemListType },
    },
});

export default {
    type: receiveOrdersType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        const res = await post(urls.receiveOrders, params, root) || { msg: '服务器繁忙请稍后再试!!!' };
        return res.success ? res.context : { msg: res.msg };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/clientSendOrders.js

```js
import { GraphQLString, GraphQLInt, GraphQLID, GraphQLObjectType } from 'graphql';
import { authorize } from '../../authorize';
import { orderItemListType } from '../../types/order';
import { post, urls } from 'helpers/api';

const sendOrdersType = new GraphQLObjectType({
    name: 'sendOrdersType',
    fields: {
        topay: { type: orderItemListType },
        toreceive: { type: orderItemListType },
        onway: { type: orderItemListType },
        success: { type: orderItemListType },
    },
});

export default {
    type: sendOrdersType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        senderId: {
            type: GraphQLID,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        const res = await post(urls.sendOrders, params, root) || { msg: '服务器繁忙请稍后再试!!!' };
        return res.success ? res.context : { msg: res.msg };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/inGroupPreOrders.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderListType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderListType,
    args: {
        orderGroupId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.inGroupPreOrders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/index.js

```js
export order from './order';
export sporders from './sporders';
export preOrders from './preOrders';
export preOrderGroups from './preOrderGroups';
export inGroupPreOrders from './inGroupPreOrders';
export lookFee from './lookFee';
export lookGroupFee from './lookGroupFee';
export needSendOrders from './needSendOrders';
export orderListByEndPoint from './orderListByEndPoint';
export sendOrders from './clientSendOrders';
export receiveOrders from './clientReceiveOrders';

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/lookFee.js

```js
import {
    GraphQLID,
    GraphQLFloat,
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderFeesType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderFeesType,
    args: {
        orderId: {
            type: GraphQLID,
        },
        location: {
            type: new GraphQLList(GraphQLFloat),
        },
        orderBy: {
            type: GraphQLInt,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.lookFee, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/lookGroupFee.js

```js
import {
    GraphQLID,
    GraphQLFloat,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderGroupFeesType } from '../../types/orderGroup';
import { post, urls } from 'helpers/api';

export default {
    type: orderGroupFeesType,
    args: {
        orderGroupId: {
            type: GraphQLID,
        },
        location: {
            type: new GraphQLList(GraphQLFloat),
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.lookGroupFee, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/needSendOrders.js

```js
import {
    GraphQLInt,
    GraphQLString,
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { needSendOrderListType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: needSendOrderListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        shopId: {
            type: GraphQLID,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.needSendOrders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/order.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderType,
    args: {
        orderId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        if (!params.orderId) {
            return undefined;
        }
        let ret = await post(urls.order, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/orderListByEndpoint.js

```js
import {
    GraphQLInt,
    GraphQLString,
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderListType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderListType,
    args: {
        endPoint: {
            type: GraphQLString,
        },
        shopId: {
            type: GraphQLID,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.orderListByEndPoint, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/preOrderGroups.js

```js
import { authorize } from '../../authorize';
import { orderGroupListType } from '../../types/orderGroup';
import { post, urls } from 'helpers/api';

export default {
    type: orderGroupListType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.preOrderGroups, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/preOrders.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderListType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.preOrders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/order/sporders.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLID,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderItemListType } from '../../types/order';
import { post, urls } from 'helpers/api';

const spordersType = new GraphQLObjectType({
    name: 'spordersType',
    fields: {
        tostore: { type: orderItemListType },
        stored: { type: orderItemListType },
        tostartoff: { type: orderItemListType },
        onway: { type: orderItemListType },
        success: { type: orderItemListType },
    },
});

export default {
    type: spordersType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        shopId: {
            type: GraphQLID,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.sporders, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/account/bills.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { billItemListType } from '../../types/bill';
import { post, urls } from 'helpers/api';

const billsType = new GraphQLObjectType({
    name: 'billsType',
    fields: {
        recharge: { type: billItemListType },
        withdraw: { type: billItemListType },
        income: { type: billItemListType },
        pay: { type: billItemListType },
    },
});

export default {
    type: billsType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
        startDate: {
            type: GraphQLString,
        },
        endDate: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.bills, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/account/index.js

```js
export remainAmount from './remainAmount';
export weixinPayGetUnifiedOrder from './weixinPayGetUnifiedOrder';
export weixinPayWithDraw from './weixinPayWithDraw';
export bills from './bills';

```

* PDShop_Client_PC/project/App/server/graphql/queries/account/remainAmount.js

```js
import { authorize } from '../../authorize';
import { accountType } from '../../types/account';
import { post, urls } from 'helpers/api';

export default {
    type: accountType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.remainAmount, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/account/weixinPayGetUnifiedOrder.js

```js
import { authorize } from '../../authorize';
import { accountResultType, accountInputType } from '../../types/account';
import { post, urls } from 'helpers/api';

export default {
    type: accountResultType,
    args: {
        data: {
            type: accountInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.weixinPayGetUnifiedOrder, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/account/weixinPayWithDraw.js

```js
import { authorize } from '../../authorize';
import { accountResultType, accountInputType } from '../../types/account';
import { post, urls } from 'helpers/api';

export default {
    type: accountResultType,
    args: {
        data: {
            type: accountInputType,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.weixinPayWithDraw, params.data, root) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/agent.js

```js
import { authorize } from '../../authorize';
import { agentType } from '../../types/agent';
import { post, urls } from 'helpers/api';

export default {
    type: agentType,
    async resolve (root, params, options) {
        authorize(root);
        let agent = await post(urls.agent, params, root) || {};
        return agent.context || {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/getUserNameByPhone.js

```js
import {
    GraphQLString,
} from 'graphql';
import { personalInfoResultType } from '../../types/personal';
import { post, urls } from 'helpers/api';

export default {
    type: personalInfoResultType,
    args: {
        phone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.getUserNameByPhone, params) || {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/getVerifyCode.js

```js
import {
    GraphQLString,
} from 'graphql';
import { successType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: successType,
    args: {
        phone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        return await post(urls.getVerifyCode, params) || { msg: '服务器错误' };
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/index.js

```js
export session from './session';
export getVerifyCode from './getVerifyCode';
export login from './login';
export personal from './personal';
export shipper from './shipper';
export agent from './agent';
export getUserNameByPhone from './getUserNameByPhone';
export notify from './notify';
export statistics from './statistics';
export referShops from './referShops';

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/login.js

```js
import {
    GraphQLString,
} from 'graphql';
import passport from 'passport';
import { successType } from '../../types/common';

export default {
    type: successType,
    args: {
        phone: {
            type: GraphQLString,
        },
        password: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        return new Promise((resolve) => {
            const { req } = root;
            req.body = params;
            console.log('[login]: start', params);
            passport.authenticate('local', (err, user) => {
                console.log('[login]: authenticate', err, user);
                if (err) {
                    resolve({ msg: err.message });
                } else {
                    req.logIn(user, (error) => {
                        console.log('[login] logIn:', error);
                        if (error) {
                            resolve({ msg: '服务器错误' });
                        } else {
                            resolve({ success: true });
                        }
                    });
                }
            })(req);
        });
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/notify.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLString,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { post, urls } from 'helpers/api';

const newsType = new GraphQLObjectType({
    name: 'newsType',
    fields: {
        title: { type: GraphQLString },
        time: { type: GraphQLString },
        source: { type: GraphQLString },
    },
});

const newsListType = new GraphQLObjectType({
    name: 'newsListType',
    fields: {
        count: { type: GraphQLInt },
        list: { type: new GraphQLList(newsType) },
    },
});

const notifyType = new GraphQLObjectType({
    name: 'notifyType',
    fields: {
        news: { type: newsListType },
        publicity: { type: newsListType },
        policy: { type: newsListType },
        notice: { type: newsListType },
    },
});

export default {
    type: notifyType,
    args: {
        type: {
            type: GraphQLString,
        },
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.notify, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/personal.js

```js
import { authorize } from '../../authorize';
import { personalInfoType } from '../../types/personal';
import { post, urls } from 'helpers/api';

export default {
    type: personalInfoType,
    async resolve (root, params, options) {
        authorize(root);
        const personal = await post(urls.personal, params, root) || {};
        return personal.context || {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/referShops.js

```js
import {
    GraphQLString,
    GraphQLInt,
} from 'graphql';
import { authorize } from '../../authorize';
import { branchShopListType } from '../../types/shop';
import { post, urls } from 'helpers/api';

export default {
    type: branchShopListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let agent = await post(urls.getReferShopList, params, root) || {};
        return agent.context || {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/session.js

```js
import { GraphQLBoolean } from 'graphql';

export default {
    type: GraphQLBoolean,
    resolve (root) {
        return root.isAuthenticated;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/shipper.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { shipperType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperType,
    args: {
        shopId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let shipper = await post(urls.shipper, params, root) || {};
        return shipper.context || {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/personal/statistics.js

```js
import {
    GraphQLObjectType,
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { post, urls } from 'helpers/api';

const releaseCardInfoType = new GraphQLObjectType({
    name: 'releaseCardInfoType',
    fields: {
        today: { type: GraphQLInt },
        past: { type: GraphQLInt },
        remain: { type: GraphQLInt },
    },
});
const consumeInfoType = new GraphQLObjectType({
    name: 'consumeInfoType',
    fields: {
        today: { type: new GraphQLList(GraphQLInt) },
        week: { type: new GraphQLList(GraphQLInt) },
        month: { type: new GraphQLList(GraphQLInt) },
    },
});
const userSexInfoType = new GraphQLObjectType({
    name: 'userSexInfoType',
    fields: {
        male: { type: GraphQLInt },
        female: { type: GraphQLInt },
    },
});
const statisticsType = new GraphQLObjectType({
    name: 'statisticsType',
    fields: {
        releaseCardInfo: { type: releaseCardInfoType },
        consumeInfo: { type: consumeInfoType },
        userSexInfo: { type: userSexInfoType },
        userAgeInfo: { type: new GraphQLList(GraphQLInt) },
    },
});

export default {
    type: statisticsType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.statistics, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/regionRate/addressWithRegion.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderAddressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: orderAddressType,
    args: {
        regionId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.addressWithRegion, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/regionRate/index.js

```js
export regionRates from './regionRates';
export regionRate from './regionRate';
export addressWithRegion from './addressWithRegion';

```

* PDShop_Client_PC/project/App/server/graphql/queries/regionRate/regionRate.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { regionRateType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: regionRateType,
    args: {
        regionId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.getRegionProfitDetail, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/regionRate/regionRates.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { regionRateListType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: regionRateListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.getRegionProfitList, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/roadmap/index.js

```js
export roadmap from './roadmap';
export roadmaps from './roadmaps';

```

* PDShop_Client_PC/project/App/server/graphql/queries/roadmap/roadmap.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { roadmapType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapType,
    args: {
        roadmapId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        if (!params.roadmapId) {
            return undefined;
        }
        let ret = await post(urls.roadmap, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/roadmap/roadmaps.js

```js
import {
    GraphQLInt,
    GraphQLString,
    GraphQLID,
    GraphQLBoolean,
} from 'graphql';
import { authorize } from '../../authorize';
import { roadmapListType } from '../../types/roadmap';
import { post, urls } from 'helpers/api';

export default {
    type: roadmapListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        shopId: {
            type: GraphQLID,
        },
        isCityDistribute: {
            type: GraphQLBoolean,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.roadmaps, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/common/address.js

```js
import {
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { addressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(addressType),
    args: {
        parentCode: {
            type: GraphQLInt,
        },
        type: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.address, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/common/addressFromLastCode.js

```js
import {
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { addressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(new GraphQLList(addressType)),
    args: {
        addressLastCode: {
            type: GraphQLInt,
        },
        type: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.addressFromLastCode, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/common/index.js

```js
export address from './address';
export addressFromLastCode from './addressFromLastCode';
export sendDoorAddressFromLastCode from './sendDoorAddressFromLastCode';
export startPointAddress from './startPointAddress';
export startPointAddressFromLastCode from './startPointAddressFromLastCode';

```

* PDShop_Client_PC/project/App/server/graphql/queries/common/sendDoorAddressFromLastCode.js

```js
import {
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { addressType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(new GraphQLList(addressType)),
    args: {
        addressLastCode: {
            type: GraphQLInt,
        },
        parentCode: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.sendDoorAddressFromLastCode, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/common/startPointAddress.js

```js
import {
    GraphQLInt,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { startPointType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(startPointType),
    args: {
        parentCode: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.startPointAddress, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/common/startPointAddressFromLastCode.js

```js
import {
    GraphQLInt,
    GraphQLList,
    GraphQLBoolean,
} from 'graphql';
import { authorize } from '../../authorize';
import { startPointType } from '../../types/common';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(new GraphQLList(startPointType)),
    args: {
        addressLastCode: {
            type: GraphQLInt,
        },
        isLeaf: {
            type: GraphQLBoolean,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.startPointAddressFromLastCode, params, root) || {};
        return ret.success ? ret.context.addressList : [];
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/truck/carryPartments.js

```js
import {
    GraphQLID,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { carryPartmentType } from '../../types/shop';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(carryPartmentType),
    args: {
        truckId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.carryPartments, params, root) || {};
        return ret.success ? ret.context.partmenList : [];
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/truck/getDriverNameByPhone.js

```js
import {
    GraphQLString,
} from 'graphql';
import { driverType } from '../../types/truck';
import { post, urls } from 'helpers/api';

export default {
    type: driverType,
    args: {
        phone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        const ret = await post(urls.getDriverNameByPhone, params) || {};
        return ret.context;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/truck/index.js

```js
export truck from './truck';
export truckTypes from './truckTypes';
export trucks from './trucks';
export workTruckList from './workTruckList';
export getDriverNameByPhone from './getDriverNameByPhone';
export carryPartments from './carryPartments';
export orderListInTruck from './orderListInTruck';

```

* PDShop_Client_PC/project/App/server/graphql/queries/truck/orderListInTruck.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderListType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderListType,
    args: {
        truckId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.orderListInTruck, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/truck/truck.js

```js
import {
    GraphQLID,
} from 'graphql';
import { authorize } from '../../authorize';
import { truckType } from '../../types/truck';
import { post, urls } from 'helpers/api';

export default {
    type: truckType,
    args: {
        truckId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        if (!params.truckId) {
            return undefined;
        }
        let ret = await post(urls.truck, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/truck/truckTypes.js

```js
import {
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { truckTypeType } from '../../types/truck';
import { post, urls } from 'helpers/api';

export default {
    type: new GraphQLList(truckTypeType),
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.truckType, params, root) || {};
        return ret.success ? ret.context : [];
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/truck/trucks.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { trucksType } from '../../types/truck';
import { post, urls } from 'helpers/api';

export default {
    type: trucksType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        type: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.trucks, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/truck/workTruckList.js

```js
import {
    GraphQLInt,
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { truckItemListType } from '../../types/truck';
import { post, urls } from 'helpers/api';

export default {
    type: truckItemListType,
    args: {
        keyword: {
            type: GraphQLString,
        },
        type: {
            type: GraphQLString,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.workTruckList, params, root) || {};
        if (ret.success) {
            return {
                count: ret.context.count,
                list: ret.context.truckList,
            };
        }
        return undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/shared/helpers/api/index.js

```js
export urls from './urls';
export post from './post';

```

* PDShop_Client_PC/project/App/server/shared/helpers/api/post.js

```js
import request from 'superagent';

export default function doRequest (url, data, root) {
    return new Promise((resolve) => {
        if (root && root.user) {
            Object.assign(data, { userId: root.user.userId, fromPC: true });
        }
        const req = request
        .post(url)
        .set({
            'Content-Type': 'application/json',
            'Accept': 'application/json',
        })
        .send(data);

        req.end((error, res) => {
            if (error) {
                console.error('recv error[' + url + ']:', error);
                resolve();
            } else {
                console.log('recv[' + url + ']:', res.body);
                resolve(res.body);
            }
        });
    });
}

```

* PDShop_Client_PC/project/App/server/shared/helpers/api/urls.js

```js
const { apiServer } = require('../../../../../config.js');
const clientServer = apiServer + 'client/';
const shipperServer = apiServer + 'shipper/';
const agentServer = apiServer + 'agent/';

module.exports = {
    // common
    address: apiServer + 'getRegionAddress', // 获取地址列表
    addressFromLastCode: apiServer + 'getRegionAddressFromLastCode', // 通过最后一个code地址列表
    sendDoorAddressFromLastCode: apiServer + 'getRegionSendDoorAddressFromLastCode', // 通过最后一个code送货上门地址列表
    startPointAddress: apiServer + 'getStartPointAddress', // 获取始发地的地址列表
    startPointAddressFromLastCode: apiServer + 'getStartPointAddressFromLastCode', // 通过最后一个code获取始发地的地址列表

    // 个人中心
    getVerifyCode: apiServer + 'requestSendVerifyCode', // 请求发送验证码
    login: clientServer + 'login', // 登录
    register: clientServer + 'register', // 注册
    forgotPwd: clientServer + 'findPassword', // 忘记密码
    setPaymentPassword: clientServer + 'setPaymentPassword', // 设置支付密码
    modifyPassword: clientServer + 'modifyPassword', // 修改密码
    personal: clientServer + 'getPersonalInfo', // 获取个人信息
    modifyPersonalInfo: clientServer + 'modifyPersonalInfo', // 修改个人信息
    shipper: clientServer + 'getShipperInfo', // 获取物流公司信息
    modifyShipperInfo: clientServer + 'modifyShipperInfo', // 修改物流公司信息
    agent: clientServer + 'getAgentInfo', // 获取收货点信息
    modifyAgentInfo: clientServer + 'modifyAgentInfo', // 修改收货点信息
    getUserNameByPhone: clientServer + 'getUserNameByPhone', // 通过电话号码获取用户名
    feedback: clientServer + 'submitFeedback', // 意见反馈
    getReferShopList:agentServer + 'getReferShopList', // 收货点获取分店列表
    setReferShop:agentServer + 'setReferShop', // 收货点设置分店

    // 账目
    remainAmount: clientServer + 'getRemainAmount', // 获取余额
    weixinPayGetUnifiedOrder: clientServer + 'weixinPayGetUnifiedOrderForPC', // 统一下单
    weixinPayWithDraw: clientServer + 'withdraw', // 提现
    bills: clientServer + 'getBills', // 获取账单

    // 物流人员
    shipperMembers: shipperServer + 'getMemberList', // 获取人员列表
    shipperMember: shipperServer + 'getMemberDetail', // 获取人员详情
    getShipperMemberByPhone: shipperServer + 'getMemberByPhone', // 通过电话号码获取成员信息
    modifyShipperMemberAuthority: shipperServer + 'modifyMemberAuthority', // 修改人员权限

    // 同城配送物流公司获取同行上门自提行情
    getClientPickShipperList: shipperServer + 'getClientPickShipperList',

    // 收货点人员
    agentMembers: agentServer + 'getMemberList', // 获取人员列表
    agentMember: agentServer + 'getMemberDetail', // 获取人员详情
    getAgentMemberByPhone: agentServer + 'getMemberByPhone', // 通过电话号码获取成员信息
    modifyAgentMemberAuthority: agentServer + 'modifyMemberAuthority', // 修改人员权限

    // 路线
    roadmaps: shipperServer + 'getRoadmapList', // 获取路线列表
    roadmap: shipperServer + 'getRoadmapDetail', // 获取路线详情
    publishRoadmap: shipperServer + 'publishRoadmap', // 发布路线
    modifyRoadmap: shipperServer + 'modifyRoadmap', // 修改路线
    removeRoadmap: shipperServer + 'removeRoadmap', // 删除路线
    setRoadmapPrice: shipperServer + 'setRoadmapPrice', // 设置路线价格
    setRoadmapSendDoorPrice: shipperServer + 'setRoadmapSendDoorPrice', // 设置路线送货上门价格
    setRoadmapSendDoorBasePrice: shipperServer + 'setRoadmapSendDoorBasePrice', // 设置路线送货上门底价
    setRoadmapEnable: shipperServer + 'setRoadmapEnable', // 设置路线停运或恢复
    setRoadmapSendDoorEnable: shipperServer + 'setRoadmapSendDoorEnable', // 设置路线送货上门停运或恢复

    // 区域提成
    getRegionProfitList: agentServer + 'getRegionProfitList', // 收货点获取区域路线提成列表
    addRegionProfit: agentServer + 'addRegionProfit', // 收货点添加区域的路线提成
    removeRegionProfit: agentServer + 'removeRegionProfit', // 收货点删除区域的路线提成
    modifyRegionProfit: agentServer + 'modifyRegionProfit', // 收货点修改区域的路线提成
    getRegionProfitDetail: agentServer + 'getRegionProfitDetail', // 收货点获取区域的路线提成详情
    setRegionProfitWithList: agentServer + 'setRegionProfitWithList', // 批量设置区域的路线提成
    addressWithRegion: agentServer + 'getRegionAddressWithRegion', // 通过区域获取地址列表

    // 货单
    preOrders: clientServer + 'getPreOrderList', // 获取预下单列表
    preOrderGroups: clientServer + 'getPreOrderGroupList', // 获取预下单批次列表
    placePreOrder: clientServer + 'placePreOrder', // 预下单
    modifyPreOrder: clientServer + 'modifyPreOrder', // 修改预下单
    removePreOrder: clientServer + 'removePreOrder', // 删除预下单
    createPreOrderGroup: clientServer + 'createPreOrderGroup', // 创建预下单批次
    modifyPreOrderGroup: clientServer + 'modifyPreOrderGroup', // 修改预下单批次
    removePreOrderFromGroup: clientServer + 'removePreOrderFromGroup', // 移除预下单批次的货单
    inGroupPreOrders: clientServer + 'getPreOrderListInGroup', // 获取批次中的预下单列表
    lookGroupFee: clientServer + 'getRoadmapListWithPreOrderGroup', // 通过预下单批次获取收货点和分店路线列表
    lookFee: clientServer + 'getRoadmapListWithPreOrder', // 通过预下单获取收货点和分店路线列表
    sporders: shipperServer + 'getOrders', // 物流公司获取订单综合列表
    order: clientServer + 'getOrderDetail', // 获取订单详情
    sendOrders: clientServer + 'getSendOrders', // 获取发货订单
    receiveOrders: clientServer + 'getReceiveOrders', // 获取收货订单
    payForOrderWhenSend: clientServer + 'payForOrderWhenSend', // 支付货单

    // 收货部货单
    addressWithOrder: agentServer + 'getRegionAddressWithOrder', // 通过货单获取地址列表
    sendDoorAddressWithOrder: agentServer + 'getRegionSendDoorAddressWithOrder', // 通过货单获取送货上门地址列表
    rcorders: agentServer + 'getOrders', // 收货点获取货单综合列表
    rcorder: agentServer + 'getLastestOrder', // 获取收货点需要的货单
    placeClientOrder: agentServer + 'placeOrder', // 下初始货单
    placeClientOrderWithPreOrder: agentServer + 'placeOrderWithPreOrder', // 通过预下单下初始货单
    modifyClientOrder: agentServer + 'modifyOrder', // 修改初始货单
    removeClientOrder: agentServer + 'removeOrder', // 删除货单
    confirmCachPayed: agentServer + 'confirmCachPayed', // 待支付
    confirmCachPayedForOrderList: agentServer + 'confirmCachPayedForOrderList', // 待支付多个货单
    printOrderBill: agentServer + 'printOrderBill', // 打印收据
    printOrderListBill: agentServer + 'printOrderListBill', // 打印多个货单
    printBarCode: agentServer + 'printBarCode', // 打印二维码
    selectPreOrders: agentServer + 'getPreOrderList', // 收货部获取用户预下单列表

    // 行情
    lookRoadmap: clientServer + 'getRoadmapListWithEndPoint', // 查询行情路线

    // 竞得货物
    needSendOrders: shipperServer + 'getNeedSendOrderSummaryList', // 获取竞得货物汇总列表
    orderListByEndPoint: shipperServer + 'getNeedSendOrderListByEndPoint', // 通过到货地获取竞得货物汇总列表

    // 货车
    trucks: shipperServer + 'getTrucks', // 获取货车综合列表
    workTruckList: shipperServer + 'getWorkTruckList', // 获取工作状态的货车列表
    truck: shipperServer + 'getTruckDetail', // 获取货车详情
    createTruck: shipperServer + 'createTruck', // 创建货车
    modifyTruck: shipperServer + 'modifyTruck', // 修改货车
    removeTruck: shipperServer + 'removeTruck', // 删除货车
    getDriverNameByPhone: shipperServer + 'getDriverInfoByPhone', // 通过电话号码获取司机姓名
    truckType: shipperServer + 'getTruckType', // 通过电话号码获取司机姓名
    carryPartments: shipperServer + 'getCarryPartmentList', // 获取搬运队列表
    selectCarryPartment: shipperServer + 'selectCarryPartment', // 选择搬运队
    payforCarryPartment: shipperServer + 'payforCarryPartment', // 支付搬运队搬运费
    orderListInTruck: shipperServer + 'getOrderListInTruck', // 获取货车里面的订单
    setCityTruck: shipperServer + 'setCityTruck', // 设置同城配送的货车

    // 统计
    shipperStatistics: shipperServer + 'getStatistics', // 获取物流公司的统计数据

    // 客户
    getClientNameByPhone: apiServer + 'getClientNameByPhone', // 通过电话号码获取用户名

    // 其他
    statistics: apiServer + 'getStatistics', // 获取统计数据
    uploadFile: apiServer + 'uploadFile', // 上传文件
    notify: apiServer + 'notify', // 通知接口
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/statistic/index.js

```js
export shipperStatistics from './shipperStatistics';

```

* PDShop_Client_PC/project/App/server/graphql/queries/statistic/shipperStatistics.js

```js
import { authorize } from '../../authorize';
import { shipperStatisticType } from '../../types/statistic';
import { post, urls } from 'helpers/api';

export default {
    type: shipperStatisticType,
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.shipperStatistics, params, root) || {};
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/shared/pages/shared/utils/account.js

```js
export function getPayTool (str = '') {
    if (str === 'SIMULATION_NO') {
        return '模拟';
    }
    const options = {
        'A': '支付宝',
        'C': '财付通',
        'G': '工商银行',
        'J': '建设银行',
        'Z': '中国银行',
        'N': '农业银行',
    };
    const list = str.split('#');
    return options[list[0]];
}
export function getPayAccount (str = '') {
    if (str === 'SIMULATION_NO') {
        return 'SIMULATION_ACCOUNT';
    }
    const list = str.split('#');
    return list[2];
}
export function getPayBill (str = '') {
    if (str === 'SIMULATION_NO') {
        return 'SIMULATION_NO';
    }
    const list = str.split('#');
    return list[1];
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/utils/check.js

```js
import _ from 'lodash';

export function testTelePhone (phone) {
    return /^1\d{10}$/.test(phone);
}
export function testPhone (phone) {
    return /^(0\d{2}-?\d{8}(-?\d{1,4})?)|(0\d{3}-?\d{7,8}(-?\d{1,4})?)$/.test(phone);
}

export function checkTelePhone (rule, value, callback) {
    if (!testTelePhone(value)) {
        callback('请输入正确的手机号码');
    } else {
        callback();
    }
}
export function checkPhone (rule, value, callback) {
    if (!testPhone(value) && !testTelePhone(value)) {
        callback('请输入正确的电话号码');
    } else {
        callback();
    }
}

export function checkPhoneList (rule, value = '', callback) {
    const phoneList = _.reject(_.map(value.split(/;|；/), m => m.trim()), o => !o.length);
    if (phoneList.length && !_.every(phoneList, o => testPhone(o) || testTelePhone(o))) {
        callback('请输入正确的电话号码');
    } else {
        callback();
    }
}
export function checkEmail (rule, value, callback) {
    if (value && !/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(value)) {
        callback('请输入正确的邮箱地址');
    } else {
        callback();
    }
}
export function checkBankCard (rule, value, callback) {
    if (value && !/^(\d{16}|\d{19})$/.test(value)) {
        callback('请输入正确的银行卡卡号');
    } else {
        callback();
    }
}
export function checkVerifyCode (rule, value, callback) {
    if (value && !/^\d{6}$/.test(value)) {
        callback('请输入正确的验证码');
    } else {
        callback();
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/utils/common.js

```js
import _ from 'lodash';

export function _N (num, rank = 2) {
    typeof num !== 'number' && (num = 0);
    return parseFloat(num.toFixed(rank));
}
export function omitNil (obj) {
    return _.omitBy(obj, _.isNil);
}
export function needLoadPage (data, property, pageNo, pageSize) {
    const count = _.get(data, 'count');
    const list = _.get(data, property);
    const maxFullPage = Math.floor((count - 1) / pageSize);
    const maxDetectListSize = pageNo < maxFullPage ? pageSize : count - maxFullPage * pageSize;
    const detectList = _.slice(list, pageNo * pageSize, (pageNo + 1) * pageSize);
    let needLoad = true;
    if (detectList.length === maxDetectListSize) {
        needLoad = !_.every(detectList);
    }
    return needLoad;
}
export function until (test, iterator, callback) {
    if (!test()) {
        iterator((err) => {
            if (err) {
                return callback(err);
            }
            until(test, iterator, callback);
        });
    } else {
        callback();
    }
}
export function toThousands (num) {
    return (num || 0).toString().replace(/(\d)(?=(?:\d{3})+$)/g, '$1,');
}
export function getPercentages (list) {
    const sum = _.sum(list);
    return list.map((v) => Math.round(v * 100 / sum) + '%');
}
export function formatPhoneList (phoneList = '', phone = '') {
    phoneList = phone + ';' + phoneList.replace('；', ';');
    phoneList = _.uniq(_.filter(_.map(phoneList.split(';'), m => m.trim()), o => !!o));
    return phoneList.join(';');
}
export function getAddressOptions (list = [], lastCode, withTown) { // withTown为true，会一直选择到镇级和街道级
    let options;
    let value = [];
    for (const item of list) {
        const parent = _.find(item, o => o.code === lastCode) || {};
        parent.children = options;
        lastCode = parent.parentCode;
        parent.name && (value.unshift(parent.name));
        options = item.map(o => ({ value: o.name, label: o.name, code: o.code, level: o.level, isLeaf: !withTown ? o.isLeaf : o.level === 10, children: o.children }));
    }
    return {
        value,
        options: options || [],
    };
}
export function getStartPointOptions (list = [], lastCode, id) { // 如果始发地是分店或者收货点，则传id，否则不传，一旦传了id，lastCode则无效
    let options;
    let value = [];
    for (const item of list) {
        const parent = _.find(item, o => !id ? o.code === lastCode : o.id === id) || {};
        parent.children = options;
        lastCode = parent.isLeaf ? parent.addressRegionLastCode : parent.parentCode;
        (parent.id || parent.name) && (value.unshift(parent.id || parent.name));
        options = item.map(o => ({ value: o.id || o.name, label: o.name + (o.isShop ? '（分店）' : o.isAgent ? '（收货点）' : ''), code: o.code, level: o.level, isLeaf: o.isLeaf || false, isShop: o.isShop, isAgent: o.isAgent, children: o.children }));
        id = undefined;
    }
    return {
        value,
        options: options || [],
    };
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/utils/confirm.js

```js
import React from 'react';
import _ from 'lodash';
import { Modal, Input, notification } from 'antd';

export function confirm ({ pre, name, post = '' }, onOk) {
    Modal.confirm({
        title: '确认',
        content: (
            <div style={{ paddingTop: 10, fontSize: 14 }}>
                确定{pre}{name && <span style={{ color: 'red' }}>{name}</span>}{post}吗？
            </div>
        ),
        okText: '确定',
        cancelText: '取消',
        onOk,
    });
}
export function confirmWithPassword ({ pre, name, post = '', type = '登录' }, onOk) {
    let password = '';
    Modal.confirm({
        title: '确认',
        content: (
            <div style={{ paddingTop: 10, fontSize: 14 }}>
                {pre}{name && <span style={{ color: 'red' }}>{name}</span>}{post} 需要输入确认身份，请输入{type}密码。
                <Input style={{ marginTop: 10 }} placeholder={`请输入${type}密码`} maxLength={20}
                    type='password' autoComplete='off' onContextMenu={_.noop} onPaste={_.noop}
                    onCopy={_.noop} onCut={_.noop} onChange={(e) => {
                        password = e.target.value;
                    }} />
            </div>
        ),
        okText: '确定',
        cancelText: '取消',
        onOk: () => { onOk(password); },
    });
}
export function handleEditCancel () {
    Modal.confirm({
        title: '提示',
        content: (
            <div style={{ paddingTop: 10, fontSize: 14 }}>
                确定取消修改吗？
            </div>
        ),
        okText: '确定',
        cancelText: '取消',
        onOk: () => {
            this.setState({ pageData: _.cloneDeep(this.state.origin), editing: false });
        },
    });
}
export function showSuccess (info, title) {
    notification.success({ placement: 'bottomRight', key:'success', description: info, message: title });
}
export function showError (info, title) {
    notification.error({ placement: 'bottomRight', key:'error', description: info, message: title });
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/utils/index.js

```js
export * from './common';
export * from './check';
export * from './confirm';
export * from './account';
export * from './qrcode';

```

* PDShop_Client_PC/project/App/shared/pages/shared/utils/qrcode.js

```js
export function genQRString (id, type) {
    const str = JSON.stringify({ c: 's', t: type, d: id });
    let output = '';
    for (let x = 0, y = str.length, charCode, hexCode; x < y; ++x) {
        charCode = str.charCodeAt(x);
        if (charCode < 128) {
            charCode += 128;
        } else if (charCode > 127) {
            charCode -= 128;
        }
        charCode = 255 - charCode;
        hexCode = charCode.toString(16);
        if (hexCode.length < 2) {
            hexCode = '0' + hexCode;
        }
        output += hexCode;
    }
    return output;
}
export function getQRResult (str) {
    let output = '';
    for (let x = 0, y = str.length, charCode, hexCode; x < y; x += 2) {
        hexCode = str.substr(x, 2);
        charCode = parseInt(hexCode, 16);
        charCode = 255 - charCode;
        if (charCode < 128) {
            charCode += 128;
        } else if (charCode > 127) {
            charCode -= 128;
        }
        output += String.fromCharCode(charCode);
    }
    try {
        const result = JSON.parse(output);
        if (result.c !== 's') {
            return undefined;
        }
        return { type: result.t, id: result.d };
    } catch (e) {
        return undefined;
    }
}

```

* PDShop_Client_PC/project/App/server/graphql/queries/quotation/index.js

```js
export lookRoadmap from './lookRoadmap';

```

* PDShop_Client_PC/project/App/server/graphql/queries/quotation/lookRoadmap.js

```js
import {
    GraphQLID,
    GraphQLFloat,
    GraphQLInt,
    GraphQLBoolean,
    GraphQLList,
} from 'graphql';
import { authorize } from '../../authorize';
import { orderFeesType } from '../../types/order';
import { post, urls } from 'helpers/api';

export default {
    type: orderFeesType,
    args: {
        startPointLastCode: {
            type: GraphQLInt,
        },
        shopId: {
            type: GraphQLID,
        },
        agentId: {
            type: GraphQLID,
        },
        endPointLastCode: {
            type: GraphQLInt,
        },
        sendDoorEndPointLastCode: {
            type: GraphQLInt,
        },
        isSendDoor: {
            type: GraphQLBoolean,
        },
        location: {
            type: new GraphQLList(GraphQLFloat),
        },
        orderBy: {
            type: GraphQLInt,
        },
        pageNo: {
            type: GraphQLInt,
        },
        pageSize: {
            type: GraphQLInt,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        if (!params.startPointLastCode || !params.endPointLastCode) {
            return undefined;
        }
        let ret = await post(urls.lookRoadmap, params, root) || {};
        return ret.success ? ret.context : undefined;
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/client/getClientNameByPhone.js

```js
import {
    GraphQLString,
} from 'graphql';
import { authorize } from '../../authorize';
import { memberResultType } from '../../types/client';
import { post, urls } from 'helpers/api';

export default {
    type: memberResultType,
    args: {
        phone: {
            type: GraphQLString,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        return await post(urls.getClientNameByPhone, params, root) || {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/client/getClientPickShipperList.js

```js
import { GraphQLID } from 'graphql';
import { authorize } from '../../authorize';
import { shipperListType } from '../../types/shipper';
import { post, urls } from 'helpers/api';

export default {
    type: shipperListType,
    args: {
        shopId: {
            type: GraphQLID,
        },
    },
    async resolve (root, params, options) {
        authorize(root);
        let ret = await post(urls.getClientPickShipperList, params, root) || {};
        console.log('ret', ret);
        return ret.success ? ret.context : {};
    },
};

```

* PDShop_Client_PC/project/App/server/graphql/queries/client/index.js

```js
export getClientNameByPhone from './getClientNameByPhone';
export clientPickList from './getClientPickShipperList';

```

* PDShop_Client_PC/project/App/shared/pages/shared/components/index.js

```js
// form
export FromGroup from './form/FromGroup';
export PlainFormItem from './form/PlainFormItem';
export TextFormItem from './form/TextFormItem';
export NumberFormItem from './form/NumberFormItem';
export ButtonFormItem from './form/ButtonFormItem';
export SelectFormItem from './form/SelectFormItem';
export EditFormItem from './form/EditFormItem';
export TableFormItem from './form/TableFormItem';
export ImageFormItem from './form/ImageFormItem';
export ImageListFormItem from './form/ImageListFormItem';
export LocateFormItem from './form/LocateFormItem';
export ChildFormItem from './form/ChildFormItem';
export DateFormItem from './form/DateFormItem';
export SizeFormItem from './form/SizeFormItem';
export CheckFormItem from './form/CheckFormItem';
export RadioFormItem from './form/RadioFormItem';
export AddressFormItem from './form/AddressFormItem';
export StartPointFormItem from './form/StartPointFormItem';
export PriceFormItem from './form/PriceFormItem';

// button
export DetailDeleteButton from './button/DetailDeleteButton';

// title
export TableContainer from './layout/TableContainer';
export DetailContainer from './layout/DetailContainer';

// table
export PlainTable from './table/PlainTable';
export TabsTable from './table/TabsTable';

// config
export * from './form/config';

```

* PDShop_Client_PC/project/App/shared/pages/auth/pages/forgotPwd/index.js

```js
import React from 'react';
import { connect } from 'react-redux';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import ForgotPwd from './contents';

@connect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
)
export default class ForgotPwdContainer extends React.Component {
    render () {
        return (
            <ForgotPwd {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/auth/pages/login/index.js

```js
import { connect } from 'react-redux';
import React from 'react';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import Login from './contents';

@connect(
    (state) => ({ phone: state.router.location.state ? state.router.location.state.phone : '' }),
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
)
export default class LoginContainer extends React.Component {
    render () {
        return (
            <Login {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/auth/pages/register/index.js

```js
import React from 'react';
import { connect } from 'react-redux';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';

import Register from './contents';

@connect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
)
export default class RegisterContainer extends React.Component {
    render () {
        return (
            <Register {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/feedback/index.js

```js
import React from 'react';
import { connect } from 'react-redux';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import Feedback from './contents';

@connect(
    null,
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
)
export default class FeedbackContainer extends React.Component {
    render () {
        return (
            <Feedback {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/home/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import Home from './contents';

@dataConnect(
    (state) => ({}),
    null,
    (props) => ({
        fragments: Home.fragments,
    })
)
export default class HomeContainer extends React.Component {
    refreshHome () {
        const { relate } = this.props;
        relate.refresh({
            property: 'personal',
        });
    }
    render () {
        return (
            <Home {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/agentMembers/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as memberActions from 'actions/members';
import { needLoadPage, showError } from 'utils';
import Members from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(memberActions, dispatch),
    }),
    (props) => ({
        fragments: Members.fragments,
        variablesTypes: {
            agentMembers: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            agentMembers: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class MembersContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                agentMembers: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.members) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, members } = this.props;
        const property = 'memberList';
        if (needLoadPage(members, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    agentMembers: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Members {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/notify/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import { needLoadPage } from 'utils';
import * as personalActions from 'actions/personals';
import Notify from './contents';

@dataConnect(
    (state) => {
        const { activeType } = state.router.location.state || { activeType: 'news' };
        return {
            activeType,
            pageSize: 20,
        };
    },
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    }),
    (props) => ({
        fragments: Notify.fragments,
        variablesTypes: {
            notify: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            notify: {
                pageNo: 0,
                pageSize: props.pageSize,
                type: '',
                keyword: '',
            },
        },
    })
)
export default class NotifyContainer extends React.Component {
    getNotify (keyword = '') {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                notify: {
                    pageNo: 0,
                    pageSize,
                    type: '',
                    keyword,
                },
            },
        });
    }
    loadListPage (keyword = '', type, pageNo) {
        const { relate, pageSize, notify } = this.props;
        if (needLoadPage(notify[type], pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    notify: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <Notify {...this.props}
                getNotify={::this.getNotify}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/orderDetail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import OrderDetail from './contents';

@dataConnect(
    (state) => {
        const { orderId } = state.router.location.state || state.router.location.query;
        return { orderId, keepLastKeepData: true };
    },
    null,
    (props) => {
        return {
            fragments: OrderDetail.fragments,
            variablesTypes: {
                order: {
                    orderId: 'ID!',
                },
            },
            initialVariables: {
                order: {
                    orderId: props.orderId,
                },
            },
        };
    }
)
export default class OrderDetailContainer extends React.Component {
    render () {
        return (
            <OrderDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/personal/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import * as accountActions from 'actions/accounts';
import * as trucksActions from 'actions/trucks';
import Personal from './contents';

@dataConnect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators({ ...personalActions, ...accountActions, ...trucksActions }, dispatch),
    }),
    (props) => ({
        fragments: Personal.fragments,
    })
)
export default class PersonalContainer extends React.Component {
    refreshRemainAmount () {
        const { relate } = this.props;
        relate.refresh({
            property: 'remainAmount',
        });
    }
    render () {
        return (
            <Personal {...this.props} refreshRemainAmount={::this.refreshRemainAmount} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/bills/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage, showError } from 'utils';
import Bills from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: Bills.fragments,
        variablesTypes: {
            bills: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            bills: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class BillsContainer extends React.Component {
    refresh (keyword, startDate, endDate) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                bills: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.bills) {
                    showError('没有相关账单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, startDate, endDate) {
        const { relate, pageSize, bills } = this.props;
        if (needLoadPage(bills[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    bills: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        startDate,
                        endDate,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <Bills {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/needSendOrders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import NeedSendOrders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    null,
    (props) => ({
        fragments: NeedSendOrders.fragments,
        variablesTypes: {
            needSendOrders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String',
                shopId: 'ID!',
            },
        },
        initialVariables: {
            needSendOrders: {
                pageNo: 0,
                pageSize: props.pageSize,
                shopId: props.rootShop.id,
            },
        },
    })
)
export default class NeedSendOrdersContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize, rootShop } = this.props;
        relate.refresh({
            variables: {
                needSendOrders: {
                    pageNo: 0,
                    pageSize,
                    shopId: rootShop.id,
                    keyword,
                },
            },
            callback (data) {
                if (!data.needSendOrders) {
                    showError('没有相关货单信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, needSendOrders, rootShop } = this.props;
        const property = 'orderList';
        if (needLoadPage(needSendOrders, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    needSendOrders: {
                        pageNo,
                        pageSize,
                        keyword,
                        shopId: rootShop.id,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <NeedSendOrders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/quotations/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import Quotations from './contents';

@dataConnect(
    (state) => ({
        pageSize: 20,
        location: [106.6886, 26.566621],
        orderBy: 0,
    }),
    null,
    (props) => ({
        fragments: Quotations.fragments,
        variablesTypes: {
            lookRoadmap: {
                startPointLastCode: 'Int',
                shopId: 'ID',
                agentId: 'ID',
                endPointLastCode: 'Int',
                sendDoorEndPointLastCode: 'Int',
                isSendDoor: 'Boolean',
                location: '[Float]!',
                orderBy: 'Int!',
                pageNo: 'Int!',
                pageSize: 'Int!',
            },
            startPointAddressFromLastCode: {
                addressLastCode: 'Int',
                isLeaf: 'Boolean',
            },
            addressFromLastCode: {
                addressLastCode: 'Int',
            },
        },
        initialVariables: {
            lookRoadmap: {
                location: props.location,
                orderBy: props.orderBy,
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class QuotationsContainer extends React.Component {
    refresh (startPointLastCode, shopId, agentId, endPointLastCode, sendDoorEndPointLastCode, isSendDoor, location, orderBy) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                lookRoadmap: {
                    startPointLastCode,
                    shopId,
                    agentId,
                    endPointLastCode,
                    sendDoorEndPointLastCode,
                    isSendDoor,
                    location,
                    orderBy,
                    pageNo: 0,
                    pageSize,
                },
            },
            callback (data) {
                if (!data.lookRoadmap) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (startPointLastCode, shopId, endPointLastCode, sendDoorEndPointLastCode, isSendDoor, location, orderBy, type, pageNo) {
        const { relate, pageSize, lookRoadmap } = this.props;
        if (needLoadPage(lookRoadmap[type], 'roadmapList', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    lookRoadmap: {
                        startPointLastCode,
                        shopId,
                        endPointLastCode,
                        sendDoorEndPointLastCode,
                        isSendDoor,
                        location,
                        orderBy,
                        pageNo,
                        pageSize,
                    },
                },
                property: type + '.roadmapList',
            });
        }
    }
    render () {
        return (
            <Quotations {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/placeOrder/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/agentOrders';
import * as clientActions from 'actions/clients';
import PlaceOrder from './contents';

@dataConnect(
    null,
    (dispatch) => ({
        actions : bindActionCreators({ ...orderActions, ...clientActions }, dispatch),
    }),
    (props) => {
        return {
            fragments: PlaceOrder.fragments,
        };
    }
)
export default class PlaceOrderContainer extends React.Component {
    refresh () {
        const { relate } = this.props;
        relate.refresh({
            property: ['rcorder', 'addressWithOrder', 'sendDoorAddressWithOrder'],
        });
    }
    render () {
        return (
            <PlaceOrder {...this.props} refresh={::this.refresh} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/rcorders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/agentOrders';
import { needLoadPage, showError } from 'utils';
import RCOrders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: RCOrders.fragments,
        variablesTypes: {
            rcorders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            rcorders: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class RCOrdersContainer extends React.Component {
    refresh (keyword, startDate, endDate) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                rcorders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.rcorders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, startDate, endDate) {
        const { relate, pageSize, rcorders } = this.props;
        if (needLoadPage(rcorders[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    rcorders: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        startDate,
                        endDate,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <RCOrders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/roadmaps/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import { needLoadPage, showError } from 'utils';
import Roadmaps from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => ({
        fragments: Roadmaps.fragments,
        variablesTypes: {
            roadmaps: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String',
                shopId: 'ID!',
            },
        },
        initialVariables: {
            roadmaps: {
                pageNo: 0,
                pageSize: props.pageSize,
                shopId: props.rootShop.id,
            },
        },
    })
)
export default class RoadmapsContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize, rootShop } = this.props;
        relate.refresh({
            variables: {
                roadmaps: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    shopId: rootShop.id,
                },
            },
            callback (data) {
                if (!data.roadmaps) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, roadmaps, rootShop } = this.props;
        const property = 'roadmapList';
        if (needLoadPage(roadmaps, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    roadmaps: {
                        pageNo,
                        pageSize,
                        keyword,
                        shopId: rootShop.id,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Roadmaps {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/regionRates/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import { needLoadPage, showError } from 'utils';
import RegionRates from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => ({
        fragments: RegionRates.fragments,
        variablesTypes: {
            regionRates: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String',
            },

        },
        initialVariables: {
            regionRates: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },

    })
)
export default class RegionRatesContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                regionRates: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.regionRates) {
                    showError('没有相关方向的设置');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, regionRates } = this.props;
        const property = 'list';
        if (needLoadPage(regionRates, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    regionRates: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <RegionRates {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/sendDoorRoadmaps/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import { needLoadPage, showError } from 'utils';
import SendDoorRoadmaps from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => ({
        fragments: SendDoorRoadmaps.fragments,
        variablesTypes: {
            roadmaps: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String',
                shopId: 'ID!',
                isCityDistribute: 'Boolean',
            },
        },
        initialVariables: {
            roadmaps: {
                pageNo: 0,
                pageSize: props.pageSize,
                shopId: props.rootShop.id,
                isCityDistribute: true,
            },
        },
    })
)
export default class SendDoorRoadmapsContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize, rootShop } = this.props;
        relate.refresh({
            variables: {
                roadmaps: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    shopId: rootShop.id,
                    isCityDistribute: true,
                },
            },
            callback (data) {
                if (!data.roadmaps) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, roadmaps, rootShop } = this.props;
        const property = 'roadmapList';
        if (needLoadPage(roadmaps, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    roadmaps: {
                        pageNo,
                        pageSize,
                        keyword,
                        shopId: rootShop.id,
                        isCityDistribute: true,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SendDoorRoadmaps {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/shipperMembers/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as memberActions from 'actions/members';
import { needLoadPage, showError } from 'utils';
import Members from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(memberActions, dispatch),
    }),
    (props) => ({
        fragments: Members.fragments,
        variablesTypes: {
            shipperMembers: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            shipperMembers: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class MembersContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                shipperMembers: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.members) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, members } = this.props;
        const property = 'memberList';
        if (needLoadPage(members, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    shipperMembers: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <Members {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/sporders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SPOrders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    null,
    (props) => ({
        fragments: SPOrders.fragments,
        variablesTypes: {
            sporders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                shopId: 'ID!',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            sporders: {
                pageNo: 0,
                pageSize: props.pageSize,
                shopId: props.rootShop.id,
            },
        },
    })
)
export default class SPOrdersContainer extends React.Component {
    refresh (keyword, startDate, endDate) {
        const { relate, pageSize, rootShop } = this.props;
        relate.refresh({
            variables: {
                sporders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    shopId: rootShop.id,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.sporders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, startDate, endDate) {
        const { relate, pageSize, sporders, rootShop } = this.props;
        if (needLoadPage(sporders[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    sporders: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        shopId: rootShop.id,
                        startDate,
                        endDate,
                    },
                },
                property: type + '.list',
            });
        }
    }
    render () {
        return (
            <SPOrders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/statistics/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import Statistics from './contents';

@dataConnect(
    null,
    null,
    (props) => ({
        fragments: Statistics.fragments,
    })
)
export default class StatisticsContainer extends React.Component {
    refresh (shopId) {
        const { relate } = this.props;
        relate.refresh({
            property: 'shipperStatistics',
        });
    }
    render () {
        return (
            <Statistics {...this.props} refresh={::this.refresh} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/receiveOrders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage, showError } from 'utils';
import Orders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: Orders.fragments,
        variablesTypes: {
            receiveOrders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            receiveOrders: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class OrdersContainer extends React.Component {
    refresh (keyword, startDate, endDate) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                receiveOrders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.receiveOrders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, startDate, endDate) {
        const { relate, pageSize, receiveOrders } = this.props;
        if (needLoadPage(receiveOrders[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    sendOrders: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        startDate,
                        endDate,
                    },
                },
                property: type + 'list',
            });
        }
    }
    render () {
        return (
            <Orders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/sendOrders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage, showError } from 'utils';
import Orders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20 }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: Orders.fragments,
        variablesTypes: {
            sendOrders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                senderId: 'ID!',
                type: 'String',
                keyword: 'String',
                startDate: 'String',
                endDate: 'String',
            },
        },
        initialVariables: {
            sendOrders: {
                pageNo: 0,
                pageSize: props.pageSize,
                senderId: props.rootPersonal.userId,
            },
        },
    })
)
export default class OrdersContainer extends React.Component {
    refresh (keyword, startDate, endDate) {
        const { relate, pageSize, rootPersonal } = this.props;
        relate.refresh({
            variables: {
                sendOrders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    senderId: rootPersonal.userId,
                    startDate,
                    endDate,
                },
            },
            callback (data) {
                if (!data.sendOrders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo, startDate, endDate) {
        const { relate, pageSize, sendOrders, rootPersonal } = this.props;
        if (needLoadPage(sendOrders[type], 'list', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    sendOrders: {
                        pageNo,
                        pageSize,
                        type,
                        keyword,
                        senderId: rootPersonal.userId,
                        startDate,
                        endDate,
                    },
                },
                property: type + 'list',
            });
        }
    }
    render () {
        return (
            <Orders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/pages/SelectPreOrder/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectPreOrder from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectPreOrder.fragments,
        variablesTypes: {
            selectPreOrders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                senderPhone: 'ID!',
                keyword: 'String',
            },
        },
        initialVariables: {
            selectPreOrders: {
                pageNo: 0,
                pageSize: props.pageSize,
                senderPhone: props.senderPhone,
            },
        },
    })
)
export default class SelectPreOrderContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize, senderPhone } = this.props;
        relate.refresh({
            variables: {
                selectPreOrders: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                    senderPhone,
                },
            },
            callback (data) {
                if (!data.selectPreOrders) {
                    showError('没有相关货单');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, selectPreOrders, senderPhone } = this.props;
        const property = 'orderList';
        if (needLoadPage(selectPreOrders, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    selectPreOrders: {
                        pageNo,
                        pageSize,
                        keyword,
                        senderPhone,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SelectPreOrder {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/pages/SelectTruck/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectTruck from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectTruck.fragments,
        variablesTypes: {
            trucks: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            trucks: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class SelectTruckContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                trucks: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.trucks) {
                    showError('没有相关路线');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, trucks } = this.props;
        const property = 'truckList';
        if (needLoadPage(trucks, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    trucks: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <SelectTruck {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/pages/ShowClientPicker/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import ShowClientPicker from './contents';

@dataConnect(
    (state) => ({ keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: ShowClientPicker.fragments,
        variablesTypes: {
            clientPickList: {
                shopId: 'ID!',
            },
        },
        initialVariables: {
            clientPickList: {
                shopId: props.shopId,
            },
        },
    })
)
export default class ShowClientPickerContainer extends React.Component {
    refresh () {
        const { relate, shopId } = this.props;
        relate.refresh({
            variables: {
                clientPickList: {
                    shopId,
                },
            },
            callback (data) {
                if (!data.clientPickList) {
                    showError(data.msg);
                }
            },
        });
    }
    loadListPage () {
        const { relate, clientPickList, shopId } = this.props;
        const property = 'clientPickList';
        if (needLoadPage(clientPickList)) {
            relate.loadPage({
                variables: {
                    clientPickList: {
                        shopId,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <ShowClientPicker {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/trucks/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as truckActions from 'actions/trucks';
import { needLoadPage, showError } from 'utils';
import Trucks from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepData: true }),
    (dispatch) => ({
        actions : bindActionCreators(truckActions, dispatch),
    }),
    (props) => ({
        fragments: Trucks.fragments,
        variablesTypes: {
            trucks: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                type: 'String',
                keyword: 'String',
            },
            workTruckList: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String',
            },
        },
        initialVariables: {
            trucks: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
            workTruckList: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class TrucksContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                trucks: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
                workTruckList: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.trucks) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, type, pageNo) {
        const { relate, pageSize, trucks, workTruckList } = this.props;
        if (type === 'tosend') {
            if (needLoadPage(workTruckList, 'list', pageNo, pageSize)) {
                relate.loadPage({
                    variables: {
                        workTruckList: {
                            pageNo,
                            pageSize,
                            keyword,
                        },
                    },
                    property: 'list',
                });
            }
        } else {
            if (needLoadPage(trucks[type], 'list', pageNo, pageSize)) {
                relate.loadPage({
                    variables: {
                        trucks: {
                            pageNo,
                            pageSize,
                            type,
                            keyword,
                        },
                    },
                    property: type + '.list',
                });
            }
        }
    }
    render () {
        return (
            <Trucks {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/pages/SelectReferShop/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage, showError } from 'utils';
import SelectReferShop from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepLastKeepData: true }),
    null,
    (props) => ({
        fragments: SelectReferShop.fragments,
        variablesTypes: {
            referShops: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                keyword: 'String!',
            },
        },
        initialVariables: {
            referShops: {
                pageNo: 0,
                pageSize: props.pageSize,
                keyword: '',
            },
        },
    })
)
export default class SelectReferShopContainer extends React.Component {
    refresh (keyword) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                referShops: {
                    pageNo: 0,
                    pageSize,
                    keyword,
                },
            },
            callback (data) {
                if (!data.referShops) {
                    showError('没有相关分店');
                }
            },
        });
    }

    loadListPage (keyword, pageNo) {
        const { relate, pageSize, referShopList } = this.props;
        const property = 'referShops';
        if (needLoadPage(referShopList, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    referShopList: {
                        pageNo,
                        pageSize,
                        keyword,
                    },
                },
                property,
            });
        }
    }

    render () {
        return (
            <SelectReferShop {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/preOrders/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage, showError } from 'utils';
import PreOrders from './contents';

@dataConnect(
    (state) => ({ pageSize: 20, keepData: true }),
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: PreOrders.fragments,
        variablesTypes: {
            preOrders: {
                pageNo: 'Int!',
                pageSize: 'Int!',
            },
        },
        initialVariables: {
            preOrders: {
                pageNo: 0,
                pageSize: props.pageSize,
            },
        },
    })
)
export default class PreOrdersContainer extends React.Component {
    refresh () {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                preOrders: {
                    pageNo: 0,
                    pageSize,
                },
            },
            property: 'preOrderGroups',
            callback (data) {
                if (!data.preOrders) {
                    showError('没有相关货车信息');
                }
            },
        });
    }
    loadListPage (keyword, pageNo) {
        const { relate, pageSize, preOrders } = this.props;
        const property = 'preOrderList';
        if (needLoadPage(preOrders, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    preOrders: {
                        pageNo,
                        pageSize,
                    },
                },
                property,
            });
        }
    }
    render () {
        return <PreOrders {...this.props} refresh={::this.refresh} loadListPage={::this.loadListPage} />;
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/components/form/config.js

```js
export function getFormItemLayout (layout, formGroup, hasOffset) {
    if (formGroup) {
        return {};
    }
    return {
        labelCol: { span: layout && layout[0] ? layout[0] : 4 },
        wrapperCol: { span: layout ? (layout[1] ? layout[1] : 16 - layout[0]) : 12, offset: hasOffset ? (layout && layout[0] ? layout[0] : 4) : 0 },
    };
}
export function getDefaultRules (label, required, rules = [], word = '填写') {
    const defaultRules = required ? [{ required, message: `请${word}${label}` }] : [];
    return [ ...defaultRules, ...rules ];
}
export function isNullValue (value) {
    if (!value) {
        if (value === 0) {
            return false;
        }
        return true;
    }
    return false;
}

```

* PDShop_Client_PC/project/App/shared/pages/shared/components/table/config.js

```js
import React from 'react';
import { _N } from 'utils';
import _ from 'lodash';
import styles from './index.less';

export function fixColumns (columns) {
    columns = _.cloneDeep(columns);
    return columns.map((o) => {
        let unitRender;
        if (o.unit) {
            unitRender = (data = 0, record, index) => <span>{ _N(o.value ? o.value(data, record, index) : data) }<span className={styles.unit}>{_.isFunction(o.unit) ? o.unit(data, record, index) : o.unit}</span></span>;
        }

        let valuesRender;
        if (o.values) {
            valuesRender = (data, record, index) => {
                const values = _.reject(o.values(data, record, index), k => _.isNil(k));
                if (values[1]) {
                    return <div className={styles.baseValueContainer}><span>{values[0]}</span><span className={styles.baseValue}>{values[1]}</span></div>;
                }
                return <span>{values[0]}</span>;
            };
        }
        if (!o.render) {
            o.render = (data, record, index) => {
                if (valuesRender) {
                    data = valuesRender(data, record, index);
                } else if (unitRender) {
                    data = unitRender(data, record, index);
                } else if (o.value) {
                    data = o.value(data, record, index);
                } else if (_.isNil(data)) {
                    data = '无';
                }
                return data;
            };
        } else {
            const render = o.render;
            o.render = (data, record, index) => {
                data = render(data, record, index);
                if (o.unit) {
                    data = <span>{data}<span className={styles.unit}>{_.isFunction(o.unit) ? o.unit(data, record, index) : o.unit}</span></span>;
                }
                return data;
            };
        }

        if (o.totalUnit) {
            const title = o.title;
            o.title = <span>{title}<span className={styles.unit}>({o.totalUnit})</span></span>;
            delete o.totalUnit;
        }
        return o;
    });
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/agentMembers/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as memberActions from 'actions/members';
import MemberDetail from './contents';

@dataConnect(
    (state) => {
        const { memberId, record, agentMembers } = state.router.location.state || state.router.location.query;
        return { memberId, record, agentMembers, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(memberActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.member || !props.memberId,
            fragments: MemberDetail.fragments,
            variablesTypes: {
                agentMember: {
                    memberId: 'ID!',
                },
            },
            initialVariables: {
                agentMember: {
                    memberId: props.memberId,
                },
            },
        };
    }
)
export default class MemberDetailContainer extends React.Component {
    render () {
        return (
            <MemberDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/agentMembers/pages/register/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as memberActions from 'actions/members';
import MemberRegister from './contents';

@dataConnect(
    (state) => {
        const { agentMembers } = state.router.location.state || state.router.location.query;
        return { agentMembers, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions: bindActionCreators(memberActions, dispatch),
    }),
)
export default class MemberRegisterContainer extends React.Component {
    render () {
        return (
            <MemberRegister {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/roadmaps/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import RoadmapDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, endPointLastCode, roadmapId, record, fromChild, roadmaps } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, roadmapId, endPointLastCode, record, fromChild, roadmaps, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => {
        return {
            fragments: RoadmapDetail.fragments,
            variablesTypes: {
                roadmap: {
                    roadmapId: 'ID',
                },
                addressFromLastCode: {
                    addressLastCode: 'Int',
                },
            },
            initialVariables: {
                roadmap: {
                    roadmapId: props.roadmapId,
                },
                addressFromLastCode: {
                    addressLastCode: props.endPointLastCode,
                },
            },
            mutations: {
                modifyRoadmap ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeRoadmap ({ state, data, _ }) {
                    if (data.success) {
                        props.roadmaps.count--;
                        _.remove(props.roadmaps.roadmapList, (item) => item.id === props.roadmapId);
                    }
                },
            },
        };
    }
)
export default class RoadmapDetailContainer extends React.Component {
    render () {
        return (
            <RoadmapDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/roadmaps/pages/sendDoorList/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import SendDoorLists from './contents';

@dataConnect(
    (state) => {
        const { record, endPointLastCode, roadmaps } = state.router.location.state || state.router.location.query;
        return { record, endPointLastCode, roadmaps, pageSize: 20, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
)
export default class SendDoorListsContainer extends React.Component {
    render () {
        return (
            <SendDoorLists {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/regionRates/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import RegionRateDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, regionLastCode, regionType, regionId, record, regionRates } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, regionLastCode, regionType, regionId, record, regionRates, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => {
        return {
            fragments: RegionRateDetail.fragments,
            variablesTypes: {
                regionRate: {
                    regionId: 'ID',
                },
                addressWithRegion: {
                    regionId: 'ID',
                },
            },
            initialVariables: {
                regionRate: {
                    regionId: props.regionId,
                },
                addressWithRegion: {
                    regionId: props.regionId,
                },
            },
            mutations: {
                modifyRegionProfit ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeRegionProfit ({ state, data, _ }) {
                    if (data.success) {
                        props.regionRates.count--;
                        _.remove(props.regionRates.regionRateList, (item) => item.id === props.regionId);
                    }
                },
            },
        };
    }
)
export default class RegionRateDetailContainer extends React.Component {
    render () {
        return (
            <RegionRateDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/sendDoorRoadmaps/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as roadmapActions from 'actions/roadmaps';
import SendDoorRoadmapDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, endPointLastCode, roadmapId, record, roadmaps } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, roadmapId, endPointLastCode, record, roadmaps, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(roadmapActions, dispatch),
    }),
    (props) => {
        return {
            fragments: SendDoorRoadmapDetail.fragments,
            variablesTypes: {
                roadmap: {
                    roadmapId: 'ID',
                },
                sendDoorAddressFromLastCode: {
                    addressLastCode: 'Int',
                    parentCode: 'Int',
                },
            },
            initialVariables: {
                roadmap: {
                    roadmapId: props.roadmapId,
                },
                sendDoorAddressFromLastCode: {
                    addressLastCode: props.endPointLastCode,
                    parentCode: props.rootShop.addressRegionLastCode,
                },
            },
            mutations: {
                modifyRoadmap ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeRoadmap ({ state, data, _ }) {
                    if (data.success) {
                        props.roadmaps.count--;
                        _.remove(props.roadmaps.roadmapList, (item) => item.id === props.roadmapId);
                    }
                },
            },
        };
    }
)
export default class SendDoorRoadmapDetailContainer extends React.Component {
    render () {
        return (
            <SendDoorRoadmapDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/shipperMembers/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as memberActions from 'actions/members';
import MemberDetail from './contents';

@dataConnect(
    (state) => {
        const { memberId, record, members } = state.router.location.state || state.router.location.query;
        return { memberId, record, members, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(memberActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.member || !props.memberId,
            fragments: MemberDetail.fragments,
            variablesTypes: {
                shipperMember: {
                    memberId: 'ID!',
                },
            },
            initialVariables: {
                shipperMember: {
                    memberId: props.memberId,
                },
            },
        };
    }
)
export default class MemberDetailContainer extends React.Component {
    render () {
        return (
            <MemberDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/shipperMembers/pages/register/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as memberActions from 'actions/members';
import MemberRegister from './contents';

@dataConnect(
    (state) => {
        const { shipperMembers } = state.router.location.state || state.router.location.query;
        return { shipperMembers, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(memberActions, dispatch),
    }),
)
export default class MemberRegisterContainer extends React.Component {
    render () {
        return (
            <MemberRegister {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/rcorders/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/agentOrders';
import RCOrderDetail from './contents';

@dataConnect(
    (state) => {
        const { orderId, record, rcorders, activeType } = state.router.location.state || state.router.location.query;
        return { orderId, record, rcorders, activeType, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => {
        return {
            manualLoad: !!props.order || !props.orderId,
            fragments: RCOrderDetail.fragments,
            variablesTypes: {
                order: {
                    orderId: 'ID!',
                },
                addressWithOrder: {
                    orderId: 'ID!',
                },
                sendDoorAddressWithOrder: {
                    orderId: 'ID!',
                },
            },
            initialVariables: {
                order: {
                    orderId: props.orderId,
                },
                addressWithOrder: {
                    orderId: props.orderId,
                },
                sendDoorAddressWithOrder: {
                    orderId: props.orderId,
                },
            },
        };
    }
)
export default class RCOrderDetailContainer extends React.Component {
    refresh () {
        const { relate, orderId } = this.props;
        relate.refresh({
            variables: {
                order: {
                    orderId,
                },
                addressWithOrder: {
                    orderId,
                },
                sendDoorAddressWithOrder: {
                    orderId,
                },
            },
        });
    }
    render () {
        return (
            <RCOrderDetail {...this.props} refresh={::this.refresh} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/trucks/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as truckActions from 'actions/trucks';
import TruckDetail from './contents';

@dataConnect(
    (state) => {
        const { operType, truckId, record, trucks, workTruckList } = state.router.location.state || state.router.location.query;
        return { operType: operType * 1, truckId, record, trucks, workTruckList, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(truckActions, dispatch),
    }),
    (props) => {
        return {
            fragments: TruckDetail.fragments,
            variablesTypes: {
                truck: {
                    truckId: 'ID',
                },
            },
            initialVariables: {
                truck: {
                    truckId: props.truckId,
                },
            },
            mutations: {
                modifyTruck ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removeTruck ({ state, data, _ }) {
                    if (data.success) {
                        props.workTruckList.count--;
                        _.remove(props.workTruckList.list, (item) => item.id === props.truckId);
                    }
                },
            },
        };
    }
)
export default class TruckDetailContainer extends React.Component {
    render () {
        return (
            <TruckDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/needSendOrders/pages/orderListByEndpoint/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { needLoadPage } from 'utils';
import OrderListByEndPoint from './contents';

@dataConnect(
    (state) => {
        const { endPoint } = state.router.location.state || state.router.location.query;
        return { endPoint, pageSize: 20, keepLastKeepData: true };
    },
    null,
    (props) => ({
        fragments: OrderListByEndPoint.fragments,
        variablesTypes: {
            orderListByEndPoint: {
                pageNo: 'Int!',
                pageSize: 'Int!',
                endPoint: 'String!',
                shopId: 'ID!',
            },
        },
        initialVariables: {
            orderListByEndPoint: {
                pageNo: 0,
                pageSize: props.pageSize,
                shopId: props.rootShop.id,
                endPoint: props.endPoint,
            },
        },
    })
)
export default class OrderListByEndPointContainer extends React.Component {
    loadListPage (unused, pageNo) {
        const { relate, rootShop, endPoint, pageSize, orderListByEndPoint } = this.props;
        const property = 'orderList';
        if (needLoadPage(orderListByEndPoint, property, pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    orderListByEndPoint: {
                        pageNo,
                        pageSize,
                        endPoint,
                        shopId: rootShop.id,
                    },
                },
                property,
            });
        }
    }
    render () {
        return (
            <OrderListByEndPoint {...this.props} loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/trucks/pages/selectCarryPartment/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as truckActions from 'actions/trucks';
import SelectCarryPartment from './contents';

@dataConnect(
    (state) => {
        const { truckId, record } = state.router.location.state || state.router.location.query;
        return { truckId, record, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(truckActions, dispatch),
    }),
    (props) => {
        return {
            fragments: SelectCarryPartment.fragments,
            variablesTypes: {
                carryPartments: {
                    truckId: 'ID!',
                },
            },
            initialVariables: {
                carryPartments: {
                    truckId: props.truckId,
                },
            },
        };
    }
)
export default class SelectCarryPartmentContainer extends React.Component {
    render () {
        return (
            <SelectCarryPartment {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/trucks/pages/payForCarryPartment/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as truckActions from 'actions/trucks';
import PayForCarryPartment from './contents';

@dataConnect(
    (state) => {
        const { truckId, record } = state.router.location.state || state.router.location.query;
        return { truckId, record, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(truckActions, dispatch),
    }),
    (props) => {
        return {
            fragments: PayForCarryPartment.fragments,
            variablesTypes: {
                truck: {
                    truckId: 'ID!',
                },
            },
            initialVariables: {
                truck: {
                    truckId: props.truckId,
                },
            },
        };
    }
)
export default class PayForCarryPartmentContainer extends React.Component {
    render () {
        return (
            <PayForCarryPartment {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/personal/pages/paymentPwd/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import PaymentPwd from './contents';

@dataConnect(
    null,
    (dispatch) => ({
        actions : bindActionCreators(personalActions, dispatch),
    })
)
export default class PaymentPwdContainer extends React.Component {
    render () {
        return (
            <PaymentPwd {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/trucks/pages/orderList/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import OrderListInTruck from './contents';

@dataConnect(
    (state) => {
        const { truckId } = state.router.location.state || state.router.location.query;
        return { truckId, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: OrderListInTruck.fragments,
        variablesTypes: {
            orderListInTruck: {
                truckId: 'ID!',
            },
        },
        initialVariables: {
            orderListInTruck: {
                truckId: props.truckId,
            },
        },
    })
)
export default class OrderListInTruckContainer extends React.Component {
    render () {
        return (
            <OrderListInTruck {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/preOrders/pages/detail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { getUserNameByPhone } from 'actions/personals';
import PreOrderDetail from './contents';

@dataConnect(
    (state) => {
        const { orderGroupId, orderGroupStartPoint, operType, orderId, record, preOrders, activeType } = state.router.location.state || state.router.location.query;
        return { orderGroupId, orderGroupStartPoint, operType: operType * 1, orderId, record: record || { startPoint: '贵州省贵阳市' }, preOrders, activeType, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators({ ...orderActions, getUserNameByPhone }, dispatch),
    }),
    (props) => {
        return {
            fragments: PreOrderDetail.fragments,
            variablesTypes: {
                order: {
                    orderId: 'ID!',
                },
                startPointAddressFromLastCode: {
                    addressLastCode: 'Int',
                    isLeaf: 'Boolean',
                },
                addressFromLastCode: {
                    addressLastCode: 'Int!',
                    type: 'Int',
                },
                sendDoorAddressFromLastCode: {
                    addressLastCode: 'Int',
                },
            },
            initialVariables: {
                order: {
                    orderId: props.orderId || '',
                },
                startPointAddressFromLastCode: {
                    addressLastCode: props.record ? (props.record.startPointLastCode || 0) : 0,
                    isLeaf: props.record ? !!(props.record.shop || props.record.agent) : false,
                },
                addressFromLastCode: {
                    addressLastCode: props.record ? (props.record.endPointLastCode || 0) : 0,
                    type: props.record && props.record.isCityDistribute ? 1 : 0,
                },
                sendDoorAddressFromLastCode: {
                    addressLastCode: props.record ? (props.record.sendDoorEndPointLastCode || 0) : 0,
                },
            },
            mutations: {
                modifyPreOrder ({ state, data }) {
                    if (data.success) {
                        Object.assign(props.record, data.context);
                    }
                },
                removePreOrder ({ state, data, _ }) {
                    if (data.success) {
                        props.preOrders.count--;
                        _.remove(props.preOrders.orderList, (item) => item.id === props.orderId);
                    }
                },
            },
        };
    }
)
export default class PreOrderDetailContainer extends React.Component {
    render () {
        return (
            <PreOrderDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/personal/pages/agent/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import * as accountActions from 'actions/accounts';
import Agent from './contents';

@dataConnect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators({ ...personalActions, ...accountActions }, dispatch),
    }),
    (props) => ({
        fragments: Agent.fragments,
    }),
)
export default class AgentContainer extends React.Component {
    refreshRemainAmount () {
        const { relate } = this.props;
        relate.refresh({
            property: 'remainAmount',
        });
    }
    render () {
        return (
            <Agent {...this.props} refreshRemainAmount={::this.refreshRemainAmount} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/personal/pages/shipper/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as personalActions from 'actions/personals';
import * as accountActions from 'actions/accounts';
import Shipper from './contents';

@dataConnect(
    (state) => ({}),
    (dispatch) => ({
        actions : bindActionCreators({ ...personalActions, ...accountActions }, dispatch),
    }),
    (props) => ({
        fragments: Shipper.fragments,
        variablesTypes: {
            shipper: {
                shopId: 'ID',
            },
        },
        initialVariables: {
            shipper: {
                shopId: props.rootShop.id,
            },
        },
    }),
)
export default class ShipperContainer extends React.Component {
    refreshRemainAmount () {
        const { relate } = this.props;
        relate.refresh({
            property: 'remainAmount',
        });
    }
    render () {
        return (
            <Shipper {...this.props} refreshRemainAmount={::this.refreshRemainAmount} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/trucks/pages/showDetail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as truckActions from 'actions/trucks';
import ShowDetail from './contents';

@dataConnect(
    (state) => {
        const { truckId, record, workTruckList } = state.router.location.state || state.router.location.query;
        return { truckId, record, workTruckList, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(truckActions, dispatch),
    }),
    (props) => {
        return {
            fragments: ShowDetail.fragments,
            variablesTypes: {
                truck: {
                    truckId: 'ID!',
                },
            },
            initialVariables: {
                truck: {
                    truckId: props.truckId,
                },
            },
        };
    }
)
export default class ShowDetailContainer extends React.Component {
    render () {
        return (
            <ShowDetail {...this.props} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/preOrders/pages/lookFee/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import { needLoadPage } from 'utils';
import LookFee from './contents';

@dataConnect(
    (state) => {
        const { orderId, record } = state.router.location.state || state.router.location.query;
        return { orderId, record, orderBy: 0, pageSize: 20, location: [106.6886, 26.566621], keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: LookFee.fragments,
        variablesTypes: {
            lookFee: {
                orderId: 'ID!',
                location: '[Float]!',
                pageNo: 'Int!',
                pageSize: 'Int!',
                orderBy: 'Int!',
            },
        },
        initialVariables: {
            lookFee: {
                orderId: props.orderId,
                location: props.location,
                pageNo: 0,
                pageSize: props.pageSize,
                orderBy: props.orderBy,
            },
        },
    })
)
export default class LookFeeContainer extends React.Component {
    constructor (props) {
        super(props);
        this.orderId = props.orderId;
    }
    refresh (orderBy, location) {
        const { relate, pageSize } = this.props;
        relate.refresh({
            variables: {
                lookFee: {
                    orderId: this.orderId,
                    location,
                    pageNo: 0,
                    pageSize,
                    orderBy,
                },
            },
        });
    }
    loadListPage (orderBy, location, type, pageNo) {
        const { relate, lookFee, pageSize } = this.props;
        if (needLoadPage(lookFee[type], 'roadmapList', pageNo, pageSize)) {
            relate.loadPage({
                variables: {
                    lookFee: {
                        orderId: this.orderId,
                        location,
                        pageNo,
                        pageSize,
                        orderBy,
                    },
                },
                property: type + '.roadmapList',
            });
        }
    }
    render () {
        return (
            <LookFee {...this.props}
                refresh={::this.refresh}
                loadListPage={::this.loadListPage} />
        );
    }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/preOrders/pages/lookGroupFee/index.js

```js
    import React from 'react';
    import { dataConnect } from 'relatejs';
    import { bindActionCreators } from 'redux';
    import * as orderActions from 'actions/orders';
    import LookGroupFee from './contents';

@dataConnect(
    (state) => {
        const { orderGroupId, record } = state.router.location.state || state.router.location.query;
        return { orderGroupId, record, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: LookGroupFee.fragments,
        variablesTypes: {
            lookGroupFee: {
                orderGroupId: 'ID!',
                location: '[Float]!',
            },
        },
        initialVariables: {
            lookGroupFee: {
                orderGroupId: props.orderGroupId,
                location: [106.6886, 26.566621],
            },
        },
    })
)
    export default class LookGroupFeeContainer extends React.Component {
        render () {
            return (
                <LookGroupFee {...this.props} />
            );
        }
}

```

* PDShop_Client_PC/project/App/shared/pages/client/pages/preOrders/pages/groupDetail/index.js

```js
import React from 'react';
import { dataConnect } from 'relatejs';
import { bindActionCreators } from 'redux';
import * as orderActions from 'actions/orders';
import InGroupPreOrderList from './contents';

@dataConnect(
    (state) => {
        const { orderGroupId, orderGroupStartPoint, record } = state.router.location.state || state.router.location.query;
        return { orderGroupId, orderGroupStartPoint, record, keepLastKeepData: true };
    },
    (dispatch) => ({
        actions : bindActionCreators(orderActions, dispatch),
    }),
    (props) => ({
        fragments: InGroupPreOrderList.fragments,
        variablesTypes: {
            inGroupPreOrders: {
                orderGroupId: 'ID!',
            },
        },
        initialVariables: {
            inGroupPreOrders: {
                orderGroupId: props.orderGroupId,
            },
        },
    })
)
export default class InGroupPreOrderListContainer extends React.Component {
    render () {
        return (
            <InGroupPreOrderList {...this.props} />
        );
    }
}

```

* PDShop/project/App/index.js

```js
'use strict';

console.disableYellowBox = true;

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Platform,
    BackAndroid,
    View,
    Text,
    Image,
    StatusBar,
} = ReactNative;

const CustomComponents = require('react-native-deprecated-custom-components');
global.Navigator = CustomComponents.Navigator;
global._ = require('lodash');
global.sr = require('./config/Screen');
const COLOR = require('./config/Color');
global._c = COLOR._c;
global._bc = COLOR._bc;
global._tc = COLOR._tc;
global.Toast = require('@remobile/react-native-toast').show;
global.CONSTANTS = require('./config/Constants');
global.AH = require('./config/Authority');
global.PS = require('./config/Position');
global.PT = require('./config/Partment');
global.OS = require('./config/OrderState');
global.TS = require('./config/TruckState');
const Utils = require('./utils');
global.POST = Utils.POST;
global.GET = Utils.GET;
global.UPLOAD = Utils.UPLOAD;
global.COMPONENTS = require('./components/index');
const TimerMixin = require('react-timer-mixin');

const Route = require('./config/Route');
const img = require('./resource/image');
const aud = require('./resource/audio');
const PersonalInfoMgr = require('./manager/PersonalInfoMgr');
const UpdateMgr = require('./manager/UpdateMgr');
const SettingMgr = require('./manager/SettingMgr');
const LoginMgr = require('./manager/LoginMgr');
const ScanStoageOrderMgr = require('./manager/ScanStoageOrderMgr');
const JpushMgr = require('./manager/JpushMgr');
const { ProgressHud, DelayTouchableOpacity, Modal } = COMPONENTS;

global.app = {
    route: Route,
    utils: Utils,
    img: img,
    aud: aud,
    data: {},
    personal: PersonalInfoMgr,
    setting: SettingMgr,
    updateMgr:UpdateMgr,
    login: LoginMgr,
    jpush: JpushMgr,
    scanStoageOrder: ScanStoageOrderMgr,
    isandroid: Platform.OS === 'android',
};

global.SceneMixin = {
    componentWillMount () {
        app.scene = this;
    },
    onWillFocus () {
        app.scene = this;
    },
};

app.configureScene = function (route) {
    route = route || {};
    let sceneConfig = route.sceneConfig;
    if (sceneConfig) {
        return sceneConfig;
    }
    if (Platform.OS === 'android') {
        if (route.fromLeft) {
            sceneConfig = { ...Navigator.SceneConfigs.FloatFromLeft, gestures: null };
        } else {
            sceneConfig = Navigator.SceneConfigs.FadeAndroid;
        }
    } else {
        if (route.fromLeft) {
            sceneConfig = { ...Navigator.SceneConfigs.FloatFromLeft, gestures: null };
        } else {
            sceneConfig = { ...Navigator.SceneConfigs.HorizontalSwipeJump, gestures: null };
        }
    }
    return sceneConfig;
};

const Splash = require('./modules/splash/index');

const NavigationBarRouteMapper = {
    LeftButton (route, navigator, index, navState) {
        let leftButton = route.leftButton || route.component.leftButton;
        if (index === 0 && !leftButton) {
            return null;
        }
        if (typeof leftButton === 'function') {
            leftButton = leftButton();
        }
        const image = leftButton && leftButton.image || app.img.common_back;
        const title = leftButton && leftButton.title || '';
        const handler = leftButton && leftButton.handler || navigator.pop;
        if (image && !title) {
            return (
                <DelayTouchableOpacity
                    onPress={handler}
                    style={styles.navBarButton}>
                    <Image
                        resizeMode='stretch'
                        source={image}
                        style={styles.navBarIcon} />
                </DelayTouchableOpacity>
            );
        } else {
            return (
                <DelayTouchableOpacity
                    onPress={handler}
                    style={styles.navBarButton}>
                    <Text style={styles.navBarButtonText}>
                        {leftButton.title}
                    </Text>
                </DelayTouchableOpacity>
            );
        }
    },
    RightButton (route, navigator, index, navState) {
        let rightButton = route.rightButton || route.component.rightButton;
        if (typeof rightButton === 'function') {
            rightButton = rightButton();
        }
        if (!rightButton) {
            return <View style={styles.navBarRightEmptyButton} />;
        }
        if (rightButton.image) {
            return (
                <DelayTouchableOpacity
                    onPress={rightButton.handler}
                    style={styles.navBarButton}>
                    <Image
                        resizeMode='stretch'
                        source={rightButton.image}
                        style={styles.navBarIcon} />
                </DelayTouchableOpacity>
            );
        } else {
            return (
                <DelayTouchableOpacity
                    onPress={rightButton.handler}
                    style={styles.navBarButton}>
                    <Text style={styles.navBarButtonText}>
                        {rightButton.title}
                    </Text>
                </DelayTouchableOpacity>
            );
        }
    },
    Title (route, navigator, index, navState) {
        const title = route.title || route.component.title;
        if (typeof title === 'function') {
            return (
                <View style={styles.titleContainer}>
                    <Text
                        numberOfLines={1}
                        style={styles.navBarTitleText}>
                        {title()}
                    </Text>
                </View>
            );
        } else if (typeof title === 'string') {
            return (
                <View style={styles.titleContainer}>
                    <Text
                        numberOfLines={1}
                        style={styles.navBarTitleText}>
                        {title}
                    </Text>
                </View>
            );
        } else {
            return (
                <View style={styles.titleContainer}>
                    {title}
                </View>
            );
        }
    },
};

module.exports = React.createClass({
    mixins: [TimerMixin],
    getInitialState () {
        return {
            showNavBar: false,
            modalShow: false,
            modalContent: null,
            modalBackgroundColor: null,
            modalTouchHide: false,
        };
    },
    componentWillMount () {
        // if (!app.isandroid) {
        //     NativeModules.AccessibilityManager.setAccessibilityContentSizeMultipliers({
        //         'extraSmall': 1,
        //         'small': 1,
        //         'medium': 1,
        //         'large': 1,
        //         'extraLarge': 1,
        //         'extraExtraLarge': 1,
        //         'extraExtraExtraLarge': 1,
        //         'accessibilityMedium': 1,
        //         'accessibilityLarge': 1,
        //         'accessibilityExtraLarge': 1,
        //         'accessibilityExtraExtraLarge': 1,
        //         'accessibilityExtraExtraExtraLarge': 1,
        //     });
        // }
        app.root = this;
        app.showLoading = () => {
            this.refs.progressHud.show();
        };
        app.hideLoading = () => {
            this.refs.progressHud.hide();
        };
        StatusBar.setBackgroundColor('transparent');
        StatusBar.setTranslucent(true);
        app.showModal = (view, options = {}) => {
            const { backgroundColor, touchHide } = options;
            this.setState({
                modalShow: true,
                modalContent: view,
                modalBackgroundColor: backgroundColor,
                modalTouchHide: touchHide,
            });
        };
        app.closeModal = () => {
            this.refs.modal.closeModal();
        };
        app.removeModal = () => {
            this.setState({
                modalShow: false,
            });
        };
        app.update = () => {
            this.setState({});
        };
        app.forceUpdateNavbar = () => {
            this.setState({
                showNavBar: true,
            });
        };
        app.toggleNavigationBar = (show) => {
            this.setImmediate(() => {
                this.setState({ showNavBar:show });
            });
        };
        app.getCurrentRoute = (index = 0) => {
            const { routeStack, presentedIndex } = app.navigator.state;
            return routeStack[presentedIndex - index];
        };
        app.push = (params) => {
            app.navigator.push(params);
        };
        app.pop = (step = 1) => {
            if (step === 1) {
                app.navigator.pop();
            } else {
                const routes = app.navigator.getCurrentRoutes();
                const index = routes.length - step - 1;
                if (index > 0) {
                    app.navigator.popToRoute(routes[index]);
                } else {
                    app.navigator.popToTop();
                }
            }
        };
        if (app.isandroid) {
            BackAndroid.addEventListener('hardwareBackPress', () => {
                if (this.state.is_hud_visible) {
                    this.setState({ is_hud_visible: false });
                    return true;
                }
                if (this.state.modalShow) {
                    this.setState({ modalShow: false });
                    return true;
                }
                const routes = app.navigator.getCurrentRoutes();
                if (routes.length > 1) {
                    const leftButton = routes[routes.length - 1].component.leftButton;
                    if (leftButton && leftButton.handler) {
                        leftButton.handler();
                    } else {
                        app.pop();
                    }
                    return true;
                }
                if (!this.willExitAndroid) {
                    Toast('再按一次返回键退出程序');
                    this.willExitAndroid = true;
                    this.setTimeout(() => { this.willExitAndroid = false; }, 3000);
                    return true;
                }
                return false;
            });
        }
    },
    componentDidMount: function () {
        // app.net.register();
        app.jpush.register();
    },
    configureScene (route) {
        return app.configureScene(route);
    },
    renderScene (route, navigator) {
        return (
            <View style={{ flex: 1 }}>
                {this.state.showNavBar && <View style={[styles.navBarBack, { backgroundColor: app.setting.THEME_COLOR }]} />}
                <route.component
                    {...route.passProps}
                    ref={(ref) => { if (ref)route.ref = ref; }} />
            </View>
        );
    },
    render () {
        const initialRoute = {
            component: Splash,
        };
        const navigationBar = (
            <Navigator.NavigationBar
                routeMapper={NavigationBarRouteMapper}
                style={[styles.navBar, { backgroundColor: app.setting.THEME_COLOR }]}
                />
        );
        return (
            <View style={{ flex:1 }}>
                <Navigator
                    ref={(navigator) => {
                        if (navigator) {
                            app.navigator = navigator;
                        }
                    }}
                    debugOverlay={false}
                    style={styles.container}
                    initialRoute={initialRoute}
                    configureScene={this.configureScene}
                    renderScene={this.renderScene}
                    onDidFocus={(route) => {
                        if (route) {
                            const ref = route.ref;
                            const getChildScene = ref && ref.getChildScene;
                            // 注意：app.scene调用的时候一定需要使用封装函数，如：{handler: ()=>{app.scene.toggleEdit()}}，不能直接使用 handler: app.scene.toggleEdit.
                            // 在动画加载完成前 app.scene 还没有被赋值， 需要使用 SceneMixin 来设置 app.scene
                            const scene = app.scene = getChildScene ? getChildScene() : ref;
                            if (getChildScene && !scene.hasMouted) {
                                scene.hasMouted = true;
                                return;
                            }
                            scene && scene.onDidFocus && scene.onDidFocus();
                            // 如果时主页面，需要检测主页面和其子页面的回调
                            ref && ref !== scene && ref.onDidFocus && ref.onDidFocus();
                        }
                    }}
                    onWillFocus={(route) => {
                        if (route) {
                            const preRoute = app.navigator && app.getCurrentRoute();
                            if (preRoute) {
                                const preRef = preRoute.ref;
                                const preGetChildScene = preRef && preRef.getChildScene;
                                const preScene = preGetChildScene ? preGetChildScene() : preRef;
                                preScene && preScene.onWillHide && preScene.onWillHide();
                                // 如果时主页面，需要检测主页面和其子页面的回调
                                preRef && preRef !== preScene && preRef.onWillHide && preRef.onWillHide();
                            }
                            const ref = route.ref;
                            const getChildScene = ref && ref.getChildScene;
                            const scene = getChildScene ? getChildScene() : ref;
                            // 如果时主页面，需要检测主页面和其子页面的回调
                            scene && scene.onWillFocus && scene.onWillFocus();// 注意：在首次加载的时候页面没有被加载，route.ref为空，不会调用该函数，需要在该页面的componentWillMount里面处理首次逻辑，只有从上页面返回的时候才能被调用
                            ref && ref !== scene && ref.onWillFocus && ref.onWillFocus();
                        }
                    }}
                    navigationBar={this.state.showNavBar ? navigationBar : null}
                    />
                {
                    this.state.modalShow &&
                    <Modal ref='modal' backgroundColor={this.state.modalBackgroundColor} modalTouchHide={this.state.modalTouchHide}>
                        {this.state.modalContent}
                    </Modal>
                }
                <ProgressHud
                    ref='progressHud'
                    overlayColor='rgba(0, 0, 0, 0.6)'
                    color={app.setting.THEME_COLOR}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor:'#EEEEEE',
    },
    navBarBack: {
        height:sr.totalNavbarHeight,
    },
    navBar: {
        alignItems:'center',
        height: sr.totalNavbarHeight,
    },
    titleContainer: {
        width: sr.w,
        height: sr.navbarHeight,
        alignItems:'center',
        justifyContent: 'center',
        paddingTop: sr.translucent ? sr.statusBarHeight : 0,
    },
    navBarButtonText: {
        color: '#FFFFFF',
        fontSize: 18,
    },
    navBarTitleText: {
        fontSize: 18,
        color: '#FFFFFF',
        textAlign: 'center',
        fontWeight: '500',
        width: sr.w / 2,
    },
    navBarButton: {
        flexDirection: 'row',
        paddingHorizontal: 10,
        height:sr.navbarHeight,
        alignItems: 'center',
        paddingTop: sr.translucent ? sr.statusBarHeight / 2 : 0,
    },
    navBarRightEmptyButton: {
        width: 80,
        height: sr.navbarHeight,
    },
    navBarIcon: {
        width: sr.navbarHeight * (sr.translucent ? 0.2 : 0.3),
        height: sr.navbarHeight * (sr.translucent ? 0.2 : 0.3),
    },
});

```

* PDShop/project/App/components/AutogrowInput.js

```js
import React, { Component } from 'react';
import {
    TextInput,
    StyleSheet,
} from 'react-native';

class Input extends Component {
    constructor () {
        super();
        this.state = {
            height: 35,
        };
    }
    componentWillMount () {
        const { maxLines, style, maxHeight } = this.props;
        const { height, lineHeight, fontSize } = StyleSheet.flatten(style);
        this.defaultHeight = height;
        this.maxHeight = maxLines ? (maxLines * (lineHeight || fontSize * 1.5)) : maxHeight || 99999;
        if (this.defaultHeight) {
            this.setState({ height:this.defaultHeight });
        }
    }
    handleChange (event) {
        const { onChange } = this.props;
        const { height } = event.nativeEvent.contentSize;

        if (this.state.height !== height && height < this.maxHeight) {
            this.setState({
                height: Math.min(Math.max(this.defaultHeight, height), this.maxHeight),
            });
        }
        onChange && onChange(event);
    }
    resetInputText () {
        this.refs.input.setNativeProps({ text: '' });
        this.setState({ height: this.defaultHeight });
    }
    render () {
        return (
            <TextInput
                ref='input'
                multiline
                {...this.props}
                style={[this.props.style, { height: this.state.height }]}
                onChange={this.handleChange.bind(this)}
                />
        );
    }
}

Input.propTypes = {
    style: React.PropTypes.oneOfType([
        React.PropTypes.number,
        React.PropTypes.array,
        React.PropTypes.object,
    ]),
    onChange: React.PropTypes.func,
};

module.exports = Input;

```

* PDShop/project/App/components/Button.js

```js
'use strict';

const React = require('react');const { PropTypes } = React;
const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    TouchableOpacity,
} = ReactNative;

const DEFAULT_OPACITY = 0.8;

module.exports = React.createClass({
    propTypes: {
        onPress: PropTypes.func,
        disable: PropTypes.bool,
        textStyle: PropTypes.style,
        activeOpacity: PropTypes.number,
    },
    render () {
        const touchableProps = {
            activeOpacity: this.props.disable ? 1 : this.props.activeOpacity ? this.props.activeOpacity : DEFAULT_OPACITY,
        };
        if (!this.props.disable) {
            touchableProps.onPress = this.props.onPress;
        }
        return (
            <TouchableOpacity
                style={[styles.container, { backgroundColor:app.setting.THEME_COLOR }, this.props.style]} {...touchableProps}
                testID={this.props.testID}>
                <Text style={[styles.text, this.props.disable ? styles.disableText : null, this.props.textStyle]}
                    numberOfLines={1}>
                    {this.props.children}
                </Text>
            </TouchableOpacity>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        borderRadius: 10,
        alignItems:'center',
        justifyContent:'center',
    },
    text: {
        color: '#FFFFFF',
        fontSize: 18,
        fontWeight: '100',
        textAlign: 'center',
        overflow: 'hidden',
    },
    disableText: {
        color: '#dcdcdc',
    },
});

```

* PDShop/project/App/components/ClipRect.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Shape,
    Surface,
    Path,
} = ReactNative.ART;

const ClipRectIOS = React.createClass({
    render: function () {
        const style = ReactNative.StyleSheet.flatten(this.props.style);
        let { width, height, borderRadius, borderTopLeftRadius, borderTopRightRadius, borderBottomRightRadius, borderBottomLeftRadius, color } = style;
        borderRadius = borderRadius || 0;
        const tl = borderTopLeftRadius || borderRadius;
        const tr = borderTopRightRadius || borderRadius;
        const br = borderBottomRightRadius || borderRadius;
        const bl = borderBottomLeftRadius || borderRadius;

        const path = Path();

        path.move(0, tl);

        if (tl > 0) { path.arc(tl, -tl); }
        path.line(width - (tr + tl), 0);

        if (tr > 0) { path.arc(tr, tr); }
        path.line(0, height - (tr + br));

        if (br > 0) { path.arc(-br, br); }
        path.line(-width + (br + bl), 0);

        if (bl > 0) { path.arc(-bl, -bl); }
        path.line(0, bl)
        .line(width, 0)
        .line(0, -height)
        .line(-width, 0);

        return (
            <Surface width={width} height={height} style={{ backgroundColor:'transparent' }}>
                <Shape d={path} fill={color} />
            </Surface>
        );
    },
});

const TIMES = 30;
const _X = (r, d) => Math.cos(Math.PI / 180 * d) * r;
const _Y = (r, d) => Math.sin(Math.PI / 180 * d) * r;
const arc = (path, x, y, r, t) => {
    const offset = 90 / TIMES;
    for (let i = 0; i <= TIMES; i++) {
        path.lineTo(x - _X(r, 90 * t + offset * i), y - _Y(r, 90 * t + offset * i));
    }
};

const ClipRectAndroid = React.createClass({
    render: function () {
        const style = ReactNative.StyleSheet.flatten(this.props.style);
        let { width, height, borderRadius, borderTopLeftRadius, borderTopRightRadius, borderBottomRightRadius, borderBottomLeftRadius, color } = style;
        borderRadius = borderRadius || 0;
        const tl = borderTopLeftRadius || borderRadius;
        const tr = borderTopRightRadius || borderRadius;
        const br = borderBottomRightRadius || borderRadius;
        const bl = borderBottomLeftRadius || borderRadius;

        const path = Path();

        path.move(0, tl);

        if (tl > 0) { arc(path, tl, tl, tl, 0); }
        path.line(width - (tr + tl), 0);

        if (tr > 0) { arc(path, width - tr, tr, tr, 1); }
        path.line(0, height - (tr + br));

        if (br > 0) { arc(path, width - br, height - br, br, 2); }
        path.line(-width + (br + bl), 0);

        if (bl > 0) { arc(path, bl, height - bl, bl, 3); }
        path.line(0, bl)
        .line(width, 0)
        .line(0, -height)
        .line(-width, 0);

        return (
            <Surface width={width} height={height} style={{ backgroundColor:'transparent' }}>
                <Shape d={path} fill={color} />
            </Surface>
        );
    },
});

module.exports = ReactNative.Platform.OS === 'android' ? ClipRectAndroid : ClipRectIOS;

```

* PDShop/project/App/components/CustomMessageBox.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    TouchableHighlight,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps: function () {
        return {
            title: '温馨提示',
            cancelText: '取消',
            confirmText: '确定',
            width: 312,
        };
    },
    doConfirm () {
        const { onConfirm } = this.props;
        if (!onConfirm || !onConfirm()) {
            app.closeModal();
        }
    },
    doCancel () {
        const { onCancel } = this.props;
        if (onCancel === true || !onCancel || !onCancel()) {
            app.closeModal();
        }
    },
    render () {
        const { title, width, onCancel, cancelText, confirmText } = this.props;
        return (
            <View style={[styles.container, { width }]}>
                { !!title && <Text style={styles.title}>{title}</Text> }
                { !!title && <Text style={[styles.redLine, { width: width * 0.8 }]} /> }
                <Text style={styles.content}>
                    {this.props.children}
                </Text>
                <Text style={[styles.H_Line, { width }]} />
                <View style={[styles.buttonViewStyle, { width: width - 20 }]}>
                    {!!onCancel &&
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doCancel}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: 'red' }]}>{cancelText}</Text>
                    </TouchableHighlight>
                        }
                    {!!onCancel &&
                    <Text style={styles.line} />
                        }
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doConfirm}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: '#0076FF' }]} >{confirmText}</Text>
                    </TouchableHighlight>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#FFFFFF',
        borderRadius:10,
    },
    buttonViewStyle: {
        flexDirection: 'row',
        height: 50,
    },
    H_Line: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#b4b4b4',
    },
    redLine: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#ff3c30',
    },
    line: {
        width: 1,
        height: 50,
        backgroundColor: '#b4b4b4',
    },
    buttonStyleContain: {
        height: 50,
        flex: 1,
        justifyContent:'center',
        alignItems:'center',
    },
    buttonStyle: {
        fontSize: 15,
        color: '#000000',
    },
    title: {
        color: '#ff3c30',
        fontSize: 16,
        fontWeight: '100',
        textAlign: 'center',
        overflow: 'hidden',
        marginTop:20,
    },
    content: {
        alignSelf:'center',
        color:'#000000',
        marginTop: 20,
    },
});

```

* PDShop/project/App/components/CustomSheet.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    TouchableOpacity,
    View,
} = ReactNative;

const Overlay = require('./ActionSheet/overlay');
const Sheet = require('./ActionSheet/sheet');

module.exports = React.createClass({
    render () {
        const { visible, onCancel } = this.props;
        return (
            <Overlay visible={visible}>
                <View style={styles.actionSheetContainer}>
                    <TouchableOpacity
                        style={{ flex:1 }}
                        onPress={onCancel} />
                    <Sheet visible={visible}>
                        {this.props.children}
                    </Sheet>
                </View>
            </Overlay>
        );
    },
});

const styles = StyleSheet.create({
    actionSheetContainer: {
        flex: 1,
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
    },
});

```

* PDShop/project/App/components/DImage.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    View,
} = ReactNative;

const DImage = React.createClass({
    getInitialState () {
        return { showDefault: true };
    },
    onLoad () {
        this.setState({ showDefault: false });
    },
    componentWillReceiveProps (nextProps) {
        const pre = this.props.source, post = nextProps.source;
        const preuri = pre.uri, posturi = post.uri;
        const preT = typeof posturi === 'string', postT = typeof posturi === 'string';
        if ((!(preT ^ postT)) && preuri !== posturi) {
            this.setState({ showDefault: true });
        }
    },
    render () {
        const { source, defaultSource, ...other } = this.props;
        const { showDefault } = this.state;
        return (
            showDefault ?
                <View>
                    <Image source={defaultSource} {...other}>{this.props.children}</Image>
                    <Image style={{ left:-1, top:-1, position:'absolute', width:1, height:1 }} source={source} onLoad={this.onLoad} />
                </View>
            :
                <Image source={source} {...other} >{this.props.children}</Image>
        );
    },
});

module.exports = DImage;

```

* PDShop/project/App/components/DelayTouchableOpacity.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    TouchableOpacity,
} = ReactNative;

const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    componentWillMount () {
        this.enable = true;
        this.onPress = (e) => {
            if (this.enable) {
                this.enable = false;
                this.props.onPress(e);
                this.setTimeout(() => { this.enable = true; }, this.props.delayTime || 200);
            }
        };
    },
    render () {
        return (
            <TouchableOpacity
                {...this.props}
                onPress={this.onPress}
                >
                {this.props.children}
            </TouchableOpacity>
        );
    },
});

```

* PDShop/project/App/components/Label.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

module.exports = React.createClass({
    render () {
        const { img, children, style, textStyle } = this.props;
        return (
            <View style={[styles.labelContainer, style]}>
                {!!img && <Image resizeMode='stretch' source={img} style={styles.labelIcon} />}
                <Text style={[styles.label, textStyle]}>{children}:</Text>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    labelContainer: {
        marginTop: 10,
        marginBottom: 6,
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    label: {
        color: '#969696',
        fontSize: 14,
    },
    labelIcon: {
        width: 20,
        height: 20,
        tintColor: '#A3A3A3',
    },
});

```

* PDShop/project/App/components/MessageBox.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    TouchableHighlight,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps: function () {
        return {
            title: '温馨提示',
            content: '确定要执行操作吗？',
            cancelText: '取消',
            confirmText: '确定',
            width: 312,
        };
    },
    doConfirm () {
        const { onConfirm } = this.props;
        if (!onConfirm || !onConfirm()) {
            app.closeModal();
        }
    },
    doCancel () {
        const { onCancel } = this.props;
        if (onCancel === true || !onCancel || !onCancel()) {
            app.closeModal();
        }
    },
    render () {
        const { title, width, content, onCancel, cancelText, confirmText } = this.props;
        return (
            <View style={[styles.container, { width }]}>
                { !!title && <Text style={styles.title}>{title}</Text> }
                { !!title && <Text style={[styles.redLine, { width: width * 0.8 }]} /> }
                <Text style={styles.content}>
                    {content}
                </Text>
                <Text style={[styles.H_Line, { width }]} />
                <View style={[styles.buttonViewStyle, { width: width - 20 }]}>
                    {!!onCancel &&
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doCancel}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: 'red' }]}>{cancelText}</Text>
                    </TouchableHighlight>
                        }
                    {!!onCancel &&
                    <Text style={styles.line} />
                        }
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doConfirm}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: '#0076FF' }]} >{confirmText}</Text>
                    </TouchableHighlight>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#FFFFFF',
        borderRadius:10,
    },
    buttonViewStyle: {
        flexDirection: 'row',
        height: 50,
    },
    H_Line: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#b4b4b4',
    },
    redLine: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#ff3c30',
    },
    line: {
        width: 1,
        height: 50,
        backgroundColor: '#b4b4b4',
    },
    buttonStyleContain: {
        height: 50,
        flex: 1,
        justifyContent:'center',
        alignItems:'center',
    },
    buttonStyle: {
        fontSize: 15,
        color: '#000000',
    },
    title: {
        color: '#ff3c30',
        fontSize: 16,
        fontWeight: '100',
        textAlign: 'center',
        overflow: 'hidden',
        marginTop:20,
    },
    content: {
        alignSelf:'center',
        color:'#000000',
        margin: 20,
        marginTop: 30,
    },
});

```

* PDShop/project/App/components/Modal.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Animated,
    PanResponder,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            backgroundColor: 'rgba(0, 0, 0, 0.5)',
        };
    },
    getInitialState () {
        return {
            opacity: new Animated.Value(0),
        };
    },
    componentWillMount () {
        this._panResponder = PanResponder.create({
            onStartShouldSetPanResponder: (e, gestureState) => true,
            onPanResponderGrant: (e, gestureState) => {
                this.closeModal();
            },
        });
    },
    componentDidMount () {
        Animated.timing(this.state.opacity, {
            toValue: 1,
            duration: 500,
        }
        ).start();
    },
    closeModal () {
        Animated.timing(this.state.opacity, {
            toValue: 0,
            duration: 500,
        }
        ).start(() => {
            app.removeModal();
        });
    },
    render () {
        const { modalTouchHide } = this.props;
        return (
            <Animated.View style={[styles.container, { backgroundColor: this.props.backgroundColor, opacity: this.state.opacity }]} {...(modalTouchHide ? this._panResponder.panHandlers : {})}>
                {this.props.children}
            </Animated.View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        position: 'absolute',
        top: 0,
        bottom: 0,
        left: 0,
        right: 0,
        alignItems:'center',
        justifyContent: 'center',
    },
});

```

* PDShop/project/App/components/PageList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    View,
    Text,
    StyleSheet,
    FlatList,
} = ReactNative;

const STATUS = {
    /* loading more status change graph
    *
    * STATUS_TEXT_HIDE->[STATUS_HAVE_MORE, STATUS_START_LOAD]
    * STATUS_START_LOAD->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_HAVE_MORE->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_ALL_LOADED->[STATUS_TEXT_HIDE]
    */
    STATUS_TEXT_HIDE: 0,
    STATUS_START_LOAD: 1,
    STATUS_HAVE_MORE: 2,
    STATUS_NO_DATA: 3,
    STATUS_ALL_LOADED: 4,
    STATUS_LOAD_ERROR: 5,
};
const TEXT = {
    0: '',
    1: '',
    2: '正在加载更多...',
    3: '暂无数据!',
    4: '全部加载完成',
    5: '加载错误，请稍后再试',
};

const { STATUS_TEXT_HIDE, STATUS_START_LOAD, STATUS_HAVE_MORE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR } = STATUS;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            autoLoad: true,
            pageNo: 0,
            style: { flex: 1 },
            pageSize: CONSTANTS.PER_PAGE_COUNT,
        };
    },
    componentDidMount () {
        if (this.props.autoLoad) {
            this.getList();
        }
    },
    updateList (callback) {
        this.list = callback(this.list);
        this.setState({
            dataSource: this.list,
        });
    },
    getInitialState () {
        const { list, pageNo } = this.props;
        this.list = list || [];
        this.pageNo = pageNo;
        return {
            dataSource: this.list,
            infiniteLoadStatus: list ? (list.length === 0 ? STATUS_NO_DATA : list.length < CONSTANTS.PER_PAGE_COUNT ? STATUS_ALL_LOADED : STATUS_TEXT_HIDE) : STATUS_START_LOAD,
        };
    },
    componentDidUpdate (prevProps, prevState) {
        if (!_.isEqual(prevProps.listParam, this.props.listParam)) {
            this.refresh();
        }
    },
    getList (wait) {
        const param = {
            ...this.props.listParam,
            pageNo: this.pageNo,
            pageSize: this.props.pageSize,
        };
        this.setState({ infiniteLoadStatus: this.pageNo === 0 ? STATUS_START_LOAD : STATUS_HAVE_MORE }, () => {
            POST(this.props.listUrl, param, this.getListSuccess, this.getListFailed, wait);
        });
    },
    getListSuccess (data) {
        this.props.onGetList && this.props.onGetList(data, this.pageNo);
        if (data.success) {
            const list = _.get(data.context, this.props.listName);
            const infiniteLoadStatus = (!list.length && this.pageNo === 0) ? STATUS_NO_DATA : list.length < this.props.pageSize ? STATUS_ALL_LOADED : STATUS_TEXT_HIDE;
            this.list = this.list.concat(list);
            this.setState({
                dataSource: this.list,
                infiniteLoadStatus: infiniteLoadStatus,
            });
        } else {
            if (this.props.ListFailedText) {
                this.setState({ infiniteLoadStatus: this.props.ListFailedText });
            } else {
                this.getListFailed();
            }
        }
    },
    getListFailed () {
        this.pageNo--;
        this.setState({ infiniteLoadStatus: STATUS_LOAD_ERROR });
    },
    onEndReached () {
        if (this.state.infiniteLoadStatus !== STATUS_TEXT_HIDE || this.props.disable) {
            return;
        }
        this.pageNo++;
        this.getList();
    },
    refresh () {
        if (this.isRefreshing()) {
            return;
        }
        this.list = [];
        this.setState({
            dataSource: this.list,
        });
        this.pageNo = 0;
        this.getList();
    },
    isRefreshing () {
        return (this.state.infiniteLoadStatus === STATUS_START_LOAD || this.state.infiniteLoadStatus === STATUS_HAVE_MORE);
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View
                style={styles.separator}
                key={sectionID + rowID} />
        );
    },
    renderFooter () {
        const status = this.state.infiniteLoadStatus;
        return (
            <View style={styles.listFooterContainer}>
                <Text style={styles.listFooter}>
                    {typeof status === 'string' ? status : status === STATUS_NO_DATA && this.props.ListFailedText ? this.props.ListFailedText : TEXT[status]}
                </Text>
            </View>
        );
    },
    render () {
        return (
            <FlatList
                onEndReached={this.onEndReached}
                onEndReachedThreshold={10}
                initialListSize={this.props.pageSize}
                enableEmptySections
                removeClippedSubviews={false}
                style={[{ alignSelf:'stretch' }, this.props.style]}
                data={this.state.dataSource}
                renderItem={({ item, index }) => this.props.renderRow(item, index)}
                ItemSeparatorComponent={this.props.renderSeparator === undefined ? this.renderSeparator : this.props.renderSeparator}
                ListFooterComponent={this.renderFooter}
                refreshing={this.state.infiniteLoadStatus === STATUS_START_LOAD}
                onRefresh={this.refresh}
                />
        );
    },
});
module.exports.STATUS = STATUS;

const styles = StyleSheet.create({
    listFooterContainer: {
        height: 60,
        alignItems: 'center',
        paddingTop: 10,
    },
    listFooter: {
        color: 'gray',
        fontSize: 12,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDShop/project/App/components/PageListView.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    View,
    Text,
    StyleSheet,
    ListView,
    RefreshControl,
} = ReactNative;

const STATUS = {
    /* loading more status change graph
    *
    * STATUS_TEXT_HIDE->[STATUS_HAVE_MORE, STATUS_START_LOAD]
    * STATUS_START_LOAD->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_HAVE_MORE->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_ALL_LOADED->[STATUS_TEXT_HIDE]
    */
    STATUS_TEXT_HIDE: 0,
    STATUS_START_LOAD: 1,
    STATUS_HAVE_MORE: 2,
    STATUS_NO_DATA: 3,
    STATUS_ALL_LOADED: 4,
    STATUS_LOAD_ERROR: 5,
};
const TEXT = {
    0: '',
    1: '',
    2: '正在加载更多...',
    3: '暂无数据!',
    4: '全部加载完成',
    5: '加载错误，请稍后再试',
};

const { STATUS_TEXT_HIDE, STATUS_START_LOAD, STATUS_HAVE_MORE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR } = STATUS;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            autoLoad: true,
            pageNo: 0,
            infiniteLoadStatus: STATUS_START_LOAD,
            style: { flex: 1 },
            pageSize: CONSTANTS.PER_PAGE_COUNT,
        };
    },
    componentDidMount () {
        if (this.props.autoLoad) {
            this.getList();
        }
    },
    updateList (callback) {
        this.list = callback(this.list);
        this.setState({
            dataSource: this.ds.cloneWithRows(this.list),
        });
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        this.list = this.props.list || [];
        this.pageNo = this.props.pageNo;
        return {
            dataSource: this.ds.cloneWithRows(this.list),
            infiniteLoadStatus: this.props.infiniteLoadStatus,
        };
    },
    componentDidUpdate (prevProps, prevState) {
        if (!_.isEqual(prevProps.listParam, this.props.listParam)) {
            this.refresh();
        }
    },
    getList (wait) {
        const param = {
            ...this.props.listParam,
            pageNo: this.pageNo,
            pageSize: this.props.pageSize,
        };
        this.setState({ infiniteLoadStatus: this.pageNo === 0 ? STATUS_START_LOAD : STATUS_HAVE_MORE });
        POST(this.props.listUrl, param, this.getListSuccess, this.getListFailed, wait);
    },
    getListSuccess (data) {
        this.props.onGetList && this.props.onGetList(data, this.pageNo);
        if (data.success) {
            const list = _.get(data.context, this.props.listName);
            const infiniteLoadStatus = (!list.length && this.pageNo === 0) ? STATUS_NO_DATA : list.length < this.props.pageSize ? STATUS_ALL_LOADED : STATUS_TEXT_HIDE;
            this.list = this.list.concat(list);
            this.setState({
                dataSource: this.ds.cloneWithRows(this.list),
                infiniteLoadStatus: infiniteLoadStatus,
            });
        } else {
            if (this.props.ListFailedText) {
                this.setState({ infiniteLoadStatus: this.props.ListFailedText });
            } else {
                this.getListFailed();
            }
        }
    },
    getListFailed () {
        this.pageNo--;
        this.setState({ infiniteLoadStatus: STATUS_LOAD_ERROR });
    },
    onEndReached () {
        if (this.state.infiniteLoadStatus !== STATUS_TEXT_HIDE || this.props.disable) {
            return;
        }
        this.pageNo++;
        this.getList();
    },
    refresh () {
        if (this.isRefreshing()) {
            return;
        }
        this.list = [];
        this.setState({
            dataSource: this.ds.cloneWithRows(this.list),
        });
        this.pageNo = 0;
        this.getList();
    },
    isRefreshing () {
        return (this.state.infiniteLoadStatus === STATUS_START_LOAD || this.state.infiniteLoadStatus === STATUS_HAVE_MORE);
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View
                style={styles.separator}
                key={sectionID + rowID} />
        );
    },
    renderFooter () {
        const status = this.state.infiniteLoadStatus;
        return (
            <View style={styles.listFooterContainer}>
                <Text style={styles.listFooter}>
                    {typeof status === 'string' ? status : status === STATUS_NO_DATA && this.props.ListFailedText ? this.props.ListFailedText : TEXT[status]}
                </Text>
            </View>
        );
    },
    render () {
        return (
            <ListView                onEndReached={this.onEndReached}
                onEndReachedThreshold={10}
                initialListSize={this.props.pageSize}
                enableEmptySections
                removeClippedSubviews={false}
                style={[{ alignSelf:'stretch' }, this.props.style]}
                dataSource={this.state.dataSource}
                renderRow={this.props.renderRow}
                renderSeparator={this.props.renderSeparator === undefined ? this.renderSeparator : this.props.renderSeparator}
                renderFooter={this.renderFooter}
                refreshControl={
                    this.props.refreshEnable ?
                        <RefreshControl
                            refreshing={this.state.infiniteLoadStatus === STATUS_START_LOAD}
                            onRefresh={this.refresh}
                            title='正在刷新...' />
                    : null
                }
                />
        );
    },
});
module.exports.STATUS = STATUS;

const styles = StyleSheet.create({
    listFooterContainer: {
        height: 60,
        alignItems: 'center',
        paddingTop: 10,
    },
    listFooter: {
        color: 'gray',
        fontSize: 12,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDShop/project/App/components/Picker.js

```js
'use strict';

import Picker from 'react-native-picker';

module.exports = (pickerData, selectedValue, title) => {
    const color = Math.floor(app.setting.THEME_COLOR.replace('#', '0x'));
    const pickerToolBarBg = [(color >> 16) & 0xff, (color >> 8) & 0xff, color & 0xff, 1];
    return new Promise(async(resolve) => {
        Picker.isPickerShow((show) => {
            if (show) {
                app.closeModal();
                Picker.hide();
            } else {
                Picker.init({
                    pickerConfirmBtnText: '确定',
                    pickerConfirmBtnColor: [255, 255, 255, 1],
                    pickerCancelBtnText: '取消',
                    pickerCancelBtnColor:  [255, 255, 255, 1],
                    pickerTitleText: title || '',
                    pickerTitleColor: [255, 255, 255, 1],
                    pickerToolBarBg,
                    pickerBg: [255, 255, 255, 1],
                    pickerFontColor: [0, 0, 0, 1],
                    pickerToolBarFontSize: 16,
                    pickerFontSize: 16,
                    pickerData,
                    selectedValue,
                    onPickerCancel: () => { app.closeModal(); },
                    onPickerConfirm: (value) => { app.closeModal(); resolve(value); },
                });
                app.showModal();
                Picker.show();
            }
        });
    });
};
module.exports.hide = () => {
    Picker.isPickerShow((show) => {
        Picker.hide();
    });
};

```

* PDShop/project/App/components/ProgressBar.js

```js
const React = require('react');const ReactNative = require('react-native');

const {
    StyleSheet,
    View,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            progress: 0,
        };
    },
    render () {
        const fillWidth = this.props.progress * this.props.style.width;
        return (
            <View style={[styles.background, this.props.backgroundStyle, this.props.style]}>
                <View style={[styles.fill, this.props.fillStyle, { width: fillWidth }]} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    background: {
        backgroundColor: '#bbbbbb',
        height: 5,
        overflow: 'hidden',
    },
    fill: {
        backgroundColor: '#3b5998',
        height: 5,
    },
});

```

* PDShop/project/App/components/ProgressHud.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');

const {
    Image,
    StyleSheet,
    TouchableHighlight,
    View,
    Animated,
    Easing,
} = ReactNative;

const BACKGROUND_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjBFOTY2OTRGMDlBMTFFNUFGQUVDMUUwNDA5REUwMzQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NjBFOTY2OTVGMDlBMTFFNUFGQUVDMUUwNDA5REUwMzQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2MEU5NjY5MkYwOUExMUU1QUZBRUMxRTA0MDlERTAzNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2MEU5NjY5M0YwOUExMUU1QUZBRUMxRTA0MDlERTAzNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrUpG+0AAATlSURBVHjazJpLjBVVEIa7+zYzlwGG4WF0RhkJj4EEY3yigiyU3STiYjbCRmQFC1gQEkIISzUxonHpRqOGBQnxsTImhFcIMYIhZKLyUgENyjPD8JCBud1WOX/r8aROnb7PvpV8uTOdvn3P31V1Tp3qDtM0DRpkITD/T8Fd4iZxhThHnCK+J/YTvzfkx+sUwoMtgexCqUDiOM78ROwmdhEXWi0kIiYZAnwkOc6pEF8Q7xDDzRbCHugk4pwCqhFinsve2YFQbLgQ9sBkJXy0ASc1fGeE2ER8mTdE8tgUYirOD4XEdiW8ZqmRV9LxbuJjYifRUa8QHtR0ouwZeCgc94mQBi8JW4tQm1JraGUi4irjPzGOJbjW2/BoP7GYmKt81/U73xFDxF/VCGERPciLvCLGQeK4s6b1EYPEa8Qy6zqamEPEauJ+XiHTkdh5RPBFx4y7X609Q2wnVuYU8wmxNY8QFjBDWOASYd6/I92dGu0V4n1ilifk2DYQX2lCeIF7EJOAzws36/CCy3qJT4knPd65QbxMXHLNWj1I7tBBBBGjTRDB9gfxKrHPE2LTEI7i9NuBE0KFcYhIg+YZh+vrxDFPjnIoPiYJmSHcfZMAq20zRWTGU+w6lCiJQDaGjbaQGPO8KcD2xggSvFX2J2YnV64myJNHTCHdlgDbG2OuhajJ9jXyRfPKkC3EDCk7vG4Exdm7ggBzIhg09xVlS4TpjXvwSFE2jPJE8gh/PkrMiVCMRQ5CrBdF2+fW4G2WxljJQ2OPHVoV6u02EHLIyovUqpwXRQgrl0eyQrBo4xnsvMMb/4SXKSQUZq77QfvYWSE/sr/7YqsksTc77STkglEW2YvytBizVt6dXJF2R9nrlGPPdjdqIyGpUlkkMVTGjhNKbSSkU6m4b8dQOcnRMJjcRkJ6MVZpnKMxVu4uofsR+joXLbY5hkfscf4Wo/yIHCd0waVjBYuYDY+4hJxnAbeEhbBkfM5qA288h7CqQEzFWhBPZ5VtpNDbBkJWKqs6c9zca7i8MhNlflE2QCwxBm17gxfKi1luXHaU8Nmzj4EChawxwqoilPL7zQXvkrEASnCL6KECRLxAPK2EVAW7yH+FcGhd8+TKEygwW2Uc0usFL5gcQWX8vxLkF48QXhyfb9Fqz1P+FjRENG/skmqpUTTItJYQz+fLlZKmUSI2E/OVpgNzAKW9WBSehFKto9KH6bCrCSK4t7YNjbdE2afz9vsj84tSE/th4lnBM1JT4tugjiexlnG/941g4kmA1DswuzvvEYd9QgIk9jzhIlLuXAwmnplfqVEAd0FWEY97miDZ517iQ/siLiH8pReD/zrzmphs4eQp/Azxa46GRTcWuaXEQqsk0kT8SLwl9RG0R2980ZeQ4JpHpPqM67friOVxHO/ElMolzwPGYusSYIv5mXjTVcD6Hk/z7LQCCe4TUxI+S8KAS45zNRE/EB8EE6+C1LSV5bt5ENOcnXAugkB/TJ0G+usedrOae787NRF5PGLaXKwhZcUz0h0uKcc1b3C18RlxNM/gqn2Fo4y9wUCOEIs8ArTk5l7vnmratbW+VMObraeIBcod1QbsEnCC+Cao4dWnel9z4kd1i8HsnF6yucobI4TQ9VoHEjbwxTMW1Y/plT3Wg6KvbPSR72JHeg13nafUkUb8+N8CDABdKT+Sgc4IvgAAAABJRU5ErkJggg==';

const SPIN_DURATION = 1000;

const ProgressHud = React.createClass({
    getDefaultProps () {
        return {
            color: '#000',
            overlayColor: 'rgba(0, 0, 0, 0)',
        };
    },
    getInitialState () {
        return {
            visible: false,
            rotate: new Animated.Value(0),
        };
    },
    showAnimate () {
        const { rotate, visible } = this.state;
        if (visible) {
            rotate.setValue(0);
            Animated.timing(rotate, {
                toValue: 1,
                duration: SPIN_DURATION,
                easing: Easing.linear,
                useNativeDriver: true,
            }).start(() => {
                this.showAnimate();
            });
        }
    },
    show () {
        this.setState({
            visible: true,
        }, () => {
            this.showAnimate();
        });
    },
    hide () {
        const { rotate } = this.state;
        rotate.stopAnimation(() => {
            rotate.setValue(0);
            this.setState({
                visible: false,
            });
        });
    },
    onPress () {
        if (this.props.close) {
            this.props.close();
        }
    },
    render () {
        const { visible, rotate } = this.state;
        if (!visible) {
            return <View />;
        }
        return (
            <TouchableHighlight
                key='ProgressHud'
                style={[styles.overlay, { backgroundColor: this.props.overlayColor }]}
                onPress={this.onPress}
                underlayColor={this.props.overlayColor}
                activeOpacity={1}
                >
                <View style={styles.container}>
                    <Animated.Image
                        style={[styles.spinner, {
                            transform: [{
                                rotate: rotate.interpolate({
                                    inputRange: [0, 1],
                                    outputRange: ['0deg', '360deg'],
                                }),
                            }],
                        }]}
                        source={{
                            uri: BACKGROUND_IMAGE,
                            isStatic: true,
                        }}
                         />
                    <Image
                        resizeMode='cover'
                        source={app.img.splash_logo}
                        style={styles.spinner_image} />
                </View>
            </TouchableHighlight>
        );
    },
});

const styles = StyleSheet.create({
    overlay: {
        alignItems: 'center',
        justifyContent: 'center',
        flex: 1,
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
    },
    container: {
        justifyContent: 'center',
        alignItems: 'center',
        width: 100,
        height: 100,
        borderRadius: 16,
    },
    spinner: {
        alignItems: 'center',
        justifyContent: 'center',
        width: 60,
        height: 60,
        borderRadius: 60 / 2,
    },
    spinner_image: {
        position: 'absolute',
        left: 26,
        top: 26,
        width: 48,
        height: 48,
        borderRadius: 48 / 2,
    },
});

module.exports = ProgressHud;

```

* PDShop/project/App/components/RText.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    Platform,
} = ReactNative;

const RText = React.createClass({
    render () {
        const { style, ...props } = this.props;
        const s = StyleSheet.flatten(style);
        const { lineHeight, fontSize } = s;
        const paddingVertical = (lineHeight - fontSize) / 2;
        return (
            <Text
                style={[{ paddingVertical }, style]}
                testID={this.props.testID}
                {...props}
                >
                {this.props.children}
            </Text>
        );
    },
});

module.exports = Platform.OS === 'android' ? RText : Text;

```

* PDShop/project/App/components/ScoreSelect.js

```js
'use strict';
import React from 'react';
import {
    View,
    ScrollView,
    InteractionManager,
} from 'react-native';

const ViewPager = React.createClass({
    componentWillMount () {
        this.count = this.props.children.length;
    },
    componentDidMount () {
        InteractionManager.runAfterInteractions(() => {
            this.scrollView.scrollTo({ x: sr.s(160) });
        });
    },
    onScroll (e) {
        // android incompatible
        if (!e.nativeEvent.contentOffset) {
            e.nativeEvent.contentOffset = { x: e.nativeEvent.position * this.props.width };
        }
        this.updateIndex(e.nativeEvent.contentOffset.x);
    },
    updateIndex (x) {
        const { width, afterChange } = this.props;
        const selectedIndex = Math.round(x / width);
        if (this.lastSelectedIndex !== selectedIndex && selectedIndex >= 0 && selectedIndex <= this.count - 1) {
            this.lastSelectedIndex = selectedIndex;
            if (afterChange) {
                afterChange(selectedIndex);
            }
        }
    },
    render () {
        const { width, height } = this.props;
        const pages = this.props.children.map((page, i) => {
            return (<View style={{ width, height }} key={i}>{page}</View>);
        });
        return (
            <ScrollView ref={(scrollView) => { this.scrollView = scrollView; }}
                horizontal
                pagingEnabled={false}
                scrollEventThrottle={10}
                removeClippedSubviews={false}
                automaticallyAdjustContentInsets={false}
                directionalLockEnabled
                showsHorizontalScrollIndicator={false}
                showsVerticalScrollIndicator={false}
                contentContainerStyle={this.props.style}
                onScroll={this.onScroll}>
                <View style={{ width, height }} />
                {pages}
                <View style={{ width, height }} />
            </ScrollView>
        );
    },
});

module.exports = ViewPager;

```

* PDShop/project/App/components/SelectRegionAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '所在地',
        rightButton: { title: '确定', handler: () => { app.scene.confirm(); } },
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    confirm (obj) {
        const { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        const { confirmAddress, isNeedSelectAll } = this.props;
        if (isNeedSelectAll) {
            if (!!lastObj && lastObj.isLeaf) {
                confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), allAddress.length >= 1 ? lastObj.code : 0);
                app.pop();
            } else {
                Toast('请选择完整到货地');
            }
        } else {
            confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), allAddress.length >= 1 ? lastObj.code : 0);
            app.pop();
        }
    },
    componentWillMount () {
        const { endPointLastCode } = this.props;
        !endPointLastCode || endPointLastCode == '' ? this.getRegionAddress(0) : this.getAddressFromLastCode(endPointLastCode);
    },
    getRegionAddress (parentCode) {
        const param = { userId: app.personal.info.userId, parentCode, type:0 };
        POST(app.route.ROUTE_GET_REGION_ADDRESS_LIST, param, this.getRegionAddressSuccess.bind(null, parentCode), false);
    },
    getRegionAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == 0 && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (addressLastCode) {
        const param = { userId: app.personal.info.userId, addressLastCode };
        POST(app.route.ROUTE_GET_ADDRESS_FROM_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getAddressTitleArray(data.context.addressList, addressLastCode), dataSource: data.context.addressList[0] || [] });
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        if (!!lastObj && lastObj.isLeaf) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) {
            this.props.confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), obj.code);
            app.pop();
        } else {
            this.getRegionAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getRegionAddress.bind(null, 0)}>
                        <Text style={styles.allAddress}>省市</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        <TouchableOpacity activeOpacity={1} style={styles.btnSelectAddress} >
                            <Text>选择地址</Text>
                        </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
});

```

* PDShop/project/App/components/SelectShortAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '短途地址',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    componentWillMount () {
        const { endPointLastCode, parentCode } = this.props;
        this.getAddressFromLastCode(parentCode, endPointLastCode);
    },
    getRegionAddress (parentCode) {
        const param = { userId: app.personal.info.userId, parentCode, type:1 };
        POST(app.route.ROUTE_GET_REGION_ADDRESS_LIST, param, this.getRegionAddressSuccess.bind(null, parentCode), false);
    },
    getRegionAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == this.props.parentCode && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (parentCode, addressLastCode) {
        const param = { userId: app.personal.info.userId, parentCode, addressLastCode };
        POST(app.route.ROUTE_GET_SEND_DOOR_ADDRESS_FROM_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getAddressTitleArray(data.context.addressList, addressLastCode), dataSource:data.context.addressList[0] || [] });
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        if (!!lastObj && lastObj.isLeaf) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) {
            this.props.confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), obj.code);
            app.pop();
        } else {
            this.getRegionAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        const { parentCode } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getRegionAddress.bind(null, parentCode)}>
                        <Text style={styles.allAddress}>区域</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        <TouchableOpacity
                            activeOpacity={1}
                            style={styles.btnSelectAddress}>
                            <Text>选择地址</Text>
                        </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
});

```

* PDShop/project/App/components/SelectStartPointAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '始发地',
        rightButton: { title: '确定', handler: () => { app.scene.confirm(); } },
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    componentWillMount () {
        const { endPointLastCode, id } = this.props;
        // const endPointLastCode = 520101;
        // const id = "59e426b1b6ee191fe5d4fbf8";
        !endPointLastCode || endPointLastCode == '' ? this.getStartPointAddress(0) : this.getAddressFromLastCode(endPointLastCode, id);
    },
    getStartPointAddress (parentCode) {
        const param = { userId: app.personal.info.userId, parentCode };
        POST(app.route.ROUTE_GET_START_POINT_ADDRESS_LIST, param, this.getStartPointAddressSuccess.bind(null, parentCode), false);
    },
    getStartPointAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == 0 && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (addressLastCode, id) {
        const param = { userId: app.personal.info.userId, addressLastCode, isLeaf: id ? true : false };
        POST(app.route.ROUTE_GET_START_POINT_ADDRESS_FROME_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode, id), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, id, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getStartPointTitleArray(data.context.addressList, addressLastCode, id), dataSource:data.context.addressList[0] || [] });
        }
    },
    confirm () {
        const { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        const { confirmAddress, isNeedSelectAll } = this.props;
        if (isNeedSelectAll) {
            if (!!lastObj && lastObj.isLeaf) {
                if (lastObj.isShop) {
                    confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), shopId:lastObj.id, lastCode:lastObj.addressRegionLastCode });
                } else if (lastObj.isAgent) {
                    confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), agentId:lastObj.id, lastCode:lastObj.addressRegionLastCode });
                }
                app.pop();
            } else {
                Toast('请选择完整到货地');
            }
        } else {
            confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), lastCode:lastObj.code });
            app.pop();
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        if (!!lastObj && lastObj.isLeaf) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) { // 省+市+名字
            if (obj.isShop) {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), shopId:obj.id, lastCode:obj.addressRegionLastCode });
            } else if (obj.isAgent) {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), agentId:obj.id, lastCode:obj.addressRegionLastCode });
            } else {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), lastCode:obj.code });
            }
            app.pop();
        } else {
            this.getStartPointAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        const { style } = this.props;
        return (
            <View style={style || styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getStartPointAddress.bind(null, 0)}>
                        <Text style={styles.allAddress}>省市</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        allAddress.length != 4 &&
                            <TouchableOpacity
                                activeOpacity={1}
                                style={styles.btnSelectAddress}>
                                <Text>选择地址</Text>
                            </TouchableOpacity>
                    }
                    {
                        !!style &&
                            <TouchableOpacity
                                activeOpacity={0.6}
                                onPress={this.confirm}
                                style={styles.btnConfirmAddress}>
                                <Text>确定</Text>
                            </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
    btnConfirmAddress:{
        paddingVertical:5,
        paddingHorizontal:10,
    },
});

```

* PDShop/project/App/components/Slider.js

```js
'use strict';

const React = require('react');const {    PropTypes,} = React;const ReactNative = require('react-native');
const {
  StyleSheet,
  PanResponder,
  View,
  Platform,
} = ReactNative;

const TRACK_SIZE = 4;
const THUMB_SIZE = 20;

function Rect (x, y, width, height) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
}

Rect.prototype.containsPoint = function (x, y) {
    return (x >= this.x
          && y >= this.y
          && x <= this.x + this.width
          && y <= this.y + this.height);
};

const Slider = React.createClass({
    propTypes: {
    /**
     * Initial value of the slider. The value should be between minimumValue
     * and maximumValue, which default to 0 and 1 respectively.
     * Default value is 0.
     *
     * *This is not a controlled component*, e.g. if you don't update
     * the value, the component won't be reset to its inital value.
     */
        value: PropTypes.number,

    /**
     * Initial minimum value of the slider. Default value is 0.
     */
        minimumValue: PropTypes.number,

    /**
     * Initial maximum value of the slider. Default value is 1.
     */
        maximumValue: PropTypes.number,

    /**
     * The color used for the track to the left of the button. Overrides the
     * default blue gradient image.
     */
        minimumTrackTintColor: PropTypes.string,

    /**
     * The color used for the track to the right of the button. Overrides the
     * default blue gradient image.
     */
        maximumTrackTintColor: PropTypes.string,

    /**
     * The color used for the thumb.
     */
        thumbTintColor: PropTypes.string,

    /**
     * The size of the touch area that allows moving the thumb.
     * The touch area has the same center has the visible thumb.
     * This allows to have a visually small thumb while still allowing the user
     * to move it easily.
     * The default is {width: 40, height: 40}.
     */
        thumbTouchSize: PropTypes.shape(
      { width: PropTypes.number, height: PropTypes.number }
    ),

    /**
     * Callback continuously called while the user is dragging the slider.
     */
        onValueChange: PropTypes.func,

    /**
     * Callback called when the user starts changing the value (e.g. when
     * the slider is pressed).
     */
        onSlidingStart: PropTypes.func,

    /**
     * Callback called when the user finishes changing the value (e.g. when
     * the slider is released).
     */
        onSlidingComplete: PropTypes.func,

    /**
     * The style applied to the slider container.
     */
        style: PropTypes.style,

    /**
     * The style applied to the track.
     */
        trackStyle: PropTypes.style,

    /**
     * The style applied to the thumb.
     */
        thumbStyle: PropTypes.style,

    /**
     * Set this to true to visually see the thumb touch rect in green.
     */
        debugTouchArea: PropTypes.bool,
    },
    getInitialState () {
        return {
            containerSize: {},
            trackSize: {},
            thumbSize: {},
            previousLeft: 0,
            value: this.props.value,
        };
    },
    getDefaultProps () {
        return {
            value: 0,
            minimumValue: 0,
            maximumValue: 1,
            minimumTrackTintColor: '#3f3f3f',
            maximumTrackTintColor: '#b3b3b3',
            thumbTintColor: '#343434',
            thumbTouchSize: { width: 40, height: 40 },
            debugTouchArea: false,
        };
    },
    componentWillMount () {
        this._panResponder = PanResponder.create({
            onStartShouldSetPanResponder: this._handleStartShouldSetPanResponder,
            onMoveShouldSetPanResponder: this._handleMoveShouldSetPanResponder,
            onPanResponderGrant: this._handlePanResponderGrant,
            onPanResponderMove: this._handlePanResponderMove,
            onPanResponderRelease: this._handlePanResponderEnd,
            onPanResponderTerminate: this._handlePanResponderEnd,
        });
    },
    componentWillReceiveProps (nextProps) {
        this.setState({ value: nextProps.value });
    },
    render () {
        const {
      minimumTrackTintColor,
      maximumTrackTintColor,
      thumbTintColor,
      styles,
      style,
      trackStyle,
      thumbStyle,
      debugTouchArea,
      ...other
    } = this.props;
        const { value, containerSize, trackSize, thumbSize } = this.state;
        const mainStyles = styles || defaultStyles;
        const thumbLeft = this._getThumbLeft(value);
        const valueVisibleStyle = {};
        if (containerSize.width === undefined
        || trackSize.width === undefined
        || thumbSize.width === undefined) {
            valueVisibleStyle.opacity = 0;
        }

        const minimumTrackStyle = {
            position: 'absolute',
            width: 300, // needed to workaround a bug for borderRadius
            marginTop: -trackSize.height,
            backgroundColor: minimumTrackTintColor,
            ...valueVisibleStyle,
        };

        if (thumbLeft >= 0 && thumbSize.width >= 0) {
            minimumTrackStyle.width = thumbLeft + thumbSize.width / 2;
        }

        const touchOverflowStyle = this._getTouchOverflowStyle();

        return (
            <View style={{ flex:1, justifyContent:'center' }}>
                <View
                    {...other}
                    style={[mainStyles.container, style]}
                    onLayout={this._measureContainer}>
                    <View
                        style={[{ backgroundColor: maximumTrackTintColor }, mainStyles.track, trackStyle]}
                        onLayout={this._measureTrack} />
                    <View style={[mainStyles.track, trackStyle, minimumTrackStyle]} />
                </View>
                <View
                    ref={(thumb) => { this.thumb = thumb; }}
                    onLayout={this._measureThumb}
                    style={[
                    { backgroundColor: thumbTintColor, marginTop: -(trackSize.height + thumbSize.height) / 2 },
                        mainStyles.thumb, thumbStyle, { left: thumbLeft, ...valueVisibleStyle },
                    ]}
                />
                <View
                    style={[defaultStyles.touchArea, touchOverflowStyle]}
                    {...this._panResponder.panHandlers}>
                    {debugTouchArea === true && this._renderDebugThumbTouchRect()}
                </View>
            </View>
        );
    },

    _handleStartShouldSetPanResponder (e: Object, /* gestureState: Object */): boolean {
    // Until the PR https://github.com/facebook/react-native/pull/3426 is merged, we need to always return "true" for android
        if (Platform.OS === 'android') {
            return true;
        }
    // Should we become active when the user presses down on the thumb?
        return this._thumbHitTest(e);
    },

    _handleMoveShouldSetPanResponder (/* e: Object, gestureState: Object */): boolean {
    // Should we become active when the user moves a touch over the thumb?
        return false;
    },

    _handlePanResponderGrant (/* e: Object, gestureState: Object */) {
        this.setState({ previousLeft: this._getThumbLeft(this.state.value) },
      this._fireChangeEvent.bind(this, 'onSlidingStart'));
    },
    _handlePanResponderMove (e: Object, gestureState: Object) {
        this.setState({ value: this._getValue(gestureState) },
      this._fireChangeEvent.bind(this, 'onValueChange'));
    },
    _handlePanResponderEnd (e: Object, gestureState: Object) {
        this.setState({ value: this._getValue(gestureState) },
      this._fireChangeEvent.bind(this, 'onSlidingComplete'));
    },

    _measureContainer (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const containerSize = { width: width, height: height };
        this.setState({ containerSize: containerSize });
    },

    _measureTrack (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const trackSize = { width: width, height: height };
        this.setState({ trackSize: trackSize });
    },

    _measureThumb (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const thumbSize = { width: width, height: height };
        this.setState({ thumbSize: thumbSize });
    },

    _getRatio (value: number) {
        return (value - this.props.minimumValue) / (this.props.maximumValue - this.props.minimumValue);
    },

    _getThumbLeft (value: number) {
        const ratio = this._getRatio(value);
        return ratio * (this.state.containerSize.width - this.state.thumbSize.width);
    },

    _getValue (gestureState: Object) {
        const length = this.state.containerSize.width - this.state.thumbSize.width;
        const thumbLeft = Math.min(length,
      Math.max(0, this.state.previousLeft + (this.props.vertical ? gestureState.dy : gestureState.dx)));

        const ratio = thumbLeft / length;
        return ratio * (this.props.maximumValue - this.props.minimumValue) + this.props.minimumValue;
    },

    _fireChangeEvent (event) {
        if (this.props[event]) {
            this.props[event](this.state.value);
        }
    },

    _getTouchOverflowSize () {
        const state = this.state;
        const props = this.props;

        const size = {};
        if (state.containerSize.width !== undefined
        && state.thumbSize.width !== undefined) {
            size.width = Math.max(0, props.thumbTouchSize.width - state.thumbSize.width);
            size.height = Math.max(0, props.thumbTouchSize.height - state.containerSize.height);
        }

        return size;
    },

    _getTouchOverflowStyle () {
        const { width, height } = this._getTouchOverflowSize();

        const touchOverflowStyle = {};
        if (width !== undefined && height !== undefined) {
            const verticalMargin = -height / 2;
            touchOverflowStyle.marginTop = verticalMargin;
            touchOverflowStyle.marginBottom = verticalMargin;

            const horizontalMargin = -width / 2;
            touchOverflowStyle.marginLeft = horizontalMargin;
            touchOverflowStyle.marginRight = horizontalMargin;
        }

        if (this.props.debugTouchArea === true) {
            touchOverflowStyle.backgroundColor = 'orange';
            touchOverflowStyle.opacity = 0.5;
        }

        return touchOverflowStyle;
    },

    _thumbHitTest (e: Object) {
        const nativeEvent = e.nativeEvent;
        const thumbTouchRect = this._getThumbTouchRect();
        return thumbTouchRect.containsPoint(nativeEvent.locationX, nativeEvent.locationY);
    },

    _getThumbTouchRect () {
        const state = this.state;
        const props = this.props;
        const touchOverflowSize = this._getTouchOverflowSize();

        return new Rect(
      touchOverflowSize.width / 2 + this._getThumbLeft(state.value) + (state.thumbSize.width - props.thumbTouchSize.width) / 2,
      touchOverflowSize.height / 2 + (state.containerSize.height - props.thumbTouchSize.height) / 2,
      props.thumbTouchSize.width,
      props.thumbTouchSize.height
    );
    },

    _renderDebugThumbTouchRect () {
        const thumbTouchRect = this._getThumbTouchRect();
        const positionStyle = {
            left: thumbTouchRect.x,
            top: thumbTouchRect.y,
            width: thumbTouchRect.width,
            height: thumbTouchRect.height,
        };

        return (
            <View
                style={[defaultStyles.debugThumbTouchArea, positionStyle]}
                pointerEvents='none'
      />
        );
    },
});

const defaultStyles = StyleSheet.create({
    container: {
        height: 40,
        justifyContent: 'center',
    },
    track: {
        height: TRACK_SIZE,
        borderRadius: TRACK_SIZE / 2,
    },
    thumb: {
        position: 'absolute',
        width: THUMB_SIZE,
        height: THUMB_SIZE,
        borderRadius: THUMB_SIZE / 2,
    },
    touchArea: {
        position: 'absolute',
        backgroundColor: 'transparent',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
    },
    debugThumbTouchArea: {
        position: 'absolute',
        backgroundColor: 'green',
        opacity: 0.5,
    },
});

module.exports = Slider;

```

* PDShop/project/App/components/StarBar.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    View,
    StyleSheet,
} = ReactNative;

const MAX_STAR_NUM = 5;

module.exports = React.createClass({
    render () {
        const value = this.props.value;
        const starNum = Math.floor(value);
        const rest = value - starNum;
        const list = [];
        let i;
        for (i = 0; i < starNum; i++) {
            list[i] = 1;
        }
        if (i < MAX_STAR_NUM) {
            list[i] = rest <= 0.31 ? 2 : rest >= 0.69 ? 1 : 3;
            while (++i < MAX_STAR_NUM) {
                list[i] = 2;
            }
        }
        return (
            <View style={this.props.style ? this.props.style : styles.scoreIconContainer}>
                {
                    list.map((item, i) => {
                        const imgSource = app.img['actualCombat_star_' + item];
                        return (
                            <Image
                                key={i}
                                resizeMode='stretch'
                                source={imgSource}
                                style={this.props.starStyle ? this.props.starStyle : styles.scoreIcon}
                                />
                        );
                    })
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    scoreIconContainer: {
        height: 30,
        flexDirection: 'row',
        justifyContent: 'center',
    },
    scoreIcon: {
        marginLeft: 3,
        width: 20,
        height: 20,
    },
});

```

* PDShop/project/App/components/TouchAbleLink.js

```js
import React, { Component } from 'react';
import {
    Text,
    Linking,
    TouchableOpacity,
} from 'react-native';

// 打电话：url->("tel:10086")
// 发邮件：url->("mailto:10086@qq.com")
// 打开网站:url->("http://www.baidu.com")
module.exports = React.createClass ({
    render () {
        const {url, style, children} = this.props;
        return (
            <TouchableOpacity style={style} onPress={() => {
                Linking.canOpenURL(url).then(supported => {
                    if (!supported) {
                        console.log('Can\'t handle url: ' + url);
                    } else {
                        return Linking.openURL(url);
                    }
                }).catch(err => console.error('An error occurred', err));
            }}>
                {children}
            </TouchableOpacity>

        );
    }
});

```

* PDShop/project/App/components/WebviewMessageBox.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    WebView,
    Text,
} = ReactNative;

const Button = require('./Button');

module.exports = React.createClass({
    render () {
        return (
            <View style={styles.overlayContainer}>
                {
                    !this.props.title &&
                    <View style={[styles.title, { backgroundColor: app.setting.THEME_COLOR }]}>
                        <View style={[styles.titleContainer, { marginTop: sr.trueStatusBarHeight }]}>
                            <Text style={styles.titleText}>
                                {this.props.title}
                            </Text>
                        </View>
                    </View>
                }
                <View style={[styles.container, { top: sr.totalNavbarHeight + sr.statusBarHeight }]}>
                    <WebView
                        style={styles.webview}
                        source={{ uri:this.props.webAddress }}
                        scalesPageToFit
                        />
                    <Button
                        onPress={app.closeModal}
                        style={styles.contentButton}
                        textStyle={styles.contentButtonText}>
                        返回</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    overlayContainer: {
        position:'absolute',
        top: 0,
        bottom: 0,
        left:0,
        right: 0,
        backgroundColor: 'transparent',
    },
    title: {
        height:sr.totalNavbarHeight,
        width: sr.w,
    },
    titleContainer: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    titleText: {
        fontSize: 18,
        color: 'gray',
        fontWeight: '500',
    },
    container: {
        width:sr.w * 5 / 6,
        height:sr.h * 4 / 5,
        alignItems:'center',
        justifyContent:'center',
        borderRadius:10,
        position: 'absolute',
        left: sr.w * 1 / 12,
    },
    webview: {
        width:sr.w * 5 / 6,
        height:sr.h * 4 / 5 - 50,
    },
    contentButton: {
        width:sr.w * 5 / 6,
        height:50,
        borderRadius:0,
    },
    contentButtonText: {
        color: '#000000',
        fontWeight: '800',
    },
});

```

* PDShop/project/App/components/index.js

```js
module.exports = {
    Button: require('./Button'),
    PageList: require('./PageList'),
    ActionSheet: require('./ActionSheet/index'),
    CustomSheet: require('./CustomSheet'),    ClipRect: require('./ClipRect'),
    Modal: require('./Modal'),
    DImage: require('./DImage'),
    Label: require('./Label'),
    ProgressBar: require('./ProgressBar'),
    Slider: require('./Slider'),
    MessageBox: require('./MessageBox'),
    CustomMessageBox: require('./CustomMessageBox'),
    WebviewMessageBox: require('./WebviewMessageBox'),
    DelayTouchableOpacity: require('./DelayTouchableOpacity'),
    StarBar: require('./StarBar'),
    ProgressHud: require('./ProgressHud'),
    RText: require('./RText'),
    ScoreSelect: require('./ScoreSelect'),
    AutogrowInput: require('./AutogrowInput'),
    TouchAbleLink: require('./TouchAbleLink'),
    Picker: require('./Picker'),
    SelectRegionAddress: require('./SelectRegionAddress'),
    SelectStartPointAddress: require('./SelectStartPointAddress'),
    SelectShortAddress: require('./SelectShortAddress'),
};

```

* PDShop/project/App/config/Authority.js

```js
// 注意：常量部分必须和服务器保持一致
// 总部权限
const AH_CREATE_BRANCH_SHOP = 0; // 创建分店的权限
const AH_MODIFY_BRANCH_SHOP = 1; // 修改分店信息的权限
const AH_REMOVE_BRANCH_SHOP = 2; // 删除分店的权限
const AH_LOOK_BRANCH_SHOP = 3; // 查看分店列表的权限
const AH_MODIFY_SETTING = 4; // 修改设置的权限
const AH_CREATE_AGENT = 5; // 创建收货点的权限
const AH_MODIFY_AGENT = 6; // 修改收货点的权限
const AH_REMOVE_AGENT = 7; // 删除收货点的权限
const AH_LOOK_AGENT = 8; // 查看收货点的权限

// 公共权限
const AH_MODIFY_OWN_SHOP = 10000; // 修改所在物流超市信息的权限
const AH_CREATE_MEMBER = 10001; // 创建成员的权限
const AH_MODIFY_MEMBER = 10002; // 修改成员信息的权限
const AH_REMOVE_MEMBER = 10003; // 删除成员的权限
const AH_LOOK_MEMBER = 10004; // 查看成员的权限
const AH_RECHARGE = 10005; // 充值的权限
const AH_WITHDRAW = 10006; // 充值的权限
const AH_LOOK_AMOUNT = 10007; // 查看余额的权限
const AH_MODIFY_ROADMAP_PROFIT_RATE = 10008; // 修改路线的提成
const AH_LOOK_STATISTICS = 10009; // 查看统计信息的权限
const AH_LOOK_ORDERS = 10010; // 查看综合货单的权限

// 分店权限
const AH_CREATE_SHIPPER = 20000; // 创建物流公司的权限
const AH_MODIFY_SHIPPER = 20001; // 修改物流公司的权限
const AH_REMOVE_SHIPPER = 20002; // 删除物流公司的权限
const AH_LOOK_SHIPPER = 20003; // 查看物流公司的权限
const AH_CREATE_PARTMENT = 20004; // 创建部门的权限
const AH_MODIFY_PARTMENT = 20005; // 修改部门信息的权限
const AH_REMOVE_PARTMENT = 20006; // 删除部门的权限
const AH_LOOK_PARTMENT = 20007; // 查看部门的权限
const AH_MODIFY_OWN_PARTMENT = 20008; // 修改所在部门信息的权限
const AH_RECEIVE_PARTMENT = 20009; // 收货的权限（收货部人员）
const AH_WARE_HOUSE_PARTMENT = 20010; // 库管的权限（库管部人员）
const AH_CARRY_PARTMENT = 20011; // 搬货的权限（搬运部人员）
const AH_SECURITY_CHECK_PARTMENT = 20012; // 安检的权限（保安部人员）
const AH_DISTRIBUTION_PARTMENT = 20013; // 配送的权限（配送部人员）
const AH_TO_EXAMINE_TRUCK = 20014; // 审核货车的权限

// 物流公司
const AH_MODIFY_SHIPPER_INFO = 30000; // 修改物流公司信息的权限
const AH_MODIFY_SHIPPER_MEMBER_AUTHORITY = 30001; // 修改物流公司成员权限的权限
const AH_CREATE_ROADMAP = 30002; // 创建路线的权限
const AH_MODIFY_ROADMAP = 30003; // 修改路线的权限
const AH_REMOVE_ROADMAP = 30004; // 删除路线的权限
const AH_LOOK_ROADMAP = 30005; // 查看路线的权限
const AH_CREATE_TRUCK = 30006; // 创建货车的权限
const AH_MODIFY_TRUCK = 30007; // 修改货车的权限
const AH_REMOVE_TRUCK = 30008; // 删除货车的权限
const AH_LOOK_TRUCK = 30009; // 查看货车的权限
const SELECT_CARRY_PARTMENT = 30010; // 选择搬运队的权限
const AH_SCAN_LOAD_TRUCK = 30011; // 扫描装车的权限

// 收货点
const AH_MODIFY_AGENT_INFO = 40000; // 修改收货点信息的权限
const AH_MODIFY_AGENT_MEMBER_AUTHORITY = 40001; // 修改收货点成员权限的权限
const AH_PLACE_ORDER = 40002; // 收货点下单的权限

module.exports = {
    // 总部权限
    AH_CREATE_BRANCH_SHOP,
    AH_MODIFY_BRANCH_SHOP,
    AH_REMOVE_BRANCH_SHOP,
    AH_LOOK_BRANCH_SHOP,
    AH_MODIFY_SETTING,
    AH_CREATE_AGENT,
    AH_MODIFY_AGENT,
    AH_REMOVE_AGENT,
    AH_LOOK_AGENT,

    // 公共权限
    AH_MODIFY_OWN_SHOP,
    AH_CREATE_MEMBER,
    AH_MODIFY_MEMBER,
    AH_REMOVE_MEMBER,
    AH_LOOK_MEMBER,
    AH_RECHARGE,
    AH_WITHDRAW,
    AH_LOOK_AMOUNT,
    AH_MODIFY_ROADMAP_PROFIT_RATE,
    AH_LOOK_STATISTICS,
    AH_LOOK_ORDERS,

    // 分店权限
    AH_CREATE_SHIPPER,
    AH_MODIFY_SHIPPER,
    AH_REMOVE_SHIPPER,
    AH_LOOK_SHIPPER,
    AH_CREATE_PARTMENT,
    AH_MODIFY_PARTMENT,
    AH_REMOVE_PARTMENT,
    AH_LOOK_PARTMENT,
    AH_MODIFY_OWN_PARTMENT,
    AH_RECEIVE_PARTMENT,
    AH_WARE_HOUSE_PARTMENT,
    AH_CARRY_PARTMENT,
    AH_SECURITY_CHECK_PARTMENT,
    AH_DISTRIBUTION_PARTMENT,
    AH_TO_EXAMINE_TRUCK,

    // 物流公司
    AH_MODIFY_SHIPPER_INFO,
    AH_MODIFY_SHIPPER_MEMBER_AUTHORITY,
    AH_CREATE_ROADMAP,
    AH_MODIFY_ROADMAP,
    AH_REMOVE_ROADMAP,
    AH_LOOK_ROADMAP,
    AH_CREATE_TRUCK,
    AH_MODIFY_TRUCK,
    AH_REMOVE_TRUCK,
    AH_LOOK_TRUCK,
    SELECT_CARRY_PARTMENT,
    AH_SCAN_LOAD_TRUCK,

    // 收货点
    AH_MODIFY_AGENT_INFO,
    AH_MODIFY_AGENT_MEMBER_AUTHORITY,
    AH_PLACE_ORDER,

    // mapper
    MAP: {
        // 总部权限
        [AH_CREATE_BRANCH_SHOP]: '创建分店的权限',
        [AH_MODIFY_BRANCH_SHOP]: '修改分店信息的权限',
        [AH_REMOVE_BRANCH_SHOP]: '删除分店的权限',
        [AH_LOOK_BRANCH_SHOP]: '查看分店的权限',
        [AH_MODIFY_SETTING]: '修改设置的权限',
        [AH_CREATE_AGENT]: '创建收货点的权限',
        [AH_MODIFY_AGENT]: '修改收货点的权限',
        [AH_REMOVE_AGENT]: '删除收货点的权限',
        [AH_LOOK_AGENT]: '查看收货点的权限',

        // 公共权限
        [AH_MODIFY_OWN_SHOP]: '修改自身店铺信息的权限',
        [AH_CREATE_MEMBER]: '创建成员的权限',
        [AH_MODIFY_MEMBER]: '修改成员信息的权限',
        [AH_REMOVE_MEMBER]: '删除成员的权限',
        [AH_LOOK_MEMBER]: '查看成员的权限',
        [AH_RECHARGE]: '充值的权限',
        [AH_WITHDRAW]: '提现的权限',
        [AH_LOOK_AMOUNT]: '查看余额的权限',
        [AH_MODIFY_ROADMAP_PROFIT_RATE]: '修改路线的提成的权限',
        [AH_LOOK_STATISTICS]: '查看统计信息的权限',
        [AH_LOOK_ORDERS]: '查看综合货单的权限',

        // 分店权限
        [AH_CREATE_SHIPPER]: '创建物流公司',
        [AH_MODIFY_SHIPPER]: '修改物流公司',
        [AH_REMOVE_SHIPPER]: '删除物流公司',
        [AH_LOOK_SHIPPER]: '查看物流公司',
        [AH_CREATE_PARTMENT]: '创建部门的权限',
        [AH_MODIFY_PARTMENT]: '修改部门信息的权限',
        [AH_REMOVE_PARTMENT]: '删除部门的权限',
        [AH_LOOK_PARTMENT]: '查看部门的权限',
        [AH_MODIFY_OWN_PARTMENT]: '修改所在部门信息的权限',
        [AH_RECEIVE_PARTMENT]: '收货的权限',
        [AH_WARE_HOUSE_PARTMENT]: '库管的权限',
        [AH_CARRY_PARTMENT]: '搬货的权限',
        [AH_SECURITY_CHECK_PARTMENT]: '安检的权限',
        [AH_DISTRIBUTION_PARTMENT]: '配送的权限',
        [AH_TO_EXAMINE_TRUCK]: '审核货车的权限',

        // 物流公司
        [AH_MODIFY_SHIPPER_INFO]: '修改物流公司信息的权限',
        [AH_MODIFY_SHIPPER_MEMBER_AUTHORITY]: '修改物流公司成员权限的权限',
        [AH_CREATE_ROADMAP]: '创建路线的权限',
        [AH_MODIFY_ROADMAP]: '修改路线的权限',
        [AH_REMOVE_ROADMAP]: '删除路线的权限',
        [AH_LOOK_ROADMAP]: '查看路线的权限',
        [AH_CREATE_TRUCK]: '创建货车的权限',
        [AH_MODIFY_TRUCK]: '修改货车的权限',
        [AH_REMOVE_TRUCK]: '删除货车的权限',
        [AH_LOOK_TRUCK]: '查看货车的权限',
        [SELECT_CARRY_PARTMENT]: '选择搬运队的权限',
        [AH_SCAN_LOAD_TRUCK]: '扫描装车的权限',

        // 收货点
        [AH_MODIFY_AGENT_INFO]: '修改收货点信息的权限',
        [AH_MODIFY_AGENT_MEMBER_AUTHORITY]: '修改收货点成员权限的权限',
        [AH_PLACE_ORDER]: '收货点下单的权限',
    },
};

```

* PDShop/project/App/config/Color.js

```js
'use strict';

module.exports = {
    _c (style, color) {
        return [style, { color: color || app.setting.THEME_COLOR }];
    },
    _bc (style, color) {
        return [style, { backgroundColor:color || app.setting.THEME_COLOR }];
    },
    _tc (style, color) {
        return [style, { tintColor: color || app.setting.THEME_COLOR }];
    },
};

```

* PDShop/project/App/config/Constants.js

```js
'use strict';

// 该文件永远不要提交svn
// 发布正式服务器的配置，svn上面永远不要动这个配置，在发布测试服务器的时候将ISSUE改为false
// 如果发布ios时 ISSUE_IOS=true 其他的发布为 ISSUE_IOS=false
// CHANNEL为android渠道，发布百度市场时为baidu,其他的为default,ios忽略这个选项
const CONFIG = {
    ISSUE: false,
    ISSUE_IOS: false,
    CHANNEL: 'default',
};

// 发布测试服务器的配置，该配置只有 CONFIG.ISSUE 为 false 的时候才生效
// 如果是本地开发模式， CONFIG.ISSUE = false， TEST_CONFIG.ISSUE = false, 同时可以修改调试的服务器
// 如果是发布测试服务器， CONFIG.ISSUE = false，TEST_CONFIG.ISSUE = true
const TEST_CONFIG = {
    ISSUE: true,
    BASE_SERVER_INDEX: 0, // 只有 TEST_CONFIG.ISSUE 为 false时生效
};

// web服务器 依次是本地服务器， 测试服务器， 正式服务器
const BASE_SERVERS = ['192.168.1.222:3000', '192.168.1.189', '120.78.65.221'];
const BASE_SERVER = CONFIG.ISSUE ? BASE_SERVERS[2] : TEST_CONFIG.ISSUE ? BASE_SERVERS[1] : BASE_SERVERS[TEST_CONFIG.BASE_SERVER_INDEX];

module.exports = {
    APP_NAME: '四面通分店端',
    THEME_COLORS: ['#c81622', '#A62045', '#239FDB'],
    ISSUE_IOS: CONFIG.ISSUE_IOS,
    NOT_NEED_UPDATE_JS_START: !(CONFIG.ISSUE || TEST_CONFIG.ISSUE), // 启动时不需要更新小版本
    MINIFY: CONFIG.ISSUE, // 是否压缩js文件，我们采取测试服务器为了查找问题不用压缩js文件，正式服务器需要压缩js文件，并且不能看到调试信息
    CHANNEL: CONFIG.CHANNEL,
    RATE: 1,  //倍率
    // IOS的appid,1096525384
    IOS_APPID: '',
    BASE_SERVER: BASE_SERVER, // web服务器地址
    // 获取验证码的超时时间
    DEFAULT_CODE_TIMEOUT: 90,
    // 分页列表每页数据的条数
    PER_PAGE_COUNT: 10,
    NAME_MAX_LENGTH: 10,
    ADDRESS_MAX_LENGTH: 30,
    VERIFICATION_MAX_LENGTH: 6,
    AMOUNT_MAX_LENGTH: 7,
    FEEDBACK_MAX_LENGTH: 500,
    QRCODE_TYPE_ORDER:1,
    QRCODE_TYPE_DRIVER:2,
};

```

* PDShop/project/App/config/OrderState.js

```js
// 注意：常量部分必须和服务器保持一致
// 订单的状态
/*
===========
长途运输状态图:
(0->)1->2->5    |
                |->6->7->8(->11)->14->15
(0->)1->3->4->5 |
===========
收货点状态图:
0->2->9    |
           |(->10)->11->14->15
0->3->4->9 |
===========
同城配送状态图: (当同城配送的在运输中，那么它之前的货单就在待交货状态)
(0->)1->2    |
             |->6->8->15
(0->)1->3->4 |
===========
上门自提状态图:(当上门自提的在运输中或者等待上门自提，那么它之前的货单就在待交货状态)
      |->13->15
1->12 |
      |->6->8->15
*/
const OS_PREORDER = -1; // 预下单状态，需要将货拉到分店后不显示（件数，重量，方量），由收货员填写确认后进入待选线路状态
const OS_READY_PRINT_BAR_CODE = 0; // 待打印二维码
const OS_READY_SELECT_ROADMAP = 1; // 待选物流公司
const OS_READY_DEDUCT_AND_PRINT_ORDER = 2; // 待扣款并打印打印货单（用来区别需要付款的情况）
const OS_READY_PAYMENT = 3; // 待付款
const OS_READY_PRINT_ORDER = 4; // 待打印货单
const OS_READY_STOCK = 5; // 待库存
const OS_READY_LOAD = 6; // 待装车
const OS_READY_START_OFF = 7; // 待出发
const OS_ON_THE_WAY = 8; // 运输中
const OS_READY_SEND = 9; // 待发货 (收货点专用)
const OS_ON_SENDING = 10; // 发货中 (收货点专用)
const OS_ON_TRANSFER = 11; // 中转中
const OS_READY_PHONE_CONFIRM = 12; // 待打电话确认
const OS_WAIT_CLIENT_PICK = 13; // 等待上门自提
const OS_READY_RECEIVE = 14; // 待交货
const OS_RECEIVE_SUCCESS = 15; // 交货成功

module.exports = {
    OS_PREORDER,
    OS_READY_PRINT_BAR_CODE,
    OS_READY_SELECT_ROADMAP,
    OS_READY_DEDUCT_AND_PRINT_ORDER,
    OS_READY_PAYMENT,
    OS_READY_PRINT_ORDER,
    OS_READY_STOCK,
    OS_READY_LOAD,
    OS_READY_START_OFF,
    OS_ON_THE_WAY,
    OS_READY_SEND,
    OS_ON_SENDING,
    OS_ON_TRANSFER,
    OS_READY_PHONE_CONFIRM,
    OS_WAIT_CLIENT_PICK,
    OS_READY_RECEIVE,
    OS_RECEIVE_SUCCESS,

    // mapper
    MAP: {
        [OS_PREORDER]: '预下单状态',
        [OS_READY_PRINT_BAR_CODE]: '待打印二维码',
        [OS_READY_SELECT_ROADMAP]: '待选线路',
        [OS_READY_DEDUCT_AND_PRINT_ORDER]: '待打印收据',
        [OS_READY_PAYMENT]: '待付款',
        [OS_READY_PRINT_ORDER]: '待打印收据',
        [OS_READY_STOCK]: '待库存',
        [OS_READY_LOAD]: '待装车',
        [OS_READY_START_OFF]: '待出发',
        [OS_ON_THE_WAY]: '运输中',
        [OS_READY_SEND]: '待发货',
        [OS_ON_SENDING]: '发货中',
        [OS_ON_TRANSFER]: '运输中',
        [OS_READY_PHONE_CONFIRM]: '待打电话确认',
        [OS_WAIT_CLIENT_PICK]: '等待上门自提',
        [OS_READY_RECEIVE]: '待交货',
        [OS_RECEIVE_SUCCESS]: '交货成功',
    },
};

```

* PDShop/project/App/config/Partment.js

```js
// 注意：常量部分必须和服务器保持一致
const SP_RECEIVE_PARTMENT = 0; // 收货部
const SP_WARE_HOUSE_PARTMENT = 1; // 库管部
const SP_CARRY_PARTMENT = 2; // 搬运部
const SP_SECURITY_CHECK_PARTMENT = 3; // 保安部
const SP_DISTRIBUTION_PARTMENT = 4; // 同城配送部

module.exports = {
    SP_RECEIVE_PARTMENT,
    SP_WARE_HOUSE_PARTMENT,
    SP_CARRY_PARTMENT,
    SP_SECURITY_CHECK_PARTMENT,
    SP_DISTRIBUTION_PARTMENT,

    // mapper
    MAP: {
        [SP_RECEIVE_PARTMENT]: '收货部',
        [SP_WARE_HOUSE_PARTMENT]: '库管部',
        [SP_CARRY_PARTMENT]: '搬运部',
        [SP_SECURITY_CHECK_PARTMENT]: '保安部',
        [SP_DISTRIBUTION_PARTMENT]: '同城配送部',
    },
};

```

* PDShop/project/App/config/Position.js

```js
const PO_CHAIR_MAN = '董事长';
const PO_PARTMENT_CHARGE_MAN = '部门经理';
const PO_CEO = '总经理';
const PO_PARTMENT_LEADER = '部门主管';
const PO_STAFF = '员工';

module.exports = {
    PO_CHAIR_MAN,
    PO_PARTMENT_CHARGE_MAN,
    PO_CEO,
    PO_PARTMENT_LEADER,
    PO_STAFF,

    // 公司职位
    SHOP_MAP: [PO_STAFF, PO_CEO, PO_PARTMENT_LEADER],
    // 部门职位
    PARTMENT_MAP: [PO_STAFF],
};

```

* PDShop/project/App/config/Route.js

```js
'use strict';

const { BASE_SERVER } = CONSTANTS;
const ROOT_SERVER = 'http://' + BASE_SERVER + '/';
const API_SERVER = ROOT_SERVER + 'api/';
const SERVER = API_SERVER + 'shop/';

module.exports = {
    // 登录
    ROUTE_REGISTER: SERVER + 'register', // 注册
    ROUTE_LOGIN: SERVER + 'login', // 登录
    ROUTE_FIND_PASSWORD: SERVER + 'findPassword', // 忘记密码
    ROUTE_MODIFY_PASSWORD: SERVER + 'modifyPassword', // 修改密码

    // 个人中心
    ROUTE_GET_PERSONAL_INFO: SERVER + 'getPersonalInfo', // 获取个人信息
    ROUTE_MODIFY_PERSONAL_INFO: SERVER + 'modifyPersonalInfo', // 修改个人信息
    ROUTE_MODIFY_OWN_PARTMENT: SERVER + 'modifyOwnPartment', // 修改搬运队信息
    ROUTE_SUBMIT_FEEDBACK: SERVER + 'submitFeedback', // 提交信息反馈
    ROUTE_GET_REGION_ADDRESS_LIST: API_SERVER + 'getRegionAddress', // 获取地址列表
    ROUTE_GET_START_POINT_ADDRESS_LIST: API_SERVER + 'getStartPointAddress', // 获取地址列表
    ROUTE_GET_GETANDOUT_LIST: SERVER + 'getAndOutList', // 获取收支列表
    ROUTE_GET_SHIPPERLIST_LIST: SERVER + 'shipperList', // 获取分店列表
    ROUTE_GET_BILL_LIST: SERVER + 'getBillList', // 获取交易明细列表
    ROUTE_RECHARGE:SERVER + 'recharge', // 充值
    ROUTE_WITHDRAW:SERVER + 'withdraw', // 提现
    ROUTE_GET_REMAIN_AMOUNT: SERVER + 'getRemainAmount', // 获取账户余额
    ROUTE_SET_PAYMENT_PASSWORD: SERVER + 'setPaymentPassword', // 修改支付密码
    ROUTE_REQUEST_SEND_VERIFY_CODE: API_SERVER + 'requestSendVerifyCode', // 获取验证码
    ROUTE_MODIFY_SETTING_INFO:SERVER + 'modifySettingInfo', // 董事长修改各项参数

    // 分店
    ROUTE_GET_ORDERS_BY_WAREHOUSE_PARTMENT: SERVER + 'getOrdersByWareHousePartment', // 库管部获取货单
    ROUTE_GET_ORDERS_BY_RECEIVE_PARTMENT: SERVER + 'getOrdersByReceivePartment', // 收货部获取货单
    ROUTE_PLACE_STORAGE: SERVER + 'placeStorage', // 库管部扫描入库
    ROUTE_GET_LASTEST_ORDER_BY_RECIEVE_PARTMENT: SERVER + 'getLastestOrderByReceivePartment', // 收货部获取未上传照片的货单
    ROUTE_SET_PHOTO_FOR_ORIGIN_ORDER: SERVER + 'setPhotoForOriginOrder', // 收货部为货单上传照片
    ROUTE_GET_MEMBER_LIST: SERVER + 'getMemberList', // 获取成员列表
    ROUTE_CREATE_MEMBER: SERVER + 'createMember', // 创建成员
    ROUTE_GET_OWN_PARTMENT_INFO: SERVER + 'getOwnPartmentInfo', // 获取部门信息
    ROUTE_GET_ORDER_DETAIL: SERVER + 'getOrderDetail', // 收货部货单详情
    ROUTE_PLACE_TRANSFER_ORDER: SERVER + 'placeTransferOrder', // 收货部扫描下中转货单
    ROUTE_CHECK_TRUCK_PASS: SERVER + 'checkTruckPass', // 保安部检查放行
    ROUTE_MODIFY_MEMBER: SERVER + 'modifyMember', // 分店创建成员
    ROUTE_GET_WAIT_SCAN_TRUCK_INFO: SERVER + 'getWaitScanTruckInfo', // 获取等待扫描装车的货车信息
    ROUTE_GET_CARRY_LIST: SERVER + 'getCarryList', // 获取搬运历史消息
    ROUTE_GET_ORDER_LIST_IN_RUCKS: SERVER + 'getOrderListInTruck', // 获取搬运货车货单列表
    ROUTE_GET_STATISTICS : SERVER + 'getStatistics', // 获取统计数据

    // 物流公司
    ROUTE_GET_SHIPPER_LIST: SERVER + 'getShipperList', // 获取物流公司列表
    ROUTE_GET_SHIPPER_DETAIL: SERVER + 'getShipperDetail', // 获取物流公司详情
    ROUTE_CARE_SHIPPER: SERVER + 'careShipper', // 关注物流公司
    ROUTE_GET_CARED_SHIPPER_LIST: SERVER + 'getCaredShipperList', // 获取关注物流公司列表

    // 路线
    ROUTE_GET_ROADMAP_LIST: SERVER + 'getRoadmapList', // 获取路线列表
    ROUTE_GET_ROADMAP_DETAIL: SERVER + 'getRoadmapDetail', // 获取路线详情
    ROUTE_GET_COLLECTION_ROADMAP_LIST: SERVER + 'getCollectionRoadmapList', // 获取收藏线路列表
    ROUTE_GET_ROADMAP_LIST_IN_SHOP: SERVER + 'getRoadmapListInShop', // 获取分店线路列表
    ROUTE_GET_ROADMAP_LIST_IN_AGENT: SERVER + 'getRoadmapListInAgent', // 获取收货点线路列表
    ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER: SERVER + 'getRoadmapListWithPreOrder', // 获取区域收货点和分店路线列表
    ROUTE_GET_LOGISTICS_LIST: SERVER + 'getLogisticsList', // 获取订单物流信息

    // 用户
    ROUTE_GET_CLIENT_LIST: SERVER + 'getClientList', // 获取用户列表

    // 订单
    ROUTE_PLACE_PRE_ORDER: SERVER + 'placePreOrder', // 预下单
    ROUTE_PLACE_ORDER: SERVER + 'placeOrder', // 下单
    ROUTE_GET_SEND_ORDER_LIST: SERVER + 'getSendOrderList', // 获取发出订单列表
    ROUTE_GET_RECEIVE_ORDER_LIST: SERVER + 'getReceiveOrderList', // 获取发出订单列表
    ROUTE_GET_ORDER_LIST: SERVER + 'getOrderList', // 获取订单列表
    ROUTE_MODIFY_ORDER: SERVER + 'modifyOrder', // 修改订单
    ROUTE_MODIFY_PRE_ORDER: SERVER + 'modifyPreOrder', // 修改预下单
    ROUTE_REMOVE_PRE_ORDER: SERVER + 'removePreOrder', // 删除订单
    ROUTE_PAY_FOR_ORDER_WHEN_SEND: SERVER + 'payForOrderWhenSend', // 线上立即支付(发货)
    ROUTE_PAY_FOR_ORDER_WHEN_RECEIVE: SERVER + 'payForOrderWhenReceive', // 线上立即支付（收货）
    ROUTE_FINISH_ORDER: SERVER + 'finishOrder', // 现付成功

    // 文件上传
    ROUTE_UPDATE_FILE: API_SERVER + 'uploadFile', // 上传文件

    // 网页地址
    ROUTE_USER_LICENSE: ROOT_SERVER + 'protocals/pdshop/user.html', // 用户协议
    ROUTE_SOFTWARE_LICENSE: ROOT_SERVER + 'protocals/pdshop/software.html', // 获取软件许可协议
    ROUTE_ABOUT_PAGE: ROOT_SERVER + 'protocals/pdshop/about.html', // 关于

    // 下载更新
    ROUTE_VERSION_INFO_URL: ROOT_SERVER + 'apps/pdshop/version.json', // 版本信息地址
    ROUTE_JS_ANDROID_URL: ROOT_SERVER + 'apps/pdshop/jsandroid.zip', // android jsbundle 包地址
    ROUTE_JS_IOS_URL: ROOT_SERVER + 'apps/pdshop/jsios.zip', // ios jsbundle 包地址
    ROUTE_APK_URL: ROOT_SERVER + 'apps/pdshop/pdshop.apk', // apk地址
};

```

* PDShop/project/App/config/Screen.js

```js
'use strict';

const ReactNative = require('react-native');
const {
    Dimensions,
    PixelRatio,
    Platform,
    NativeModules,
} = ReactNative;

const SCREEN_WIDTH_BASE = 375;
const { width, height } = Dimensions.get('screen') || Dimensions.get('window');
const pxielRatio = PixelRatio.get();
const { TotalNavHeight, NavBarHeight, StatusBarHeight } = Navigator.NavigationBar.Styles.General;
const translucent = NativeModules.SplashScreen.translucent;
const statusBarHeight = (Platform.OS === 'android' && !translucent) ? StatusBarHeight : 0;
const workHeight = height - statusBarHeight;

module.exports = {
    translucent: NativeModules.SplashScreen.translucent,
    tw: width, // 屏幕的真实宽度
    w: SCREEN_WIDTH_BASE, // 屏幕的宽度
    th: workHeight, // 屏幕的真实高度（android不包含状态栏）
    h: workHeight * SCREEN_WIDTH_BASE / width, // 屏幕的高度（android不包含状态栏）
    tfh: height, // 屏幕全屏的真实高度（android包含状态栏）
    fh: height * SCREEN_WIDTH_BASE / width, // 屏幕全屏的高度（android包含状态栏）
    tch: workHeight - TotalNavHeight, // 界面的真实高度
    ch: (workHeight - TotalNavHeight) * SCREEN_WIDTH_BASE / width, // 界面的高度
    trueStatusBarHeight: StatusBarHeight, // android状态栏真实高度
    statusBarHeight: StatusBarHeight * SCREEN_WIDTH_BASE / width, // android状态栏高度
    trueTotalNavHeight: NavBarHeight, // 导航栏的真实高度
    navbarHeight: NavBarHeight * SCREEN_WIDTH_BASE / width, // 导航栏的高度
    trueTotalNavbarHeight: TotalNavHeight, // 导航栏的真实总高度
    totalNavbarHeight: TotalNavHeight * SCREEN_WIDTH_BASE / width, // 导航栏的总高度
    pr: pxielRatio,
    s: (w) => { return w * width / SCREEN_WIDTH_BASE; },
    rs: (w) => { return w * SCREEN_WIDTH_BASE / width; },
};

```

* PDShop/project/App/config/TruckState.js

```js
// 注意：常量部分必须和服务器保持一致

const TS_READY_EXAMINE = 0; // 待审核
const TS_READY_ENTER_WAREHOUSE = 1; // 待入库
const TS_READY_SEARCH_CARRY_PARTMENT = 2; // 待找搬运队
const TS_READY_SCAN_LOAD = 3; // 待扫描装车
const TS_SCAN_LOADING = 4; // 装车中
const TS_READY_PAY_FOR_CARRY_PARTMENT = 5; // 待付搬运部的款
const TS_READY_EXIT_WAREHOUSE = 6; // 待出库
const TS_ON_THE_WAY = 7; // 运输中
const TS_RECEIVE_SUCCESS = 8; // 交货成功

module.exports = {
    TS_READY_EXAMINE,
    TS_READY_ENTER_WAREHOUSE,
    TS_READY_SEARCH_CARRY_PARTMENT,
    TS_READY_SCAN_LOAD,
    TS_SCAN_LOADING,
    TS_READY_PAY_FOR_CARRY_PARTMENT,
    TS_READY_EXIT_WAREHOUSE,
    TS_ON_THE_WAY,
    TS_RECEIVE_SUCCESS,

    // mapper
    MAP: {
        [TS_READY_EXAMINE]: '待审核',
        [TS_READY_ENTER_WAREHOUSE]: '待入库',
        [TS_READY_SEARCH_CARRY_PARTMENT]: '待找搬运队',
        [TS_READY_SCAN_LOAD]: '待扫描装车',
        [TS_SCAN_LOADING]: '装车中',
        [TS_READY_PAY_FOR_CARRY_PARTMENT]: '待付搬运部的款',
        [TS_READY_EXIT_WAREHOUSE]: '待出库',
        [TS_ON_THE_WAY]: '运输中',
        [TS_RECEIVE_SUCCESS]: '交货成功',
    },
};

```

* PDShop/project/App/data/city.js

```js
module.exports = [{ name:'北京', city:[{ name:'北京', area:['东城区', '西城区', '崇文区', '宣武区', '朝阳区', '丰台区', '石景山区', '海淀区', '门头沟区', '房山区', '通州区', '顺义区', '昌平区', '大兴区', '平谷区', '怀柔区', '密云县', '延庆县'] }] }, { name:'天津', city:[{ name:'天津', area:['和平区', '河东区', '河西区', '南开区', '河北区', '红桥区', '塘沽区', '汉沽区', '大港区', '东丽区', '西青区', '津南区', '北辰区', '武清区', '宝坻区', '宁河县', '静海县', '蓟  县'] }] }, { name:'河北', city:[{ name:'石家庄', area:['长安区', '桥东区', '桥西区', '新华区', '郊  区', '井陉矿区', '井陉县', '正定县', '栾城县', '行唐县', '灵寿县', '高邑县', '深泽县', '赞皇县', '无极县', '平山县', '元氏县', '赵  县', '辛集市', '藁', '晋州市', '新乐市', '鹿泉市'] }, { name:'唐山', area:['路南区', '路北区', '古冶区', '开平区', '新  区', '丰润县', '滦  县', '滦南县', '乐亭县', '迁西县', '玉田县', '唐海县', '遵化市', '丰南市', '迁安市'] }, { name:'秦皇岛', area:['海港区', '山海关区', '北戴河区', '青龙满族自治县', '昌黎县', '抚宁县', '卢龙县'] }, { name:'邯郸', area:['邯山区', '丛台区', '复兴区', '峰峰矿区', '邯郸县', '临漳县', '成安县', '大名县', '涉  县', '磁  县', '肥乡县', '永年县', '邱  县', '鸡泽县', '广平县', '馆陶县', '魏  县', '曲周县', '武安市'] }, { name:'邢台', area:['桥东区', '桥西区', '邢台县', '临城县', '内丘县', '柏乡县', '隆尧县', '任  县', '南和县', '宁晋县', '巨鹿县', '新河县', '广宗县', '平乡县', '威  县', '清河县', '临西县', '南宫市', '沙河市'] }, { name:'保定', area:['新市区', '北市区', '南市区', '满城县', '清苑县', '涞水县', '阜平县', '徐水县', '定兴县', '唐  县', '高阳县', '容城县', '涞源县', '望都县', '安新县', '易  县', '曲阳县', '蠡  县', '顺平县', '博野', '雄县', '涿州市', '定州市', '安国市', '高碑店市'] }, { name:'张家口', area:['桥东区', '桥西区', '宣化区', '下花园区', '宣化县', '张北县', '康保县', '沽源县', '尚义县', '蔚  县', '阳原县', '怀安县', '万全县', '怀来县', '涿鹿县', '赤城县', '崇礼县'] }, { name:'承德', area:['双桥区', '双滦区', '鹰手营子矿区', '承德县', '兴隆县', '平泉县', '滦平县', '隆化县', '丰宁满族自治县', '宽城满族自治县', '围场满族蒙古族自治县'] }, { name:'沧州', area:['新华区', '运河区', '沧  县', '青  县', '东光县', '海兴县', '盐山县', '肃宁县', '南皮县', '吴桥县', '献  县', '孟村回族自治县', '泊头市', '任丘市', '黄骅市', '河间市'] }, { name:'廊坊', area:['安次区', '固安县', '永清县', '香河县', '大城县', '文安县', '大厂回族自治县', '霸州市', '三河市'] }, { name:'衡水', area:['桃城区', '枣强县', '武邑县', '武强县', '饶阳县', '安平县', '故城县', '景  县', '阜城县', '冀州市', '深州市'] }] }, { name:'山西', city:[{ name:'太原', area:['小店区', '迎泽区', '杏花岭区', '尖草坪区', '万柏林区', '晋源区', '清徐县', '阳曲县', '娄烦县', '古交市'] }, { name:'大同', area:['城  区', '矿  区', '南郊区', '新荣区', '阳高县', '天镇县', '广灵县', '灵丘县', '浑源县', '左云县', '大同县'] }, { name:'阳泉', area:['城  区', '矿  区', '郊  区', '平定县', '盂  县'] }, { name:'长治', area:['城  区', '郊  区', '长治县', '襄垣县', '屯留县', '平顺县', '黎城县', '壶关县', '长子县', '武乡县', '沁  县', '沁源县', '潞城市'] }, { name:'晋城', area:['城  区', '沁水县', '阳城县', '陵川县', '泽州县', '高平市'] }, { name:'朔州', area:['朔城区', '平鲁区', '山阴县', '应  县', '右玉县', '怀仁县'] }, { name:'忻州', area:['忻府区', '原平市', '定襄县', '五台县', '代  县', '繁峙县', '宁武县', '静乐县', '神池县', '五寨县', '岢岚县', '河曲县', '保德县', '偏关县'] }, { name:'吕梁', area:['离石区', '孝义市', '汾阳市', '文水县', '交城县', '兴  县', '临  县', '柳林县', '石楼县', '岚  县', '方山县', '中阳县', '交口县'] }, { name:'晋中', area:['榆次市', '介休市', '榆社县', '左权县', '和顺县', '昔阳县', '寿阳县', '太谷县', '祁  县', '平遥县', '灵石县'] }, { name:'临汾', area:['临汾市', '侯马市', '霍州市', '曲沃县', '翼城县', '襄汾县', '洪洞县', '古  县', '安泽县', '浮山县', '吉  县', '乡宁县', '蒲  县', '大宁县', '永和县', '隰  县', '汾西县'] }, { name:'运城', area:['运城市', '永济市', '河津市', '芮城县', '临猗县', '万荣县', '新绛县', '稷山县', '闻喜县', '夏  县', '绛  县', '平陆县', '垣曲县'] }] }, { name:'内蒙古', city:[{ name:'呼和浩特', area:['新城区', '回民区', '玉泉区', '郊  区', '土默特左旗', '托克托县', '和林格尔县', '清水河县', '武川县'] }, { name:'包头', area:['东河区', '昆都伦区', '青山区', '石拐矿区', '白云矿区', '郊  区', '土默特右旗', '固阳县', '达尔罕茂明安联合旗'] }, { name:'乌海', area:['海勃湾区', '海南区', '乌达区'] }, { name:'赤峰', area:['红山区', '元宝山区', '松山区', '阿鲁科尔沁旗', '巴林左旗', '巴林右旗', '林西县', '克什克腾旗', '翁牛特旗', '喀喇沁旗', '宁城县', '敖汉旗'] }, { name:'呼伦贝尔', area:['海拉尔市', '满洲里市', '扎兰屯市', '牙克石市', '根河市', '额尔古纳市', '阿荣旗', '莫力达瓦达斡尔族自治旗', '鄂伦春自治旗', '鄂温克族自治旗', '新巴尔虎右旗', '新巴尔虎左旗', '陈巴尔虎旗'] }, { name:'兴安盟', area:['乌兰浩特市', '阿尔山市', '科尔沁右翼前旗', '科尔沁右翼中旗', '扎赉特旗', '突泉县'] }, { name:'通辽', area:['科尔沁区', '霍林郭勒市', '科尔沁左翼中旗', '科尔沁左翼后旗', '开鲁县', '库伦旗', '奈曼旗', '扎鲁特旗'] }, { name:'锡林郭勒盟', area:['二连浩特市', '锡林浩特市', '阿巴嘎旗', '苏尼特左旗', '苏尼特右旗', '东乌珠穆沁旗', '西乌珠穆沁旗', '太仆寺旗', '镶黄旗', '正镶白旗', '正蓝旗', '多伦县'] }, { name:'乌兰察布盟', area:['集宁市', '丰镇市', '卓资县', '化德县', '商都县', '兴和县', '凉城县', '察哈尔右翼前旗', '察哈尔右翼中旗', '察哈尔右翼后旗', '四子王旗'] }, { name:'伊克昭盟', area:['东胜市', '达拉特旗', '准格尔旗', '鄂托克前旗', '鄂托克旗', '杭锦旗', '乌审旗', '伊金霍洛旗'] }, { name:'巴彦淖尔盟', area:['临河市', '五原县', '磴口县', '乌拉特前旗', '乌拉特中旗', '乌拉特后旗', '杭锦后旗'] }, { name:'阿拉善盟', area:['阿拉善左旗', '阿拉善右旗', '额济纳旗'] }] }, { name:'辽宁', city:[{ name:'沈阳', area:['沈河区', '皇姑区', '和平区', '大东区', '铁西区', '苏家屯区', '东陵区', '于洪区', '新民市', '法库县', '辽中县', '康平县', '新城子区', '其他'] }, { name:'大连', area:['西岗区', '中山区', '沙河口区', '甘井子区', '旅顺口区', '金州区', '瓦房店市', '普兰店市', '庄河市', '长海县', '其他'] }, { name:'鞍山', area:['铁东区', '铁西区', '立山区', '千山区', '海城市', '台安县', '岫岩满族自治县', '其他'] }, { name:'抚顺', area:['顺城区', '新抚区', '东洲区', '望花区', '抚顺县', '清原满族自治县', '新宾满族自治县', '其他'] }, { name:'本溪', area:['平山区', '明山区', '溪湖区', '南芬区', '本溪满族自治县', '桓仁满族自治县', '其他'] }, { name:'丹东', area:['振兴区', '元宝区', '振安区', '东港市', '凤城市', '宽甸满族自治县', '其他'] }, { name:'锦州', area:['太和区', '古塔区', '凌河区', '凌海市', '黑山县', '义县', '北宁市', '其他'] }, { name:'营口', area:['站前区', '西市区', '鲅鱼圈区', '老边区', '大石桥市', '盖州市', '其他'] }, { name:'阜新', area:['海州区', '新邱区', '太平区', '清河门区', '细河区', '彰武县', '阜新蒙古族自治县', '其他'] }, { name:'辽阳', area:['白塔区', '文圣区', '宏伟区', '太子河区', '弓长岭区', '灯塔市', '辽阳县', '其他'] }, { name:'盘锦', area:['双台子区', '兴隆台区', '盘山县', '大洼县', '其他'] }, { name:'铁岭', area:['银州区', '清河区', '调兵山市', '开原市', '铁岭县', '昌图县', '西丰县', '其他'] }, { name:'朝阳', area:['双塔区', '龙城区', '凌源市', '北票市', '朝阳县', '建平县', '喀喇沁左翼蒙古族自治县', '其他'] }, { name:'葫芦岛', area:['龙港区', '南票区', '连山区', '兴城市', '绥中县', '建昌县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'吉林', city:[{ name:'长春', area:['朝阳区', '宽城区', '二道区', '南关区', '绿园区', '双阳区', '九台市', '榆树市', '德惠市', '农安县', '其他'] }, { name:'吉林', area:['船营区', '昌邑区', '龙潭区', '丰满区', '舒兰市', '桦甸市', '蛟河市', '磐石市', '永吉县', '其他'] }, { name:'四平', area:['铁西区', '铁东区', '公主岭市', '双辽市', '梨树县', '伊通满族自治县', '其他'] }, { name:'辽源', area:['龙山区', '西安区', '东辽县', '东丰县', '其他'] }, { name:'通化', area:['东昌区', '二道江区', '梅河口市', '集安市', '通化县', '辉南县', '柳河县', '其他'] }, { name:'白山', area:['八道江区', '江源区', '临江市', '靖宇县', '抚松县', '长白朝鲜族自治县', '其他'] }, { name:'松原', area:['宁江区', '乾安县', '长岭县', '扶余县', '前郭尔罗斯蒙古族自治县', '其他'] }, { name:'白城', area:['洮北区', '大安市', '洮南市', '镇赉县', '通榆县', '其他'] }, { name:'延边朝鲜族自治州', area:['延吉市', '图们市', '敦化市', '龙井市', '珲春市', '和龙市', '安图县', '汪清县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'黑龙江', city:[{ name:'哈尔滨', area:['松北区', '道里区', '南岗区', '平房区', '香坊区', '道外区', '呼兰区', '阿城区', '双城市', '尚志市', '五常市', '宾县', '方正县', '通河县', '巴彦县', '延寿县', '木兰县', '依兰县', '其他'] }, { name:'齐齐哈尔', area:['龙沙区', '昂昂溪区', '铁锋区', '建华区', '富拉尔基区', '碾子山区', '梅里斯达斡尔族区', '讷河市', '富裕县', '拜泉县', '甘南县', '依安县', '克山县', '泰来县', '克东县', '龙江县', '其他'] }, { name:'鹤岗', area:['兴山区', '工农区', '南山区', '兴安区', '向阳区', '东山区', '萝北县', '绥滨县', '其他'] }, { name:'双鸭山', area:['尖山区', '岭东区', '四方台区', '宝山区', '集贤县', '宝清县', '友谊县', '饶河县', '其他'] }, { name:'鸡西', area:['鸡冠区', '恒山区', '城子河区', '滴道区', '梨树区', '麻山区', '密山市', '虎林市', '鸡东县', '其他'] }, { name:'大庆', area:['萨尔图区', '红岗区', '龙凤区', '让胡路区', '大同区', '林甸县', '肇州县', '肇源县', '杜尔伯特蒙古族自治县', '其他'] }, { name:'伊春', area:['伊春区', '带岭区', '南岔区', '金山屯区', '西林区', '美溪区', '乌马河区', '翠峦区', '友好区', '上甘岭区', '五营区', '红星区', '新青区', '汤旺河区', '乌伊岭区', '铁力市', '嘉荫县', '其他'] }, { name:'牡丹江', area:['爱民区', '东安区', '阳明区', '西安区', '绥芬河市', '宁安市', '海林市', '穆棱市', '林口县', '东宁县', '其他'] }, { name:'佳木斯', area:['向阳区', '前进区', '东风区', '郊区', '同江市', '富锦市', '桦川县', '抚远县', '桦南县', '汤原县', '其他'] }, { name:'七台河', area:['桃山区', '新兴区', '茄子河区', '勃利县', '其他'] }, { name:'黑河', area:['爱辉区', '北安市', '五大连池市', '逊克县', '嫩江县', '孙吴县', '其他'] }, { name:'绥化', area:['北林区', '安达市', '肇东市', '海伦市', '绥棱县', '兰西县', '明水县', '青冈县', '庆安县', '望奎县', '其他'] }, { name:'大兴安岭地区', area:['呼玛县', '塔河县', '漠河县', '大兴安岭辖区', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'上海', city:[{ name:'上海', area:['黄浦区', '卢湾区', '徐汇区', '长宁区', '静安区', '普陀区', '闸北区', '虹口区', '杨浦区', '宝山区', '闵行区', '嘉定区', '松江区', '金山区', '青浦区', '南汇区', '奉贤区', '浦东新区', '崇明县', '其他'] }] }, { name:'江苏', city:[{ name:'南京', area:['玄武区', '白下区', '秦淮区', '建邺区', '鼓楼区', '下关区', '栖霞区', '雨花台区', '浦口区', '江宁区', '六合区', '溧水县', '高淳县', '其他'] }, { name:'苏州', area:['金阊区', '平江区', '沧浪区', '虎丘区', '吴中区', '相城区', '常熟市', '张家港市', '昆山市', '吴江市', '太仓市', '其他'] }, { name:'无锡', area:['崇安区', '南长区', '北塘区', '滨湖区', '锡山区', '惠山区', '江阴市', '宜兴市', '其他'] }, { name:'常州', area:['钟楼区', '天宁区', '戚墅堰区', '新北区', '武进区', '金坛市', '溧阳市', '其他'] }, { name:'镇江', area:['京口区', '润州区', '丹徒区', '丹阳市', '扬中市', '句容市', '其他'] }, { name:'南通', area:['崇川区', '港闸区', '通州市', '如皋市', '海门市', '启东市', '海安县', '如东县', '其他'] }, { name:'泰州', area:['海陵区', '高港区', '姜堰市', '泰兴市', '靖江市', '兴化市', '其他'] }, { name:'扬州', area:['广陵区', '维扬区', '邗江区', '江都市', '仪征市', '高邮市', '宝应县', '其他'] }, { name:'盐城', area:['亭湖区', '盐都区', '大丰市', '东台市', '建湖县', '射阳县', '阜宁县', '滨海县', '响水县', '其他'] }, { name:'连云港', area:['新浦区', '海州区', '连云区', '东海县', '灌云县', '赣榆县', '灌南县', '其他'] }, { name:'徐州', area:['云龙区', '鼓楼区', '九里区', '泉山区', '贾汪区', '邳州市', '新沂市', '铜山县', '睢宁县', '沛县', '丰县', '其他'] }, { name:'淮安', area:['清河区', '清浦区', '楚州区', '淮阴区', '涟水县', '洪泽县', '金湖县', '盱眙县', '其他'] }, { name:'宿迁', area:['宿城区', '宿豫区', '沭阳县', '泗阳县', '泗洪县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'浙江', city:[{ name:'杭州', area:['拱墅区', '西湖区', '上城区', '下城区', '江干区', '滨江区', '余杭区', '萧山区', '建德市', '富阳市', '临安市', '桐庐县', '淳安县', '其他'] }, { name:'宁波', area:['海曙区', '江东区', '江北区', '镇海区', '北仑区', '鄞州区', '余姚市', '慈溪市', '奉化市', '宁海县', '象山县', '其他'] }, { name:'温州', area:['鹿城区', '龙湾区', '瓯海区', '瑞安市', '乐清市', '永嘉县', '洞头县', '平阳县', '苍南县', '文成县', '泰顺县', '其他'] }, { name:'嘉兴', area:['秀城区', '秀洲区', '海宁市', '平湖市', '桐乡市', '嘉善县', '海盐县', '其他'] }, { name:'湖州', area:['吴兴区', '南浔区', '长兴县', '德清县', '安吉县', '其他'] }, { name:'绍兴', area:['越城区', '诸暨市', '上虞市', '嵊州市', '绍兴县', '新昌县', '其他'] }, { name:'金华', area:['婺城区', '金东区', '兰溪市', '义乌市', '东阳市', '永康市', '武义县', '浦江县', '磐安县', '其他'] }, { name:'衢州', area:['柯城区', '衢江区', '江山市', '龙游县', '常山县', '开化县', '其他'] }, { name:'舟山', area:['定海区', '普陀区', '岱山县', '嵊泗县', '其他'] }, { name:'台州', area:['椒江区', '黄岩区', '路桥区', '临海市', '温岭市', '玉环县', '天台县', '仙居县', '三门县', '其他'] }, { name:'丽水', area:['莲都区', '龙泉市', '缙云县', '青田县', '云和县', '遂昌县', '松阳县', '庆元县', '景宁畲族自治县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'安徽', city:[{ name:'合肥', area:['庐阳区', '瑶海区', '蜀山区', '包河区', '长丰县', '肥东县', '肥西县', '其他'] }, { name:'芜湖', area:['镜湖区', '弋江区', '鸠江区', '三山区', '芜湖县', '南陵县', '繁昌县', '其他'] }, { name:'蚌埠', area:['蚌山区', '龙子湖区', '禹会区', '淮上区', '怀远县', '固镇县', '五河县', '其他'] }, { name:'淮南', area:['田家庵区', '大通区', '谢家集区', '八公山区', '潘集区', '凤台县', '其他'] }, { name:'马鞍山', area:['雨山区', '花山区', '金家庄区', '当涂县', '其他'] }, { name:'淮北', area:['相山区', '杜集区', '烈山区', '濉溪县', '其他'] }, { name:'铜陵', area:['铜官山区', '狮子山区', '郊区', '铜陵县', '其他'] }, { name:'安庆', area:['迎江区', '大观区', '宜秀区', '桐城市', '宿松县', '枞阳县', '太湖县', '怀宁县', '岳西县', '望江县', '潜山县', '其他'] }, { name:'黄山', area:['屯溪区', '黄山区', '徽州区', '休宁县', '歙县', '祁门县', '黟县', '其他'] }, { name:'滁州', area:['琅琊区', '南谯区', '天长市', '明光市', '全椒县', '来安县', '定远县', '凤阳县', '其他'] }, { name:'阜阳', area:['颍州区', '颍东区', '颍泉区', '界首市', '临泉县', '颍上县', '阜南县', '太和县', '其他'] }, { name:'宿州', area:['埇桥区', '萧县', '泗县', '砀山县', '灵璧县', '其他'] }, { name:'巢湖', area:['居巢区', '含山县', '无为县', '庐江县', '和县', '其他'] }, { name:'六安', area:['金安区', '裕安区', '寿县', '霍山县', '霍邱县', '舒城县', '金寨县', '其他'] }, { name:'亳州', area:['谯城区', '利辛县', '涡阳县', '蒙城县', '其他'] }, { name:'池州', area:['贵池区', '东至县', '石台县', '青阳县', '其他'] }, { name:'宣城', area:['宣州区', '宁国市', '广德县', '郎溪县', '泾县', '旌德县', '绩溪县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'福建', city:[{ name:'福州', area:['鼓楼区', '台江区', '仓山区', '马尾区', '晋安区', '福清市', '长乐市', '闽侯县', '闽清县', '永泰县', '连江县', '罗源县', '平潭县', '其他'] }, { name:'厦门', area:['思明区', '海沧区', '湖里区', '集美区', '同安区', '翔安区', '其他'] }, { name:'莆田', area:['城厢区', '涵江区', '荔城区', '秀屿区', '仙游县', '其他'] }, { name:'三明', area:['梅列区', '三元区', '永安市', '明溪县', '将乐县', '大田县', '宁化县', '建宁县', '沙县', '尤溪县', '清流县', '泰宁县', '其他'] }, { name:'泉州', area:['鲤城区', '丰泽区', '洛江区', '泉港区', '石狮市', '晋江市', '南安市', '惠安县', '永春县', '安溪县', '德化县', '金门县', '其他'] }, { name:'漳州', area:['芗城区', '龙文区', '龙海市', '平和县', '南靖县', '诏安县', '漳浦县', '华安县', '东山县', '长泰县', '云霄县', '其他'] }, { name:'南平', area:['延平区', '建瓯市', '邵武市', '武夷山市', '建阳市', '松溪县', '光泽县', '顺昌县', '浦城县', '政和县', '其他'] }, { name:'龙岩', area:['新罗区', '漳平市', '长汀县', '武平县', '上杭县', '永定县', '连城县', '其他'] }, { name:'宁德', area:['蕉城区', '福安市', '福鼎市', '寿宁县', '霞浦县', '柘荣县', '屏南县', '古田县', '周宁县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'江西', city:[{ name:'南昌', area:['东湖区', '西湖区', '青云谱区', '湾里区', '青山湖区', '新建县', '南昌县', '进贤县', '安义县', '其他'] }, { name:'景德镇', area:['珠山区', '昌江区', '乐平市', '浮梁县', '其他'] }, { name:'萍乡', area:['安源区', '湘东区', '莲花县', '上栗县', '芦溪县', '其他'] }, { name:'九江', area:['浔阳区', '庐山区', '瑞昌市', '九江县', '星子县', '武宁县', '彭泽县', '永修县', '修水县', '湖口县', '德安县', '都昌县', '其他'] }, { name:'新余', area:['渝水区', '分宜县', '其他'] }, { name:'鹰潭', area:['月湖区', '贵溪市', '余江县', '其他'] }, { name:'赣州', area:['章贡区', '瑞金市', '南康市', '石城县', '安远县', '赣县', '宁都县', '寻乌县', '兴国县', '定南县', '上犹县', '于都县', '龙南县', '崇义县', '信丰县', '全南县', '大余县', '会昌县', '其他'] }, { name:'吉安', area:['吉州区', '青原区', '井冈山市', '吉安县', '永丰县', '永新县', '新干县', '泰和县', '峡江县', '遂川县', '安福县', '吉水县', '万安县', '其他'] }, { name:'宜春', area:['袁州区', '丰城市', '樟树市', '高安市', '铜鼓县', '靖安县', '宜丰县', '奉新县', '万载县', '上高县', '其他'] }, { name:'抚州', area:['临川区', '南丰县', '乐安县', '金溪县', '南城县', '东乡县', '资溪县', '宜黄县', '广昌县', '黎川县', '崇仁县', '其他'] }, { name:'上饶', area:['信州区', '德兴市', '上饶县', '广丰县', '鄱阳县', '婺源县', '铅山县', '余干县', '横峰县', '弋阳县', '玉山县', '万年县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'山东', city:[{ name:'济南', area:['市中区', '历下区', '天桥区', '槐荫区', '历城区', '长清区', '章丘市', '平阴县', '济阳县', '商河县', '其他'] }, { name:'青岛', area:['市南区', '市北区', '城阳区', '四方区', '李沧区', '黄岛区', '崂山区', '胶南市', '胶州市', '平度市', '莱西市', '即墨市', '其他'] }, { name:'淄博', area:['张店区', '临淄区', '淄川区', '博山区', '周村区', '桓台县', '高青县', '沂源县', '其他'] }, { name:'枣庄', area:['市中区', '山亭区', '峄城区', '台儿庄区', '薛城区', '滕州市', '其他'] }, { name:'东营', area:['东营区', '河口区', '垦利县', '广饶县', '利津县', '其他'] }, { name:'烟台', area:['芝罘区', '福山区', '牟平区', '莱山区', '龙口市', '莱阳市', '莱州市', '招远市', '蓬莱市', '栖霞市', '海阳市', '长岛县', '其他'] }, { name:'潍坊', area:['潍城区', '寒亭区', '坊子区', '奎文区', '青州市', '诸城市', '寿光市', '安丘市', '高密市', '昌邑市', '昌乐县', '临朐县', '其他'] }, { name:'济宁', area:['市中区', '任城区', '曲阜市', '兖州市', '邹城市', '鱼台县', '金乡县', '嘉祥县', '微山县', '汶上县', '泗水县', '梁山县', '其他'] }, { name:'泰安', area:['泰山区', '岱岳区', '新泰市', '肥城市', '宁阳县', '东平县', '其他'] }, { name:'威海', area:['环翠区', '乳山市', '文登市', '荣成市', '其他'] }, { name:'日照', area:['东港区', '岚山区', '五莲县', '莒县', '其他'] }, { name:'莱芜', area:['莱城区', '钢城区', '其他'] }, { name:'临沂', area:['兰山区', '罗庄区', '河东区', '沂南县', '郯城县', '沂水县', '苍山县', '费县', '平邑县', '莒南县', '蒙阴县', '临沭县', '其他'] }, { name:'德州', area:['德城区', '乐陵市', '禹城市', '陵县', '宁津县', '齐河县', '武城县', '庆云县', '平原县', '夏津县', '临邑县', '其他'] }, { name:'聊城', area:['东昌府区', '临清市', '高唐县', '阳谷县', '茌平县', '莘县', '东阿县', '冠县', '其他'] }, { name:'滨州', area:['滨城区', '邹平县', '沾化县', '惠民县', '博兴县', '阳信县', '无棣县', '其他'] }, { name:'菏泽', area:['牡丹区', '鄄城县', '单县', '郓城县', '曹县', '定陶县', '巨野县', '东明县', '成武县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'河南', city:[{ name:'郑州', area:['中原区', '金水区', '二七区', '管城回族区', '上街区', '惠济区', '巩义市', '新郑市', '新密市', '登封市', '荥阳市', '中牟县', '其他'] }, { name:'开封', area:['鼓楼区', '龙亭区', '顺河回族区', '禹王台区', '金明区', '开封县', '尉氏县', '兰考县', '杞县', '通许县', '其他'] }, { name:'洛阳', area:['西工区', '老城区', '涧西区', '瀍河回族区', '洛龙区', '吉利区', '偃师市', '孟津县', '汝阳县', '伊川县', '洛宁县', '嵩县', '宜阳县', '新安县', '栾川县', '其他'] }, { name:'平顶山', area:['新华区', '卫东区', '湛河区', '石龙区', '汝州市', '舞钢市', '宝丰县', '叶县', '郏县', '鲁山县', '其他'] }, { name:'安阳', area:['北关区', '文峰区', '殷都区', '龙安区', '林州市', '安阳县', '滑县', '内黄县', '汤阴县', '其他'] }, { name:'鹤壁', area:['淇滨区', '山城区', '鹤山区', '浚县', '淇县', '其他'] }, { name:'新乡', area:['卫滨区', '红旗区', '凤泉区', '牧野区', '卫辉市', '辉县市', '新乡县', '获嘉县', '原阳县', '长垣县', '封丘县', '延津县', '其他'] }, { name:'焦作', area:['解放区', '中站区', '马村区', '山阳区', '沁阳市', '孟州市', '修武县', '温县', '武陟县', '博爱县', '其他'] }, { name:'濮阳', area:['华龙区', '濮阳县', '南乐县', '台前县', '清丰县', '范县', '其他'] }, { name:'许昌', area:['魏都区', '禹州市', '长葛市', '许昌县', '鄢陵县', '襄城县', '其他'] }, { name:'漯河', area:['源汇区', '郾城区', '召陵区', '临颍县', '舞阳县', '其他'] }, { name:'三门峡', area:['湖滨区', '义马市', '灵宝市', '渑池县', '卢氏县', '陕县', '其他'] }, { name:'南阳', area:['卧龙区', '宛城区', '邓州市', '桐柏县', '方城县', '淅川县', '镇平县', '唐河县', '南召县', '内乡县', '新野县', '社旗县', '西峡县', '其他'] }, { name:'商丘', area:['梁园区', '睢阳区', '永城市', '宁陵县', '虞城县', '民权县', '夏邑县', '柘城县', '睢县', '其他'] }, { name:'信阳', area:['浉河区', '平桥区', '潢川县', '淮滨县', '息县', '新县', '商城县', '固始县', '罗山县', '光山县', '其他'] }, { name:'周口', area:['川汇区', '项城市', '商水县', '淮阳县', '太康县', '鹿邑县', '西华县', '扶沟县', '沈丘县', '郸城县', '其他'] }, { name:'驻马店', area:['驿城区', '确山县', '新蔡县', '上蔡县', '西平县', '泌阳县', '平舆县', '汝南县', '遂平县', '正阳县', '其他'] }, { name:'焦作', area:['济源市', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'湖北', city:[{ name:'武汉', area:['江岸区', '武昌区', '江汉区', '硚口区', '汉阳区', '青山区', '洪山区', '东西湖区', '汉南区', '蔡甸区', '江夏区', '黄陂区', '新洲区', '其他'] }, { name:'黄石', area:['黄石港区', '西塞山区', '下陆区', '铁山区', '大冶市', '阳新县', '其他'] }, { name:'十堰', area:['张湾区', '茅箭区', '丹江口市', '郧县', '竹山县', '房县', '郧西县', '竹溪县', '其他'] }, { name:'荆州', area:['沙市区', '荆州区', '洪湖市', '石首市', '松滋市', '监利县', '公安县', '江陵县', '其他'] }, { name:'宜昌', area:['西陵区', '伍家岗区', '点军区', '猇亭区', '夷陵区', '宜都市', '当阳市', '枝江市', '秭归县', '远安县', '兴山县', '五峰土家族自治县', '长阳土家族自治县', '其他'] }, { name:'襄樊', area:['襄城区', '樊城区', '襄阳区', '老河口市', '枣阳市', '宜城市', '南漳县', '谷城县', '保康县', '其他'] }, { name:'鄂州', area:['鄂城区', '华容区', '梁子湖区', '其他'] }, { name:'荆门', area:['东宝区', '掇刀区', '钟祥市', '京山县', '沙洋县', '其他'] }, { name:'孝感', area:['孝南区', '应城市', '安陆市', '汉川市', '云梦县', '大悟县', '孝昌县', '其他'] }, { name:'黄冈', area:['黄州区', '麻城市', '武穴市', '红安县', '罗田县', '浠水县', '蕲春县', '黄梅县', '英山县', '团风县', '其他'] }, { name:'咸宁', area:['咸安区', '赤壁市', '嘉鱼县', '通山县', '崇阳县', '通城县', '其他'] }, { name:'随州', area:['曾都区', '广水市', '其他'] }, { name:'恩施土家族苗族自治州', area:['恩施市', '利川市', '建始县', '来凤县', '巴东县', '鹤峰县', '宣恩县', '咸丰县', '其他'] }, { name:'仙桃', area:['仙桃'] }, { name:'天门', area:['天门'] }, { name:'潜江', area:['潜江'] }, { name:'神农架林区', area:['神农架林区'] }, { name:'其他', area:['其他'] }] }, { name:'湖南', city:[{ name:'长沙', area:['岳麓区', '芙蓉区', '天心区', '开福区', '雨花区', '浏阳市', '长沙县', '望城县', '宁乡县', '其他'] }, { name:'株洲', area:['天元区', '荷塘区', '芦淞区', '石峰区', '醴陵市', '株洲县', '炎陵县', '茶陵县', '攸县', '其他'] }, { name:'湘潭', area:['岳塘区', '雨湖区', '湘乡市', '韶山市', '湘潭县', '其他'] }, { name:'衡阳', area:['雁峰区', '珠晖区', '石鼓区', '蒸湘区', '南岳区', '耒阳市', '常宁市', '衡阳县', '衡东县', '衡山县', '衡南县', '祁东县', '其他'] }, { name:'邵阳', area:['双清区', '大祥区', '北塔区', '武冈市', '邵东县', '洞口县', '新邵县', '绥宁县', '新宁县', '邵阳县', '隆回县', '城步苗族自治县', '其他'] }, { name:'岳阳', area:['岳阳楼区', '云溪区', '君山区', '临湘市', '汨罗市', '岳阳县', '湘阴县', '平江县', '华容县', '其他'] }, { name:'常德', area:['武陵区', '鼎城区', '津市市', '澧县', '临澧县', '桃源县', '汉寿县', '安乡县', '石门县', '其他'] }, { name:'张家界', area:['永定区', '武陵源区', '慈利县', '桑植县', '其他'] }, { name:'益阳', area:['赫山区', '资阳区', '沅江市', '桃江县', '南县', '安化县', '其他'] }, { name:'郴州', area:['北湖区', '苏仙区', '资兴市', '宜章县', '汝城县', '安仁县', '嘉禾县', '临武县', '桂东县', '永兴县', '桂阳县', '其他'] }, { name:'永州', area:['冷水滩区', '零陵区', '祁阳县', '蓝山县', '宁远县', '新田县', '东安县', '江永县', '道县', '双牌县', '江华瑶族自治县', '其他'] }, { name:'怀化', area:['鹤城区', '洪江市', '会同县', '沅陵县', '辰溪县', '溆浦县', '中方县', '新晃侗族自治县', '芷江侗族自治县', '通道侗族自治县', '靖州苗族侗族自治县', '麻阳苗族自治县', '其他'] }, { name:'娄底', area:['娄星区', '冷水江市', '涟源市', '新化县', '双峰县', '其他'] }, { name:'湘西土家族苗族自治州', area:['吉首市', '古丈县', '龙山县', '永顺县', '凤凰县', '泸溪县', '保靖县', '花垣县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'广东', city:[{ name:'广州', area:['越秀区', '荔湾区', '海珠区', '天河区', '白云区', '黄埔区', '番禺区', '花都区', '南沙区', '萝岗区', '增城市', '从化市', '其他'] }, { name:'深圳', area:['福田区', '罗湖区', '南山区', '宝安区', '龙岗区', '盐田区', '其他'] }, { name:'东莞', area:['莞城', '常平', '塘厦', '塘厦', '塘厦', '其他'] }, { name:'中山', area:['中山'] }, { name:'潮州', area:['湘桥区', '潮安县', '饶平县', '其他'] }, { name:'揭阳', area:['榕城区', '揭东县', '揭西县', '惠来县', '普宁市', '其他'] }, { name:'云浮', area:['云城区', '新兴县', '郁南县', '云安县', '罗定市', '其他'] }, { name:'珠海', area:['香洲区', '斗门区', '金湾区', '其他'] }, { name:'汕头', area:['金平区', '濠江区', '龙湖区', '潮阳区', '潮南区', '澄海区', '南澳县', '其他'] }, { name:'韶关', area:['浈江区', '武江区', '曲江区', '乐昌市', '南雄市', '始兴县', '仁化县', '翁源县', '新丰县', '乳源瑶族自治县', '其他'] }, { name:'佛山', area:['禅城区', '南海区', '顺德区', '三水区', '高明区', '其他'] }, { name:'江门', area:['蓬江区', '江海区', '新会区', '恩平市', '台山市', '开平市', '鹤山市', '其他'] }, { name:'湛江', area:['赤坎区', '霞山区', '坡头区', '麻章区', '吴川市', '廉江市', '雷州市', '遂溪县', '徐闻县', '其他'] }, { name:'茂名', area:['茂南区', '茂港区', '化州市', '信宜市', '高州市', '电白县', '其他'] }, { name:'肇庆', area:['端州区', '鼎湖区', '高要市', '四会市', '广宁县', '怀集县', '封开县', '德庆县', '其他'] }, { name:'惠州', area:['惠城区', '惠阳区', '博罗县', '惠东县', '龙门县', '其他'] }, { name:'梅州', area:['梅江区', '兴宁市', '梅县', '大埔县', '丰顺县', '五华县', '平远县', '蕉岭县', '其他'] }, { name:'汕尾', area:['城区', '陆丰市', '海丰县', '陆河县', '其他'] }, { name:'河源', area:['源城区', '紫金县', '龙川县', '连平县', '和平县', '东源县', '其他'] }, { name:'阳江', area:['江城区', '阳春市', '阳西县', '阳东县', '其他'] }, { name:'清远', area:['清城区', '英德市', '连州市', '佛冈县', '阳山县', '清新县', '连山壮族瑶族自治县', '连南瑶族自治县', '其他'] }] }, { name:'广西', city:[{ name:'南宁', area:['青秀区', '兴宁区', '西乡塘区', '良庆区', '江南区', '邕宁区', '武鸣县', '隆安县', '马山县', '上林县', '宾阳县', '横县', '其他'] }, { name:'柳州', area:['城中区', '鱼峰区', '柳北区', '柳南区', '柳江县', '柳城县', '鹿寨县', '融安县', '融水苗族自治县', '三江侗族自治县', '其他'] }, { name:'桂林', area:['象山区', '秀峰区', '叠彩区', '七星区', '雁山区', '阳朔县', '临桂县', '灵川县', '全州县', '平乐县', '兴安县', '灌阳县', '荔浦县', '资源县', '永福县', '龙胜各族自治县', '恭城瑶族自治县', '其他'] }, { name:'梧州', area:['万秀区', '蝶山区', '长洲区', '岑溪市', '苍梧县', '藤县', '蒙山县', '其他'] }, { name:'北海', area:['海城区', '银海区', '铁山港区', '合浦县', '其他'] }, { name:'防城港', area:['港口区', '防城区', '东兴市', '上思县', '其他'] }, { name:'钦州', area:['钦南区', '钦北区', '灵山县', '浦北县', '其他'] }, { name:'贵港', area:['港北区', '港南区', '覃塘区', '桂平市', '平南县', '其他'] }, { name:'玉林', area:['玉州区', '北流市', '容县', '陆川县', '博白县', '兴业县', '其他'] }, { name:'百色', area:['右江区', '凌云县', '平果县', '西林县', '乐业县', '德保县', '田林县', '田阳县', '靖西县', '田东县', '那坡县', '隆林各族自治县', '其他'] }, { name:'贺州', area:['八步区', '钟山县', '昭平县', '富川瑶族自治县', '其他'] }, { name:'河池', area:['金城江区', '宜州市', '天峨县', '凤山县', '南丹县', '东兰县', '都安瑶族自治县', '罗城仫佬族自治县', '巴马瑶族自治县', '环江毛南族自治县', '大化瑶族自治县', '其他'] }, { name:'来宾', area:['兴宾区', '合山市', '象州县', '武宣县', '忻城县', '金秀瑶族自治县', '其他'] }, { name:'崇左', area:['江州区', '凭祥市', '宁明县', '扶绥县', '龙州县', '大新县', '天等县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'海南', city:[{ name:'海口', area:['龙华区', '秀英区', '琼山区', '美兰区', '其他'] }, { name:'三亚', area:['三亚市', '其他'] }, { name:'五指山', area:['五指山'] }, { name:'琼海', area:['琼海'] }, { name:'儋州', area:['儋州'] }, { name:'文昌', area:['文昌'] }, { name:'万宁', area:['万宁'] }, { name:'东方', area:['东方'] }, { name:'澄迈县', area:['澄迈县'] }, { name:'定安县', area:['定安县'] }, { name:'屯昌县', area:['屯昌县'] }, { name:'临高县', area:['临高县'] }, { name:'白沙黎族自治县', area:['白沙黎族自治县'] }, { name:'昌江黎族自治县', area:['昌江黎族自治县'] }, { name:'乐东黎族自治县', area:['乐东黎族自治县'] }, { name:'陵水黎族自治县', area:['陵水黎族自治县'] }, { name:'保亭黎族苗族自治县', area:['保亭黎族苗族自治县'] }, { name:'琼中黎族苗族自治县', area:['琼中黎族苗族自治县'] }, { name:'其他', area:['其他'] }] }, { name:'重庆', city:[{ name:'重庆', area:['渝中区', '大渡口区', '江北区', '南岸区', '北碚区', '渝北区', '巴南区', '长寿区', '双桥区', '沙坪坝区', '万盛区', '万州区', '涪陵区', '黔江区', '永川区', '合川区', '江津区', '九龙坡区', '南川区', '綦江县', '潼南县', '荣昌县', '璧山县', '大足县', '铜梁县', '梁平县', '开县', '忠县', '城口县', '垫江县', '武隆县', '丰都县', '奉节县', '云阳县', '巫溪县', '巫山县', '石柱土家族自治县', '秀山土家族苗族自治县', '酉阳土家族苗族自治县', '彭水苗族土家族自治县', '其他'] }] }, { name:'四川', city:[{ name:'成都', area:['青羊区', '锦江区', '金牛区', '武侯区', '成华区', '龙泉驿区', '青白江区', '新都区', '温江区', '都江堰市', '彭州市', '邛崃市', '崇州市', '金堂县', '郫县', '新津县', '双流县', '蒲江县', '大邑县', '其他'] }, { name:'自贡', area:['大安区', '自流井区', '贡井区', '沿滩区', '荣县', '富顺县', '其他'] }, { name:'攀枝花', area:['仁和区', '米易县', '盐边县', '东区', '西区', '其他'] }, { name:'泸州', area:['江阳区', '纳溪区', '龙马潭区', '泸县', '合江县', '叙永县', '古蔺县', '其他'] }, { name:'德阳', area:['旌阳区', '广汉市', '什邡市', '绵竹市', '罗江县', '中江县', '其他'] }, { name:'绵阳', area:['涪城区', '游仙区', '江油市', '盐亭县', '三台县', '平武县', '安县', '梓潼县', '北川羌族自治县', '其他'] }, { name:'广元', area:['元坝区', '朝天区', '青川县', '旺苍县', '剑阁县', '苍溪县', '市中区', '其他'] }, { name:'遂宁', area:['船山区', '安居区', '射洪县', '蓬溪县', '大英县', '其他'] }, { name:'内江', area:['市中区', '东兴区', '资中县', '隆昌县', '威远县', '其他'] }, { name:'乐山', area:['市中区', '五通桥区', '沙湾区', '金口河区', '峨眉山市', '夹江县', '井研县', '犍为县', '沐川县', '马边彝族自治县', '峨边彝族自治县', '其他'] }, { name:'南充', area:['顺庆区', '高坪区', '嘉陵区', '阆中市', '营山县', '蓬安县', '仪陇县', '南部县', '西充县', '其他'] }, { name:'眉山', area:['东坡区', '仁寿县', '彭山县', '洪雅县', '丹棱县', '青神县', '其他'] }, { name:'宜宾', area:['翠屏区', '宜宾县', '兴文县', '南溪县', '珙县', '长宁县', '高县', '江安县', '筠连县', '屏山县', '其他'] }, { name:'广安', area:['广安区', '华蓥市', '岳池县', '邻水县', '武胜县', '其他'] }, { name:'达州', area:['通川区', '万源市', '达县', '渠县', '宣汉县', '开江县', '大竹县', '其他'] }, { name:'雅安', area:['雨城区', '芦山县', '石棉县', '名山县', '天全县', '荥经县', '宝兴县', '汉源县', '其他'] }, { name:'巴中', area:['巴州区', '南江县', '平昌县', '通江县', '其他'] }, { name:'资阳', area:['雁江区', '简阳市', '安岳县', '乐至县', '其他'] }, { name:'阿坝藏族羌族自治州', area:['马尔康县', '九寨沟县', '红原县', '汶川县', '阿坝县', '理县', '若尔盖县', '小金县', '黑水县', '金川县', '松潘县', '壤塘县', '茂县', '其他'] }, { name:'甘孜藏族自治州', area:['康定县', '丹巴县', '炉霍县', '九龙县', '甘孜县', '雅江县', '新龙县', '道孚县', '白玉县', '理塘县', '德格县', '乡城县', '石渠县', '稻城县', '色达县', '巴塘县', '泸定县', '得荣县', '其他'] }, { name:'凉山彝族自治州', area:['西昌市', '美姑县', '昭觉县', '金阳县', '甘洛县', '布拖县', '雷波县', '普格县', '宁南县', '喜德县', '会东县', '越西县', '会理县', '盐源县', '德昌县', '冕宁县', '木里藏族自治县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'贵州', city:[{ name:'贵阳', area:['南明区', '云岩区', '花溪区', '乌当区', '白云区', '小河区', '清镇市', '开阳县', '修文县', '息烽县', '其他'] }, { name:'六盘水', area:['钟山区', '水城县', '盘县', '六枝特区', '其他'] }, { name:'遵义', area:['红花岗区', '汇川区', '赤水市', '仁怀市', '遵义县', '绥阳县', '桐梓县', '习水县', '凤冈县', '正安县', '余庆县', '湄潭县', '道真仡佬族苗族自治县', '务川仡佬族苗族自治县', '其他'] }, { name:'安顺', area:['西秀区', '普定县', '平坝县', '镇宁布依族苗族自治县', '紫云苗族布依族自治县', '关岭布依族苗族自治县', '其他'] }, { name:'铜仁地区', area:['铜仁市', '德江县', '江口县', '思南县', '石阡县', '玉屏侗族自治县', '松桃苗族自治县', '印江土家族苗族自治县', '沿河土家族自治县', '万山特区', '其他'] }, { name:'毕节地区', area:['毕节市', '黔西县', '大方县', '织金县', '金沙县', '赫章县', '纳雍县', '威宁彝族回族苗族自治县', '其他'] }, { name:'黔西南布依族苗族自治州', area:['兴义市', '望谟县', '兴仁县', '普安县', '册亨县', '晴隆县', '贞丰县', '安龙县', '其他'] }, { name:'黔东南苗族侗族自治州', area:['凯里市', '施秉县', '从江县', '锦屏县', '镇远县', '麻江县', '台江县', '天柱县', '黄平县', '榕江县', '剑河县', '三穗县', '雷山县', '黎平县', '岑巩县', '丹寨县', '其他'] }, { name:'黔南布依族苗族自治州', area:['都匀市', '福泉市', '贵定县', '惠水县', '罗甸县', '瓮安县', '荔波县', '龙里县', '平塘县', '长顺县', '独山县', '三都水族自治县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'云南', city:[{ name:'昆明', area:['盘龙区', '五华区', '官渡区', '西山区', '东川区', '安宁市', '呈贡县', '晋宁县', '富民县', '宜良县', '嵩明县', '石林彝族自治县', '禄劝彝族苗族自治县', '寻甸回族彝族自治县', '其他'] }, { name:'曲靖', area:['麒麟区', '宣威市', '马龙县', '沾益县', '富源县', '罗平县', '师宗县', '陆良县', '会泽县', '其他'] }, { name:'玉溪', area:['红塔区', '江川县', '澄江县', '通海县', '华宁县', '易门县', '峨山彝族自治县', '新平彝族傣族自治县', '元江哈尼族彝族傣族自治县', '其他'] }, { name:'保山', area:['隆阳区', '施甸县', '腾冲县', '龙陵县', '昌宁县', '其他'] }, { name:'昭通', area:['昭阳区', '鲁甸县', '巧家县', '盐津县', '大关县', '永善县', '绥江县', '镇雄县', '彝良县', '威信县', '水富县', '其他'] }, { name:'丽江', area:['古城区', '永胜县', '华坪县', '玉龙纳西族自治县', '宁蒗彝族自治县', '其他'] }, { name:'普洱', area:['思茅区', '普洱哈尼族彝族自治县', '墨江哈尼族自治县', '景东彝族自治县', '景谷傣族彝族自治县', '镇沅彝族哈尼族拉祜族自治县', '江城哈尼族彝族自治县', '孟连傣族拉祜族佤族自治县', '澜沧拉祜族自治县', '西盟佤族自治县', '其他'] }, { name:'临沧', area:['临翔区', '凤庆县', '云县', '永德县', '镇康县', '双江拉祜族佤族布朗族傣族自治县', '耿马傣族佤族自治县', '沧源佤族自治县', '其他'] }, { name:'德宏傣族景颇族自治州', area:['潞西市', '瑞丽市', '梁河县', '盈江县', '陇川县', '其他'] }, { name:'怒江傈僳族自治州', area:['泸水县', '福贡县', '贡山独龙族怒族自治县', '兰坪白族普米族自治县', '其他'] }, { name:'迪庆藏族自治州', area:['香格里拉县', '德钦县', '维西傈僳族自治县', '其他'] }, { name:'大理白族自治州', area:['大理市', '祥云县', '宾川县', '弥渡县', '永平县', '云龙县', '洱源县', '剑川县', '鹤庆县', '漾濞彝族自治县', '南涧彝族自治县', '巍山彝族回族自治县', '其他'] }, { name:'楚雄彝族自治州', area:['楚雄市', '双柏县', '牟定县', '南华县', '姚安县', '大姚县', '永仁县', '元谋县', '武定县', '禄丰县', '其他'] }, { name:'红河哈尼族彝族自治州', area:['蒙自县', '个旧市', '开远市', '绿春县', '建水县', '石屏县', '弥勒县', '泸西县', '元阳县', '红河县', '金平苗族瑶族傣族自治县', '河口瑶族自治县', '屏边苗族自治县', '其他'] }, { name:'文山壮族苗族自治州', area:['文山县', '砚山县', '西畴县', '麻栗坡县', '马关县', '丘北县', '广南县', '富宁县', '其他'] }, { name:'西双版纳傣族自治州', area:['景洪市', '勐海县', '勐腊县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'西藏', city:[{ name:'拉萨', area:['城关区', '林周县', '当雄县', '尼木县', '曲水县', '堆龙德庆县', '达孜县', '墨竹工卡县', '其他'] }, { name:'那曲地区', area:['那曲县', '嘉黎县', '比如县', '聂荣县', '安多县', '申扎县', '索县', '班戈县', '巴青县', '尼玛县', '其他'] }, { name:'昌都地区', area:['昌都县', '江达县', '贡觉县', '类乌齐县', '丁青县', '察雅县', '八宿县', '左贡县', '芒康县', '洛隆县', '边坝县', '其他'] }, { name:'林芝地区', area:['林芝县', '工布江达县', '米林县', '墨脱县', '波密县', '察隅县', '朗县', '其他'] }, { name:'山南地区', area:['乃东县', '扎囊县', '贡嘎县', '桑日县', '琼结县', '曲松县', '措美县', '洛扎县', '加查县', '隆子县', '错那县', '浪卡子县', '其他'] }, { name:'日喀则地区', area:['日喀则市', '南木林县', '江孜县', '定日县', '萨迦县', '拉孜县', '昂仁县', '谢通门县', '白朗县', '仁布县', '康马县', '定结县', '仲巴县', '亚东县', '吉隆县', '聂拉木县', '萨嘎县', '岗巴县', '其他'] }, { name:'阿里地区', area:['噶尔县', '普兰县', '札达县', '日土县', '革吉县', '改则县', '措勤县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'陕西', city:[{ name:'西安', area:['莲湖区', '新城区', '碑林区', '雁塔区', '灞桥区', '未央区', '阎良区', '临潼区', '长安区', '高陵县', '蓝田县', '户县', '周至县', '其他'] }, { name:'铜川', area:['耀州区', '王益区', '印台区', '宜君县', '其他'] }, { name:'宝鸡', area:['渭滨区', '金台区', '陈仓区', '岐山县', '凤翔县', '陇县', '太白县', '麟游县', '扶风县', '千阳县', '眉县', '凤县', '其他'] }, { name:'咸阳', area:['秦都区', '渭城区', '杨陵区', '兴平市', '礼泉县', '泾阳县', '永寿县', '三原县', '彬县', '旬邑县', '长武县', '乾县', '武功县', '淳化县', '其他'] }, { name:'渭南', area:['临渭区', '韩城市', '华阴市', '蒲城县', '潼关县', '白水县', '澄城县', '华县', '合阳县', '富平县', '大荔县', '其他'] }, { name:'延安', area:['宝塔区', '安塞县', '洛川县', '子长县', '黄陵县', '延川县', '富县', '延长县', '甘泉县', '宜川县', '志丹县', '黄龙县', '吴起县', '其他'] }, { name:'汉中', area:['汉台区', '留坝县', '镇巴县', '城固县', '南郑县', '洋县', '宁强县', '佛坪县', '勉县', '西乡县', '略阳县', '其他'] }, { name:'榆林', area:['榆阳区', '清涧县', '绥德县', '神木县', '佳县', '府谷县', '子洲县', '靖边县', '横山县', '米脂县', '吴堡县', '定边县', '其他'] }, { name:'安康', area:['汉滨区', '紫阳县', '岚皋县', '旬阳县', '镇坪县', '平利县', '石泉县', '宁陕县', '白河县', '汉阴县', '其他'] }, { name:'商洛', area:['商州区', '镇安县', '山阳县', '洛南县', '商南县', '丹凤县', '柞水县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'甘肃', city:[{ name:'兰州', area:['城关区', '七里河区', '西固区', '安宁区', '红古区', '永登县', '皋兰县', '榆中县', '其他'] }, { name:'嘉峪关', area:['嘉峪关市', '其他'] }, { name:'金昌', area:['金川区', '永昌县', '其他'] }, { name:'白银', area:['白银区', '平川区', '靖远县', '会宁县', '景泰县', '其他'] }, { name:'天水', area:['清水县', '秦安县', '甘谷县', '武山县', '张家川回族自治县', '北道区', '秦城区', '其他'] }, { name:'武威', area:['凉州区', '民勤县', '古浪县', '天祝藏族自治县', '其他'] }, { name:'酒泉', area:['肃州区', '玉门市', '敦煌市', '金塔县', '肃北蒙古族自治县', '阿克塞哈萨克族自治县', '安西县', '其他'] }, { name:'张掖', area:['甘州区', '民乐县', '临泽县', '高台县', '山丹县', '肃南裕固族自治县', '其他'] }, { name:'庆阳', area:['西峰区', '庆城县', '环县', '华池县', '合水县', '正宁县', '宁县', '镇原县', '其他'] }, { name:'平凉', area:['崆峒区', '泾川县', '灵台县', '崇信县', '华亭县', '庄浪县', '静宁县', '其他'] }, { name:'定西', area:['安定区', '通渭县', '临洮县', '漳县', '岷县', '渭源县', '陇西县', '其他'] }, { name:'陇南', area:['武都区', '成县', '宕昌县', '康县', '文县', '西和县', '礼县', '两当县', '徽县', '其他'] }, { name:'临夏回族自治州', area:['临夏市', '临夏县', '康乐县', '永靖县', '广河县', '和政县', '东乡族自治县', '积石山保安族东乡族撒拉族自治县', '其他'] }, { name:'甘南藏族自治州', area:['合作市', '临潭县', '卓尼县', '舟曲县', '迭部县', '玛曲县', '碌曲县', '夏河县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'青海', city:[{ name:'西宁', area:['城中区', '城东区', '城西区', '城北区', '湟源县', '湟中县', '大通回族土族自治县', '其他'] }, { name:'海东地区', area:['平安县', '乐都县', '民和回族土族自治县', '互助土族自治县', '化隆回族自治县', '循化撒拉族自治县', '其他'] }, { name:'海北藏族自治州', area:['海晏县', '祁连县', '刚察县', '门源回族自治县', '其他'] }, { name:'海南藏族自治州', area:['共和县', '同德县', '贵德县', '兴海县', '贵南县', '其他'] }, { name:'黄南藏族自治州', area:['同仁县', '尖扎县', '泽库县', '河南蒙古族自治县', '其他'] }, { name:'果洛藏族自治州', area:['玛沁县', '班玛县', '甘德县', '达日县', '久治县', '玛多县', '其他'] }, { name:'玉树藏族自治州', area:['玉树县', '杂多县', '称多县', '治多县', '囊谦县', '曲麻莱县', '其他'] }, { name:'海西蒙古族藏族自治州', area:['德令哈市', '格尔木市', '乌兰县', '都兰县', '天峻县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'宁夏', city:[{ name:'银川', area:['兴庆区', '西夏区', '金凤区', '灵武市', '永宁县', '贺兰县', '其他'] }, { name:'石嘴山', area:['大武口区', '惠农区', '平罗县', '其他'] }, { name:'吴忠', area:['利通区', '青铜峡市', '盐池县', '同心县', '其他'] }, { name:'固原', area:['原州区', '西吉县', '隆德县', '泾源县', '彭阳县', '其他'] }, { name:'中卫', area:['沙坡头区', '中宁县', '海原县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'新疆', city:[{ name:'乌鲁木齐', area:['天山区', '沙依巴克区', '新市区', '水磨沟区', '头屯河区', '达坂城区', '东山区', '乌鲁木齐县', '其他'] }, { name:'克拉玛依', area:['克拉玛依区', '独山子区', '白碱滩区', '乌尔禾区', '其他'] }, { name:'吐鲁番地区', area:['吐鲁番市', '托克逊县', '鄯善县', '其他'] }, { name:'哈密地区', area:['哈密市', '伊吾县', '巴里坤哈萨克自治县', '其他'] }, { name:'和田地区', area:['和田市', '和田县', '洛浦县', '民丰县', '皮山县', '策勒县', '于田县', '墨玉县', '其他'] }, { name:'阿克苏地区', area:['阿克苏市', '温宿县', '沙雅县', '拜城县', '阿瓦提县', '库车县', '柯坪县', '新和县', '乌什县', '其他'] }, { name:'喀什地区', area:['喀什市', '巴楚县', '泽普县', '伽师县', '叶城县', '岳普湖县', '疏勒县', '麦盖提县', '英吉沙县', '莎车县', '疏附县', '塔什库尔干塔吉克自治县', '其他'] }, { name:'克孜勒苏柯尔克孜自治州', area:['阿图什市', '阿合奇县', '乌恰县', '阿克陶县', '其他'] }, { name:'巴音郭楞蒙古自治州', area:['库尔勒市', '和静县', '尉犁县', '和硕县', '且末县', '博湖县', '轮台县', '若羌县', '焉耆回族自治县', '其他'] }, { name:'昌吉回族自治州', area:['昌吉市', '阜康市', '奇台县', '玛纳斯县', '吉木萨尔县', '呼图壁县', '木垒哈萨克自治县', '米泉市', '其他'] }, { name:'博尔塔拉蒙古自治州', area:['博乐市', '精河县', '温泉县', '其他'] }, { name:'石河子', area:['石河子'] }, { name:'阿拉尔', area:['阿拉尔'] }, { name:'图木舒克', area:['图木舒克'] }, { name:'五家渠', area:['五家渠'] }, { name:'伊犁哈萨克自治州', area:['伊宁市', '奎屯市', '伊宁县', '特克斯县', '尼勒克县', '昭苏县', '新源县', '霍城县', '巩留县', '察布查尔锡伯自治县', '塔城地区', '阿勒泰地区', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'台湾', city:[{ name:'台湾', area:['台北市', '高雄市', '台北县', '桃园县', '新竹县', '苗栗县', '台中县', '彰化县', '南投县', '云林县', '嘉义县', '台南县', '高雄县', '屏东县', '宜兰县', '花莲县', '台东县', '澎湖县', '基隆市', '新竹市', '台中市', '嘉义市', '台南市', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'澳门', city:[{ name:'澳门', area:['花地玛堂区', '圣安多尼堂区', '大堂区', '望德堂区', '风顺堂区', '嘉模堂区', '圣方济各堂区', '路凼', '其他'] }] }, { name:'香港', city:[{ name:'香港', area:['中西区', '湾仔区', '东区', '南区', '深水埗区', '油尖旺区', '九龙城区', '黄大仙区', '观塘区', '北区', '大埔区', '沙田区', '西贡区', '元朗区', '屯门区', '荃湾区', '葵青区', '离岛区', '其他'] }] }, { name:'钓鱼岛', city:[{ name:'钓鱼岛', area:['钓鱼岛'] }] }];

```

* PDShop/project/App/manager/JpushMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    NativeAppEventEmitter,
    Platform,
} = ReactNative;
const EventEmitter = require('EventEmitter');
import JPushModule from 'jpush-react-native';
class Manager extends EventEmitter {
    register () {
        if (Platform.OS === 'android') {
            JPushModule.notifyJSDidLoad((resultCode) => {
                if (resultCode === 0) {
                    console.log('--------------notifyJSDidLoad success');
                }
            });
            JPushModule.addReceiveNotificationListener((map) => {
                console.log('------------------addReceiveNotificationListener' + JSON.stringify(map));
                this.emit('receiveJpushNotification', { context:map.alertContent });
                   // var extra = JSON.parse(map.extras);
                   // console.log(extra.key + ": " + extra.value);
            });
        } else {
            this.subscription = NativeAppEventEmitter.addListener(
             'receiveNotification',
             (notification) => {
                 console.log('----------------notification', notification);
                 this.emit('receiveJpushNotification', { context:notification.aps.alert });
             }
           );
        }
    }
    clear () {
        if (this.subscription) {
            this.subscription.remove();
            this.subscription = null;
        }
        JPushModule.removeReceiveCustomMsgListener();
        JPushModule.removeReceiveNotificationListener();
    }
}

module.exports = new Manager();

```

* PDShop/project/App/manager/LoginMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'LOGIN_HISTORY_LIST';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.list = [];
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let list = [];
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                list = JSON.parse(infoStr);
            } catch (e) {
            }
            this.list = list || [];
        });
    }
    set (list) {
        return new Promise(async(resolve, reject) => {
            this.list = list;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(list));
            resolve();
        });
    }
    savePhone (phone) {
        let list = this.list;
        if (_.includes(list, phone)) {
            list = _.without(list, phone);
        }
        list.unshift(phone);
        this.set(list);
    }
    clear () {
        this.list = [];
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDShop/project/App/manager/NetMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    Platform,
    NetInfo,
} = ReactNative;
const EventEmitter = require('EventEmitter');

class Manager extends EventEmitter {
    constructor () {
        super();
        this._init = false;
        this.info = {
            connect: false, // 是否连接
            fee: false, // 是否收费
        };
    }
    register () {
        if (!this._init) {
            this._init = true;
            NetInfo.addEventListener(
                'change',
                this._handleConnectionInfoChange.bind(this)
            );
        }
    }
    unregister () {
        NetInfo.removeEventListener(
            'change',
            this._handleConnectionInfoChange.bind(this)
        );
        this._init = false;
    }
    _handleConnectionInfoChange (o) {
        this.updateConnectionInfo(o);
    }
    updateConnectionInfo (o) {
        if (Platform.OS === 'android') {
            if (o === 'WIFI' || o === 'ETHERNET' || o === 'DUMMY') {
                this.info = { connect: true, fee: false };
            } else if (/MOBILE.*/.test(o)) {
                this.info = { connect: true, fee: true };
            } else {
                this.info = { connect: false, fee: false };
            }
        } else {
            if (o === 'wifi') {
                this.info = { connect: true, fee: false };
            } else if (o === 'cell') {
                this.info = { connect: true, fee: true };
            } else {
                this.info = { connect: false, fee: false };
            }
        }
        app.connect = this.info.connect;
        if (!app.connect) {
            // Toast('当前设备已离线，请检查您的网络是否可用');
        }
    }
}

module.exports = new Manager();

```

* PDShop/project/App/manager/PersonalInfoMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');
const ITEM_NAME = 'personalInfo';
const NEED_LOGIN_ITEM_NAME = 'personalInfoNeedLogin';
const REMAIN_AMOUNR = 'remainAmount';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let info;
            try {
                const needLogin = await AsyncStorage.getItem(NEED_LOGIN_ITEM_NAME);
                this.needLogin = needLogin !== 'false';
                this.remainAmount = await AsyncStorage.getItem(REMAIN_AMOUNR);
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                info = JSON.parse(infoStr);
            } catch (e) {
                this.needLogin = true;
            }
            this.info = info || {};
            this.needLogin = this.needLogin || !info;
            this.remainAmount = this.remainAmount || !info;
            this.initialized = true;
        });
    }
    set (info) {
        this.info = info;
        return new Promise(async(resolve, reject) => {
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(info));
            resolve();
        });
    }
    setUserHead (head) {
        this.emit('USER_HEAD_CHANGE_EVENT', { head:head });
    }
    setNeedLogin (flag) {
        this.needLogin = flag;
        AsyncStorage.setItem(NEED_LOGIN_ITEM_NAME, flag + '');
    }
    setRemainAmount (amount) {
        this.remainAmount = amount;
        AsyncStorage.setItem(REMAIN_AMOUNR, amount + '');
    }
}

module.exports = new Manager();

```

* PDShop/project/App/manager/ScanStoageOrderMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'SCAN_STOAGE_ORDER_LIST';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.list = [];
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let list = [];
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                list = JSON.parse(infoStr);
            } catch (e) {
            }
            this.list = list || [];
        });
    }
    set (list) {
        return new Promise(async(resolve, reject) => {
            this.list = list;
            this.totalOrders = list.length;
            this.totalNumbers = _.sumBy(list, 'totalNumbers');
            this.totalSize = _.sumBy(list, 'size');
            this.totalWeight = _.sumBy(list, 'weight');
            this.stoageNumbers = _.sumBy(list, o => { return _.sumBy(o.stateList, item => { return item.state == 6 && item.count; }); });
            this.unStoageNumbers = _.sumBy(list, o => { return _.sumBy(o.stateList, item => { return item.state == 5 && item.count; }); });
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(list));
            resolve();
        });
    }
    saveOrder (order) {
        let list = this.list;
        console.log('--------', order, list);
        if (_.find(list, o => { return o.id == order.id; })) {
            console.log('--------1', order, list);
            _.remove(list, o => { return o.id == order.id; });
            console.log('--------2', order, list);
        }
        list.unshift(order);
        console.log('--------3', order, list);
        this.set(list);
    }
    clear () {
        this.list = [];
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDShop/project/App/manager/SettingMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'APP_SETTING_MANAGER';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.data = {};
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let data = {};
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                data = JSON.parse(infoStr);
            } catch (e) {
                data = {};
            }
            this.data = data || {};
            this.THEME_COLOR = this.data.themeColor || CONSTANTS.THEME_COLORS[0];
        });
    }
    set (data) {
        return new Promise(async(resolve, reject) => {
            this.data = data;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(data));
            resolve();
        });
    }
    setOnlyWifiUpload (flag) {
        const data = this.data;
        data.onlyWifiUpload = flag;
        this.set(data);
    }
    setThemeColor (color) {
        const data = this.data;
        data.themeColor = color;
        this.set(data);
        this.THEME_COLOR = color;
        app.update();
    }
    clear () {
        this.data = {};
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDShop/project/App/manager/UpdateMgr.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'NEED_SHOW_SPLASH';
const Update = require('@remobile/react-native-update');
const UpdateInfoBox = require('../modules/update/UpdateInfoBox');

class Manager extends EventEmitter {
    constructor () {
        super();
        this.needShowSplash = true;
        this.getNeedShowSplash();
    }
    checkUpdate () {
        Update.checkVersion({
            versionUrl: app.route.ROUTE_VERSION_INFO_URL,
            iosAppId: CONSTANTS.IOS_APPID,
        }).then((options) => {
            if (!__DEV__ && options && options.newVersion && (app.scene || {}).pageName !== 'UpdatePage') {
                app.showModal(<UpdateInfoBox options={options} />, { backgroundColor:'rgba(0, 0, 0, 0.6)' });
            }
        });
    }
    getNeedShowSplash () {
        return new Promise(async(resolve, reject) => {
            let needShowSplash;
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                needShowSplash = JSON.parse(infoStr);
            } catch (e) {
            }
            this.needShowSplash = needShowSplash == null ? true : needShowSplash;
            this.initialized = true;
        });
    }
    setNeedShowSplash (needShowSplash) {
        return new Promise(async(resolve, reject) => {
            this.needShowSplash = needShowSplash;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(needShowSplash));
            resolve();
        });
    }
    clear () {
        this.needShowSplash = null;
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDShop/project/App/manager/WXpayMgr.js

```js
'use strict';
const { NativeAppEventEmitter, DeviceEventEmitter, Platform } = require('react-native');
const EventEmitter = require('EventEmitter');
const Wxpay = require('../native/index.js').WeixinPay;
const gEventEmitter = Platform.OS === 'android' ? DeviceEventEmitter : NativeAppEventEmitter;

class Manager extends EventEmitter {
    /*
    * 注：amount为充值金额，单位为【元】。
    * body: 描述
    * appid: 公众账号ID
    * noncestr: 随机字符串
    * package: 扩展字段
    * partnerid: 商户号
    * prepayid: 预支付交易会话ID
    * timestamp: 时间戳
    * sign: 签名
    */
    doPay (amount, body, callbackSuccess, callbackError) {
        this.subscription = gEventEmitter.addListener('WEIXIN_PAY', (obj) => { this.onPayResult(obj, callbackSuccess, callbackError); });
        var param = {
            userId:app.personal.info.userId,
            amount, // :1, //总金额 (元)
            body, // :'充值',
        };
        POST(app.route.ROUTE_GET_UNIFIED_ORDER, param, (data) => {
            if (data.success) {
                !data.context ? callbackSuccess(data) : Wxpay.pay(data.context, callbackSuccess, callbackError);
            } else {
                Toast(data.msg);
            }
        });
    }
    onPayResult (data, callbackSuccess, callbackError) {
        if (this.subscription) {
            this.subscription.remove();
            this.subscription = null;
        }
        if (data.success == 'true') {
            callbackSuccess(data);
        } else {
            callbackError(data);
        }
    }
}
module.exports = new Manager();

```

* PDShop/project/App/resource/audio.js

```js
module.exports = {
};

```

* PDShop/project/App/resource/image.js

```js
module.exports = {
    cargo_balance_background:require('./image/cargo/balance_background.png'),
    cargo_cancel:require('./image/cargo/cancel.png'),
    cargo_point:require('./image/cargo/point.png'),
    chairman_date:require('./image/chairman/date.png'),
    chairman_selcet_mine:require('./image/chairman/selcet_mine.png'),
    chairman_select_incomestatistics:require('./image/chairman/select_incomestatistics.png'),
    chairman_select_orderstatistics:require('./image/chairman/select_orderstatistics.png'),
    chairman_un_selcet_mine:require('./image/chairman/un_selcet_mine.png'),
    chairman_un_select_incomestatistics:require('./image/chairman/un_select_incomestatistics.png'),
    chairman_un_select_orderstatistics:require('./image/chairman/un_select_orderstatistics.png'),
    common_back:require('./image/common/back.png'),
    common_close:require('./image/common/close.png'),
    common_default:require('./image/common/default.png'),
    common_go:require('./image/common/go.png'),
    common_home:require('./image/common/home.png'),
    common_left_menu:require('./image/common/left_menu.png'),
    common_radio:require('./image/common/radio.png'),
    common_search:require('./image/common/search.png'),
    common_search_button:require('./image/common/search_button.png'),
    home_cargo:require('./image/home/cargo.png'),
    home_cargo_order:require('./image/home/cargo_order.png'),
    home_cargo_order_press:require('./image/home/cargo_order_press.png'),
    home_cargo_press:require('./image/home/cargo_press.png'),
    home_main:require('./image/home/main.png'),
    home_main_press:require('./image/home/main_press.png'),
    home_mine:require('./image/home/mine.png'),
    home_mine_press:require('./image/home/mine_press.png'),
    home_order:require('./image/home/order.png'),
    home_order_press:require('./image/home/order_press.png'),
    home_pre_order:require('./image/home/pre_order.png'),
    home_pre_order_press:require('./image/home/pre_order_press.png'),
    home_roadmap:require('./image/home/roadmap.png'),
    home_roadmap_press:require('./image/home/roadmap_press.png'),
    home_storage:require('./image/home/storage.png'),
    home_storage_press:require('./image/home/storage_press.png'),
    home_warehouse_order:require('./image/home/warehouse_order.png'),
    home_warehouse_order_press:require('./image/home/warehouse_order_press.png'),
    login_alipay_button:require('./image/login/alipay_button.png'),
    login_logo:require('./image/login/logo.png'),
    login_password:require('./image/login/password.png'),
    login_password_check:require('./image/login/password_check.png'),
    login_password_look:require('./image/login/password_look.png'),
    login_phone:require('./image/login/phone.png'),
    login_qq_button:require('./image/login/qq_button.png'),
    login_weixin_button:require('./image/login/weixin_button.png'),
    moving_message:require('./image/moving/message.png'),
    moving_message_r:require('./image/moving/message_r.png'),
    moving_message_select:require('./image/moving/message_select.png'),
    moving_message_unselect:require('./image/moving/message_unselect.png'),
    moving_moving_select:require('./image/moving/moving_select.png'),
    moving_moving_unselect:require('./image/moving/moving_unselect.png'),
    moving_no_message:require('./image/moving/no_message.png'),
    moving_person_select:require('./image/moving/person_select.png'),
    moving_person_unselect:require('./image/moving/person_unselect.png'),
    moving_setting:require('./image/moving/setting.png'),
    order_add:require('./image/order/add.png'),
    order_choose:require('./image/order/choose.png'),
    order_choose_r:require('./image/order/choose_r.png'),
    order_delete:require('./image/order/delete.png'),
    order_down:require('./image/order/down.png'),
    order_logo:require('./image/order/logo.png'),
    order_no_choose:require('./image/order/no_choose.png'),
    order_no_choose_r:require('./image/order/no_choose_r.png'),
    order_pay_success:require('./image/order/pay_success.png'),
    order_upload_picture:require('./image/order/upload_picture.png'),
    personal_add:require('./image/personal/add.png'),
    personal_default_head:require('./image/personal/default_head.png'),
    personal_delete:require('./image/personal/delete.png'),
    personal_female:require('./image/personal/female.png'),
    personal_info:require('./image/personal/info.png'),
    personal_male:require('./image/personal/male.png'),
    personal_money:require('./image/personal/money.png'),
    personal_personal_center:require('./image/personal/personal_center.png'),
    personal_scan:require('./image/personal/scan.png'),
    personal_settings:require('./image/personal/settings.png'),
    personal_wallet:require('./image/personal/wallet.png'),
    receive_camera:require('./image/receive/camera.png'),
    receive_no_orders:require('./image/receive/no_orders.png'),
    receive_order:require('./image/receive/order.png'),
    receive_order_default:require('./image/receive/order_default.png'),
    receive_order_press:require('./image/receive/order_press.png'),
    receive_take_picture:require('./image/receive/take_picture.png'),
    receive_take_picture_press:require('./image/receive/take_picture_press.png'),
    roadmap_add_photos:require('./image/roadmap/add_photos.png'),
    roadmap_address:require('./image/roadmap/address.png'),
    roadmap_collection_normal:require('./image/roadmap/collection_normal.png'),
    roadmap_collection_press:require('./image/roadmap/collection_press.png'),
    roadmap_comment:require('./image/roadmap/comment.png'),
    roadmap_share:require('./image/roadmap/share.png'),
    security_scan_check_pass:require('./image/security/scan_check_pass.png'),
    shipper_care_normal:require('./image/shipper/care_normal.png'),
    shipper_care_press:require('./image/shipper/care_press.png'),
    shipper_phone:require('./image/shipper/phone.png'),
    shop_add_photos:require('./image/shop/add_photos.png'),
    shop_address:require('./image/shop/address.png'),
    shop_back:require('./image/shop/back.png'),
    shop_choice:require('./image/shop/choice.png'),
    shop_comment:require('./image/shop/comment.png'),
    shop_follow_normal:require('./image/shop/follow_normal.png'),
    shop_follow_press:require('./image/shop/follow_press.png'),
    shop_home:require('./image/shop/home.png'),
    shop_no_comment:require('./image/shop/no_comment.png'),
    shop_no_share:require('./image/shop/no_share.png'),
    shop_phone:require('./image/shop/phone.png'),
    shop_praise_normal:require('./image/shop/praise_normal.png'),
    shop_praise_press:require('./image/shop/praise_press.png'),
    shop_report_normal:require('./image/shop/report_normal.png'),
    shop_report_press:require('./image/shop/report_press.png'),
    shop_share:require('./image/shop/share.png'),
    shop_shop_down_left:require('./image/shop/shop_down_left.png'),
    shop_shop_down_right:require('./image/shop/shop_down_right.png'),
    shop_unchoice:require('./image/shop/unchoice.png'),
    shop_zan_normal:require('./image/shop/zan_normal.png'),
    shop_zan_press:require('./image/shop/zan_press.png'),
    splash_logo:require('./image/splash/logo.png'),
    splash_splash1:require('./image/splash/splash1.png'),
    splash_splash2:require('./image/splash/splash2.png'),
    splash_splash3:require('./image/splash/splash3.png'),
    splash_start:require('./image/splash/start.png'),
    storage_scan:require('./image/storage/scan.png'),
    storage_scan_code_storage:require('./image/storage/scan_code_storage.png'),
};

```

* PDShop/project/App/utils/index.js

```js
const common = require('./common');
const net = require('./net');
const check = require('./check');
const date = require('./date');
const qrcode = require('./qrcode');

module.exports = {
    ...common,
    ...net,
    ...check,
    ...date,
    ...qrcode,
};

```

* PDShop/project/App/components/ActionSheet/button.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    render () {
        return (
            <TouchableOpacity
                activeOpacity={0.5}
                style={[styles.button, this.props.buttonStyle]}
                onPress={this.props.onPress}>
                <Text style={[styles.buttonText, this.props.textStyle]}>
                    {this.props.children}
                </Text>
            </TouchableOpacity>
        );
    },
});

const styles = StyleSheet.create({
    buttonText: {
        color: '#A1A2A3',
        alignSelf: 'center',
        fontSize: 18,
    },
    button: {
        height: 50,
        backgroundColor: '#FEFFFF',
        borderColor: '#EDEEEF',
        borderBottomWidth: 1,
        alignSelf: 'stretch',
        justifyContent: 'center',
    },
});

```

* PDShop/project/App/components/ActionSheet/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    TouchableOpacity,
    View,
} = ReactNative;

const Button = require('./button');
const Overlay = require('./overlay');
const Sheet = require('./sheet');

module.exports = React.createClass({
    getDefaultProps () {
        return {
            cancelText: 'Cancel',
        };
    },
    render () {
        return (
            <Overlay visible={this.props.visible}>
                <View style={styles.actionSheetContainer}>
                    <TouchableOpacity
                        style={{ flex:1 }}
                        onPress={this.props.onCancel} />
                    <Sheet visible={this.props.visible}>
                        <View style={styles.buttonContainer}>
                            {this.props.children}
                        </View>
                        <Button
                            buttonStyle={styles.cancelButton}
                            textStyle={styles.cancelText}
                            onPress={this.props.onCancel}>{this.props.cancelText}</Button>
                    </Sheet>
                </View>
            </Overlay>
        );
    },
});
module.exports.Button = Button;

const styles = StyleSheet.create({
    actionSheetContainer: {
        flex: 1,
        padding: 10,
        paddingBottom: 6,
        justifyContent: 'flex-end',
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
    },
    buttonContainer: {
        borderRadius:6,
        overflow: 'hidden',
    },
    cancelButton: {
        marginTop:6,
        marginBottom:6,
        borderRadius:6,
        backgroundColor: '#A0D26F',
        borderBottomWidth: 0,
    },
    cancelText: {
        color:'#FFFFFF',
    },
});

```

* PDShop/project/App/components/ActionSheet/overlay.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Animated,
    StyleSheet,
} = ReactNative;

const DEFAULT_ANIMATE_TIME = 300;

module.exports = React.createClass({
    getInitialState () {
        return {
            fadeAnim: new Animated.Value(0),
            overlayStyle: styles.emptyOverlay, // on android opacity=0 also can cover screen, so use overlayStyle fix it
        };
    },
    onAnimatedEnd () {
        !this.props.visible && this.setState({ overlayStyle:styles.emptyOverlay });
    },
    componentWillReceiveProps (newProps) {
        newProps.visible && this.setState({ overlayStyle: styles.fullOverlay });
        return Animated.timing(this.state.fadeAnim, {
            toValue: newProps.visible ? 1 : 0,
            duration: DEFAULT_ANIMATE_TIME,
        }).start(this.onAnimatedEnd);
    },

    render () {
        return (
            <Animated.View style={[this.state.overlayStyle, { opacity: this.state.fadeAnim }]}>
                {this.props.children}
            </Animated.View>
        );
    },
});

const styles = StyleSheet.create({
    fullOverlay: {
        top: 0,
        bottom: 0,
        left: 0,
        right: 0,
        backgroundColor: 'transparent',
        position: 'absolute',
    },
    emptyOverlay: {
        backgroundColor: 'transparent',
        position: 'absolute',
        left: -sr.w,
    },
});

```

* PDShop/project/App/components/ActionSheet/sheet.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Animated,
} = ReactNative;

const DEFAULT_BOTTOM = -300;
const DEFAULT_ANIMATE_TIME = 300;

module.exports = React.createClass({
    getInitialState () {
        return {
            bottom: new Animated.Value(DEFAULT_BOTTOM),
        };
    },
    componentWillReceiveProps (newProps) {
        return Animated.timing(this.state.bottom, {
            toValue: newProps.visible ? 0 : DEFAULT_BOTTOM,
            duration: DEFAULT_ANIMATE_TIME,
        }).start();
    },

    render () {
        return (
            <Animated.View style={{ bottom: this.state.bottom }}>
                {this.props.children}
            </Animated.View>
        );
    },
});

```

* PDShop/project/App/modules/chairman/IncomeStatistics.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
    Text,
} = ReactNative;

const Statistics = require('./Statistics');

module.exports = React.createClass({
    statics :{
        title : '收入统计',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '收入统计';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    render () {
        return (
            <View style={styles.container}>
                <TouchableOpacity style={styles.row} onPress={() => app.push({ component : Statistics, title : '整店收入',
                    passProps : { type : 'totalincome', buttonList : ['总提成', '总部提成', '分部提成', '手续费'] } })}>
                    <Text style={styles.rowText}>整店收入</Text>
                    <Image
                        source={app.img.common_go}
                        style={styles.goStyle} />
                </TouchableOpacity>
                <TouchableOpacity style={styles.row} onPress={() => app.push({ component : Statistics, title : '收货部',
                    passProps : { type : 'receiveincome', buttonList : ['库存', '入库', '重量', '方量'] } })}>
                    <Text style={styles.rowText}>收货部</Text>
                    <Image
                        source={app.img.common_go}
                        style={styles.goStyle} />
                </TouchableOpacity>
                <TouchableOpacity style={styles.row} onPress={() => app.push({ component : Statistics, title : '搬运部',
                    passProps : { type : 'movungincome', buttonList : ['总收入', '搬运价'] } })}>
                    <Text style={styles.rowText}>搬运部</Text>
                    <Image
                        source={app.img.common_go}
                        style={styles.goStyle} />
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
    row: {
        width:sr.w,
        height:42,
        flexDirection:'row',
        alignItems:'center',
        backgroundColor:'#ffffff',
        marginTop:1,
    },
    rowText: {
        marginLeft:10,
        fontSize:14,
        fontWeight:'300',
        flex:1,
    },
    goStyle: {
        height: 13,
        width: 8,
        marginRight: 20,
    },
});

```

* PDShop/project/App/modules/chairman/OrderStatistics.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
    Text,
} = ReactNative;

const Statistics = require('./Statistics');

module.exports = React.createClass({
    statics :{
        title : '货单统计',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '货单统计';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    render () {
        return (
            <View style={styles.container}>
                <TouchableOpacity style={styles.row} onPress={() => app.push({ component : Statistics, title : '总货单',
                    passProps : { type : 'totalorder', buttonList : ['库存', '入库', '重量', '方量'] } })}>
                    <Text style={styles.rowText}>总货单</Text>
                    <Image
                        source={app.img.common_go}
                        style={styles.goStyle} />
                </TouchableOpacity>
                <TouchableOpacity style={styles.row} onPress={() => app.push({ component : Statistics, title : '收货部',
                    passProps : { type : 'receiveorder', buttonList : ['库存', '入库', '重量', '方量'] } })}>
                    <Text style={styles.rowText}>收货部</Text>
                    <Image
                        source={app.img.common_go}
                        style={styles.goStyle} />
                </TouchableOpacity>
                <TouchableOpacity style={styles.row} onPress={() => app.push({ component : Statistics, title : '搬运部',
                    passProps : { type : 'movingorder', buttonList : ['搬运单数', '搬运价'] } })}>
                    <Text style={styles.rowText}>搬运部</Text>
                    <Image
                        source={app.img.common_go}
                        style={styles.goStyle} />
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
    row: {
        width:sr.w,
        height:42,
        flexDirection:'row',
        alignItems:'center',
        backgroundColor:'#ffffff',
        marginTop:1,
    },
    rowText: {
        marginLeft:10,
        fontSize:14,
        fontWeight:'300',
        flex:1,
    },
    goStyle: {
        height: 13,
        width: 8,
        marginRight: 20,
    },
});

```

* PDShop/project/App/modules/chairman/Statistics.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
    Text,
} = ReactNative;

import moment from 'moment';

const { Button, Picker } = COMPONENTS;
const Line = require('../common/Line');

module.exports = React.createClass({
    getInitialState () {
        return {
            data : '',
            startDate : moment().format('YYYY年M月D日'),
            endDate : moment().format('YYYY年M月D日'),
            type : true,
            month : moment().format('YYYY年M月'),
        };
    },
    componentWillMount () {
        this.getStatistics();
    },
    getStatistics () {
        const param = {
            userId : app.personal.info.userId,
            shopId : app.personal.info.shop.id,
        };
        POST(app.route.ROUTE_GET_STATISTICS, param, this.getStatisticsSuccess, false);
    },
    getStatisticsSuccess (data) {
        const { buttonList, type } = this.props;
        if (data.success) {
            let dataSource = data.context;
            if (type == 'totalorder') {
                dataSource = [{
                    name: buttonList[0],
                    type: 'line',
                    data: dataSource.count,
                },
                {
                    name: buttonList[2],
                    type: 'line',
                    data: dataSource.weight,
                },
                {
                    name: buttonList[3],
                    type: 'line',
                    data: dataSource.size,
                }];
            } else if (type == 'receiveorder') {
                dataSource = [{
                    name: buttonList[1],
                    type: 'line',
                    data: dataSource.count,
                },
                {
                    name: buttonList[2],
                    type: 'line',
                    data: dataSource.weight,
                },
                {
                    name: buttonList[3],
                    type: 'line',
                    data: dataSource.size,
                }];
            } else if (type == 'movingorder') {
                dataSource = [{
                    name: buttonList[0],
                    type: 'line',
                    data: dataSource.count,
                },
                {
                    name: buttonList[1],
                    type: 'line',
                    data: [2, 6, 4, 3, 1, 6, 0],
                }];
            } else if (type == 'totalincome') {
                dataSource = [{
                    name: buttonList[0],
                    type: 'line',
                    data: dataSource.branchProfit,
                },
                {
                    name: buttonList[1],
                    type: 'line',
                    data: dataSource.masterProfit,
                },
                {
                    name: buttonList[2],
                    type: 'line',
                    data: dataSource.branchProfit,
                },
                {
                    name: buttonList[3],
                    type: 'line',
                    data: dataSource.proxyCharge,
                }];
            } else if (type == 'receiveincome') {
                dataSource = [{
                    name: buttonList[0],
                    type: 'line',
                    data: dataSource.profit,
                },
                {
                    name: buttonList[1],
                    type: 'line',
                    data: dataSource.masterProfit,
                },
                {
                    name: buttonList[2],
                    type: 'line',
                    data: dataSource.branchProfit,
                },
                {
                    name: buttonList[3],
                    type: 'line',
                    data: dataSource.proxyChargeProfit,
                }];
            } else if (type == 'movungincome') {
                dataSource = [{
                    name: buttonList[0],
                    type: 'line',
                    data: dataSource.count,
                },
                {
                    name: buttonList[1],
                    type: 'line',
                    data: null,
                }];
            }
            this.setState({ data : dataSource });
        } else {
            Toast(data.msg);
        }
    },
    showDatePicker (Picker, start, end, selected, type) {
        const status = this.state.type;
        const selectedValue = [selected.year() + '-', (selected.month() + 1) + '-', selected.date() + '-'];
        const pickerData = status ? app.utils.createDateData(start, end) : app.utils.createMonthData(start, end);
        Picker(pickerData, selectedValue, '选择日期').then((value) => {
            const time = moment(value.join(''), 'YYYY-M-D');
            const date = moment(time.year() + '-' + (time.month() + 1) + '-' + time.date() + '-', 'YYYY-MM-DD');
            if (type == 'start') {
                this.setState({ startDate : value });
            } else if (type == 'end') {
                this.setState({ endDate : value });
            } else if (type == 'month') {
                this.setState({ month : value });
            }
        });
    },
    render () {
        const { buttonList } = this.props;
        const { data, startDate, endDate, type, month } = this.state;
        const list = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
        const day = moment().day();
        const days = _.rangeRight(day, day - 7).map(o => list[(o + 7) % 7]);
        return (
            <View style={styles.container}>
                <View style={styles.title}>
                    <Image source={app.img.chairman_date} style={styles.dateImg} />
                    {
                        type && <View style={styles.title}>
                            <TouchableOpacity onPress={() => { this.showDatePicker(Picker, moment('2017-01-01'), moment('2050-12-31'), moment(), 'start'); }}>
                                <Text style={styles.titleText}>{startDate}</Text>
                            </TouchableOpacity>
                            <Text style={styles.titleText}>|</Text>
                            <TouchableOpacity onPress={() => { this.showDatePicker(Picker, moment(startDate), moment('2050-12-31'), moment(), 'end'); }}>
                                <Text style={styles.titleText}>{endDate}</Text>
                            </TouchableOpacity>
                        </View> || <View style={styles.title}>
                            <TouchableOpacity onPress={() => { this.showDatePicker(Picker, moment('2017-01'), moment('2050-12'), moment(), 'month'); }}>
                                <Text style={styles.titleText}>{month}</Text>
                            </TouchableOpacity>
                        </View>
                    }

                    <TouchableOpacity style={styles.chooseType} onPress={() => { this.setState({ type : !type }); }}>
                        <Text style={styles.chooseTypeText}>{type ? '按日期' : '按月份'}</Text>
                    </TouchableOpacity>

                </View>
                <View style={styles.textInfo}>
                    <View style={styles.info}>
                        <Text style={styles.infoText}>总库存: 16825单</Text>
                        <Text style={styles.infoText}>总入库: 16825单</Text>
                        <Text style={styles.infoText}>库存方量: {app.utils.N(13451.23)}m³</Text>
                        <Text style={styles.infoText}>库存重量: {app.utils.N(13451.23)}吨</Text>
                    </View>
                </View>
                <View style={styles.chart}>
                    <Line title={buttonList} data={data} day={days} />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    title:{
        flexDirection:'row',
        height:35,
        alignItems:'center',
        paddingLeft:10,
    },
    titleText:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    dateImg: {
        width:15,
        height:15,
    },
    chooseType: {
        flex:1,
        alignItems:'flex-end',
    },
    chooseTypeText: {
        fontSize:14,
        color:'#333333',
        marginRight:10,
    },
    textInfo:{
        width:sr.w,
        height:128,
        backgroundColor:'#ffffff',
        flexDirection:'row',
        justifyContent:'center',
        marginBottom:1,
    },
    info: {
        height:100,
        width:sr.w * 0.8,
        backgroundColor:'#F4F4F4',
        alignSelf:'center',
        paddingTop:5,
        paddingLeft:10,
    },
    infoText: {
        flex:1,
        fontSize:14,
        fontWeight:'300',
    },
    buttonList: {
        height:100,
        alignSelf:'center',
        marginLeft:20,
        justifyContent:'flex-start',
    },
    btn: {
        backgroundColor:'#ffffff',
        height:20,
        width:65,
        marginTop:5,
        borderRadius:1,
        borderColor:'#DDDDDD',
        borderWidth:1,
    },
    btnText: {
        fontSize:13,
        color:'#666666',
        fontWeight:'400',
    },
    chart: {
        flex:1,
        backgroundColor:'#ffffff',
    },
});

```

* PDShop/project/App/modules/chairman/index.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

const OrderStatistics = require('./OrderStatistics');
const IncomeStatistics = require('./IncomeStatistics');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: OrderStatistics },
    { index: 1, component: IncomeStatistics },
    { index: 2, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '货单统计', icon:app.img.chairman_un_select_orderstatistics, selected: app.img.chairman_select_orderstatistics },
            { index: 1, title: '收入统计', icon: app.img.chairman_un_select_incomestatistics, selected: app.img.chairman_select_incomestatistics },
            { index: 2, title: '我的', icon: app.img.chairman_un_selcet_mine, selected: app.img.chairman_selcet_mine },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDShop/project/App/modules/baidumap/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

import { MapView, MapTypes, Geolocation } from '@remobile/react-native-baidu-map';

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '货物所在地',
    },
    getInitialState () {
        return {
            mayType: MapTypes.NORMAL,
            zoom: 15,
            center: {
                longitude: 106.6886,
                latitude: 26.566621,
            },
            trafficEnabled: false,
            baiduHeatMapEnabled: false,
            marker: {
                longitude: 106.6886,
                latitude: 26.566621,
                title: '花果园',
                city:'贵阳市',
                province:'贵州省',
            },
        };
    },
    componentWillMount () {
        Geolocation.getCurrentPosition()
            .then(data => {
                console.warn(JSON.stringify(data));
                this.setState({
                    zoom: 15,
                    marker: {
                        latitude: data.latitude,
                        longitude: data.longitude,
                        title: data.address,
                        city:data.city,
                        province:data.province,
                    },
                    center: {
                        latitude: data.latitude,
                        longitude: data.longitude,
                        rand: Math.random(),
                    },
                });
            })
            .catch(e => {
                console.warn(e, 'error');
            });
    },
    render () {
        const { marker } = this.state;
        return (
            <View style={styles.container}>
                <View>
                    <Text style={styles.selectPositionText}>{marker.title}</Text>
                    <Button onPress={() => { this.props.confirm(marker); app.pop(); }} style={styles.btnConfirm} >
                        确认货物所在地
                    </Button>
                </View>
                <MapView
                    trafficEnabled={this.state.trafficEnabled}
                    baiduHeatMapEnabled={this.state.baiduHeatMapEnabled}
                    zoom={this.state.zoom}
                    mapType={this.state.mapType}
                    center={this.state.center}
                    marker={this.state.marker}
                    markers={this.state.markers}
                    style={styles.map}
                    onMarkerClick={(data) => {
                        console.warn('onMarkerClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.position.latitude, data.position.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.position.latitude,
                                        longitude: data.position.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                    onMapPoiClick={(data) => {
                        console.warn('onMapPoiClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                    onMapClick={(data) => {
                        console.warn('onMapClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}

                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'flex-start',
        alignItems: 'center',
        backgroundColor: '#F5FCFF',
    },
    map: {
        width: sr.w,
        height: sr.h - 150,
        marginBottom: 50,
        marginTop:10,
        backgroundColor: 'red',
    },
    selectPositionText :{
        paddingVertical:12,
        alignSelf:'center',
        fontSize:16,
    },
    btnConfirm:{
        height:35,
        width:200,
        borderRadius:2,
    },
});

```

* PDShop/project/App/modules/baidumap/test.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Button,
} = ReactNative;

import { MapView, MapTypes, Geolocation } from '@remobile/react-native-baidu-map';

const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    componentWillMount () {
        SplashScreen.hide();
    },
    getInitialState () {
        return {
            mayType: MapTypes.NORMAL,
            zoom: 15,
            center: {
                longitude: 113.981718,
                latitude: 22.542449,
            },
            trafficEnabled: false,
            baiduHeatMapEnabled: false,
            markers: [{
                longitude: 113.981718,
                latitude: 22.542449,
                title: 'Window of the world',
            }, {
                longitude: 113.995516,
                latitude: 22.537642,
                title: '',
            }],
        };
    },
    render () {
        return (
            <View style={styles.container}>
                <MapView
                    trafficEnabled={this.state.trafficEnabled}
                    baiduHeatMapEnabled={this.state.baiduHeatMapEnabled}
                    zoom={this.state.zoom}
                    mapType={this.state.mapType}
                    center={this.state.center}
                    marker={this.state.marker}
                    markers={this.state.markers}
                    style={styles.map}
                    onMarkerClick={(e) => {
                        console.warn(JSON.stringify(e));
                    }}
                    onMapPoiClick={(e) => {
                        console.warn('onMapPoiClick', JSON.stringify(e));
                        this.setState({
                            zoom: 15,
                            marker: {
                                latitude: e.latitude,
                                longitude: e.longitude,
                                title: e.name,
                            },
                        });
                    }}
                    onMapClick={(data) => {
                        console.warn(JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}

                    />
                <View style={styles.row}>
                    <Button title='Normal' onPress={() => {
                        this.setState({
                            mapType: MapTypes.NORMAL,
                        });
                    }}
                        />
                    <Button style={styles.btn} title='Satellite' onPress={() => {
                        this.setState({
                            mapType: MapTypes.SATELLITE,
                        });
                    }}
                        />

                    <Button style={styles.btn} title='Locate' onPress={() => {
                        console.warn('center', this.state.center);
                        Geolocation.getCurrentPosition()
                            .then(data => {
                                console.warn(JSON.stringify(data));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: 'Your location',
                                    },
                                    center: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        rand: Math.random(),
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                        />
                </View>

                <View style={styles.row}>
                    <Button title='Zoom+' onPress={() => {
                        this.setState({
                            zoom: this.state.zoom + 1,
                        });
                    }}
                        />
                    <Button title='Zoom-' onPress={() => {
                        if (this.state.zoom > 0) {
                            this.setState({
                                zoom: this.state.zoom - 1,
                            });
                        }
                    }}
                        />
                </View>

                <View style={styles.row}>
                    <Button title='Traffic' onPress={() => {
                        this.setState({
                            trafficEnabled: !this.state.trafficEnabled,
                        });
                    }}
                        />

                    <Button title='Baidu HeatMap' onPress={() => {
                        this.setState({
                            baiduHeatMapEnabled: !this.state.baiduHeatMapEnabled,
                        });
                    }}
                        />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'flex-start',
        alignItems: 'center',
        backgroundColor: '#F5FCFF',
    },
    row: {
        flexDirection: 'row',
        height: 40,
    },
    map: {
        width: sr.w,
        height: sr.h / 2,
        marginBottom: 50,
        backgroundColor: 'red',
    },
    closeTouchableHighlight: {
        position:'absolute',
        top:0,
        left:sr.w * 6 / 7 + 3,
        width: 38,
        height: 38,
        marginTop: (sr.h - 200 - 20) / 2,
    },
    closeIcon: {
        width: 38,
        height: 38,
    },
});

```

* PDShop/project/App/modules/common/Bar.js

```js
'use strict';
var React = require('react');
var ReactNative = require('react-native');
var {
    Image,
    StyleSheet,
    Text,
    View,
} = ReactNative;

import Echarts from '@remobile/react-native-echarts';

module.exports = React.createClass({
    render () {
        const option = {
            xAxis: {
                data: ['5', '15', '25', '35', '45', '55'],
            },
            yAxis: {},
            series: [{
                name: '销量',
                type: 'bar',
                data: [5, 20, 36, 10, 10, 20],
            }],
        };
        return (
            <Echarts option={option} height={300} />
        );
    },
});

var styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: 'white',
    },
    chart: {
        width: sr.w,
        height: 100,
        marginBottom: 60,
    },
});

```

* PDShop/project/App/modules/common/CellPhoneBox.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    Linking,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    openPhone () {
        app.closeModal();
        Linking.canOpenURL('tel:' + this.props.phoneNum).then(supported => {
            if (!supported) {
                console.log('Can\'t handle url: ' + this.props.phoneNum);
            } else {
                return Linking.openURL('tel:' + this.props.phoneNum);
            }
        }).catch(err => console.error('An error occurred', err));
    },
    render () {
        return (
            <View style={styles.overlayContainer}>
                <TouchableOpacity
                    activeOpacity={1}
                    style={styles.container}>
                    <View style={styles.topView}>
                        <Text style={styles.titleText}>
                            {'拨打电话'}
                        </Text>
                    </View>
                    <TouchableOpacity
                        onPress={this.openPhone}
                        style={styles.btnView}>
                        <Text style={styles.phoneText}>
                            {this.props.phoneNum}
                        </Text>
                    </TouchableOpacity>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        height: 114,
        width: sr.w - 50,
        borderRadius: 4,
        backgroundColor: '#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    overlayContainer: {
        position:'absolute',
        top: 0,
        alignItems:'center',
        justifyContent: 'center',
        width:sr.w,
        height:sr.h,
    },
    titleText: {
        fontSize: 24,
        color: '#444444',
        backgroundColor: 'transparent',
    },
    topView: {
        height: 47,
        width: sr.w - 50,
        alignItems:'center',
        justifyContent:'center',
    },
    btnView: {
        height: 57,
        width: sr.w - 50,
        alignItems:'center',
        justifyContent:'center',
    },
    phoneText: {
        fontSize: 18,
        color: '#666666',
        backgroundColor: 'transparent',
    },
});

```

* PDShop/project/App/modules/common/Circle.js

```js
'use strict';
var React = require('react');
var ReactNative = require('react-native');
var {
    Image,
    StyleSheet,
    Text,
    View,
} = ReactNative;

import Echarts from '@remobile/react-native-echarts';

module.exports = React.createClass({
    render () {
        const option = {
            legend: {
                orient: 'vertical',
            //   bottom: '0',
                data:['今日数', '往日数', '剩余数'],
            },
            series: [{
                label: {
                    normal: {
                        show: false,
                        position: 'center',
                    },
                },
                name: '销量',
                type: 'pie',
                radius:[62, 88],
                data: [ { value:335, name:'今日数' },
                { value:310, name:'往日数' },
                { value:274, name:'剩余数' }],
            }],
        };
        return (
            <Echarts option={option} />
        );
    },
});

var styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: 'white',
    },
    chart: {
        width: sr.w,
        // height: 100,
        marginBottom: 60,
    },
});

```

* PDShop/project/App/modules/common/DigitalKeyboard.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
    },
    getInitialState () {
        return {
        };
    },
    render () {
        const { list } = this.props;
        return (
            <View style={styles.container}>
                {
                    list.map((item, i) => {
                        return (
                            <TouchableOpacity
                                onPress={this.props.passwordItem.bind(null, item)}
                                key={i} style={styles.itemLine}>
                                <Text style={styles.item}>{item}</Text>
                            </TouchableOpacity>
                        );
                    })
                }
                <TouchableOpacity onPress={this.props.confirm} style={styles.itemImage}>
                    <Text style={styles.item}>确认</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.zero} style={styles.itemLine}>
                    <Text style={styles.item} >0</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.delete} style={styles.itemImage}>
                    <Image style={styles.delete}
                        source={app.img.personal_delete} />
                </TouchableOpacity>
            </View>
        );
    },
});
const styles = StyleSheet.create({
    container:{
        width:sr.w,
        backgroundColor:'#f4f4f4',
        flexDirection:'row',
        flexWrap:'wrap', // 换行
    },
    item:{
        fontSize:18,
        fontWeight:'600',
    },
    itemLine:{
        width:sr.w / 3,
        height:44,
        borderLeftWidth:1,
        borderBottomWidth:1,
        borderColor:'#f1f1f1',
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        alignItems:'center',
    },
    itemGray:{
        height:45,
        width:sr.w / 3,
        backgroundColor:'#dddddd',
    },
    itemImage:{
        height:45,
        width:sr.w / 3,
        backgroundColor:'#dddddd',
        justifyContent:'center',
        alignItems:'center',
    },
    delete:{
        height:15,
        width:25,
    },
});

```

* PDShop/project/App/modules/common/ImageCrop.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    ImageStore,
    ImageEditor,
} = ReactNative;

const ImageCrop = require('@remobile/react-native-image-crop');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '编辑图片',
        rightButton: { title: '完成', handler: () => {
            app.scene.cropImage();
        } },
    },
    goBack () {
        app.pop();
    },
    cropImage () {
        const { image } = this.props;
        const cropData = this.imageCrop.getCropData();
        ImageEditor.cropImage(
            image.uri,
            cropData,
            (croppedImageURI) => {
                this.uploadImage(croppedImageURI);
            },
            (error) => {
                Toast('文件出错');
                this.goBack();
            }
        );
    },
    uploadImage (filePath) {
        if (app.isandroid) {
            const options = {};
            options.fileKey = 'file';
            options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
            options.mimeType = 'image/png';
            options.params = {
                userId:app.personal.info.userId,
            };
            UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
        } else {
            ImageStore.getBase64ForTag(filePath, (data) => {
                data = 'data:image/png;base64,' + data;
                const options = {};
                options.fileKey = 'file';
                options.fileName = 'image.png';
                options.mimeType = 'image/png';
                options.params = {
                    userId:app.personal.info.userId,
                };
                ImageStore.removeImageForTag(filePath);
                UPLOAD(data, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
            }, () => {
                Toast('文件出错');
                this.goBack();
            });
        }
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            this.props.onCropImage(data.context.url);
            this.goBack();
        } else {
            Toast('上传头像失败');
            this.goBack();
        }
    },
    uploadErrorCallback () {
        Toast('上传头像失败');
        this.goBack();
    },
    render () {
        const { image } = this.props;
        return (
            <View style={styles.container}>
                <ImageCrop
                    imageWidth={image.width}
                    imageHeight={image.height}
                    editRectRadius={0}
                    ref={(ref) => { this.imageCrop = ref; }}
                    source={{ uri: image.uri }} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
});

```

* PDShop/project/App/modules/common/ImagePicker.js

```js
const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
} = ReactNative;

const CameraRollPicker = require('@remobile/react-native-camera-roll-picker');
const Camera = require('@remobile/react-native-camera');
const ImageCrop = require('./ImageCrop');

module.exports = React.createClass({
    statics: {
        title: '选择头像',
    },
    cropImage (image) {
        app.navigator.replace({
            component: ImageCrop,
            passProps: {
                image,
                onCropImage: this.props.onCropImage,
            },
        });
    },
    onSelectedImages (images, image) {
        this.cropImage(image);
    },
    openCamera () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.cropImage({
                    uri,
                    width,
                    height,
                });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    render () {
        return (
            <CameraRollPicker selected={[]} onSelectedImages={this.onSelectedImages} openCamera={this.openCamera} maximum={1} />
        );
    },
});

```

* PDShop/project/App/modules/common/Line.js

```js
'use strict';
var React = require('react');
var ReactNative = require('react-native');
var {
    Image,
    StyleSheet,
    Text,
    ScrollView,
} = ReactNative;

import Echarts from '@remobile/react-native-echarts';

module.exports = React.createClass({

    render () {
        const { title, data, day } = this.props;
        const option = {
            grid:{ show:true },
            legend: {
                data:title,
            },
            toolbox: {
                show : true,
                orient : 'vertical',
                y : 130,
                x : 'right',
                feature : {
                    mark : { show: true },
                    magicType : {
                        show: true,
                        title : { line : '折线图', bar : '柱状图' },
                        type: ['line', 'bar'] },
                },
            },
            xAxis: {
                data: day,
            },
            yAxis : [
                {
                    type : 'value',
                },
            ],
            series: data,
        };
        return (
            <ScrollView style={styles.container}>
                <Echarts option={option} height={300} />
            </ScrollView>
        );
    },
});

var styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: 'white',
        marginBottom:50,
    },
});

```

* PDShop/project/App/modules/common/PayPassword.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { MessageBox } = COMPONENTS;

const DigitalKeyboard = require('./DigitalKeyboard');

const list = [1, 2, 3, 4, 5, 6, 7, 8, 9];

module.exports = React.createClass({
    statics: {
        title: '支付密码',

    },
    getInitialState () {
        return {
            password: '',
            type:false,
        };
    },
    passwordItem (number) {
        const { password } = this.state;
        this.setState({ password: password + number });
    },
    zero () {
        const { password } = this.state;
        this.setState({ password: password + 0 });
    },
    delete () {
        const { password } = this.state;
        this.setState({
            password: _.dropRight(password).join(''),
        });
    },
    confirm () {
        const { password, type } = this.state;
        const tmp = password.substring(0, 6);
        console.log('tmp', tmp);
        if (tmp.length == 6) {
            this.setState({
                type : !type,
            });
            this.toPay(tmp);
        } else {
            Toast('支付密码有误');
            this.toClear();
        }
    },
    toPay (tmp) {
        const { password } = this.state;
        let { param, routeName } = this.props;
        param['payPassword'] = tmp;
        POST(routeName, param, this.toPaySuccess, true);
    },
    toPaySuccess (data) {
        const { prompt, amount, doCloseActionSheet, money, alreadyPaid, refresh } = this.props;
        if (data.success) {
            app.showModal(
                <MessageBox
                    onConfirm={this.doConfirmDelete}
                    content={prompt}
                    width={sr.s(250)} />
            );
            !!doCloseActionSheet && doCloseActionSheet();
            !!amount && app.personal.setRemainAmount(parseInt(app.personal.remainAmount) + parseInt(amount));
            !!money && app.personal.setRemainAmount(parseInt(app.personal.remainAmount) - parseInt(money));
            !!alreadyPaid && alreadyPaid();
            !!refresh && refresh();
            app.navigator.popToTop();
            return;
        } else {
            Toast(data.msg);
            !!doCloseActionSheet && doCloseActionSheet();
            app.pop();
        }
    },
    toClear () {
        this.setState({
            password: '',
        });
    },
    render () {
        const max = [1, 2, 3, 4, 5, 6];
        const { password, type } = this.state;
        console.log('password', password);
        return (
            <View style={styles.container}>
                <Text style={styles.text}>请输入支付密码</Text>
                <View style={styles.password}>
                    {
                        max.map((item, i) => (
                            <View style={i == 0 ? styles.itemStart : styles.item} key={i}>
                                { password.length >= (i + 1) ?
                                    <View style={styles.point} />
                                    :
                                    <View style={styles.noPoint} />
                                }
                            </View>
                        ))
                    }
                </View>
                <View style={styles.digitalKeyboard} />
                {
                    !type && <View>
                        <DigitalKeyboard passwordItem={this.passwordItem}
                            list={list}
                            zero={this.zero}
                            delete={this.delete}
                            confirm={this.confirm} />
                    </View>
                }
            </View>
        );
    },
});
const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },

    text:{
        fontSize:14,
        textAlign:'center',
        color:'#333333',
        marginTop:30,
    },
    password:{
        height:40,
        width:330,
        backgroundColor:'#ffffff',
        flexDirection:'row',
        marginTop:15,
        marginLeft:(sr.w - 330) / 2,
        borderWidth:1,
        borderColor:'#EDEDED',
        borderRadius:4,
    },
    itemStart:{
        height:40,
        width:55,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    item:{
        height:40,
        width:55,
        borderLeftWidth:1,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    point:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#000000',
    },
    noPoint:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#FFFFFF',
    },
    digitalKeyboard:{
        flex:1,
    },
});

```

* PDShop/project/App/modules/common/Pie.js

```js
'use strict';
var React = require('react');
var ReactNative = require('react-native');
var {
    Image,
    StyleSheet,
    Text,
    View,
} = ReactNative;

import Echarts from '@remobile/react-native-echarts';

module.exports = React.createClass({
    render () {
        const option = {
            series: [{
                name: '销量',
                type: 'pie',
                data: [{ value:35, name:'男' },
                { value:310, name:'女' }],

            }],
        };
        return (
            <Echarts option={option} height={300} />
        );
    },
});

var styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: 'white',
    },
    chart: {
        width: sr.w,
        height: 100,
        marginBottom: 60,
    },
});

```

* PDShop/project/App/modules/common/ScanBarCode.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;
import BarcodeScanner from 'react-native-camera';
const { Button } = COMPONENTS;

module.exports = React.createClass({
    onBarCodeRead (code) {
        if (!this.hasReadCode) {
            app.closeModal();
            this.hasReadCode = true;
            this.props.onBarCodeRead(app.utils.getQRResult(code.data));
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <BarcodeScanner
                    onBarCodeRead={this.onBarCodeRead}
                    style={styles.camera}>
                    <View style={styles.rectangleContainer}>
                        <View style={styles.rectangleTop} />
                        <View style={styles.rectangleMiddle}>
                            <View style={styles.rectangleLeft} />
                            <View style={styles.rectangleMiddleMiddle}>
                                <View style={[styles.makeup, styles.makeupTL]} />
                                <View style={[styles.makeup, styles.makeupTR]} />
                                <View style={[styles.makeup, styles.makeupDL]} />
                                <View style={[styles.makeup, styles.makeupDR]} />
                            </View>
                            <View style={styles.rectangleRight} />
                        </View>
                        <View style={styles.rectangleBottom}>
                            <Text style={styles.info}>
                                将二维码放入框内，即可自动扫描
                            </Text>
                        </View>
                    </View>
                </BarcodeScanner>
                <Button
                    onPress={app.closeModal}
                    style={styles.contentButton}
                    textStyle={styles.contentButtonText}>
                        关闭</Button>
            </View>
        );
    },
});
const OVERLAY = 'rgba(0, 0, 0, 0.2)';
const BORDER = 2;
const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    camera: {
        flex: 1,
        width: sr.w,
    },
    rectangleContainer: {
        flex: 1,
    },
    rectangleTop: {
        flex: 1,
        backgroundColor: OVERLAY,
    },
    rectangleMiddle: {
        height: 250,
        flexDirection: 'row',
    },
    rectangleBottom: {
        flex: 1,
        backgroundColor: OVERLAY,
        alignItems: 'center',
    },
    rectangleLeft: {
        flex:1,
        backgroundColor: OVERLAY,
    },
    rectangleMiddleMiddle: {
        width:250,
    },
    rectangleRight: {
        flex:1,
        backgroundColor: OVERLAY,
    },
    makeup: {
        width: 16,
        height: 16,
        position: 'absolute',
        borderColor: '#00FF00',
    },
    makeupTL: {
        top: 0,
        left: 0,
        borderTopWidth: BORDER,
        borderLeftWidth: BORDER,
    },
    makeupTR: {
        top: 0,
        right: 0,
        borderTopWidth: BORDER,
        borderRightWidth: BORDER,
    },
    makeupDL: {
        bottom: 0,
        left: 0,
        borderBottomWidth: BORDER,
        borderLeftWidth: BORDER,
    },
    makeupDR: {
        bottom: 0,
        right: 0,
        borderBottomWidth: BORDER,
        borderRightWidth: BORDER,
    },
    info: {
        marginTop: 30,
        fontSize: 15,
        color: '#646566',
    },
    contentButton: {
        width:sr.w,
        height:50,
        borderRadius:0,
    },
    contentButtonText: {
        color: 'white',
        fontWeight: '800',
    },
});

```

* PDShop/project/App/modules/common/SelectClient.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入关键字搜索用户'
                    defaultValue={searchText}
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
        rightButton: { title: '搜索', handler: () => { app.scene.refresh(); } },
    },
    getInitialState () {
        return {
            keyword: '',
        };
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    onRowSelect (obj) {
        this.props.onSelect(obj);
        app.pop();
    },
    renderRow (obj, sectionID, rowID) {
        const { userId } = this.props;
        const { name, head, email, address, phone, reservePhone } = obj;
        return (
            <TouchableOpacity style={styles.row} onPress={this.onRowSelect.bind(null, obj)}>
                <View style={styles.leftContainer}>
                    <View style={styles.nameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={head ? { uri: head } : app.img.personal_default_head}
                            style={styles.head} />
                        <Text style={styles.name}>{name ? `${name} ( ${phone} )` : phone }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>邮箱：</Text>
                        <Text style={styles.name}>{ email || '无' }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>住址：</Text>
                        <Text style={styles.name}>{ address || '无' }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>预留电话：</Text>
                        <Text style={styles.name}>{ reservePhone ? reservePhone.join('; ') : '无' }</Text>
                    </View>
                </View>
                {
                    obj.userId === userId &&
                    <Image resizeMode='stretch' source={app.img.common_radio} style={styles.icon} />
                }
            </TouchableOpacity>
        );
    },
    render () {
        const { keyword } = this.state;
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, keyword }}
                    listName={'clientList'}
                    listUrl={app.route.ROUTE_GET_CLIENT_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    searchContainer: {
        height: 30,
        width: 250,
        paddingVertical: 2,
        borderRadius: 105,
        backgroundColor: '#E5E5E5',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        height: 25,
        width: 220,
        fontSize: 14,
        marginLeft: 5,
        overflow: 'hidden',
        alignItems:'center',
    },
    iconSearch: {
        height: 20,
        width: 20,
    },
    row: {
        paddingHorizontal: 8,
        paddingVertical: 10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    leftContainer: {
        flex: 1,
    },
    nameContainer: {
        marginTop: 10,
        flexDirection: 'row',
        paddingHorizontal: 10,
        alignItems: 'center',
    },
    head: {
        width: 30,
        height: 30,
        borderRadius: 15,
        marginRight: 5,
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    label: {
        fontSize: 14,
        color: '#8B8B7A',
        marginLeft: 34,
    },
    icon: {
        width: 20,
        height: 16,
    },
});

```

* PDShop/project/App/modules/common/SelectRoadmap.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入关键字搜索路线'
                    defaultValue={searchText}
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
        rightButton: { title: '搜索', handler: () => { app.scene.refresh(); } },
    },
    getInitialState () {
        return {
            keyword: '',
        };
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    onRowSelect (obj) {
        this.props.onSelect(obj);
        app.pop();
    },
    renderRow (obj, sectionID, rowID) {
        const { roadmapId } = this.props;
        const { name, type, shipperName, shipperLogo, startPoint, endPoint, transitPoint, price, duration } = obj;
        return (
            <TouchableOpacity style={styles.row} onPress={this.onRowSelect.bind(null, obj)}>
                <View style={styles.leftContainer}>
                    <View style={styles.shipperNameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={{ uri: shipperLogo }}
                            style={styles.shipperLogo} />
                        <Text numberOfLines={1} style={styles.shipperName}>{shipperName}</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text numberOfLines={1} style={styles.name}>{name}</Text>
                        <Text numberOfLines={1} style={[styles.type, { color: type === 0 ? '#228B22' : '#FF4500' }]}>{type === 0 ? '整车' : '零担'}</Text>
                    </View>
                    <View style={styles.pointContainer}>
                        <Text style={styles.name}>{startPoint.name}</Text>
                        {!!transitPoint[0] && <Text style={styles.name}>→</Text>}
                        {!!transitPoint[0] && <Text style={styles.name}>{transitPoint[0].name}</Text>}
                        <Text style={styles.name}>→</Text>
                        <Text style={styles.name}>{endPoint.name}</Text>
                    </View>
                    <View style={styles.priceContainer}>
                        <Text style={styles.name}><Text style={{ color: '#DAA520' }}>{price}</Text>元/{type === 0 ? '车' : '吨'}</Text>
                        <Text style={styles.name}>历时<Text style={{ color: '#FF4500' }}>{duration}</Text>小时</Text>
                    </View>
                </View>
                {
                    obj.id === roadmapId &&
                    <Image resizeMode='stretch' source={app.img.common_radio} style={styles.icon} />
                }
            </TouchableOpacity>
        );
    },
    render () {
        const { keyword } = this.state;
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, keyword }}
                    listName={'roadmapList'}
                    listUrl={app.route.ROUTE_GET_ROADMAP_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    searchContainer: {
        height: 30,
        width: 250,
        paddingVertical: 2,
        borderRadius: 105,
        backgroundColor: '#E5E5E5',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        height: 25,
        width: 220,
        fontSize: 14,
        marginLeft: 5,
        overflow: 'hidden',
        alignItems:'center',
    },
    iconSearch: {
        height: 20,
        width: 20,
    },
    row: {
        paddingHorizontal: 8,
        paddingVertical: 10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    leftContainer: {
        flex: 1,
    },
    shipperNameContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    shipperContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        marginTop: 20,
        marginLeft: 10,
    },
    shipperLogo: {
        width: 20,
        height: 20,
        borderRadius: 10,
        marginRight: 5,
    },
    shipperName: {
        fontSize: 14,
        color: 'gray',
    },
    nameContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
        alignItems: 'center',
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    type: {
        fontSize: 14,
    },
    pointContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
    },
    priceContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
    },
    icon: {
        width: 20,
        height: 16,
    },
});

```

* PDShop/project/App/modules/common/ShowBigImage.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
} = ReactNative;

import Swiper from 'react-native-swiper';

module.exports = React.createClass({
    getInitialState () {
        const list = [];
        const list1 = [];
        this.props.defaultImageArray.map((item, i) => {
            if (i >= this.props.defaultIndex) {
                list1.push(item);
            } else {
                list.push(item);
            }
        });
        return {
            imageList: list1.concat(list),
        };
    },
    render () {
        return (
            <View style={styles.overlayContainer}>
                <Swiper
                    paginationStyle={styles.paginationStyle}
                    height={sr.th}>
                    {
                           this.state.imageList.map((item, i) => {
                               return (
                                   <TouchableOpacity
                                       key={i}
                                       activeOpacity={1}
                                       onPress={app.closeModal}
                                       style={styles.imageContainer}>
                                       <Image
                                           resizeMode='contain'
                                           defaultSource={app.img.common_default}
                                           source={{ uri: item }}
                                           style={styles.bannerImage}
                                           />
                                   </TouchableOpacity>
                               );
                           })
                       }
                </Swiper>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    overlayContainer: {
        flex: 1,
        alignItems:'center',
        justifyContent: 'center',
    },
    paginationStyle: {
        bottom: 30,
    },
    imageContainer: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    bannerImage: {
        alignSelf: 'center',
        width: sr.w,
        flex: 1,
    },
});

```

* PDShop/project/App/modules/movingDepartment/MessageDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '搬运消息',
    },

    render () {
        const { data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.messageContainer}>
                    <Text style={styles.messageText}>搬运消息</Text>
                    <View style={styles.itemTop}>
                        <Text style={styles.itemLeft}>发起人：</Text>
                        <Text style={styles.itemRight}>{data.plateNo}</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>时间：</Text>
                        <Text style={styles.itemRight}>{data.createTime}</Text>
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
    messageContainer:{
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
    },
    messageText:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
        marginBottom:5,
        marginTop:7,
    },
    itemTop:{
        flexDirection:'row',
        marginTop:5,
    },
    item:{
        flexDirection:'row',
        marginTop:3,
        marginBottom:5,
    },
    itemLeft:{
        fontSize:12,
        color:'#888888',
        marginLeft:10,
    },
    itemRight:{
        fontSize:12,
        color:'#333333',
    },
    itemBottom:{
        flexDirection:'row',
        marginTop:2,
        marginBottom:5,
    },
});

```

* PDShop/project/App/modules/movingDepartment/MovingDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

const { PageList } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '货单',
    },

    renderRow (obj, rowID) {
        const { stateList } = obj;
        return (
            <View style={styles.row}>
                <View style={styles.rowTopContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.order_logo}
                        style={styles.topImage} />
                    <Text style={styles.topLeftText}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                    <Text style={styles.topRightText}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.rowMiddleContainer} >
                    <Image
                        resizeMode='stretch'
                        source={{ uri: obj.photo }}
                        defaultSource={app.img.common_default}
                        style={styles.middleImage} />
                    <View style={styles.middleRight}>
                        <View style={styles.pointContainer}>
                            <View style={styles.placeContainer}>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                <Text style={styles.pointName}>→</Text>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.endPoint}</Text>
                            </View>
                        </View>
                        <Text style={styles.commonInfo}>重量：{obj.weight}吨</Text>
                        <Text style={styles.commonInfo}>方量：{obj.size}m³</Text>
                        <Text style={styles.commonInfo}>件数：{obj.totalNumbers}件</Text>
                        <Text style={styles.commonInfo}>收货地址：{obj.endPoint}</Text>
                    </View>
                </View>
                <View style={styles.line} />
            </View>
        );
    },
    render () {
        const { truckId } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.separator} />
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, truckId }}
                    listName={'orderList'}
                    renderSeparator={null}
                    listUrl={app.route.ROUTE_GET_ORDER_LIST_IN_RUCKS}
                    refreshEnable />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    rowTopContainer: {
        paddingHorizontal:10,
        paddingVertical:5,
        backgroundColor:'white',
        flexDirection: 'row',
    },
    topImage: {
        width: 17,
        height:17,
    },
    topLeftText: {
        marginLeft:10,
        flex:1,
        fontSize: 14,
    },
    topRightText: {
        flex:1,
        fontSize: 14,
        textAlign:'right',
        color:'#f51b1a',
    },
    rowMiddleContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:11,
        backgroundColor:'#f8f8f8',
    },
    middleImage: {
        width: 80,
        height:80,
        marginLeft: 10,
    },
    middleRight: {
        paddingLeft: 10,
        width:sr.w - 100,
    },
    money: {
        fontSize: 14,
        color:'#f51b1a',
    },
    commonInfo: {
        fontSize: 13,
        color:'#888888',
    },
    pointName: {
        fontSize: 14,
        maxWidth: 70,
    },
    transformFee: {
        flex:1,
        fontSize: 14,
        color: 'gray',
        textAlign:'right',
    },
    pointContainer: {
        flexDirection: 'row',
    },
    placeContainer: {
        flex:1,
        flexDirection: 'row',
    },
    rowButtomContainer: {
        backgroundColor:'white',
        flexDirection: 'row',
        justifyContent: 'flex-end',
        paddingVertical:5,
    },
    ConfirmReach: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#ff6200',
        borderWidth:1,
        backgroundColor:'white',
    },
    lookDetail: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#007ef7',
        borderWidth:1,
        marginLeft:20,
        marginRight:10,
        backgroundColor:'white',
    },
    btnConfirmReachText:{
        color:'#ff6200',
        fontSize:12,
        fontWeight:'300',
    },
    btnDetallText:{
        color:'#007ef7',
        fontSize:12,
        fontWeight:'300',
    },
    line:{
        height:8,
        backgroundColor:'#FFFFFF',
    },
});

```

* PDShop/project/App/modules/movingDepartment/MovingHistory.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ListView,
    Image,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '历史消息',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list: [],
        };
    },
    renderRow (obj) {
        return (
            <View style={styles.row}>
                <View style={styles.item}>
                    <Image source={app.img.moving_message} style={styles.message} />
                    <View style={styles.itemRight}>
                        <View style={styles.msg}>
                            <Text style={styles.itemRightTop}>搬运消息</Text>
                        </View>
                        <View style={styles.msgGray}>
                            <Text style={styles.itemRightBottom}
                                numberOfLines={1}>您收到来自{obj.plateNo}的一条消息，请点击查看。</Text>
                        </View>
                    </View>
                </View>
                <View style={styles.msg}>
                    <Text style={styles.itemDate}>{obj.createTime}</Text>
                </View>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container} />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
});

```

* PDShop/project/App/modules/movingDepartment/MovingMessage.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ScrollView,
    RefreshControl,
    Image,
    TouchableOpacity,
} = ReactNative;

const MessageDetail = require('./MessageDetail');

module.exports = React.createClass({
    statics: {
        title: '消息',
        // rightButton: { title: '历史', handler: () => {app.scene.toHistory();} },
    },
    onWillFocus () {
        app.getCurrentRoute().title = '消息';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    // toHistory(){
    //     app.push({
    //         component:MovingHistory,
    //     });
    // },
    getInitialState () {
        return {
            data: {},
            nodata: false,
        };
    },
    componentWillMount () {
        this.getWaitScanTruckInfo();
    },
    getWaitScanTruckInfo () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_WAIT_SCAN_TRUCK_INFO, param, this.getWaitScanTruckInfoSuccess, false);
    },
    getWaitScanTruckInfoSuccess (data) {
        if (data.success) {
            this.setState({
                nodata: false,
                data: data.context,
            });
        } else {
            this.setState({ nodata: true });
        }
    },
    messageDetail () {
        const { data } = this.state;
        app.push({
            component: MessageDetail,
            passProps:{
                data: data,
            },
        });
    },
    onScroll () {
        this.getWaitScanTruckInfo();
    },
    render () {
        const { data, nodata } = this.state;
        return (
            <ScrollView
                refreshControl={
                    <RefreshControl
                        refreshing={false}
                        onRefresh={this.onScroll}
                        title='正在刷新...' />
                }
                style={styles.container}>
                {
                    nodata ?
                        <View>
                            <Image source={app.img.moving_no_message} style={styles.onMessage} />
                            <Text style={styles.onMessageText}>暂无消息</Text>
                        </View>
                    :
                        <TouchableOpacity onPress={this.messageDetail}>
                            <View style={styles.row}>
                                <View style={styles.item}>
                                    <Image source={app.img.moving_message} style={styles.message} />
                                    <View style={styles.itemRight}>
                                        <View style={styles.msg}>
                                            <Text style={styles.itemRightTop}>搬运消息</Text>
                                        </View>
                                        <View style={styles.msgGray}>
                                            <Text style={styles.itemRightBottom}
                                                numberOfLines={1}>您收到来自{data.plateNo}的一条消息，请点击查看。</Text>
                                        </View>
                                    </View>
                                </View>
                                <View style={styles.msg}>
                                    <Text style={styles.itemDate}>{data.createTime}</Text>
                                </View>
                            </View>
                        </TouchableOpacity>
                }
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
    onMessage:{
        height:120,
        width:126,
        marginLeft:(sr.w - 126) / 2,
        marginTop:65,
    },
    onMessageText:{
        fontSize:17,
        color:'#888888',
        marginTop:15,
        textAlign:'center',
    },
    row:{
        height:90,
        marginTop:1,
        backgroundColor:'#FFFFFF',
    },
    item:{
        height:60,
        flexDirection:'row',
    },
    msg:{
        justifyContent:'center',
        height:30,
    },
    msgGray:{
        justifyContent:'center',
        height:30,
        backgroundColor:'#f8f8f8',
    },
    message:{
        height:40,
        width:40,
        margin:10,
    },
    itemRight:{
        height:60,
        width:294,
        marginLeft:5,
    },
    itemRightTop:{
        padding:0,
        fontSize:15,
        textAlign:'justify',
    },
    itemRightBottom:{
        fontSize:12,
        padding:0,
        color:'#888888',
        paddingLeft:10,
        textAlign:'justify',
    },
    itemDate:{
        marginLeft:65,
        padding:0,
        color:'#888888',
        textAlign:'justify',
    },
    line:{
        height:10,
    },
});

```

* PDShop/project/App/modules/movingDepartment/MovingOrder.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ListView,
    RefreshControl,
    TouchableOpacity,
} = ReactNative;

const MovingDetail = require('./MovingDetail');

module.exports = React.createClass({
    statics: {
        title: '搬运',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '搬运';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    getInitialState () {
        return {
            ds: new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 }),
            list: [],
        };
    },
    componentWillMount () {
        this.getCarryList();
    },
    getCarryList () {
        const param = {
            userId: app.personal.info.userId,
            pageNo: 0,
            pageSize: 10,
        };
        POST(app.route.ROUTE_GET_CARRY_LIST, param, this.getCarryListSuccess, true);
    },
    getCarryListSuccess (data) {
        if (data.success) {
            this.setState({
                list: data.context.truckList,
            });
        } else {

        }
    },
    toMovingDetail (obj) {
        app.push({
            component:MovingDetail,
            passProps:{
                truckId: obj.id,
            },
        });
    },
    onScroll () {
        this.getCarryList();
    },
    renderRow (obj) {
        return (
            <TouchableOpacity onPress={this.toMovingDetail.bind(null, obj)}>
                <View style={styles.row}>
                    <View style={styles.itemTop}>
                        <Text style={styles.itemTopLeft}>{obj.plateNo}</Text>
                        <Text style={styles.itemTopRight}>¥{app.utils.N(obj.carryPrice * obj.totalWeight)}元</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>单数：</Text>
                        <Text style={styles.itemRight}>{obj.orderCount}单</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>重量：</Text>
                        <Text style={styles.itemRight}>{app.utils.N(obj.totalWeight)}吨</Text>
                    </View>
                    <View style={styles.itemBottom}>
                        <Text style={styles.itemLeft}>时间：</Text>
                        <Text style={styles.itemRight}>{obj.createTime}</Text>
                    </View>
                </View>
            </TouchableOpacity>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView dataSource={this.state.ds.cloneWithRows(this.state.list)}
                    enableEmptySections
                    renderRow={this.renderRow}
                    refreshControl={
                        <RefreshControl
                            refreshing={false}
                            onRefresh={this.onScroll}
                            title='正在刷新...' />
                   } />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop:9,
    },
    row:{
        backgroundColor:'#FFFFFF',
        marginTop:1,
    },
    messageText:{
        fontSize:14,
        color:'#333333',
        margin:10,
    },
    itemTop:{
        flexDirection:'row',
        justifyContent:'space-between',
        marginTop:6,
        marginLeft:10,
        marginBottom:2,
    },
    itemTopLeft:{
        fontSize:14,
        color:'#333333',
    },
    itemTopRight:{
        fontSize:14,
        color:'red',
        marginRight:10,
    },
    item:{
        flexDirection:'row',
        marginTop:3,
    },
    itemLeft:{
        fontSize:12,
        color:'#888888',
        marginLeft:10,
    },
    itemRight:{
        fontSize:12,
        color:'#333333',
    },
    itemBottom:{
        flexDirection:'row',
        marginTop:3,
        marginBottom:5,
    },
});

```

* PDShop/project/App/modules/movingDepartment/index.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

const MovingMessage = require('./MovingMessage');
const MovingOrder = require('./MovingOrder');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: MovingMessage },
    { index: 1, component: MovingOrder },
    { index: 3, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '消息', icon:app.img.moving_message_unselect, selected: app.img.moving_message_select },
            { index: 1, title: '搬运', icon: app.img.moving_moving_unselect, selected: app.img.moving_moving_select },
            { index: 3, title: '我的', icon: app.img.moving_person_unselect, selected: app.img.moving_person_select },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDShop/project/App/modules/person/About.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '关于软件',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_ABOUT_PAGE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDShop/project/App/modules/person/BalanceDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '详情',
    },
    render () {
        const obj = this.props.obj;
        return (
            <View style={styles.container}>
                <View style={[styles.item, { paddingTop:2 }]}>
                    <Text style={styles.itemLeft}> 平台 </Text>
                    <Text style={styles.itemRight}> {obj.thirdpartyAccount == null ? '内部支付' : obj.thirdpartyAccount} </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 类型 </Text>
                    <Text style={styles.itemRight}> {obj.remark} </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 金额 </Text>
                    <Text style={obj.tradeAmountYuan > 0 ? styles.itemMoneyGreen : styles.itemMoneyRed}>
                        {obj.tradeAmountYuan}
                    </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 时间 </Text>
                    <Text style={styles.itemRight}> {obj.tradeTime} </Text>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    item:{
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
    },
    itemLeft:{
        fontSize:14,
        color:'#333333',
        paddingLeft:8,
    },
    itemRight:{
        fontSize:14,
        color:'#333333',
        paddingRight:10,
    },
    itemMoneyRed:{
        fontSize:14,
        color:'#C81622',
        paddingRight:10,
    },
    itemMoneyGreen:{
        fontSize:14,
        color:'#2F971C',
        paddingRight:10,
    },
});

```

* PDShop/project/App/modules/person/BalanceDetailList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;
const BalanceDetail = require('./BalanceDetail');

module.exports = React.createClass({
    statics: {
        title: '余额明细',
    },
    renderRow (obj) {
        return (
            <TouchableOpacity onPress={this.toAccountDetails.bind(null, obj)}>
                <View style={styles.recharge}>
                    <View>
                        <Text style={styles.rechargeText} numberOfLine={1}>
                            {obj.remark}
                        </Text>
                        <Text style={styles.rechargeDate}>
                            {obj.tradeTime}
                        </Text>
                    </View>
                    <Text style={obj.tradeAmountYuan > 0 ? styles.rechargeMoney : styles.expenditureMoney}>
                        {obj.tradeAmountYuan}
                    </Text>
                </View>
            </TouchableOpacity>
        );
    },
    toAccountDetails (obj) {
        app.push({
            component:BalanceDetail,
            passProps: {
                obj:obj,
            },
        });
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId }}
                    listName={'billList'}
                    listUrl={app.route.ROUTE_GET_BILL_LIST}
                    refreshEnable />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    recharge:{
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    rechargeText:{
        paddingTop:5,
        paddingLeft:8,
        color:'#333333',
        fontSize:14,
        height:22,
        width:sr.w * 4 / 5,
    },
    rechargeDate:{
        color:'#aaaaaa',
        paddingVertical:5,
        paddingLeft:8,
        height:28,
    },
    rechargeMoney:{
        color:'#2F971C',
        fontSize:14,
        paddingRight:10,
        flex:1,
        textAlign:'right',
    },
    expenditureMoney:{
        color:'#C81622',
        fontSize:14,
        paddingRight:10,
        flex:1,
        textAlign:'right',
    },
});

```

* PDShop/project/App/modules/person/BindBankcard.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
} = ReactNative;

const { Button } = COMPONENTS;
module.exports = React.createClass({
    statics: {
        title: '绑定银行卡',
    },
    doBind () {

    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{'账号'}</Text>
                        <TextInput style={styles.itemNameLeftText}
                            underlineColorAndroid='transparent'
                            placeholderTextColor='#aaaaaa'
                            placeholder='请填入银行卡号'
                            onChangeText={this.onContentTextChange}
                            />
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{'姓名'}</Text>
                        <TextInput style={styles.itemNameLeftText}
                            underlineColorAndroid='transparent'
                            placeholderTextColor='#aaaaaa'
                            placeholder='请填入姓名'
                            onChangeText={this.onContentTextChange}
                            />
                    </View>
                    <View style={styles.lineView} />
                </View>
                <Button onPress={this.doBind} style={styles.btnBind} textStyle={styles.btnBindText} >
                    绑定
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 10,
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        flexDirection: 'row',
    },
    icon_add:{
        flex:1,
        width:20,
        height:30,
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    itemNameLeftText: {
        flex:1,
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
        padding:0,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    btnBind:{
        marginTop:50,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
        backgroundColor:'#c81622',
    },
    btnBindText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDShop/project/App/modules/person/BindBankcardList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    ListView,
} = ReactNative;

const { MessageBox } = COMPONENTS;
const BindBankcard = require('./BindBankcard');

module.exports = React.createClass({
    statics: {
        title: '银行卡',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list: [1, 2, 1, 1, 1, 1, 11, 1],
        };
    },
    doAddBankcard () {
        app.push({
            component: BindBankcard,
        });
    },
    unBindBankcard (rowID) {
        app.showModal(
            <MessageBox
                onConfirm={this.doUnBindBankcard.bind(rowID)}
                content={'是否确认解绑该银行卡'}
                onCancel title={false}
                width={sr.s(250)} />
        );
    },
    doUnBindBankcard (rowID) {
        const { list } = this.state;
        list.splice(rowID, 1);
    },
    renderRow (obj, sectionID, rowID) {
        return (
            <View>
                <View style={styles.line} />
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <View >
                            <Text style={styles.itemNameText}>{'农业银行'}</Text>
                            <Text style={styles.itemNumberText}>{'**0851' + '储蓄卡'}</Text>
                        </View>
                        <TouchableOpacity
                            activeOpacity={0.6}
                            onPress={() => this.unBindBankcard(rowID)}>
                            <Text style={styles.itemNameRightText}>{'解绑'}</Text>
                        </TouchableOpacity>
                    </View>
                </View>
            </View>
        );
    },
    renderFooter (obj, sectionID, rowID) {
        return (
            <TouchableOpacity
                activeOpacity={0.6}
                onPress={this.doAddBankcard}
                style={styles.touch_add}>
                <Image
                    resizeMode='stretch'
                    source={app.img.personal_add}
                    style={styles.icon_add} />
                <Text style={styles.itemAddText}>{'添加银行卡'}</Text>
            </TouchableOpacity>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    style={styles.ListView}
                    dataSource={this.ds.cloneWithRows(this.state.list)}
                    renderRow={this.renderRow}
                    renderFooter={this.renderFooter}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBg: {
        height: 42,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    line:{
        height:1,
        width:sr.w,
        backgroundColor:'#f4f4f4',
    },
    ListView:{
        marginTop:7,
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    touch_add:{
        alignItems:'center',
        marginTop:29,
    },
    icon_add:{
        width:30,
        height:30,
    },
    itemAddText: {
        fontSize: 14,
        color: '#888888',
        marginTop:10,
    },
    itemNameText: {
        fontSize: 14,
        color: '#333333',
        marginLeft: 8,
        marginBottom:2,
    },
    itemNumberText:{
        fontSize: 12,
        color: '#888888',
        marginLeft: 8,
        marginTop:2,
    },
    itemNameRightText: {
        textAlign:'right',
        fontSize: 13,
        color: '#3fa0ff',
        marginRight:10,
        marginTop:10,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
});

```

* PDShop/project/App/modules/person/CashBalance.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const WithdrawCash = require('./WithdrawCash');
const Recharge = require('./Recharge');
const BalanceDetailList = require('./BalanceDetailList');

module.exports = React.createClass({
    statics: {
        title: '余额',
        rightButton: { title: '明细', handler: () => { app.scene.detail(); } },
    },
    detail () {
        app.push({
            component:BalanceDetailList,
        });
    },
    getInitialState () {
        return {
            type:'1',
            remainAmount:app.personal.remainAmount,
        };
    },
    componentWillMount () {
        this.getRemainAmount();
    },
    getRemainAmount () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_REMAIN_AMOUNT, param, this.getRemainAmountSuccess, true);
    },
    getRemainAmountSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.setRemainAmount(context.amount);
            this.setState({ remainAmount:app.personal.remainAmount });
        }
    },
    showWithdrawCash () {
        app.push({
            component: WithdrawCash,
        });
    },
    showRecharge () {
        app.push({
            component: Recharge,
            passProps:{
                setRemainAmount:this.setRemainAmount,
            },
        });
    },
    setRemainAmount (amount) {
        this.setState({
            remainAmount : amount,
        });
    },
    render () {
        const { remainAmount } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.TopView}>
                    <Text style={styles.CashBalanceTitle}>账户余额</Text>
                    <View style={styles.CashBalance}>
                        <Text style={styles.CashBalanceTitleLeft}>￥</Text><Text style={styles.CashBalanceContent}>{remainAmount}</Text>
                    </View>
                </View>
                {
                    (_.intersection(app.personal.info.authority, [AH.AH_WITHDRAW]).length != 0) &&
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={this.showWithdrawCash}
                        style={styles.ItemBg}>
                        <View style={styles.infoStyle}>
                            <Text style={styles.itemNameText}>{'提现'}</Text>
                        </View>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_go}
                            style={styles.icon_go} />
                        <View style={styles.lineView} />
                    </TouchableOpacity>
                }
                {
                    (_.intersection(app.personal.info.authority, [AH.AH_RECHARGE]).length != 0) &&
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={this.showRecharge}
                        style={styles.ItemBg}>
                        <View style={styles.infoStyle}>
                            <Text style={styles.itemNameText}>{'充值'}</Text>
                        </View>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_go}
                            style={styles.icon_go} />
                        <View style={styles.lineView} />
                    </TouchableOpacity>
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    TopView: {
        height:100,
        backgroundColor:'#c81622',
        marginBottom:8,
        paddingLeft:20,
        paddingTop:15,
        paddingBottom:20,
    },
    CashBalanceTitle:{
        fontSize:14,
        color:'white',
    },
    CashBalance: {
        flexDirection: 'row',
        marginTop:22,
        alignItems:'center',
    },
    CashBalanceTitleLeft:{
        fontSize:14,
        color:'white',
        alignSelf:'flex-end',
        paddingBottom:5,
    },
    CashBalanceContent:{
        fontSize:24,
        color:'white',
        alignSelf:'flex-end',
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
});

```

* PDShop/project/App/modules/person/CommonSetting.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Switch,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '基础设置',
    },
    getInitialState () {
        return {
            onlyWifiUpload: !!app.setting.data.onlyWifiUpload,
        };
    },
    onValueChange (value) {
        this.setState({ onlyWifiUpload: value });
        app.setting.setOnlyWifiUpload(value);
    },
    selectThemeColor (color) {
        app.setting.setThemeColor(color);
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.row}>
                    <Text style={styles.title}>只在wifi下上传</Text>
                    <Switch
                        style={styles.switch}
                        onValueChange={this.onValueChange}
                        value={this.state.onlyWifiUpload} />
                </View>
                <View style={styles.row}>
                    <Text style={styles.title}>主题颜色</Text>
                    <View style={styles.colorContainer}>
                        {
                            CONSTANTS.THEME_COLORS.map((color, i) => {
                                return (
                                    <TouchableOpacity
                                        key={i}
                                        onPress={this.selectThemeColor.bind(null, color)}
                                        style={[styles.color, { backgroundColor: color }]}
                                        />
                                );
                            })
                        }
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 20,
    },
    row: {
        paddingHorizontal: 14,
        height: 80,
        flexDirection: 'row',
        backgroundColor: '#FFFFFF',
        alignItems: 'center',
    },
    title: {
        flex: 7,
        fontSize: 17,
        color: 'gray',
        marginLeft: 2,
    },
    switch: {
        flex: 2,
    },
    colorContainer: {
        flex: 20,
        flexDirection: 'row',
        justifyContent: 'space-around',
    },
    color: {
        flex: 1,
        height:80,
        marginRight: 10,
    },
});

```

* PDShop/project/App/modules/person/ConfirmPayPassword.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
   StyleSheet,
   View,
   Text,
} = ReactNative;

const DigitalKeyboard = require('../common/DigitalKeyboard');

const list = [1, 2, 3, 4, 5, 6, 7, 8, 9];

module.exports = React.createClass({
    statics: {
        title: '确认支付密码',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        this.props.toClear();
        app.pop();
    },
    getInitialState () {
        return {
            password: '',
            type:false,
        };
    },
    passwordItem (item) {
        const { password } = this.state;
        this.setState({ password: password + item });
    },
    zero () {
        const { password } = this.state;
        this.setState({ password: password + 0 });
    },
    delete () {
        const { password } = this.state;
        this.setState({
            password: _.dropRight(password).join(''),
        });
    },
    confirm () {
        const { password, type } = this.state;
        const tmp = password.substring(0, 6);
        if (tmp.length == 6) {
            this.setState({
                type : !type,
            });
            this.toNext(tmp);
        } else {
            Toast('支付密码有误');
            this.toClear();
        }
    },
    toNext (password) {
        const { number, verifyCode } = this.props;
        if (number == password) {
            const param = {
                userId:app.personal.info.userId,
                verifyCode,
                phone:app.personal.info.phone,
                password,
            };
            POST(app.route.ROUTE_SET_PAYMENT_PASSWORD, param, this.modifySuccess, true);
        } else {
            Toast('两次输入密码不一致，请重试');
            this.goBack();
        }
    },
    modifySuccess (data) {
        if (data.success) {
            const info = app.personal.info;
            info.isSetPaymentPassword = 1;
            app.personal.set(info);
            Toast('修改成功');
            app.pop(3);
        } else {
            Toast(data.msg);
            app.pop(2);
        }
    },
    render () {
        const max = [1, 2, 3, 4, 5, 6];
        const { password, type } = this.state;
        return (
            <View style={styles.container}>
                <Text style={styles.text}>再次输入密码以作确认</Text>
                <View style={styles.password}>
                    {
                       max.map((item, i) => (
                           <View style={i == 0 ? styles.itemStart : styles.item} key={i}>
                               { password.length >= (i + 1) ?
                                   <View style={styles.point} />
                                   :
                                   <View style={styles.noPoint} />
                               }
                           </View>
                       ))
                   }
                </View>
                <View style={styles.digitalKeyboard} />
                {
                   !type && <View>
                       <DigitalKeyboard list={list}
                           passwordItem={this.passwordItem}
                           zero={this.zero}
                           delete={this.delete}
                           confirm={this.confirm} />
                   </View>
               }
            </View>
        );
    },
});
const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },

    text:{
        fontSize:14,
        textAlign:'center',
        color:'#333333',
        marginTop:30,
    },
    password:{
        height:40,
        width:330,
        backgroundColor:'#ffffff',
        flexDirection:'row',
        marginTop:15,
        marginLeft:(sr.w - 330) / 2,
        borderRightWidth:1,
        borderBottomWidth:1,
        borderTopWidth:1,
        borderColor:'#EDEDED',
        borderRadius:4,
    },
    itemStart:{
        height:40,
        width:55,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    item:{
        height:40,
        width:55,
        borderLeftWidth:1,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    point:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#000000',
    },
    noPoint:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#FFFFFF',
    },
    digitalKeyboard:{
        flex:1,
    },
});

```

* PDShop/project/App/modules/person/EditPersonInfo.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
    Text,
    StyleSheet,
    View,
    TouchableOpacity,
} = ReactNative;

const { DImage, Button, Picker } = COMPONENTS;

const ImagePicker = require('./ImagePicker');
const EditSingleInfo = require('./EditSingleInfo');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '个人信息',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        this.props.updateInfo(app.personal.info);
        Picker.hide();
        app.pop();
    },
    getInitialState () {
        const info = app.personal.info;
        return {
            name: info.name,
            address: info.address,
            head: info.head,
            sex: info.sex === 0 ? '男' : '女',
            phone:info.phone,
            pickerData: ['男', '女'],
        };
    },
    toEditHead () {
        app.push({
            component: ImagePicker,
            passProps: {
                onCropImage: this.setUserHead,
            },
        });
    },
    setUserHead (uri) {
        this.setState({ head: uri });
    },
    toEditSingleInfo (name, tip, maxLength) {
        Picker.hide();
        app.push({
            title: '修改' + tip,
            component: EditSingleInfo,
            passProps: {
                keyName:name,
                placeholder:tip,
                maxLength,
                updateSingleState:this.updateSingleState,
            },
        });
    },
    updateSingleState (keyName, value) {
        let state = this.state;
        state[keyName] = value;
        this.setState({ state });
    },
    toEditSex () {
        const { sex, pickerData } = this.state;
        Picker(pickerData, [sex], '选择性别').then((value) => {
            const sex = value[0];
            this.setState({ sex }, () => {
                this.modifyPersonalInfo();
            });
        });
    },
    modifyPersonalInfo () {
        const { sex } = this.state;
        const param = {
            userId: app.personal.info.id,
            sex: sex == '男' ? 0 : 1,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            app.personal.set(data.context);
        } else {
            Toast(data.msg);
        }
    },
    doLogout () {
        app.navigator.resetTo({
            component: require('../login/Login'),
        }, 0);
        app.personal.setNeedLogin(true);
    },
    render () {
        const { name, address, sex, head, phone } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.headStyle} >
                    <TouchableOpacity
                        onPress={this.toEditHead}
                        style={styles.head_itemView}>
                        <DImage
                            defaultSource={app.img.personal_default_head}
                            source={{ uri: head }}
                            style={styles.headImgStyle} />
                        <View style={styles.rightView} >
                            <Image
                                source={app.img.common_go}
                                style={styles.goStyle} />
                        </View>
                    </TouchableOpacity>
                </View>
                <TouchableOpacity
                    onPress={this.toEditSingleInfo.bind(null, 'name', '昵称', CONSTANTS.NAME_MAX_LENGTH)}
                    style={styles.itemView} >
                    <Text style={styles.itemKeyText}>昵称</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{name}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity
                    onPress={this.toEditSex}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>性别</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{sex}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity
                    onPress={this.toEditSingleInfo.bind(null, 'address', '地址', CONSTANTS.ADDRESS_MAX_LENGTH)}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>地址</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText} numberOfLines={1}>{address}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <View
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>手机号码</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{phone}</Text>
                    </View>
                </View>
                {
                    !app.personal.info.shipper &&
                    <Text />
                    ||
                    <TouchableOpacity
                        style={styles.itemView}>
                        <Text style={styles.itemKeyText}>所属物流公司</Text>
                        <View style={styles.rightView} >
                            <Text style={styles.itemValueText}>{app.personal.info.shipper.name}</Text>
                        </View>
                    </TouchableOpacity>
                }
                {
                    !app.personal.info.shipper &&
                    <Text />
                    ||
                    <TouchableOpacity
                        style={styles.itemView}>
                        <Text style={styles.itemKeyText}>职务</Text>
                        <View style={styles.rightView} >
                            <Text style={styles.itemValueText}>{app.personal.info.post}</Text>
                        </View>
                    </TouchableOpacity>
                }

                <Button onPress={this.doLogout} style={styles.btnLogout} textStyle={styles.btnLogoutText} >
                    退出登录
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#F4F4F4',
        alignItems:'center',
    },
    headStyle: {
        width: sr.w,
        height:60,
        marginTop: 10,
    },
    head_itemView:{
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 60,
        marginBottom: 8,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    itemView: {
        marginTop:1,
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 42,
        width:sr.w,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    rightView: {
        flexDirection: 'row',
        height: 45,
        alignItems:'center',
    },
    headImgStyle: {
        height: 36,
        width: 36,
        borderRadius: 18,
        marginLeft: 20,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 20,
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
    itemValueText: {
        color: '#888888',
        fontSize: 14,
        marginRight: 10,
    },
    btnChangeRole:{
        position:'absolute',
        top:sr.h - 210,
        marginTop:15,
        height:45,
        width:sr.w - 25,
        borderRadius:2,
    },
    btnLogout:{
        position:'absolute',
        top:sr.h - 250,
        height:45,
        width:sr.w - 25,
        borderRadius:2,
        backgroundColor:'#D9D9D9',
    },
    btnLogoutText:{
        color:'#000000',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDShop/project/App/modules/person/EditSex.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Text,
    StyleSheet,
    View,
    TouchableOpacity,
} = ReactNative;

const { Picker } = COMPONENTS;

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    getInitialState () {
        const info = app.personal.info;
        return {
            sex: info.sex === 0 ? '男' : '女',
            pickerData: ['男', '女'],
        };
    },
    goBack () {
        Picker.hide();
        app.pop();
    },
    toEditSex () {
        const { sex, pickerData } = this.state;
        Picker(pickerData, [sex], '选择性别').then((value) => {
            const sex = value[0];
            this.setState({ sex }, () => {
                this.modifyPersonalInfo();
            });
        });
    },
    modifyPersonalInfo () {
        const info = app.personal.info;
        const param = {
            userId: info.userId,
            sex: this.state.sex === '男' ? 0 : 1,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            const info = app.personal.info;
            info.sex = this.state.sex === '男' ? 0 : 1;
            app.personal.set(info);
            this.props.setSex(info.sex);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { sex } = this.state;
        return (
            <View style={styles.container}>
                <View style={[styles.separatorView, { marginTop: 30 }]} />
                <TouchableOpacity
                    onPress={this.toEditSex}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>{sex || '请选择您的性别'}</Text>
                </TouchableOpacity>
                <View style={styles.separatorView} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#EEEEEE',
    },
    itemView: {
        backgroundColor: 'white',
        height: 45,
        justifyContent: 'center',
        alignItems:'center',
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
});

```

* PDShop/project/App/modules/person/EditSingleInfo.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Text,
    StyleSheet,
    View,
    TextInput,
} = ReactNative;

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        rightButton: { title: '保存', handler: () => { app.scene.doSave(); } },
    },
    doSave () {
        const { placeholder } = this.props;
        const info = app.personal.info;
        const { value } = this.state;
        if (!!app.utils.checkStr && !app.utils.checkStr(value)) {
            Toast('请填写正确的' + placeholder);
            return;
        }
        if (value.length == 0) {
            Toast(placeholder + '不能为空');
            return;
        }
        let param = {
            userId: info.userId,
        };
        param[this.keyName] = value;
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    getInitialState () {
        const info = app.personal.info;
        this.keyName = this.props.keyName;
        return {
            value: info[this.keyName] || '',
        };
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            const info = app.personal.info;
            info[this.keyName] = this.state.value;
            app.personal.set(info);
            this.props.updateSingleState(this.keyName, info[this.keyName]);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { value } = this.state;
        const { placeholder, maxLength } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.itemView}>
                    <Text style={styles.itemKeyText} />
                    <TextInput
                        ref={(ref) => { this.contentInput = ref; }}
                        style={styles.rightView}
                        onChangeText={(text) => this.setState({ value: text })}
                        multiline={false}
                        maxLength={maxLength}
                        placeholder={'请输入你的' + placeholder}
                        autoCapitalize={'none'}
                        underlineColorAndroid={'transparent'}
                        defaultValue={value}
                        />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#F4F4F4',
    },
    itemView: {
        marginTop:10,
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 42,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    rightView: {
        flex: 1,
        fontSize: 15,
        paddingVertical: 2,
        color: '#444444',
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
});

```

* PDShop/project/App/modules/person/Feedback.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Text,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '意见反馈',
    },
    getInitialState () {
        return {
            content:'',
            length:0,
        };
    },
    onContentTextChange (text) {
        this.setState({
            content:text,
            length:text.length,
        });
    },
    doSubmit () {
        if (!this.state.content) {
            Toast('请填写您需要反馈的内容');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            content: this.state.content,
        };
        POST(app.route.ROUTE_SUBMIT_FEEDBACK, param, this.doSubmitSuccess);
    },
    doSubmitSuccess (data) {
        if (data.success) {
            Toast('提交成功');
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const length = this.state.length;
        return (
            <View style={styles.container}>
                <Text style={styles.content_text}>
                    具体内容
                </Text>
                <TextInput style={styles.content_input}
                    placeholderTextColor='#aaaaaa'
                    placeholder='请填入意见内容'
                    onChangeText={this.onContentTextChange}
                    multiline
                    underlineColorAndroid='transparent'
                    maxLength={CONSTANTS.FEEDBACK_MAX_LENGTH}
                    />
                <Text style={styles.wordnumber_text}>
                    {length}/500
                </Text>
                <Button onPress={this.doSubmit}
                    style={styles.button}
                    textStyle={styles.btnLoginText}>
                    提交反馈
                    </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    content_text:{
        fontSize:14,
        height:40,
        width:351,
        color:'#666666',
        marginLeft:(sr.w - 351) / 2,
        paddingTop:18,
    },
    content_input:{
        fontSize:14,
        height:200,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor:'#FFFFFF',
        padding:3,
        textAlignVertical: 'top',
    },
    wordnumber_text:{
        fontSize:14,
        height:30,
        width:351,
        color:'#666666',
        marginLeft:(sr.w - 351) / 2,
        paddingTop:5,
        textAlign:'right',
    },
    button:{
        height:50,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor:'#f69934',
        borderRadius:4,
        marginTop:60,
    },
    btnLoginText:{
        fontSize:18,
        color:'#FFFFFF',
        fontWeight:'600',
    },
});

```

* PDShop/project/App/modules/person/Help.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '软件许可协议',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri:app.route.ROUTE_SOFTWARE_LICENSE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDShop/project/App/modules/person/ImageCrop.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    ImageStore,
    ImageEditor,
} = ReactNative;

const ImageCrop = require('@remobile/react-native-image-crop');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '编辑头像',
        rightButton: { title: '完成', handler: () => {
            app.scene.cropImage();
        } },
    },
    goBack () {
        app.pop();
    },
    cropImage () {
        const { image } = this.props;
        const cropData = this.imageCrop.getCropData();
        ImageEditor.cropImage(
            image.uri,
            cropData,
            (croppedImageURI) => {
                this.uploadUserHead(croppedImageURI);
            },
            (error) => {
                Toast('文件出错');
                this.goBack();
            }
        );
    },
    uploadUserHead (filePath) {
        if (app.isandroid) {
            const options = {};
            options.fileKey = 'file';
            options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
            options.mimeType = 'image/png';
            options.params = {
                userId:app.personal.info.userId,
            };
            UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
        } else {
            ImageStore.getBase64ForTag(filePath, (data) => {
                data = 'data:image/png;base64,' + data;
                const options = {};
                options.fileKey = 'file';
                options.fileName = 'user_head.png';
                options.mimeType = 'image/png';
                options.params = {
                    userId:app.personal.info.userId,
                };
                ImageStore.removeImageForTag(filePath);
                UPLOAD(data, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
            }, () => {
                Toast('文件出错');
                this.goBack();
            });
        }
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            this.modifyPersonalInfo(data.context.url);
        } else {
            Toast('上传头像失败');
            this.goBack();
        }
    },
    uploadErrorCallback () {
        Toast('上传头像失败');
        this.goBack();
    },
    modifyPersonalInfo (url) {
        const info = app.personal.info;
        const param = {
            userId: info.userId,
            head: url,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess.bind(null, url), this.modifyUserInfoError, true);
    },
    modifyUserInfoSuccess (url, data) {
        if (data.success) {
            const info = app.personal.info;
            info.head = url;
            app.personal.set(info);
            this.props.onCropImage(url);
            this.goBack();
        } else {
            Toast(data.msg);
            this.goBack();
        }
    },
    modifyUserInfoError () {
        Toast('修改头像失败');
        this.goBack();
    },
    render () {
        const { image } = this.props;
        return (
            <View style={styles.container}>
                <ImageCrop
                    imageWidth={image.width}
                    imageHeight={image.height}
                    editRectRadius={0}
                    ref={(ref) => { this.imageCrop = ref; }}
                    source={{ uri: image.uri }} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
});

```

* PDShop/project/App/modules/person/ImagePicker.js

```js
const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
} = ReactNative;

const CameraRollPicker = require('@remobile/react-native-camera-roll-picker');
const Camera = require('@remobile/react-native-camera');
const ImageCrop = require('./ImageCrop');

module.exports = React.createClass({
    statics: {
        title: '选择头像',
    },
    cropImage (image) {
        app.navigator.replace({
            component: ImageCrop,
            passProps: {
                image,
                onCropImage: this.props.onCropImage,
            },
        });
    },
    onSelectedImages (images, image) {
        this.cropImage(image);
    },
    openCamera () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.cropImage({
                    uri,
                    width,
                    height,
                });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    render () {
        return (
            <CameraRollPicker selected={[]} onSelectedImages={this.onSelectedImages} openCamera={this.openCamera} maximum={1} />
        );
    },
});

```

* PDShop/project/App/modules/person/ModifyPassword.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
} = ReactNative;

const { Button, Label } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '修改密码',
    },
    getInitialState () {
        return {
            oldPassword: '',
            newPassword1: '',
            newPassword2: '',
        };
    },
    goBack () {
        app.pop();
    },
    doSubmit () {
        const { oldPassword, newPassword1, newPassword2 } = this.state;
        const { checkPassword } = app.utils;
        if (!checkPassword(oldPassword) || !checkPassword(newPassword1)) {
            Toast('密码必须有6-20位的数字，字母，下划线组成');
            return;
        }
        if (!oldPassword) {
            Toast('请填写旧密码');
            return;
        }
        if (!newPassword1) {
            Toast('请填写新密码');
            return;
        }
        if (!newPassword2) {
            Toast('请再次填写新密码');
            return;
        }
        if (newPassword2 !== newPassword1) {
            Toast('两次填写新密码不一致');
            return;
        }
        if (oldPassword === newPassword1) {
            Toast('新密码不能和原来密码一样');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            oldPassword,
            newPassword: newPassword1,
        };
        POST(app.route.ROUTE_MODIFY_PASSWORD, param, this.doSubmitSuccess, true);
    },
    doSubmitSuccess (data) {
        if (data.success) {
            Toast('修改成功');
            this.goBack();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <Label img={app.img.login_user}>请输入旧密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请输入旧密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ oldPassword: text })}
                    />
                <Label img={app.img.login_user}>请输入新密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请输入新密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ newPassword1: text })}
                    />
                <Label img={app.img.login_user}>请再次输入新密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请再次输入新密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ newPassword2: text })}
                    />
                <Button onPress={this.doSubmit} style={[styles.btnSubmit, { backgroundColor:app.setting.THEME_COLOR }]}>提交</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: 'white',
        paddingVertical: 20,
        paddingHorizontal: 25,
    },
    text_input: {
        height: 40,
        fontSize: 14,
        paddingLeft: 10,
        backgroundColor: 'white',
        textAlignVertical: 'top',
        borderWidth: 1,
        borderRadius: 5,
        marginBottom: 20,
        borderColor: '#DBDBDB',
    },
    btnSubmit: {
        width: sr.w - 50,
        marginTop: 80,
        height: 40,
        borderRadius: 10,
    },
});

```

* PDShop/project/App/modules/person/MovingTeamInfo.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    ScrollView,
    TouchableOpacity,
} = ReactNative;
const MovingTeamSlogan = require('./MovingTeamSlogan');

module.exports = React.createClass({
    statics: {
        title: '搬运队信息',
        rightButton: { title: '确定', handler: () => { app.scene.doConfirm(); } },
        leftButton: { handler: () => { app.scene.doBack(); } },
    },
    doBack () {
        this.props.refresh();
        app.pop();
    },
    doConfirm () {
        const { phone1, phone2, phone3, slogan, price } = this.state;
        let list = (
            (phone1 == '' ? '' : phone1 + ';') +
            (phone2 == '' ? '' : phone2 + ';') +
            (phone3 == '' ? '' : phone3 + ';')
        );
        if (price ? price.length == 0 : true) {
            Toast('搬运价格不能为空');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            descript: slogan,
            phoneList: list,
            price: (price || 0),
        };
        POST(app.route.ROUTE_MODIFY_OWN_PARTMENT, param, this.modifyOwnPartmentSuccess, true);
    },
    modifyOwnPartmentSuccess (data) {
        if (data.success) {
            Toast('修改成功');
        } else {
            Toast('修改失败');
        }
    },
    getInitialState () {
        const { data } = this.props;
        let length = data.phoneList.split(';').length;
        return {
            chargeMan: data.chargeMan,
            phone1: (length >= 1 ? data.phoneList.split(';')[0] : ''),
            phone2: (length >= 2 ? data.phoneList.split(';')[1] : ''),
            phone3: (length >= 3 ? data.phoneList.split(';')[2] : ''),
            price: data.price,
            slogan: this.props.slogan,
        };
    },
    toModifySlogan () {
        const { slogan } = this.state;
        app.push({
            component:MovingTeamSlogan,
            passProps:{
                setSlogan:this.modifySlogan,
                slogan,
            },
        });
    },
    modifySlogan (newSlogan) {
        this.setState({
            slogan: newSlogan,
        });
    },
    render () {
        const { slogan, chargeMan, phone1, phone2, phone3, price } = this.state;
        const { data } = this.props;
        return (
            <ScrollView style={styles.container}>
                <View style={styles.TeamInfo}>
                    <View style={styles.rowGray}>
                        <Text style={styles.titleInfo}>负责人</Text>
                        <Text style={styles.info}>{chargeMan.name}</Text>
                    </View>
                    <View style={styles.rowGray}>
                        <Text style={styles.titleInfo}>负责人电话</Text>
                        <Text style={styles.slogan}>{chargeMan.phone}</Text>
                    </View>
                    <View style={styles.rowGray}>
                        <Text style={styles.titleInfo}>搬运队名字</Text>
                        <Text style={styles.info}>{data.name}</Text>
                    </View>
                    <View style={styles.rowGray}>
                        <Text style={styles.titleInfo}>人数</Text>
                        <Text style={styles.info}>{data.memberCount}</Text>
                    </View>
                    <View style={styles.rowLine} />
                    <View style={styles.row}>
                        <Text style={styles.titleInfo}>价格 / 吨</Text>
                        <TextInput
                            underlineColorAndroid='transparent'
                            style={styles.info}
                            keyboardType='numeric'
                            maxLength={5}
                            placeholderTextColor='#888888'
                            onChangeText={(text) => this.setState({ price: text })}
                            placeholder='请输入搬运队价格'
                            defaultValue={price + ''} />
                    </View>
                    <TouchableOpacity onPress={this.toModifySlogan}>
                        <View style={styles.row}>
                            <Text style={styles.titleInfo}>口号</Text>
                            <Text style={styles.slogan}>{slogan}</Text>
                            <Image source={app.img.common_go} style={styles.imgGo} resizeMode='contain' />
                        </View>
                    </TouchableOpacity>
                    <View style={styles.rowLine} />
                    <View style={styles.row} >
                        <Text style={styles.titleInfo}>联系电话</Text>
                        <TextInput
                            underlineColorAndroid='transparent'
                            style={styles.info}
                            onChangeText={(text) => this.setState({ phone1: text })}
                            maxLength={11}
                            keyboardType='phone-pad'
                            placeholderTextColor='#888888'
                            placeholder='请输入电话号码'
                            defaultValue={phone1} />
                    </View>
                    <View style={styles.row} >
                        <Text style={styles.titleInfo}>联系电话</Text>
                        <TextInput
                            underlineColorAndroid='transparent'
                            style={styles.info}
                            onChangeText={(text) => this.setState({ phone2: text })}
                            maxLength={11}
                            keyboardType='phone-pad'
                            placeholderTextColor='#888888'
                            placeholder='请输入电话号码'
                            defaultValue={phone2} />
                    </View>
                    <View style={styles.row} >
                        <Text style={styles.titleInfo}>联系电话</Text>
                        <TextInput
                            underlineColorAndroid='transparent'
                            style={styles.info}
                            onChangeText={(text) => this.setState({ phone3: text })}
                            maxLength={11}
                            keyboardType='phone-pad'
                            placeholderTextColor='#888888'
                            placeholder='请输入电话号码'
                            defaultValue={phone3} />
                    </View>
                </View>
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    TeamInfo:{
        marginTop:10,
    },
    row:{
        flexDirection:'row',
        height:42,
        alignItems:'center',
        backgroundColor:'#FFFFFF',
        marginTop:1,
    },
    rowGray:{
        flexDirection:'row',
        height:42,
        alignItems:'center',
        backgroundColor:'#fafafa',
        marginTop:1,
    },
    rowLine:{
        marginTop:5,
    },
    info:{
        flex:1,
        fontSize:12,
        color:'#333333',
        textAlign:'right',
        marginRight:10,
    },
    titleInfo:{
        fontSize:14,
        flex:1,
        marginLeft:10,
    },
    slogan:{
        flex:1,
        fontSize:14,
        fontWeight:'300',
        textAlign:'right',
        paddingRight:10,
    },
    imgGo:{
        width:15,
        height:15,
        marginRight:10,
        marginLeft:5,
    },
});

```

* PDShop/project/App/modules/person/MovingTeamSlogan.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '搬运队口号',
        rightButton: { title: '保存', handler: () => { app.scene.doSave(); } },
    },
    getInitialState () {
        return {
            content: this.props.slogan,
        };
    },
    doSave () {
        const { content } = this.state;

        this.props.setSlogan(content);
        app.pop();
    },
    onContentTextChange (text) {
        this.setState({
            content:text,
        });
    },
    render () {
        const { content } = this.state;
        return (
            <View style={styles.container}>
                <TextInput style={styles.item}
                    maxLength={20}
                    placeholder='请为您的搬运队起一个响亮的口号'
                    placeholderTextColor='#dddddd'
                    onChangeText={this.onContentTextChange}
                    underlineColorAndroid='transparent'
                    defaultValue={content}
                    multiline />
                <Text style={styles.wordnumber_text}>
                    {content ? content.length : '0'}/20
                </Text>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    item:{
        margin:10,
        paddingLeft:10,
        height:75,
        backgroundColor:'#FFFFFF',
        fontSize:14,
        textAlignVertical: 'top',
    },
    wordnumber_text:{
        fontSize:14,
        height:30,
        width:351,
        color:'#666666',
        marginLeft:(sr.w - 351) / 2,
        paddingTop:5,
        textAlign:'right',
    },
});

```

* PDShop/project/App/modules/person/MyRemovalTeam.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;
const { Button, CustomSheet } = COMPONENTS;
const TransportQuotation = require('./TransportQuotation');
const MovingTeamInfo = require('./MovingTeamInfo');
const StatusSelection = require('./StatusSelection');

module.exports = React.createClass({
    statics: {
        title: '搬运队',
        rightButton: { title: '搬运行情', handler: () => { app.scene.showtransportQuotation(); } },
    },
    getInitialState () {
        return {
            actionSheetVisible: false,
            sign:'',
            data : [],
        };
    },
    componentWillMount () {
        this.getOwnPartmentInfo();
    },
    getOwnPartmentInfo () {
        const param = { userId: app.personal.info.userId };
        POST(app.route.ROUTE_GET_OWN_PARTMENT_INFO, param, this.getOwnPartmentInfoSuccess, false);
    },
    getOwnPartmentInfoSuccess (data) {
        if (data.success) {
            this.setState({
                data: data.context,
                sign: data.context.enable,
            });
        }
    },
    showtransportQuotation () {
        app.push({
            component:TransportQuotation,
        });
    },
    refresh () {
        this.getOwnPartmentInfo();
    },
    modifyMovingTeamInfo () {
        const { data } = this.state;
        app.push({
            component:MovingTeamInfo,
            passProps:{
                data,
                refresh: this.refresh,
                slogan: data.descript,
            },
        });
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        this.setState({ actionSheetVisible:true });
    },
    setStatus (status) {
        const param = {
            userId: app.personal.info.userId,
            enable: status,
        };
        POST(app.route.ROUTE_MODIFY_OWN_PARTMENT, param, this.modifyOwnPartmentSuccess.bind(null, status), true);
    },
    modifyOwnPartmentSuccess (status, data) {
        if (data.success) {
            this.setState({ sign: status });
            Toast('修改成功');
        } else {
            Toast('修改失败');
        }
    },
    render () {
        const { data, sign } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.row}>
                    <View style={styles.nameContainer}>
                        <Text style={styles.name}>{data.name}</Text>
                        <Text style={styles.status}>{sign ? '营业' : '暂停营业'}</Text>
                    </View>
                    <Text style={styles.infoTop}>人数:{data.memberCount}人</Text>
                    <Text style={styles.info}>电话:{data.phoneList}</Text>
                    <View style={styles.priceRow}>
                        <Text style={styles.info}>价格:</Text>
                        <Text style={styles.price}>¥{data.price ? data.price : '0'}/{'吨'}</Text>
                    </View>
                </View>
                <View style={styles.btnRow}>
                    <Button onPress={this.modifyMovingTeamInfo} style={styles.btnModifyInfo} textStyle={styles.modifyInfoFont}>修改信息</Button>
                    <Button onPress={this.doShowActionSheet} style={styles.btnModifyStatus} textStyle={styles.modifyStatusFont}>修改状态</Button>
                </View>
                <CustomSheet
                    visible={this.state.actionSheetVisible} >
                    <StatusSelection doClose={this.doCloseActionSheet} setStatus={this.setStatus} />
                </CustomSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    row:{
        backgroundColor:'#FFFFFF',
        marginTop:8,
        paddingLeft:10,
        justifyContent:'center',
    },
    nameContainer:{
        flexDirection:'row',
        justifyContent:'space-between',
        marginTop:5,
    },
    name:{
        fontSize:14,
        color:'#333333',
        marginBottom:3,
    },
    status:{
        color:'#f01825',
        marginRight:10,
    },
    infoTop:{
        fontSize:12,
        color:'#888888',
        marginTop:4,
    },
    info:{
        marginTop:4,
        fontSize:12,
        color:'#888888',
    },
    priceRow:{
        flexDirection:'row',
        width:90,
        marginBottom:5,
    },
    price:{
        flex:1,
        fontSize:12,
        marginTop:4,
        marginLeft:5,
        color:'#e7222d',
        fontWeight:'500',
    },
    btn:{
        width:75,
        height:22,
        backgroundColor:'#FFFFFF',
        borderRadius:4,
        borderWidth:0.5,
        borderColor:'#ee1822',
        position:'absolute',
        right:15,
        bottom:10,
    },
    btnFont:{
        color:'#ee1822',
        fontSize:12,
    },
    btnRow:{
        flexDirection:'row',
        marginTop:1,
        backgroundColor:'#FFFFFF',
        height:30,
    },
    btnModifyInfo:{
        alignSelf:'center',
        height:20,
        width:65,
        borderWidth:0.5,
        borderRadius:4,
        borderColor:'#FE9917',
        backgroundColor:'#FFFFFF',
        marginLeft:sr.w - 160,
    },
    modifyInfoFont:{
        fontSize:12,
        color:'#FE9917',
    },
    btnModifyStatus:{
        alignSelf:'center',
        height:20,
        width:65,
        borderWidth:0.5,
        borderRadius:4,
        borderColor:'#c61a29',
        backgroundColor:'#FFFFFF',
        marginLeft:15,
    },
    modifyStatusFont:{
        fontSize:12,
        color:'#c61a29',
    },
});

```

* PDShop/project/App/modules/person/NormalQuestions.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '常见问题',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_ABOUT_PAGE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDShop/project/App/modules/person/ParameterSetting.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '参数设置',
        rightButton: { title: '保存', handler: () => { app.scene.doSave(); } },
    },
    doSave () {
        const {
            sizeWeightRate,
            insuanceRate,
            insuanceMountRate,
            insuanceBaseValue,
            proxyChargeProfitRate,
            gradientPriceList,
            additionalDeliverTime,
            noticeShipperStorageWeight,
            bondAmountWeightRate,
            rankedMaskFirstRankWeight,
            rankedMaskRateList,
        } = this.state;
        try {
            var TMP = JSON.stringify(rankedMaskRateList).replace(/,/g, ', ').replace(/"/g, '');
            var ARR = JSON.parse(TMP);
            if (!_.isArray(ARR) || !ARR.length) {
                Toast('您输入的排名梯度格式不正确');
                return;
            } else {
                if (!_.every(ARR, o => _.isNumber(o))) {
                    Toast('您输入的排名梯度格式不正确');
                    return;
                }
            }
        } catch (e) {
            Toast('您输入的排名梯度格式不正确');
            return;
        }
        try {
            var tmp = JSON.stringify(gradientPriceList).replace(/，/g, ', ').replace(/"/g, '').replace(/(\w+):/g, '"$1":');
            var arr = JSON.parse(tmp);
            if (!_.isArray(arr) || !arr.length) {
                Toast('您输入的价格梯度格式不正确');
                return;
            } else {
                if (!_.every(arr, o => _.isObject(o) && _.isNumber(o.min) && _.isNumber(o.rate) && _.keys(o).length === 2)) {
                    Toast('您输入的价格梯度格式不正确');
                    return;
                }
            }
        } catch (e) {
            Toast('您输入的价格梯度格式不正确');
            return;
        }
        const param = {
            sizeWeightRate: sizeWeightRate * 1,
            insuanceRate: insuanceRate * 1,
            insuanceMountRate: insuanceMountRate * 1,
            insuanceBaseValue: insuanceBaseValue * 1,
            proxyChargeProfitRate: proxyChargeProfitRate * 1,
            gradientPriceList: arr,
            additionalDeliverTime: additionalDeliverTime * 1,
            noticeShipperStorageWeight: noticeShipperStorageWeight * 1,
            bondAmountWeightRate: bondAmountWeightRate * 1,
            rankedMaskFirstRankWeight: rankedMaskFirstRankWeight * 1,
            rankedMaskRateList: ARR,
        };
        POST(app.route.ROUTE_MODIFY_SETTING_INFO, param, this.getModifySettingInfoSuccess, false);
    },
    getModifySettingInfoSuccess (data) {
        if (data.success) {
            Toast('保存成功');
        } else {
            Toast(data.msg);
        }
    },
    getInitialState () {
        return {
            sizeWeightRate: '',
            insuanceRate: '',
            insuanceMountRate: '',
            insuanceBaseValue: '',
            proxyChargeProfitRate: '',
            gradientPriceList: '',
            additionalDeliverTime: '',
            noticeShipperStorageWeight: '',
            bondAmountWeightRate: '',
            rankedMaskFirstRankWeight: '',
            rankedMaskRateList: '',
        };
    },
    render () {
        // const {
        //     sizeWeightRate,
        //     insuanceRate,
        //     insuanceMountRate,
        //     insuanceBaseValue,
        //     proxyChargeProfitRate,
        //     gradientPriceList,
        //     additionalDeliverTime,
        //     noticeShipperStorageWeight,
        //     bondAmountWeightRate,
        //     rankedMaskFirstRankWeight,
        //     rankedMaskRateList,
        // } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.row}>
                    <Text style={styles.rowText}>保险费与保价的比</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写比例'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ insuanceRate: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>保价与运费的比</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写比例'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ insuanceMountRate: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>保险的保底值</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写最低保险金额'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ insuanceBaseValue: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>方量与重量的比</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写比例'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ sizeWeightRate: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>代收货款的手续费比例</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写比例'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ proxyChargeProfitRate: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>代签额外增加时间/小时</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写时间'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ additionalDeliverTime: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>通知物流公司的重量/吨</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写重量'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ noticeShipperStorageWeight: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>每吨货需要的保证金</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写金额'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ bondAmountWeightRate: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>屏蔽排名的基数/吨</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写重量'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ rankedMaskFirstRankWeight: text })}
                        maxLength={10}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>屏蔽物流公司排名的梯度</Text>
                    <TextInput placeholderTextColor='#aaaaaa'
                        placeholder='请填写梯度,例:[1,2,3]'
                        keyboardType='numeric'
                        onChangeText={(text) => this.setState({ rankedMaskRateList: text })}
                        maxLength={30}
                        underlineColorAndroid='transparent'
                        style={styles.rowTextInput}
                        />
                </View>
                <View style={styles.row}>
                    <Text style={styles.rowText}>阶梯价格的梯度</Text>
                </View>
                <View style={styles.rowBottom}>
                    <TextInput style={styles.content_input}
                        placeholderTextColor='#aaaaaa'
                        keyboardType='email-address'
                        maxLength={200}
                        placeholder='例:[{min:0,rate:3},{min:0.1,rate:2},{min:0.3,rate:1.5},...]'
                        onChangeText={(text) => this.setState({ gradientPriceList: text })}
                        multiline
                        underlineColorAndroid='transparent'
                        />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
        paddingTop:9,
    },
    row:{
        marginTop:1,
        height:42,
        backgroundColor:'#FFFFFF',
        flexDirection:'row',
        justifyContent:'space-between',
        alignItems:'center',
    },
    rowText:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
    },
    rowTextInput:{
        fontSize:12,
        textAlign:'right',
        marginRight:10,
        padding:0,
        width:sr.w / 2,
    },
    rowBottom:{
        height:100,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        marginTop:1,
    },
    rowTextInputBottom:{
        marginLeft:10,
        fontSize:14,
        textAlignVertical: 'top',
        padding:3,
    },
    content_input:{
        fontSize:14,
        height:100,
        backgroundColor:'#FFFFFF',
        textAlignVertical: 'top',
        marginLeft:10,
        marginRight:10,
    },
});

```

* PDShop/project/App/modules/person/PayPasswordSetting.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const DigitalKeyboard = require('../common/DigitalKeyboard');
const ConfirmPayPassword = require('./ConfirmPayPassword');

const list = [1, 2, 3, 4, 5, 6, 7, 8, 9];

module.exports = React.createClass({
    statics: {
        title: '支付密码设置',

    },
    getInitialState () {
        return {
            password: '',
            type:false,
        };
    },
    passwordItem (item) {
        const { password } = this.state;
        this.setState({ password: password + item });
    },
    zero () {
        const { password } = this.state;
        this.setState({ password: password + 0 });
    },
    delete () {
        const { password } = this.state;
        this.setState({
            password: _.dropRight(password).join(''),
        });
    },
    confirm () {
        const { password, type } = this.state;
        const tmp = password.substring(0, 6);
        if (tmp.length == 6) {
            this.setState({
                type : !type,
            });
            this.toNext(tmp);
        } else {
            Toast('支付密码有误');
            this.toClear();
        }
    },
    toNext (tmp) {
        app.push({
            component: ConfirmPayPassword,
            passProps:{
                number: tmp,
                toClear: this.toClear,
                verifyCode : this.props.verifyCode,
            },
        });
    },
    toClear () {
        this.setState({
            password: '',
        });
    },
    render () {
        const max = [1, 2, 3, 4, 5, 6];
        const { password, type } = this.state;
        return (
            <View style={styles.container}>
                <Text style={styles.text}>该六位号码将作为手机支付密码</Text>
                <View style={styles.password}>
                    {
                        max.map((item, i) => (
                            <View style={i == 0 ? styles.itemStart : styles.item} key={i}>
                                {
                                    password.length >= (i + 1) ?
                                    <View style={styles.point} />
                                    :
                                    <View style={styles.noPoint} />
                                }
                            </View>
                        ))
                    }
                </View>
                <View style={styles.digitalKeyboard} />
                <View>
                    <DigitalKeyboard list={list}
                        passwordItem={this.passwordItem}
                        zero={this.zero}
                        delete={this.delete}
                        confirm={this.confirm} />
                </View>
            </View>
        );
    },
});
const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },

    text:{
        fontSize:14,
        textAlign:'center',
        color:'#333333',
        marginTop:30,
    },
    password:{
        height:40,
        width:330,
        backgroundColor:'#ffffff',
        flexDirection:'row',
        marginTop:15,
        marginLeft:(sr.w - 330) / 2,
        borderWidth:1,
        borderColor:'#EDEDED',
        borderRadius:4,
    },
    itemStart:{
        height:40,
        width:55,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    item:{
        height:40,
        width:55,
        borderLeftWidth:1,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    point:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#000000',
    },
    noPoint:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#FFFFFF',
    },
    digitalKeyboard:{
        flex:1,
    },
});

```

* PDShop/project/App/modules/person/Permission.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    Text,
    ListView,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

module.exports = React.createClass({
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {};
    },
    doSelect (obj) {
        this.props.setSelect(obj);
    },
    renderRow (obj, sectionID, rowID) {
        const { employeeAuthority } = this.props;
        return (
            <View style={styles.item}>
                <TouchableOpacity onPress={this.doSelect.bind(null, obj)}
                    style={styles.press}>
                    <Image source={_.find(employeeAuthority, o => { return o == obj.o; }) != undefined ?
                            app.img.order_choose_r : app.img.order_no_choose_r}
                        style={styles.imgChoose} />
                    <Text style={styles.itemFont}>{AH.MAP[obj.o]}</Text>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        const { list, title } = this.props;
        return (
            <View style={styles.container}>
                {
                        list.length > 0 &&
                        <Text style={styles.head}>{title}</Text>
                    }
                <ListView
                    dataSource={this.ds.cloneWithRows(list)}
                    contentContainerStyle={styles.listStyle}
                    renderRow={this.renderRow}
                    enableEmptySections />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    listStyle:{
        flexDirection:'row', // 改变ListView的主轴方向
        flexWrap:'wrap', // 换行
        width:sr.w,
    },
    item:{
        width:sr.w / 2,
        height:25,
        paddingLeft:10,
    },
    press:{
        flexDirection:'row',
        alignItems:'center',
        height:16,
    },
    imgChoose:{
        width:14,
        height:14,
    },
    itemFont:{
        marginLeft:10,
        fontSize:14,
        color:'#333333',
        fontWeight:'300',
    },
    head:{
        color:'#333333',
        fontSize:14,
        fontWeight:'500',
        marginLeft:9,
        marginTop:10,
        marginBottom:12,
    },
});

```

* PDShop/project/App/modules/person/PermissionSetting.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ScrollView,
} = ReactNative;

import _ from 'lodash';

const Permission = require('./Permission');

module.exports = React.createClass({
    statics: {
        title: '权限设置',
        rightButton : { title: '确认', handler: () => { app.scene.confirm(); } },
    },
    getInitialState () {
        return {
            list:this.props.employeeInfo && this.props.employeeInfo.authority || this.props.authority || [],
        };
    },
    confirm () {
        const { employeeInfo, isCreate } = this.props;
        const { list } = this.state;
        if (_.intersection(app.personal.info.authority, [AH.AH_MODIFY_MEMBER]).length == 0) {
            Toast('你没有修改成员信息的权限');
            return;
        }
        if (isCreate) {
            app.pop();
            this.props.backAuthority(list);
        } else {
            const param = {
                userId: app.personal.info.userId,
                memberId : employeeInfo.id,
                name: employeeInfo.name,
                phone: employeeInfo.phone,
                authority: list,
            };
            POST(app.route.ROUTE_MODIFY_MEMBER, param, this.getModifyMemberSuccess, true);
        }
    },
    getModifyMemberSuccess (data) {
        if (data.success) {
            Toast('修改成功');
        } else {
            Toast(data.msg);
        }
    },
    setSelect (obj) {
        const { list } = this.state;
        _.find(list, o => { return obj.o == o; }) != undefined ? _.remove(list, o => { return obj.o == o; }) : list.push(parseInt(obj.o));
        this.setState({ list });
    },
    render () {
        const { selfAuthority, employeeInfo, isCreate } = this.props;
        const { list } = this.state;
        return (
            <View style={styles.container}>
                {
                    !isCreate &&
                    <View style={styles.top}>
                        <Text style={styles.name}>姓名：{employeeInfo.name}</Text>
                        <Text style={styles.topFont}>职务：{employeeInfo.post || '普通员工'}</Text>
                        <Text style={styles.topFont}>已有权限：{list.length}项</Text>
                    </View>
                }
                <Text style={styles.title}>选择权限</Text>
                <ScrollView style={styles.jurisdiction}>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 0 && o < 10000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'总店权限'} />
                    </View>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 10000 && o < 20000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'公共权限'} />
                    </View>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 20000 && o < 30000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'分店权限'} />
                    </View>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 30000 && o < 40000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'物流公司'} />
                    </View>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 40000 && o < 50000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'收货点'} />
                    </View>
                </ScrollView>

            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    top:{
        backgroundColor:'#FFFFFF',
        height:80,
    },
    name:{
        fontSize:14,
        marginLeft:10,
        marginTop:5,
        flex:1,
    },
    topFont:{
        fontSize:12,
        marginLeft:10,
        color:'#333333',
        flex:1,
    },
    title:{
        color:'#666666',
        height:40,
        padding:10,
        paddingTop:13,
    },
    jurisdiction:{
        flex:1,
        backgroundColor:'#FFFFFF',
    },
    head:{
        color:'#333333',
        fontSize:14,
        fontWeight:'500',
        marginLeft:9,
        marginTop:10,
        marginBottom:12,
    },
});

```

* PDShop/project/App/modules/person/Recharge.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    TextInput,
} = ReactNative;

const { Button, MessageBox } = COMPONENTS;
const BankCardList = require('./SelectBankCardList');
// const PayPassword = require('../common/PayPassword');

module.exports = React.createClass({
    statics: {
        title: '充值',
    },
    getInitialState () {
        return {
            bankCard:'请选择银行卡',
            amount:'',
            type:'',
            selectedRowID:'',
        };
    },
    showBankCardList () {
        const { selectedRowID } = this.state;
        app.push({
            component:BankCardList,
            passProps: {
                setBankCard: this.setCardInfo,
                selectedRowID,
            },
        });
    },
    toPaySuccess (data) {
        const { amount } = this.state;
        if (data.success) {
            app.personal.setRemainAmount(app.personal.remainAmount + amount * CONSTANTS.RATE);
            this.props.setRemainAmount(app.personal.remainAmount);
            app.pop();
            app.showModal(
                <MessageBox
                    onConfirm={this.doConfirmDelete}
                    content={'成功充值' + amount + '元'}
                    width={sr.s(250)} />
                );
        } else {
            Toast(data.msg);
        }
    },
    doRecharge () {
        const { amount } = this.state;
        if (!app.utils.checkInt2PointNum(amount)) {
            Toast('请输入数字且小数点后最多2位');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            amount,
            thirdpartyAccount:'N1231242311',
        };
        POST(app.route.ROUTE_RECHARGE, param, this.toPaySuccess, true);
        // app.wxpay.doPay(amount,'充值',(data)=>{
        //         if (data.success) {
        //             app.personal.setRemainAmount(parseInt(app.personal.remainAmount)+parseInt(amount));
        //             app.pop();
        //             Toast('充值成功');
        //         }
        //
        //     },(data)=>{
        //         Toast(data.errStr);
        //     });
        // app.push({
        //     component:PayPassword,
        //     passProps:{
        //         param,
        //         routeName:app.route.ROUTE_RECHARGE,
        //         amount,
        //         prompt : '充值成功',
        //     },
        // });
    },
    setCardInfo (cardName, selectedRowID) {
        this.setState({
            bankCard:cardName,
            selectedRowID,
        });
    },
    render () {
        const { amount } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.row}>
                    <Text style={styles.titleText}>金额</Text>
                    <TextInput
                        underlineColorAndroid='transparent'
                        keyboardType='numeric'
                        maxLength={CONSTANTS.AMOUNT_MAX_LENGTH}
                        defaultValue={amount}
                        onChangeText={(text) => this.setState({ amount: text })}
                        style={styles.ItemBgText} />
                </View>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showBankCardList}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{this.state.bankCard}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <Button onPress={this.doRecharge} style={styles.btnRecharge} textStyle={styles.btnRechargeText} >
                    充值
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 10,
    },
    ItemBg: {
        paddingLeft:10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    row:{
        flexDirection:'row',
        alignItems:'center',
        height:44,
        backgroundColor:'#ffffff',
    },
    titleText:{
        marginLeft:8,
        fontSize:15,
        color:'#888888',
    },
    ItemBgText: {
        padding:0,
        flexDirection: 'row',
        alignItems: 'center',
        textAlign:'right',
        fontSize: 15,
        flex:1,
        marginRight:10,
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',

    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    btnRecharge:{
        marginTop:215,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
        backgroundColor:'#c81622',
    },
    btnRechargeText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDShop/project/App/modules/person/SelectBankCardList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '银行卡',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        const { bankCard, selectedRowID } = this.state;
        this.props.setBankCard(bankCard, selectedRowID);
        app.pop();
    },
    getInitialState () {
        const { selectedRowID } = this.props;
        return {
            selectedRowID,
            bankCard:'农业银行',
        };
    },
    toChoose (obj, rowID) {
        this.setState({
            selectedRowID:rowID,
        });
    },
    renderRow (obj, rowID) {
        const { selectedRowID, bankCard } = this.state;
        return (
            <View style={styles.container} >
                <View style={styles.line} />
                <TouchableOpacity onPress={this.toChoose.bind(null, obj, rowID)}>
                    <View style={styles.item}>
                        <Text style={styles.nameText}>
                            {bankCard}
                        </Text>
                        {
                            (rowID == selectedRowID) &&
                            <Image
                                resizeMode='stretch'
                                source={app.img.common_radio}
                                style={styles.icon_go} />
                        }

                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'clientList'}
                    renderSeparator={null}
                    listUrl={app.route.ROUTE_GET_CLIENT_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    line:{
        height:1,
        backgroundColor:'#F4F4F4',
    },
    item:{
        height:42,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    nameText:{
        paddingLeft:8,
        color:'#333333',
        fontSize:14,
    },
    icon_go: {
        width: 10,
        height: 10,
        marginRight: 12,
    },
});

```

* PDShop/project/App/modules/person/SelectEmployees.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    Text,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;
const PermissionSetting = require('./PermissionSetting');
const addEmployee = require('./addEmployee');

module.exports = React.createClass({
    statics: {
        title: '选择员工',
        rightButton : { title: '添加员工', handler: () => { app.scene.addEmployee(); } },
    },
    getInitialState () {
        return {
            myself: {},
        };
    },
    addEmployee () {
        if (_.intersection(app.personal.info.authority, [AH.AH_CREATE_MEMBER]).length == 0) {
            Toast('你没有添加员工的权限');
            return;
        }
        app.push({
            component:addEmployee,
            passProps:{
                refresh:this.refresh,
            },
        });
    },
    refresh () {
        this.listView.refresh();
    },
    showPermissionSetting (obj) {
        app.push({
            component:PermissionSetting,
            passProps:{
                employeeInfo:obj,
                selfAuthority:app.personal.info.authority,
            },
        });
    },
    renderRow (obj, rowId) {
        if (obj.id == app.personal.info.userId) {
            return null;
        } else {
            return (
                app.personal.info.partment.chargeMan.id != obj.id &&
                <TouchableOpacity onPress={this.showPermissionSetting.bind(null, obj)}>
                    <View style={styles.item}>
                        <Text style={styles.itemNum}>{obj.name ? obj.name : ''}</Text>
                        <View style={styles.itemRight}>
                            <Text style={styles.itemNum}>{obj.authority.length}项</Text>
                            <Image resizeMode='contain' source={app.img.common_go} style={styles.itemImg} />
                        </View>
                    </View>
                </TouchableOpacity>
            );
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId }}
                    renderSeparator={null}
                    listName={'memberList'}
                    listUrl={app.route.ROUTE_GET_MEMBER_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    item:{
        height:42,
        width:sr.w,
        marginTop:1,
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'space-between',
    },
    itemNum:{
        fontWeight:'300',
        marginLeft:10,
        marginRight:5,
    },
    itemRight:{
        marginRight:10,
        flexDirection:'row',
        alignItems:'center',
    },
    itemImg:{
        width:15,
        height:15,
    },
});

```

* PDShop/project/App/modules/person/Software.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '软件许可协议',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_SOFTWARE_LICENSE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDShop/project/App/modules/person/StatusSelection.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '搬运状态',
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.top}>
                    <Text style={styles.title}>状态选择</Text>
                </View>
                <View style={styles.chooseStatus}>
                    <TouchableOpacity style={styles.item}
                        onPress={this.props.setStatus.bind(null, true)}
                        onPressOut={this.props.doClose}>
                        <Text style={styles.text}>营业</Text>
                    </TouchableOpacity>
                    <TouchableOpacity style={styles.item}
                        onPress={this.props.setStatus.bind(null, false)}
                        onPressOut={this.props.doClose}>
                        <Text style={styles.text}>暂停营业</Text>
                    </TouchableOpacity>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#dddddd',
    },
    top:{
        height:50,
        backgroundColor:'#ffffff',
        alignItems:'center',
        justifyContent:'center',
    },
    title:{
        fontSize:15,
        fontWeight:'600',
    },
    text:{
        fontSize:12,
        fontWeight:'300',
    },
    item:{
        marginTop:1,
        alignItems:'center',
        justifyContent:'center',
        height:50,
        backgroundColor:'#ffffff',
    },
});

```

* PDShop/project/App/modules/person/TransportQuotation.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '搬运行情',
    },
    getInitialState () {
        return {
            ds: new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 }),
            list: [1, 2],
        };
    },
    renderRow (obj, rowId) {
        return (
            <View style={styles.row}>
                <Text style={styles.name}>{'小虎搬运队'}</Text>
                <Text style={styles.peopleInfo}>人数:{'12'}人</Text>
                <Text style={styles.peopleInfo}>电话:{'18888888888'}</Text>
                <Text style={styles.price}>¥{'50.00'}/吨</Text>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    dataSource={this.state.ds.cloneWithRows(this.state.list)}
                    renderRow={this.renderRow}
                />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    row:{
        backgroundColor:'#FFFFFF',
        height:75,
        marginTop:8,
        paddingLeft:10,
    },
    name:{
        fontSize:14,
        color:'#333333',
        flex:1,
        marginTop:8,
    },
    peopleInfo:{
        fontSize:12,
        color:'#888888',
        flex:1,

    },
    price:{
        position:'absolute',
        fontSize:13,
        right:15,
        top:8,
        color:'#e7222d',
    },
    btn:{
        width:75,
        height:22,
        backgroundColor:'#FFFFFF',
        borderRadius:4,
        borderWidth:0.5,
        borderColor:'#ee1822',
        position:'absolute',
        right:15,
        bottom:10,
    },
    btnFont:{
        color:'#ee1822',
        fontSize:12,
    },
});

```

* PDShop/project/App/modules/person/VerificationCode.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Text,
    Keyboard,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const PayPasswordSetting = require('./PayPasswordSetting');
const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '获取验证码',
    },
    getInitialState () {
        return {
            readSecond:false,
            time:59,
            verifyCode:'',
        };
    },
    doPress () {
        const param = {
            phone: app.personal.info.phone,
        };
        POST(app.route.ROUTE_REQUEST_SEND_VERIFY_CODE, param, this.requestSendVerifyCodeSuccess, false);
    },
    timer () {
        this.setState({ readSecond:true });
        this.setTimeout(
            () => {
                this.setState({ time:(this.state.time - 1) });
                if (this.state.time <= 0) {
                    return this.setState({ readSecond:false, time:59 });
                }
                this.timer();
            },
            1000
        );
    },
    requestSendVerifyCodeSuccess (data) {
        if (data.success) {
            this.timer();
        } else {
            Toast(data.msg);
        }
    },
    doNext () {

        const { verifyCode } = this.state;
        if (!verifyCode) {
            Toast('请填写验证码');
            return;
        }
        if (!app.utils.checkVerificationCode(verifyCode)) {
            Toast('请填写正确的验证码');
            return;
        }
        Keyboard.dismiss();
        app.push({
            component:PayPasswordSetting,
            passProps:{
                verifyCode,
            },
        });
    },
    doInput () {
        Toast('请先获取验证码');
    },
    render () {
        const { readSecond } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请填写验证码'
                            keyboardType='numeric'
                            maxLength={6}
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ verifyCode: text })}
                            style={styles.itemNameText} />
                        <TouchableOpacity
                            disabled={readSecond}
                            onPress={this.doPress}
                            style={styles.btnBind}>
                            { !readSecond ?
                                <View style={styles.btnContainer}>
                                    <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>获取验证码</Text>
                                </View>
                                :
                                <View style={styles.btnContainerGray}>
                                    <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>{this.state.time}s后重新发送</Text>
                                </View>
                            }
                        </TouchableOpacity>
                    </View>
                </View>
                <Button onPress={this.doNext}
                    style={styles.btnNext}
                    textStyle={styles.btnNextText} >
                    下一步
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBgTop: {
        height: 45,
        marginTop:10,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    ItemBg: {
        height: 45,
        marginTop:1,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent: 'space-between',
    },
    icon_add:{
        width:25,
        height:25,
        marginLeft: 8,
    },
    itemNameText: {
        flex:1,
        fontSize: 14,
        color: '#444444',
        marginLeft: 10,
    },

    btnNext:{
        marginTop:50,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnNextText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
    btnBind:{
        height:45,
        width:137,
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        alignItems:'center',
    },
    btnContainer:{
        height:45,
        alignItems:'center',
        justifyContent:'center',
        width:137,
    },
    btnBindText:{
        color:'#FF981A',
        fontSize:14,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
    },
    btnContainerGray:{
        height:45,
        width:137,
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#fafafa',
    },
    btnBindTextGray:{
        color:'#999999',
        backgroundColor:'#fafafa',
        fontSize:14,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
    },
});

```

* PDShop/project/App/modules/person/WithdrawCash.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    TextInput,
} = ReactNative;

const { Button } = COMPONENTS;
const BankCardList = require('./SelectBankCardList');
const PayPassword = require('../common/PayPassword');
const VerificationCode = require('./VerificationCode');

module.exports = React.createClass({
    statics: {
        title: '提现',
    },
    showBankCardList () {
        const { selectedRowID } = this.state;
        app.push({
            component:BankCardList,
            passProps: {
                setBankCard: this.setCardInfo,
                selectedRowID,
            },
        });
    },
    getInitialState () {
        return {
            bankName: '请选择银行卡',
            money:'',
            selectedRowID:'',
        };
    },
    doWithdraw () {
        const { money } = this.state;
        if (!app.utils.checkInt2PointNum(money)) {
            Toast('请输入数字且小数点后最多2位');
            return;
        }
        if (money == 0) {
            Toast('提现金额不能为0');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            amount:money,
            thirdpartyAccount:'N1231242311',
        };
        if (app.personal.info.isSetPaymentPassword == 0) {
            Toast('请先设置支付密码');
            app.push({
                component: VerificationCode,
            });
            return;
        }
        app.push({
            component: PayPassword,
            passProps: {
                param,
                routeName:app.route.ROUTE_WITHDRAW,
                money,
                prompt : '提现成功',
            },
        });
    },
    setCardInfo (cardName, selectedRowID) {
        this.setState({
            bankName:cardName,
            selectedRowID,
        });
    },
    WithdrawalsAllMoney () {
        this.setState({
            money:app.personal.remainAmount + '',
        });
    },
    render () {
        const { money } = this.state;
        return (
            <View style={styles.container}>
                <Text style={styles.drawCashTitle}>
                    提现金额
                </Text>
                <View style={styles.drawCash}>
                    <Text style={styles.drawCashLeft}>
                        ￥
                    </Text>
                    <TextInput
                        keyboardType='numeric'
                        underlineColorAndroid='transparent'
                        placeholderTextColor='#888888'
                        maxLength={CONSTANTS.AMOUNT_MAX_LENGTH}
                        placeholder='请输入提现金额'
                        defaultValue={money}
                        onChangeText={(text) => this.setState({ money: text })}
                        style={styles.drawCashContent} />
                </View>
                <View style={styles.balance}>
                    <View style={styles.balanceLeft}>
                        <Text style={styles.balanceTextLeft}>
                            账户余额：
                        </Text>
                        <Text style={styles.balanceTextRight}>
                            {app.personal.remainAmount}元
                        </Text>
                    </View>
                    <TouchableOpacity onPress={this.WithdrawalsAllMoney}>
                        <Text style={styles.allDrawcash}>
                            全部提现
                        </Text>
                    </TouchableOpacity>
                </View>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showBankCardList}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{this.state.bankName}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <Button onPress={this.doWithdraw} style={styles.btnDrawCash} textStyle={styles.btnDrawCashText}>
                    确认提现
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    drawCashTitle:{
        marginTop:10,
        paddingLeft:12,
        paddingTop:10,
        fontSize:12,
        backgroundColor:'#FFFFFF',
    },
    drawCash:{
        height:48,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        alignItems:'center',
    },
    drawCashLeft:{
        fontSize:12,
        paddingLeft:12,
    },
    drawCashContent:{
        flex:1,
        fontSize:20,
    },
    balance:{
        height:34,
        marginTop:1,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    balanceLeft:{
        height:34,
        marginTop:1,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
    },
    balanceTextLeft:{
        fontSize:14,
        color:'#888888',
        paddingLeft:12,
        paddingTop:10,
    },
    balanceTextRight:{
        fontSize:14,
        color:'#888888',
        paddingTop:10,
    },
    allDrawcash:{
        color:'#fd9a14',
        paddingRight:10,
        paddingTop:10,
    },
    ItemBg: {
        marginTop:17,
        padding: 10,
        height: 44,
        width:sr.w,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
        backgroundColor:'white',
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        width:sr.w - 45,
        color: '#444444',
        marginLeft: 8,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    btnDrawCash:{
        marginTop:285,
        backgroundColor:'#FE9917',
        height:46,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
    },
});

```

* PDShop/project/App/modules/person/addEmployee.js

```js
 'use strict';

 const React = require('react');
 const ReactNative = require('react-native');
 const {
    StyleSheet,
    View,
    Image,
    Text,
    TextInput,
    TouchableOpacity,
} = ReactNative;

 const { Button } = COMPONENTS;
 const PermissionSetting = require('./PermissionSetting');

 module.exports = React.createClass({
     statics: {
         title: '添加员工',
     },
     getInitialState () {
         return {
             authority:[],
             phone:'',
             name:'',
         };
     },
     getAuthority () {
         const { authority } = this.state;
         app.push({
             component:PermissionSetting,
             passProps:{
                 isCreate:true,
                 authority,
                 selfAuthority:app.personal.info.authority,
                 backAuthority:(authority) => { this.setState({ authority }); },
             },
         });
     },
     createMember () {
         const { name, phone, authority } = this.state;
         if (app.utils.checkPhone(phone)) {
             const param = {
                 userId: app.personal.info.userId,
                 name,
                 phone,
                 authority,
             };
             POST(app.route.ROUTE_CREATE_MEMBER, param, (data) => { data.success ? Toast('创建成功！') : Toast(data.msg); this.props.refresh(); app.pop(); }, true);
         } else {
             Toast('请填写正确的手机号');
         }
     },
     render () {
         const { authority } = this.state;
         return (
             <View style={styles.container}>
                 <View style={styles.top}>
                     <View style={styles.row}>
                         <Text style={styles.rowFont}>手机号码</Text>
                         <TextInput style={styles.rowRightFont}
                             placeholderColor='#aaaaaa'
                             maxLength={11}
                             underlineColorAndroid='transparent'
                             onChangeText={(text) => this.setState({ phone: text })}
                             placeholder='请输入手机号码' />
                     </View>
                     <View style={styles.row}>
                         <Text style={styles.rowFont}>姓名</Text>
                         <TextInput style={styles.rowRightFont}
                             underlineColorAndroid='transparent'
                             onChangeText={(text) => this.setState({ name: text })}
                             maxLength={CONSTANTS.NAME_MAX_LENGTH}
                             placeholderColor='#aaaaaa'
                             placeholder='请输入姓名' />
                     </View>
                 </View>
                 <TouchableOpacity style={styles.row} onPress={this.getAuthority}>
                     <Text style={styles.rowFont}>权限设置</Text>
                     <Text style={styles.rowRightFont}>{authority.length}项</Text>
                     <Image resizeMode='contain' style={styles.imgGo} source={app.img.common_go} />
                 </TouchableOpacity>
                 <Button onPress={this.createMember} style={styles.btnConfirm} textStyle={styles.btnFont}>确认添加</Button>
             </View>
         );
     },
 });

 const styles = StyleSheet.create({
     container:{
         flex: 1,
     },
     top:{
         marginTop:10,
         marginBottom:10,
     },
     row:{
         backgroundColor:'#FFFFFF',
         height:42,
         flexDirection:'row',
         alignItems:'center',
         paddingRight:10,
     },
     rowFont:{
         marginLeft:10,
         fontWeight:'300',
         flex:1,
     },
     rowRightFont:{
         flex:1,
         fontSize:14,
         textAlign:'right',
     },
     imgGo:{
         width:15,
         height:15,
         marginLeft:10,
     },
     btnConfirm:{
         width:150,
         height:45,
         alignSelf:'center',
         borderRadius:4,
         marginTop:65,
     },
     btnFont:{
         fontSize:14,
         fontWeight:'500',
     },
 });

```

* PDShop/project/App/modules/person/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    StyleSheet,
    Text,
    View,
    TouchableOpacity,
    ScrollView,
} = ReactNative;

const ParameterSetting = require('./ParameterSetting');
const CashBalance = require('./CashBalance');
const Bankcards = require('./BindBankcardList');
const VerificationCode = require('./VerificationCode');

const EditPersonInfo = require('./EditPersonInfo');
const About = require('./About');
const Feedback = require('./Feedback');
const NormalQuestions = require('./NormalQuestions');
const UpdatePage = require('../update/UpdatePage');
const Software = require('./Software');
const ModifyPassword = require('./ModifyPassword');
const SelectEmployees = require('./SelectEmployees');
const MyRemovalTeam = require('./MyRemovalTeam');

const { DImage } = COMPONENTS;

const CHILD_PAGES_TOP = [
    { strict:true, title:'余额', module: CashBalance, img:'', clickEnable:true },
    { strict:true, title:'银行卡', module: Bankcards, img:'', clickEnable:true },
    { strict:true, title:'支付密码设置', module: VerificationCode, img:'', clickEnable:true },
    { strict:true, title:'修改登录密码', module: ModifyPassword, img:'', clickEnable:true },
];
// const CHILD_PAGES_MIDDLE = [
//     { strict:true, title:'我的搬运队', module:MyRemovalTeam, img:'', clickEnable:true },
//     { strict:true, title:'员工设置', module: SelectEmployees, img:'', clickEnable:true },
// ];
const CHILD_PAGES_BOTTOM = [
    { strict:true, title:'软件许可协议', module: Software, img:'', clickEnable:true },
    { strict:true, title:'常见问题', module: NormalQuestions, img:'', clickEnable:true },
    { strict:true, title:'在线更新', module: UpdatePage, img:'', clickEnable:true },
    { strict:true, title:'关于软件', module: About, img:'', clickEnable:true },
    { strict:true, title:'意见反馈', module: Feedback, img:'', clickEnable:true },
];
const MenuItem = React.createClass({
    showChildPage () {
        const { module } = this.props.page;
        app.push({
            component: module,
        });
    },
    render () {
        const { title, clickEnable } = this.props.page;
        return (
            <TouchableOpacity
                activeOpacity={0.6}
                onPress={clickEnable ? this.showChildPage : null}
                style={styles.ItemBg}>
                <View style={styles.infoStyle}>
                    <Text style={styles.itemNameText}>{title}</Text>
                </View>
                {
                    clickEnable &&
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                }
                <View style={styles.lineView} />
            </TouchableOpacity>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: '个人中心',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '个人中心';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    getInitialState () {
        return {
            info:app.personal.info,
        };
    },
    toExitDatum () {
        app.push({
            component: EditPersonInfo,
            passProps: { updateInfo: this.updateInfo },
        });
    },
    updateInfo (info) {
        this.setState({ info });
    },
    judgePermission (employeeSetting) {
        if (_.intersection(app.personal.info.authority, employeeSetting).length != 0) {
            return true;
        } else {
            return false;
        }
    },
    componentWillMount () {
        const employeeSetting = [AH.AH_LOOK_MEMBER, AH.AH_CREATE_MEMBER, AH.AH_REMOVE_MEMBER, AH.AH_MODIFY_MEMBER];
        if (app.personal.info.partment && app.personal.info.partment.type == PT.SP_RECEIVE_PARTMENT) {
            this.page = {
                top:CHILD_PAGES_TOP,
                middle:[
                    { strict:true, title:app.personal.info.post || '普通员工', module:null, img:'', clickEnable:false },
                    { strict:true, title:'员工设置', module: SelectEmployees, img:'', clickEnable: this.judgePermission(employeeSetting) },

                ],
                bottom:CHILD_PAGES_BOTTOM,
            };
        } else if (app.personal.info.partment && app.personal.info.partment.type == PT.SP_WARE_HOUSE_PARTMENT) {
            this.page = {
                top:null,
                middle:[
                    { strict:true, title:app.personal.info.post || '普通员工', module:null, img:'', clickEnable:false },
                    { strict:true, title:'员工设置', module: SelectEmployees, img:'', clickEnable: this.judgePermission(employeeSetting) },
                ],
                bottom:CHILD_PAGES_BOTTOM,
            };
        } else if (app.personal.info.partment && app.personal.info.partment.type == PT.SP_CARRY_PARTMENT) {
            this.page = {
                top:CHILD_PAGES_TOP,
                middle:[
                    { strict:true, title:'我的搬运队', module:MyRemovalTeam, img:'', clickEnable: this.judgePermission([AH.AH_MODIFY_OWN_PARTMENT]) },
                    { strict:true, title:'员工设置', module: SelectEmployees, img:'', clickEnable: this.judgePermission(employeeSetting) },
                ],
                bottom:CHILD_PAGES_BOTTOM,
            };
        } else if (app.personal.info.partment && app.personal.info.partment.type == PT.SP_SECURITY_CHECK_PARTMENT) {
            this.page = {
                top:null,
                middle:[
                    { strict:true, title:app.personal.info.post || '普通员工', module:null, img:'', clickEnable:false },
                    { strict:true, title:'员工设置', module: SelectEmployees, img:'', clickEnable: this.judgePermission(employeeSetting) },
                ],
                bottom:CHILD_PAGES_BOTTOM,
            };
        } else if (!app.personal.info.partment) {
            this.page = {
                top:[
                    { strict:true, title:app.personal.info.post || '普通员工', module:null, img:'', clickEnable:false },
                    { strict:true, title:'参数设置', module: ParameterSetting, img:'', clickEnable: true },
                ],
                middle:CHILD_PAGES_TOP,
                bottom:CHILD_PAGES_BOTTOM,
            };
        } else {
            this.page = {
                top:CHILD_PAGES_TOP,
                middle:[
                    { strict:true, title:app.personal.info.post || '普通员工', module:null, img:'', clickEnable:false },
                    { strict:true, title:'员工设置', module: SelectEmployees, img:'', clickEnable: this.judgePermission(employeeSetting) },
                ],
                bottom:CHILD_PAGES_BOTTOM,
            };
        }
    },
    render () {
        const { info } = this.state;
        return (
            <ScrollView style={styles.container}>
                <View style={styles.headImgBg}>
                    <TouchableOpacity
                        onPress={this.toExitDatum}>
                        <DImage
                            resizeMode='cover'
                            defaultSource={app.img.personal_default_head}
                            source={{ uri: info.head }}
                            style={styles.headStyle} />
                        <Image
                            resizeMode='stretch'
                            source={app.img.personal_female}
                            style={styles.careStyle} />
                    </TouchableOpacity>
                    <Text style={styles.name}>{info.name ? info.name : '张三'}</Text>
                </View>
                <View>
                    {this.page.top && <View style={styles.lineViewTop} />}
                    {
                        this.page.top && this.page.top.map((item, i) => {
                            if (!app.personal.info.phone && item.strict) {
                                return null;
                            }
                            if (item.title == '余额') {
                                if (_.intersection(app.personal.info.authority, [AH.AH_LOOK_AMOUNT, AH.AH_RECHARGE, AH.AH_WITHDRAW]).length != 0) {
                                    return (<MenuItem page={item} key={i} />);
                                } else {
                                    return null;
                                }
                            } else if (item.title == '支付密码设置') {
                                if (_.intersection(app.personal.info.authority, [AH.AH_WITHDRAW]).length != 0) {
                                    return (<MenuItem page={item} key={i} />);
                                } else {
                                    return null;
                                }
                            } else {
                                return (<MenuItem page={item} key={i} />);
                            }
                        })
                    }
                    {this.page.middle && <View style={styles.lineViewTop} />}
                    {
                        this.page.middle && this.page.middle.map((item, i) => {
                            if (!app.personal.info.phone && item.strict) {
                                return null;
                            }
                            return (
                                !item.hidden &&
                                <MenuItem page={item} key={i} />
                            );
                        })
                    }
                    {this.page.bottom && <View style={styles.lineViewTop} />}
                    {
                        this.page.bottom && this.page.bottom.map((item, i) => {
                            if (!app.personal.info.phone && item.strict) {
                                return null;
                            }
                            return (
                                !item.hidden &&
                                <MenuItem page={item} key={i} />
                            );
                        })
                    }
                    <View style={styles.line} />
                </View>
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        marginBottom:0,
        backgroundColor:'white',
    },
    headImgBg:{
        height: 160,
        width: sr.w,
        backgroundColor:'#c81622',
        alignItems:'center',
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
    },
    headStyle: {
        width: 87,
        height: 87,
        marginTop: 15,
        marginBottom:5,
        borderRadius: 43.5,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    lineViewTop:{
        backgroundColor: '#f4f4f4',
        height:8,
    },
    infoStyle: {
        flexDirection: 'row',
    },
    careStyle: {
        width: 20,
        height: 20,
        marginLeft:60,
        marginTop:-25,
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    name: {
        marginTop: 15,
        fontSize: 19,
        color: 'white',
        backgroundColor: 'transparent',
    },
    midView: {
        width: sr.w,
        height: 105,
        alignItems: 'center',
    },
    careShop: {
        marginVertical: 10,
        width:sr.w / 2.0,
        height: 50,
        alignItems: 'center',
        borderRadius: 8,
        justifyContent: 'center',
    },
    line: {
        width:sr.w,
        height:1,
        backgroundColor: '#f4f4f4',
    },
});

```

* PDShop/project/App/modules/receiveDepartment/OrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, DImage } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '货单详情',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '货单详情';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    getInitialState () {
        return {
            choose:false,
            canPay:false || this.props.canPay,
            actionSheetVisible: false,
        };
    },
    doChoose () {
        this.setState({
            choose:!this.state.choose,
        });
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        this.setState({ actionSheetVisible:true });
    },
    doConfirmPay () {
        const param = {
            userId: app.personal.info.userId,
            orderId: this.props.data.id,
        };
        POST(app.route.ROUTE_PAY_FOR_ORDER_WHEN_SEND, param, this.getPaySuccess, true);
    },
    getPaySuccess (data) {
        if (data.success) {
            this.setState({ actionSheetVisible:false });
            Toast('支付成功');
        } else {
            Toast('支付失败');
        }
    },
    doLookTransport () {

    },
    toPayMode (payMode) {
        if (payMode == 0) {
            return '现金付款';
        } else if (payMode == 1) {
            return '货到付款';
        } else {
            return '混合付款';
        }
    },
    render () {
        const { data } = this.props;
        const { stateList } = data;
        return (
            <View style={styles.container}>
                <View style={styles.containerReceive}>
                    <Text style={styles.textAddress}> 收货地址：{data.endPoint} </Text>
                    <Text style={styles.textName}> 收货人：{data.receiverName ? data.receiverPhone : '' + data.receiverPhone} </Text>
                </View>
                <View style={styles.containerMarket}>
                    <Image style={styles.marketLogo}
                        source={app.img.order_logo}
                        resizeMode='stretch'
                        />
                    <Text style={styles.textMarket}>{data.shop ? data.shop.name : data.agent ? data.agent.name : ''}</Text>
                    <Text style={styles.orderState}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.containerDetails}>
                    <DImage style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri: data.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <Text style={styles.detailsLeft}
                                numberOfLines={1}
                                ellipsizeMode='tail'>{data.shop ? data.shop.address : data.agent ? data.agent.address : ''}</Text>
                            <Text>-</Text>
                            <Text style={styles.detailsLeft}
                                numberOfLines={1}
                                ellipsizeMode='tail'>{data.endPoint}</Text>
                            <View style={styles.detailsTopRight}>
                                <Text style={styles.moneyLeft}>运费：</Text>
                                <Text style={styles.moneyRight}>¥{data.realFee}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>重量：{data.weight}吨</Text>
                        <Text style={styles.textDetailsItem}>方量：{data.size}m³</Text>
                        <Text style={styles.textDetailsItem}>件数：{data.totalNumbers}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{data.placeOrderTime}</Text>
                    </View>
                </View>
                <View style={styles.containerWhite} />
                <View style={styles.containerOrderNumber}>
                    <Text style={styles.textOrderNumber}>订单号：{data.id}</Text>
                    <Text style={styles.textDate}>创建时间：{data.createTime}</Text>
                </View>
                <View style={styles.containerInfo}>
                    <Text style={styles.textInfo}>运费：¥{data.realFee}</Text>
                    <Text style={styles.textInfo}>支付方式：{this.toPayMode(data.payMode)}</Text>
                    <Text style={styles.textInfo}>保险费：¥{data.needPayInsuanceFee}</Text>
                    <Text style={styles.textTotal}>总计：¥{data.realFee + data.needPayInsuanceFee}</Text>
                </View>
                <TouchableOpacity
                    onPress={this.doLookTransport}
                    style={styles.transportInfo}>
                    <Text style={styles.textTransportInfo}>物流信息</Text>
                    <View style={styles.transportInfoRight}>
                        <Text style={styles.textTransportInfoRight}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                        <Image
                            style={styles.imageCommon_go}
                            resizeMode='stretch'
                            source={app.img.common_go}
                            />
                    </View>
                </TouchableOpacity>
                { this.state.canPay &&
                    <View style={styles.bottomView}>
                        <View style={styles.bottomInfo}>
                            <View style={styles.infoLeft}>
                                <Text style={styles.moneyLeft}>总计:</Text>
                                <Text style={styles.moneyRight}>¥{data.realFee}</Text>
                            </View>
                            <Button onPress={this.doShowActionSheet} style={styles.btnPayNow} textStyle={styles.btnPayNowText}>
                                立即支付
                            </Button>
                        </View>
                    </View>
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    containerTop:{
        height:60,
        backgroundColor:'#c81622',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    imageTop:{
        height:32,
        width:27,
    },
    textTop:{
        fontSize:12,
        fontWeight:'900',
        marginLeft:20,
        color:'#ffffff',
    },
    containerReceive:{
        marginTop:8,
        height:50,
        backgroundColor:'#ffffff',
        justifyContent: 'center',
    },
    textAddress:{
        marginLeft:10,
        fontSize:14,
        marginBottom:3,
        color:'#333333',
    },
    textName:{
        marginLeft:10,
        fontSize:12,
        marginTop:3,
        color:'#333333',
    },
    containerMarket:{
        height:25,
        marginTop:8,
        backgroundColor:'#ffffff',
        alignItems: 'center',
        justifyContent: 'space-between',
        flexDirection: 'row',
    },
    containerMarketLeft:{
        flexDirection: 'row',
    },
    marketLogo:{
        height:13,
        width:16.5,
        marginLeft:10,
    },
    textMarket:{
        flex:1,
        marginLeft:10,
        color:'#333333',
        fontSize:12,
    },
    orderState:{
        color:'#00a117',
        marginRight:10,
        fontSize:12,
    },
    containerDetails:{
        height:105,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    containerWhite:{
        height:8,
        backgroundColor:'#ffffff',
    },
    imageGoods:{
        height:90,
        width:90,
        marginLeft:12,
        marginTop:11,
    },
    goodsDetails:{
        marginLeft:8,
        height:95,
        marginTop:5,
        paddingBottom:8,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        marginTop:8,
        justifyContent: 'space-between',
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
        marginRight:10,
    },
    detailsLeft:{
        fontSize:14,
        color:'#333333',
        width:60,
    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:12,
        color:'#888888',
    },
    containerOrderNumber:{
        height:50,
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        justifyContent: 'center',
    },
    textOrderNumber:{
        color:'#333333',
        marginBottom:3,
        fontSize:12,
    },
    textDate:{
        color:'#888888',
        marginTop:3,
        fontSize:12,
    },
    containerInfo:{
        height:90,
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
    },
    textInfo:{
        color:'#888888',
        fontSize:12,
        marginTop:5,
    },
    textTotal:{
        marginTop:5,
        fontSize:12,
        color:'#333333',
        fontWeight:'400',
    },
    transportInfo:{
        height:40,
        backgroundColor:'#ffffff',
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textTransportInfo:{
        color:'#888888',
        fontSize:14,
        marginLeft:10,
    },
    transportInfoRight:{
        marginRight:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    textTransportInfoRight:{
        fontSize:14,
        color:'#333333',
        marginRight:5,
    },
    imageCommon_go:{
        width: 8,
        height: 15,
        marginRight: 7,
    },
    choose:{
        marginLeft:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    imageChoose:{
        height:15,
        width:15,
    },
    bottomView:{
        position:'absolute',
        bottom:0,
        width:sr.w,
    },
    bottomInfo:{
        height:45,
        flexDirection: 'row',
        backgroundColor:'white',
        marginBottom:0,
    },
    infoLeft:{
        height:45,
        flexDirection: 'row',
        flex:1,
        justifyContent:'center',
        alignItems: 'center',
    },
    btnPayNow:{
        height:45,
        flex:1,
        borderRadius:0,
    },
    btnPayNowText:{
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDShop/project/App/modules/receiveDepartment/OrderList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList, DImage } = COMPONENTS;
const SendOrderDetail = require('./OrderDetail');

module.exports = React.createClass({
    doLookDetail (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess.bind(null, index), true);
    },
    getOrderDetailSuccess (index, data) {
        const { success, context, msg } = data;
        if (success) {
            app.push({
                component: SendOrderDetail,
                passProps: {
                    data: context,
                    type: 1,
                    updateList: (data) => {
                        this.listView.updateList((list) => {
                            list[index] = data;
                            return list;
                        });
                    },
                },
            });
        } else {
            Toast(msg);
        }
    },
    renderRow (obj, sectionID, rowID) {
        const { stateList } = obj;
        return (
            <View style={styles.row}>
                <View style={styles.rowTopContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.order_logo}
                        style={styles.topImage} />
                    <Text style={styles.topLeftText}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                    <Text style={styles.topRightText}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.line} />
                <TouchableOpacity style={styles.rowMiddleContainer} onPress={this.doLookDetail.bind(null, obj, rowID)}>
                    <DImage
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri: obj.photo }}
                        style={styles.middleImage} />
                    <View style={styles.middleRight}>
                        <View style={styles.pointContainer}>
                            <View style={styles.placeContainer}>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                <Text style={styles.pointName}>→</Text>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.endPoint}</Text>
                            </View>
                            <Text style={styles.transformFee}>{'运费：'}<Text style={styles.money}>￥{obj.needPayTransportFee}</Text></Text>
                        </View>
                        <Text style={styles.commonInfo}>重量：{obj.weight}吨</Text>
                        <Text style={styles.commonInfo}>方量：{obj.size}m³</Text>
                        <Text style={styles.commonInfo}>件数：{obj.totalNumbers}件</Text>
                        <Text style={styles.commonInfo}>仓库号：{obj.warehouse}件</Text>
                        <Text style={styles.commonInfo}>下单时间：{obj.createTime}</Text>
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        const { index, tabIndex, type, data } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                <View style={styles.separator} />
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        autoLoad={false}
                        renderRow={this.renderRow}
                        listParam={{ userId: app.personal.info.userId, type: type }}
                        listName={type + '.list'}
                        list={data.list}
                        listUrl={app.route.ROUTE_GET_ORDERS_BY_RECEIVE_PARTMENT}
                        refreshEnable />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    separator: {
        backgroundColor: '#f4f4f4',
        height: 5,
    },
    line:{
        height:1,
        width:sr.w,
        backgroundColor:'#f8f8f8',
    },
    rowTopContainer: {
        paddingHorizontal:10,
        paddingVertical:5,
        backgroundColor:'white',
        flexDirection: 'row',
    },
    topImage: {
        width: 17,
        height:17,
    },
    topLeftText: {
        marginLeft:10,
        flex:1,
        fontSize: 14,
    },
    topRightText: {
        flex:1,
        fontSize: 14,
        textAlign:'right',
        color:'#f51b1a',
    },
    rowMiddleContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:5,
        backgroundColor:'#ffffff',
    },
    middleImage: {
        width: 90,
        height:90,
        borderRadius: 10,
        marginLeft: 10,
    },
    middleRight: {
        paddingLeft: 10,
        width:sr.w - 100,
    },
    money: {
        fontSize: 14,
        color:'#f51b1a',
    },
    commonInfo: {
        fontSize: 13,
        color:'#888888',
    },
    pointName: {
        fontSize: 16,
        maxWidth: 70,
    },
    transformFee: {
        flex:1,
        fontSize: 14,
        color: 'gray',
        textAlign:'right',
        marginRight:5,
    },
    pointContainer: {
        flexDirection: 'row',
    },
    placeContainer: {
        flex:1,
        flexDirection: 'row',
    },
});

```

* PDShop/project/App/modules/receiveDepartment/Orders.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const OrderList = require('./OrderList');

module.exports = React.createClass({
    statics: {
        title: '货单',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '货单';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    getInitialState () {
        return {
            tabIndex: 0,
            context:{},
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    componentWillMount () {
        this.getOrders();
    },
    getOrders () {
        const param = {
            userId: app.personal.info.userId,
            pageNo:0,
            pageSize:10,
        };
        POST(app.route.ROUTE_GET_ORDERS_BY_RECEIVE_PARTMENT, param, this.getOrdersSuccess, false);
    },
    getOrdersSuccess (data) {
        if (data.success) {
            this.setState({ context:data.context });
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const menus = [{ name:'待入库', type:'tostore' }, { name:'已入库', type:'stored' }];
        const { tabIndex, context } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item.name}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <OrderList key={i} index={i} type={item.type} tabIndex={tabIndex} data={context && context[item.type]} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#ffffff',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDShop/project/App/modules/receiveDepartment/ScanResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '扫描结果',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '扫描结果';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    getInitialState () {
        return {
            context: {},
            totalNumbers:0,
            size:0,
            weight:0,
        };
    },
    componentWillMount () {
        const orderId = this.props.orderId;
        this.getOrderDetailByReceivePartment(orderId);
    },
    getOrderDetailByReceivePartment (orderId) {
        const param = {
            userId : app.personal.info.userId,
            orderId,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess, false);
    },
    getOrderDetailSuccess (data) {
        if (data.success) {
            this.setState({ context:data.context });
        } else {
            Toast(data.msg);
        }
    },
    placeTransferOrder () {
        const { context, totalNumbers, size, weight } = this.state;
        if (!app.utils.checkNum(weight)) {
            Toast('请填写货物重量');
            return;
        }
        if (!app.utils.checkNum(size)) {
            Toast('请填写货物方量');
            return;
        }
        if (!app.utils.checkIntNum(totalNumbers)) {
            Toast('请填写货物件数');
            return;
        }
        const param = {
            userId : app.personal.info.userId,
            orderId: context.id,
            totalNumbers,
            size,
            weight,
        };
        POST(app.route.ROUTE_PLACE_TRANSFER_ORDER, param, this.placeTransferOrderSuccess, false);
    },
    placeTransferOrderSuccess (data) {
        if (data.success) {
            Toast('下单成功！');
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { context, size, weight, endPoint } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.topContainer}>
                    <Image
                        resizeMode='stretch'
                        defaultSource={app.img.receive_order_default}
                        source={{ uri: context.photo }}
                        style={styles.topLeft} />
                    <View style={styles.topRight}>
                        <Text numberOfLines={1} style={styles.topRightText}>始发地址：{context.shop && context.shop.address}</Text>
                        <Text style={styles.topRightText}>重量：{context.weight}吨</Text>
                        <Text style={styles.topRightText}>方量：{context.size}m³</Text>
                        <Text style={styles.topRightText}>件数：{context.totalNumbers}件</Text>
                        <Text style={styles.topRightText}>收货地址：{context.endPoint}</Text>
                        {
                            context.warehouse &&
                            <Text style={styles.topRightText}>仓库：{context.warehouse}</Text>
                        }

                    </View>
                </View>
                <View>
                    <Text style={styles.attachInfoTitle}>附件信息</Text>
                    <View style={styles.attachItem}>
                        <Text style={styles.attachItemLeft}>重量</Text>
                        <View style={styles.textRight}>
                            <TextInput style={styles.attachItemRight}
                                underlineColorAndroid='transparent'
                                placeholderTextColor='#888888'
                                keyboardType='numeric'
                                placeholder='请输入货物重量'
                                maxLength={5}
                                defaultValue={context.weight + ''}
                                onChangeText={(text) => this.setState({ weight: text })}
                                />
                            <Text style={styles.attachItemRightUnit}>吨</Text>
                        </View>
                    </View>
                    <View style={styles.attachItem}>
                        <Text style={styles.attachItemLeft}>方量</Text>
                        <View style={styles.textRight}>
                            <TextInput style={styles.attachItemRight}
                                underlineColorAndroid='transparent'
                                keyboardType='numeric'
                                placeholderTextColor='#888888'
                                maxLength={5}
                                placeholder={'请输入货物方量'}
                                defaultValue={context.size + ''}
                                onChangeText={(text) => this.setState({ size: text })}
                            />
                            <Text style={styles.attachItemRightUnit}>m³</Text>
                        </View>
                    </View>
                    <View style={styles.attachItem}>
                        <Text style={styles.attachItemLeft}>件数</Text>
                        <View style={styles.textRight}>
                            <TextInput style={styles.attachItemRight}
                                underlineColorAndroid='transparent'
                                keyboardType='numeric'
                                placeholderTextColor='#888888'
                                maxLength={5}
                                placeholder='请输入货物件数'
                                defaultValue={context.totalNumbers + ''}
                                onChangeText={(text) => this.setState({ totalNumbers: text })}
                            />
                            <Text style={styles.attachItemRightUnit}>件</Text>
                        </View>
                    </View>
                    <View style={styles.attachItem}>
                        <Text style={styles.attachItemLeft}>操作人</Text>
                        <Text style={styles.attachItemRightUnit}>{app.personal.info.name}</Text>
                    </View>
                </View>
                <Button onPress={this.placeTransferOrder} style={styles.btnConfirmModify} textStyle={styles.btnConfirmModifyText} >
                    下中转单
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
        marginBottom:10,
    },
    topContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        backgroundColor:'white',
        paddingTop:8,
        paddingBottom:8,
    },
    topLeft: {
        width: 90,
        height:90,
        borderRadius: 10,
        marginLeft: 10,
    },
    topRight: {
        paddingLeft: 10,
        width:sr.w - 100,
    },
    topRightText: {
        fontSize: 13,
        color:'#888888',
        maxWidth:300,
    },
    btnConfirmModify:{
        marginTop:115,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:2,
    },
    btnConfirmModifyText:{
        color:'white',
        fontSize:16,
        fontWeight:'300',
    },
    noDataImg:{
        height:120,
        width:126,
        marginLeft:(sr.w - 126) / 2,
        marginTop:65,
    },
    onDataText:{
        fontSize:17,
        color:'#888888',
        marginTop:15,
        textAlign:'center',
    },
    attachInfoTitle:{
        fontSize:16,
        width:sr.w,
        paddingLeft:8,
        marginTop:8,
        marginBottom:3,
    },
    attachItem:{
        paddingLeft:10,
        width:sr.w,
        backgroundColor:'white',
        flexDirection:'row',
        justifyContent:'space-between',
        borderBottomWidth:1,
        borderBottomColor:'#f4f4f4',
        alignItems:'center',
        height:40,
    },
    attachItemLeft:{
        fontSize:14,
        textAlign:'center',
        color:'#333333',
    },
    attachItemRight:{
        width:sr.w / 2,
        padding:0,
        fontSize:14,
        textAlign:'right',
    },
    attachItemRightUnit:{
        marginRight:10,
        marginLeft:8,
        textAlign:'right',
        fontSize:14,
        color:'#333333',
    },
    textRight:{
        flexDirection:'row',
        alignItems:'center',
    },
});

```

* PDShop/project/App/modules/receiveDepartment/UploadPhoto.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ScrollView,
    Image,
    RefreshControl,
} = ReactNative;

const { Button } = COMPONENTS;
const Camera = require('@remobile/react-native-camera');
const ScanBarCode = require('../common/ScanBarCode');
const ScanResult = require('./ScanResult');

module.exports = React.createClass({
    statics: {
        title: '拍照',
        rightButton: { title: '扫描', handler: () => { app.scene.scanBarCode(); } },
    },
    onWillFocus () {
        app.getCurrentRoute().title = '拍照';
        app.getCurrentRoute().rightButton = { title: '扫描', handler: () => { app.scene.scanBarCode(); } };
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
        this.getNeedUploadPhotoOrder();
    },
    scanBarCode () {
        app.showModal(
            <ScanBarCode onBarCodeRead={this.onBarCodeRead} />
        );
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            app.push({
                component:ScanResult,
                passProps:{
                    orderId:data.id,
                },
            });
        }
    },
    getInitialState () {
        return {
            context: null,
        };
    },
    componentWillMount () {
        this.getNeedUploadPhotoOrder();
    },
    getNeedUploadPhotoOrder () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_LASTEST_ORDER_BY_RECIEVE_PARTMENT, param, this.getNeedUploadPhotoOrderSuccess, false);
    },
    getNeedUploadPhotoOrderSuccess (data) {
        if (data.success) {
            this.setState({ context:data.context });
        } else {
            this.setState({ context:null });
        }
    },
    setPhotoForOrder (photo) {
        const param = {
            userId: app.personal.info.userId,
            orderId:this.state.context.id,
            photo,
        };

        POST(app.route.ROUTE_SET_PHOTO_FOR_ORIGIN_ORDER, param, this.setPhotoForOrderSuccess.bind(null, photo), false);
    },
    setPhotoForOrderSuccess (photo) {
        Toast('照片更新成功');
        let { context } = this.state;
        context.photo = photo;
        this.setState({ context });
    },
    doTakePhoto () {
        const options = {
            quality: 30,
            allowEdit: true,
            targetWidth: 240,
            targetHeight: 240,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        };
        Camera.getPicture((filePath) => {
            this.uploadPhoto(filePath);
        }, (err) => {
            console.log('操作失败========', err);
        }, options);
    },
    uploadPhoto (filePath) {
        this.setState({ headImgSource: { uri: filePath } });
        const options = {};
        options.fileKey = 'file';
        options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
        options.mimeType = 'image/jpeg';
        options.params = {
            clientId:app.personal.info.userID,
        };
        this.uploadOn = true;
        UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress),
        this.uploadSuccessCallback, this.uploadErrorCallback, true);
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            const context = data.context;
            this.setPhotoForOrder(context.url);
            this.getNeedUploadPhotoOrder();
        } else {
            Toast('上传失败');
        }
        this.uploadOn = false;
    },
    uploadErrorCallback () {
        this.uploadOn = false;
        this.setState({ photo: app.personal.info.head });
    },
    onScroll () {
        this.getNeedUploadPhotoOrder();
    },
    render () {
        const { context } = this.state;
        const { photo, shop, totalNumbers, size, weight, endPoint } = context || {};
        return (
            <ScrollView
                refreshControl={
                    <RefreshControl
                        refreshing={false}
                        onRefresh={this.onScroll}
                        title='正在刷新...' />
                }
                style={styles.container}>
                {
                    !!context &&
                    <View>
                        <View style={styles.topContainer}>
                            <Image
                                resizeMode='stretch'
                                source={photo ? { uri: photo } : app.img.receive_order_default}
                                style={styles.topLeft} />
                            <View style={styles.topRight}>
                                <Text numberOfLines={1} style={styles.topRightText}>始发地址：{shop && shop.address}</Text>
                                <Text style={styles.topRightText}>重量：{weight}吨</Text>
                                <Text style={styles.topRightText}>方量：{size}m³</Text>
                                <Text style={styles.topRightText}>件数：{totalNumbers}件</Text>
                                <Text style={styles.topRightText}>收货地址：{endPoint}</Text>
                            </View>
                        </View>
                        <Button onPress={this.doTakePhoto} style={styles.btnTakePhoto} textStyle={styles.btnTakePhotoText} >
                            拍照
                        </Button>
                    </View>
                    ||
                    <View style={styles.noDataContainer}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.receive_no_orders}
                            style={styles.noDataImg} />
                        <Text style={styles.onDataText}>暂无货单</Text>
                        <View style={styles.btnTakePhotoGray}>
                            <View style={styles.imgContainer}>
                                <Image style={styles.photoImage}
                                    source={app.img.receive_camera} />
                                <Text style={styles.imgText}>拍照</Text>
                            </View>
                        </View>
                    </View>
                }
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    topContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:11,
        backgroundColor:'#f8f8f8',
    },
    topLeft: {
        width: 80,
        height:80,
        borderRadius: 10,
        marginLeft: 10,
    },
    topRight: {
        paddingLeft: 10,
        width:sr.w - 100,
    },
    topRightText: {
        paddingVertical:2,
        fontSize: 13,
        color:'#888888',
        maxWidth:300,
    },
    btnTakePhoto:{
        marginTop:38,
        height:35,
        width:150,
        borderRadius:4,
        backgroundColor:'#c61a29',
        justifyContent:'center',
        alignItems:'center',
        alignSelf:'center',
    },
    btnTakePhotoGray:{
        marginTop:38,
        height:35,
        width:150,
        borderRadius:4,
        backgroundColor:'#aaaaaa',
        justifyContent:'center',
        alignItems:'center',
        alignSelf:'center',
    },
    btnTakePhotoText:{
        color:'white',
        fontSize:16,
        fontWeight:'300',
    },
    noDataContainer:{
        justifyContent:'center',
        alignItems:'center',
    },
    noDataImg:{
        height:80,
        width:80.5,
        marginTop:50,
    },
    onDataText:{
        fontSize:21,
        fontWeight:'400',
        color:'#aaaaaa',
        marginTop:15,
    },
    photoImage:{
        height:14,
        width:15.5,
        marginRight:3,
    },
    imgContainer:{
        flexDirection:'row',
        justifyContent:'center',
        alignItems:'center',
    },
    imgText:{
        fontSize:16,
        fontWeight:'400',
        color:'#FFFFFF',
        marginLeft:3,
    },
});

```

* PDShop/project/App/modules/receiveDepartment/index.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

const UploadPhoto = require('./UploadPhoto');
const Orders = require('./Orders');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: UploadPhoto },
    { index: 1, component: Orders },
    { index: 2, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '拍照', icon:app.img.receive_take_picture, selected: app.img.receive_take_picture_press },
            { index: 1, title: '货单', icon: app.img.receive_order, selected: app.img.receive_order_press },
            { index: 2, title: '我的', icon: app.img.home_mine, selected: app.img.home_mine_press },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDShop/project/App/modules/login/ForgetPassword.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const PasswordConfirm = require('./PasswordConfirm');
const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '忘记密码',
    },
    getInitialState () {
        return {
            phone:'',
            readSecond:false,
            time:59,
            verifyCode:'',
            button: false,
        };
    },
    doPress () {
        const { phone } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        };
        const param = {
            phone,
        };
        POST(app.route.ROUTE_REQUEST_SEND_VERIFY_CODE, param, this.requestSendVerifyCodeSuccess, false);
    },
    timer () {
        this.setState({ readSecond:true });
        this.setTimeout(
            () => {
                this.setState({ time:(this.state.time - 1) });
                if (this.state.time <= 0) {
                    return this.setState({ readSecond:false, time:59 });
                }
                this.timer();
            },
            1000
        );
    },
    requestSendVerifyCodeSuccess (data) {
        if (data.success) {
            this.timer();
            this.setState({
                button: true,
            });
        } else {
            Toast(data.msg);
        }
    },
    doNext () {
        const { phone, verifyCode } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        };
        if (!verifyCode) {
            Toast('请填写验证码');
            return;
        }
        if (!app.utils.checkVerificationCode(verifyCode)) {
            Toast('请填写正确的验证码');
            return;
        }
        app.push({
            component:PasswordConfirm,
            passProps:{
                phone,
                verifyCode,
            },
        });
    },
    doInput () {
        Toast('请先获取验证码');
    },
    render () {
        const { readSecond, button } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.ItemBgTop}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_phone}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请填写手机号码'
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            maxLength={11}
                            onChangeText={(text) => this.setState({ phone: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请填写验证码'
                            keyboardType='numeric'
                            maxLength={6}
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ verifyCode: text })}
                            style={styles.itemNameText} />
                        <TouchableOpacity
                            disabled={readSecond}
                            onPress={this.doPress}
                            style={styles.btnBind}>
                            { !readSecond ?
                                <View style={styles.btnContainer}>
                                    <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>获取验证码</Text>
                                </View>
                                :
                                <View style={styles.btnContainerGray}>
                                    <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>{this.state.time}s后重新发送</Text>
                                </View>
                            }
                        </TouchableOpacity>
                    </View>
                </View>
                <Button onPress={button ? this.doNext : this.doInput}
                    style={styles.btnNext}
                    textStyle={styles.btnNextText} >
                    下一步
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBgTop: {
        height: 45,
        marginTop:10,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    ItemBg: {
        height: 45,
        marginTop:1,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent: 'space-between',
    },
    icon_add:{
        width:25,
        height:25,
        marginLeft: 8,
    },
    itemNameText: {
        flex:1,
        fontSize: 14,
        color: '#444444',
        marginLeft: 10,
    },

    btnNext:{
        marginTop:50,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnNextText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
    btnBind:{
        height:45,
        width:137,
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        alignItems:'center',
    },
    btnContainer:{
        height:45,
        alignItems:'center',
        justifyContent:'center',
        width:137,
    },
    btnBindText:{
        color:'#FF981A',
        fontSize:14,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
    },
    btnContainerGray:{
        height:45,
        width:137,
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#fafafa',
    },
    btnBindTextGray:{
        color:'#999999',
        backgroundColor:'#fafafa',
        fontSize:14,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
    },
});

```

* PDShop/project/App/modules/login/Login.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Image,
    View,
    TextInput,
    ListView,
    Text,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const ForgetPassword = require('./ForgetPassword');
const Register = require('./Register');
const Chairman = require('../chairman');
const WarehouseDepartment = require('../warehouseDepartment');
const ReceiveDepartment = require('../receiveDepartment');
const MovingDepartment = require('../movingDepartment');
const SecurityCheckDepartment = require('../securityCheckDepartment');
const ENTRY_HOME = [ ReceiveDepartment, WarehouseDepartment, MovingDepartment, SecurityCheckDepartment, Chairman ];

const WeixinQQPanel = React.createClass({
    render () {
        return (
            <View style={styles.thirdpartyContainer}>
                <View style={styles.sepratorContainer}>
                    <View style={styles.sepratorLine} />
                    <Text style={styles.sepratorText} >{app.isandroid ? '    ' : ''}或者您也可以</Text>
                </View>
                <View style={styles.thirdpartyButtonContainer}>
                    {
                        !!this.props.weixininstalled &&
                        <View style={styles.thirdpartyLeftButtonContainer}>
                            <Image
                                resizeMode='stretch'
                                source={app.img.login_weixin_button}
                                style={styles.image_button}
                                />
                            <Text style={styles.image_button_text}>微信登录</Text>
                        </View>
                    }
                    {
                        !!this.props.qqinstalled &&
                        <View style={styles.thirdpartyRightButtonContainer}>
                            <Image
                                resizeMode='stretch'
                                source={app.img.login_qq_button}
                                style={styles.image_button}
                                />
                            <Text style={styles.image_button_text}>QQ登录</Text>
                        </View>
                    }
                </View>
            </View>
        );
    },
});

const NoWeixinQQPanel = React.createClass({
    render () {
        return (
            <View style={styles.thirdpartyContainer2}>
                <Text style={[styles.thirdpartyContainer2_text, { color: app.setting.THEME_COLOR }]} />
            </View>
        );
    },
});

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '',
    },
    componentDidMount () {
        app.toggleNavigationBar(true);
    },
    doLogin () {
        const { phone, password } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('手机号码不是有效的手机号码');
            return;
        }
        if (!app.utils.checkPassword(password)) {
            Toast('密码必须有6-20位的数字，字母，下划线组成');
            return;
        }
        const param = {
            phone,
            password,
        };
        app.showLoading();
        POST(app.route.ROUTE_LOGIN, param, this.doLoginSuccess, this.doLoginError);
    },
    doLoginSuccess (data) {
        if (data.success) {
            app.personal.info.userId = data.context.userId;
            app.login.savePhone(this.state.phone);
            this.getPersonalInfo();
            this.getRemainAmount();
        } else {
            Toast(data.msg);
            app.hideLoading();
        }
    },
    getRemainAmount () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_REMAIN_AMOUNT, param, this.getRemainAmountSuccess, true);
    },
    getRemainAmountSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.setRemainAmount(context.amount);
        }
    },
    doLoginError (error) {
        app.hideLoading();
    },
    doShowForgetPassword () {
        app.push({
            component: ForgetPassword,
            passProps: {
                phone: this.state.phone,
            },
        });
    },
    doShowRegister () {
        app.push({
            component: Register,
            passProps: {
                phone: this.state.phone,
                changeToLoginPanel: this.changeToLoginPanel,
            },
        });
    },
    getPersonalInfo () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_PERSONAL_INFO, param, this.getPersonalInfoSuccess, this.getPersonalInfoError);
    },
    getPersonalInfoSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.set(context);
            app.navigator.replace({
                component: ENTRY_HOME[app.personal.info.partment ? app.personal.info.partment.type : 4],
            });
            app.personal.setNeedLogin(false);
        } else {
            Toast(data.msg);
        }
        app.hideLoading();
    },
    getPersonalInfoError (error) {
        app.hideLoading();
    },
    getInitialState () {
        const ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            phone: app.login.list[0] || '',
            password: '',
            dataSource: ds.cloneWithRows(app.login.list),
            showList: false,
            weixininstalled: false,
            qqinstalled: false,
        };
    },
    changeToLoginPanel (phone) {
        this.setState({ phone });
    },
    onPhoneTextInputLayout (e) {
        const frame = e.nativeEvent.layout;
        this.listTop = frame.y + frame.height;
    },
    renderRow (text) {
        return (
            <TouchableOpacity onPress={() => this.setState({ phone: text, showList:false })}>
                <View style={styles.itemTextContainer}>
                    <Text style={styles.itemText}>
                        {text}
                    </Text>
                </View>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={sectionID + rowID} />
        );
    },
    onFocus () {
        this.setState({ showList: this.state.dataSource.getRowCount() > 0 && this.state.dataSource.getRowData(0, 0).length < 11 });
    },
    onBlur () {
        this.setState({ showList: false });
    },
    onPhoneTextChange (text) {
        const dataSource = this.state.dataSource;
        const newData = _.filter(app.login.list, (item) => { const reg = new RegExp('^' + text + '.*'); return reg.test(item); });
        this.setState({
            phone: text,
            dataSource: dataSource.cloneWithRows(newData),
            showList: newData.length > 0 && text.length < 11,
        });
    },
    render () {
        const row = this.state.dataSource.getRowCount();
        const listHeight = row > 4 ? styles.listHeightMax : row < 2 ? styles.listHeightMin : null;
        return (
            <View style={styles.container}>
                <View style={styles.logoContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.login_logo}
                        style={styles.logo}
                        />
                </View>
                <View style={styles.loginBox}>
                    <View
                        style={styles.phoneContainer}
                        onLayout={this.onPhoneTextInputLayout}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.login_phone}
                            style={styles.input_icon} />
                        <TextInput
                            underlineColorAndroid='transparent'
                            placeholder='您的手机号码'
                            maxLength={11}
                            onChangeText={this.onPhoneTextChange}
                            defaultValue={this.state.phone}
                            style={styles.text_input}
                            keyboardType='phone-pad'
                            onFocus={this.onFocus}
                            onBlur={this.onBlur} />
                    </View>
                    <View style={styles.listView} />
                    <View style={styles.passwordContainer}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.login_password}
                            style={styles.input_icon} />
                        <TextInput
                            underlineColorAndroid='transparent'
                            placeholder='您的密码'
                            secureTextEntry
                            onChangeText={(text) => this.setState({ password: text })}
                            defaultValue={this.state.password}
                            style={styles.text_input}
                            />
                    </View>
                </View>

                <View style={styles.un_loading} >
                    <TouchableOpacity onPress={this.doShowForgetPassword}>
                        <Text style={styles.forgetPassword}>忘记密码</Text>
                    </TouchableOpacity>
                </View>

                <Button onPress={this.doLogin} style={styles.btnLogin} textStyle={styles.btnLoginText}>登录</Button>

                {this.state.qqinstalled || this.state.weixininstalled ? <WeixinQQPanel qqinstalled={this.state.qqinstalled} weixininstalled={this.state.weixininstalled} /> : <NoWeixinQQPanel />}
                {
                    this.state.showList &&
                    <ListView
                        initialListSize={1}
                        enableEmptySections
                        dataSource={this.state.dataSource}
                        keyboardShouldPersistTaps="always"
                        renderRow={this.renderRow}
                        renderSeparator={this.renderSeparator}
                        style={[styles.list, { top: this.listTop + 135 }, listHeight]}
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#ffffff',
    },
    logoContainer: {
        height: 120,
        justifyContent: 'center',
        alignItems: 'center',
        marginTop:18,
    },
    logo: {
        width: 85.5,
        height: 96,
    },
    listView:{
        height:1,
        width: 300,
        backgroundColor:'#dddddd',
    },
    loginBox:{
        marginLeft: (sr.w - 300) / 2,
        width: 300,
        height: 90,
        borderRadius:4,
        borderColor:'#dddddd',
        borderWidth:1,
        alignItems:'center',
        justifyContent:'center',
    },
    phoneContainer: {
        width: 300,
        height: 45,
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    passwordContainer:{
        width: 300,
        height: 45,
        flexDirection: 'row',
        alignItems:'center',
    },
    input_icon: {
        width: 28,
        height: 28,
        marginLeft: 10,
        marginRight: 10,
    },
    text_input: {
        height:40,
        width: 200,
        padding:0,
        fontSize:14,
        alignSelf: 'center',
    },
    un_loading:{
        flexDirection: 'row',
        justifyContent: 'space-between',
        marginTop:12,
    },
    register:{
        color:'#fd7b1b',
        marginLeft: (sr.w - 300) / 2,
    },
    forgetPassword:{
        color:'#f41728',
        marginLeft: (sr.w - 300) / 2,
    },
    btnLogin: {
        height: 46,
        width: 300,
        marginLeft: (sr.w - 300) / 2,
        marginTop: 60,
        backgroundColor: '#c81622',
        borderRadius:4,
    },
    btnLoginText: {
        fontSize: 18,
        fontWeight: '600',
        color: '#FFFFFF',
    },
    thirdpartyContainer: {
        flex:1,
    },
    sepratorContainer: {
        height: 30,
        alignItems:'center',
        justifyContent: 'center',
        marginTop: 50,
    },
    sepratorLine: {
        top: 10,
        height: 2,
        width: sr.w - 20,
        backgroundColor: '#858687',
    },
    sepratorText: {
        backgroundColor:'#EEEEEE',
        color: '#A3A3A4',
        paddingHorizontal: 10,
    },
    thirdpartyButtonContainer: {
        marginTop: 30,
        height: 120,
        flexDirection: 'row',
    },
    thirdpartyLeftButtonContainer: {
        flex:1,
        alignItems:'center',
    },
    thirdpartyRightButtonContainer: {
        flex:1,
        alignItems:'center',
    },
    image_button: {
        width: 80,
        height: 80,
        margin: 10,
    },
    image_button_text: {
        color: '#4C4D4E',
        fontSize: 16,
    },
    thirdpartyContainer2: {
        marginTop: 30,
        height: 200,
        alignItems:'center',
        justifyContent: 'flex-end',
    },
    thirdpartyContainer2_text: {
        fontSize: 18,
        marginBottom:60,
    },
    list: {
        position: 'absolute',
        backgroundColor: 'rgba(255, 255, 255, 0.6)',
        borderWidth: 1,
        borderRadius: 5,
        borderColor: '#D7D7D7',
        width: 150,
        left: 80,
        paddingLeft: 10,
    },
    listHeightMin: {
        height: 30,
    },
    listHeightMax: {
        height: 184,
    },
    itemTextContainer: {
        height: 30,
        justifyContent: 'center',
    },
    itemText: {
        fontSize: 16,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDShop/project/App/modules/login/PasswordConfirm.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Image,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '忘记密码',
    },
    getInitialState () {
        return {
            newPassword:'',
            rePassword:'',
        };
    },
    doPress () {
        const { newPassword, rePassword } = this.state;
        const { phone, verifyCode } = this.props;
        if (newPassword != rePassword) {
            Toast('两次输入密码不一致');
            return;
        }
        const param = {
            phone,
            verifyCode,
            password:newPassword,
        };
        POST(app.route.ROUTE_FIND_PASSWORD, param, this.findPasswordSuccess, false);
    },
    findPasswordSuccess (data) {
        if (data.success) {
            Toast('密码设置成功');
            app.navigator.popToTop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_password}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请输入新密码'
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ newPassword: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_password_check}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='确认新密码'
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ rePassword: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <Button onPress={this.doPress}
                    style={styles.btnSubmit}
                    textStyle={styles.btnSubmitText} >
                    确认修改
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBg: {
        height: 45,
        flexDirection: 'row',
        backgroundColor:'white',
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        height: 45,
    },
    icon_add:{
        width:25,
        height:25,
        marginLeft: 8,
    },
    itemNameText: {
        width: 300,
        fontSize:14,
        marginLeft:10,
        marginTop:5,
        padding:0,
    },
    btnSubmit:{
        marginTop:50,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnSubmitText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDShop/project/App/modules/login/Register.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Image,
    Text,
    View,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const TimerMixin = require('react-timer-mixin');
const { Button, WebviewMessageBox } = COMPONENTS;

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '手机注册',
    },
    doRegister () {
        const { protocalRead, phone, password, rePassword, verification } = this.state;
        if (!protocalRead) {
            Toast('注册前请先阅读用户协议');
            return;
        }
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        }
        if (!app.utils.checkVerificationCode(verification)) {
            Toast('请填写正确的验证码');
            return;
        }
        if (!app.utils.checkPassword(password)) {
            Toast('密码必须由 6-20 位的数字或，字母，下划线组成');
            return;
        }
        if (password !== rePassword) {
            Toast('两次输入的密码不一致');
            return;
        }
        // if (!app.utils.checkMailAddress(email)) {
        //     Toast('邮箱地址不规范，请重新输入');
        //     return;
        // }
        const param = {
            phone,
            verification,
            password,
        };
        POST(app.route.ROUTE_REGISTER, param, this.doRegisterSuccess, true);
    },
    doRegisterSuccess (data) {
        if (data.success) {
            Toast('注册成功');
            this.props.changeToLoginPanel(this.state.phone);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    doShowProtocal () {
        app.showModal(
            <WebviewMessageBox webAddress={app.route.ROUTE_USER_LICENSE} title={CONSTANTS.APP_NAME + '用户协议'} />
        );
    },
    getInitialState () {
        return {
            phone: '',
            password: '',
            rePassword: '',
            verification: '',
            protocalRead: true,
            overlayShow:false,
        };
    },
    changeProtocalState () {
        this.setState({ protocalRead: !this.state.protocalRead });
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={[styles.phoneContainer, { marginTop:10 }]}>
                    <Image
                        source={app.img.login_phone}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='手机号'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ phone: text })}
                        style={styles.text_input}
                        keyboardType='phone-pad'
                        />
                </View>
                <View style={styles.verification}>
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请填写验证码'
                        keyboardType='phone-pad'
                        maxLength={CONSTANTS.VERIFICATION_MAX_LENGTH}
                        onChangeText={(text) => this.setState({ verification: text })}
                        style={styles.text_input2}
                        />
                    <TouchableOpacity>
                        <Text style={styles.text_verification}>获取验证码</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.phoneContainer}>
                    <Image
                        source={app.img.login_password}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请输入密码'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ password: text })}
                        style={styles.text_input}
                        />
                </View>
                <View style={styles.phoneContainer}>
                    <Image
                        source={app.img.login_password_check}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请再次输入密码'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ rePassword: text })}
                        style={styles.text_input}
                        />
                </View>
                <View style={styles.agreement}>
                    <TouchableOpacity onPress={this.changeProtocalState}>
                        <Image
                            resizeMode='cover'
                            source={this.state.protocalRead ? app.img.order_choose_r : app.img.order_no_choose_r}
                            style={styles.protocal_icon}
                            />
                    </TouchableOpacity>
                    <Text style={styles.protocal_text}>  我已阅读并同意 </Text>
                    <Button onPress={this.doShowProtocal}
                        style={styles.protocal_button}
                        textStyle={styles.protocal_button_text}>
                        {'《四面通物流超市协议》'}
                    </Button>
                </View>
                <Button onPress={this.doRegister} style={styles.btnRegister} textStyle={styles.btnRegisterText}>注  册</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    phoneContainer:{
        height:45,
        flexDirection: 'row',
        alignItems:'center',
        borderBottomWidth:1,
        borderColor:'#f9f9f9',
        backgroundColor:'#FFFFFF',
    },
    text_phone_header: {
        height:20,
        width:16,
        marginLeft:12,
    },
    verification:{
        height:45,
        flexDirection: 'row',
        justifyContent: 'space-between',
        backgroundColor:'#FFFFFF',
        borderBottomWidth:1,
        borderColor:'#f9f9f9',
        alignItems:'center',
    },
    text_verification:{
        color:'#f99000',
        fontSize:15,
        marginRight:20,
    },
    text_input: {
        marginLeft:14,
        fontSize:15,
        height:40,
        width: 180,
        alignSelf: 'center',
    },
    text_input2: {
        marginLeft: 12,
        fontSize:15,
        height: 40,
        width: 220,
        alignSelf: 'center',
    },

    btnRegister: {
        height: 46,
        width: sr.w - 100,
        marginLeft: 50,
        marginTop: 35,
        borderRadius: 4,
        backgroundColor: '#c81622',
    },
    btnRegisterText: {
        fontSize: 20,
        fontWeight: '600',
        color: '#FFFFFF',
    },
    protocal_icon: {
        height: 15,
        width: 15,
        marginRight: 10,
    },
    protocal_text: {
        fontSize: 13,
    },
    agreement:{
        flexDirection: 'row',
        height:20,
        alignItems:'center',
        marginLeft:13,
        marginTop:10,
    },
    protocal_button: {
        height: 18,
        backgroundColor:'#f4f4f4',
    },
    protocal_button_text: {
        fontSize: 13,
        color: '#c81622',
        fontWeight:'400',
    },
});

```

* PDShop/project/App/modules/securityCheckDepartment/CheckPass.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    Text,
    TouchableOpacity,
} = ReactNative;

const ScanResult = require('./ScanResult');
const ScanBarCode = require('../common/ScanBarCode');

module.exports = React.createClass({
    statics: {
        title: '扫描安检',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '扫描安检';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    scanBarCode () {
        app.showModal(
            <ScanBarCode onBarCodeRead={this.onBarCodeRead} />
        );
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_DRIVER) { // type==2代表司机二维码
            Toast('无效的二维码');
        } else {
            app.push({
                component:ScanResult,
                passProps:{
                    driverId:data.id,
                },
            });
        }
    },
    getInitialState () {
        return {
            context: {},
        };
    },
    render () {
        return (
            <View style={styles.container}>
                <View>
                    <Image source={app.img.security_scan_check_pass}
                        style={styles.imgScanCode}
                        resizeMode='contain' />
                    <TouchableOpacity style={styles.btnScan} onPress={this.scanBarCode}>
                        <Image source={app.img.storage_scan}
                            style={styles.imgscan}
                            resizeMode='contain' />
                        <Text style={styles.scanFont}>扫一扫</Text>
                    </TouchableOpacity>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    imgScanCode:{
        width:sr.w - 205,
        marginLeft:205 / 2,
        height:sr.h - 475,
        marginTop:sr.h - 620,
    },
    btnScan:{
        marginTop:90,
        flexDirection:'row',
        width:sr.w - 225,
        marginLeft:225 / 2,
        height:35,
        backgroundColor:'#c61a29',
        alignItems:'center',
        justifyContent:'center',
        borderRadius:4,
    },
    imgscan:{
        width:14,
        height:14,
    },
    scanFont:{
        color:'#ffffff',
        marginLeft:5,
        fontWeight:'500',
    },
});

```

* PDShop/project/App/modules/securityCheckDepartment/ScanResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { DImage } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '扫描结果',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '扫描结果';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    getInitialState () {
        return {
            context:null,
            tip:'',
        };
    },
    componentWillMount () {
        this.checkTruckPass();
    },
    checkTruckPass () {
        const param = {
            userId: app.personal.info.userId,
            driverId:this.props.driverId,
        };
        POST(app.route.ROUTE_CHECK_TRUCK_PASS, param, this.checkTruckPassSuccess, true);
    },
    checkTruckPassSuccess (data) {
        if (data.success) {
            this.setState({ context:data.context });
        } else {
            this.setState({ context:null, tip:data.msg });
        }
    },
    render () {
        const { context, tip } = this.state;
        return (
            <View style={styles.container}>
                {
                    !context ?
                        <Text style={styles.tipCenter}>{tip}</Text>
                    :
                        <View style={styles.driverInfo}>
                            <View style={styles.top}>
                                <Text style={styles.topLeft}>驾驶信息</Text>
                                <Text style={styles.topRight}>{context && context.isEnter ? '入库' : '出库'}</Text>
                            </View>
                            <DImage
                                resizeMode='cover'
                                defaultSource={app.img.personal_default_head}
                                source={{ uri: context.driver.head }}
                                style={styles.headStyle} />
                            <Text style={styles.textCenterName}>{context && context.driver && context.driver.name}</Text>
                            <Text style={styles.textCenter}>驾驶证：{context && context.driver && context.driver.licenseNo}</Text>
                            <Text style={styles.textCenter}>车牌{context && context.plateNo}</Text>
                        </View>

                }

            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    driverInfo: {
        height:220,
        marginTop:10,
        backgroundColor:'white',
    },
    top: {
        flexDirection:'row',
        justifyContent:'space-between',
        padding:10,
    },
    topLeft: {
        fontSize:16,
        color:'#333333',
    },
    topRight: {
        fontSize:16,
        color:'#c81622',
    },
    headStyle: {
        width: 87,
        height: 87,
        borderRadius: 43.5,
        alignSelf:'center',
    },
    textCenterName: {
        alignSelf:'center',
        fontSize:16,
        paddingVertical:5,
        color:'#333333',
    },
    tipCenter: {
        alignSelf:'center',
        fontSize:16,
        color:'#888888',
    },
    textCenter: {
        alignSelf:'center',
        fontSize:16,
        paddingVertical:5,
        color:'#888888',
    },
});

```

* PDShop/project/App/modules/securityCheckDepartment/index.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

const CheckPass = require('./CheckPass');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: CheckPass },
    { index: 1, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '安检', icon:app.img.home_pre_order, selected: app.img.home_pre_order_press },
            { index: 1, title: '我的', icon: app.img.home_mine, selected: app.img.home_mine_press },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDShop/project/App/modules/splash/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
} = ReactNative;

import Swiper from 'react-native-swiper';
const TimerMixin = require('react-timer-mixin');
const SplashScreen = require('@remobile/react-native-splashscreen');
const Login = require('../login/Login');
const Chairman = require('../chairman');
const WarehouseDepartment = require('../warehouseDepartment');
const ReceiveDepartment = require('../receiveDepartment');
const MovingDepartment = require('../movingDepartment');
const SecurityCheckDepartment = require('../securityCheckDepartment');
const ENTRY_HOME = [ ReceiveDepartment, WarehouseDepartment, MovingDepartment, SecurityCheckDepartment, Chairman ];
module.exports = React.createClass({
    mixins: [ TimerMixin ],
    getInitialState () {
        return {
            renderSplashType: 0,
        };
    },
    doGetPersonalInfo () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_PERSONAL_INFO, param, this.getPersonalInfoSuccess, this.getInfoError);
    },
    getPersonalInfoSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.set(context);
            this.changeToHomePage();
            app.personal.setNeedLogin(false);
        } else {
            this.getInfoError();
        }
    },
    getInfoError () {
        app.personal.setNeedLogin(true);
        this.changeToLoginPage();
    },
    enterLoginPage (needHideSplashScreen) {
        app.navigator.replace({
            component: Login,
        });
        needHideSplashScreen && SplashScreen.hide();
    },
    changeToLoginPage () {
        if (app.updateMgr.needShowSplash) {
            this.setState({ renderSplashType: 0 }, () => {
                SplashScreen.hide();
            });
        } else {
            this.setState({ renderSplashType: 1 }, () => {
                this.enterLoginPage(true);
            });
        }
    },
    enterHomePage (needHideSplashScreen) {
        app.navigator.replace({
            component: ENTRY_HOME[app.personal.info.partment ? app.personal.info.partment.type : 4],
        });
        needHideSplashScreen && SplashScreen.hide();
    },
    changeToHomePage () {
        if (app.updateMgr.needShowSplash) {
            this.setState({ renderSplashType: 0 }, () => {
                SplashScreen.hide();
            });
        } else {
            this.setState({ renderSplashType: 2 }, () => {
                this.enterHomePage(true);
            });
        }
    },
    enterNextPage () {
        app.updateMgr.setNeedShowSplash(false);
        if (this.state.renderSplashType === 0) {
            app.personal.setNeedLogin(true);
            this.setState({ renderSplashType: 1 }, () => {
                this.enterLoginPage();
            });
        } else {
            this.setState({ renderSplashType: 2 }, () => {
                this.enterHomePage();
            });
        }
    },
    changeToNextPage () {
        if (app.personal.needLogin) {
            app.personal.setNeedLogin(true);
            this.changeToLoginPage();
        } else {
            this.doGetPersonalInfo();
        }
    },
    componentDidMount () {
        app.utils.until(
            () => app.personal.initialized && app.updateMgr.initialized && app.navigator,
            (cb) => setTimeout(cb, 100),
            () => this.changeToNextPage()
        );
    },
    componentWillUnmount () {
        app.updateMgr.checkUpdate();
    },
    onLayout (e) {
        const { height } = e.nativeEvent.layout;
        if (this.state.height !== height) {
            this.heightHasChange = !!this.state.height;
            this.setState({ height });
        }
    },
    renderSwiperSplash () {
        const { height } = this.state;
        const marginBottom = (!this.heightHasChange || Math.floor(height) === Math.floor(sr.th)) ? 0 : 30;
        return (
            <View style={{ flex: 1 }} onLayout={this.onLayout}>
                {
                    height &&
                    <Swiper
                        paginationStyle={styles.paginationStyle}
                        dot={<View style={{ backgroundColor:'#87E5D6', width: 8, height: 8, borderRadius: 4, marginLeft: 12, marginRight: 12, marginBottom }} />}
                        activeDot={<View style={{ backgroundColor:'#1A7AE9', width: 18, height: 9, borderRadius: 6, marginLeft: 7, marginRight: 7, marginBottom }} />}
                        height={height}
                        loop={false}>
                        {
                            [1, 2, 3].map((i) => {
                                return (
                                    <Image
                                        key={i}
                                        resizeMode='stretch'
                                        source={app.img['splash_splash' + i]}
                                        style={[styles.bannerImage, { height }]}>
                                        {
                                            i === 3 &&
                                            <TouchableOpacity
                                                style={styles.enterButtonContainer}
                                                onPress={this.enterNextPage}>
                                                <Image resizeMode='stretch' style={styles.enterButton} source={app.img.splash_start} />
                                            </TouchableOpacity>
                                        }
                                    </Image>
                                );
                            })
                        }
                    </Swiper>
                }
            </View>
        );
    },
    render () {
        return this.state.renderSplashType != 0 ? <Image style={{ width:sr.w, height:sr.h }} source={app.img.splash_splash1} /> : this.renderSwiperSplash();
    },
});

const styles = StyleSheet.create({
    paginationStyle: {
        bottom: 30,
    },
    bannerImage: {
        width: sr.w,
    },
    enterButtonContainer: {
        position: 'absolute',
        width: 165,
        height: 40,
        left: (sr.w - 165) / 2,
        bottom: 80,
        alignItems:'center',
        justifyContent: 'center',
    },
    enterButton: {
        width: 140,
        height: 36,
    },
});

```

* PDShop/project/App/modules/test/Echarts.js

```js
'use strict';

var React = require('react');
var ReactNative = require('react-native');
var {
    Image,
    StyleSheet,
    Text,
    View,
    TouchableOpacity,
    TouchableHighlight,
    ScrollView,
    WebView,
} = ReactNative;

var { Button } = COMPONENTS;
var Circle = require('../common/Circle.js');
var Line = require('../common/Line.js');
var Pie = require('../common/Pie.js');
var Bar = require('../common/Bar.js');
const CHILD_ITEM = [
    '环形图',
    '折线图',
    '饼状图',
    '柱状图',
];

module.exports = React.createClass({
    statics: {
        title: CONSTANTS.APP_NAME,
    },
    getInitialState () {
        return {
            currentIndex: 0,
        };
    },
    onPress (index) {
        this.setState({ currentIndex: index });
    },
    headItem (itemStr, i) {
        return (
            <TouchableOpacity
                onPress={this.onPress.bind(null, i)}
                style={styles.itemView}>
                <Text style={this.state.currentIndex === i ? styles.selectText : styles.text}>
                    {itemStr}
                </Text>
                {this.state.currentIndex === i && <View style={styles.lineView} />}
            </TouchableOpacity>
        );
    },
    headView () {
        return (
            <View style={styles.textView}>
                {this.headItem(CHILD_ITEM[0], 0)}
                {this.headItem(CHILD_ITEM[1], 1)}
                {this.headItem(CHILD_ITEM[2], 2)}
                {this.headItem(CHILD_ITEM[3], 3)}
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <this.headView />
                {
                    this.state.currentIndex === 0 &&
                    <Circle
                        style={styles.containerWebView}
                        source={{ uri:'http://www.baidu.com' }}
                        scalesPageToFit
                        />
                }
                {
                    this.state.currentIndex === 1 &&
                    <Line
                        style={styles.containerWebView}
                        source={{ uri:'http://www.sohu.com' }}
                        scalesPageToFit
                        />
                }
                {
                    this.state.currentIndex === 2 &&
                    <Pie
                        style={styles.containerWebView}
                        source={{ uri:'http://www.sina.com' }}
                        scalesPageToFit
                        />
                }
                {
                    this.state.currentIndex === 3 &&
                    <Bar
                        style={styles.containerWebView}
                        source={{ uri:'http://www.hao123.com' }}
                        scalesPageToFit
                        />
                }
            </View>
        );
    },
});

var styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#E6EBEC',
    },
    containerWebView: {
        width: sr.w,
        height: sr.h - 45,
    },
    textView: {
        marginTop: 80,
        height: 45,
        flexDirection: 'row',
    },
    itemView: {
        width: sr.w / 4,
        height: 43,
    },
    lineView: {
        marginTop: 10,
        height: 2,
        backgroundColor: '#34a9b1',
    },
    selectText: {
        fontSize: 14,
        color: '#34a9b1',
        alignSelf: 'center',
    },
    text: {
        fontSize: 14,
        color: '#666666',
        alignSelf: 'center',
    },
    blankView: {
        width: sr.w,
        height: 30,
    },
    ItemBg: {
        marginTop: 1,
        padding: 10,
        height: 45,
        flexDirection: 'row',
        backgroundColor: '#FFFFFF',
        alignItems: 'center',
        justifyContent: 'space-between',
    },
    icon_go: {
        width: 8,
        height: 15,
    },
    infoStyle: {
        flex: 3,
        flexDirection: 'row',
        alignSelf: 'flex-start',
        alignItems: 'center',
    },
    icon_item: {
        width: 25,
        height: 25,
    },
    itemNameText: {
        fontSize: 15,
        color: 'gray',
        alignSelf: 'center',
        marginLeft: 10,
    },
});

```

* PDShop/project/App/modules/test/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    FlatList,
    Button,
} = ReactNative;

const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    getInitialState () {
        return {
            list: [1, 2, 3, 4, 5, 6, 7, 8],
        };
    },
    componentWillMount () {
        SplashScreen.hide();
    },
    renderItem ({ item, separators }) {
        console.log('========', separators);
        return (
            <View style={styles.row}>
                <Text>
                    {item}
                </Text>
            </View>
        );
    },
    onPress () {
        this.setState({ list: [2, 3, 4, 5] });
    },
    render () {
        return (
            <View style={styles.container}>
                <Button title='click' onPress={this.onPress} />
                <FlatList
                    data={this.state.list}
                    extraData={this.state}
                    renderItem={this.renderItem}
                    refreshing={false}
                    initialNumToRender={4}
                    ListHeaderComponent={<Text>'这是头'</Text>}
                    ListFooterComponent={<Text>'这是尾'</Text>}
                    ListEmptyComponent={<Text>'没有数据'</Text>}
                    ItemSeparatorComponent={() => <View style={styles.separator} />}
                    onRefresh={() => { console.log('========'); }}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop: 60,
    },
    row: {
        height: 80,
        justifyContent: 'center',
        alignItems: 'center',
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDShop/project/App/modules/test/pageList.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    getInitialState () {
        return {
            list: [1, 2, 3, 4, 5, 6, 7, 8],
        };
    },
    componentWillMount () {
        SplashScreen.hide();
    },
    renderRow (obj) {
        return (
            <View style={styles.row}>
                <Text>
                    {obj}
                </Text>
            </View>
        );
    },
    onPress () {
        this.setState({ list: [2, 3, 4, 5] });
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'testList'}
                    listUrl='http://localhost:4000/getList'
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop: 60,
    },
    row: {
        height: 80,
        justifyContent: 'center',
        alignItems: 'center',
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDShop/project/App/modules/update/UpdateInfoBox.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const Update = require('@remobile/react-native-update');

const
    STATUS_HAS_VEW_VERSION = 0,
    STATUS_DOWNLOAD_APK_PROGESS = 1,
    STATUS_DOWNLOAD_JS_PROGESS = 2,
    STATUS_UNZIP_JS_PROGESS = 3,
    STATUS_DOWNKOAD_APK_ERROR = 4,
    STATUS_DOWNKOAD_JS_ERROR = 5,
    STATUS_UNZIP_JS_ERROR = 6,
    STATUS_FAILED_INSTALL_ERROR = 7,
    STATUS_UPDATE_END = 8;

const
    ERROR_DOWNKOAD_APK = 1,
    ERROR_DOWNKOAD_JS = 2,
    ERROR_FAILED_INSTALL = 3,
    ERROR_UNZIP_JS = 4;

const PROGRESS_WIDTH = sr.tw * 0.7;
const { ProgressBar } = COMPONENTS;

const ProgressInfo = React.createClass({
    render () {
        const { progress } = this.props;
        if (progress < 1000) {
            return (
                <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                    <Text>{this.props.title} [{progress}%]</Text>
                    <ProgressBar
                        fillStyle={{}}
                        backgroundStyle={{ backgroundColor: '#cccccc', borderRadius: 2 }}
                        style={{ marginTop: 10, width:PROGRESS_WIDTH }}
                        progress={progress / 100.0}
                        />
                    <View style={styles.progressText}>
                        <Text>0</Text>
                        <Text>100</Text>
                    </View>
                </View>
            );
        } else {
            const size = progress / 1000 / 1024 / 1024;
            return (
                <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                    <Text>{this.props.title} [ {size.toFixed(2)} M ]</Text>
                </View>
            );
        }
    },
});

module.exports = React.createClass({
    getInitialState () {
        return {
            status:STATUS_HAS_VEW_VERSION,
            progress: 0,
        };
    },
    onError (errCode) {
        if (errCode == ERROR_DOWNKOAD_APK) {
            this.setState({ status: STATUS_DOWNKOAD_APK_ERROR });
        } else if (errCode == ERROR_DOWNKOAD_JS) {
            this.setState({ status: STATUS_DOWNKOAD_JS_ERROR });
        } else if (errCode == ERROR_FAILED_INSTALL) {
            this.setState({ status: STATUS_FAILED_INSTALL_ERROR });
        } else if (errCode == ERROR_UNZIP_JS) {
            this.setState({ status: STATUS_UNZIP_JS_ERROR });
        }
    },
    doUpdate () {
        const { jsVersionCode, trackViewUrl } = this.props.options;
        if (jsVersionCode !== undefined) {
            Update.updateJS({
                jsVersionCode,
                jsbundleUrl: app.isandroid ? app.route.ROUTE_JS_ANDROID_URL : app.route.ROUTE_JS_IOS_URL,
                onDownloadJSProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_JS_PROGESS, progress }); },
                onUnzipJSProgress:(progress) => { this.setState({ status: STATUS_UNZIP_JS_PROGESS, progress }); },
                onUnzipJSEnd:() => { this.setState({ status: STATUS_UPDATE_END }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        } else {
            Update.updateApp({
                trackViewUrl,
                androidApkUrl:app.route.ROUTE_APK_URL,
                androidApkDownloadDestPath:'/sdcard/pdshop.apk',
                onDownloadAPKProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_APK_PROGESS, progress }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        }
    },
    render () {
        const components = {};
        const { newVersion, description } = this.props.options;
        components[STATUS_HAS_VEW_VERSION] = (
            <View style={styles.functionContainer}>
                <Text style={styles.title}>{`发现新版本(${newVersion})`}</Text>
                <Text style={styles.redLine} />
                <Text style={styles.content}>
                    {'更新内容：'}
                </Text>
                {
                    description.map((item, i) => {
                        return (
                            <Text style={styles.contentItem} key={i}>{'- ' + item}</Text>
                        );
                    })
                }
                <View style={styles.buttonViewStyle}>
                    <TouchableOpacity
                        onPress={app.closeModal}
                        style={styles.buttonStyleContainCannel}>
                        <Text style={styles.buttonStyleCannel}>以后再说</Text>
                    </TouchableOpacity>
                    <TouchableOpacity
                        onPress={this.doUpdate}
                        style={styles.buttonStyleContain}>
                        <Text style={styles.buttonStyle} >立即更新</Text>
                    </TouchableOpacity>
                </View>
            </View>
        );
        components[STATUS_DOWNKOAD_APK_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>下载apk文件失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_DOWNKOAD_JS_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>下载js bundle失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_UNZIP_JS_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>解压js bundle失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_FAILED_INSTALL_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>你放弃了安装</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_DOWNLOAD_APK_PROGESS] = (
            <ProgressInfo
                title='正在下载APK'
                progress={this.state.progress} />
        );
        components[STATUS_DOWNLOAD_JS_PROGESS] = (
            <ProgressInfo
                title='正在下载Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UNZIP_JS_PROGESS] = (
            <ProgressInfo
                title='正在解压Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UPDATE_END] = (
            <Text>即将重启...</Text>
        );
        return (
            <View style={styles.container}>
                {components[this.state.status]}
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    functionContainer: {
        width:sr.w - 60,
        backgroundColor:'#FFFFFF',
    },
    progressText: {
        flexDirection:'row',
        justifyContent:'space-between',
        width: sr.w * 0.7,
    },
    textInfo: {
        color: '#000000',
        fontSize: 14,
        marginBottom: 20,
        textAlign: 'center',
    },
    buttonViewStyle: {
        flexDirection: 'row',
        width: sr.w - 40,
        height: 60,
        justifyContent: 'center',
    },
    redLine: {
        marginTop: 15,
        width: sr.w - 60,
        height: 1,
        backgroundColor: '#2F4F4F',
    },
    buttonStyleContain: {
        width: 120,
        height: 35,
        marginLeft: 30,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor: '#2F4F4F',
    },
    buttonStyleContainCannel: {
        width: 120,
        height: 35,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor: 'white',
        borderWidth: 1,
        borderColor: '#2F4F4F',
    },
    buttonStyle: {
        fontSize: 16,
        color: 'white',
        fontFamily: 'STHeitiSC-Medium',
    },
    buttonStyleCannel: {
        fontSize: 16,
        color: '#2F4F4F',
        fontFamily: 'STHeitiSC-Medium',
    },
    title: {
        color: '#2F4F4F',
        fontSize: 18,
        textAlign: 'center',
        overflow: 'hidden',
        marginTop: 15,
        fontFamily: 'STHeitiSC-Medium',
    },
    content: {
        color:'#000000',
        marginTop: 10,
        marginBottom: 10,
        marginHorizontal: 20,
        fontSize:16,
        fontFamily: 'STHeitiSC-Medium',
    },
    contentItem: {
        color:'#000000',
        marginBottom: 10,
        marginHorizontal: 20,
        fontSize:12,
    },
});

```

* PDShop/project/App/modules/update/UpdatePage.js

```js
'use strict';
const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

const Update = require('@remobile/react-native-update');

const
    STATUS_GET_VERSION = 0,
    STATUS_HAS_VEW_VERSION = 1,
    STATUS_HAS_NOT_VEW_VERSION = 2,
    STATUS_DOWNLOAD_APK_PROGESS = 3,
    STATUS_DOWNLOAD_JS_PROGESS = 4,
    STATUS_UNZIP_JS_PROGESS = 5,
    STATUS_GET_VERSION_ERROR = 6,
    STATUS_DOWNKOAD_APK_ERROR = 7,
    STATUS_DOWNKOAD_JS_ERROR = 8,
    STATUS_UNZIP_JS_ERROR = 9,
    STATUS_FAILED_INSTALL_ERROR = 10,
    STATUS_UPDATE_END = 11;

const
    ERROR_DOWNKOAD_APK = 1,
    ERROR_DOWNKOAD_JS = 2,
    ERROR_FAILED_INSTALL = 3,
    ERROR_UNZIP_JS = 4;

const PROGRESS_WIDTH = sr.tw * 0.7;
const { Button, ProgressBar } = COMPONENTS;

const ProgressInfo = React.createClass({
    render () {
        const { progress } = this.props;
        if (progress < 1000) {
            return (
                <View>
                    <Text>{this.props.title} [{progress}%]</Text>
                    <ProgressBar
                        fillStyle={{}}
                        backgroundStyle={{ backgroundColor: '#cccccc', borderRadius: 2 }}
                        style={{ marginTop: 10, width:PROGRESS_WIDTH }}
                        progress={progress / 100.0}
                        />
                    <View style={styles.progressText}>
                        <Text>0</Text>
                        <Text>100</Text>
                    </View>
                </View>
            );
        } else {
            const size = progress / 1000 / 1024 / 1024;
            return (
                <View style={{ flex: 1, alignItems: 'center' }}>
                    <Text>{this.props.title} [{size.toFixed(2)} M]</Text>
                </View>
            );
        }
    },
});

module.exports = React.createClass({
    statics: {
        title: '在线更新',
    },
    pageName: 'UpdatePage',
    getInitialState () {
        const { options } = this.props;
        return {
            options,
            status: !options ? STATUS_GET_VERSION : options.newVersion ? STATUS_HAS_VEW_VERSION : STATUS_HAS_NOT_VEW_VERSION,
            progress: 0,
        };
    },
    componentWillMount () {
        if (!this.state.options) {
            Update.checkVersion({
                versionUrl: app.route.ROUTE_VERSION_INFO_URL,
                iosAppId: CONSTANTS.IOS_APPID,
            }).then((options) => {
                this.setState({ options, status: !options ? STATUS_GET_VERSION_ERROR : options.newVersion ? STATUS_HAS_VEW_VERSION : STATUS_HAS_NOT_VEW_VERSION });
            });
        }
    },
    onError (errCode) {
        if (errCode == ERROR_DOWNKOAD_APK) {
            this.setState({ status: STATUS_DOWNKOAD_APK_ERROR });
        } else if (errCode == ERROR_DOWNKOAD_JS) {
            this.setState({ status: STATUS_DOWNKOAD_JS_ERROR });
        } else if (errCode == ERROR_FAILED_INSTALL) {
            this.setState({ status: STATUS_FAILED_INSTALL_ERROR });
        } else if (errCode == ERROR_UNZIP_JS) {
            this.setState({ status: STATUS_UNZIP_JS_ERROR });
        }
    },
    doUpdate () {
        const { jsVersionCode, trackViewUrl } = this.state.options;
        if (jsVersionCode !== undefined) {
            Update.updateJS({
                jsVersionCode,
                jsbundleUrl: app.isandroid ? app.route.ROUTE_JS_ANDROID_URL : app.route.ROUTE_JS_IOS_URL,
                onDownloadJSProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_JS_PROGESS, progress }); },
                onUnzipJSProgress:(progress) => { this.setState({ status: STATUS_UNZIP_JS_PROGESS, progress }); },
                onUnzipJSEnd:() => { this.setState({ status: STATUS_UPDATE_END }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        } else {
            Update.updateApp({
                trackViewUrl,
                androidApkUrl:app.route.ROUTE_APK_URL,
                androidApkDownloadDestPath:'/sdcard/pdshop.apk',
                onDownloadAPKProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_APK_PROGESS, progress }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        }
    },
    render () {
        const components = {};
        const { APP_NAME } = CONSTANTS;
        const { currentVersion, newVersion, description } = this.state.options || { currentVersion:Update.getVersion() };
        components[STATUS_GET_VERSION] = (
            <Text style={styles.textInfo}>正在获取版本号</Text>
        );
        components[STATUS_HAS_NOT_VEW_VERSION] = (
            <Text style={styles.textInfo}>当前版本已经是最新版本</Text>
        );
        components[STATUS_GET_VERSION_ERROR] = (
            <Text style={styles.textInfo}>获取版本信息失败，请稍后再试</Text>
        );
        components[STATUS_DOWNKOAD_APK_ERROR] = (
            <Text style={styles.textInfo}>下载apk文件失败，请稍后再试</Text>
        );
        components[STATUS_DOWNKOAD_JS_ERROR] = (
            <Text style={styles.textInfo}>下载js bundle失败，请稍后再试</Text>
        );
        components[STATUS_UNZIP_JS_ERROR] = (
            <Text style={styles.textInfo}>解压js bundle失败，请稍后再试</Text>
        );
        components[STATUS_FAILED_INSTALL_ERROR] = (
            <Text style={styles.textInfo}>你放弃了安装</Text>
        );
        components[STATUS_HAS_VEW_VERSION] = (
            <View style={styles.textInfoContainer}>
                <Text style={styles.textInfo}>发现新版本{newVersion}</Text>
                <View style={styles.descriptionContainer}>
                    {
                        description && description.map((item, i) => {
                            return (
                                <Text style={styles.textInfo} key={i}>{(i + 1) + '. ' + item}</Text>
                            );
                        })
                    }
                </View>
                <Button onPress={this.doUpdate} style={styles.button_layer} textStyle={styles.button_text}>立即更新</Button>
            </View>
        );
        components[STATUS_DOWNLOAD_APK_PROGESS] = (
            <ProgressInfo
                title='正在下载APK'
                progress={this.state.progress} />
        );
        components[STATUS_DOWNLOAD_JS_PROGESS] = (
            <ProgressInfo
                title='正在下载Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UNZIP_JS_PROGESS] = (
            <ProgressInfo
                title='正在解压Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UPDATE_END] = (
            <Text>正在重启...</Text>
        );
        return (
            <View style={styles.container}>
                <View style={styles.logoContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.personal_logo}
                        style={styles.logo}
                        />
                    <Text style={styles.app_name}>{APP_NAME + 'V' + currentVersion}</Text>
                </View>
                <View style={styles.functionContainer}>
                    {components[this.state.status]}
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
    },
    logoContainer: {
        alignItems:'center',
        marginTop: 52,
    },
    logo: {
        width: 83,
        height: 83,
    },
    app_name: {
        marginTop: 13,
        fontSize: 16,
        color: '#727272',
    },
    functionContainer: {
        flex: 1,
        width: sr.w,
        marginTop: 51,
        alignItems:'center',
    },
    button_layer: {
        width:178,
        height:49,
        borderRadius: 4,
        left: (sr.w - 178) / 2,
        position: 'absolute',
        bottom: 120,
        backgroundColor: '#DE3031',
    },
    button_text: {
        fontSize: 18,
        fontWeight: '400',
        color: '#FFFFFF',
        alignSelf: 'center',
        fontFamily: 'STHeitiSC-Medium',
    },
    progressText: {
        flexDirection:'row',
        justifyContent:'space-between',
        width: sr.w * 0.7,
    },
    textInfoContainer: {
        flex: 1,
        width: sr.w,
    },
    textInfo: {
        color: '#000000',
        fontSize: 18,
        marginBottom: 6,
        textAlign: 'center',
    },
});

```

* PDShop/project/App/modules/warehouseDepartment/Order.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const WarehouseOrderList = require('./OrderList');

module.exports = React.createClass({
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    onWillFocus () {
        app.getCurrentRoute().title = '货单';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    componentDidMount () {
        this.getOrders();
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    getOrders () {
        const param = {
            userId: app.personal.info.userId,
            type:'',
            pageNo:0,
            pageSize:3,
        };
        POST(app.route.ROUTE_GET_ORDERS_BY_WAREHOUSE_PARTMENT, param, this.getOrdersSuccess, false);
    },
    getOrdersSuccess (data) {
        if (data.success) {
            this.setState({ context:data.context });
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const menus = [{ name:'已入库', type: 'stored' }, { name:'已出库', type: 'loaded' }];
        const { tabIndex, context } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item.name}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <WarehouseOrderList key={i} index={i} type={item.type} tabIndex={tabIndex} data={context && context[item.type]} listUrl={app.route.ROUTE_GET_ORDERS_BY_WAREHOUSE_PARTMENT} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDShop/project/App/modules/warehouseDepartment/OrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { DImage } = COMPONENTS;
import moment from 'moment';

module.exports = React.createClass({
    statics: {
        title: '货单详情',
    },
    render () {
        const obj = this.props.data;
        return (
            <View style={styles.container}>
                <View style={styles.containerReceive}>
                    <Text style={styles.textAddress}> 收货地址：{obj.endPoint} </Text>
                    <View style={styles.receiveMemberRow}>
                        <Text style={styles.receiveMember}> 收货人：{!obj.receiverName ? '' : obj.receiverName}</Text>
                        <Text style={styles.receiveMember}>{obj.receiverPhone}</Text>
                    </View>
                </View>
                <View style={styles.containerMarket}>
                    <View style={styles.containerMarketLeft}>
                        <Image style={styles.imageLogo}
                            source={app.img.order_logo}
                            resizeMode='stretch'
                            />
                        <Text style={styles.textMarket}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                    </View>
                </View>
                <View style={styles.containerDetails}>
                    <DImage style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri: obj.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                <Text >-</Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.endPoint}</Text>
                            </View>
                            <View style={styles.detailsTopRight}>
                                <Text style={styles.moneyLeft}>运费：</Text>
                                <Text style={styles.moneyRight}>¥{obj.needPayInsuanceFee + obj.needPayTransportFee}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>重量：{obj.weight}吨</Text>
                        <Text style={styles.textDetailsItem}>方量：{obj.size}m³</Text>
                        <Text style={styles.textDetailsItem}>件数：{obj.totalNumbers}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment().format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.containerWhite} />
                <View style={styles.containerNumber}>
                    <Text style={styles.textNumber}>订单号：{obj.id}</Text>
                    <Text style={styles.textDate}>创建时间：{moment(obj.createTime).format('YYYY-MM-DD')}</Text>
                </View>
                <View style={styles.containerInfo}>
                    <Text style={styles.textInfoTop}>运费：¥{obj.needPayTransportFee}</Text>
                    <Text style={styles.textInfo}>保险费：¥{obj.needPayInsuanceFee}</Text>
                    <Text style={styles.textInfo}>
                        支付方式：{'货到付款'}
                    </Text>
                    <Text style={styles.textTotal}>总计：¥{obj.needPayInsuanceFee + obj.needPayTransportFee}</Text>
                </View>
                <TouchableOpacity>
                    <View style={styles.logInfo}>
                        <Text style={styles.textLogInfo}>操作人</Text>
                        <View style={styles.logInfoRight}>
                            <Text style={styles.textLogInfoRight}>{obj.receiveMember.name}</Text>
                            <Image
                                style={styles.imageCommon_go}
                                resizeMode='stretch'
                                source={app.img.common_go}
                                />
                        </View>
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    containerTop:{
        height:60,
        backgroundColor:'#c81622',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    imageTop:{
        height:32,
        width:27,
    },
    textTop:{
        fontSize:12,
        fontWeight:'900',
        marginLeft:20,
        color:'#ffffff',
    },
    containerReceive:{
        marginTop:8,
        height:50,
        backgroundColor:'#ffffff',
        justifyContent: 'center',
    },
    textAddress:{
        marginLeft:10,
        fontSize:14,
        marginBottom:3,
        color:'#333333',
    },
    receiveMemberRow:{
        flexDirection:'row',
    },
    receiveMember:{
        marginLeft:10,
        fontSize:12,
        marginTop:3,
        color:'#333333',
    },
    containerMarket:{
        height:25,
        marginTop:8,
        backgroundColor:'#ffffff',
        alignItems: 'center',
        justifyContent: 'space-between',
        flexDirection: 'row',
    },
    containerMarketLeft:{
        flexDirection: 'row',
    },
    imageLogo:{
        height:13,
        width:16.5,
        marginLeft:10,
    },
    textMarket:{
        marginLeft:10,
        color:'#333333',
        fontSize:12,
    },
    textGetState:{
        color:'#00a117',
        marginRight:10,
        fontSize:12,
    },
    containerDetails:{
        backgroundColor:'#f4f4f4',
        flexDirection: 'row',
        alignItems:'center',
    },
    containerWhite:{
        height:8,
        backgroundColor:'#ffffff',
    },
    imageGoods:{
        height:75,
        width:75,
        marginLeft:10,
    },
    goodsDetails:{
        marginLeft:8,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    detailsAddress:{
        fontSize:14,
        width:60,
        color:'#333333',
        flexDirection: 'row',

    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:12,
        color:'#888888',
    },
    containerNumber:{
        height:50,
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        justifyContent: 'center',
    },
    textNumber:{
        color:'#333333',
        marginBottom:3,
        fontSize:12,
    },
    textDate:{
        color:'#888888',
        marginTop:3,
        fontSize:12,
    },
    containerInfo:{
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        paddingBottom:4,
    },
    textInfoTop:{
        marginTop:4,
        color:'#888888',
        fontSize:12,
    },
    textInfo:{
        marginTop:2,
        color:'#888888',
        fontSize:12,
    },
    textTotal:{
        marginTop:5,
        fontSize:12,
        color:'#333333',
        fontWeight:'400',
    },
    logInfo:{
        height:40,
        backgroundColor:'#ffffff',
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLogInfo:{
        color:'#888888',
        fontSize:14,
        marginLeft:10,
    },
    logInfoRight:{
        marginRight:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    textLogInfoRight:{
        fontSize:14,
        color:'#aaaaaa',
        marginRight:5,
    },
    imageCommon_go:{
        width: 8,
        height: 15,
        marginRight: 7,
    },
});

```

* PDShop/project/App/modules/warehouseDepartment/OrderList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList, DImage } = COMPONENTS;
const WarehouseOrderDetail = require('./OrderDetail');
import moment from 'moment';

module.exports = React.createClass({
    statics: {
        title: '货单',
    },
    doLookDetail (obj) {
        app.push({
            component: WarehouseOrderDetail,
            passProps:{
                data:obj,
            },
        });
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={sectionID + rowID} />
        );
    },
    renderRow (obj, rowID) {
        return (
            <View style={styles.row}>
                <View style={styles.rowTopContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.order_logo}
                        style={styles.topImage} />
                    <Text style={styles.topLeftText}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                </View>
                <TouchableOpacity style={styles.rowMiddleContainer} onPress={this.doLookDetail.bind(null, obj)}>
                    <DImage
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri: obj.photo }}
                        style={styles.middleImage} />
                    <View style={styles.middleRight}>
                        <View style={styles.pointContainer}>
                            <View style={styles.placeContainer}>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                <Text style={styles.pointName}>→</Text>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.endPoint}</Text>
                            </View>
                            <Text style={styles.time}>{moment(obj.createTime).format('YYYY-MM-DD')}</Text>
                        </View>
                        <Text style={styles.commonInfo}>{'重量：'}{obj.weight}吨</Text>
                        <Text style={styles.commonInfo}>{'方量：'}{obj.size}m³</Text>
                        <Text style={styles.commonInfo}>{'件数：'}{obj.totalNumbers}件</Text>
                        {
                            this.props.type == 'stored' && obj.warehouse &&
                            <Text style={styles.commonInfo}>仓库号：{obj.warehouse}</Text>
                        }

                        <Text style={styles.commonInfo}>{'收货地址：'}{obj.endPoint}</Text>
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        const { index, tabIndex, type, listUrl, data } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                <View style={styles.separator} />
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        renderSeparator={this.renderSeparator}
                        listParam={{ userId: app.personal.info.userId, type: type }}
                        listName={type + '.list'}
                        autoLoad={false}
                        list={data.list}
                        listUrl={listUrl}
                        refreshEnable />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    typeContainer:{
        backgroundColor:'#c81622',
        height:80,
        width:60,
        position:'absolute',
        top:0,
        right:3,
    },
    typeButton:{
        height:25,
    },
    typeText:{
        fontSize:14,
        fontWeight:'400',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    separator: {
        backgroundColor: '#f4f4f4',
        height: 8,
    },
    rowTopContainer: {
        paddingHorizontal:10,
        paddingVertical:5,
        backgroundColor:'white',
        flexDirection: 'row',
    },
    topImage: {
        width: 17,
        height:17,
    },
    topLeftText: {
        marginLeft:10,
        flex:1,
        fontSize: 14,
    },
    rowMiddleContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:11,
        backgroundColor:'#f8f8f8',
    },
    middleImage: {
        width: 80,
        height:80,
        borderRadius: 10,
        marginLeft: 10,
    },
    middleRight: {
        paddingLeft: 10,
        width:sr.w - 100,
    },
    money: {
        fontSize: 14,
        color:'#f51b1a',
    },
    commonInfo: {
        fontSize: 13,
        color:'#888888',
    },
    pointName: {
        fontSize: 16,
        maxWidth: 60,
    },
    time: {
        flex:1,
        fontSize: 14,
        color: 'gray',
        textAlign:'right',
    },
    pointContainer: {
        flexDirection: 'row',
    },
    placeContainer: {
        flex:1,
        flexDirection: 'row',
    },
    rowButtomContainer: {
        backgroundColor:'white',
        flexDirection: 'row',
        justifyContent: 'flex-end',
        paddingVertical:5,
    },
    lookTransport: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#ff6200',
        borderWidth:1,
        backgroundColor:'white',
    },
    confirmReceive: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#c81622',
        borderWidth:1,
        marginLeft:20,
        marginRight:10,
        backgroundColor:'white',
    },
    btnTransportText:{
        color:'#ff6200',
        fontSize:12,
        fontWeight:'300',
    },
    btnReceiveText:{
        color:'#c81622',
        fontSize:12,
        fontWeight:'300',
    },
});

```

* PDShop/project/App/modules/warehouseDepartment/ScanOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const { Button, DImage } = COMPONENTS;
import moment from 'moment';

module.exports = React.createClass({
    statics: {
        title: '扫描订单详情',
    },
    getInitialState () {
        return {
            data:[],
            count:1,
            force:false,
            unStoageNumbers:0,
        };
    },
    componentWillMount () {
        this.getOrderDetail();
    },
    getOrderDetail () {
        const { orderId } = this.props;
        const { force } = this.state;
        const param = {
            userId:app.personal.info.userId,
            orderId,
            count:0,
        };
        POST(app.route.ROUTE_PLACE_STORAGE, param, this.postScanOrderSuccess, true);
    },
    postScanOrderSuccess (data) {
        if (data.success) {
            this.setState({
                data: data.order,
                unStoageNumbers: _.find(data.order.stateList, o => o.state == 5 && o.count).count,
            });
            app.scanStoageOrder.saveOrder(data.order);
        } else {
            if (data.retry) {
                this.setState({force:!!data.retry,msg:data.msg,data:data.order,unStoageNumbers: _.find(data.order.stateList, o => o.state == 5 && o.count).count});
            } else {
                this.setState({force:!!data.retry,msg:''});
                Toast(data.msg);
                app.pop();
            }

        }
    },
    minusCount () {
        const { count } = this.state;
        if (count > 0) {
            this.setState({ count:parseInt(count) - 1 });
        } else {
            Toast('装车数量不能小于0');
        }
    },
    addCount () {
        const { count, unStoageNumbers } = this.state;
        if (unStoageNumbers > 0) {
            if (count < unStoageNumbers) {
                this.setState({ count:parseInt(count) + 1 });
            } else {
                Toast('装车数量不能大于未入库件数');
            }
        } else {
            Toast('该货单已全部入库');
        }
    },
    showScanResult () {
        const { orderId } = this.props;
        const { count, data, unStoageNumbers, force } = this.state;
        if (count > unStoageNumbers) {
            Toast('装车数量不能大于未入库件数');
            return;
        }
        app.navigator.replace({
            component:require('./ScanResult'),
            passProps:{
                orderId,
                force,
                count,
                data,
            },
        });
    },
    doCancel () {
        app.navigator.popToTop();
    },
    render () {
        const { data, count, unStoageNumbers, force, msg } = this.state;
        console.log('data', data);
        return (
            <View style={styles.container}>
                <View style={styles.containerDetails}>
                    <DImage style={styles.imageGoods}
                        defaultSource={app.img.common_default}
                        source={{ uri: data.photo }} />
                    <View style={styles.goodsDetails}>
                        <Text style={styles.textDetailsItem}>重量：{data.weight}m³</Text>
                        <Text style={styles.textDetailsItem}>方量：{data.size}吨</Text>
                        <Text style={styles.textDetailsItem}>未入库件数：{unStoageNumbers}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.modifyCount}>
                    <Text style={styles.modifyCountTitle}>入库数量</Text>
                    <TouchableOpacity onPress={this.minusCount}>
                        <Text style={styles.imgSymbol}>－</Text>
                    </TouchableOpacity>
                    <TextInput
                        style={styles.countFont}
                        defaultValue={count + ''}
                        underlineColorAndroid='transparent'
                        maxLength={4}
                        onChangeText={(text) => this.setState({ count:text })}
                        keyboardType='numeric' />
                    <TouchableOpacity onPress={this.addCount}>
                        <Text style={styles.imgSymbol}>＋</Text>
                    </TouchableOpacity>
                </View>
                {
                    force&&<Text style={styles.msg}>{msg}</Text>
                }
                <View style={styles.bottom}>
                    <Button style={styles.btnConfirm} textStyle={styles.btnFont} onPress={this.showScanResult}>{force?'强制入库':'确认'}</Button>
                    <Button style={styles.btnCancel} textStyle={styles.btnFont} onPress={this.doCancel}>取消</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    containerDetails:{
        height:150,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    imageGoods:{
        height:125,
        width:125,
        marginLeft:12,
        marginTop:11,
    },
    goodsDetails:{
        marginLeft:8,
        marginTop:10,
        height:125,
        paddingBottom:8,
        justifyContent: 'center',
    },
    moneyLeft:{
        fontSize:14,
        color:'#333333',
    },
    moneyRight:{
        fontSize:15,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:14,
        color:'#888888',
        flex:1,
    },
    modifyCount:{
        flexDirection:'row',
        backgroundColor:'#f4f4f4',
        height:50,
        marginTop:10,
        alignItems:'center',
    },
    modifyCountTitle:{
        marginLeft:20,
        color:'#888888',
        marginRight:130,
    },
    imgSymbol:{
        fontSize:20,
        fontWeight:'400',
        marginRight:10,
    },
    countFont:{
        padding:0,
        fontSize:14,
        width:30,
        height:20,
        color:'#666666',
        backgroundColor:'#FFFFFF',
        marginRight:10,
        alignSelf:'center',
        textAlign:'right',
    },
    msg :{
        color:'red',
        textAlign:'center',
        fontSize:16,
        marginTop:100
    },
    btnConfirm:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#FE9917',
    },
    btnCancel:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    bottom:{
        height:45,
        width:sr.w,
        flexDirection:'row',
        position:'absolute',
        bottom:0,
        right:0,
    },
});

```

* PDShop/project/App/modules/warehouseDepartment/ScanResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

const { Button, DImage } = COMPONENTS;
const StorageDetail = require('./StorageDetail');
const ScanBarCode = require('../common/ScanBarCode');

import moment from 'moment';

module.exports = React.createClass({
    statics: {
        title: '扫描结果',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        app.navigator.popToTop();
    },
    getInitialState () {
        return {
            list: [],
            status:true,
        };
    },
    confirmScan () {
        app.push({
            component: StorageDetail,
        });
    },
    componentWillMount () {

        this.getPlaceStorage();
    },
    getPlaceStorage () {
        const { orderId, count, force } = this.props;
        const param = {
            userId : app.personal.info.userId,
            orderId,
            force,
            count:count * 1,
        };
        POST(app.route.ROUTE_PLACE_STORAGE, param, this.getPlaceStorageSuccess, false);
    },
    getPlaceStorageSuccess (data) {
        if (data.success) {
            this.setState({
                list:data.order,
            });
            app.scanStoageOrder.saveOrder(data.order);
        } else {
            Toast(data.msg);
        }
    },
    continueScanOrder () {
        app.showModal(
            <ScanBarCode onBarCodeRead={this.onBarCodeRead} />
        );
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            app.navigator.replace({
                component:require('./ScanOrderDetail'),
                passProps:{
                    orderId:data.id,
                },
            });
        }
    },
    render () {
        const { list } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.header}>
                    <View style={styles.top}>
                        <View style={styles.headerItem}>
                            <Text style={styles.headerFontTop}>{app.scanStoageOrder.stoageNumbers ? app.utils.N(app.scanStoageOrder.stoageNumbers) : 0}单</Text>
                            <Text style={styles.headerFont}>入库单数</Text>
                        </View>
                        <View style={styles.headerItem}>
                            <Text style={styles.headerFontTop}>{app.scanStoageOrder.unStoageNumbers ? app.utils.N(app.scanStoageOrder.unStoageNumbers) : 0}单</Text>
                            <Text style={styles.headerFont}>未入库单数</Text>
                        </View>
                        <View style={styles.headerItem}>
                            <Text style={styles.headerFontTop}>{app.utils.N(app.scanStoageOrder.totalSize)}m³</Text>
                            <Text style={styles.headerFont}>总方量</Text>
                        </View>
                        <View style={styles.headerItem}>
                            <Text style={styles.headerFontTop}>{app.utils.N(app.scanStoageOrder.totalWeight)}吨</Text>
                            <Text style={styles.headerFont}>总重量</Text>
                        </View>
                    </View>
                    <View style={styles.order}>
                        <DImage
                            resizeMode='cover'
                            defaultSource={app.img.common_default}
                            source={{ uri: list.photo }}
                            style={styles.icon} />
                        <View style={styles.rowInfo}>
                            <Text style={styles.id}
                                numberOfLines={1}
                                ellipsizeMode='tail'>货单号:{list.id}</Text>
                            <Text style={styles.info}>重量:{list.weight}吨</Text>
                            <Text style={styles.info}>方量:{list.size}m³</Text>
                            <Text style={styles.info}>收货地址:{list.endPoint}</Text>
                        </View>
                        <Text style={styles.timeInfo}>{moment(list.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <Button style={styles.btnContinue} textStyle={styles.btnContinueFont} onPress={this.continueScanOrder}>继续扫描</Button>
                <Button style={styles.btnConfirm} textStyle={styles.btnConfirmFont} onPress={this.confirmScan}>确认扫描</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    header:{
        height:200,
    },
    top:{
        flexDirection:'row',
        height:60,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    headerItem:{
        flex:1,
        alignItems:'center',
    },
    headerFontTop:{
        fontSize:14,
        color:'#333333',
        marginBottom:2,
    },
    headerFont:{
        fontSize:14,
        color:'#888888',
        marginTop:2,
    },
    order:{
        flexDirection:'row',
        height:90,
        backgroundColor:'#FFFFFF',
        marginTop:10,
        alignItems:'center',
    },
    headText:{
        color:'#333333',
        marginTop:15,
        marginLeft:10,
        fontSize:14,
        flexDirection:'row',
    },
    unload:{
        height:40,
        backgroundColor:'#FFFFFF',
        marginTop:5,
        flexDirection:'row',
        alignItems:'center',
        justifyContent:'space-between',
    },
    unloadLeft:{
        flexDirection:'row',
    },
    carNumber:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    goodsNumber:{
        fontSize:12,
        marginTop:2,
        marginLeft:6,
        color:'#f29c00',
    },
    unloadRight:{
        fontSize:14,
        color:'red',
        marginRight:10,
    },
    previous:{
        fontSize:15,
        color:'#ec202b',
    },
    row:{
        flexDirection:'row',
        height:90,
        backgroundColor:'#FFFFFF',
        marginTop:10,
        alignItems:'center',
    },
    icon:{
        width:70,
        height:70,
        borderRadius:2,
        marginLeft:8,
    },
    rowInfo:{
        marginTop:10,
        marginBottom:10,
        marginLeft:5,
    },
    id:{
        fontSize:14,
        color:'#333333',
        width:150,
        flex:1,
    },
    info:{
        fontSize:12,
        color:'#888888',
        marginTop:1,
        flex:1,
    },
    infoRed:{
        fontSize:12,
        color:'red',
        marginTop:5,
        flex:1,
    },
    timeInfo:{
        fontSize:12,
        width:80,
        color:'#888888',
        alignSelf:'flex-start',
        marginTop:12,
        marginLeft:30,
    },
    btnContinue:{
        width:sr.w - 24,
        height:45,
        borderRadius:4,
        backgroundColor:'#FE9917',
        alignSelf:'center',
        marginTop:sr.h - 565,
    },
    btnConfirm:{
        width:sr.w - 24,
        height:45,
        borderRadius:4,
        backgroundColor:'#dddddd',
        alignSelf:'center',
        marginTop:20,
    },
    btnContinueFont:{
        color:'#FFFFFF',
        fontWeight:'400',
        fontSize:16,

    },
    btnConfirmFont:{
        color:'#333333',
        fontWeight:'400',
        fontSize:16,
    },
});

```

* PDShop/project/App/modules/warehouseDepartment/Storage.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    Text,
    TouchableOpacity,
} = ReactNative;

const ScanOrderDetail = require('./ScanOrderDetail');
const ScanBarCode = require('../common/ScanBarCode');

module.exports = React.createClass({
    statics: {
        title: '扫描入库',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '扫描入库';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    scanBarCode () {
        app.showModal(
            <ScanBarCode onBarCodeRead={this.onBarCodeRead} />
        );
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            app.push({
                component:ScanOrderDetail,
                passProps:{
                    orderId:data.id,
                },
            });
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.container}>
                    <Image />
                    <Image source={app.img.storage_scan_code_storage}
                        style={styles.imgScanCode}
                        resizeMode='contain' />
                    <TouchableOpacity style={styles.btnScan} onPress={this.scanBarCode}>
                        <Image source={app.img.storage_scan}
                            style={styles.imgscan}
                            resizeMode='contain' />
                        <Text style={styles.scanFont}>扫一扫</Text>
                    </TouchableOpacity>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        alignItems:'center',
    },
    container1: {
        flex: 1,
        width: sr.w,
    },
    preview: {
        flex: 1,
        justifyContent: 'flex-end',
        alignItems: 'center',
    },
    imgScanCode:{
        width:sr.w - 205,
        height:sr.h - 475,
        marginTop:sr.h - 620,
    },
    btnScan:{
        marginTop:90,
        flexDirection:'row',
        width:sr.w - 225,
        height:35,
        backgroundColor:'#c61a29',
        alignItems:'center',
        justifyContent:'center',
        borderRadius:4,
    },
    imgscan:{
        width:14,
        height:14,
    },
    scanFont:{
        color:'#ffffff',
        marginLeft:5,
        fontWeight:'500',
    },
});

```

* PDShop/project/App/modules/warehouseDepartment/StorageDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
} = ReactNative;

const { DImage } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '入库详情',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        app.scanStoageOrder.clear();
        app.navigator.popToTop();
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {};
    },
    renderRow (obj, sectionID, rowID) {
        console.log('obj', obj);
        return (
            <View style={styles.row}>
                <DImage
                    resizeMode='contain'
                    defaultSource={app.img.common_default}
                    source={{ uri: obj.photo }}
                    style={styles.img} />
                <View style={styles.infoRow}>
                    <Text style={styles.id}>货单号：{obj.id}</Text>
                    <Text style={styles.info}>重量：{obj.weight}吨</Text>
                    <Text style={styles.info}>方量：{obj.size}m³</Text>
                    <Text style={styles.infoBottom}>收货地址：{obj.endPoint}</Text>
                </View>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.top}>
                    <View style={styles.headerItem}>
                        <Text style={styles.headerFontTop}>{app.scanStoageOrder.stoageNumbers ? app.utils.N(app.scanStoageOrder.stoageNumbers) : 0}单</Text>
                        <Text style={styles.headerFont}>入库单数</Text>
                    </View>
                    <View style={styles.headerItem}>
                        <Text style={styles.headerFontTop}>{app.scanStoageOrder.unStoageNumbers ? app.utils.N(app.scanStoageOrder.unStoageNumbers) : 0}单</Text>
                        <Text style={styles.headerFont}>未入库单数</Text>
                    </View>
                    <View style={styles.headerItem}>
                        <Text style={styles.headerFontTop}>{app.utils.N(app.scanStoageOrder.totalSize)}m³</Text>
                        <Text style={styles.headerFont}>入库总方量</Text>
                    </View>
                    <View style={styles.headerItem}>
                        <Text style={styles.headerFontTop}>{app.utils.N(app.scanStoageOrder.totalWeight)}吨</Text>
                        <Text style={styles.headerFont}>入库总重量</Text>
                    </View>
                </View>
                <ListView
                    style={styles.ListView}
                    dataSource={this.ds.cloneWithRows(app.scanStoageOrder.list)}
                    renderRow={this.renderRow}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    row:{
        backgroundColor:'#FFFFFF',
        height:100,
        marginTop:8,
        paddingLeft:10,
        flexDirection:'row',
        alignItems:'center',
    },
    top:{
        flexDirection:'row',
        height:60,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    headerItem:{
        flex:1,
        alignItems:'center',
    },
    headerFontTop:{
        fontSize:14,
        color:'#333333',
    },
    headerFont:{
        fontSize:14,
        color:'#888888',
    },
    id:{
        marginBottom:6,
        fontSize:14,
        color:'#333333',
    },
    info:{
        marginTop:2,
        fontSize:12,
        color:'#888888',
    },
    infoBottom:{
        marginTop:2,
        marginBottom:1,
        fontSize:12,
        color:'#888888',
    },
    img:{
        width:80,
        height:80,
    },
    infoRow:{
        marginLeft:10,
        justifyContent:'center',
    },
});

```

* PDShop/project/App/modules/warehouseDepartment/index.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

const Storage = require('./Storage');
const Order = require('./Order');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: Storage },
    { index: 1, component: Order },
    { index: 2, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '入库', icon: app.img.home_storage, selected: app.img.home_storage_press },
            { index: 1, title: '货单', icon: app.img.home_warehouse_order, selected: app.img.home_warehouse_order_press },
            { index: 2, title: '我的', icon: app.img.home_mine, selected: app.img.home_mine_press },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDShop/project/App/utils/check/index.js

```js
module.exports = {
    checkPhone (phone) {
        return /^1\d{10}$/.test(phone);
    },
    checkIdentifyNumber (number) {
        return /^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/.test(number);
    },
    checkPassword (pwd) {
        return /^[\d\w_]{6,20}$/.test(pwd);
    },
    checkVerificationCode (code) {
        return /^\d{6}$/.test(code);
    },
    checkMailAddress (code) {
        const reg = /^([a-zA-Z0-9]+[_.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        return reg.test(code);
    },
    /**
     * 验证银行卡号(16位或19位数字)
    */
    checkBankCardCode (code) {
        return /^(\d{16}|\d{19})$/.test(code);
    },
    /**
     * 验证出生日期(平年日期格式为YYYY-MM-DD的正则表达式)
    */
    checkBirthDate (str) {
        var re = /^([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8])))$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
    * 验证字符串是否包含特殊符号
    */
    checkStr (str) {
        let re = /^[\u4E00-\u9FA5A-Za-z0-9-]+$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证数字(可以包含两个小数点)
    */
    check2PointNum (code) {
        return /^(0|[1-9][0-9]{0,9})(\.[0-9]{1,2})?$/.test(code);
    },
    /**
     * 验证数字(包含不限小数点)
    */
    checkNum (str) {
        var re = /^[0-9]+.?[0-9]*$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证数字(正整数)
    */
    checkIntNum (str) {
        var re = /^[0-9]*[1-9][0-9]*$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证非负整数
    */
    checkUnIntNum (str) {
        var re = /^\d+$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证二维码数据是否合法
    */
    checkQRCodeData (str) {
        var re = /[a-z0-9]{24}/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证数字为正数且最多包含两位小数
    */
    checkInt2PointNum (str) {
        let re = /^[0-9]+(.[0-9]{1,2})?$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
};

```

* PDShop/project/App/utils/common/index.js

```js
module.exports = {
    until (test, iterator, callback) {
        if (!test()) {
            iterator((err) => {
                if (err) {
                    return callback(err);
                }
                this.until(test, iterator, callback);
            });
        } else {
            callback();
        }
    },
    N (num, rank = 2) {
        typeof num !== 'number' && (num = 0);
        return parseFloat(num.toFixed(rank));
    },
    toThousands (num) {
        return (num || 0).toString().replace(/(\d)(?=(?:\d{3})+$)/g, '$1,');
    },
    getPercentages (list) {
        const sum = _.sum(list);
        return list.map((v) => Math.round(v * 100 / sum) + '%');
    },
    getVisibleText (text, n) {
        let realLength = 0, len = text.length, preLen = -1, charCode = -1, needCut = false;
        for (let i = 0; i < len; i++) {
            charCode = text.charCodeAt(i);
            if (charCode >= 0 && charCode <= 128) {
                realLength += 1;
            } else {
                realLength += 2;
            }
            if (preLen === -1 && realLength >= n) {
                preLen = i + 1;
            } else if (realLength > n + 2) {
                needCut = true;
                break;
            }
        }
        if (needCut) {
            text = text.substr(0, preLen) + '..';
        }
        return text;
    },
    cutLimitText (text, n) {
        let realLength = 0, len = text.length, preLen = -1, charCode = -1, needCut = false;
        for (let i = 0; i < len; i++) {
            charCode = text.charCodeAt(i);
            if (charCode >= 0 && charCode <= 128) {
                realLength += 1;
            } else {
                realLength += 2;
            }
            if (preLen === -1 && realLength >= n) {
                preLen = i + 1;
            } else if (realLength > n) {
                needCut = true;
                break;
            }
        }
        if (needCut) {
            text = text.substr(0, preLen);
        }
        return text;
    },
};

```

* PDShop/project/App/utils/date/index.js

```js
const moment = require('moment');

module.exports = {
    createDateData (start, end) {
        let date = [];
        let iy = start.year(), im = start.month() == 0 ? start.month() + 1 : start.month(), id = start.date();
        let ey = end.year(), em = end.month() + 1, ed = end.date();
        for (let y = iy; y <= ey; y++) {
            let month = [];
            let mm = [0, 31, (!(y % 4) & (!!(y % 100))) | (!(y % 400)) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            let iim = (y === iy) ? im : 1;
            let eem = (y === ey) ? em : 12;
            for (let m = iim; m <= eem; m++) {
                let day = [];
                let iid = (y === iy && m === im) ? id : 1;
                let eed = (y === ey && m === em) ? ed : mm[m];
                for (let d = iid; d <= eed; d++) {
                    day.push(d + '日');
                }
                month.push({ [m + '月']: day });
            }
            date.push({ [y + '年']: month });
        }
        return date;
    },
    createMonthData (start, end) {
        let date = [];
        let iy = start.year(), im = start.month() == 0 ? start.month() + 1 : start.month();
        let ey = end.year(), em = end.month() + 1;
        for (let y = iy; y <= ey; y++) {
            let month = [];
            let iim = (y === iy) ? im : 1;
            let eem = (y === ey) ? em : 12;
            for (let m = iim; m <= eem; m++) {
                month.push(m + '月');
            }
            date.push({ [y + '年']: month });
        }
        return date;
    },
    createTimeData (start, end, date, hasSeconds) {
        const d = date.startOf('day');
        const isStart = d.isSame(moment(start).startOf('day'));
        const isEnd = d.isSame(moment(end).startOf('day'));
        let time = [];
        let ih = start.hour(), it = start.minute(), is = start.second();
        let eh = end.hour(), et = end.minute(), es = start.second();
        let iih = isStart ? ih : 0;
        let eeh = isEnd ? eh : 24;

        for (let h = iih; h < eeh; h++) {
            let minute = [];
            let iit = (isStart && h === ih) ? it : 0;
            let eet = (isEnd && h === eh) ? et : 60;
            for (let t = iit; t < eet; t++) {
                if (!hasSeconds) {
                    minute.push(t + '分');
                } else {
                    let second = [];
                    let iis = (isStart && h === ih && t === it) ? is : 1;
                    let ees = (isEnd && h === eh && t === et) ? es : 60;
                    for (let s = iis; s <= ees; s++) {
                        second.push(s + '秒');
                    }
                    minute.push({ [t + '分']: second });
                }
            }
            time.push({ [h + '时']: minute });
        }
        return time;
    },
    showDatePicker (Picker, start, end, selected) {
        return new Promise(async(resolve) => {
            const selectedValue = [selected.year() + '年', (selected.month() + 1) + '月', selected.date() + '日'];
            const pickerData = this.createDateData(start, end);
            Picker(pickerData, selectedValue, '选择日期').then((value) => {
                const time = moment(value.join(''), 'YYYY年M月D日');
                const date = moment(time.year() + '年' + (time.month() + 1) + '月' + time.date() + '日' + selected.hour() + '时' + selected.minute() + '分', 'YYYY年MM月DD日HH时mm分');
                resolve(date);
            });
        });
    },
    showTimePicker (Picker, start, end, selected, hasSeconds) {
        return new Promise(async(resolve) => {
            const selectedValue = [selected.hour() + '时', selected.minute() + '分', selected.second() + '秒'];
            const pickerData = this.createTimeData(start, end, selected, hasSeconds);
            Picker(pickerData, selectedValue, '选择时间').then((value) => {
                const time = moment(value.join(''), 'HH时mm分');
                const date = moment(selected.year() + '年' + (selected.month() + 1) + '月' + selected.date() + '日' + time.hour() + '时' + time.minute() + '分', 'YYYY年MM月DD日HH时mm分');
                resolve(date);
            });
        });
    },
};

```

* PDShop/project/App/utils/qrcode/index.js

```js
module.exports = {
    genQRString (type, id) {
        const str = JSON.stringify({ c: 's', t: type, d: id });
        let output = '';
        for (let x = 0, y = str.length, charCode, hexCode; x < y; ++x) {
            charCode = str.charCodeAt(x);
            if (charCode < 128) {
                charCode += 128;
            } else if (charCode > 127) {
                charCode -= 128;
            }
            charCode = 255 - charCode;
            hexCode = charCode.toString(16);
            if (hexCode.length < 2) {
                hexCode = '0' + hexCode;
            }
            output += hexCode;
        }
        return output;
    },
    getQRResult (str) {
        let output = '';
        for (let x = 0, y = str.length, charCode, hexCode; x < y; x += 2) {
            hexCode = str.substr(x, 2);
            charCode = parseInt(hexCode, 16);
            charCode = 255 - charCode;
            if (charCode < 128) {
                charCode += 128;
            } else if (charCode > 127) {
                charCode -= 128;
            }
            output += String.fromCharCode(charCode);
        }
        try {
            const result = JSON.parse(output);
            if (result.c !== 's') {
                return undefined;
            }
            return { type: result.t, id: result.d };
        } catch (e) {
            return undefined;
        }
    },
};

```

* PDShop/project/App/utils/net/Get.js

```js
'use strict';

function GET (url, success, error) {
    console.log('getSend:', url);
    app.showLoading();
    fetch(url, {
        method: 'get',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
        },
    })
    .then((response) => response.json())
    .then((json) => {
        console.log('getRecv:', json);
        app.hideLoading();
        success && success(json);
    })
    .catch((err) => {
        app.hideLoading();
        if (!error || !error(err)) {
            Toast('网络出错');
        }
    });
}

module.exports = GET;

```

* PDShop/project/App/utils/net/Post.js

```js
'use strict';

module.exports = (url, parameter, success, failed, wait) => {
    console.log(url, 'send:', parameter);
    if (typeof failed === 'boolean') {
        wait = failed;
        failed = null;
    }
    if (wait) {
        app.showLoading();
    }
    fetch(url, {
        method: 'post',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(parameter),
    })
    .then((response) => response.json())
    .then((data) => {
        console.log(url, 'recv:', data);
        success(data);
        if (wait) {
            app.hideLoading();
        }
    })
    .catch((error) => {
        if (!failed || !failed(error)) {
            Toast('网络错误');
            console.log(url + ':网络错误', error);
            if (wait) {
                app.hideLoading();
            }
        }
    });
};

```

* PDShop/project/App/utils/net/Upload.js

```js
'use strict';

const FileTransfer = require('@remobile/react-native-file-transfer');

function UPLOAD (filePath, url, options, onprogress, success, failed, wait) {
    console.log(url, 'send:', options);
    if (typeof failed === 'boolean') {
        wait = failed;
        failed = null;
    }
    if (wait) {
        app.showLoading();
    }
    const fileTransfer = new FileTransfer();
    fileTransfer.onprogress = onprogress;
    fileTransfer.upload(filePath, app.route.ROUTE_UPDATE_FILE, (res) => {
        let json = {};
        try {
            json = JSON.parse(res.response);
        } catch (error) {
            if (!failed || !failed(error)) {
                Toast('数据解析错误');
                if (wait) {
                    app.hideLoading();
                }
            }
        }
        console.log(url, 'recv:', json);
        app.hideLoading();
        success(json);
    }, (err) => {
        if (!failed || !failed(err)) {
            Toast('上传失败');
            if (wait) {
                app.hideLoading();
            }
        }
    }, options);
}

module.exports = UPLOAD;

```

* PDShop/project/App/utils/net/index.js

```js
'use strict';

module.exports = {
    POST: require('./Post'),
    GET: require('./Get'),
    UPLOAD: require('./Upload'),
};

```

* PDClient/project/App/index.js

```js
'use strict';

console.disableYellowBox = true;

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Platform,
    BackAndroid,
    View,
    Text,
    Image,
    StatusBar,
} = ReactNative;

const CustomComponents = require('react-native-deprecated-custom-components');
global.Navigator = CustomComponents.Navigator;
global._ = require('lodash');
global.sr = require('./config/Screen');
const COLOR = require('./config/Color');
global._c = COLOR._c;
global._bc = COLOR._bc;
global._tc = COLOR._tc;
global.Toast = require('@remobile/react-native-toast').show;
global.CONSTANTS = require('./config/Constants');
global.AH = require('./config/Authority');
global.PS = require('./config/Position');
global.PT = require('./config/Partment');
global.OS = require('./config/OrderState');
global.TS = require('./config/TruckState');
const Utils = require('./utils');
global.POST = Utils.POST;
global.GET = Utils.GET;
global.UPLOAD = Utils.UPLOAD;
global.COMPONENTS = require('./components/index');
const TimerMixin = require('react-timer-mixin');
const Route = require('./config/Route');
const img = require('./resource/image');
const aud = require('./resource/audio');
const AuthorityMgr = require('./manager/AuthorityMgr');
const PersonalInfoMgr = require('./manager/PersonalInfoMgr');
const UpdateMgr = require('./manager/UpdateMgr');
const SettingMgr = require('./manager/SettingMgr');
const LoginMgr = require('./manager/LoginMgr');
const WXpayMgr = require('./manager/WXpayMgr');
const JpushMgr = require('./manager/JpushMgr');
const { ProgressHud, DelayTouchableOpacity, Modal } = COMPONENTS;

global.app = {
    route: Route,
    utils: Utils,
    img: img,
    aud: aud,
    data: {},
    authority: AuthorityMgr,
    personal: PersonalInfoMgr,
    setting: SettingMgr,
    updateMgr:UpdateMgr,
    login: LoginMgr,
    wxpay: WXpayMgr,
    jpush: JpushMgr,
    isandroid: Platform.OS === 'android',
};

global.SceneMixin = {
    componentWillMount () {
        app.scene = this;
    },
    onWillFocus () {
        app.scene = this;
    },
};

app.configureScene = function (route) {
    route = route || {};
    let sceneConfig = route.sceneConfig;
    if (sceneConfig) {
        return sceneConfig;
    }
    if (Platform.OS === 'android') {
        if (route.fromLeft) {
            sceneConfig = { ...Navigator.SceneConfigs.FloatFromLeft, gestures: null };
        } else {
            sceneConfig = Navigator.SceneConfigs.FadeAndroid;
        }
    } else {
        if (route.fromLeft) {
            sceneConfig = { ...Navigator.SceneConfigs.FloatFromLeft, gestures: null };
        } else {
            sceneConfig = { ...Navigator.SceneConfigs.HorizontalSwipeJump, gestures: null };
        }
    }
    return sceneConfig;
};

const Splash = require('./modules/splash/index');

const NavigationBarRouteMapper = {
    LeftButton (route, navigator, index, navState) {
        let leftButton = route.leftButton || route.component.leftButton;
        if (index === 0 && !leftButton) {
            return null;
        }
        if (typeof leftButton === 'function') {
            leftButton = leftButton();
        }
        const image = leftButton && leftButton.image || app.img.common_back;
        const title = leftButton && leftButton.title || '';
        const isLimitLength = leftButton && leftButton.isLimitLength || false;
        const handler = leftButton && leftButton.handler || navigator.pop;
        if (image && !title) {
            return (
                <DelayTouchableOpacity
                    onPress={handler}
                    style={styles.navBarButton}>
                    <Image
                        resizeMode='stretch'
                        source={image}
                        style={styles.navBarIcon} />
                </DelayTouchableOpacity>
            );
        } else {
            return (
                <DelayTouchableOpacity
                    onPress={handler}
                    style={styles.navBarButton}>
                    {
                        isLimitLength ? <Text numberOfLines={1} style={styles.navBarButtonLimitLengthText}>{leftButton.title}</Text>
                        : <Text style={styles.navBarButtonText}>{leftButton.title}</Text>
                    }

                </DelayTouchableOpacity>
            );
        }
    },
    RightButton (route, navigator, index, navState) {
        let rightButton = route.rightButton || route.component.rightButton;
        if (typeof rightButton === 'function') {
            rightButton = rightButton();
        }
        if (!rightButton) {
            return <View style={styles.navBarRightEmptyButton} />;
        }
        if (rightButton.image) {
            return (
                <DelayTouchableOpacity
                    onPress={rightButton.handler}
                    style={styles.navBarButton}>
                    <Image
                        resizeMode='stretch'
                        source={rightButton.image}
                        style={styles.navBarIcon} />
                </DelayTouchableOpacity>
            );
        } else {
            return (
                <DelayTouchableOpacity
                    onPress={rightButton.handler}
                    style={styles.navBarButton}>
                    <Text style={styles.navBarButtonText}>
                        {rightButton.title}
                    </Text>
                </DelayTouchableOpacity>
            );
        }
    },
    Title (route, navigator, index, navState) {
        const title = route.title || route.component.title;
        if (typeof title === 'function') {
            return (
                <View style={styles.titleContainer}>
                    <Text
                        numberOfLines={1}
                        style={styles.navBarTitleText}>
                        {title()}
                    </Text>
                </View>
            );
        } else if (typeof title === 'string') {
            return (
                <View style={styles.titleContainer}>
                    <Text
                        numberOfLines={1}
                        style={styles.navBarTitleText}>
                        {title}
                    </Text>
                </View>
            );
        } else {
            return (
                <View style={styles.titleContainer}>
                    {title}
                </View>
            );
        }
    },
};

module.exports = React.createClass({
    mixins: [TimerMixin],
    getInitialState () {
        return {
            showNavBar: false,
            modalShow: false,
            modalContent: null,
            modalBackgroundColor: null,
            modalTouchHide: false,
        };
    },
    componentWillMount () {
        // if (!app.isandroid) {
        //     NativeModules.AccessibilityManager.setAccessibilityContentSizeMultipliers({
        //         'extraSmall': 1,
        //         'small': 1,
        //         'medium': 1,
        //         'large': 1,
        //         'extraLarge': 1,
        //         'extraExtraLarge': 1,
        //         'extraExtraExtraLarge': 1,
        //         'accessibilityMedium': 1,
        //         'accessibilityLarge': 1,
        //         'accessibilityExtraLarge': 1,
        //         'accessibilityExtraExtraLarge': 1,
        //         'accessibilityExtraExtraExtraLarge': 1,
        //     });
        // }
        app.root = this;
        app.showLoading = () => {
            this.refs.progressHud.show();
        };
        app.hideLoading = () => {
            this.refs.progressHud.hide();
        };
        StatusBar.setBackgroundColor('transparent');
        StatusBar.setTranslucent(true);
        app.showModal = (view, options = {}) => {
            const { backgroundColor, touchHide } = options;
            this.setState({
                modalShow: true,
                modalContent: view,
                modalBackgroundColor: backgroundColor,
                modalTouchHide: touchHide,
            });
        };
        app.closeModal = () => {
            this.refs.modal.closeModal();
        };
        app.removeModal = () => {
            this.setState({
                modalShow: false,
            });
        };
        app.update = () => {
            this.setState({});
        };
        app.forceUpdateNavbar = () => {
            this.setState({
                showNavBar: true,
            });
        };
        app.toggleNavigationBar = (show) => {
            this.setImmediate(() => {
                this.setState({ showNavBar:show });
            });
        };
        app.getCurrentRoute = (index = 0) => {
            const { routeStack, presentedIndex } = app.navigator.state;
            return routeStack[presentedIndex - index];
        };
        app.push = (params) => {
            app.navigator.push(params);
        };
        app.pop = (step = 1) => {
            if (step === 1) {
                app.navigator.pop();
            } else {
                const routes = app.navigator.getCurrentRoutes();
                const index = routes.length - step - 1;
                if (index > 0) {
                    app.navigator.popToRoute(routes[index]);
                } else {
                    app.navigator.popToTop();
                }
            }
        };
        if (app.isandroid) {
            BackAndroid.addEventListener('hardwareBackPress', () => {
                if (this.state.is_hud_visible) {
                    this.setState({ is_hud_visible: false });
                    return true;
                }
                if (this.state.modalShow) {
                    this.setState({ modalShow: false });
                    return true;
                }
                const routes = app.navigator.getCurrentRoutes();
                if (routes.length > 1) {
                    const leftButton = routes[routes.length - 1].component.leftButton;
                    if (leftButton && leftButton.handler) {
                        leftButton.handler();
                    } else {
                        app.pop();
                    }
                    return true;
                }
                if (!this.willExitAndroid) {
                    Toast('再按一次返回键退出程序');
                    this.willExitAndroid = true;
                    this.setTimeout(() => { this.willExitAndroid = false; }, 3000);
                    return true;
                }
                return false;
            });
        }
    },
    componentDidMount: function () {
        // app.net.register();
        app.jpush.register();
    },
    configureScene (route) {
        return app.configureScene(route);
    },
    renderScene (route, navigator) {
        return (
            <View style={{ flex: 1 }}>
                {this.state.showNavBar && <View style={[styles.navBarBack, { backgroundColor: app.setting.THEME_COLOR }]} />}
                <route.component
                    {...route.passProps}
                    ref={(ref) => { if (ref)route.ref = ref; }} />
            </View>
        );
    },
    render () {
        const initialRoute = {
            component: Splash,
        };
        const navigationBar = (
            <Navigator.NavigationBar
                routeMapper={NavigationBarRouteMapper}
                style={[styles.navBar, { backgroundColor: app.setting.THEME_COLOR }]}
                />
        );
        return (
            <View style={{ flex:1 }}>
                <Navigator
                    ref={(navigator) => {
                        if (navigator) {
                            app.navigator = navigator;
                        }
                    }}
                    debugOverlay={false}
                    style={styles.container}
                    initialRoute={initialRoute}
                    configureScene={this.configureScene}
                    renderScene={this.renderScene}
                    onDidFocus={(route) => {
                        if (route) {
                            const ref = route.ref;
                            const getChildScene = ref && ref.getChildScene;
                            // 注意：app.scene调用的时候一定需要使用封装函数，如：{handler: ()=>{app.scene.toggleEdit()}}，不能直接使用 handler: app.scene.toggleEdit.
                            // 在动画加载完成前 app.scene 还没有被赋值， 需要使用 SceneMixin 来设置 app.scene
                            const scene = app.scene = getChildScene ? getChildScene() : ref;
                            if (getChildScene && !scene.hasMouted) {
                                scene.hasMouted = true;
                                return;
                            }
                            scene && scene.onDidFocus && scene.onDidFocus();
                            // 如果时主页面，需要检测主页面和其子页面的回调
                            ref && ref !== scene && ref.onDidFocus && ref.onDidFocus();
                        }
                    }}
                    onWillFocus={(route) => {
                        if (route) {
                            const preRoute = app.navigator && app.getCurrentRoute();
                            if (preRoute) {
                                const preRef = preRoute.ref;
                                const preGetChildScene = preRef && preRef.getChildScene;
                                const preScene = preGetChildScene ? preGetChildScene() : preRef;
                                preScene && preScene.onWillHide && preScene.onWillHide();
                                // 如果时主页面，需要检测主页面和其子页面的回调
                                preRef && preRef !== preScene && preRef.onWillHide && preRef.onWillHide();
                            }
                            const ref = route.ref;
                            const getChildScene = ref && ref.getChildScene;
                            const scene = getChildScene ? getChildScene() : ref;
                            // 如果时主页面，需要检测主页面和其子页面的回调
                            scene && scene.onWillFocus && scene.onWillFocus();// 注意：在首次加载的时候页面没有被加载，route.ref为空，不会调用该函数，需要在该页面的componentWillMount里面处理首次逻辑，只有从上页面返回的时候才能被调用
                            ref && ref !== scene && ref.onWillFocus && ref.onWillFocus();
                        }
                    }}
                    navigationBar={this.state.showNavBar ? navigationBar : null}
                    />
                {
                    this.state.modalShow &&
                    <Modal ref='modal' backgroundColor={this.state.modalBackgroundColor} modalTouchHide={this.state.modalTouchHide}>
                        {this.state.modalContent}
                    </Modal>
                }
                <ProgressHud
                    ref='progressHud'
                    overlayColor='rgba(0, 0, 0, 0.6)'
                    color={app.setting.THEME_COLOR}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor:'#EEEEEE',
    },
    navBarBack: {
        height:sr.totalNavbarHeight,
    },
    navBar: {
        alignItems:'center',
        height: sr.totalNavbarHeight,
    },
    titleContainer: {
        width: sr.w,
        height: sr.navbarHeight,
        alignItems:'center',
        justifyContent: 'center',
        paddingTop: sr.translucent ? sr.statusBarHeight : 0,
    },
    navBarButtonLimitLengthText: {
        color: '#FFFFFF',
        fontSize: 14,
        width:80,
    },
    navBarButtonText: {
        color: '#FFFFFF',
        fontSize: 16,
    },
    navBarTitleText: {
        fontSize: 18,
        color: '#FFFFFF',
        textAlign: 'center',
        fontWeight: '500',
        width: sr.w / 2,
    },
    navBarButton: {
        flexDirection: 'row',
        paddingHorizontal: 10,
        height:sr.navbarHeight,
        alignItems: 'center',
        paddingTop: sr.translucent ? sr.statusBarHeight / 2 : 0,
    },
    navBarRightEmptyButton: {
        width: 80,
        height: sr.navbarHeight,
    },
    navBarIcon: {
        width: sr.navbarHeight * (sr.translucent ? 0.2 : 0.4),
        height: sr.navbarHeight * (sr.translucent ? 0.2 : 0.4),
    },
});

```

* PDClient/project/App/components/AutogrowInput.js

```js
import React, { Component } from 'react';
import {
    TextInput,
    StyleSheet,
} from 'react-native';

class Input extends Component {
    constructor () {
        super();
        this.state = {
            height: 35,
        };
    }
    componentWillMount () {
        const { maxLines, style, maxHeight } = this.props;
        const { height, lineHeight, fontSize } = StyleSheet.flatten(style);
        this.defaultHeight = height;
        this.maxHeight = maxLines ? (maxLines * (lineHeight || fontSize * 1.5)) : maxHeight || 99999;
        if (this.defaultHeight) {
            this.setState({ height:this.defaultHeight });
        }
    }
    handleChange (event) {
        const { onChange } = this.props;
        const { height } = event.nativeEvent.contentSize;

        if (this.state.height !== height && height < this.maxHeight) {
            this.setState({
                height: Math.min(Math.max(this.defaultHeight, height), this.maxHeight),
            });
        }
        onChange && onChange(event);
    }
    resetInputText () {
        this.refs.input.setNativeProps({ text: '' });
        this.setState({ height: this.defaultHeight });
    }
    render () {
        return (
            <TextInput
                ref='input'
                multiline
                {...this.props}
                style={[this.props.style, { height: this.state.height }]}
                onChange={this.handleChange.bind(this)}
                />
        );
    }
}

Input.propTypes = {
    style: React.PropTypes.oneOfType([
        React.PropTypes.number,
        React.PropTypes.array,
        React.PropTypes.object,
    ]),
    onChange: React.PropTypes.func,
};

module.exports = Input;

```

* PDClient/project/App/components/Button.js

```js
'use strict';

const React = require('react');const { PropTypes } = React;const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    TouchableOpacity,
} = ReactNative;

const DEFAULT_OPACITY = 0.8;

module.exports = React.createClass({
    propTypes: {
        onPress: PropTypes.func,
        disable: PropTypes.bool,
        textStyle: PropTypes.style,
        activeOpacity: PropTypes.number,
    },
    render () {
        const touchableProps = {
            activeOpacity: this.props.disable ? 1 : this.props.activeOpacity ? this.props.activeOpacity : DEFAULT_OPACITY,
        };
        if (!this.props.disable) {
            touchableProps.onPress = this.props.onPress;
        }
        return (
            <TouchableOpacity
                style={[styles.container, { backgroundColor:app.setting.THEME_COLOR }, this.props.style]} {...touchableProps}
                testID={this.props.testID}>
                <Text style={[styles.text, this.props.disable ? styles.disableText : null, this.props.textStyle]}
                    numberOfLines={1}>
                    {this.props.children}
                </Text>
            </TouchableOpacity>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        borderRadius: 10,
        alignItems:'center',
        justifyContent:'center',
    },
    text: {
        color: '#FFFFFF',
        fontSize: 18,
        fontWeight: '100',
        textAlign: 'center',
        overflow: 'hidden',
    },
    disableText: {
        color: '#dcdcdc',
    },
});

```

* PDClient/project/App/components/ClipRect.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Shape,
    Surface,
    Path,
} = ReactNative.ART;

const ClipRectIOS = React.createClass({
    render: function () {
        const style = ReactNative.StyleSheet.flatten(this.props.style);
        let { width, height, borderRadius, borderTopLeftRadius, borderTopRightRadius, borderBottomRightRadius, borderBottomLeftRadius, color } = style;
        borderRadius = borderRadius || 0;
        const tl = borderTopLeftRadius || borderRadius;
        const tr = borderTopRightRadius || borderRadius;
        const br = borderBottomRightRadius || borderRadius;
        const bl = borderBottomLeftRadius || borderRadius;

        const path = Path();

        path.move(0, tl);

        if (tl > 0) { path.arc(tl, -tl); }
        path.line(width - (tr + tl), 0);

        if (tr > 0) { path.arc(tr, tr); }
        path.line(0, height - (tr + br));

        if (br > 0) { path.arc(-br, br); }
        path.line(-width + (br + bl), 0);

        if (bl > 0) { path.arc(-bl, -bl); }
        path.line(0, bl)
        .line(width, 0)
        .line(0, -height)
        .line(-width, 0);

        return (
            <Surface width={width} height={height} style={{ backgroundColor:'transparent' }}>
                <Shape d={path} fill={color} />
            </Surface>
        );
    },
});

const TIMES = 30;
const _X = (r, d) => Math.cos(Math.PI / 180 * d) * r;
const _Y = (r, d) => Math.sin(Math.PI / 180 * d) * r;
const arc = (path, x, y, r, t) => {
    const offset = 90 / TIMES;
    for (let i = 0; i <= TIMES; i++) {
        path.lineTo(x - _X(r, 90 * t + offset * i), y - _Y(r, 90 * t + offset * i));
    }
};

const ClipRectAndroid = React.createClass({
    render: function () {
        const style = ReactNative.StyleSheet.flatten(this.props.style);
        let { width, height, borderRadius, borderTopLeftRadius, borderTopRightRadius, borderBottomRightRadius, borderBottomLeftRadius, color } = style;
        borderRadius = borderRadius || 0;
        const tl = borderTopLeftRadius || borderRadius;
        const tr = borderTopRightRadius || borderRadius;
        const br = borderBottomRightRadius || borderRadius;
        const bl = borderBottomLeftRadius || borderRadius;

        const path = Path();

        path.move(0, tl);

        if (tl > 0) { arc(path, tl, tl, tl, 0); }
        path.line(width - (tr + tl), 0);

        if (tr > 0) { arc(path, width - tr, tr, tr, 1); }
        path.line(0, height - (tr + br));

        if (br > 0) { arc(path, width - br, height - br, br, 2); }
        path.line(-width + (br + bl), 0);

        if (bl > 0) { arc(path, bl, height - bl, bl, 3); }
        path.line(0, bl)
        .line(width, 0)
        .line(0, -height)
        .line(-width, 0);

        return (
            <Surface width={width} height={height} style={{ backgroundColor:'transparent' }}>
                <Shape d={path} fill={color} />
            </Surface>
        );
    },
});

module.exports = ReactNative.Platform.OS === 'android' ? ClipRectAndroid : ClipRectIOS;

```

* PDClient/project/App/components/CustomMessageBox.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    TouchableHighlight,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps: function () {
        return {
            title: '温馨提示',
            cancelText: '取消',
            confirmText: '确定',
            width: 312,
        };
    },
    doConfirm () {
        const { onConfirm } = this.props;
        if (!onConfirm || !onConfirm()) {
            app.closeModal();
        }
    },
    doCancel () {
        const { onCancel } = this.props;
        if (onCancel === true || !onCancel || !onCancel()) {
            app.closeModal();
        }
    },
    render () {
        const { title, width, onCancel, cancelText, confirmText } = this.props;
        return (
            <View style={[styles.container, { width }]}>
                { !!title && <Text style={styles.title}>{title}</Text> }
                { !!title && <Text style={[styles.redLine, { width: width * 0.8 }]} /> }
                <View style={styles.content}>
                    {this.props.children}
                </View>
                <Text style={[styles.H_Line, { width }]} />
                <View style={[styles.buttonViewStyle, { width: width - 20 }]}>
                    {!!onCancel &&
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doCancel}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: 'red' }]}>{cancelText}</Text>
                    </TouchableHighlight>
                        }
                    {!!onCancel &&
                    <Text style={styles.line} />
                        }
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doConfirm}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: '#0076FF' }]} >{confirmText}</Text>
                    </TouchableHighlight>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#FFFFFF',
        borderRadius:10,
    },
    buttonViewStyle: {
        flexDirection: 'row',
        height: 50,
    },
    H_Line: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#b4b4b4',
    },
    redLine: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#ff3c30',
    },
    line: {
        width: 1,
        height: 50,
        backgroundColor: '#b4b4b4',
    },
    buttonStyleContain: {
        height: 50,
        flex: 1,
        justifyContent:'center',
        alignItems:'center',
    },
    buttonStyle: {
        fontSize: 15,
        color: '#000000',
    },
    title: {
        color: '#ff3c30',
        fontSize: 16,
        fontWeight: '100',
        textAlign: 'center',
        overflow: 'hidden',
        marginTop:20,
    },
    content: {
        alignSelf:'center',
        color:'#000000',
        marginTop: 20,
        width:sr.w/2,
    },
});

```

* PDClient/project/App/components/CustomSheet.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    TouchableOpacity,
    View,
} = ReactNative;

const Overlay = require('./ActionSheet/overlay');
const Sheet = require('./ActionSheet/sheet');

module.exports = React.createClass({
    render () {
        const { visible, onCancel } = this.props;
        return (
            <Overlay visible={visible}>
                <View style={styles.actionSheetContainer}>
                    <TouchableOpacity
                        style={{ flex:1 }}
                        onPress={onCancel} />
                    <Sheet visible={visible}>
                        {this.props.children}
                    </Sheet>
                </View>
            </Overlay>
        );
    },
});

const styles = StyleSheet.create({
    actionSheetContainer: {
        flex: 1,
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
    },
});

```

* PDClient/project/App/components/DImage.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    View,
} = ReactNative;

const DImage = React.createClass({
    getInitialState () {
        return { showDefault: true };
    },
    onLoad () {
        this.setState({ showDefault: false });
    },
    componentWillReceiveProps (nextProps) {
        const pre = this.props.source, post = nextProps.source;
        const preuri = pre.uri, posturi = post.uri;
        const preT = typeof posturi === 'string', postT = typeof posturi === 'string';
        if ((!(preT ^ postT)) && preuri !== posturi) {
            this.setState({ showDefault: true });
        }
    },
    render () {
        const { source, defaultSource, ...other } = this.props;
        const { showDefault } = this.state;
        return (
            showDefault ?
                <View>
                    <Image source={defaultSource} {...other}>{this.props.children}</Image>
                    <Image style={{ left:-1, top:-1, position:'absolute', width:1, height:1 }} source={source} onLoad={this.onLoad} />
                </View>
            :
                <Image source={source} {...other} >{this.props.children}</Image>
        );
    },
});

module.exports = DImage;

```

* PDClient/project/App/components/DelayTouchableOpacity.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    TouchableOpacity,
} = ReactNative;

const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    componentWillMount () {
        this.enable = true;
        this.onPress = (e) => {
            if (this.enable) {
                this.enable = false;
                this.props.onPress(e);
                this.setTimeout(() => { this.enable = true; }, this.props.delayTime || 200);
            }
        };
    },
    render () {
        return (
            <TouchableOpacity
                {...this.props}
                onPress={this.onPress}
                >
                {this.props.children}
            </TouchableOpacity>
        );
    },
});

```

* PDClient/project/App/components/Label.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

module.exports = React.createClass({
    render () {
        const { img, children, style, textStyle } = this.props;
        return (
            <View style={[styles.labelContainer, style]}>
                {!!img && <Image resizeMode='stretch' source={img} style={styles.labelIcon} />}
                <Text style={[styles.label, textStyle]}>{children}:</Text>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    labelContainer: {
        marginTop: 10,
        marginBottom: 6,
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    label: {
        color: '#969696',
        fontSize: 14,
    },
    labelIcon: {
        width: 20,
        height: 20,
        tintColor: '#A3A3A3',
    },
});

```

* PDClient/project/App/components/MessageBox.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    TouchableHighlight,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps: function () {
        return {
            title: '温馨提示',
            content: '确定要执行操作吗？',
            cancelText: '取消',
            confirmText: '确定',
            width: 312,
        };
    },
    doConfirm () {
        const { onConfirm } = this.props;
        if (!onConfirm || !onConfirm()) {
            app.closeModal();
        }
    },
    doCancel () {
        const { onCancel } = this.props;
        if (onCancel === true || !onCancel || !onCancel()) {
            app.closeModal();
        }
    },
    render () {
        const { title, width, content, onCancel, cancelText, confirmText } = this.props;
        return (
            <View style={[styles.container, { width }]}>
                { !!title && <Text style={styles.title}>{title}</Text> }
                { !!title && <Text style={[styles.redLine, { width: width * 0.8 }]} /> }
                <Text style={styles.content}>
                    {content}
                </Text>
                <Text style={[styles.H_Line, { width }]} />
                <View style={[styles.buttonViewStyle, { width: width - 20 }]}>
                    {!!onCancel &&
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doCancel}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: 'red' }]}>{cancelText}</Text>
                    </TouchableHighlight>
                        }
                    {!!onCancel &&
                    <Text style={styles.line} />
                        }
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doConfirm}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: '#0076FF' }]} >{confirmText}</Text>
                    </TouchableHighlight>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#FFFFFF',
        borderRadius:10,
    },
    buttonViewStyle: {
        flexDirection: 'row',
        height: 50,
    },
    H_Line: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#b4b4b4',
    },
    redLine: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#ff3c30',
    },
    line: {
        width: 1,
        height: 50,
        backgroundColor: '#b4b4b4',
    },
    buttonStyleContain: {
        height: 50,
        flex: 1,
        justifyContent:'center',
        alignItems:'center',
    },
    buttonStyle: {
        fontSize: 15,
        color: '#000000',
    },
    title: {
        color: '#ff3c30',
        fontSize: 16,
        fontWeight: '100',
        textAlign: 'center',
        overflow: 'hidden',
        marginTop:20,
    },
    content: {
        alignSelf:'center',
        color:'#000000',
        margin: 20,
        marginTop: 30,
    },
});

```

* PDClient/project/App/components/Modal.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Animated,
    PanResponder,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            backgroundColor: 'rgba(0, 0, 0, 0.5)',
        };
    },
    getInitialState () {
        return {
            opacity: new Animated.Value(0),
        };
    },
    componentWillMount () {
        this._panResponder = PanResponder.create({
            onStartShouldSetPanResponder: (e, gestureState) => true,
            onPanResponderGrant: (e, gestureState) => {
                this.closeModal();
            },
        });
    },
    componentDidMount () {
        Animated.timing(this.state.opacity, {
            toValue: 1,
            duration: 500,
        }
        ).start();
    },
    closeModal () {
        Animated.timing(this.state.opacity, {
            toValue: 0,
            duration: 500,
        }
        ).start(() => {
            app.removeModal();
        });
    },
    render () {
        const { modalTouchHide } = this.props;
        return (
            <Animated.View style={[styles.container, { backgroundColor: this.props.backgroundColor, opacity: this.state.opacity }]} {...(modalTouchHide ? this._panResponder.panHandlers : {})}>
                {this.props.children}
            </Animated.View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        position: 'absolute',
        top: 0,
        bottom: 0,
        left: 0,
        right: 0,
        alignItems:'center',
        justifyContent: 'center',
    },
});

```

* PDClient/project/App/components/PageList.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    View,
    Text,
    StyleSheet,
    FlatList,
} = ReactNative;

const STATUS = {
    /* loading more status change graph
    *
    * STATUS_TEXT_HIDE->[STATUS_HAVE_MORE, STATUS_START_LOAD]
    * STATUS_START_LOAD->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_HAVE_MORE->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_ALL_LOADED->[STATUS_TEXT_HIDE]
    */
    STATUS_TEXT_HIDE: 0,
    STATUS_START_LOAD: 1,
    STATUS_HAVE_MORE: 2,
    STATUS_NO_DATA: 3,
    STATUS_ALL_LOADED: 4,
    STATUS_LOAD_ERROR: 5,
};
const TEXT = {
    0: '',
    1: '',
    2: '正在加载更多...',
    3: '暂无数据!',
    4: '全部加载完成',
    5: '加载错误，请稍后再试',
};

const { STATUS_TEXT_HIDE, STATUS_START_LOAD, STATUS_HAVE_MORE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR } = STATUS;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            autoLoad: true,
            pageNo: 0,
            style: { flex: 1 },
            pageSize: CONSTANTS.PER_PAGE_COUNT,
        };
    },
    componentDidMount () {
        if (this.props.autoLoad) {
            this.getList();
        }
    },
    updateList (callback) {
        this.list = callback(this.list);
        this.setState({
            dataSource: this.list,
        });
    },
    getInitialState () {
        const { list, pageNo, autoLoad } = this.props;
        this.list = list || [];
        this.pageNo = pageNo;
        return {
            dataSource: this.list,
            infiniteLoadStatus: list ? (list.length === 0 ? STATUS_NO_DATA : list.length < CONSTANTS.PER_PAGE_COUNT ? STATUS_ALL_LOADED : STATUS_TEXT_HIDE) : !autoLoad ? STATUS_TEXT_HIDE : STATUS_START_LOAD,
        };
    },
    componentDidUpdate (prevProps, prevState) {
        if (!_.isEqual(prevProps.listParam, this.props.listParam)) {
            this.refresh();
        }
    },
    getList (wait) {
        const param = {
            ...this.props.listParam,
            pageNo: this.pageNo,
            pageSize: this.props.pageSize,
        };
        this.setState({ infiniteLoadStatus: this.pageNo === 0 ? STATUS_START_LOAD : STATUS_HAVE_MORE });
        POST(this.props.listUrl, param, this.getListSuccess, this.getListFailed, wait);
    },
    getListSuccess (data) {
        this.props.onGetList && this.props.onGetList(data, this.pageNo);
        if (data.success) {
            const list = _.get(data.context, this.props.listName);
            const infiniteLoadStatus = (!list.length && this.pageNo === 0) ? STATUS_NO_DATA : list.length < this.props.pageSize ? STATUS_ALL_LOADED : STATUS_TEXT_HIDE;
            this.list = this.list.concat(list);
            this.setState({
                dataSource: this.list,
                infiniteLoadStatus: infiniteLoadStatus,
            });
        } else {
            if (this.props.ListFailedText) {
                this.setState({ infiniteLoadStatus: this.props.ListFailedText });
            } else {
                this.getListFailed();
            }
        }
    },
    getListFailed () {
        this.pageNo--;
        this.setState({ infiniteLoadStatus: STATUS_LOAD_ERROR });
    },
    onEndReached () {
        if (this.state.infiniteLoadStatus !== STATUS_TEXT_HIDE || this.props.disable) {
            return;
        }
        this.pageNo++;
        if (this.pageNo > 0) {
            this.getList();
        }
    },
    refresh () {
        if (this.isRefreshing()) {
            return;
        }
        this.list = [];
        this.setState({
            dataSource: this.list,
        });
        this.pageNo = 0;
        this.getList();
    },
    isRefreshing () {
        return (this.state.infiniteLoadStatus === STATUS_START_LOAD || this.state.infiniteLoadStatus === STATUS_HAVE_MORE);
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View
                style={styles.separator}
                key={sectionID + rowID} />
        );
    },
    renderFooter () {
        const status = this.state.infiniteLoadStatus;
        return (
            <View style={styles.listFooterContainer}>
                <Text style={styles.listFooter}>
                    {typeof status === 'string' ? status : status === STATUS_NO_DATA && this.props.ListFailedText ? this.props.ListFailedText : TEXT[status]}
                </Text>
            </View>
        );
    },
    render () {
        return (
            <FlatList
                onEndReached={this.onEndReached}
                onEndReachedThreshold={10}
                initialListSize={this.props.pageSize}
                enableEmptySections
                removeClippedSubviews={false}
                style={[{ alignSelf:'stretch' }, this.props.style]}
                data={this.state.dataSource}
                renderItem={({ item, index }) => this.props.renderRow(item, index)}
                ItemSeparatorComponent={this.props.renderSeparator === undefined ? this.renderSeparator : this.props.renderSeparator}
                ListFooterComponent={this.renderFooter}
                refreshing={this.state.infiniteLoadStatus === STATUS_START_LOAD}
                onRefresh={this.refresh}
                />
        );
    },
});
module.exports.STATUS = STATUS;

const styles = StyleSheet.create({
    listFooterContainer: {
        height: 60,
        alignItems: 'center',
        paddingTop: 10,
    },
    listFooter: {
        color: 'gray',
        fontSize: 12,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDClient/project/App/components/PageListView.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    View,
    Text,
    StyleSheet,
    ListView,
    RefreshControl,
} = ReactNative;

const STATUS = {
    /* loading more status change graph
    *
    * STATUS_TEXT_HIDE->[STATUS_HAVE_MORE, STATUS_START_LOAD]
    * STATUS_START_LOAD->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_HAVE_MORE->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_ALL_LOADED->[STATUS_TEXT_HIDE]
    */
    STATUS_TEXT_HIDE: 0,
    STATUS_START_LOAD: 1,
    STATUS_HAVE_MORE: 2,
    STATUS_NO_DATA: 3,
    STATUS_ALL_LOADED: 4,
    STATUS_LOAD_ERROR: 5,
};
const TEXT = {
    0: '',
    1: '',
    2: '正在加载更多...',
    3: '暂无数据!',
    4: '全部加载完成',
    5: '加载错误，请稍后再试',
};

const { STATUS_TEXT_HIDE, STATUS_START_LOAD, STATUS_HAVE_MORE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR } = STATUS;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            autoLoad: true,
            pageNo: 0,
            infiniteLoadStatus: STATUS_START_LOAD,
            style: { flex: 1 },
            pageSize: CONSTANTS.PER_PAGE_COUNT,
        };
    },
    componentDidMount () {
        if (this.props.autoLoad) {
            this.getList();
        }
    },
    updateList (callback) {
        this.list = callback(this.list);
        this.setState({
            dataSource: this.ds.cloneWithRows(this.list),
        });
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        this.list = this.props.list || [];
        this.pageNo = this.props.pageNo;
        return {
            dataSource: this.ds.cloneWithRows(this.list),
            infiniteLoadStatus: this.props.infiniteLoadStatus,
        };
    },
    componentDidUpdate (prevProps, prevState) {
        if (!_.isEqual(prevProps.listParam, this.props.listParam)) {
            this.refresh();
        }
    },
    getList (wait) {
        const param = {
            ...this.props.listParam,
            pageNo: this.pageNo,
            pageSize: this.props.pageSize,
        };
        this.setState({ infiniteLoadStatus: this.pageNo === 0 ? STATUS_START_LOAD : STATUS_HAVE_MORE });
        POST(this.props.listUrl, param, this.getListSuccess, this.getListFailed, wait);
    },
    getListSuccess (data) {
        this.props.onGetList && this.props.onGetList(data, this.pageNo);
        if (data.success) {
            const list = _.get(data.context, this.props.listName);
            const infiniteLoadStatus = (!list.length && this.pageNo === 0) ? STATUS_NO_DATA : list.length < this.props.pageSize ? STATUS_ALL_LOADED : STATUS_TEXT_HIDE;
            this.list = this.list.concat(list);
            this.setState({
                dataSource: this.ds.cloneWithRows(this.list),
                infiniteLoadStatus: infiniteLoadStatus,
            });
        } else {
            if (this.props.ListFailedText) {
                this.setState({ infiniteLoadStatus: this.props.ListFailedText });
            } else {
                this.getListFailed();
            }
        }
    },
    getListFailed () {
        this.pageNo--;
        this.setState({ infiniteLoadStatus: STATUS_LOAD_ERROR });
    },
    onEndReached () {
        if (this.state.infiniteLoadStatus !== STATUS_TEXT_HIDE || this.props.disable) {
            return;
        }
        this.pageNo++;
        this.getList();
    },
    refresh () {
        if (this.isRefreshing()) {
            return;
        }
        this.list = [];
        this.setState({
            dataSource: this.ds.cloneWithRows(this.list),
        });
        this.pageNo = 0;
        this.getList();
    },
    isRefreshing () {
        return (this.state.infiniteLoadStatus === STATUS_START_LOAD || this.state.infiniteLoadStatus === STATUS_HAVE_MORE);
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View
                style={styles.separator}
                key={sectionID + rowID} />
        );
    },
    renderFooter () {
        const status = this.state.infiniteLoadStatus;
        return (
            <View style={styles.listFooterContainer}>
                <Text style={styles.listFooter}>
                    {typeof status === 'string' ? status : status === STATUS_NO_DATA && this.props.ListFailedText ? this.props.ListFailedText : TEXT[status]}
                </Text>
            </View>
        );
    },
    render () {
        return (
            <ListView                onEndReached={this.onEndReached}
                onEndReachedThreshold={10}
                initialListSize={this.props.pageSize}
                enableEmptySections
                removeClippedSubviews={false}
                style={[{ alignSelf:'stretch' }, this.props.style]}
                dataSource={this.state.dataSource}
                renderRow={this.props.renderRow}
                renderSeparator={this.props.renderSeparator === undefined ? this.renderSeparator : this.props.renderSeparator}
                renderFooter={this.renderFooter}
                refreshControl={
                    this.props.refreshEnable ?
                        <RefreshControl
                            refreshing={this.state.infiniteLoadStatus === STATUS_START_LOAD}
                            onRefresh={this.refresh}
                            title='正在刷新...' />
                    : null
                }
                />
        );
    },
});
module.exports.STATUS = STATUS;

const styles = StyleSheet.create({
    listFooterContainer: {
        height: 60,
        alignItems: 'center',
        paddingTop: 10,
    },
    listFooter: {
        color: 'gray',
        fontSize: 12,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDClient/project/App/components/Picker.js

```js
'use strict';

import Picker from 'react-native-picker';

module.exports = (pickerData, selectedValue, title) => {
    const color = Math.floor(app.setting.THEME_COLOR.replace('#', '0x'));
    const pickerToolBarBg = [(color >> 16) & 0xff, (color >> 8) & 0xff, color & 0xff, 1];
    return new Promise(async(resolve) => {
        Picker.isPickerShow((show) => {
            if (show) {
                Picker.hide();
            } else {
                Picker.init({
                    pickerConfirmBtnText: '确定',
                    pickerConfirmBtnColor: [0, 0, 255, 1],
                    pickerCancelBtnText: '取消',
                    pickerCancelBtnColor: [255 - pickerToolBarBg[0] / 2, 255 - pickerToolBarBg[1] / 2, 255 - pickerToolBarBg[2] / 2, 1],
                    pickerTitleText: title || '',
                    pickerTitleColor: [255, 255, 255, 1],
                    pickerToolBarBg,
                    pickerBg: [207, 207, 207, 1],
                    pickerFontColor: [0, 0, 0, 1],
                    pickerToolBarFontSize: 16,
                    pickerFontSize: 16,
                    pickerData,
                    selectedValue,
                    onPickerConfirm: (value) => { resolve(value); },
                });
                Picker.show();
            }
        });
    });
};
module.exports.hide = () => {
    Picker.isPickerShow((show) => {
        Picker.hide();
    });
};

```

* PDClient/project/App/components/ProgressBar.js

```js
const React = require('react');const ReactNative = require('react-native');

const {
    StyleSheet,
    View,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            progress: 0,
        };
    },
    render () {
        const fillWidth = this.props.progress * this.props.style.width;
        return (
            <View style={[styles.background, this.props.backgroundStyle, this.props.style]}>
                <View style={[styles.fill, this.props.fillStyle, { width: fillWidth }]} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    background: {
        backgroundColor: '#bbbbbb',
        height: 5,
        overflow: 'hidden',
    },
    fill: {
        backgroundColor: '#3b5998',
        height: 5,
    },
});

```

* PDClient/project/App/components/ProgressHud.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');

const {
    Image,
    StyleSheet,
    TouchableHighlight,
    View,
    Animated,
    Easing,
} = ReactNative;

const BACKGROUND_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjBFOTY2OTRGMDlBMTFFNUFGQUVDMUUwNDA5REUwMzQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NjBFOTY2OTVGMDlBMTFFNUFGQUVDMUUwNDA5REUwMzQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2MEU5NjY5MkYwOUExMUU1QUZBRUMxRTA0MDlERTAzNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2MEU5NjY5M0YwOUExMUU1QUZBRUMxRTA0MDlERTAzNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrUpG+0AAATlSURBVHjazJpLjBVVEIa7+zYzlwGG4WF0RhkJj4EEY3yigiyU3STiYjbCRmQFC1gQEkIISzUxonHpRqOGBQnxsTImhFcIMYIhZKLyUgENyjPD8JCBud1WOX/r8aROnb7PvpV8uTOdvn3P31V1Tp3qDtM0DRpkITD/T8Fd4iZxhThHnCK+J/YTvzfkx+sUwoMtgexCqUDiOM78ROwmdhEXWi0kIiYZAnwkOc6pEF8Q7xDDzRbCHugk4pwCqhFinsve2YFQbLgQ9sBkJXy0ASc1fGeE2ER8mTdE8tgUYirOD4XEdiW8ZqmRV9LxbuJjYifRUa8QHtR0ouwZeCgc94mQBi8JW4tQm1JraGUi4irjPzGOJbjW2/BoP7GYmKt81/U73xFDxF/VCGERPciLvCLGQeK4s6b1EYPEa8Qy6zqamEPEauJ+XiHTkdh5RPBFx4y7X609Q2wnVuYU8wmxNY8QFjBDWOASYd6/I92dGu0V4n1ilifk2DYQX2lCeIF7EJOAzws36/CCy3qJT4knPd65QbxMXHLNWj1I7tBBBBGjTRDB9gfxKrHPE2LTEI7i9NuBE0KFcYhIg+YZh+vrxDFPjnIoPiYJmSHcfZMAq20zRWTGU+w6lCiJQDaGjbaQGPO8KcD2xggSvFX2J2YnV64myJNHTCHdlgDbG2OuhajJ9jXyRfPKkC3EDCk7vG4Exdm7ggBzIhg09xVlS4TpjXvwSFE2jPJE8gh/PkrMiVCMRQ5CrBdF2+fW4G2WxljJQ2OPHVoV6u02EHLIyovUqpwXRQgrl0eyQrBo4xnsvMMb/4SXKSQUZq77QfvYWSE/sr/7YqsksTc77STkglEW2YvytBizVt6dXJF2R9nrlGPPdjdqIyGpUlkkMVTGjhNKbSSkU6m4b8dQOcnRMJjcRkJ6MVZpnKMxVu4uofsR+joXLbY5hkfscf4Wo/yIHCd0waVjBYuYDY+4hJxnAbeEhbBkfM5qA288h7CqQEzFWhBPZ5VtpNDbBkJWKqs6c9zca7i8MhNlflE2QCwxBm17gxfKi1luXHaU8Nmzj4EChawxwqoilPL7zQXvkrEASnCL6KECRLxAPK2EVAW7yH+FcGhd8+TKEygwW2Uc0usFL5gcQWX8vxLkF48QXhyfb9Fqz1P+FjRENG/skmqpUTTItJYQz+fLlZKmUSI2E/OVpgNzAKW9WBSehFKto9KH6bCrCSK4t7YNjbdE2afz9vsj84tSE/th4lnBM1JT4tugjiexlnG/941g4kmA1DswuzvvEYd9QgIk9jzhIlLuXAwmnplfqVEAd0FWEY97miDZ517iQ/siLiH8pReD/zrzmphs4eQp/Azxa46GRTcWuaXEQqsk0kT8SLwl9RG0R2980ZeQ4JpHpPqM67friOVxHO/ElMolzwPGYusSYIv5mXjTVcD6Hk/z7LQCCe4TUxI+S8KAS45zNRE/EB8EE6+C1LSV5bt5ENOcnXAugkB/TJ0G+usedrOae787NRF5PGLaXKwhZcUz0h0uKcc1b3C18RlxNM/gqn2Fo4y9wUCOEIs8ArTk5l7vnmratbW+VMObraeIBcod1QbsEnCC+Cao4dWnel9z4kd1i8HsnF6yucobI4TQ9VoHEjbwxTMW1Y/plT3Wg6KvbPSR72JHeg13nafUkUb8+N8CDABdKT+Sgc4IvgAAAABJRU5ErkJggg==';

const SPIN_DURATION = 1000;

const ProgressHud = React.createClass({
    getDefaultProps () {
        return {
            color: '#000',
            overlayColor: 'rgba(0, 0, 0, 0)',
        };
    },
    getInitialState () {
        return {
            visible: false,
            rotate: new Animated.Value(0),
        };
    },
    showAnimate () {
        const { rotate, visible } = this.state;
        if (visible) {
            rotate.setValue(0);
            Animated.timing(rotate, {
                toValue: 1,
                duration: SPIN_DURATION,
                easing: Easing.linear,
                useNativeDriver: true,
            }).start(() => {
                this.showAnimate();
            });
        }
    },
    show () {
        this.setState({
            visible: true,
        }, () => {
            this.showAnimate();
        });
    },
    hide () {
        const { rotate } = this.state;
        rotate.stopAnimation(() => {
            rotate.setValue(0);
            this.setState({
                visible: false,
            });
        });
    },
    onPress () {
        if (this.props.close) {
            this.props.close();
        }
    },
    render () {
        const { visible, rotate } = this.state;
        if (!visible) {
            return <View />;
        }
        return (
            <TouchableHighlight
                key='ProgressHud'
                style={[styles.overlay, { backgroundColor: this.props.overlayColor }]}
                onPress={this.onPress}
                underlayColor={this.props.overlayColor}
                activeOpacity={1}
                >
                <View style={styles.container}>
                    <Animated.Image
                        style={[styles.spinner, {
                            transform: [{
                                rotate: rotate.interpolate({
                                    inputRange: [0, 1],
                                    outputRange: ['0deg', '360deg'],
                                }),
                            }],
                        }]}
                        source={{
                            uri: BACKGROUND_IMAGE,
                            isStatic: true,
                        }}
                         />
                    <Image
                        resizeMode='cover'
                        source={app.img.splash_logo}
                        style={styles.spinner_image} />
                </View>
            </TouchableHighlight>
        );
    },
});

const styles = StyleSheet.create({
    overlay: {
        alignItems: 'center',
        justifyContent: 'center',
        flex: 1,
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
    },
    container: {
        justifyContent: 'center',
        alignItems: 'center',
        width: 100,
        height: 100,
        borderRadius: 16,
    },
    spinner: {
        alignItems: 'center',
        justifyContent: 'center',
        width: 60,
        height: 60,
        borderRadius: 60 / 2,
    },
    spinner_image: {
        position: 'absolute',
        left: 26,
        top: 26,
        width: 48,
        height: 48,
        borderRadius: 48 / 2,
    },
});

module.exports = ProgressHud;

```

* PDClient/project/App/components/RText.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    Platform,
} = ReactNative;

const RText = React.createClass({
    render () {
        const { style, ...props } = this.props;
        const s = StyleSheet.flatten(style);
        const { lineHeight, fontSize } = s;
        const paddingVertical = (lineHeight - fontSize) / 2;
        return (
            <Text
                style={[{ paddingVertical }, style]}
                testID={this.props.testID}
                {...props}
                >
                {this.props.children}
            </Text>
        );
    },
});

module.exports = Platform.OS === 'android' ? RText : Text;

```

* PDClient/project/App/components/ScoreSelect.js

```js
'use strict';
import React from 'react';
import {
    View,
    ScrollView,
    InteractionManager,
} from 'react-native';

const ViewPager = React.createClass({
    componentWillMount () {
        this.count = this.props.children.length;
    },
    componentDidMount () {
        InteractionManager.runAfterInteractions(() => {
            this.scrollView.scrollTo({ x: sr.s(160) });
        });
    },
    onScroll (e) {
        // android incompatible
        if (!e.nativeEvent.contentOffset) {
            e.nativeEvent.contentOffset = { x: e.nativeEvent.position * this.props.width };
        }
        this.updateIndex(e.nativeEvent.contentOffset.x);
    },
    updateIndex (x) {
        const { width, afterChange } = this.props;
        const selectedIndex = Math.round(x / width);
        if (this.lastSelectedIndex !== selectedIndex && selectedIndex >= 0 && selectedIndex <= this.count - 1) {
            this.lastSelectedIndex = selectedIndex;
            if (afterChange) {
                afterChange(selectedIndex);
            }
        }
    },
    render () {
        const { width, height } = this.props;
        const pages = this.props.children.map((page, i) => {
            return (<View style={{ width, height }} key={i}>{page}</View>);
        });
        return (
            <ScrollView ref={(scrollView) => { this.scrollView = scrollView; }}
                horizontal
                pagingEnabled={false}
                scrollEventThrottle={10}
                removeClippedSubviews={false}
                automaticallyAdjustContentInsets={false}
                directionalLockEnabled
                showsHorizontalScrollIndicator={false}
                showsVerticalScrollIndicator={false}
                contentContainerStyle={this.props.style}
                onScroll={this.onScroll}>
                <View style={{ width, height }} />
                {pages}
                <View style={{ width, height }} />
            </ScrollView>
        );
    },
});

module.exports = ViewPager;

```

* PDClient/project/App/components/SelectRegionAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

// type可传 0，2，3；0: 长途地址只能选到市或县，2：所有地址可以选到镇, 3: 分店路线中存在的地址，4：收货点路线中存在的地址
module.exports = React.createClass({
    statics: {
        title: '所在地',
        rightButton: { title: '确定', handler: () => { app.scene.confirm(); } },
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    confirm (obj) {
        const { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        const { confirmAddress, isNeedSelectAll } = this.props;
        if (isNeedSelectAll) {
            if (!!lastObj && lastObj.isLeaf) {
                confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), allAddress.length >= 1 ? lastObj.code : 0);
                app.pop();
            } else {
                Toast('请选择完整到货地');
            }
        } else {
            confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), allAddress.length >= 1 ? lastObj.code : 0);
            app.pop();
        }
    },
    componentWillMount () {
        const { endPointLastCode } = this.props;
        !endPointLastCode || endPointLastCode == '' ? this.getRegionAddress(0) : this.getAddressFromLastCode(endPointLastCode);
    },
    getRegionAddress (parentCode) {
        const type = this.props.type || 0;
        const param = { userId: app.personal.info.userId, parentCode, type };
        POST(app.route.ROUTE_GET_REGION_ADDRESS_LIST, param, this.getRegionAddressSuccess.bind(null, parentCode), false);
    },
    getRegionAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == 0 && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (addressLastCode) {
        const type = this.props.type || 0;
        const param = { userId: app.personal.info.userId, addressLastCode, type };
        POST(app.route.ROUTE_GET_ADDRESS_FROM_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getAddressTitleArray(data.context.addressList, addressLastCode), dataSource: data.context.addressList[0] || [] });
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        if ((!!lastObj && lastObj.isLeaf) || (!!lastObj && obj.parentCode==0 && lastObj.parentCode==0)) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) {
            this.props.confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), obj.code);
            app.pop();
        } else {
            this.getRegionAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getRegionAddress.bind(null, 0)}>
                        <Text style={styles.allAddress}>省市</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        <TouchableOpacity activeOpacity={1} style={styles.btnSelectAddress} >
                            <Text>选择地址</Text>
                        </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
});

```

* PDClient/project/App/components/SelectShortAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '短途地址',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    componentWillMount () {
        const { endPointLastCode, parentCode } = this.props;
        this.getAddressFromLastCode(parentCode, endPointLastCode);
    },
    getRegionAddress (parentCode) {
        const param = { userId: app.personal.info.userId, parentCode, type:1 };
        POST(app.route.ROUTE_GET_REGION_ADDRESS_LIST, param, this.getRegionAddressSuccess.bind(null, parentCode), false);
    },
    getRegionAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == this.props.parentCode && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (parentCode, addressLastCode) {
        const param = { userId: app.personal.info.userId, parentCode, addressLastCode };
        POST(app.route.ROUTE_GET_SEND_DOOR_ADDRESS_FROM_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getAddressTitleArray(data.context.addressList, addressLastCode), dataSource:data.context.addressList[0] || [] });
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const { style } = this.props;
        const lastObj = allAddress[allAddress.length - 1];
        if (!!lastObj && lastObj.isLeaf) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) {
            this.props.confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), obj.code);
            !style && app.pop();
        } else {
            this.getRegionAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        const { parentCode,style } = this.props;
        return (
            <View style={style || styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getRegionAddress.bind(null, parentCode)}>
                        <Text style={styles.allAddress}>区域</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        <TouchableOpacity
                            activeOpacity={1}
                            style={styles.btnSelectAddress}>
                            <Text>选择地址</Text>
                        </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
});

```

* PDClient/project/App/components/SelectStartPointAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '始发地',
        rightButton: { title: '确定', handler: () => { app.scene.confirm(); } },
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    componentWillMount () {
        const { endPointLastCode, id } = this.props;
        !endPointLastCode || endPointLastCode == '' ? this.getStartPointAddress(0) : this.getAddressFromLastCode(endPointLastCode, id);
    },
    getStartPointAddress (parentCode) {
        const param = { userId: app.personal.info.userId, parentCode };
        POST(app.route.ROUTE_GET_START_POINT_ADDRESS_LIST, param, this.getStartPointAddressSuccess.bind(null, parentCode), false);
    },
    getStartPointAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == 0 && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (addressLastCode, id) {
        const param = { userId: app.personal.info.userId, addressLastCode, isLeaf: !!id };
        POST(app.route.ROUTE_GET_START_POINT_ADDRESS_FROME_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode, id), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, id, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getStartPointTitleArray(data.context.addressList, addressLastCode, id), dataSource:data.context.addressList[0] || [] });
        }
    },
    confirm () {
        const { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        const { confirmAddress, isNeedSelectAll } = this.props;
        if (isNeedSelectAll) {
            if (!!lastObj && lastObj.isLeaf || _.includes([ 0, 4, 5, 6, 7 ], lastObj.level)) {
                if (lastObj.isShop) {
                    confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), shopId:lastObj.id, startPointLastCode:lastObj.addressRegionLastCode });
                } else if (lastObj.isAgent) {
                    confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), agentId:lastObj.id, startPointLastCode:lastObj.addressRegionLastCode });
                } else {
                    confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), startPointLastCode:lastObj.code });
                }
                app.pop();
            } else {
                Toast('请选择完整到货地');
            }
        } else {
            confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), startPointLastCode:lastObj.code });
            app.pop();
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        if ((!!lastObj && lastObj.isLeaf) || (!!lastObj && obj.parentCode==0 && lastObj.parentCode==0)) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) { // 省+市+名字
            if (obj.isShop) {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), shopId:obj.id, startPointLastCode:obj.addressRegionLastCode });
            } else if (obj.isAgent) {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), agentId:obj.id, startPointLastCode:obj.addressRegionLastCode });
            } else {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), startPointLastCode:obj.code });
            }
            app.pop();
        } else {
            this.getStartPointAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        const { style } = this.props;
        return (
            <View style={style || styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getStartPointAddress.bind(null, 0)}>
                        <Text style={styles.allAddress}>省市</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        allAddress.length != 4 &&
                            <TouchableOpacity
                                activeOpacity={1}
                                style={styles.btnSelectAddress}>
                                <Text>选择地址</Text>
                            </TouchableOpacity>
                    }
                    {
                        !!style &&
                            <TouchableOpacity
                                activeOpacity={0.6}
                                onPress={this.confirm}
                                style={styles.btnConfirmAddress}>
                                <Text>确定</Text>
                            </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
    btnConfirmAddress:{
        paddingVertical:5,
        paddingHorizontal:10,
    },
});

```

* PDClient/project/App/components/Slider.js

```js
'use strict';

const React = require('react');const {    PropTypes,} = React;const ReactNative = require('react-native');
const {
  StyleSheet,
  PanResponder,
  View,
  Platform,
} = ReactNative;

const TRACK_SIZE = 4;
const THUMB_SIZE = 20;

function Rect (x, y, width, height) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
}

Rect.prototype.containsPoint = function (x, y) {
    return (x >= this.x
          && y >= this.y
          && x <= this.x + this.width
          && y <= this.y + this.height);
};

const Slider = React.createClass({
    propTypes: {
    /**
     * Initial value of the slider. The value should be between minimumValue
     * and maximumValue, which default to 0 and 1 respectively.
     * Default value is 0.
     *
     * *This is not a controlled component*, e.g. if you don't update
     * the value, the component won't be reset to its inital value.
     */
        value: PropTypes.number,

    /**
     * Initial minimum value of the slider. Default value is 0.
     */
        minimumValue: PropTypes.number,

    /**
     * Initial maximum value of the slider. Default value is 1.
     */
        maximumValue: PropTypes.number,

    /**
     * The color used for the track to the left of the button. Overrides the
     * default blue gradient image.
     */
        minimumTrackTintColor: PropTypes.string,

    /**
     * The color used for the track to the right of the button. Overrides the
     * default blue gradient image.
     */
        maximumTrackTintColor: PropTypes.string,

    /**
     * The color used for the thumb.
     */
        thumbTintColor: PropTypes.string,

    /**
     * The size of the touch area that allows moving the thumb.
     * The touch area has the same center has the visible thumb.
     * This allows to have a visually small thumb while still allowing the user
     * to move it easily.
     * The default is {width: 40, height: 40}.
     */
        thumbTouchSize: PropTypes.shape(
      { width: PropTypes.number, height: PropTypes.number }
    ),

    /**
     * Callback continuously called while the user is dragging the slider.
     */
        onValueChange: PropTypes.func,

    /**
     * Callback called when the user starts changing the value (e.g. when
     * the slider is pressed).
     */
        onSlidingStart: PropTypes.func,

    /**
     * Callback called when the user finishes changing the value (e.g. when
     * the slider is released).
     */
        onSlidingComplete: PropTypes.func,

    /**
     * The style applied to the slider container.
     */
        style: PropTypes.style,

    /**
     * The style applied to the track.
     */
        trackStyle: PropTypes.style,

    /**
     * The style applied to the thumb.
     */
        thumbStyle: PropTypes.style,

    /**
     * Set this to true to visually see the thumb touch rect in green.
     */
        debugTouchArea: PropTypes.bool,
    },
    getInitialState () {
        return {
            containerSize: {},
            trackSize: {},
            thumbSize: {},
            previousLeft: 0,
            value: this.props.value,
        };
    },
    getDefaultProps () {
        return {
            value: 0,
            minimumValue: 0,
            maximumValue: 1,
            minimumTrackTintColor: '#3f3f3f',
            maximumTrackTintColor: '#b3b3b3',
            thumbTintColor: '#343434',
            thumbTouchSize: { width: 40, height: 40 },
            debugTouchArea: false,
        };
    },
    componentWillMount () {
        this._panResponder = PanResponder.create({
            onStartShouldSetPanResponder: this._handleStartShouldSetPanResponder,
            onMoveShouldSetPanResponder: this._handleMoveShouldSetPanResponder,
            onPanResponderGrant: this._handlePanResponderGrant,
            onPanResponderMove: this._handlePanResponderMove,
            onPanResponderRelease: this._handlePanResponderEnd,
            onPanResponderTerminate: this._handlePanResponderEnd,
        });
    },
    componentWillReceiveProps (nextProps) {
        this.setState({ value: nextProps.value });
    },
    render () {
        const {
      minimumTrackTintColor,
      maximumTrackTintColor,
      thumbTintColor,
      styles,
      style,
      trackStyle,
      thumbStyle,
      debugTouchArea,
      ...other
    } = this.props;
        const { value, containerSize, trackSize, thumbSize } = this.state;
        const mainStyles = styles || defaultStyles;
        const thumbLeft = this._getThumbLeft(value);
        const valueVisibleStyle = {};
        if (containerSize.width === undefined
        || trackSize.width === undefined
        || thumbSize.width === undefined) {
            valueVisibleStyle.opacity = 0;
        }

        const minimumTrackStyle = {
            position: 'absolute',
            width: 300, // needed to workaround a bug for borderRadius
            marginTop: -trackSize.height,
            backgroundColor: minimumTrackTintColor,
            ...valueVisibleStyle,
        };

        if (thumbLeft >= 0 && thumbSize.width >= 0) {
            minimumTrackStyle.width = thumbLeft + thumbSize.width / 2;
        }

        const touchOverflowStyle = this._getTouchOverflowStyle();

        return (
            <View style={{ flex:1, justifyContent:'center' }}>
                <View
                    {...other}
                    style={[mainStyles.container, style]}
                    onLayout={this._measureContainer}>
                    <View
                        style={[{ backgroundColor: maximumTrackTintColor }, mainStyles.track, trackStyle]}
                        onLayout={this._measureTrack} />
                    <View style={[mainStyles.track, trackStyle, minimumTrackStyle]} />
                </View>
                <View
                    ref={(thumb) => { this.thumb = thumb; }}
                    onLayout={this._measureThumb}
                    style={[
                    { backgroundColor: thumbTintColor, marginTop: -(trackSize.height + thumbSize.height) / 2 },
                        mainStyles.thumb, thumbStyle, { left: thumbLeft, ...valueVisibleStyle },
                    ]}
                />
                <View
                    style={[defaultStyles.touchArea, touchOverflowStyle]}
                    {...this._panResponder.panHandlers}>
                    {debugTouchArea === true && this._renderDebugThumbTouchRect()}
                </View>
            </View>
        );
    },

    _handleStartShouldSetPanResponder (e: Object, /* gestureState: Object */): boolean {
    // Until the PR https://github.com/facebook/react-native/pull/3426 is merged, we need to always return "true" for android
        if (Platform.OS === 'android') {
            return true;
        }
    // Should we become active when the user presses down on the thumb?
        return this._thumbHitTest(e);
    },

    _handleMoveShouldSetPanResponder (/* e: Object, gestureState: Object */): boolean {
    // Should we become active when the user moves a touch over the thumb?
        return false;
    },

    _handlePanResponderGrant (/* e: Object, gestureState: Object */) {
        this.setState({ previousLeft: this._getThumbLeft(this.state.value) },
      this._fireChangeEvent.bind(this, 'onSlidingStart'));
    },
    _handlePanResponderMove (e: Object, gestureState: Object) {
        this.setState({ value: this._getValue(gestureState) },
      this._fireChangeEvent.bind(this, 'onValueChange'));
    },
    _handlePanResponderEnd (e: Object, gestureState: Object) {
        this.setState({ value: this._getValue(gestureState) },
      this._fireChangeEvent.bind(this, 'onSlidingComplete'));
    },

    _measureContainer (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const containerSize = { width: width, height: height };
        this.setState({ containerSize: containerSize });
    },

    _measureTrack (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const trackSize = { width: width, height: height };
        this.setState({ trackSize: trackSize });
    },

    _measureThumb (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const thumbSize = { width: width, height: height };
        this.setState({ thumbSize: thumbSize });
    },

    _getRatio (value: number) {
        return (value - this.props.minimumValue) / (this.props.maximumValue - this.props.minimumValue);
    },

    _getThumbLeft (value: number) {
        const ratio = this._getRatio(value);
        return ratio * (this.state.containerSize.width - this.state.thumbSize.width);
    },

    _getValue (gestureState: Object) {
        const length = this.state.containerSize.width - this.state.thumbSize.width;
        const thumbLeft = Math.min(length,
      Math.max(0, this.state.previousLeft + (this.props.vertical ? gestureState.dy : gestureState.dx)));

        const ratio = thumbLeft / length;
        return ratio * (this.props.maximumValue - this.props.minimumValue) + this.props.minimumValue;
    },

    _fireChangeEvent (event) {
        if (this.props[event]) {
            this.props[event](this.state.value);
        }
    },

    _getTouchOverflowSize () {
        const state = this.state;
        const props = this.props;

        const size = {};
        if (state.containerSize.width !== undefined
        && state.thumbSize.width !== undefined) {
            size.width = Math.max(0, props.thumbTouchSize.width - state.thumbSize.width);
            size.height = Math.max(0, props.thumbTouchSize.height - state.containerSize.height);
        }

        return size;
    },

    _getTouchOverflowStyle () {
        const { width, height } = this._getTouchOverflowSize();

        const touchOverflowStyle = {};
        if (width !== undefined && height !== undefined) {
            const verticalMargin = -height / 2;
            touchOverflowStyle.marginTop = verticalMargin;
            touchOverflowStyle.marginBottom = verticalMargin;

            const horizontalMargin = -width / 2;
            touchOverflowStyle.marginLeft = horizontalMargin;
            touchOverflowStyle.marginRight = horizontalMargin;
        }

        if (this.props.debugTouchArea === true) {
            touchOverflowStyle.backgroundColor = 'orange';
            touchOverflowStyle.opacity = 0.5;
        }

        return touchOverflowStyle;
    },

    _thumbHitTest (e: Object) {
        const nativeEvent = e.nativeEvent;
        const thumbTouchRect = this._getThumbTouchRect();
        return thumbTouchRect.containsPoint(nativeEvent.locationX, nativeEvent.locationY);
    },

    _getThumbTouchRect () {
        const state = this.state;
        const props = this.props;
        const touchOverflowSize = this._getTouchOverflowSize();

        return new Rect(
      touchOverflowSize.width / 2 + this._getThumbLeft(state.value) + (state.thumbSize.width - props.thumbTouchSize.width) / 2,
      touchOverflowSize.height / 2 + (state.containerSize.height - props.thumbTouchSize.height) / 2,
      props.thumbTouchSize.width,
      props.thumbTouchSize.height
    );
    },

    _renderDebugThumbTouchRect () {
        const thumbTouchRect = this._getThumbTouchRect();
        const positionStyle = {
            left: thumbTouchRect.x,
            top: thumbTouchRect.y,
            width: thumbTouchRect.width,
            height: thumbTouchRect.height,
        };

        return (
            <View
                style={[defaultStyles.debugThumbTouchArea, positionStyle]}
                pointerEvents='none'
      />
        );
    },
});

const defaultStyles = StyleSheet.create({
    container: {
        height: 40,
        justifyContent: 'center',
    },
    track: {
        height: TRACK_SIZE,
        borderRadius: TRACK_SIZE / 2,
    },
    thumb: {
        position: 'absolute',
        width: THUMB_SIZE,
        height: THUMB_SIZE,
        borderRadius: THUMB_SIZE / 2,
    },
    touchArea: {
        position: 'absolute',
        backgroundColor: 'transparent',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
    },
    debugThumbTouchArea: {
        position: 'absolute',
        backgroundColor: 'green',
        opacity: 0.5,
    },
});

module.exports = Slider;

```

* PDClient/project/App/components/StarBar.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    View,
    StyleSheet,
} = ReactNative;

const MAX_STAR_NUM = 5;

module.exports = React.createClass({
    render () {
        const value = this.props.value;
        const starNum = Math.floor(value);
        const rest = value - starNum;
        const list = [];
        let i;
        for (i = 0; i < starNum; i++) {
            list[i] = 1;
        }
        if (i < MAX_STAR_NUM) {
            list[i] = rest <= 0.31 ? 2 : rest >= 0.69 ? 1 : 3;
            while (++i < MAX_STAR_NUM) {
                list[i] = 2;
            }
        }
        return (
            <View style={this.props.style ? this.props.style : styles.scoreIconContainer}>
                {
                    list.map((item, i) => {
                        const imgSource = app.img['actualCombat_star_' + item];
                        return (
                            <Image
                                key={i}
                                resizeMode='stretch'
                                source={imgSource}
                                style={this.props.starStyle ? this.props.starStyle : styles.scoreIcon}
                                />
                        );
                    })
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    scoreIconContainer: {
        height: 30,
        flexDirection: 'row',
        justifyContent: 'center',
    },
    scoreIcon: {
        marginLeft: 3,
        width: 20,
        height: 20,
    },
});

```

* PDClient/project/App/components/TouchAbleLink.js

```js
import React, { Component } from 'react';
import {
    Text,
    Linking,
    TouchableOpacity,
} from 'react-native';

// 打电话：url->("tel:10086")
// 发邮件：url->("mailto:10086@qq.com")
// 打开网站:url->("http://www.baidu.com")
module.exports = React.createClass ({
    render () {
        const {url, style, children} = this.props;
        return (
            <TouchableOpacity style={style} onPress={() => {
                Linking.canOpenURL(url).then(supported => {
                    if (!supported) {
                        console.log('Can\'t handle url: ' + url);
                    } else {
                        return Linking.openURL(url);
                    }
                }).catch(err => console.error('An error occurred', err));
            }}>
                {children}
            </TouchableOpacity>

        );
    }
});

```

* PDClient/project/App/components/WebviewMessageBox.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    WebView,
    Text,
} = ReactNative;

const Button = require('./Button');

module.exports = React.createClass({
    render () {
        return (
            <View style={styles.overlayContainer}>
                {
                    !this.props.title &&
                    <View style={[styles.title, { backgroundColor: app.setting.THEME_COLOR }]}>
                        <View style={[styles.titleContainer, { marginTop: sr.trueStatusBarHeight }]}>
                            <Text style={styles.titleText}>
                                {this.props.title}
                            </Text>
                        </View>
                    </View>
                }
                <View style={[styles.container, { top: sr.totalNavbarHeight + sr.statusBarHeight }]}>
                    <WebView
                        style={styles.webview}
                        source={{ uri:this.props.webAddress }}
                        scalesPageToFit
                        />
                    <Button
                        onPress={app.closeModal}
                        style={styles.contentButton}
                        textStyle={styles.contentButtonText}>
                        返回</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    overlayContainer: {
        position:'absolute',
        top: 0,
        bottom: 0,
        left:0,
        right: 0,
        backgroundColor: 'transparent',
    },
    title: {
        height:sr.totalNavbarHeight,
        width: sr.w,
    },
    titleContainer: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    titleText: {
        fontSize: 18,
        color: 'gray',
        fontWeight: '500',
    },
    container: {
        width:sr.w * 5 / 6,
        height:sr.h * 4 / 5,
        alignItems:'center',
        justifyContent:'center',
        borderRadius:10,
        position: 'absolute',
        left: sr.w * 1 / 12,
    },
    webview: {
        width:sr.w * 5 / 6,
        height:sr.h * 4 / 5 - 50,
    },
    contentButton: {
        width:sr.w * 5 / 6,
        height:50,
        borderRadius:0,
    },
    contentButtonText: {
        color: '#000000',
        fontWeight: '800',
    },
});

```

* PDClient/project/App/components/index.js

```js
module.exports = {
    Button: require('./Button'),
    PageList: require('./PageList'),
    ActionSheet: require('./ActionSheet/index'),
    ActionView: require('./ActionSheet/view'),
    CustomSheet: require('./CustomSheet'),
    ClipRect: require('./ClipRect'),
    Modal: require('./Modal'),
    DImage: require('./DImage'),
    Label: require('./Label'),
    ProgressBar: require('./ProgressBar'),
    Slider: require('./Slider'),
    MessageBox: require('./MessageBox'),
    CustomMessageBox: require('./CustomMessageBox'),
    WebviewMessageBox: require('./WebviewMessageBox'),
    DelayTouchableOpacity: require('./DelayTouchableOpacity'),
    StarBar: require('./StarBar'),
    ProgressHud: require('./ProgressHud'),
    RText: require('./RText'),
    ScoreSelect: require('./ScoreSelect'),
    AutogrowInput: require('./AutogrowInput'),
    TouchAbleLink: require('./TouchAbleLink'),
    Picker: require('./Picker'),
    SelectRegionAddress: require('./SelectRegionAddress'),
    SelectStartPointAddress: require('./SelectStartPointAddress'),
    SelectShortAddress: require('./SelectShortAddress'),
};

```

* PDClient/project/App/data/city.js

```js
module.exports = [{ name:'北京', city:[{ name:'北京', area:['东城区', '西城区', '崇文区', '宣武区', '朝阳区', '丰台区', '石景山区', '海淀区', '门头沟区', '房山区', '通州区', '顺义区', '昌平区', '大兴区', '平谷区', '怀柔区', '密云县', '延庆县'] }] }, { name:'天津', city:[{ name:'天津', area:['和平区', '河东区', '河西区', '南开区', '河北区', '红桥区', '塘沽区', '汉沽区', '大港区', '东丽区', '西青区', '津南区', '北辰区', '武清区', '宝坻区', '宁河县', '静海县', '蓟  县'] }] }, { name:'河北', city:[{ name:'石家庄', area:['长安区', '桥东区', '桥西区', '新华区', '郊  区', '井陉矿区', '井陉县', '正定县', '栾城县', '行唐县', '灵寿县', '高邑县', '深泽县', '赞皇县', '无极县', '平山县', '元氏县', '赵  县', '辛集市', '藁', '晋州市', '新乐市', '鹿泉市'] }, { name:'唐山', area:['路南区', '路北区', '古冶区', '开平区', '新  区', '丰润县', '滦  县', '滦南县', '乐亭县', '迁西县', '玉田县', '唐海县', '遵化市', '丰南市', '迁安市'] }, { name:'秦皇岛', area:['海港区', '山海关区', '北戴河区', '青龙满族自治县', '昌黎县', '抚宁县', '卢龙县'] }, { name:'邯郸', area:['邯山区', '丛台区', '复兴区', '峰峰矿区', '邯郸县', '临漳县', '成安县', '大名县', '涉  县', '磁  县', '肥乡县', '永年县', '邱  县', '鸡泽县', '广平县', '馆陶县', '魏  县', '曲周县', '武安市'] }, { name:'邢台', area:['桥东区', '桥西区', '邢台县', '临城县', '内丘县', '柏乡县', '隆尧县', '任  县', '南和县', '宁晋县', '巨鹿县', '新河县', '广宗县', '平乡县', '威  县', '清河县', '临西县', '南宫市', '沙河市'] }, { name:'保定', area:['新市区', '北市区', '南市区', '满城县', '清苑县', '涞水县', '阜平县', '徐水县', '定兴县', '唐  县', '高阳县', '容城县', '涞源县', '望都县', '安新县', '易  县', '曲阳县', '蠡  县', '顺平县', '博野', '雄县', '涿州市', '定州市', '安国市', '高碑店市'] }, { name:'张家口', area:['桥东区', '桥西区', '宣化区', '下花园区', '宣化县', '张北县', '康保县', '沽源县', '尚义县', '蔚  县', '阳原县', '怀安县', '万全县', '怀来县', '涿鹿县', '赤城县', '崇礼县'] }, { name:'承德', area:['双桥区', '双滦区', '鹰手营子矿区', '承德县', '兴隆县', '平泉县', '滦平县', '隆化县', '丰宁满族自治县', '宽城满族自治县', '围场满族蒙古族自治县'] }, { name:'沧州', area:['新华区', '运河区', '沧  县', '青  县', '东光县', '海兴县', '盐山县', '肃宁县', '南皮县', '吴桥县', '献  县', '孟村回族自治县', '泊头市', '任丘市', '黄骅市', '河间市'] }, { name:'廊坊', area:['安次区', '固安县', '永清县', '香河县', '大城县', '文安县', '大厂回族自治县', '霸州市', '三河市'] }, { name:'衡水', area:['桃城区', '枣强县', '武邑县', '武强县', '饶阳县', '安平县', '故城县', '景  县', '阜城县', '冀州市', '深州市'] }] }, { name:'山西', city:[{ name:'太原', area:['小店区', '迎泽区', '杏花岭区', '尖草坪区', '万柏林区', '晋源区', '清徐县', '阳曲县', '娄烦县', '古交市'] }, { name:'大同', area:['城  区', '矿  区', '南郊区', '新荣区', '阳高县', '天镇县', '广灵县', '灵丘县', '浑源县', '左云县', '大同县'] }, { name:'阳泉', area:['城  区', '矿  区', '郊  区', '平定县', '盂  县'] }, { name:'长治', area:['城  区', '郊  区', '长治县', '襄垣县', '屯留县', '平顺县', '黎城县', '壶关县', '长子县', '武乡县', '沁  县', '沁源县', '潞城市'] }, { name:'晋城', area:['城  区', '沁水县', '阳城县', '陵川县', '泽州县', '高平市'] }, { name:'朔州', area:['朔城区', '平鲁区', '山阴县', '应  县', '右玉县', '怀仁县'] }, { name:'忻州', area:['忻府区', '原平市', '定襄县', '五台县', '代  县', '繁峙县', '宁武县', '静乐县', '神池县', '五寨县', '岢岚县', '河曲县', '保德县', '偏关县'] }, { name:'吕梁', area:['离石区', '孝义市', '汾阳市', '文水县', '交城县', '兴  县', '临  县', '柳林县', '石楼县', '岚  县', '方山县', '中阳县', '交口县'] }, { name:'晋中', area:['榆次市', '介休市', '榆社县', '左权县', '和顺县', '昔阳县', '寿阳县', '太谷县', '祁  县', '平遥县', '灵石县'] }, { name:'临汾', area:['临汾市', '侯马市', '霍州市', '曲沃县', '翼城县', '襄汾县', '洪洞县', '古  县', '安泽县', '浮山县', '吉  县', '乡宁县', '蒲  县', '大宁县', '永和县', '隰  县', '汾西县'] }, { name:'运城', area:['运城市', '永济市', '河津市', '芮城县', '临猗县', '万荣县', '新绛县', '稷山县', '闻喜县', '夏  县', '绛  县', '平陆县', '垣曲县'] }] }, { name:'内蒙古', city:[{ name:'呼和浩特', area:['新城区', '回民区', '玉泉区', '郊  区', '土默特左旗', '托克托县', '和林格尔县', '清水河县', '武川县'] }, { name:'包头', area:['东河区', '昆都伦区', '青山区', '石拐矿区', '白云矿区', '郊  区', '土默特右旗', '固阳县', '达尔罕茂明安联合旗'] }, { name:'乌海', area:['海勃湾区', '海南区', '乌达区'] }, { name:'赤峰', area:['红山区', '元宝山区', '松山区', '阿鲁科尔沁旗', '巴林左旗', '巴林右旗', '林西县', '克什克腾旗', '翁牛特旗', '喀喇沁旗', '宁城县', '敖汉旗'] }, { name:'呼伦贝尔', area:['海拉尔市', '满洲里市', '扎兰屯市', '牙克石市', '根河市', '额尔古纳市', '阿荣旗', '莫力达瓦达斡尔族自治旗', '鄂伦春自治旗', '鄂温克族自治旗', '新巴尔虎右旗', '新巴尔虎左旗', '陈巴尔虎旗'] }, { name:'兴安盟', area:['乌兰浩特市', '阿尔山市', '科尔沁右翼前旗', '科尔沁右翼中旗', '扎赉特旗', '突泉县'] }, { name:'通辽', area:['科尔沁区', '霍林郭勒市', '科尔沁左翼中旗', '科尔沁左翼后旗', '开鲁县', '库伦旗', '奈曼旗', '扎鲁特旗'] }, { name:'锡林郭勒盟', area:['二连浩特市', '锡林浩特市', '阿巴嘎旗', '苏尼特左旗', '苏尼特右旗', '东乌珠穆沁旗', '西乌珠穆沁旗', '太仆寺旗', '镶黄旗', '正镶白旗', '正蓝旗', '多伦县'] }, { name:'乌兰察布盟', area:['集宁市', '丰镇市', '卓资县', '化德县', '商都县', '兴和县', '凉城县', '察哈尔右翼前旗', '察哈尔右翼中旗', '察哈尔右翼后旗', '四子王旗'] }, { name:'伊克昭盟', area:['东胜市', '达拉特旗', '准格尔旗', '鄂托克前旗', '鄂托克旗', '杭锦旗', '乌审旗', '伊金霍洛旗'] }, { name:'巴彦淖尔盟', area:['临河市', '五原县', '磴口县', '乌拉特前旗', '乌拉特中旗', '乌拉特后旗', '杭锦后旗'] }, { name:'阿拉善盟', area:['阿拉善左旗', '阿拉善右旗', '额济纳旗'] }] }, { name:'辽宁', city:[{ name:'沈阳', area:['沈河区', '皇姑区', '和平区', '大东区', '铁西区', '苏家屯区', '东陵区', '于洪区', '新民市', '法库县', '辽中县', '康平县', '新城子区', '其他'] }, { name:'大连', area:['西岗区', '中山区', '沙河口区', '甘井子区', '旅顺口区', '金州区', '瓦房店市', '普兰店市', '庄河市', '长海县', '其他'] }, { name:'鞍山', area:['铁东区', '铁西区', '立山区', '千山区', '海城市', '台安县', '岫岩满族自治县', '其他'] }, { name:'抚顺', area:['顺城区', '新抚区', '东洲区', '望花区', '抚顺县', '清原满族自治县', '新宾满族自治县', '其他'] }, { name:'本溪', area:['平山区', '明山区', '溪湖区', '南芬区', '本溪满族自治县', '桓仁满族自治县', '其他'] }, { name:'丹东', area:['振兴区', '元宝区', '振安区', '东港市', '凤城市', '宽甸满族自治县', '其他'] }, { name:'锦州', area:['太和区', '古塔区', '凌河区', '凌海市', '黑山县', '义县', '北宁市', '其他'] }, { name:'营口', area:['站前区', '西市区', '鲅鱼圈区', '老边区', '大石桥市', '盖州市', '其他'] }, { name:'阜新', area:['海州区', '新邱区', '太平区', '清河门区', '细河区', '彰武县', '阜新蒙古族自治县', '其他'] }, { name:'辽阳', area:['白塔区', '文圣区', '宏伟区', '太子河区', '弓长岭区', '灯塔市', '辽阳县', '其他'] }, { name:'盘锦', area:['双台子区', '兴隆台区', '盘山县', '大洼县', '其他'] }, { name:'铁岭', area:['银州区', '清河区', '调兵山市', '开原市', '铁岭县', '昌图县', '西丰县', '其他'] }, { name:'朝阳', area:['双塔区', '龙城区', '凌源市', '北票市', '朝阳县', '建平县', '喀喇沁左翼蒙古族自治县', '其他'] }, { name:'葫芦岛', area:['龙港区', '南票区', '连山区', '兴城市', '绥中县', '建昌县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'吉林', city:[{ name:'长春', area:['朝阳区', '宽城区', '二道区', '南关区', '绿园区', '双阳区', '九台市', '榆树市', '德惠市', '农安县', '其他'] }, { name:'吉林', area:['船营区', '昌邑区', '龙潭区', '丰满区', '舒兰市', '桦甸市', '蛟河市', '磐石市', '永吉县', '其他'] }, { name:'四平', area:['铁西区', '铁东区', '公主岭市', '双辽市', '梨树县', '伊通满族自治县', '其他'] }, { name:'辽源', area:['龙山区', '西安区', '东辽县', '东丰县', '其他'] }, { name:'通化', area:['东昌区', '二道江区', '梅河口市', '集安市', '通化县', '辉南县', '柳河县', '其他'] }, { name:'白山', area:['八道江区', '江源区', '临江市', '靖宇县', '抚松县', '长白朝鲜族自治县', '其他'] }, { name:'松原', area:['宁江区', '乾安县', '长岭县', '扶余县', '前郭尔罗斯蒙古族自治县', '其他'] }, { name:'白城', area:['洮北区', '大安市', '洮南市', '镇赉县', '通榆县', '其他'] }, { name:'延边朝鲜族自治州', area:['延吉市', '图们市', '敦化市', '龙井市', '珲春市', '和龙市', '安图县', '汪清县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'黑龙江', city:[{ name:'哈尔滨', area:['松北区', '道里区', '南岗区', '平房区', '香坊区', '道外区', '呼兰区', '阿城区', '双城市', '尚志市', '五常市', '宾县', '方正县', '通河县', '巴彦县', '延寿县', '木兰县', '依兰县', '其他'] }, { name:'齐齐哈尔', area:['龙沙区', '昂昂溪区', '铁锋区', '建华区', '富拉尔基区', '碾子山区', '梅里斯达斡尔族区', '讷河市', '富裕县', '拜泉县', '甘南县', '依安县', '克山县', '泰来县', '克东县', '龙江县', '其他'] }, { name:'鹤岗', area:['兴山区', '工农区', '南山区', '兴安区', '向阳区', '东山区', '萝北县', '绥滨县', '其他'] }, { name:'双鸭山', area:['尖山区', '岭东区', '四方台区', '宝山区', '集贤县', '宝清县', '友谊县', '饶河县', '其他'] }, { name:'鸡西', area:['鸡冠区', '恒山区', '城子河区', '滴道区', '梨树区', '麻山区', '密山市', '虎林市', '鸡东县', '其他'] }, { name:'大庆', area:['萨尔图区', '红岗区', '龙凤区', '让胡路区', '大同区', '林甸县', '肇州县', '肇源县', '杜尔伯特蒙古族自治县', '其他'] }, { name:'伊春', area:['伊春区', '带岭区', '南岔区', '金山屯区', '西林区', '美溪区', '乌马河区', '翠峦区', '友好区', '上甘岭区', '五营区', '红星区', '新青区', '汤旺河区', '乌伊岭区', '铁力市', '嘉荫县', '其他'] }, { name:'牡丹江', area:['爱民区', '东安区', '阳明区', '西安区', '绥芬河市', '宁安市', '海林市', '穆棱市', '林口县', '东宁县', '其他'] }, { name:'佳木斯', area:['向阳区', '前进区', '东风区', '郊区', '同江市', '富锦市', '桦川县', '抚远县', '桦南县', '汤原县', '其他'] }, { name:'七台河', area:['桃山区', '新兴区', '茄子河区', '勃利县', '其他'] }, { name:'黑河', area:['爱辉区', '北安市', '五大连池市', '逊克县', '嫩江县', '孙吴县', '其他'] }, { name:'绥化', area:['北林区', '安达市', '肇东市', '海伦市', '绥棱县', '兰西县', '明水县', '青冈县', '庆安县', '望奎县', '其他'] }, { name:'大兴安岭地区', area:['呼玛县', '塔河县', '漠河县', '大兴安岭辖区', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'上海', city:[{ name:'上海', area:['黄浦区', '卢湾区', '徐汇区', '长宁区', '静安区', '普陀区', '闸北区', '虹口区', '杨浦区', '宝山区', '闵行区', '嘉定区', '松江区', '金山区', '青浦区', '南汇区', '奉贤区', '浦东新区', '崇明县', '其他'] }] }, { name:'江苏', city:[{ name:'南京', area:['玄武区', '白下区', '秦淮区', '建邺区', '鼓楼区', '下关区', '栖霞区', '雨花台区', '浦口区', '江宁区', '六合区', '溧水县', '高淳县', '其他'] }, { name:'苏州', area:['金阊区', '平江区', '沧浪区', '虎丘区', '吴中区', '相城区', '常熟市', '张家港市', '昆山市', '吴江市', '太仓市', '其他'] }, { name:'无锡', area:['崇安区', '南长区', '北塘区', '滨湖区', '锡山区', '惠山区', '江阴市', '宜兴市', '其他'] }, { name:'常州', area:['钟楼区', '天宁区', '戚墅堰区', '新北区', '武进区', '金坛市', '溧阳市', '其他'] }, { name:'镇江', area:['京口区', '润州区', '丹徒区', '丹阳市', '扬中市', '句容市', '其他'] }, { name:'南通', area:['崇川区', '港闸区', '通州市', '如皋市', '海门市', '启东市', '海安县', '如东县', '其他'] }, { name:'泰州', area:['海陵区', '高港区', '姜堰市', '泰兴市', '靖江市', '兴化市', '其他'] }, { name:'扬州', area:['广陵区', '维扬区', '邗江区', '江都市', '仪征市', '高邮市', '宝应县', '其他'] }, { name:'盐城', area:['亭湖区', '盐都区', '大丰市', '东台市', '建湖县', '射阳县', '阜宁县', '滨海县', '响水县', '其他'] }, { name:'连云港', area:['新浦区', '海州区', '连云区', '东海县', '灌云县', '赣榆县', '灌南县', '其他'] }, { name:'徐州', area:['云龙区', '鼓楼区', '九里区', '泉山区', '贾汪区', '邳州市', '新沂市', '铜山县', '睢宁县', '沛县', '丰县', '其他'] }, { name:'淮安', area:['清河区', '清浦区', '楚州区', '淮阴区', '涟水县', '洪泽县', '金湖县', '盱眙县', '其他'] }, { name:'宿迁', area:['宿城区', '宿豫区', '沭阳县', '泗阳县', '泗洪县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'浙江', city:[{ name:'杭州', area:['拱墅区', '西湖区', '上城区', '下城区', '江干区', '滨江区', '余杭区', '萧山区', '建德市', '富阳市', '临安市', '桐庐县', '淳安县', '其他'] }, { name:'宁波', area:['海曙区', '江东区', '江北区', '镇海区', '北仑区', '鄞州区', '余姚市', '慈溪市', '奉化市', '宁海县', '象山县', '其他'] }, { name:'温州', area:['鹿城区', '龙湾区', '瓯海区', '瑞安市', '乐清市', '永嘉县', '洞头县', '平阳县', '苍南县', '文成县', '泰顺县', '其他'] }, { name:'嘉兴', area:['秀城区', '秀洲区', '海宁市', '平湖市', '桐乡市', '嘉善县', '海盐县', '其他'] }, { name:'湖州', area:['吴兴区', '南浔区', '长兴县', '德清县', '安吉县', '其他'] }, { name:'绍兴', area:['越城区', '诸暨市', '上虞市', '嵊州市', '绍兴县', '新昌县', '其他'] }, { name:'金华', area:['婺城区', '金东区', '兰溪市', '义乌市', '东阳市', '永康市', '武义县', '浦江县', '磐安县', '其他'] }, { name:'衢州', area:['柯城区', '衢江区', '江山市', '龙游县', '常山县', '开化县', '其他'] }, { name:'舟山', area:['定海区', '普陀区', '岱山县', '嵊泗县', '其他'] }, { name:'台州', area:['椒江区', '黄岩区', '路桥区', '临海市', '温岭市', '玉环县', '天台县', '仙居县', '三门县', '其他'] }, { name:'丽水', area:['莲都区', '龙泉市', '缙云县', '青田县', '云和县', '遂昌县', '松阳县', '庆元县', '景宁畲族自治县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'安徽', city:[{ name:'合肥', area:['庐阳区', '瑶海区', '蜀山区', '包河区', '长丰县', '肥东县', '肥西县', '其他'] }, { name:'芜湖', area:['镜湖区', '弋江区', '鸠江区', '三山区', '芜湖县', '南陵县', '繁昌县', '其他'] }, { name:'蚌埠', area:['蚌山区', '龙子湖区', '禹会区', '淮上区', '怀远县', '固镇县', '五河县', '其他'] }, { name:'淮南', area:['田家庵区', '大通区', '谢家集区', '八公山区', '潘集区', '凤台县', '其他'] }, { name:'马鞍山', area:['雨山区', '花山区', '金家庄区', '当涂县', '其他'] }, { name:'淮北', area:['相山区', '杜集区', '烈山区', '濉溪县', '其他'] }, { name:'铜陵', area:['铜官山区', '狮子山区', '郊区', '铜陵县', '其他'] }, { name:'安庆', area:['迎江区', '大观区', '宜秀区', '桐城市', '宿松县', '枞阳县', '太湖县', '怀宁县', '岳西县', '望江县', '潜山县', '其他'] }, { name:'黄山', area:['屯溪区', '黄山区', '徽州区', '休宁县', '歙县', '祁门县', '黟县', '其他'] }, { name:'滁州', area:['琅琊区', '南谯区', '天长市', '明光市', '全椒县', '来安县', '定远县', '凤阳县', '其他'] }, { name:'阜阳', area:['颍州区', '颍东区', '颍泉区', '界首市', '临泉县', '颍上县', '阜南县', '太和县', '其他'] }, { name:'宿州', area:['埇桥区', '萧县', '泗县', '砀山县', '灵璧县', '其他'] }, { name:'巢湖', area:['居巢区', '含山县', '无为县', '庐江县', '和县', '其他'] }, { name:'六安', area:['金安区', '裕安区', '寿县', '霍山县', '霍邱县', '舒城县', '金寨县', '其他'] }, { name:'亳州', area:['谯城区', '利辛县', '涡阳县', '蒙城县', '其他'] }, { name:'池州', area:['贵池区', '东至县', '石台县', '青阳县', '其他'] }, { name:'宣城', area:['宣州区', '宁国市', '广德县', '郎溪县', '泾县', '旌德县', '绩溪县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'福建', city:[{ name:'福州', area:['鼓楼区', '台江区', '仓山区', '马尾区', '晋安区', '福清市', '长乐市', '闽侯县', '闽清县', '永泰县', '连江县', '罗源县', '平潭县', '其他'] }, { name:'厦门', area:['思明区', '海沧区', '湖里区', '集美区', '同安区', '翔安区', '其他'] }, { name:'莆田', area:['城厢区', '涵江区', '荔城区', '秀屿区', '仙游县', '其他'] }, { name:'三明', area:['梅列区', '三元区', '永安市', '明溪县', '将乐县', '大田县', '宁化县', '建宁县', '沙县', '尤溪县', '清流县', '泰宁县', '其他'] }, { name:'泉州', area:['鲤城区', '丰泽区', '洛江区', '泉港区', '石狮市', '晋江市', '南安市', '惠安县', '永春县', '安溪县', '德化县', '金门县', '其他'] }, { name:'漳州', area:['芗城区', '龙文区', '龙海市', '平和县', '南靖县', '诏安县', '漳浦县', '华安县', '东山县', '长泰县', '云霄县', '其他'] }, { name:'南平', area:['延平区', '建瓯市', '邵武市', '武夷山市', '建阳市', '松溪县', '光泽县', '顺昌县', '浦城县', '政和县', '其他'] }, { name:'龙岩', area:['新罗区', '漳平市', '长汀县', '武平县', '上杭县', '永定县', '连城县', '其他'] }, { name:'宁德', area:['蕉城区', '福安市', '福鼎市', '寿宁县', '霞浦县', '柘荣县', '屏南县', '古田县', '周宁县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'江西', city:[{ name:'南昌', area:['东湖区', '西湖区', '青云谱区', '湾里区', '青山湖区', '新建县', '南昌县', '进贤县', '安义县', '其他'] }, { name:'景德镇', area:['珠山区', '昌江区', '乐平市', '浮梁县', '其他'] }, { name:'萍乡', area:['安源区', '湘东区', '莲花县', '上栗县', '芦溪县', '其他'] }, { name:'九江', area:['浔阳区', '庐山区', '瑞昌市', '九江县', '星子县', '武宁县', '彭泽县', '永修县', '修水县', '湖口县', '德安县', '都昌县', '其他'] }, { name:'新余', area:['渝水区', '分宜县', '其他'] }, { name:'鹰潭', area:['月湖区', '贵溪市', '余江县', '其他'] }, { name:'赣州', area:['章贡区', '瑞金市', '南康市', '石城县', '安远县', '赣县', '宁都县', '寻乌县', '兴国县', '定南县', '上犹县', '于都县', '龙南县', '崇义县', '信丰县', '全南县', '大余县', '会昌县', '其他'] }, { name:'吉安', area:['吉州区', '青原区', '井冈山市', '吉安县', '永丰县', '永新县', '新干县', '泰和县', '峡江县', '遂川县', '安福县', '吉水县', '万安县', '其他'] }, { name:'宜春', area:['袁州区', '丰城市', '樟树市', '高安市', '铜鼓县', '靖安县', '宜丰县', '奉新县', '万载县', '上高县', '其他'] }, { name:'抚州', area:['临川区', '南丰县', '乐安县', '金溪县', '南城县', '东乡县', '资溪县', '宜黄县', '广昌县', '黎川县', '崇仁县', '其他'] }, { name:'上饶', area:['信州区', '德兴市', '上饶县', '广丰县', '鄱阳县', '婺源县', '铅山县', '余干县', '横峰县', '弋阳县', '玉山县', '万年县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'山东', city:[{ name:'济南', area:['市中区', '历下区', '天桥区', '槐荫区', '历城区', '长清区', '章丘市', '平阴县', '济阳县', '商河县', '其他'] }, { name:'青岛', area:['市南区', '市北区', '城阳区', '四方区', '李沧区', '黄岛区', '崂山区', '胶南市', '胶州市', '平度市', '莱西市', '即墨市', '其他'] }, { name:'淄博', area:['张店区', '临淄区', '淄川区', '博山区', '周村区', '桓台县', '高青县', '沂源县', '其他'] }, { name:'枣庄', area:['市中区', '山亭区', '峄城区', '台儿庄区', '薛城区', '滕州市', '其他'] }, { name:'东营', area:['东营区', '河口区', '垦利县', '广饶县', '利津县', '其他'] }, { name:'烟台', area:['芝罘区', '福山区', '牟平区', '莱山区', '龙口市', '莱阳市', '莱州市', '招远市', '蓬莱市', '栖霞市', '海阳市', '长岛县', '其他'] }, { name:'潍坊', area:['潍城区', '寒亭区', '坊子区', '奎文区', '青州市', '诸城市', '寿光市', '安丘市', '高密市', '昌邑市', '昌乐县', '临朐县', '其他'] }, { name:'济宁', area:['市中区', '任城区', '曲阜市', '兖州市', '邹城市', '鱼台县', '金乡县', '嘉祥县', '微山县', '汶上县', '泗水县', '梁山县', '其他'] }, { name:'泰安', area:['泰山区', '岱岳区', '新泰市', '肥城市', '宁阳县', '东平县', '其他'] }, { name:'威海', area:['环翠区', '乳山市', '文登市', '荣成市', '其他'] }, { name:'日照', area:['东港区', '岚山区', '五莲县', '莒县', '其他'] }, { name:'莱芜', area:['莱城区', '钢城区', '其他'] }, { name:'临沂', area:['兰山区', '罗庄区', '河东区', '沂南县', '郯城县', '沂水县', '苍山县', '费县', '平邑县', '莒南县', '蒙阴县', '临沭县', '其他'] }, { name:'德州', area:['德城区', '乐陵市', '禹城市', '陵县', '宁津县', '齐河县', '武城县', '庆云县', '平原县', '夏津县', '临邑县', '其他'] }, { name:'聊城', area:['东昌府区', '临清市', '高唐县', '阳谷县', '茌平县', '莘县', '东阿县', '冠县', '其他'] }, { name:'滨州', area:['滨城区', '邹平县', '沾化县', '惠民县', '博兴县', '阳信县', '无棣县', '其他'] }, { name:'菏泽', area:['牡丹区', '鄄城县', '单县', '郓城县', '曹县', '定陶县', '巨野县', '东明县', '成武县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'河南', city:[{ name:'郑州', area:['中原区', '金水区', '二七区', '管城回族区', '上街区', '惠济区', '巩义市', '新郑市', '新密市', '登封市', '荥阳市', '中牟县', '其他'] }, { name:'开封', area:['鼓楼区', '龙亭区', '顺河回族区', '禹王台区', '金明区', '开封县', '尉氏县', '兰考县', '杞县', '通许县', '其他'] }, { name:'洛阳', area:['西工区', '老城区', '涧西区', '瀍河回族区', '洛龙区', '吉利区', '偃师市', '孟津县', '汝阳县', '伊川县', '洛宁县', '嵩县', '宜阳县', '新安县', '栾川县', '其他'] }, { name:'平顶山', area:['新华区', '卫东区', '湛河区', '石龙区', '汝州市', '舞钢市', '宝丰县', '叶县', '郏县', '鲁山县', '其他'] }, { name:'安阳', area:['北关区', '文峰区', '殷都区', '龙安区', '林州市', '安阳县', '滑县', '内黄县', '汤阴县', '其他'] }, { name:'鹤壁', area:['淇滨区', '山城区', '鹤山区', '浚县', '淇县', '其他'] }, { name:'新乡', area:['卫滨区', '红旗区', '凤泉区', '牧野区', '卫辉市', '辉县市', '新乡县', '获嘉县', '原阳县', '长垣县', '封丘县', '延津县', '其他'] }, { name:'焦作', area:['解放区', '中站区', '马村区', '山阳区', '沁阳市', '孟州市', '修武县', '温县', '武陟县', '博爱县', '其他'] }, { name:'濮阳', area:['华龙区', '濮阳县', '南乐县', '台前县', '清丰县', '范县', '其他'] }, { name:'许昌', area:['魏都区', '禹州市', '长葛市', '许昌县', '鄢陵县', '襄城县', '其他'] }, { name:'漯河', area:['源汇区', '郾城区', '召陵区', '临颍县', '舞阳县', '其他'] }, { name:'三门峡', area:['湖滨区', '义马市', '灵宝市', '渑池县', '卢氏县', '陕县', '其他'] }, { name:'南阳', area:['卧龙区', '宛城区', '邓州市', '桐柏县', '方城县', '淅川县', '镇平县', '唐河县', '南召县', '内乡县', '新野县', '社旗县', '西峡县', '其他'] }, { name:'商丘', area:['梁园区', '睢阳区', '永城市', '宁陵县', '虞城县', '民权县', '夏邑县', '柘城县', '睢县', '其他'] }, { name:'信阳', area:['浉河区', '平桥区', '潢川县', '淮滨县', '息县', '新县', '商城县', '固始县', '罗山县', '光山县', '其他'] }, { name:'周口', area:['川汇区', '项城市', '商水县', '淮阳县', '太康县', '鹿邑县', '西华县', '扶沟县', '沈丘县', '郸城县', '其他'] }, { name:'驻马店', area:['驿城区', '确山县', '新蔡县', '上蔡县', '西平县', '泌阳县', '平舆县', '汝南县', '遂平县', '正阳县', '其他'] }, { name:'焦作', area:['济源市', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'湖北', city:[{ name:'武汉', area:['江岸区', '武昌区', '江汉区', '硚口区', '汉阳区', '青山区', '洪山区', '东西湖区', '汉南区', '蔡甸区', '江夏区', '黄陂区', '新洲区', '其他'] }, { name:'黄石', area:['黄石港区', '西塞山区', '下陆区', '铁山区', '大冶市', '阳新县', '其他'] }, { name:'十堰', area:['张湾区', '茅箭区', '丹江口市', '郧县', '竹山县', '房县', '郧西县', '竹溪县', '其他'] }, { name:'荆州', area:['沙市区', '荆州区', '洪湖市', '石首市', '松滋市', '监利县', '公安县', '江陵县', '其他'] }, { name:'宜昌', area:['西陵区', '伍家岗区', '点军区', '猇亭区', '夷陵区', '宜都市', '当阳市', '枝江市', '秭归县', '远安县', '兴山县', '五峰土家族自治县', '长阳土家族自治县', '其他'] }, { name:'襄樊', area:['襄城区', '樊城区', '襄阳区', '老河口市', '枣阳市', '宜城市', '南漳县', '谷城县', '保康县', '其他'] }, { name:'鄂州', area:['鄂城区', '华容区', '梁子湖区', '其他'] }, { name:'荆门', area:['东宝区', '掇刀区', '钟祥市', '京山县', '沙洋县', '其他'] }, { name:'孝感', area:['孝南区', '应城市', '安陆市', '汉川市', '云梦县', '大悟县', '孝昌县', '其他'] }, { name:'黄冈', area:['黄州区', '麻城市', '武穴市', '红安县', '罗田县', '浠水县', '蕲春县', '黄梅县', '英山县', '团风县', '其他'] }, { name:'咸宁', area:['咸安区', '赤壁市', '嘉鱼县', '通山县', '崇阳县', '通城县', '其他'] }, { name:'随州', area:['曾都区', '广水市', '其他'] }, { name:'恩施土家族苗族自治州', area:['恩施市', '利川市', '建始县', '来凤县', '巴东县', '鹤峰县', '宣恩县', '咸丰县', '其他'] }, { name:'仙桃', area:['仙桃'] }, { name:'天门', area:['天门'] }, { name:'潜江', area:['潜江'] }, { name:'神农架林区', area:['神农架林区'] }, { name:'其他', area:['其他'] }] }, { name:'湖南', city:[{ name:'长沙', area:['岳麓区', '芙蓉区', '天心区', '开福区', '雨花区', '浏阳市', '长沙县', '望城县', '宁乡县', '其他'] }, { name:'株洲', area:['天元区', '荷塘区', '芦淞区', '石峰区', '醴陵市', '株洲县', '炎陵县', '茶陵县', '攸县', '其他'] }, { name:'湘潭', area:['岳塘区', '雨湖区', '湘乡市', '韶山市', '湘潭县', '其他'] }, { name:'衡阳', area:['雁峰区', '珠晖区', '石鼓区', '蒸湘区', '南岳区', '耒阳市', '常宁市', '衡阳县', '衡东县', '衡山县', '衡南县', '祁东县', '其他'] }, { name:'邵阳', area:['双清区', '大祥区', '北塔区', '武冈市', '邵东县', '洞口县', '新邵县', '绥宁县', '新宁县', '邵阳县', '隆回县', '城步苗族自治县', '其他'] }, { name:'岳阳', area:['岳阳楼区', '云溪区', '君山区', '临湘市', '汨罗市', '岳阳县', '湘阴县', '平江县', '华容县', '其他'] }, { name:'常德', area:['武陵区', '鼎城区', '津市市', '澧县', '临澧县', '桃源县', '汉寿县', '安乡县', '石门县', '其他'] }, { name:'张家界', area:['永定区', '武陵源区', '慈利县', '桑植县', '其他'] }, { name:'益阳', area:['赫山区', '资阳区', '沅江市', '桃江县', '南县', '安化县', '其他'] }, { name:'郴州', area:['北湖区', '苏仙区', '资兴市', '宜章县', '汝城县', '安仁县', '嘉禾县', '临武县', '桂东县', '永兴县', '桂阳县', '其他'] }, { name:'永州', area:['冷水滩区', '零陵区', '祁阳县', '蓝山县', '宁远县', '新田县', '东安县', '江永县', '道县', '双牌县', '江华瑶族自治县', '其他'] }, { name:'怀化', area:['鹤城区', '洪江市', '会同县', '沅陵县', '辰溪县', '溆浦县', '中方县', '新晃侗族自治县', '芷江侗族自治县', '通道侗族自治县', '靖州苗族侗族自治县', '麻阳苗族自治县', '其他'] }, { name:'娄底', area:['娄星区', '冷水江市', '涟源市', '新化县', '双峰县', '其他'] }, { name:'湘西土家族苗族自治州', area:['吉首市', '古丈县', '龙山县', '永顺县', '凤凰县', '泸溪县', '保靖县', '花垣县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'广东', city:[{ name:'广州', area:['越秀区', '荔湾区', '海珠区', '天河区', '白云区', '黄埔区', '番禺区', '花都区', '南沙区', '萝岗区', '增城市', '从化市', '其他'] }, { name:'深圳', area:['福田区', '罗湖区', '南山区', '宝安区', '龙岗区', '盐田区', '其他'] }, { name:'东莞', area:['莞城', '常平', '塘厦', '塘厦', '塘厦', '其他'] }, { name:'中山', area:['中山'] }, { name:'潮州', area:['湘桥区', '潮安县', '饶平县', '其他'] }, { name:'揭阳', area:['榕城区', '揭东县', '揭西县', '惠来县', '普宁市', '其他'] }, { name:'云浮', area:['云城区', '新兴县', '郁南县', '云安县', '罗定市', '其他'] }, { name:'珠海', area:['香洲区', '斗门区', '金湾区', '其他'] }, { name:'汕头', area:['金平区', '濠江区', '龙湖区', '潮阳区', '潮南区', '澄海区', '南澳县', '其他'] }, { name:'韶关', area:['浈江区', '武江区', '曲江区', '乐昌市', '南雄市', '始兴县', '仁化县', '翁源县', '新丰县', '乳源瑶族自治县', '其他'] }, { name:'佛山', area:['禅城区', '南海区', '顺德区', '三水区', '高明区', '其他'] }, { name:'江门', area:['蓬江区', '江海区', '新会区', '恩平市', '台山市', '开平市', '鹤山市', '其他'] }, { name:'湛江', area:['赤坎区', '霞山区', '坡头区', '麻章区', '吴川市', '廉江市', '雷州市', '遂溪县', '徐闻县', '其他'] }, { name:'茂名', area:['茂南区', '茂港区', '化州市', '信宜市', '高州市', '电白县', '其他'] }, { name:'肇庆', area:['端州区', '鼎湖区', '高要市', '四会市', '广宁县', '怀集县', '封开县', '德庆县', '其他'] }, { name:'惠州', area:['惠城区', '惠阳区', '博罗县', '惠东县', '龙门县', '其他'] }, { name:'梅州', area:['梅江区', '兴宁市', '梅县', '大埔县', '丰顺县', '五华县', '平远县', '蕉岭县', '其他'] }, { name:'汕尾', area:['城区', '陆丰市', '海丰县', '陆河县', '其他'] }, { name:'河源', area:['源城区', '紫金县', '龙川县', '连平县', '和平县', '东源县', '其他'] }, { name:'阳江', area:['江城区', '阳春市', '阳西县', '阳东县', '其他'] }, { name:'清远', area:['清城区', '英德市', '连州市', '佛冈县', '阳山县', '清新县', '连山壮族瑶族自治县', '连南瑶族自治县', '其他'] }] }, { name:'广西', city:[{ name:'南宁', area:['青秀区', '兴宁区', '西乡塘区', '良庆区', '江南区', '邕宁区', '武鸣县', '隆安县', '马山县', '上林县', '宾阳县', '横县', '其他'] }, { name:'柳州', area:['城中区', '鱼峰区', '柳北区', '柳南区', '柳江县', '柳城县', '鹿寨县', '融安县', '融水苗族自治县', '三江侗族自治县', '其他'] }, { name:'桂林', area:['象山区', '秀峰区', '叠彩区', '七星区', '雁山区', '阳朔县', '临桂县', '灵川县', '全州县', '平乐县', '兴安县', '灌阳县', '荔浦县', '资源县', '永福县', '龙胜各族自治县', '恭城瑶族自治县', '其他'] }, { name:'梧州', area:['万秀区', '蝶山区', '长洲区', '岑溪市', '苍梧县', '藤县', '蒙山县', '其他'] }, { name:'北海', area:['海城区', '银海区', '铁山港区', '合浦县', '其他'] }, { name:'防城港', area:['港口区', '防城区', '东兴市', '上思县', '其他'] }, { name:'钦州', area:['钦南区', '钦北区', '灵山县', '浦北县', '其他'] }, { name:'贵港', area:['港北区', '港南区', '覃塘区', '桂平市', '平南县', '其他'] }, { name:'玉林', area:['玉州区', '北流市', '容县', '陆川县', '博白县', '兴业县', '其他'] }, { name:'百色', area:['右江区', '凌云县', '平果县', '西林县', '乐业县', '德保县', '田林县', '田阳县', '靖西县', '田东县', '那坡县', '隆林各族自治县', '其他'] }, { name:'贺州', area:['八步区', '钟山县', '昭平县', '富川瑶族自治县', '其他'] }, { name:'河池', area:['金城江区', '宜州市', '天峨县', '凤山县', '南丹县', '东兰县', '都安瑶族自治县', '罗城仫佬族自治县', '巴马瑶族自治县', '环江毛南族自治县', '大化瑶族自治县', '其他'] }, { name:'来宾', area:['兴宾区', '合山市', '象州县', '武宣县', '忻城县', '金秀瑶族自治县', '其他'] }, { name:'崇左', area:['江州区', '凭祥市', '宁明县', '扶绥县', '龙州县', '大新县', '天等县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'海南', city:[{ name:'海口', area:['龙华区', '秀英区', '琼山区', '美兰区', '其他'] }, { name:'三亚', area:['三亚市', '其他'] }, { name:'五指山', area:['五指山'] }, { name:'琼海', area:['琼海'] }, { name:'儋州', area:['儋州'] }, { name:'文昌', area:['文昌'] }, { name:'万宁', area:['万宁'] }, { name:'东方', area:['东方'] }, { name:'澄迈县', area:['澄迈县'] }, { name:'定安县', area:['定安县'] }, { name:'屯昌县', area:['屯昌县'] }, { name:'临高县', area:['临高县'] }, { name:'白沙黎族自治县', area:['白沙黎族自治县'] }, { name:'昌江黎族自治县', area:['昌江黎族自治县'] }, { name:'乐东黎族自治县', area:['乐东黎族自治县'] }, { name:'陵水黎族自治县', area:['陵水黎族自治县'] }, { name:'保亭黎族苗族自治县', area:['保亭黎族苗族自治县'] }, { name:'琼中黎族苗族自治县', area:['琼中黎族苗族自治县'] }, { name:'其他', area:['其他'] }] }, { name:'重庆', city:[{ name:'重庆', area:['渝中区', '大渡口区', '江北区', '南岸区', '北碚区', '渝北区', '巴南区', '长寿区', '双桥区', '沙坪坝区', '万盛区', '万州区', '涪陵区', '黔江区', '永川区', '合川区', '江津区', '九龙坡区', '南川区', '綦江县', '潼南县', '荣昌县', '璧山县', '大足县', '铜梁县', '梁平县', '开县', '忠县', '城口县', '垫江县', '武隆县', '丰都县', '奉节县', '云阳县', '巫溪县', '巫山县', '石柱土家族自治县', '秀山土家族苗族自治县', '酉阳土家族苗族自治县', '彭水苗族土家族自治县', '其他'] }] }, { name:'四川', city:[{ name:'成都', area:['青羊区', '锦江区', '金牛区', '武侯区', '成华区', '龙泉驿区', '青白江区', '新都区', '温江区', '都江堰市', '彭州市', '邛崃市', '崇州市', '金堂县', '郫县', '新津县', '双流县', '蒲江县', '大邑县', '其他'] }, { name:'自贡', area:['大安区', '自流井区', '贡井区', '沿滩区', '荣县', '富顺县', '其他'] }, { name:'攀枝花', area:['仁和区', '米易县', '盐边县', '东区', '西区', '其他'] }, { name:'泸州', area:['江阳区', '纳溪区', '龙马潭区', '泸县', '合江县', '叙永县', '古蔺县', '其他'] }, { name:'德阳', area:['旌阳区', '广汉市', '什邡市', '绵竹市', '罗江县', '中江县', '其他'] }, { name:'绵阳', area:['涪城区', '游仙区', '江油市', '盐亭县', '三台县', '平武县', '安县', '梓潼县', '北川羌族自治县', '其他'] }, { name:'广元', area:['元坝区', '朝天区', '青川县', '旺苍县', '剑阁县', '苍溪县', '市中区', '其他'] }, { name:'遂宁', area:['船山区', '安居区', '射洪县', '蓬溪县', '大英县', '其他'] }, { name:'内江', area:['市中区', '东兴区', '资中县', '隆昌县', '威远县', '其他'] }, { name:'乐山', area:['市中区', '五通桥区', '沙湾区', '金口河区', '峨眉山市', '夹江县', '井研县', '犍为县', '沐川县', '马边彝族自治县', '峨边彝族自治县', '其他'] }, { name:'南充', area:['顺庆区', '高坪区', '嘉陵区', '阆中市', '营山县', '蓬安县', '仪陇县', '南部县', '西充县', '其他'] }, { name:'眉山', area:['东坡区', '仁寿县', '彭山县', '洪雅县', '丹棱县', '青神县', '其他'] }, { name:'宜宾', area:['翠屏区', '宜宾县', '兴文县', '南溪县', '珙县', '长宁县', '高县', '江安县', '筠连县', '屏山县', '其他'] }, { name:'广安', area:['广安区', '华蓥市', '岳池县', '邻水县', '武胜县', '其他'] }, { name:'达州', area:['通川区', '万源市', '达县', '渠县', '宣汉县', '开江县', '大竹县', '其他'] }, { name:'雅安', area:['雨城区', '芦山县', '石棉县', '名山县', '天全县', '荥经县', '宝兴县', '汉源县', '其他'] }, { name:'巴中', area:['巴州区', '南江县', '平昌县', '通江县', '其他'] }, { name:'资阳', area:['雁江区', '简阳市', '安岳县', '乐至县', '其他'] }, { name:'阿坝藏族羌族自治州', area:['马尔康县', '九寨沟县', '红原县', '汶川县', '阿坝县', '理县', '若尔盖县', '小金县', '黑水县', '金川县', '松潘县', '壤塘县', '茂县', '其他'] }, { name:'甘孜藏族自治州', area:['康定县', '丹巴县', '炉霍县', '九龙县', '甘孜县', '雅江县', '新龙县', '道孚县', '白玉县', '理塘县', '德格县', '乡城县', '石渠县', '稻城县', '色达县', '巴塘县', '泸定县', '得荣县', '其他'] }, { name:'凉山彝族自治州', area:['西昌市', '美姑县', '昭觉县', '金阳县', '甘洛县', '布拖县', '雷波县', '普格县', '宁南县', '喜德县', '会东县', '越西县', '会理县', '盐源县', '德昌县', '冕宁县', '木里藏族自治县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'贵州', city:[{ name:'贵阳', area:['南明区', '云岩区', '花溪区', '乌当区', '白云区', '小河区', '清镇市', '开阳县', '修文县', '息烽县', '其他'] }, { name:'六盘水', area:['钟山区', '水城县', '盘县', '六枝特区', '其他'] }, { name:'遵义', area:['红花岗区', '汇川区', '赤水市', '仁怀市', '遵义县', '绥阳县', '桐梓县', '习水县', '凤冈县', '正安县', '余庆县', '湄潭县', '道真仡佬族苗族自治县', '务川仡佬族苗族自治县', '其他'] }, { name:'安顺', area:['西秀区', '普定县', '平坝县', '镇宁布依族苗族自治县', '紫云苗族布依族自治县', '关岭布依族苗族自治县', '其他'] }, { name:'铜仁地区', area:['铜仁市', '德江县', '江口县', '思南县', '石阡县', '玉屏侗族自治县', '松桃苗族自治县', '印江土家族苗族自治县', '沿河土家族自治县', '万山特区', '其他'] }, { name:'毕节地区', area:['毕节市', '黔西县', '大方县', '织金县', '金沙县', '赫章县', '纳雍县', '威宁彝族回族苗族自治县', '其他'] }, { name:'黔西南布依族苗族自治州', area:['兴义市', '望谟县', '兴仁县', '普安县', '册亨县', '晴隆县', '贞丰县', '安龙县', '其他'] }, { name:'黔东南苗族侗族自治州', area:['凯里市', '施秉县', '从江县', '锦屏县', '镇远县', '麻江县', '台江县', '天柱县', '黄平县', '榕江县', '剑河县', '三穗县', '雷山县', '黎平县', '岑巩县', '丹寨县', '其他'] }, { name:'黔南布依族苗族自治州', area:['都匀市', '福泉市', '贵定县', '惠水县', '罗甸县', '瓮安县', '荔波县', '龙里县', '平塘县', '长顺县', '独山县', '三都水族自治县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'云南', city:[{ name:'昆明', area:['盘龙区', '五华区', '官渡区', '西山区', '东川区', '安宁市', '呈贡县', '晋宁县', '富民县', '宜良县', '嵩明县', '石林彝族自治县', '禄劝彝族苗族自治县', '寻甸回族彝族自治县', '其他'] }, { name:'曲靖', area:['麒麟区', '宣威市', '马龙县', '沾益县', '富源县', '罗平县', '师宗县', '陆良县', '会泽县', '其他'] }, { name:'玉溪', area:['红塔区', '江川县', '澄江县', '通海县', '华宁县', '易门县', '峨山彝族自治县', '新平彝族傣族自治县', '元江哈尼族彝族傣族自治县', '其他'] }, { name:'保山', area:['隆阳区', '施甸县', '腾冲县', '龙陵县', '昌宁县', '其他'] }, { name:'昭通', area:['昭阳区', '鲁甸县', '巧家县', '盐津县', '大关县', '永善县', '绥江县', '镇雄县', '彝良县', '威信县', '水富县', '其他'] }, { name:'丽江', area:['古城区', '永胜县', '华坪县', '玉龙纳西族自治县', '宁蒗彝族自治县', '其他'] }, { name:'普洱', area:['思茅区', '普洱哈尼族彝族自治县', '墨江哈尼族自治县', '景东彝族自治县', '景谷傣族彝族自治县', '镇沅彝族哈尼族拉祜族自治县', '江城哈尼族彝族自治县', '孟连傣族拉祜族佤族自治县', '澜沧拉祜族自治县', '西盟佤族自治县', '其他'] }, { name:'临沧', area:['临翔区', '凤庆县', '云县', '永德县', '镇康县', '双江拉祜族佤族布朗族傣族自治县', '耿马傣族佤族自治县', '沧源佤族自治县', '其他'] }, { name:'德宏傣族景颇族自治州', area:['潞西市', '瑞丽市', '梁河县', '盈江县', '陇川县', '其他'] }, { name:'怒江傈僳族自治州', area:['泸水县', '福贡县', '贡山独龙族怒族自治县', '兰坪白族普米族自治县', '其他'] }, { name:'迪庆藏族自治州', area:['香格里拉县', '德钦县', '维西傈僳族自治县', '其他'] }, { name:'大理白族自治州', area:['大理市', '祥云县', '宾川县', '弥渡县', '永平县', '云龙县', '洱源县', '剑川县', '鹤庆县', '漾濞彝族自治县', '南涧彝族自治县', '巍山彝族回族自治县', '其他'] }, { name:'楚雄彝族自治州', area:['楚雄市', '双柏县', '牟定县', '南华县', '姚安县', '大姚县', '永仁县', '元谋县', '武定县', '禄丰县', '其他'] }, { name:'红河哈尼族彝族自治州', area:['蒙自县', '个旧市', '开远市', '绿春县', '建水县', '石屏县', '弥勒县', '泸西县', '元阳县', '红河县', '金平苗族瑶族傣族自治县', '河口瑶族自治县', '屏边苗族自治县', '其他'] }, { name:'文山壮族苗族自治州', area:['文山县', '砚山县', '西畴县', '麻栗坡县', '马关县', '丘北县', '广南县', '富宁县', '其他'] }, { name:'西双版纳傣族自治州', area:['景洪市', '勐海县', '勐腊县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'西藏', city:[{ name:'拉萨', area:['城关区', '林周县', '当雄县', '尼木县', '曲水县', '堆龙德庆县', '达孜县', '墨竹工卡县', '其他'] }, { name:'那曲地区', area:['那曲县', '嘉黎县', '比如县', '聂荣县', '安多县', '申扎县', '索县', '班戈县', '巴青县', '尼玛县', '其他'] }, { name:'昌都地区', area:['昌都县', '江达县', '贡觉县', '类乌齐县', '丁青县', '察雅县', '八宿县', '左贡县', '芒康县', '洛隆县', '边坝县', '其他'] }, { name:'林芝地区', area:['林芝县', '工布江达县', '米林县', '墨脱县', '波密县', '察隅县', '朗县', '其他'] }, { name:'山南地区', area:['乃东县', '扎囊县', '贡嘎县', '桑日县', '琼结县', '曲松县', '措美县', '洛扎县', '加查县', '隆子县', '错那县', '浪卡子县', '其他'] }, { name:'日喀则地区', area:['日喀则市', '南木林县', '江孜县', '定日县', '萨迦县', '拉孜县', '昂仁县', '谢通门县', '白朗县', '仁布县', '康马县', '定结县', '仲巴县', '亚东县', '吉隆县', '聂拉木县', '萨嘎县', '岗巴县', '其他'] }, { name:'阿里地区', area:['噶尔县', '普兰县', '札达县', '日土县', '革吉县', '改则县', '措勤县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'陕西', city:[{ name:'西安', area:['莲湖区', '新城区', '碑林区', '雁塔区', '灞桥区', '未央区', '阎良区', '临潼区', '长安区', '高陵县', '蓝田县', '户县', '周至县', '其他'] }, { name:'铜川', area:['耀州区', '王益区', '印台区', '宜君县', '其他'] }, { name:'宝鸡', area:['渭滨区', '金台区', '陈仓区', '岐山县', '凤翔县', '陇县', '太白县', '麟游县', '扶风县', '千阳县', '眉县', '凤县', '其他'] }, { name:'咸阳', area:['秦都区', '渭城区', '杨陵区', '兴平市', '礼泉县', '泾阳县', '永寿县', '三原县', '彬县', '旬邑县', '长武县', '乾县', '武功县', '淳化县', '其他'] }, { name:'渭南', area:['临渭区', '韩城市', '华阴市', '蒲城县', '潼关县', '白水县', '澄城县', '华县', '合阳县', '富平县', '大荔县', '其他'] }, { name:'延安', area:['宝塔区', '安塞县', '洛川县', '子长县', '黄陵县', '延川县', '富县', '延长县', '甘泉县', '宜川县', '志丹县', '黄龙县', '吴起县', '其他'] }, { name:'汉中', area:['汉台区', '留坝县', '镇巴县', '城固县', '南郑县', '洋县', '宁强县', '佛坪县', '勉县', '西乡县', '略阳县', '其他'] }, { name:'榆林', area:['榆阳区', '清涧县', '绥德县', '神木县', '佳县', '府谷县', '子洲县', '靖边县', '横山县', '米脂县', '吴堡县', '定边县', '其他'] }, { name:'安康', area:['汉滨区', '紫阳县', '岚皋县', '旬阳县', '镇坪县', '平利县', '石泉县', '宁陕县', '白河县', '汉阴县', '其他'] }, { name:'商洛', area:['商州区', '镇安县', '山阳县', '洛南县', '商南县', '丹凤县', '柞水县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'甘肃', city:[{ name:'兰州', area:['城关区', '七里河区', '西固区', '安宁区', '红古区', '永登县', '皋兰县', '榆中县', '其他'] }, { name:'嘉峪关', area:['嘉峪关市', '其他'] }, { name:'金昌', area:['金川区', '永昌县', '其他'] }, { name:'白银', area:['白银区', '平川区', '靖远县', '会宁县', '景泰县', '其他'] }, { name:'天水', area:['清水县', '秦安县', '甘谷县', '武山县', '张家川回族自治县', '北道区', '秦城区', '其他'] }, { name:'武威', area:['凉州区', '民勤县', '古浪县', '天祝藏族自治县', '其他'] }, { name:'酒泉', area:['肃州区', '玉门市', '敦煌市', '金塔县', '肃北蒙古族自治县', '阿克塞哈萨克族自治县', '安西县', '其他'] }, { name:'张掖', area:['甘州区', '民乐县', '临泽县', '高台县', '山丹县', '肃南裕固族自治县', '其他'] }, { name:'庆阳', area:['西峰区', '庆城县', '环县', '华池县', '合水县', '正宁县', '宁县', '镇原县', '其他'] }, { name:'平凉', area:['崆峒区', '泾川县', '灵台县', '崇信县', '华亭县', '庄浪县', '静宁县', '其他'] }, { name:'定西', area:['安定区', '通渭县', '临洮县', '漳县', '岷县', '渭源县', '陇西县', '其他'] }, { name:'陇南', area:['武都区', '成县', '宕昌县', '康县', '文县', '西和县', '礼县', '两当县', '徽县', '其他'] }, { name:'临夏回族自治州', area:['临夏市', '临夏县', '康乐县', '永靖县', '广河县', '和政县', '东乡族自治县', '积石山保安族东乡族撒拉族自治县', '其他'] }, { name:'甘南藏族自治州', area:['合作市', '临潭县', '卓尼县', '舟曲县', '迭部县', '玛曲县', '碌曲县', '夏河县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'青海', city:[{ name:'西宁', area:['城中区', '城东区', '城西区', '城北区', '湟源县', '湟中县', '大通回族土族自治县', '其他'] }, { name:'海东地区', area:['平安县', '乐都县', '民和回族土族自治县', '互助土族自治县', '化隆回族自治县', '循化撒拉族自治县', '其他'] }, { name:'海北藏族自治州', area:['海晏县', '祁连县', '刚察县', '门源回族自治县', '其他'] }, { name:'海南藏族自治州', area:['共和县', '同德县', '贵德县', '兴海县', '贵南县', '其他'] }, { name:'黄南藏族自治州', area:['同仁县', '尖扎县', '泽库县', '河南蒙古族自治县', '其他'] }, { name:'果洛藏族自治州', area:['玛沁县', '班玛县', '甘德县', '达日县', '久治县', '玛多县', '其他'] }, { name:'玉树藏族自治州', area:['玉树县', '杂多县', '称多县', '治多县', '囊谦县', '曲麻莱县', '其他'] }, { name:'海西蒙古族藏族自治州', area:['德令哈市', '格尔木市', '乌兰县', '都兰县', '天峻县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'宁夏', city:[{ name:'银川', area:['兴庆区', '西夏区', '金凤区', '灵武市', '永宁县', '贺兰县', '其他'] }, { name:'石嘴山', area:['大武口区', '惠农区', '平罗县', '其他'] }, { name:'吴忠', area:['利通区', '青铜峡市', '盐池县', '同心县', '其他'] }, { name:'固原', area:['原州区', '西吉县', '隆德县', '泾源县', '彭阳县', '其他'] }, { name:'中卫', area:['沙坡头区', '中宁县', '海原县', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'新疆', city:[{ name:'乌鲁木齐', area:['天山区', '沙依巴克区', '新市区', '水磨沟区', '头屯河区', '达坂城区', '东山区', '乌鲁木齐县', '其他'] }, { name:'克拉玛依', area:['克拉玛依区', '独山子区', '白碱滩区', '乌尔禾区', '其他'] }, { name:'吐鲁番地区', area:['吐鲁番市', '托克逊县', '鄯善县', '其他'] }, { name:'哈密地区', area:['哈密市', '伊吾县', '巴里坤哈萨克自治县', '其他'] }, { name:'和田地区', area:['和田市', '和田县', '洛浦县', '民丰县', '皮山县', '策勒县', '于田县', '墨玉县', '其他'] }, { name:'阿克苏地区', area:['阿克苏市', '温宿县', '沙雅县', '拜城县', '阿瓦提县', '库车县', '柯坪县', '新和县', '乌什县', '其他'] }, { name:'喀什地区', area:['喀什市', '巴楚县', '泽普县', '伽师县', '叶城县', '岳普湖县', '疏勒县', '麦盖提县', '英吉沙县', '莎车县', '疏附县', '塔什库尔干塔吉克自治县', '其他'] }, { name:'克孜勒苏柯尔克孜自治州', area:['阿图什市', '阿合奇县', '乌恰县', '阿克陶县', '其他'] }, { name:'巴音郭楞蒙古自治州', area:['库尔勒市', '和静县', '尉犁县', '和硕县', '且末县', '博湖县', '轮台县', '若羌县', '焉耆回族自治县', '其他'] }, { name:'昌吉回族自治州', area:['昌吉市', '阜康市', '奇台县', '玛纳斯县', '吉木萨尔县', '呼图壁县', '木垒哈萨克自治县', '米泉市', '其他'] }, { name:'博尔塔拉蒙古自治州', area:['博乐市', '精河县', '温泉县', '其他'] }, { name:'石河子', area:['石河子'] }, { name:'阿拉尔', area:['阿拉尔'] }, { name:'图木舒克', area:['图木舒克'] }, { name:'五家渠', area:['五家渠'] }, { name:'伊犁哈萨克自治州', area:['伊宁市', '奎屯市', '伊宁县', '特克斯县', '尼勒克县', '昭苏县', '新源县', '霍城县', '巩留县', '察布查尔锡伯自治县', '塔城地区', '阿勒泰地区', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'台湾', city:[{ name:'台湾', area:['台北市', '高雄市', '台北县', '桃园县', '新竹县', '苗栗县', '台中县', '彰化县', '南投县', '云林县', '嘉义县', '台南县', '高雄县', '屏东县', '宜兰县', '花莲县', '台东县', '澎湖县', '基隆市', '新竹市', '台中市', '嘉义市', '台南市', '其他'] }, { name:'其他', area:['其他'] }] }, { name:'澳门', city:[{ name:'澳门', area:['花地玛堂区', '圣安多尼堂区', '大堂区', '望德堂区', '风顺堂区', '嘉模堂区', '圣方济各堂区', '路凼', '其他'] }] }, { name:'香港', city:[{ name:'香港', area:['中西区', '湾仔区', '东区', '南区', '深水埗区', '油尖旺区', '九龙城区', '黄大仙区', '观塘区', '北区', '大埔区', '沙田区', '西贡区', '元朗区', '屯门区', '荃湾区', '葵青区', '离岛区', '其他'] }] }, { name:'钓鱼岛', city:[{ name:'钓鱼岛', area:['钓鱼岛'] }] }];

```

* PDClient/project/App/config/Authority.js

```js
'use strict';
// 注意：常量部分必须和服务器保持一致
// 总部权限
const AH_CREATE_BRANCH_SHOP = 0; // 创建分店的权限
const AH_MODIFY_BRANCH_SHOP = 1; // 修改分店信息的权限
const AH_REMOVE_BRANCH_SHOP = 2; // 删除分店的权限
const AH_LOOK_BRANCH_SHOP = 3; // 查看分店列表的权限
const AH_MODIFY_SETTING = 4; // 修改设置的权限
const AH_CREATE_AGENT = 5; // 创建收货点的权限
const AH_MODIFY_AGENT = 6; // 修改收货点的权限
const AH_REMOVE_AGENT = 7; // 删除收货点的权限
const AH_LOOK_AGENT = 8; // 查看收货点的权限

// 公共权限
const AH_MODIFY_OWN_SHOP = 10000; // 修改所在物流超市信息的权限
const AH_CREATE_MEMBER = 10001; // 创建成员的权限
const AH_MODIFY_MEMBER = 10002; // 修改成员信息的权限
const AH_REMOVE_MEMBER = 10003; // 删除成员的权限
const AH_LOOK_MEMBER = 10004; // 查看成员的权限
const AH_RECHARGE = 10005; // 充值的权限
const AH_WITHDRAW = 10006; // 提现的权限
const AH_LOOK_AMOUNT = 10007; // 查看余额的权限
const AH_MODIFY_ROADMAP_PROFIT_RATE = 10008; // 修改路线的提成
const AH_LOOK_STATISTICS = 10009; // 查看统计信息的权限
const AH_LOOK_ORDERS = 10010; // 查看综合货单的权限

// 分店权限
const AH_CREATE_SHIPPER = 20000; // 创建物流公司的权限
const AH_MODIFY_SHIPPER = 20001; // 修改物流公司的权限
const AH_REMOVE_SHIPPER = 20002; // 删除物流公司的权限
const AH_LOOK_SHIPPER = 20003; // 查看物流公司的权限
const AH_CREATE_PARTMENT = 20004; // 创建部门的权限
const AH_MODIFY_PARTMENT = 20005; // 修改部门信息的权限
const AH_REMOVE_PARTMENT = 20006; // 删除部门的权限
const AH_LOOK_PARTMENT = 20007; // 查看部门的权限
const AH_MODIFY_OWN_PARTMENT = 20008; // 修改所在部门信息的权限
const AH_RECEIVE_PARTMENT = 20009; // 收货的权限（收货部人员）
const AH_WARE_HOUSE_PARTMENT = 20010; // 库管的权限（库管部人员）
const AH_CARRY_PARTMENT = 20011; // 搬货的权限（搬运部人员）
const AH_SECURITY_CHECK_PARTMENT = 20012; // 安检的权限（保安部人员）
const AH_DISTRIBUTION_PARTMENT = 20013; // 配送的权限（配送部人员）
const AH_TO_EXAMINE_TRUCK = 20014; // 审核货车的权限

// 物流公司
const AH_MODIFY_SHIPPER_INFO = 30000; // 修改物流公司信息的权限
const AH_MODIFY_SHIPPER_MEMBER_AUTHORITY = 30001; // 修改物流公司成员权限的权限
const AH_CREATE_ROADMAP = 30002; // 创建路线的权限
const AH_MODIFY_ROADMAP = 30003; // 修改路线的权限
const AH_REMOVE_ROADMAP = 30004; // 删除路线的权限
const AH_LOOK_ROADMAP = 30005; // 查看路线的权限 (分店共享该权限)
const AH_CREATE_SEND_DOOR_ROADMAP = 30006; // 创建同城配送路线的权限
const AH_MODIFY_SEND_DOOR_ROADMAP = 30007; // 修改同城配送路线的权限
const AH_REMOVE_SEND_DOOR_ROADMAP = 30008; // 删除同城配送路线的权限
const AH_LOOK_SEND_DOOR_ROADMAP = 30009; // 查看同城配送路线的权限 (分店共享该权限)
const AH_CREATE_TRUCK = 30010; // 创建货车的权限
const AH_MODIFY_TRUCK = 30011; // 修改货车的权限
const AH_REMOVE_TRUCK = 30012; // 删除货车的权限
const AH_LOOK_TRUCK = 30013; // 查看货车的权限
const SELECT_CARRY_PARTMENT = 30014; // 选择搬运队的权限
const AH_SCAN_LOAD_TRUCK = 30015; // 扫描装车的权限
const AH_CITY_DISTRIBUTE = 30016; // 同城配送的权限

// 收货点
const AH_MODIFY_AGENT_INFO = 40000; // 修改收货点信息的权限
const AH_MODIFY_AGENT_MEMBER_AUTHORITY = 40001; // 修改收货点成员权限的权限
const AH_PLACE_ORDER = 40002; // 收货点下单的权限

module.exports = {
    // 总部权限
    AH_CREATE_BRANCH_SHOP,
    AH_MODIFY_BRANCH_SHOP,
    AH_REMOVE_BRANCH_SHOP,
    AH_LOOK_BRANCH_SHOP,
    AH_MODIFY_SETTING,
    AH_CREATE_AGENT,
    AH_MODIFY_AGENT,
    AH_REMOVE_AGENT,
    AH_LOOK_AGENT,

    // 公共权限
    AH_MODIFY_OWN_SHOP,
    AH_CREATE_MEMBER,
    AH_MODIFY_MEMBER,
    AH_REMOVE_MEMBER,
    AH_LOOK_MEMBER,
    AH_RECHARGE,
    AH_WITHDRAW,
    AH_LOOK_AMOUNT,
    AH_MODIFY_ROADMAP_PROFIT_RATE,
    AH_LOOK_STATISTICS,
    AH_LOOK_ORDERS,

    // 分店权限
    AH_CREATE_SHIPPER,
    AH_MODIFY_SHIPPER,
    AH_REMOVE_SHIPPER,
    AH_LOOK_SHIPPER,
    AH_CREATE_PARTMENT,
    AH_MODIFY_PARTMENT,
    AH_REMOVE_PARTMENT,
    AH_LOOK_PARTMENT,
    AH_MODIFY_OWN_PARTMENT,
    AH_RECEIVE_PARTMENT,
    AH_WARE_HOUSE_PARTMENT,
    AH_CARRY_PARTMENT,
    AH_SECURITY_CHECK_PARTMENT,
    AH_DISTRIBUTION_PARTMENT,
    AH_TO_EXAMINE_TRUCK,

    // 物流公司
    AH_MODIFY_SHIPPER_INFO,
    AH_MODIFY_SHIPPER_MEMBER_AUTHORITY,
    AH_CREATE_ROADMAP,
    AH_MODIFY_ROADMAP,
    AH_REMOVE_ROADMAP,
    AH_LOOK_ROADMAP,
    AH_CREATE_SEND_DOOR_ROADMAP,
    AH_MODIFY_SEND_DOOR_ROADMAP,
    AH_REMOVE_SEND_DOOR_ROADMAP,
    AH_LOOK_SEND_DOOR_ROADMAP,
    AH_CREATE_TRUCK,
    AH_MODIFY_TRUCK,
    AH_REMOVE_TRUCK,
    AH_LOOK_TRUCK,
    SELECT_CARRY_PARTMENT,
    AH_SCAN_LOAD_TRUCK,
    AH_CITY_DISTRIBUTE,

    // 收货点
    AH_MODIFY_AGENT_INFO,
    AH_MODIFY_AGENT_MEMBER_AUTHORITY,
    AH_PLACE_ORDER,

    // mapper
    MAP: {
        // 总部权限
        [AH_CREATE_BRANCH_SHOP]: '创建分店的权限',
        [AH_MODIFY_BRANCH_SHOP]: '修改分店信息的权限',
        [AH_REMOVE_BRANCH_SHOP]: '删除分店的权限',
        [AH_LOOK_BRANCH_SHOP]: '查看分店的权限',
        [AH_MODIFY_SETTING]: '修改设置的权限',
        [AH_CREATE_AGENT]: '创建收货点的权限',
        [AH_MODIFY_AGENT]: '修改收货点的权限',
        [AH_REMOVE_AGENT]: '删除收货点的权限',
        [AH_LOOK_AGENT]: '查看收货点的权限',

        // 公共权限
        [AH_MODIFY_OWN_SHOP]: '修改自身店铺信息的权限',
        [AH_CREATE_MEMBER]: '创建成员的权限',
        [AH_MODIFY_MEMBER]: '修改成员信息的权限',
        [AH_REMOVE_MEMBER]: '删除成员的权限',
        [AH_LOOK_MEMBER]: '查看成员的权限',
        [AH_RECHARGE]: '充值的权限',
        [AH_WITHDRAW]: '提现的权限',
        [AH_LOOK_AMOUNT]: '查看余额的权限',
        [AH_MODIFY_ROADMAP_PROFIT_RATE]: '修改路线的提成的权限',
        [AH_LOOK_STATISTICS]: '查看统计信息的权限',
        [AH_LOOK_ORDERS]: '查看综合货单的权限',

        // 分店权限
        [AH_CREATE_SHIPPER]: '创建物流公司',
        [AH_MODIFY_SHIPPER]: '修改物流公司',
        [AH_REMOVE_SHIPPER]: '删除物流公司',
        [AH_LOOK_SHIPPER]: '查看物流公司',
        [AH_CREATE_PARTMENT]: '创建部门的权限',
        [AH_MODIFY_PARTMENT]: '修改部门信息的权限',
        [AH_REMOVE_PARTMENT]: '删除部门的权限',
        [AH_LOOK_PARTMENT]: '查看部门的权限',
        [AH_MODIFY_OWN_PARTMENT]: '修改所在部门信息的权限',
        [AH_RECEIVE_PARTMENT]: '收货的权限',
        [AH_WARE_HOUSE_PARTMENT]: '库管的权限',
        [AH_CARRY_PARTMENT]: '搬货的权限',
        [AH_SECURITY_CHECK_PARTMENT]: '安检的权限',
        [AH_DISTRIBUTION_PARTMENT]: '配送的权限',
        [AH_TO_EXAMINE_TRUCK]: '审核货车的权限',

        // 物流公司
        [AH_MODIFY_SHIPPER_INFO]: '修改物流公司信息的权限',
        [AH_MODIFY_SHIPPER_MEMBER_AUTHORITY]: '修改物流公司成员权限的权限',
        [AH_CREATE_ROADMAP]: '创建路线的权限',
        [AH_MODIFY_ROADMAP]: '修改路线的权限',
        [AH_REMOVE_ROADMAP]: '删除路线的权限',
        [AH_LOOK_ROADMAP]: '查看路线的权限',
        [AH_CREATE_SEND_DOOR_ROADMAP]: '创建同城配送路线的权限',
        [AH_MODIFY_SEND_DOOR_ROADMAP]: '修改同城配送路线的权限',
        [AH_REMOVE_SEND_DOOR_ROADMAP]: '删除同城配送路线的权限',
        [AH_LOOK_SEND_DOOR_ROADMAP]: '查看同城配送路线的权限',
        [AH_CREATE_TRUCK]: '创建货车的权限',
        [AH_MODIFY_TRUCK]: '修改货车的权限',
        [AH_REMOVE_TRUCK]: '删除货车的权限',
        [AH_LOOK_TRUCK]: '查看货车的权限',
        [SELECT_CARRY_PARTMENT]: '选择搬运队的权限',
        [AH_SCAN_LOAD_TRUCK]: '扫描装车的权限',
        [AH_CITY_DISTRIBUTE]: '同城配送的权限',

        // 收货点
        [AH_MODIFY_AGENT_INFO]: '修改收货点信息的权限',
        [AH_MODIFY_AGENT_MEMBER_AUTHORITY]: '修改收货点成员权限的权限',
        [AH_PLACE_ORDER]: '收货点下单的权限',
    },
};

```

* PDClient/project/App/config/Color.js

```js
'use strict';

module.exports = {
    _c (style, color) {
        return [style, { color: color || app.setting.THEME_COLOR }];
    },
    _bc (style, color) {
        return [style, { backgroundColor:color || app.setting.THEME_COLOR }];
    },
    _tc (style, color) {
        return [style, { tintColor: color || app.setting.THEME_COLOR }];
    },
};

```

* PDClient/project/App/config/Constants.js

```js
'use strict';

// 该文件永远不要提交svn
// 发布正式服务器的配置，svn上面永远不要动这个配置，在发布测试服务器的时候将ISSUE改为false
// 如果发布ios时 ISSUE_IOS=true 其他的发布为 ISSUE_IOS=false
// CHANNEL为android渠道，发布百度市场时为baidu,其他的为default,ios忽略这个选项
const CONFIG = {
    ISSUE: false,
    ISSUE_IOS: false,
    CHANNEL: 'default',
};

// 发布测试服务器的配置，该配置只有 CONFIG.ISSUE 为 false 的时候才生效
// 如果是本地开发模式， CONFIG.ISSUE = false， TEST_CONFIG.ISSUE = false, 同时可以修改调试的服务器
// 如果是发布测试服务器， CONFIG.ISSUE = false，TEST_CONFIG.ISSUE = true
const TEST_CONFIG = {
    ISSUE: true,
    BASE_SERVER_INDEX: 0, // 只有 TEST_CONFIG.ISSUE 为 false时生效
};

// web服务器 依次是本地服务器， 测试服务器， 正式服务器
const BASE_SERVERS = ['192.168.1.222:3000', '192.168.1.189', '120.78.65.221'];
const BASE_SERVER = CONFIG.ISSUE ? BASE_SERVERS[2] : TEST_CONFIG.ISSUE ? BASE_SERVERS[1] : BASE_SERVERS[TEST_CONFIG.BASE_SERVER_INDEX];

module.exports = {
    APP_NAME: '四面通客户端',
    THEME_COLORS: ['#c81622', '#A62045', '#239FDB'],
    ISSUE_IOS: CONFIG.ISSUE_IOS,
    NOT_NEED_UPDATE_JS_START: !(CONFIG.ISSUE || TEST_CONFIG.ISSUE), // 启动时不需要更新小版本
    MINIFY: CONFIG.ISSUE, // 是否压缩js文件，我们采取测试服务器为了查找问题不用压缩js文件，正式服务器需要压缩js文件，并且不能看到调试信息
    CHANNEL: CONFIG.CHANNEL,
    // IOS的appid,1290180200
    IOS_APPID: '',
    BASE_SERVER: BASE_SERVER, // web服务器地址
    // 获取验证码的超时时间
    DEFAULT_CODE_TIMEOUT: 90,
    // 分页列表每页数据的条数
    PER_PAGE_COUNT: 10,
    NAME_MAX_LENGTH: 10,
    ADDRESS_MAX_LENGTH: 30,
    VERIFICATION_MAX_LENGTH: 6,
    AMOUNT_MAX_LENGTH: 7,
    FEEDBACK_MAX_LENGTH: 500,
    QRCODE_TYPE_ORDER:1,
};

```

* PDClient/project/App/config/OrderState.js

```js
// 注意：常量部分必须和服务器保持一致
// 订单的状态
/*
===========
长途运输状态图:
(0->)1->2->5    |
                |->6->7->8(->11)->14->15
(0->)1->3->4->5 |
===========
收货点状态图:
0->2->9    |
           |(->10)->11->14->15
0->3->4->9 |
===========
同城配送状态图: (当同城配送的在运输中，那么它之前的货单就在待交货状态)
(0->)1->2    |
             |->6->8->15
(0->)1->3->4 |
===========
上门自提状态图:(当上门自提的在运输中或者等待上门自提，那么它之前的货单就在待交货状态)
      |->13->15
1->12 |
      |->6->8->15
*/
const OS_PREORDER = -1; // 预下单状态，需要将货拉到分店后不显示（件数，重量，方量），由收货员填写确认后进入待选线路状态
const OS_READY_PRINT_BAR_CODE = 0; // 待打印二维码
const OS_READY_SELECT_ROADMAP = 1; // 待选物流公司
const OS_READY_DEDUCT_AND_PRINT_ORDER = 2; // 待扣款并打印打印货单（用来区别需要付款的情况）
const OS_READY_PAYMENT = 3; // 待付款
const OS_READY_PRINT_ORDER = 4; // 待打印货单
const OS_READY_STOCK = 5; // 待库存
const OS_READY_LOAD = 6; // 待装车
const OS_READY_START_OFF = 7; // 待出发
const OS_ON_THE_WAY = 8; // 运输中
const OS_READY_SEND = 9; // 待发货 (收货点专用)
const OS_ON_SENDING = 10; // 发货中 (收货点专用)
const OS_ON_TRANSFER = 11; // 中转中
const OS_READY_PHONE_CONFIRM = 12; // 待打电话确认
const OS_WAIT_CLIENT_PICK = 13; // 等待上门自提
const OS_READY_RECEIVE = 14; // 待交货
const OS_RECEIVE_SUCCESS = 15; // 交货成功

module.exports =  {
    OS_PREORDER,
    OS_READY_PRINT_BAR_CODE,
    OS_READY_SELECT_ROADMAP,
    OS_READY_DEDUCT_AND_PRINT_ORDER,
    OS_READY_PAYMENT,
    OS_READY_PRINT_ORDER,
    OS_READY_STOCK,
    OS_READY_LOAD,
    OS_READY_START_OFF,
    OS_ON_THE_WAY,
    OS_READY_SEND,
    OS_ON_SENDING,
    OS_ON_TRANSFER,
    OS_READY_PHONE_CONFIRM,
    OS_WAIT_CLIENT_PICK,
    OS_READY_RECEIVE,
    OS_RECEIVE_SUCCESS,

    // mapper
    MAP: {
        [OS_PREORDER]: '预下单状态',
        [OS_READY_PRINT_BAR_CODE]: '待打印二维码',
        [OS_READY_SELECT_ROADMAP]: '待选线路',
        [OS_READY_DEDUCT_AND_PRINT_ORDER]: '待打印收据',
        [OS_READY_PAYMENT]: '待付款',
        [OS_READY_PRINT_ORDER]: '待打印收据',
        [OS_READY_STOCK]: '待库存',
        [OS_READY_LOAD]: '待装车',
        [OS_READY_START_OFF]: '待出发',
        [OS_ON_THE_WAY]: '运输中',
        [OS_READY_SEND]: '待发货',
        [OS_ON_SENDING]: '发货中',
        [OS_ON_TRANSFER]: '运输中',
        [OS_READY_PHONE_CONFIRM]: '待打电话确认',
        [OS_WAIT_CLIENT_PICK]: '等待上门自提',
        [OS_READY_RECEIVE]: '待交货',
        [OS_RECEIVE_SUCCESS]: '交货成功',
    },
};

```

* PDClient/project/App/config/Partment.js

```js
'use strict';
// 注意：常量部分必须和服务器保持一致
const SP_RECEIVE_PARTMENT = 0; // 收货部
const SP_WARE_HOUSE_PARTMENT = 1; // 库管部
const SP_CARRY_PARTMENT = 2; // 搬运部
const SP_SECURITY_CHECK_PARTMENT = 3; // 保安部
const SP_DISTRIBUTION_PARTMENT = 4; // 同城配送部

module.exports = {
    SP_RECEIVE_PARTMENT,
    SP_WARE_HOUSE_PARTMENT,
    SP_CARRY_PARTMENT,
    SP_SECURITY_CHECK_PARTMENT,
    SP_DISTRIBUTION_PARTMENT,

    // mapper
    MAP: {
        [SP_RECEIVE_PARTMENT]: '收货部',
        [SP_WARE_HOUSE_PARTMENT]: '库管部',
        [SP_CARRY_PARTMENT]: '搬运部',
        [SP_SECURITY_CHECK_PARTMENT]: '保安部',
        [SP_DISTRIBUTION_PARTMENT]: '同城配送部',
    },
};

```

* PDClient/project/App/config/Position.js

```js
'use strict';
const PO_CHAIR_MAN = '董事长';
const PO_PARTMENT_CHARGE_MAN = '部门经理';
const PO_CEO = '总经理';
const PO_PARTMENT_LEADER = '部门主管';
const PO_STAFF = '员工';

module.exports = {
    PO_CHAIR_MAN,
    PO_PARTMENT_CHARGE_MAN,
    PO_CEO,
    PO_PARTMENT_LEADER,
    PO_STAFF,

    // 公司职位
    SHOP_MAP: [PO_STAFF, PO_CEO, PO_PARTMENT_LEADER],
    // 部门职位
    PARTMENT_MAP: [PO_STAFF],
};

```

* PDClient/project/App/config/Route.js

```js
'use strict';

const { BASE_SERVER } = CONSTANTS;
const ROOT_SERVER = 'http://' + BASE_SERVER + '/';
const API_SERVER = ROOT_SERVER + 'api/';
const SERVER = API_SERVER + 'client/';
const SHIPPER_SERVER = API_SERVER + 'shipper/';
const AGENT_SERVER = API_SERVER + 'agent/';

module.exports = {
    // 登录
    ROUTE_REGISTER: SERVER + 'register', // 注册
    ROUTE_LOGIN: SERVER + 'login', // 登录
    ROUTE_FIND_PASSWORD: SERVER + 'findPassword', // 忘记密码
    ROUTE_MODIFY_PASSWORD: SERVER + 'modifyPassword', // 修改密码
    ROUTE_REQUEST_SEND_VERIFY_CODE: API_SERVER + 'requestSendVerifyCode', // 获取验证码

    // 个人中心
    ROUTE_GET_PERSONAL_INFO: SERVER + 'getPersonalInfo', // 获取个人信息
    ROUTE_MODIFY_PERSONAL_INFO: SERVER + 'modifyPersonalInfo', // 修改个人信息
    ROUTE_SUBMIT_FEEDBACK: SERVER + 'submitFeedback', // 提交信息反馈
    ROUTE_GET_REGION_ADDRESS_LIST: API_SERVER + 'getRegionAddress', // 获取地址列表
    ROUTE_GET_ADDRESS_FROM_LAST_CODE: API_SERVER + 'getRegionAddressFromLastCode', // 通过lastCode获取具体的地址列表
    ROUTE_GET_START_POINT_ADDRESS_LIST: API_SERVER + 'getStartPointAddress', // 获取收货点地址列表
    ROUTE_GET_START_POINT_ADDRESS_FROME_LAST_CODE: API_SERVER + 'getStartPointAddressFromLastCode', // 通过lastCode获取收货点地址列表
    ROUTE_GET_SEND_DOOR_ADDRESS_FROM_LAST_CODE: API_SERVER + 'getRegionSendDoorAddressFromLastCode', // 通过lastCode获取短途地址列表
    ROUTE_GET_SHIPPERLIST_LIST: SERVER + 'shipperList', // 获取分店列表
    ROUTE_GET_BILL_LIST: SERVER + 'getBillList', // 获取交易明细列表
    ROUTE_RECHARGE:SERVER + 'recharge', // 充值
    ROUTE_WITHDRAW:SERVER + 'withdraw', // 提现
    ROUTE_GET_REMAIN_AMOUNT: SERVER + 'getRemainAmount', // 获取账户余额
    ROUTE_GET_UNIFIED_ORDER: SERVER + 'weixinPayGetUnifiedOrder', // 微信统一下单
    ROUTE_SET_PAYMENT_PASSWORD: SERVER + 'setPaymentPassword', // 修改支付密码

    // 收货点
    ROUTE_PLACE_ORDER_AGENT: AGENT_SERVER + 'placeOrder', // 下单
    ROUTE_MODIFY_ORDER_AGENT: AGENT_SERVER + 'modifyOrder', // 修改货单
    ROUTE_GET_PRE_ORDER_LIST_AGENT: AGENT_SERVER + 'getPreOrderList', // 获取预下单列表
    ROUTE_PRINT_BAR_CODE: AGENT_SERVER + 'printBarCode', // 打印二维码
    ROUTE_PRINT_ORDER_BILL: AGENT_SERVER + 'printOrderBill', // 打印收据
    ROUTE_PRINT_ORDER_LIST_BILL: AGENT_SERVER + 'printOrderListBill', // 打印收据
    ROUTE_CONFIRM_CACH_PAYED: AGENT_SERVER + 'confirmCachPayed', // 为订单支付
    ROUTE_CONFIRM_CACH_PAYED_FOR_ORDER_LIST: AGENT_SERVER + 'confirmCachPayedForOrderList', // 为订单支付
    ROUTE_GET_LASTEST_ORDER: AGENT_SERVER + 'getLastestOrder', // 收货点获取未完成的货单
    ROUTE_GET_MEMBER_LIST_AGENT: AGENT_SERVER + 'getMemberList', // 收货点获取成员列表
    ROUTE_GET_MEMBER_BY_PHONE_AGENT: AGENT_SERVER + 'getMemberByPhone', // 收货点通过手机号获取成员信息
    ROUTE_MODIFY_MEMBER_AUTHORITY_AGENT: AGENT_SERVER + 'modifyMemberAuthority', // 收货点修改成员权限
    ROUTE_GET_ORDERS : AGENT_SERVER + 'getOrders', // 获取收货点货单列表
    ROUTE_GET_ORDER_DETAIL_AGENT : AGENT_SERVER + 'getOrderDetail', // 获取收货点货单详情
    ROUTE_GET_REGION_PROFIT_LIST : AGENT_SERVER + 'getRegionProfitList', // 收货点获取已设置路线列表
    ROUTE_REMOVE_REGION_PROFIT : AGENT_SERVER + 'removeRegionProfit', // 收货点删除路线提成
    ROUTE_ADD_REGION_PROFIT : AGENT_SERVER + 'addRegionProfit', // 收货点创建路线提成
    ROUTE_MODIFY_REGION_PROFIT : AGENT_SERVER + 'modifyRegionProfit', // 收货点修改路线提成
    ROUTE_SET_REGION_PROFIT_WITH_LIST : AGENT_SERVER + 'setRegionProfitWithList', // 收货点批量修改路线提成
    ROUTE_GET_REFER_SHOP_LIST: AGENT_SERVER + 'getReferShopList', // 收货点获取参考分店列表
    ROUTE_SET_REFER_SHOP: AGENT_SERVER + 'setReferShop', // 收货点设置参考分店
    ROUTE_PAY_AGENT_FOR_ORDER : SERVER + 'payForAgentOrder', // 客户为收货点货单付款

    // 物流公司
    ROUTE_GET_SHIPPER_LIST: SERVER + 'getShipperList', // 获取物流公司列表
    ROUTE_GET_SHIPPER_DETAIL: SERVER + 'getShipperDetail', // 获取物流公司详情
    ROUTE_CARE_SHIPPER: SERVER + 'careShipper', // 关注物流公司
    ROUTE_GET_CARED_SHIPPER_LIST: SERVER + 'getCaredShipperList', // 获取关注物流公司列表

    ROUTE_GET_NEED_SEND_ORDER_SUMMARY_LIST:SHIPPER_SERVER + 'getNeedSendOrderSummaryList', // 物流公司竟得货物
    ROUTE_GET_NEED_SEND_ORDER_LIST_BY_END_POINT:SHIPPER_SERVER + 'getNeedSendOrderListByEndPoint', // 物流公司竟得货物订单列表
    ROUTE_CREATE_TRUCK:SHIPPER_SERVER + 'createTruck', // 创建卡车
    ROUTE_GET_WORK_TRUCKLIST:SHIPPER_SERVER + 'getWorkTruckList', // 获取卡车列表
    ROUTE_GET_TRUCKS: SHIPPER_SERVER + 'getTrucks', // 获取已装货单卡车列表，用在物流公司货车页面
    ROUTE_GET_UNFINISH_RUCK: SHIPPER_SERVER + 'getUnfinishTruck', // 获取未装完货单卡车信息
    ROUTE_GET_ORDER_LIST_IN_RUCKS: SHIPPER_SERVER + 'getOrderListInTruck', // 获取货车中的装货单列表，用在物流公司货车页面
    ROUTE_GET_CARRY_PARTMENT_LIST: SHIPPER_SERVER + 'getCarryPartmentList', // 获取搬运队列表
    ROUTE_SCAN_LOAD_ORDER: SHIPPER_SERVER + 'scanLoadOrder', // 扫描货单
    ROUTE_SELECT_CARRY_PARTMENT: SHIPPER_SERVER + 'selectCarryPartment', // 选择搬运队
    ROUTE_START_SCAN_ORDER: SHIPPER_SERVER + 'startScanOrder', // 货车开始扫描
    ROUTE_CONTINUE_SCAN_ORDER: SHIPPER_SERVER + 'continueScanOrder', // 货车继续扫描
    ROUTE_FINISH_SCAN_ORDER: SHIPPER_SERVER + 'finishScanOrder', // 货车结束扫描
    ROUTE_GET_HISTORY_TRUCK_LIST: SHIPPER_SERVER + 'getHistoryTruckList', // 物流公司历史审核卡车信息
    ROUTE_PAY_FOR_CARRY_PARTMENT: SHIPPER_SERVER + 'payForCarryPartment', // 物流公司付搬运费
    ROUTE_GET_BRANCH_SHOP_INFO: SERVER + 'getBranchShopInfo', // 物流公司获取入驻分店详情包括担保公司
    ROUTE_GET_MEMBER_LIST: SHIPPER_SERVER + 'getMemberList', // 物流公司获取成员列表
    ROUTE_GET_MEMBER_BY_PHONE: SHIPPER_SERVER + 'getMemberByPhone', // 物流公司通过手机号获取成员信息
    ROUTE_MODIFY_MEMBER_AUTHORITY: SHIPPER_SERVER + 'modifyMemberAuthority', // 物流公司修改成员权限

    // 路线
    ROUTE_GET_ROADMAP_LIST: SERVER + 'getRoadmapList', // 获取路线列表
    ROUTE_GET_ROADMAP_DETAIL: SERVER + 'getRoadmapDetail', // 获取路线详情
    ROUTE_GET_ROADMAP_LIST_WITH_END_POINT: SERVER + 'getRoadmapListWithEndPoint', // 获取路线行情列表
    ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER: SERVER + 'getRoadmapListWithPreOrder', // 通过货单获取区域收货点和分店路线列表
    ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER_GROUP: SERVER + 'getRoadmapListWithPreOrderGroup', // 通过货单组获取区域收货点和分店路线列表
    ROUTE_GET_LOGISTICS_LIST: SERVER + 'getLogisticsList', // 获取订单物流信息
    ROUTE_GET_ROADMAP_LIST_SHIPPER:SHIPPER_SERVER + 'getRoadmapList', // 获取路线列表
    ROUTE_PUBLISH_ROADMAP:SHIPPER_SERVER + 'publishRoadmap', // 发布路线
    ROUTE_REMOVE_ROADMAP:SHIPPER_SERVER + 'removeRoadmap', // 删除路线
    ROUTE_GET_SHIPPER_ROADMAP_DETAIL: SHIPPER_SERVER + 'getRoadmapDetail', // 物流公司获取路线详情
    ROUTE_MODIFY_ROADMAP: SHIPPER_SERVER + 'modifyRoadmap', // 物流公司修改路线
    ROUTE_SET_ROADMAP_PRICE: SHIPPER_SERVER + 'setRoadmapPrice', // 物流公司修改路线价格
    ROUTE_SET_ROADMAP_SEND_DOOR_ENABLE: SHIPPER_SERVER + 'setRoadmapSendDoorEnable', // 物流公司修改长途路线对应的送货上门路线状态
    ROUTE_SET_ROADMAP_ENABLE: SHIPPER_SERVER + 'setRoadmapEnable', // 物流公司修改路线状态(开通/停运)
    ROUTE_SET_ROADMAP_SEND_DOOR_PRICE: SHIPPER_SERVER + 'setRoadmapSendDoorPrice', // 物流公司修改路线对应送货上门路线价格

    // 用户
    ROUTE_GET_CLIENT_LIST: SERVER + 'getClientList', // 获取用户列表
    ROUTE_GET_DRIVER_INFO_BY_PHONE:SHIPPER_SERVER + 'getDriverInfoByPhone', // 通过手机号获取司机信息

    // 订单
    ROUTE_PLACE_PRE_ORDER: SERVER + 'placePreOrder', // 预下单
    ROUTE_GET_PRE_ORDER_LIST: SERVER + 'getPreOrderList', // 获取预下单列表
    ROUTE_CREATE_PRE_ORDER_GROUP:SERVER + 'createPreOrderGroup', // 合并预下单
    ROUTE_GET_PRE_ORDER_GROUP_LIST:SERVER + 'getPreOrderGroupList', // 获取预下单群组列表
    ROUTE_GET_PRE_ORDER_LIST_IN_GROUP:SERVER + 'getPreOrderListInGroup', // 获取某个群组中的预下单列表
    ROUTE_REMOVE_PRE_ORDER_LIST_FROM_GROUP:SERVER + 'removePreOrderFromGroup', // 删除某个群组中的预下单列表

    ROUTE_PLACE_ORDER: SERVER + 'placeOrder', // 下单
    ROUTE_GET_SEND_ORDER_LIST: SERVER + 'getSendOrderList', // 获取发出订单列表
    ROUTE_GET_RECEIVE_ORDER_LIST: SERVER + 'getReceiveOrderList', // 获取发出订单列表
    ROUTE_GET_ORDER_LIST: SERVER + 'getOrderList', // 获取订单列表
    ROUTE_GET_ORDER_DETAIL: SERVER + 'getOrderDetail', // 获取订单详情
    ROUTE_MODIFY_ORDER: SERVER + 'modifyOrder', // 修改订单
    ROUTE_MODIFY_PRE_ORDER: SERVER + 'modifyPreOrder', // 修改预下单
    ROUTE_REMOVE_PRE_ORDER: SERVER + 'removePreOrder', // 删除订单
    ROUTE_PAY_FOR_ORDER_WHEN_SEND: SERVER + 'payForOrderWhenSend', // 线上立即支付(发货)
    ROUTE_PAY_FOR_ORDER_WHEN_RECEIVE: SERVER + 'payForOrderWhenReceive', // 线上立即支付（收货）
    ROUTE_FINISH_ORDER: SERVER + 'finishOrder', // 现付成功
    ROUTE_MODIFY_PRE_ORDER_GROUP: SERVER + 'modifyPreOrderGroup', // 修改预下单组群
    ROUTE_CONFIRM_HAND_OVER_ORDER: SHIPPER_SERVER + 'confirmHandOverOrder', // 确认货物到达，确认后收货人才能收货

    // 文件上传
    ROUTE_UPDATE_FILE: API_SERVER + 'uploadFile', // 上传文件

    // 网页地址
    ROUTE_USER_LICENSE: ROOT_SERVER + 'protocals/pdclient/user.html', // 用户协议
    ROUTE_SOFTWARE_LICENSE: ROOT_SERVER + 'protocals/pdclient/software.html', // 获取软件许可协议
    ROUTE_ABOUT_PAGE: ROOT_SERVER + 'protocals/pdclient/about.html', // 关于

    // 下载更新
    ROUTE_VERSION_INFO_URL: ROOT_SERVER + 'apps/pdclient/version.json', // 版本信息地址
    ROUTE_JS_ANDROID_URL: ROOT_SERVER + 'apps/pdclient/jsandroid.zip', // android jsbundle 包地址
    ROUTE_JS_IOS_URL: ROOT_SERVER + 'apps/pdclient/jsios.zip', // ios jsbundle 包地址
    ROUTE_APK_URL: ROOT_SERVER + 'apps/pdclient/pdclient.apk', // apk地址

    // 同城配送
    ROUTE_PLACE_STORAGE : SHIPPER_SERVER + 'placeStorage', // 短途物流公司扫描入库
    ROUTE_SET_CITY_TRUCK : SHIPPER_SERVER + 'setCityTruck', // 短途物流公司设置货车
    ROUTE_SCAN_LOAD_ORDER_FOR_CITY_DISTRIBUTE : SHIPPER_SERVER + 'scanLoadOrderForCityDistribute', //短途物流公司扫描装车
    ROUTE_GET_CITY_DISTRIBUTE_ORDERS : SHIPPER_SERVER + 'getCityDistributeOrders',// 短途物流公司获取同城配送货单
    ROUTE_SET_CLIENT_PICK_ORDER_TRANSPORT_FEE : SHIPPER_SERVER + 'setClientPickOrderTransportFee',//短途物流公司设置送货上门
};

```

* PDClient/project/App/config/Screen.js

```js
'use strict';

const ReactNative = require('react-native');
const {
    Dimensions,
    PixelRatio,
    Platform,
    NativeModules,
} = ReactNative;

const SCREEN_WIDTH_BASE = 375;
const { width, height } = Dimensions.get('screen') || Dimensions.get('window');
const pxielRatio = PixelRatio.get();
const { TotalNavHeight, NavBarHeight, StatusBarHeight } = Navigator.NavigationBar.Styles.General;
const translucent = NativeModules.SplashScreen.translucent;
const statusBarHeight = (Platform.OS === 'android' && !translucent) ? StatusBarHeight : 0;
const workHeight = height - statusBarHeight;

module.exports = {
    translucent: NativeModules.SplashScreen.translucent,
    tw: width, // 屏幕的真实宽度
    w: SCREEN_WIDTH_BASE, // 屏幕的宽度
    th: workHeight, // 屏幕的真实高度（android不包含状态栏）
    h: workHeight * SCREEN_WIDTH_BASE / width, // 屏幕的高度（android不包含状态栏）
    tfh: height, // 屏幕全屏的真实高度（android包含状态栏）
    fh: height * SCREEN_WIDTH_BASE / width, // 屏幕全屏的高度（android包含状态栏）
    tch: workHeight - TotalNavHeight, // 界面的真实高度
    ch: (workHeight - TotalNavHeight) * SCREEN_WIDTH_BASE / width, // 界面的高度
    trueStatusBarHeight: StatusBarHeight, // android状态栏真实高度
    statusBarHeight: StatusBarHeight * SCREEN_WIDTH_BASE / width, // android状态栏高度
    trueTotalNavHeight: NavBarHeight, // 导航栏的真实高度
    navbarHeight: NavBarHeight * SCREEN_WIDTH_BASE / width, // 导航栏的高度
    trueTotalNavbarHeight: TotalNavHeight, // 导航栏的真实总高度
    totalNavbarHeight: TotalNavHeight * SCREEN_WIDTH_BASE / width, // 导航栏的总高度
    pr: pxielRatio,
    s: (w) => { return w * width / SCREEN_WIDTH_BASE; },
    rs: (w) => { return w * SCREEN_WIDTH_BASE / width; },
};

```

* PDClient/project/App/config/TruckState.js

```js
'use strict';
// 注意：常量部分必须和服务器保持一致

const TS_READY_EXAMINE = 0; // 待审核
const TS_READY_ENTER_WAREHOUSE = 1; // 待入库
const TS_READY_SEARCH_CARRY_PARTMENT = 2; // 待找搬运队
const TS_READY_SCAN_LOAD = 3; // 待扫描装车
const TS_SCAN_LOADING = 4; // 装车中
const TS_READY_PAY_FOR_CARRY_PARTMENT = 5; // 待付搬运部的款
const TS_READY_EXIT_WAREHOUSE = 6; // 待出库
const TS_ON_THE_WAY = 7; // 运输中
const TS_RECEIVE_SUCCESS = 8; // 交货成功

module.exports = {
    TS_READY_EXAMINE,
    TS_READY_ENTER_WAREHOUSE,
    TS_READY_SEARCH_CARRY_PARTMENT,
    TS_READY_SCAN_LOAD,
    TS_SCAN_LOADING,
    TS_READY_PAY_FOR_CARRY_PARTMENT,
    TS_READY_EXIT_WAREHOUSE,
    TS_ON_THE_WAY,
    TS_RECEIVE_SUCCESS,

    // mapper
    MAP: {
        [TS_READY_EXAMINE]: '待审核',
        [TS_READY_ENTER_WAREHOUSE]: '待入库',
        [TS_READY_SEARCH_CARRY_PARTMENT]: '待找搬运队',
        [TS_READY_SCAN_LOAD]: '待扫描装车',
        [TS_SCAN_LOADING]: '装车中',
        [TS_READY_PAY_FOR_CARRY_PARTMENT]: '待付搬运部的款',
        [TS_READY_EXIT_WAREHOUSE]: '待出库',
        [TS_ON_THE_WAY]: '运输中',
        [TS_RECEIVE_SUCCESS]: '交货成功',
    },
};

```

* PDClient/project/App/manager/AuthorityMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');
const ITEM_NAME = 'authorityInfo';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let info;
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                info = JSON.parse(infoStr);
            } catch (e) {
            }
            this.info = info || {};
        });
    }
    set (info) {
        this.info = info;
        return new Promise(async(resolve, reject) => {
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(info));
            resolve();
        });
    }
    getCanSelectRoles () {
        return _.reject(this.info.roleList, (o) => { return o == this.info.currentRole; });
    }
    changeRole (role) {
        this.info.currentRole = role;
        return new Promise(async(resolve, reject) => {
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(this.info));
            resolve();
        });
    }
    clear () {
        this.info = {};
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDClient/project/App/manager/JpushMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    NativeAppEventEmitter,
    Platform,
} = ReactNative;
const EventEmitter = require('EventEmitter');
import JPushModule from 'jpush-react-native';
class Manager extends EventEmitter {
    register () {
        if (Platform.OS === 'android') {
            JPushModule.notifyJSDidLoad((resultCode) => {
                if (resultCode === 0) {
                    console.log('--------------notifyJSDidLoad success');
                }
            });
            JPushModule.addReceiveNotificationListener((map) => {
                console.log('------------------addReceiveNotificationListener' + JSON.stringify(map));
                this.emit('receiveJpushNotification', { context:map.alertContent });
                   // var extra = JSON.parse(map.extras);
                   // console.log(extra.key + ": " + extra.value);
            });
        } else {
            this.subscription = NativeAppEventEmitter.addListener(
             'receiveNotification',
             (notification) => {
                 console.log('----------------notification', notification);
                 this.emit('receiveJpushNotification', { context:notification.aps.alert });
             }
           );
        }
    }
    clear () {
        if (this.subscription) {
            this.subscription.remove();
            this.subscription = null;
        }
        JPushModule.removeReceiveCustomMsgListener();
        JPushModule.removeReceiveNotificationListener();
    }
}

module.exports = new Manager();

```

* PDClient/project/App/manager/LoginMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'LOGIN_HISTORY_LIST';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.list = [];
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let list = [];
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                list = JSON.parse(infoStr);
            } catch (e) {
            }
            this.list = list || [];
        });
    }
    set (list) {
        return new Promise(async(resolve, reject) => {
            this.list = list;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(list));
            resolve();
        });
    }
    savePhone (phone) {
        let list = this.list;
        if (_.includes(list, phone)) {
            list = _.without(list, phone);
        }
        list.unshift(phone);
        this.set(list);
    }
    clear () {
        this.list = [];
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDClient/project/App/manager/NetMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    Platform,
    NetInfo,
} = ReactNative;
const EventEmitter = require('EventEmitter');

class Manager extends EventEmitter {
    constructor () {
        super();
        this._init = false;
        this.info = {
            connect: false, // 是否连接
            fee: false, // 是否收费
        };
    }
    register () {
        if (!this._init) {
            this._init = true;
            NetInfo.addEventListener(
                'change',
                this._handleConnectionInfoChange.bind(this)
            );
        }
    }
    unregister () {
        NetInfo.removeEventListener(
            'change',
            this._handleConnectionInfoChange.bind(this)
        );
        this._init = false;
    }
    _handleConnectionInfoChange (o) {
        this.updateConnectionInfo(o);
    }
    updateConnectionInfo (o) {
        if (Platform.OS === 'android') {
            if (o === 'WIFI' || o === 'ETHERNET' || o === 'DUMMY') {
                this.info = { connect: true, fee: false };
            } else if (/MOBILE.*/.test(o)) {
                this.info = { connect: true, fee: true };
            } else {
                this.info = { connect: false, fee: false };
            }
        } else {
            if (o === 'wifi') {
                this.info = { connect: true, fee: false };
            } else if (o === 'cell') {
                this.info = { connect: true, fee: true };
            } else {
                this.info = { connect: false, fee: false };
            }
        }
        app.connect = this.info.connect;
        if (!app.connect) {
            // Toast('当前设备已离线，请检查您的网络是否可用');
        }
    }
}

module.exports = new Manager();

```

* PDClient/project/App/manager/PersonalInfoMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');
const ITEM_NAME = 'personalInfo';
const NEED_LOGIN_ITEM_NAME = 'personalInfoNeedLogin';
const REMAIN_AMOUNR = 'remainAmount';
const CURRENT_SHOP_INDEX = 'currentShopIndex';
const IS_FINISH_SCAN = 'isFinishScan';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let info;
            try {
                const needLogin = await AsyncStorage.getItem(NEED_LOGIN_ITEM_NAME);
                const index = await AsyncStorage.getItem(CURRENT_SHOP_INDEX);
                const isFinishScan = await AsyncStorage.getItem(IS_FINISH_SCAN);
                this.needLogin = needLogin !== 'false';
                this.currentShopIndex = index || '0';
                this.isFinishScan = isFinishScan || 'false';
                this.remainAmount = await AsyncStorage.getItem(REMAIN_AMOUNR);
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                info = JSON.parse(infoStr);
            } catch (e) {
                this.needLogin = true;
            }
            this.info = info || {};

            this.needLogin = this.needLogin || !info;
            this.currentShopIndex = this.currentShopIndex || '0';
            this.isFinishScan = this.isFinishScan || false;
            this.currentShopId = this.info.shipper && this.info.shipper.registerShopList[this.currentShopIndex].id || null;
            this.currentShopName = this.info.shipper && this.info.shipper.registerShopList[this.currentShopIndex].name || '';
            this.currentShopAddress = this.info.shipper && this.info.shipper.registerShopList[this.currentShopIndex].address || '';
            this.remainAmount = this.remainAmount || !info;
            this.initialized = true;
        });
    }
    set (info) {
        this.info = info;
        let roleList = info.agent ? ['发货人', '收货点'] : info.shipper ? ['发货人', '物流公司'] : ['发货人'];
        let authorityInfo = {
            currentRole: info.agent ? '收货点' : info.shipper ? '物流公司' : '发货人',
            roleList,
            isShipperChairman:!!(info.shipper && info.userId == info.shipper.chairMan.id),
            isAgentChairman:!!(info.agent && info.userId == info.agent.chairMan.id),
            authorityList:info.authority,
        };
        app.authority.clear();
        app.authority.set(authorityInfo);
        return new Promise(async(resolve, reject) => {
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(info));
            resolve();
        });
    }
    setUserHead (head) {
        this.emit('USER_HEAD_CHANGE_EVENT', { head:head });
    }
    setCurrentShopIndex (index) {
        this.currentShopIndex = index;
        AsyncStorage.setItem(CURRENT_SHOP_INDEX, index + '');
    }
    setIsFinishScan (flag) {
        this.isFinishScan = flag;
        AsyncStorage.setItem(IS_FINISH_SCAN, flag + '');
    }
    setNeedLogin (flag) {
        this.needLogin = flag;
        AsyncStorage.setItem(NEED_LOGIN_ITEM_NAME, flag + '');
    }
    setRemainAmount (amount) {
        this.remainAmount = amount;
        AsyncStorage.setItem(REMAIN_AMOUNR, amount + '');
    }
    clear () {
        this.info = {};
        this.needLogin = true;
        this.currentShopIndex = '0';
        this.isFinishScan = false;
        this.currentShopId = null;
        this.currentShopName = '';
        this.remainAmount = 0;
        this.initialized = true;
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDClient/project/App/manager/SettingMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'APP_SETTING_MANAGER';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.data = {};
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let data = {};
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                data = JSON.parse(infoStr);
            } catch (e) {
                data = {};
            }
            this.data = data || {};
            this.THEME_COLOR = this.data.themeColor || CONSTANTS.THEME_COLORS[0];
        });
    }
    set (data) {
        return new Promise(async(resolve, reject) => {
            this.data = data;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(data));
            resolve();
        });
    }
    setOnlyWifiUpload (flag) {
        const data = this.data;
        data.onlyWifiUpload = flag;
        this.set(data);
    }
    setThemeColor (color) {
        const data = this.data;
        data.themeColor = color;
        this.set(data);
        this.THEME_COLOR = color;
        app.update();
    }
    clear () {
        this.data = {};
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDClient/project/App/manager/UpdateMgr.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'NEED_SHOW_SPLASH';
const Update = require('@remobile/react-native-update');
const UpdateInfoBox = require('../modules/update/UpdateInfoBox');

class Manager extends EventEmitter {
    constructor () {
        super();
        this.needShowSplash = true;
        this.getNeedShowSplash();
    }
    checkUpdate () {
        Update.checkVersion({
            versionUrl: app.route.ROUTE_VERSION_INFO_URL,
            iosAppId: CONSTANTS.IOS_APPID,
        }).then((options) => {
            if (!__DEV__ && options && options.newVersion && (app.scene || {}).pageName !== 'UpdatePage') {
                app.showModal(<UpdateInfoBox options={options} />, { backgroundColor:'rgba(0, 0, 0, 0.6)' });
            }
        });
    }
    getNeedShowSplash () {
        return new Promise(async(resolve, reject) => {
            let needShowSplash;
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                needShowSplash = JSON.parse(infoStr);
            } catch (e) {
            }
            this.needShowSplash = needShowSplash == null ? true : needShowSplash;
            this.initialized = true;
        });
    }
    setNeedShowSplash (needShowSplash) {
        return new Promise(async(resolve, reject) => {
            this.needShowSplash = needShowSplash;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(needShowSplash));
            resolve();
        });
    }
    clear () {
        this.needShowSplash = null;
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDClient/project/App/manager/WXpayMgr.js

```js
'use strict';
const { NativeAppEventEmitter, DeviceEventEmitter, Platform } = require('react-native');
const EventEmitter = require('EventEmitter');
const Wxpay = require('../native/index.js').WeixinPay;
const gEventEmitter = Platform.OS === 'android' ? DeviceEventEmitter : NativeAppEventEmitter;

class Manager extends EventEmitter {

    /*
    * 注：amount为充值金额，单位为【元】。
    * body: 描述
    * appid: 公众账号ID
    * noncestr: 随机字符串
    * package: 扩展字段
    * partnerid: 商户号
    * prepayid: 预支付交易会话ID
    * timestamp: 时间戳
    * sign: 签名
    */
    doPay (amount, body, callbackSuccess, callbackError) {
        this.subscription = gEventEmitter.addListener('WEIXIN_PAY', (obj) => { this.onPayResult(obj, callbackSuccess, callbackError); });
        var param = {
            userId:app.personal.info.userId,
            amount, // :1, //总金额 (元)
            body, // :'充值',
        };
        POST(app.route.ROUTE_GET_UNIFIED_ORDER, param, (data) => {
            if (data.success) {
                !data.context ? callbackSuccess(data) : Wxpay.pay(data.context, callbackSuccess, callbackError);
            } else {
                Toast(data.msg);
            }
        });
    }
    onPayResult (data, callbackSuccess, callbackError) {
        if (this.subscription) {
            this.subscription.remove();
            this.subscription = null;
        }
        if (data.success == 'true') {
            callbackSuccess(data);
        } else {
            callbackError(data);
        }
    }
}
module.exports = new Manager();

```

* PDClient/project/App/native/index.js

```js

const WeixinPay = require('./wxpay/index.js');
module.exports = {
    WeixinPay: WeixinPay,
};

```

* PDClient/project/App/resource/audio.js

```js
module.exports = {};

```

* PDClient/project/App/resource/image.js

```js
module.exports = {
    cargo_balance_background:require('./image/cargo/balance_background.png'),
    cargo_cancel:require('./image/cargo/cancel.png'),
    cargo_endPoint:require('./image/cargo/endPoint.png'),
    cargo_point:require('./image/cargo/point.png'),
    common_back:require('./image/common/back.png'),
    common_close:require('./image/common/close.png'),
    common_default:require('./image/common/default.png'),
    common_go:require('./image/common/go.png'),
    common_home:require('./image/common/home.png'),
    common_left_menu:require('./image/common/left_menu.png'),
    common_radio:require('./image/common/radio.png'),
    common_search:require('./image/common/search.png'),
    common_search_button:require('./image/common/search_button.png'),
    home_cargo:require('./image/home/cargo.png'),
    home_cargo_press:require('./image/home/cargo_press.png'),
    home_main:require('./image/home/main.png'),
    home_main_press:require('./image/home/main_press.png'),
    home_mine:require('./image/home/mine.png'),
    home_mine_press:require('./image/home/mine_press.png'),
    home_order:require('./image/home/order.png'),
    home_order_press:require('./image/home/order_press.png'),
    home_pre_order:require('./image/home/pre_order.png'),
    home_pre_order_press:require('./image/home/pre_order_press.png'),
    home_roadmap:require('./image/home/roadmap.png'),
    home_roadmap_press:require('./image/home/roadmap_press.png'),
    home_truck:require('./image/home/truck.png'),
    home_truck_unselect:require('./image/home/truck_unselect.png'),
    login_alipay_button:require('./image/login/alipay_button.png'),
    login_logo:require('./image/login/logo.png'),
    login_password:require('./image/login/password.png'),
    login_password_check:require('./image/login/password_check.png'),
    login_password_look:require('./image/login/password_look.png'),
    login_phone:require('./image/login/phone.png'),
    login_qq_button:require('./image/login/qq_button.png'),
    login_weixin_button:require('./image/login/weixin_button.png'),
    order_add:require('./image/order/add.png'),
    order_choose:require('./image/order/choose.png'),
    order_choose_r:require('./image/order/choose_r.png'),
    order_delete:require('./image/order/delete.png'),
    order_down:require('./image/order/down.png'),
    order_logo:require('./image/order/logo.png'),
    order_no_choose:require('./image/order/no_choose.png'),
    order_no_choose_r:require('./image/order/no_choose_r.png'),
    order_pay_success:require('./image/order/pay_success.png'),
    order_point:require('./image/order/point.png'),
    order_point_green:require('./image/order/point_green.png'),
    order_upload_picture:require('./image/order/upload_picture.png'),
    personal_add:require('./image/personal/add.png'),
    personal_default_head:require('./image/personal/default_head.png'),
    personal_delete:require('./image/personal/delete.png'),
    personal_female:require('./image/personal/female.png'),
    personal_info:require('./image/personal/info.png'),
    personal_male:require('./image/personal/male.png'),
    personal_money:require('./image/personal/money.png'),
    personal_personal_center:require('./image/personal/personal_center.png'),
    personal_scan:require('./image/personal/scan.png'),
    personal_settings:require('./image/personal/settings.png'),
    personal_wallet:require('./image/personal/wallet.png'),
    roadmap_add_photos:require('./image/roadmap/add_photos.png'),
    roadmap_address:require('./image/roadmap/address.png'),
    roadmap_collection_normal:require('./image/roadmap/collection_normal.png'),
    roadmap_collection_press:require('./image/roadmap/collection_press.png'),
    roadmap_comment:require('./image/roadmap/comment.png'),
    roadmap_share:require('./image/roadmap/share.png'),
    shipper_care_normal:require('./image/shipper/care_normal.png'),
    shipper_care_press:require('./image/shipper/care_press.png'),
    shipper_phone:require('./image/shipper/phone.png'),
    shipper_tell_phone:require('./image/shipper/tell_phone.png'),
    shop_add_photos:require('./image/shop/add_photos.png'),
    shop_address:require('./image/shop/address.png'),
    shop_back:require('./image/shop/back.png'),
    shop_choice:require('./image/shop/choice.png'),
    shop_comment:require('./image/shop/comment.png'),
    shop_follow_normal:require('./image/shop/follow_normal.png'),
    shop_follow_press:require('./image/shop/follow_press.png'),
    shop_home:require('./image/shop/home.png'),
    shop_no_comment:require('./image/shop/no_comment.png'),
    shop_no_share:require('./image/shop/no_share.png'),
    shop_phone:require('./image/shop/phone.png'),
    shop_praise_normal:require('./image/shop/praise_normal.png'),
    shop_praise_press:require('./image/shop/praise_press.png'),
    shop_report_normal:require('./image/shop/report_normal.png'),
    shop_report_press:require('./image/shop/report_press.png'),
    shop_share:require('./image/shop/share.png'),
    shop_shop_down_left:require('./image/shop/shop_down_left.png'),
    shop_shop_down_right:require('./image/shop/shop_down_right.png'),
    shop_unchoice:require('./image/shop/unchoice.png'),
    shop_zan_normal:require('./image/shop/zan_normal.png'),
    shop_zan_press:require('./image/shop/zan_press.png'),
    splash_logo:require('./image/splash/logo.png'),
    splash_splash1:require('./image/splash/splash1.png'),
    splash_splash2:require('./image/splash/splash2.png'),
    splash_splash3:require('./image/splash/splash3.png'),
    splash_start:require('./image/splash/start.png'),
};

```

* PDClient/project/App/utils/index.js

```js
const common = require('./common');
const net = require('./net');
const check = require('./check');
const date = require('./date');
const qrcode = require('./qrcode');

module.exports = {
    ...common,
    ...net,
    ...check,
    ...date,
    ...qrcode,
};

```

* PDClient/project/App/components/ActionSheet/button.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    render () {
        return (
            <TouchableOpacity
                activeOpacity={0.5}
                style={[styles.button, this.props.buttonStyle]}
                onPress={this.props.onPress}>
                <Text style={[styles.buttonText, this.props.textStyle]}>
                    {this.props.children}
                </Text>
            </TouchableOpacity>
        );
    },
});

const styles = StyleSheet.create({
    buttonText: {
        color: '#A1A2A3',
        alignSelf: 'center',
        fontSize: 18,
    },
    button: {
        height: 50,
        backgroundColor: '#FEFFFF',
        borderColor: '#EDEEEF',
        borderBottomWidth: 1,
        alignSelf: 'stretch',
        justifyContent: 'center',
    },
});

```

* PDClient/project/App/components/ActionSheet/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    TouchableOpacity,
    View,
} = ReactNative;

const Button = require('./button');
const Overlay = require('./overlay');
const Sheet = require('./sheet');

module.exports = React.createClass({
    getDefaultProps () {
        return {
            cancelText: 'Cancel',
        };
    },
    render () {
        return (
            <Overlay visible={this.props.visible}>
                <View style={styles.actionSheetContainer}>
                    <TouchableOpacity
                        style={{ flex:1 }}
                        onPress={this.props.onCancel} />
                    <Sheet visible={this.props.visible}>
                        <View style={styles.buttonContainer}>
                            {this.props.children}
                        </View>
                        <Button
                            buttonStyle={styles.cancelButton}
                            textStyle={styles.cancelText}
                            onPress={this.props.onCancel}>{this.props.cancelText}</Button>
                    </Sheet>
                </View>
            </Overlay>
        );
    },
});
module.exports.Button = Button;

const styles = StyleSheet.create({
    actionSheetContainer: {
        flex: 1,
        padding: 10,
        paddingBottom: 6,
        justifyContent: 'flex-end',
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
    },
    buttonContainer: {
        borderRadius:6,
        overflow: 'hidden',
    },
    cancelButton: {
        marginTop:6,
        marginBottom:6,
        borderRadius:6,
        backgroundColor: '#A0D26F',
        borderBottomWidth: 0,
    },
    cancelText: {
        color:'#FFFFFF',
    },
});

```

* PDClient/project/App/components/ActionSheet/overlay.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Animated,
    StyleSheet,
} = ReactNative;

const DEFAULT_ANIMATE_TIME = 300;

module.exports = React.createClass({
    getInitialState () {
        return {
            fadeAnim: new Animated.Value(0),
            overlayStyle: styles.emptyOverlay, // on android opacity=0 also can cover screen, so use overlayStyle fix it
        };
    },
    onAnimatedEnd () {
        !this.props.visible && this.setState({ overlayStyle:styles.emptyOverlay });
    },
    componentWillReceiveProps (newProps) {
        newProps.visible && this.setState({ overlayStyle: styles.fullOverlay });
        return Animated.timing(this.state.fadeAnim, {
            toValue: newProps.visible ? 1 : 0,
            duration: DEFAULT_ANIMATE_TIME,
        }).start(this.onAnimatedEnd);
    },

    render () {
        return (
            <Animated.View style={[this.state.overlayStyle, { opacity: this.state.fadeAnim }]}>
                {this.props.children}
            </Animated.View>
        );
    },
});

const styles = StyleSheet.create({
    fullOverlay: {
        top: 0,
        bottom: 0,
        left: 0,
        right: 0,
        backgroundColor: 'transparent',
        position: 'absolute',
    },
    emptyOverlay: {
        backgroundColor: 'transparent',
        position: 'absolute',
        left: -sr.w,
    },
});

```

* PDClient/project/App/components/ActionSheet/sheet.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Animated,
} = ReactNative;

const DEFAULT_BOTTOM = -300;
const DEFAULT_ANIMATE_TIME = 300;

module.exports = React.createClass({
    getInitialState () {
        return {
            bottom: new Animated.Value(DEFAULT_BOTTOM),
        };
    },
    componentWillReceiveProps (newProps) {
        return Animated.timing(this.state.bottom, {
            toValue: newProps.visible ? 0 : DEFAULT_BOTTOM,
            duration: DEFAULT_ANIMATE_TIME,
        }).start();
    },

    render () {
        return (
            <Animated.View style={{ bottom: this.state.bottom }}>
                {this.props.children}
            </Animated.View>
        );
    },
});

```

* PDClient/project/App/components/ActionSheet/view.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    TouchableOpacity,
    View,
} = ReactNative;

const Button = require('./button');
const Sheet = require('./sheet');

module.exports = React.createClass({
    getDefaultProps () {
        return {
            cancelText: 'Cancel',
        };
    },
    render () {
        return (
            <View style={styles.actionSheetContainer}>
                <TouchableOpacity
                    style={{ flex:1 }}
                    onPress={this.props.onCancel} />
                <View visible={this.props.visible}>
                    <View style={styles.buttonContainer}>
                        {this.props.children}
                    </View>
                    <Button
                        buttonStyle={styles.cancelButton}
                        textStyle={styles.cancelText}
                        onPress={this.props.onCancel}>{this.props.cancelText}</Button>
                </View>
            </View>
        );
    },
});
module.exports.Button = Button;

const styles = StyleSheet.create({
    actionSheetContainer: {
        flex: 1,
        width:sr.w,
        padding: 10,
        paddingBottom: 6,
        justifyContent: 'flex-end',
    },
    buttonContainer: {
        borderRadius:6,
        overflow: 'hidden',
    },
    cancelButton: {
        marginTop:6,
        marginBottom:6,
        borderRadius:6,
        backgroundColor: '#A0D26F',
        borderBottomWidth: 0,
    },
    cancelText: {
        color:'#FFFFFF',
    },
});

```

* PDClient/project/App/modules/baidumap/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

import { MapView, MapTypes, Geolocation } from '@remobile/react-native-baidu-map';

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '货物所在地',
    },
    getInitialState () {
        return {
            mayType: MapTypes.NORMAL,
            zoom: 15,
            center: {
                longitude: 106.6886,
                latitude: 26.566621,
            },
            trafficEnabled: false,
            baiduHeatMapEnabled: false,
            marker: {
                longitude: 106.6886,
                latitude: 26.566621,
                title: '花果园',
                city:'贵阳市',
                province:'贵州省',
            },
        };
    },
    componentWillMount () {
        Geolocation.getCurrentPosition()
            .then(data => {
                console.warn(JSON.stringify(data));
                this.setState({
                    zoom: 15,
                    marker: {
                        latitude: data.latitude,
                        longitude: data.longitude,
                        title: data.address,
                        city:data.city,
                        province:data.province,
                    },
                    center: {
                        latitude: data.latitude,
                        longitude: data.longitude,
                        rand: Math.random(),
                    },
                });
            })
            .catch(e => {
                console.warn(e, 'error');
            });
    },
    render () {
        const { marker } = this.state;
        return (
            <View style={styles.container}>
                <View>
                    <Text style={styles.selectPositionText}>{marker.title}</Text>
                    <Button onPress={() => { this.props.confirm(marker); app.pop(); }} style={styles.btnConfirm} >
                        确认货物所在地
                    </Button>
                </View>
                <MapView
                    trafficEnabled={this.state.trafficEnabled}
                    baiduHeatMapEnabled={this.state.baiduHeatMapEnabled}
                    zoom={this.state.zoom}
                    mapType={this.state.mapType}
                    center={this.state.center}
                    marker={this.state.marker}
                    markers={this.state.markers}
                    style={styles.map}
                    onMarkerClick={(data) => {
                        console.warn('onMarkerClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.position.latitude, data.position.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.position.latitude,
                                        longitude: data.position.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                    onMapPoiClick={(data) => {
                        console.warn('onMapPoiClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                    onMapClick={(data) => {
                        console.warn('onMapClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}

                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'flex-start',
        alignItems: 'center',
        backgroundColor: '#F5FCFF',
    },
    map: {
        width: sr.w,
        height: sr.th * 0.78,
        marginBottom: 50,
        marginTop:10,
        backgroundColor: 'red',
    },
    selectPositionText :{
        paddingVertical:12,
        alignSelf:'center',
        fontSize:16,
    },
    btnConfirm:{
        height:35,
        width:200,
        borderRadius:2,
    },
});

```

* PDClient/project/App/modules/baidumap/test.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Button,
} = ReactNative;

import { MapView, MapTypes, Geolocation } from '@remobile/react-native-baidu-map';

const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    componentWillMount () {
        SplashScreen.hide();
    },
    getInitialState () {
        return {
            mayType: MapTypes.NORMAL,
            zoom: 15,
            center: {
                longitude: 113.981718,
                latitude: 22.542449,
            },
            trafficEnabled: false,
            baiduHeatMapEnabled: false,
            markers: [{
                longitude: 113.981718,
                latitude: 22.542449,
                title: 'Window of the world',
            }, {
                longitude: 113.995516,
                latitude: 22.537642,
                title: '',
            }],
        };
    },
    render () {
        return (
            <View style={styles.container}>
                <MapView
                    trafficEnabled={this.state.trafficEnabled}
                    baiduHeatMapEnabled={this.state.baiduHeatMapEnabled}
                    zoom={this.state.zoom}
                    mapType={this.state.mapType}
                    center={this.state.center}
                    marker={this.state.marker}
                    markers={this.state.markers}
                    style={styles.map}
                    onMarkerClick={(e) => {
                        console.warn(JSON.stringify(e));
                    }}
                    onMapPoiClick={(e) => {
                        console.warn('onMapPoiClick', JSON.stringify(e));
                        this.setState({
                            zoom: 15,
                            marker: {
                                latitude: e.latitude,
                                longitude: e.longitude,
                                title: e.name,
                            },
                        });
                    }}
                    onMapClick={(data) => {
                        console.warn(JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}

                    />
                <View style={styles.row}>
                    <Button title='Normal' onPress={() => {
                        this.setState({
                            mapType: MapTypes.NORMAL,
                        });
                    }}
                        />
                    <Button style={styles.btn} title='Satellite' onPress={() => {
                        this.setState({
                            mapType: MapTypes.SATELLITE,
                        });
                    }}
                        />

                    <Button style={styles.btn} title='Locate' onPress={() => {
                        console.warn('center', this.state.center);
                        Geolocation.getCurrentPosition()
                            .then(data => {
                                console.warn(JSON.stringify(data));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: 'Your location',
                                    },
                                    center: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        rand: Math.random(),
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                        />
                </View>

                <View style={styles.row}>
                    <Button title='Zoom+' onPress={() => {
                        this.setState({
                            zoom: this.state.zoom + 1,
                        });
                    }}
                        />
                    <Button title='Zoom-' onPress={() => {
                        if (this.state.zoom > 0) {
                            this.setState({
                                zoom: this.state.zoom - 1,
                            });
                        }
                    }}
                        />
                </View>

                <View style={styles.row}>
                    <Button title='Traffic' onPress={() => {
                        this.setState({
                            trafficEnabled: !this.state.trafficEnabled,
                        });
                    }}
                        />

                    <Button title='Baidu HeatMap' onPress={() => {
                        this.setState({
                            baiduHeatMapEnabled: !this.state.baiduHeatMapEnabled,
                        });
                    }}
                        />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'flex-start',
        alignItems: 'center',
        backgroundColor: '#F5FCFF',
    },
    row: {
        flexDirection: 'row',
        height: 40,
    },
    map: {
        width: sr.w,
        height: sr.h / 2,
        marginBottom: 50,
        backgroundColor: 'red',
    },
    closeTouchableHighlight: {
        position:'absolute',
        top:0,
        left:sr.w * 6 / 7 + 3,
        width: 38,
        height: 38,
        marginTop: (sr.h - 200 - 20) / 2,
    },
    closeIcon: {
        width: 38,
        height: 38,
    },
});

```

* PDClient/project/App/modules/common/CellPhoneBox.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    Linking,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    openPhone () {
        app.closeModal();
        Linking.canOpenURL('tel:' + this.props.phoneNum).then(supported => {
            if (!supported) {
                console.log('Can\'t handle url: ' + this.props.phoneNum);
            } else {
                return Linking.openURL('tel:' + this.props.phoneNum);
            }
        }).catch(err => console.error('An error occurred', err));
    },
    render () {
        return (
            <View style={styles.overlayContainer}>
                <TouchableOpacity
                    activeOpacity={1}
                    style={styles.container}>
                    <View style={styles.topView}>
                        <Text style={styles.titleText}>
                            {'拨打电话'}
                        </Text>
                    </View>
                    <TouchableOpacity
                        onPress={this.openPhone}
                        style={styles.btnView}>
                        <Text style={styles.phoneText}>
                            {this.props.phoneNum}
                        </Text>
                    </TouchableOpacity>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        height: 114,
        width: sr.w - 50,
        borderRadius: 4,
        backgroundColor: '#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    overlayContainer: {
        position:'absolute',
        top: 0,
        alignItems:'center',
        justifyContent: 'center',
        width:sr.w,
        height:sr.h,
    },
    titleText: {
        fontSize: 24,
        color: '#444444',
        backgroundColor: 'transparent',
    },
    topView: {
        height: 47,
        width: sr.w - 50,
        alignItems:'center',
        justifyContent:'center',
    },
    btnView: {
        height: 57,
        width: sr.w - 50,
        alignItems:'center',
        justifyContent:'center',
    },
    phoneText: {
        fontSize: 18,
        color: '#666666',
        backgroundColor: 'transparent',
    },
});

```

* PDClient/project/App/modules/common/ConfirmMerge.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const { Button, SelectStartPointAddress } = COMPONENTS;

module.exports = React.createClass({
    getInitialState () {
        return {
            groupName: '',
            startInfo: {},
            isShowAddress:false,
        };
    },
    doConfirm () {
        const { groupName, startInfo } = this.state;
        if (groupName == '') {
            Toast('请输入群组名');
            return;
        }
        if (!startInfo.startPoint) {
            Toast('请确定选择始发地');
            return;
        }
        app.closeModal();
        this.props.doConfirm({ groupName, ...startInfo });
    },
    render () {
        const { isShowAddress, startInfo } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.textTop}>合并信息</Text>
                    <TouchableOpacity onPress={app.closeModal}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_close}
                            style={styles.closeStyle} />
                    </TouchableOpacity>
                </View>
                <View style={styles.containerItem}>
                    <Text style={styles.textLeft}>群组名称</Text>
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请输入群组名'
                        maxLength={10}
                        onChangeText={(text) => this.setState({ groupName: text })}
                        defaultValue={this.state.groupName}
                        style={styles.text_input}
                        />
                </View>
                <View style={styles.containerItem}>
                    <Text style={styles.textLeft}>始发地</Text>
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={() => { this.setState({ isShowAddress:true }); }}
                        style={styles.rightView}>
                        <Text style={styles.textRight}>{startInfo && (startInfo.startPoint || '') || '选择地址'}</Text>
                        <Image source={app.img.common_go} style={styles.goStyle} />
                    </TouchableOpacity>
                </View>
                {isShowAddress && <SelectStartPointAddress style={styles.SelectAddress} confirmAddress={(obj) => { this.setState({ startInfo:obj, isShowAddress:false }); }} />}
                <Button onPress={this.doConfirm} style={styles.btnCheck} textStyle={styles.btnCheckText} >
                    确认合并
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        backgroundColor:'#ffffff',
    },
    SelectAddress:{
        height:200,
    },
    containerTop:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textTop:{
        fontSize:17,
        marginLeft:(sr.w - 17 * 4) / 2,
        color:'#333333',
    },
    closeStyle:{
        height:30,
        width:30,
    },
    containerItem:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLeft:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    textRight:{
        fontSize:14,
        color:'#888888',
        marginRight:10,
    },
    text_input: {
        height:40,
        width: 200,
        padding:0,
        fontSize:14,
        alignSelf: 'center',
        textAlign:'right',
    },
    rightView:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 10,
    },
    btnCheck:{
        marginTop:23,
        height:50,
        width:sr.w,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnCheckText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'600',
    },
});

```

* PDClient/project/App/modules/common/ConfirmSendDoorAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const { Button, SelectShortAddress } = COMPONENTS;

module.exports = React.createClass({
    getInitialState () {
        return {
            transportFee: '',
            sendDoorEndPoint: '',
            sendDoorLastCode: '',
            sendDoorAddress:'',
            isShowAddress:false,
        };
    },
    doCancel(){
        app.closeModal();
    },
    doConfirm () {
        const { sendDoorEndPoint, sendDoorAddress, transportFee } = this.state;
        const param = {
            userId:app.personal.info.userId,
            orderId:this.props.orderId,
            isTransport:true,
            endPoint:sendDoorEndPoint + sendDoorAddress,
            transportFee,
            isScan:false,
        };
        POST(app.route.ROUTE_SET_CLIENT_PICK_ORDER_TRANSPORT_FEE,param,this.doConfirmSuccess,false);
    },
    doConfirmSuccess(data){
        if (data.success) {
            Toast('设置成功');
            app.closeModal();
            app.pop();
        }else{
            Toast(data.msg);
            app.closeModal();
        }
    },
    render () {
        const { isShowAddress, sendDoorEndPoint, sendDoorEndPointLastCode } = this.state;
        return (
            <View style={styles.container}>
                    <View style={styles.containerItem}>
                        <Text style={styles.textLeft}>送货上门金额</Text>
                        <TextInput
                            underlineColorAndroid='transparent'
                            placeholder='请输入商议金额'
                            maxLength={10}
                            onChangeText={(text) => this.setState({ transportFee: text })}
                            defaultValue={this.state.sendDoorPrice}
                            style={styles.text_input}
                            />
                    </View>
                <View style={styles.containerItem}>
                    <Text style={styles.textLeft}>送货上门</Text>
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={() => { this.setState({ isShowAddress:true }); }}
                        style={styles.rightView}>
                        <Text style={styles.textRight}>{sendDoorEndPoint && (sendDoorEndPoint || '') || '选择地址'}</Text>
                        <Image source={app.img.common_go} style={styles.goStyle} />
                    </TouchableOpacity>
                </View>
                {isShowAddress && <SelectShortAddress style={styles.SelectAddress}
                parentCode = {520101}
                endPointLastCode = {sendDoorEndPointLastCode}
                confirmAddress={(sendDoorEndPoint, sendDoorEndPointLastCode) => { this.setState({ sendDoorEndPoint, sendDoorEndPointLastCode, isShowAddress:false }); }} />}
                {
                    !sendDoorEndPoint == '' && <View style={styles.containerItem}>
                        <Text style={styles.textLeft}>详细地址</Text>
                        <TextInput
                            underlineColorAndroid='transparent'
                            placeholder='请输入详细地址'
                            onChangeText={(text) => this.setState({ sendDoorAddress: text })}
                            defaultValue={this.state.sendDoorAddress}
                            style={styles.text_input}
                            />
                    </View>
                }
                <View style={{flexDirection:'row'}}>
                    <Button onPress={this.doConfirm} style={styles.btnCheck} textStyle={styles.btnCheckText} >
                        确认
                    </Button>
                    <Button onPress={this.doCancel} style={styles.btnCancel} textStyle={styles.btnCheckText} >
                        取消
                    </Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        backgroundColor:'#ffffff',
    },
    SelectAddress:{
        height:150,
    },
    containerTop:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textTop:{
        fontSize:17,
        marginLeft:(sr.w - 17 * 4) / 2,
        color:'#333333',
    },
    closeStyle:{
        height:30,
        width:30,
    },
    containerItem:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLeft:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
        flex:1,
    },
    textRight:{
        fontSize:14,
        color:'#888888',
        marginRight:10,
    },
    text_input: {
        flex:1,
        height:40,
        padding:0,
        fontSize:14,
        alignSelf: 'center',
        textAlign:'right',
        marginRight:10,
    },
    rightView:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 10,
    },
    btnCheck:{
        marginTop:23,
        height:50,
        width:sr.w/2,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnCancel:{
        marginTop:23,
        height:50,
        width:sr.w/2,
        borderRadius:0,
        backgroundColor:'#F79835',
    },
    btnCheckText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'600',
    },
});

```

* PDClient/project/App/modules/common/DigitalKeyboard.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
    },
    getInitialState () {
        return {
        };
    },
    render () {
        const { list } = this.props;
        return (
            <View style={styles.container}>
                {
                    list.map((item, i) => {
                        return (
                            <TouchableOpacity
                                onPress={this.props.passwordItem.bind(null, item)}
                                key={i} style={styles.itemLine}>
                                <Text style={styles.item}>{ item }</Text>
                            </TouchableOpacity>
                        );
                    })
                }
                <TouchableOpacity onPress={this.props.confirm} style={styles.itemImage}>
                    <Text style={styles.item}>确认</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.zero} style={styles.itemLine}>
                    <Text style={styles.item} >0</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.delete} style={styles.itemImage}>
                    <Image style={styles.delete}
                        source={app.img.personal_delete} />
                </TouchableOpacity>
            </View>
        );
    },
});
const styles = StyleSheet.create({
    container:{
        width:sr.w,
        backgroundColor:'#f4f4f4',
        flexDirection:'row',
        flexWrap:'wrap', // 换行
    },
    item:{
        fontSize:18,
        fontWeight:'600',
    },
    itemLine:{
        width:sr.w / 3,
        height:44,
        borderLeftWidth:1,
        borderBottomWidth:1,
        borderColor:'#f1f1f1',
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        alignItems:'center',
    },
    itemGray:{
        height:45,
        width:sr.w / 3,
        backgroundColor:'#dddddd',
    },
    itemImage:{
        height:45,
        width:sr.w / 3,
        backgroundColor:'#dddddd',
        justifyContent:'center',
        alignItems:'center',
    },
    delete:{
        height:15,
        width:25,
    },
});

```

* PDClient/project/App/modules/common/ImageCrop.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    ImageStore,
    ImageEditor,
} = ReactNative;

const ImageCrop = require('@remobile/react-native-image-crop');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '编辑图片',
        rightButton: { title: '完成', handler: () => {
            app.scene.cropImage();
        } },
    },
    goBack () {
        app.pop();
    },
    cropImage () {
        const { image } = this.props;
        const cropData = this.imageCrop.getCropData();
        ImageEditor.cropImage(
            image.uri,
            cropData,
            (croppedImageURI) => {
                this.uploadImage(croppedImageURI);
            },
            (error) => {
                Toast('文件出错');
                this.goBack();
            }
        );
    },
    uploadImage (filePath) {
        if (app.isandroid) {
            const options = {};
            options.fileKey = 'file';
            options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
            options.mimeType = 'image/png';
            options.params = {
                userId:app.personal.info.userId,
            };
            UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
        } else {
            ImageStore.getBase64ForTag(filePath, (data) => {
                data = 'data:image/png;base64,' + data;
                const options = {};
                options.fileKey = 'file';
                options.fileName = 'image.png';
                options.mimeType = 'image/png';
                options.params = {
                    userId:app.personal.info.userId,
                };
                ImageStore.removeImageForTag(filePath);
                UPLOAD(data, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
            }, () => {
                Toast('文件出错');
                this.goBack();
            });
        }
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            this.props.onCropImage(data.context.url);
            this.goBack();
        } else {
            Toast('上传头像失败');
            this.goBack();
        }
    },
    uploadErrorCallback () {
        Toast('上传头像失败');
        this.goBack();
    },
    render () {
        const { image } = this.props;
        return (
            <View style={styles.container}>
                <ImageCrop
                    imageWidth={image.width}
                    imageHeight={image.height}
                    editRectRadius={0}
                    ref={(ref) => { this.imageCrop = ref; }}
                    source={{ uri: image.uri }} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
});

```

* PDClient/project/App/modules/common/ImagePicker.js

```js
const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
} = ReactNative;

const CameraRollPicker = require('@remobile/react-native-camera-roll-picker');
const Camera = require('@remobile/react-native-camera');
const ImageCrop = require('./ImageCrop');

module.exports = React.createClass({
    statics: {
        title: '选择头像',
    },
    cropImage (image) {
        app.navigator.replace({
            component: ImageCrop,
            passProps: {
                image,
                onCropImage: this.props.onCropImage,
            },
        });
    },
    onSelectedImages (images, image) {
        this.cropImage(image);
    },
    openCamera () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.cropImage({
                    uri,
                    width,
                    height,
                });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    render () {
        return (
            <CameraRollPicker selected={[]} onSelectedImages={this.onSelectedImages} openCamera={this.openCamera} maximum={1} />
        );
    },
});

```

* PDClient/project/App/modules/common/LogisticsDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '物流详情',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list: [],
        };
    },
    componentWillMount () {
        const param = {
            userId: app.personal.info.userId,
            orderId: this.props.obj.id,
        };
        POST(app.route.ROUTE_GET_LOGISTICS_LIST, param, this.doReceiveSuccess, true);
    },
    doReceiveSuccess (data) {
        if (data.success) {
            this.setState({
                list : data.logisticsList,
            });
        } else {
            Toast(data.msg);
        }
    },
    toPayMode (payMode) {
        if (payMode == 0) {
            return '现付';
        } else if (payMode == 1) {
            return '到付';
        } else {
            return '混合付款';
        }
    },
    renderRow (obj, sectionID, rowID) {
        return (
            <View style={styles.containerItem} >
                <Image style={styles.imagePoint}
                    resizeMode='stretch'
                    source={rowID == 0 ? app.img.order_point_green : app.img.order_point}
                    />
                <View style={styles.containerRight}>
                    <View style={styles.address}>
                        <Text style={rowID == 0 ? styles.addressRightGreen : styles.addressRight}>{obj.address}</Text>
                    </View>
                    <Text style={rowID == 0 ? styles.textItemGreen : styles.textItem}>{obj.locateTime}</Text>
                </View>
            </View>
        );
    },
    render () {
        const { obj, type } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.logisticsState}>
                    <Image style={styles.imageGoods}
                        defaultSource={app.img.common_default}
                        source={{ uri:obj.photo }}
                        resizeMode='stretch'
                        />
                    <View style={styles.containerInfo}>
                        <View style={styles.infoTop}>
                            <Text style={styles.topLeft}>物流状态</Text>
                            <Text style={styles.topRight}>{type == 'agent' ? obj.stateList ? OS.MAP[obj.stateList[0].state] : '' : obj.stateList ? OS.MAP[obj.stateList[0].state] : ''}</Text>
                        </View>
                        <View style={styles.roadmapInfo}>
                            <Text style={styles.textGetState} numberOfLines={1}>路线：{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                            <Text style={styles.textGetState} numberOfLines={1}>->{obj.endPoint}</Text>
                        </View>
                        <Text style={styles.textGetState}>付款方式:{this.toPayMode(obj.payMode)}</Text>
                        <Text style={styles.textGetState}>是否送货上门:{obj.isSendDoor ? '是' : '否'}</Text>
                    </View>
                </View>
                <View style={styles.addressInfo}>
                    <ListView
                        dataSource={this.ds.cloneWithRows(this.state.list)}
                        enableEmptySections
                        renderRow={this.renderRow} />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    logisticsState:{
        height:85,
        backgroundColor:'#ffffff',
        marginTop:10,
        flexDirection: 'row',
    },
    imageGoods:{
        height:65,
        width:65,
        marginTop:10,
        marginLeft:10,
    },
    containerInfo:{
        marginLeft:15,
        flex:1,
        marginBottom:5,
        marginTop:5,
    },
    infoTop:{
        flexDirection: 'row',
        flex:1,
    },
    topLeft:{
        fontSize:14,
        color:'#333333',
    },
    topRight:{
        marginLeft:15,
        fontSize:14,
        color:'#33a645',
    },
    textGetState:{
        fontSize:12,
        color:'#888888',
        flex:1,
    },
    addressInfo:{
        height:sr.h - 167,
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingTop:32,
    },
    containerItem:{
        height:75,
        flexDirection: 'row',
    },
    imagePoint:{
        height:75,
        width:8,
        marginLeft:30,
    },
    containerRight:{
        height:75,
        marginLeft:21,
    },
    address:{
        flexDirection: 'row',
        marginBottom:2,
    },
    addressLeft:{
        color:'#333333',
        fontSize:14,
    },
    addressLeftGreen:{
        fontSize:14,
        color:'#82c186',
    },
    addressRight:{
        color:'#888888',
        fontSize:12,
    },
    addressRightGreen:{
        color:'#82c186',
        fontSize:12,
    },
    textItem:{
        color:'#888888',
        fontSize:12,
        marginTop:2,
    },
    textItemGreen:{
        color:'#82c186',
        fontSize:12,
        marginTop:2,
    },
    roadmapInfo:{
        flexDirection:'row',
        flex:1,
    },
});

```

* PDClient/project/App/modules/common/PayInfo.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '支付信息',
        rightButton: { title: '关闭', handler: () => { app.scene.toClose(); } },
    },
    toClose () {
        app.pop();
    },
    render () {
        const { data, type, money, orderCount } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.textTop}>支付信息</Text>
                    <TouchableOpacity onPress={this.props.doClose}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_close}
                            style={styles.closeStyle} />
                    </TouchableOpacity>
                </View>
                <View style={styles.containerItem}>
                    <Text style={styles.textLeft}>订单信息</Text>
                    <Text style={styles.textRight}>{type == 'all' ? orderCount + '单' : data.id}</Text>
                </View>
                <TouchableOpacity>
                    <View style={styles.containerItem}>
                        <Text style={styles.textLeft}>支付选择</Text>
                        <View style={styles.rightView} >
                            <Text style={styles.textRightCash}>余额</Text>
                            <Image
                                source={app.img.common_go}
                                style={styles.goStyle} />
                        </View>
                    </View>
                </TouchableOpacity>
                <View style={styles.containerItem}>
                    <Text style={styles.textLeft}>运费</Text>
                    <Text style={styles.textRightFee}>
                        ¥
                        {
                            type == 'receive' ?
                            app.utils.N(data.totalDesignatedFee + data.proxyCharge)
                            :
                            type == 'send' ?
                            app.utils.N(data.needPayTransportFee + data.needPayInsuanceFee)
                            :
                            type == 'all' ?
                            money
                            :
                            app.utils.N(data.carryPrice * data.totalWeight)
                        }
                    </Text>
                </View>
                <Button onPress={this.props.doConfirmPay} style={styles.btnCheck} textStyle={styles.btnCheckText} >
                    确认支付
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#ffffff',
    },
    containerTop:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textTop:{
        fontSize:17,
        marginLeft:(sr.w - 17 * 4) / 2,
        color:'#333333',
    },
    closeStyle:{
        height:30,
        width:30,
    },
    containerItem:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLeft:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    textRight:{
        fontSize:14,
        color:'#888888',
        marginRight:10,
    },
    textRightFee:{
        color:'red',
        fontWeight:'500',
        fontSize:14,
        marginRight:10,
    },
    textRightCash:{
        fontSize:14,
        marginRight:6,
        color:'#3d3e40',
    },
    rightView:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 10,
    },
    btnCheck:{
        marginTop:23,
        height:50,
        width:sr.w,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnCheckText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'600',
    },
});

```

* PDClient/project/App/modules/common/PayInfoModel.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    doConfirmPay () {
        app.closeModal();
        this.props.doConfirmPay();
    },
    render () {
        const { data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.textTop}>支付信息</Text>
                    <TouchableOpacity onPress={app.closeModal}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_close}
                            style={styles.closeStyle} />
                    </TouchableOpacity>
                </View>
                <View style={styles.containerItem}>
                    <Text style={styles.textLeft}>订单信息</Text>
                    <Text style={styles.textRight}>{data.id}</Text>
                </View>
                <TouchableOpacity>
                    <View style={styles.containerItem}>
                        <Text style={styles.textLeft}>支付选择</Text>
                        <View style={styles.rightView} >
                            <Text style={styles.textRightCash}>余额</Text>
                            <Image
                                source={app.img.common_go}
                                style={styles.goStyle} />
                        </View>
                    </View>
                </TouchableOpacity>
                <View style={styles.containerItem}>
                    <Text style={styles.textLeft}>运费</Text>
                    <Text style={styles.textRightFee}>¥{app.utils.N(data.carryPrice * data.totalWeight) }</Text>
                </View>
                <Button onPress={this.doConfirmPay} style={styles.btnCheck} textStyle={styles.btnCheckText} >
                        确认支付
                    </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        height:230,
        top:sr.h - 448,
        backgroundColor:'#ffffff',
    },
    containerTop:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textTop:{
        fontSize:17,
        marginLeft:(sr.w - 17 * 4) / 2,
        color:'#333333',
    },
    closeStyle:{
        height:30,
        width:30,
    },
    containerItem:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLeft:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
        flex:1,
    },
    textRight:{
        fontSize:14,
        color:'#888888',
        marginRight:10,
    },
    textRightFee:{
        color:'red',
        fontWeight:'500',
        fontSize:14,
        marginRight:10,
        textAlign:'right',
        flex:1,
    },
    textRightCash:{
        fontSize:14,
        marginRight:6,
        color:'#3d3e40',
    },
    rightView:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 10,
    },
    btnCheck:{
        marginTop:23,
        height:50,
        width:sr.w,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnCheckText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'600',
    },
});

```

* PDClient/project/App/modules/common/PayPassword.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { MessageBox } = COMPONENTS;
const DigitalKeyboard = require('./DigitalKeyboard');
const VerificationCode = require('../person/VerificationCode');

const list = [ 1, 2, 3, 4, 5, 6, 7, 8, 9 ];

module.exports = React.createClass({
    statics: {
        title: '支付密码',

    },
    getInitialState () {
        return {
            password: '',
            type:false,
        };
    },
    passwordItem (item) {
        const { password } = this.state;
        this.setState({ password: password + item });
    },
    zero () {
        const { password } = this.state;
        this.setState({ password: password + 0 });
    },
    delete () {
        const { password } = this.state;
        this.setState({
            password: _.dropRight(password).join(''),
        });
    },
    confirm () {
        const { password, type } = this.state;
        const tmp = password.substring(0, 6);
        if (tmp.length == 6) {
            this.setState({
                type : !type,
            });
            this.toPay(tmp);
        } else {
            Toast('支付密码有误');
            this.toClear(tmp);
        }
    },
    toPay (tmp) {
        let { param, routeName } = this.props;
        param['payPassword'] = tmp;
        POST(routeName, param, this.toPaySuccess, true);
    },
    toPaySuccess (data) {
        const { prompt, amount, doCloseActionSheet, money, alreadyPaid, refresh, setRemainAmount } = this.props;
        if (data.success) {
            app.showModal(
                <MessageBox
                    onConfirm={this.doConfirmDelete}
                    content={prompt}
                    width={sr.s(250)} />
            );
            !!doCloseActionSheet && doCloseActionSheet();
            !!amount && app.personal.setRemainAmount((app.personal.remainAmount * 1) + (amount * 1));
            !!money && app.personal.setRemainAmount((app.personal.remainAmount * 1) - (money * 1));
            !!setRemainAmount && setRemainAmount((app.personal.remainAmount * 1) - (money * 1));
            !!alreadyPaid && alreadyPaid();
            !!refresh && refresh();
            app.navigator.popToTop();
            return;
        } else {
            Toast(data.msg);
            !!doCloseActionSheet && doCloseActionSheet();
            app.pop();
        }
    },
    toClear (tmp) {
        this.setState({
            password: '',
            tmp: '',
        });
    },
    componentWillMount () {
        this.toSetPaypassword();
    },
    toSetPaypassword () {
        if (app.personal.info.isSetPaymentPassword == 0) {
            Toast('请先设置支付密码');
            app.push({
                component:VerificationCode,
            });
        }
    },
    render () {
        const max = [1, 2, 3, 4, 5, 6];
        const { password, type } = this.state;
        return (
            <View style={styles.container}>
                <Text style={styles.text}>请输入支付密码</Text>
                <View style={styles.password}>
                    {
                        max.map((item, i) => (
                            <View style={i == 0 ? styles.itemStart : styles.item} key={i}>
                                { password.length >= (i + 1) ?
                                    <View style={styles.point} />
                                    :
                                    <View style={styles.noPoint} />
                                }
                            </View>
                        ))
                    }
                </View>
                <View style={styles.digitalKeyboard} />
                {
                    !type &&
                    <View>
                        <DigitalKeyboard
                            list={list}
                            passwordItem={this.passwordItem}
                            zero={this.zero} delete={this.delete}
                            confirm={this.confirm}
                            />
                    </View>
                }
            </View>
        );
    },
});
const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },

    text:{
        fontSize:14,
        textAlign:'center',
        color:'#333333',
        marginTop:30,
    },
    password:{
        height:40,
        width:330,
        backgroundColor:'#ffffff',
        flexDirection:'row',
        marginTop:15,
        marginLeft:(sr.w - 330) / 2,
        borderWidth:1,
        borderColor:'#EDEDED',
        borderRadius:4,
    },
    itemStart:{
        height:40,
        width:55,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    item:{
        height:40,
        width:55,
        borderLeftWidth:1,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    point:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#000000',
    },
    noPoint:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#FFFFFF',
    },
    digitalKeyboard:{
        flex:1,
    },
});

```

* PDClient/project/App/modules/common/Roadmap.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const { SelectRegionAddress, SelectShortAddress } = COMPONENTS;

const { Button } = COMPONENTS;

const ChangeType = {
    PRICE:0,
    PERCENT:1,
};

module.exports = React.createClass({
    statics: {
        title: '路线设置',
    },
    getInitialState () {
        const { obj } = this.props;
        var profit = '';
        if (obj) {
            if ((obj.profitCount == 0) && (obj.profitRate != 0)) {
                profit = obj.profitRate;
            } else if ((obj.profitCount != 0) && (obj.profitRate == 0)) {
                profit = obj.profitCount;
            } else {
                profit = '';
            }
        } else {
            profit = '';
        }
        return {
            price: profit,
            type: obj.type ? obj.type : '',
            change: (obj.profitCount == 0) && (obj.profitRate != 0) ? ChangeType.PERCENT : ChangeType.PRICE,
            endPointLastCode: obj.regionLastCode ? obj.regionLastCode : 0,
            endPoint: obj.region ? obj.region : 0,
        };
    },
    toChangePrice () {
        this.setState({
            change: ChangeType.PRICE,
            price: '',
        });
    },
    toChangePercent () {
        this.setState({
            change: ChangeType.PERCENT,
            price: '',
        });
    },
    selectAspect () {
        const { endPointLastCode } = this.state;
        const { type } = this.props;
        if (type == 2) {
            app.push({
                component: SelectShortAddress,
                title:'到货地',
                passProps:{
                    parentCode : app.personal.info.agent.addressRegionLastCode,
                    confirmAddress:(endPoint, endPointLastCode) => {
                        this.setState({ endPoint, endPointLastCode });
                    },
                },
            });
        }
        if (type == 1) {
            app.push({
                component: SelectRegionAddress,
                title:'到货地',
                passProps:{
                    type : 4,
                    confirmAddress:(endPoint, endPointLastCode) => {
                        this.setState({ endPoint, endPointLastCode });
                    },
                },
            });
        }
    },
    doConfirmChange () {
        const { change, price, endPoint, endPointLastCode } = this.state;
        const { type, isModify, obj } = this.props;
        var profit = 0;
        if (isModify) {
            const param = {
                userId: app.personal.info.userId,
                regionId: obj.id,
                region: endPoint,
                regionLastCode: endPointLastCode,
                profitRate: (change == 1 ? price : 0),
                profitCount: (change == 0 ? price : 0),
                type,
            };
            POST(app.route.ROUTE_MODIFY_REGION_PROFIT, param, this.addRegionProfitSuccess, false);
        } else {
            const param = {
                userId: app.personal.info.userId,
                region: endPoint,
                regionLastCode: endPointLastCode,
                profitRate: (change == 1 ? price : 0),
                profitCount: (change == 0 ? price : 0),
                type,
            };
            POST(app.route.ROUTE_ADD_REGION_PROFIT, param, this.addRegionProfitSuccess, false);
        }
    },
    addRegionProfitSuccess (data) {
        if (data.success) {
            Toast('设置成功');
            this.props.refreshList();
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { change, price, endPoint, endPointLastCode } = this.state;
        const { index, tabIndex, type } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                <TouchableOpacity onPress={this.selectAspect}
                    style={styles.aspect} >
                    <Text style={styles.aspectText}>方向</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{ type != 0 ? (endPoint == 0 ? '' : endPoint) : '全部' }</Text>
                        {
                            type != 0 &&
                            <Image
                                source={app.img.common_go}
                                style={styles.goStyle} />
                        }
                    </View>
                </TouchableOpacity>
                <View style={styles.priceChange}>
                    <TouchableOpacity onPress={this.toChangePrice}
                        style={[styles.itemChange, change == 0 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 0 ? { color:'#FFFFFF' } : {}]}>按价格调整</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.toChangePercent}
                        style={[styles.itemChange, change == 1 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 1 ? { color:'#FFFFFF' } : {}]}>按百分比调整</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.priceNumber}>
                    {
                        (change == 1 || change == 0) ?
                            <View onPress={this.toAdd} style={styles.priceAdd} >
                                <Image style={styles.chooseImage}
                                    source={app.img.order_choose} />
                                <Text style={styles.priceAddText} >上调</Text>
                            </View>
                        :
                            <View />
                    }
                    {
                        change == 0 ?
                            <View style={styles.priceInput}>
                                <TextInput
                                    onChangeText={(text) => this.setState({ price: text })}
                                    multiline={false}
                                    style={styles.bottomRight}
                                    placeholder={'请输入需要提高的价格'}
                                    autoCapitalize={'none'}
                                    underlineColorAndroid={'transparent'}
                                    defaultValue={price + ''}
                                />
                                <Text style={styles.bottomRightText}>元</Text>
                            </View>
                        :
                        change == 1 ?
                            <View style={styles.priceInput}>
                                <TextInput
                                    onChangeText={(text) => this.setState({ price: text })}
                                    multiline={false}
                                    style={styles.bottomRight}
                                    placeholder={'请输入需要提高的百分比'}
                                    autoCapitalize={'none'}
                                    underlineColorAndroid={'transparent'}
                                    defaultValue={price + ''}
                                />
                                <Text style={styles.bottomRightText}>%</Text>
                            </View>
                        :
                            <View />
                    }
                </View>
                <Button onPress={this.doConfirmChange}
                    style={styles.btnConfirmChange}
                    textStyle={styles.btnConfirmChangeText}>
                    确认
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    aspect:{
        marginTop:5,
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 42,
        width:sr.w,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    aspectText:{
        color: '#888888',
        fontSize: 14,
        marginLeft: 10,
    },
    rightView: {
        flexDirection: 'row',
        height: 45,
        alignItems:'center',
    },
    itemValueText: {
        color: '#888888',
        fontSize: 14,
        marginRight: 10,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 10,
    },
    priceChange:{
        height:45,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'space-around',
        marginTop:2,
    },
    itemChange:{
        height:20,
        width:100,
        backgroundColor:'#f3f3f3',
    },
    changeText:{
        fontSize:12,
        color:'#333333',
        textAlign:'center',
        height:20,
        lineHeight:18,
    },
    priceNumber:{
        height:40,
        backgroundColor:'#FFFFFF',
        marginTop:2,
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    bottomLeft:{
        flexDirection: 'row',
        alignItems:'center',
        height:40,
    },
    priceAdd:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:10,
    },
    chooseImage:{
        height:9,
        width:9,
    },
    priceAddText:{
        fontSize:14,
        color:'#333333',
        marginLeft:5,
    },
    priceSub:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:20,
    },
    priceInput:{
        flexDirection: 'row',
        alignItems:'center',
    },
    bottomRight:{
        height:40,
        width:sr.w / 2,
        fontSize:12,
        color: '#444444',
        textAlign:'right',
    },
    bottomRightText:{
        fontSize:13,
        color:'#333333',
        marginRight:15,
        marginLeft:3,
    },
    btnConfirmChange:{
        height:40,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        marginTop:250,
        borderRadius:4,
    },
    btnConfirmChangeText:{
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/common/ScanBarCode.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

import BarcodeScanner from 'react-native-camera';
const { Button } = COMPONENTS;

module.exports = React.createClass({
    onBarCodeRead (code) {
        if (!this.hasReadCode) {
            app.closeModal();
            this.hasReadCode = true;
            this.props.onBarCodeRead(app.utils.getQRResult(code.data));
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <BarcodeScanner
                    onBarCodeRead={this.onBarCodeRead}
                    style={styles.camera}>
                    <View style={styles.rectangleContainer}>
                        <View style={styles.rectangleTop} />
                        <View style={styles.rectangleMiddle}>
                            <View style={styles.rectangleLeft} />
                            <View style={styles.rectangleMiddleMiddle}>
                                <View style={[styles.makeup, styles.makeupTL]} />
                                <View style={[styles.makeup, styles.makeupTR]} />
                                <View style={[styles.makeup, styles.makeupDL]} />
                                <View style={[styles.makeup, styles.makeupDR]} />
                            </View>
                            <View style={styles.rectangleRight} />
                        </View>
                        <View style={styles.rectangleBottom}>
                            <Text style={styles.info}>
                                将二维码放入框内，即可自动扫描
                            </Text>
                        </View>
                    </View>
                </BarcodeScanner>
                <Button
                    onPress={app.closeModal}
                    style={styles.contentButton}
                    textStyle={styles.contentButtonText}>
                        关闭</Button>
            </View>
        );
    },
});
const OVERLAY = 'rgba(0, 0, 0, 0.2)';
const BORDER = 2;
const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    camera: {
        flex: 1,
        width: sr.w,
    },
    rectangleContainer: {
        flex: 1,
    },
    rectangleTop: {
        flex: 1,
        backgroundColor: OVERLAY,
    },
    rectangleMiddle: {
        height: 250,
        flexDirection: 'row',
    },
    rectangleBottom: {
        flex: 1,
        backgroundColor: OVERLAY,
        alignItems: 'center',
    },
    rectangleLeft: {
        flex:1,
        backgroundColor: OVERLAY,
    },
    rectangleMiddleMiddle: {
        width:250,
    },
    rectangleRight: {
        flex:1,
        backgroundColor: OVERLAY,
    },
    makeup: {
        width: 16,
        height: 16,
        position: 'absolute',
        borderColor: '#00FF00',
    },
    makeupTL: {
        top: 0,
        left: 0,
        borderTopWidth: BORDER,
        borderLeftWidth: BORDER,
    },
    makeupTR: {
        top: 0,
        right: 0,
        borderTopWidth: BORDER,
        borderRightWidth: BORDER,
    },
    makeupDL: {
        bottom: 0,
        left: 0,
        borderBottomWidth: BORDER,
        borderLeftWidth: BORDER,
    },
    makeupDR: {
        bottom: 0,
        right: 0,
        borderBottomWidth: BORDER,
        borderRightWidth: BORDER,
    },
    info: {
        marginTop: 30,
        fontSize: 15,
        color: '#646566',
    },
    contentButton: {
        width:sr.w,
        height:50,
        borderRadius:0,
    },
    contentButtonText: {
        color: 'white',
        fontWeight: '800',
    },
});

```

* PDClient/project/App/modules/common/SelectClient.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入关键字搜索用户'
                    defaultValue={searchText}
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
        rightButton: { title: '搜索', handler: () => { app.scene.refresh(); } },
    },
    getInitialState () {
        return {
            keyword: '',
        };
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    onRowSelect (obj) {
        this.props.onSelect(obj);
        app.pop();
    },
    renderRow (obj, sectionID, rowID) {
        const { userId } = this.props;
        const { name, head, email, address, phone, reservePhone } = obj;
        return (
            <TouchableOpacity style={styles.row} onPress={this.onRowSelect.bind(null, obj)}>
                <View style={styles.leftContainer}>
                    <View style={styles.nameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={head ? { uri: head } : app.img.personal_default_head}
                            style={styles.head} />
                        <Text style={styles.name}>{name ? `${name} ( ${phone} )` : phone }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>邮箱：</Text>
                        <Text style={styles.name}>{ email || '无' }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>住址：</Text>
                        <Text style={styles.name}>{ address || '无' }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>预留电话：</Text>
                        <Text style={styles.name}>{ reservePhone ? reservePhone.join('; ') : '无' }</Text>
                    </View>
                </View>
                {
                    obj.userId === userId &&
                    <Image resizeMode='stretch' source={app.img.common_radio} style={styles.icon} />
                }
            </TouchableOpacity>
        );
    },
    render () {
        const { keyword } = this.state;
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, keyword }}
                    listName={'clientList'}
                    listUrl={app.route.ROUTE_GET_CLIENT_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    searchContainer: {
        height: 30,
        width: 250,
        paddingVertical: 2,
        borderRadius: 105,
        backgroundColor: '#E5E5E5',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        height: 25,
        width: 220,
        fontSize: 14,
        marginLeft: 5,
        overflow: 'hidden',
        alignItems:'center',
    },
    iconSearch: {
        height: 20,
        width: 20,
    },
    row: {
        paddingHorizontal: 8,
        paddingVertical: 10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    leftContainer: {
        flex: 1,
    },
    nameContainer: {
        marginTop: 10,
        flexDirection: 'row',
        paddingHorizontal: 10,
        alignItems: 'center',
    },
    head: {
        width: 30,
        height: 30,
        borderRadius: 15,
        marginRight: 5,
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    label: {
        fontSize: 14,
        color: '#8B8B7A',
        marginLeft: 34,
    },
    icon: {
        width: 20,
        height: 16,
    },
});

```

* PDClient/project/App/modules/common/SelectRoadmap.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入关键字搜索路线'
                    defaultValue={searchText}
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
        rightButton: { title: '搜索', handler: () => { app.scene.refresh(); } },
    },
    getInitialState () {
        return {
            keyword: '',
        };
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    onRowSelect (obj) {
        this.props.onSelect(obj);
        app.pop();
    },
    renderRow (obj, sectionID, rowID) {
        const { roadmapId } = this.props;
        const { name, type, shipperName, shipperLogo, startPoint, endPoint, transitPoint, price, duration } = obj;
        return (
            <TouchableOpacity style={styles.row} onPress={this.onRowSelect.bind(null, obj)}>
                <View style={styles.leftContainer}>
                    <View style={styles.shipperNameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={{ uri: shipperLogo }}
                            style={styles.shipperLogo} />
                        <Text numberOfLines={1} style={styles.shipperName}>{shipperName}</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text numberOfLines={1} style={styles.name}>{name}</Text>
                        <Text numberOfLines={1} style={[styles.type, { color: type === 0 ? '#228B22' : '#FF4500' }]}>{type === 0 ? '整车' : '零担'}</Text>
                    </View>
                    <View style={styles.pointContainer}>
                        <Text style={styles.name}>{startPoint.name}</Text>
                        {!!transitPoint[0] && <Text style={styles.name}>→</Text>}
                        {!!transitPoint[0] && <Text style={styles.name}>{transitPoint[0].name}</Text>}
                        <Text style={styles.name}>→</Text>
                        <Text style={styles.name}>{endPoint.name}</Text>
                    </View>
                    <View style={styles.priceContainer}>
                        <Text style={styles.name}><Text style={{ color: '#DAA520' }}>{price}</Text>元/{type === 0 ? '车' : '吨'}</Text>
                        <Text style={styles.name}>历时<Text style={{ color: '#FF4500' }}>{duration}</Text>小时</Text>
                    </View>
                </View>
                {
                    obj.id === roadmapId &&
                    <Image resizeMode='stretch' source={app.img.common_radio} style={styles.icon} />
                }
            </TouchableOpacity>
        );
    },
    render () {
        const { keyword } = this.state;
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, keyword }}
                    listName={'roadmapList'}
                    listUrl={app.route.ROUTE_GET_ROADMAP_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    searchContainer: {
        height: 30,
        width: 250,
        paddingVertical: 2,
        borderRadius: 105,
        backgroundColor: '#E5E5E5',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        height: 25,
        width: 220,
        fontSize: 14,
        marginLeft: 5,
        overflow: 'hidden',
        alignItems:'center',
    },
    iconSearch: {
        height: 20,
        width: 20,
    },
    row: {
        paddingHorizontal: 8,
        paddingVertical: 10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    leftContainer: {
        flex: 1,
    },
    shipperNameContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    shipperContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        marginTop: 20,
        marginLeft: 10,
    },
    shipperLogo: {
        width: 20,
        height: 20,
        borderRadius: 10,
        marginRight: 5,
    },
    shipperName: {
        fontSize: 14,
        color: 'gray',
    },
    nameContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
        alignItems: 'center',
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    type: {
        fontSize: 14,
    },
    pointContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
    },
    priceContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
    },
    icon: {
        width: 20,
        height: 16,
    },
});

```

* PDClient/project/App/modules/common/SendOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, CustomSheet } = COMPONENTS;
const LogisticsDetail = require('./LogisticsDetail');
const PayInfo = require('./PayInfo');
const PayPassword = require('./PayPassword');
const moment = require('moment');

module.exports = React.createClass({
    statics: {
        title: '货单详情',
    },
    getInitialState () {
        return {
            choose:false,
            canPay:false || this.props.canPay,
            actionSheetVisible: false,
        };
    },
    doChoose () {
        this.setState({
            choose:!this.state.choose,
        });
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        this.setState({ actionSheetVisible:true });
    },
    doConfirmPay () {
        const { data } = this.props;
        const param = {
            userId: app.personal.info.userId,
            orderIdList: [this.props.data.id],
        };
        app.push({
            component:PayPassword,
            passProps:{
                param,
                routeName : data.agent ? app.route.ROUTE_PAY_AGENT_FOR_ORDER : app.route.ROUTE_PAY_FOR_ORDER_WHEN_SEND,
                prompt : '支付成功',
                doCloseActionSheet : this.doCloseActionSheet,
                alreadyPaid: this.props.alreadyPaid,
                money:app.utils.N(data.needPayInsuanceFee + data.needPayTransportFee),
            },
        });
    },
    doLookTransport () {
        app.push({
            component: LogisticsDetail,
            passProps:{
                obj: this.props.data,
            },
        });
    },
    toPayMode (payMode) {
        if (payMode == 0) {
            return '现付';
        } else if (payMode == 1) {
            return '到付';
        } else {
            return '混合付款';
        }
    },
    render () {
        const { data } = this.props;
        const { stateList } = data;
        return (
            <View style={styles.container}>
                <View style={styles.containerReceive}>
                    <Text style={styles.textName}> 收货人：{!data.receiverName ? '暂无' : data.receiverName}</Text>
                    <Text style={styles.textName}> 收货人电话:{!data.receiverPhone ? '暂无' : data.receiverPhone}</Text>
                    <Text style={styles.textAddress}> 到货地：{data && data.endPoint} </Text>
                </View>
                <View style={styles.containerMarket}>
                    <Image style={styles.marketLogo}
                        source={app.img.order_logo}
                        resizeMode='stretch'
                        />
                    <Text style={styles.textMarket}>{ data.shop ? data.shop.name : data.agent ? data.agent.name : ''}</Text>
                    <Text style={styles.orderState}>{ stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.containerDetails}>
                    <Image style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri:data.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.shop ? data.shop.address : data.agent ? data.agent.address : ''}</Text>
                                <Text >-</Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.endPoint}</Text>
                            </View>
                            <View style={styles.detailsTopRight}>
                                <Text style={styles.moneyLeft}>运费：</Text>
                                <Text style={styles.moneyRight}>¥{data.realFee}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>重量：{data.size}m³</Text>
                        <Text style={styles.textDetailsItem}>方量：{data.weight}吨</Text>
                        <Text style={styles.textDetailsItem}>件数：{data.totalNumbers}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.containerWhite} />
                <View style={styles.containerOrderNumber}>
                    <Text style={styles.textOrderNumber}>订单号：{data.id}</Text>
                    <Text style={styles.textDate}>创建时间：{data.createTime}</Text>
                </View>
                <View style={styles.containerInfo}>
                    <Text style={styles.textInfoTop}>运费：¥{data.realFee}</Text>
                    <Text style={styles.textInfo}>保险费：¥{data.needPayInsuanceFee}</Text>
                    <Text style={styles.textInfo}>指定收款：¥{data.totalDesignatedFee}</Text>
                    <Text style={styles.textInfo}>代收货款：¥{data.proxyCharge}</Text>
                    <Text style={styles.textInfo}>支付方式：{this.toPayMode(data.payMode)}</Text>
                    <Text style={styles.textTotal}>需支付：¥{app.utils.N(data.needPayInsuanceFee + data.needPayTransportFee)}</Text>
                </View>
                {
                    stateList[0].state >= OS.OS_ON_THE_WAY &&
                    <TouchableOpacity
                        onPress={this.doLookTransport}
                        style={styles.transportInfo}>
                        <Text style={styles.textTransportInfo}>物流信息</Text>
                        <View style={styles.transportInfoRight}>
                            <Text style={styles.textTransportInfoRight}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                            <Image
                                style={styles.imageCommon_go}
                                resizeMode='stretch'
                                source={app.img.common_go}
                                />
                        </View>
                    </TouchableOpacity>
                }
                {
                    this.state.canPay &&
                    <View style={styles.bottomView}>
                        <View style={styles.bottomInfo}>
                            <View style={styles.infoLeft}>
                                <Text style={styles.totalLeft}>总计:</Text>
                                <Text style={styles.totalRight}>¥{app.utils.N(data.needPayTransportFee + data.needPayInsuanceFee)}</Text>
                            </View>
                            <Button onPress={this.doShowActionSheet} style={styles.btnPayNow} textStyle={styles.btnPayNowText}>
                                立即支付
                            </Button>
                        </View>
                    </View>
                }
                <CustomSheet
                    visible={this.state.actionSheetVisible} >
                    <PayInfo doClose={this.doCloseActionSheet} data={this.props.data} doConfirmPay={this.doConfirmPay} type={'send'} />
                </CustomSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    containerTop:{
        height:60,
        backgroundColor:'#c81622',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    imageTop:{
        height:32,
        width:27,
    },
    textTop:{
        fontSize:12,
        fontWeight:'900',
        marginLeft:20,
        color:'#ffffff',
    },
    containerReceive:{
        marginTop:8,
        paddingLeft:10,
        height:55,
        backgroundColor:'#ffffff',
        justifyContent: 'center',
    },
    textAddress:{
        fontSize:12,
        marginBottom:3,
        color:'#333333',
        flex:1,
    },
    textName:{
        fontSize:12,
        color:'#333333',
        flex:1,
    },
    containerMarket:{
        height:25,
        marginTop:8,
        alignItems: 'center',
        justifyContent: 'space-between',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    containerMarketLeft:{
        flexDirection: 'row',
    },
    marketLogo:{
        height:13,
        width:16.5,
        marginLeft:10,
    },
    textMarket:{
        flex:1,
        marginLeft:10,
        color:'#333333',
        fontSize:12,
    },
    orderState:{
        color:'#00a117',
        marginRight:10,
        fontSize:12,
    },
    containerDetails:{
        height:105,
        flexDirection: 'row',
    },
    containerWhite:{
        height:8,
        backgroundColor:'#ffffff',
    },
    imageGoods:{
        height:75,
        width:75,
        marginLeft:12,
        marginTop:11,
    },
    goodsDetails:{
        marginLeft:8,
        height:95,
        paddingBottom:8,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
        marginTop:15,
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
        marginTop:15,
    },
    detailsAddress:{
        fontSize:14,
        width:80,
        color:'#333333',
        flexDirection: 'row',

    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:1,
        fontSize:12,
        color:'#888888',
    },
    containerOrderNumber:{
        height:50,
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        justifyContent: 'center',
    },
    textOrderNumber:{
        color:'#333333',
        marginBottom:3,
        fontSize:12,
    },
    textDate:{
        color:'#888888',
        marginTop:3,
        fontSize:12,
    },
    containerInfo:{
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        paddingBottom:5,
        paddingTop:5,
    },
    textInfoTop:{
        color:'#888888',
        fontSize:12,
        height:15,
    },
    textInfo:{
        color:'#888888',
        fontSize:12,
        marginTop:3,
        height:15,
    },
    textTotal:{
        marginTop:3,
        fontSize:12,
        color:'#333333',
        fontWeight:'400',
        height:15,
    },
    transportInfo:{
        height:40,
        backgroundColor:'#ffffff',
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textTransportInfo:{
        color:'#888888',
        fontSize:14,
        marginLeft:10,
    },
    transportInfoRight:{
        marginRight:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    textTransportInfoRight:{
        fontSize:14,
        color:'#333333',
        marginRight:5,
    },
    imageCommon_go:{
        width: 8,
        height: 15,
        marginRight: 7,
    },
    choose:{
        marginLeft:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    imageChoose:{
        height:15,
        width:15,
    },
    bottomView:{
        position:'absolute',
        bottom:0,
        width:sr.w,
    },
    bottomInfo:{
        height:45,
        flexDirection: 'row',
        backgroundColor:'white',
        marginBottom:0,
    },
    infoLeft:{
        height:45,
        flexDirection: 'row',
        flex:1,
        alignItems: 'center',
    },
    btnPayNow:{
        height:45,
        flex:1,
        borderRadius:0,
    },
    btnPayNowText:{
        fontSize:16,
        fontWeight:'500',
    },
    totalLeft:{
        fontSize:12,
        color:'#333333',
        marginLeft:10,
    },
    totalRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginLeft:5,
    },
});

```

* PDClient/project/App/modules/common/SendOrderList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

const { PageList, Button, CustomSheet, DImage } = COMPONENTS;
const SendOrderDetail = require('./SendOrderDetail');
const LogisticsDetail = require('./LogisticsDetail');
const PayPassword = require('./PayPassword');
const PayInfo = require('./PayInfo');

let sumWeight = 0;
let sumCount = 0;
let sumSize = 0;
let money = 0;

module.exports = React.createClass({
    getInitialState () {
        return {
            paid: false,
            list:[],
            data: {},
            orderIdList: [],
        };
    },
    getOrderDetail (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess.bind(null, index), true);
    },
    getOrderDetailSuccess (index, data) {
        const { success, msg } = data;
        if (success) {
            this.setState({
                orderIdList: [],
                list: [],
            });
            sumWeight = 0;
            sumCount = 0;
            sumSize = 0;
            money = 0;
            app.push({
                component: SendOrderDetail,
                passProps: {
                    data: data.context,
                    type: 1,
                    updateList: (data) => {
                        this.listView.updateList((list) => {
                            list[index] = data;
                            return list;
                        });
                    },
                },
            });
        } else {
            Toast(msg);
        }
    },
    doLookTransport (obj) {
        app.push({
            component : LogisticsDetail,
            passProps:{
                obj,
            },
        });
    },
    doPay (obj, rowId) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.doPaySuccess.bind(null, rowId), false);
    },
    doPaySuccess (index, data) {
        const { success, msg } = data;
        if (success) {
            this.setState({
                data: data.context,
                orderIdList: [],
                list: [],
            });
            sumWeight = 0;
            sumCount = 0;
            sumSize = 0;
            money = 0;
            app.push({
                component: SendOrderDetail,
                passProps: {
                    canPay:true,
                    data: data.context,
                    type: 1,
                    alreadyPaid: this.alreadyPaid,
                    actionSheetVisible: false,
                },
            });
        } else {
            Toast(msg);
        }
    },
    alreadyPaid () {
        this.setState({ paid: true });
    },
    doLookDetail (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess.bind(null, index), true);
    },
    renderSeparator (sectionID, rowId) {
        return (
            <View style={styles.separator} key={sectionID + rowId} />
        );
    },
    doChoose (obj, rowId) {
        const { list, orderIdList } = this.state;
        list[rowId].selected = !list[rowId].selected;
        if (_.findIndex(orderIdList, o => o == obj.id) == -1) {
            orderIdList.push(obj.id);
        } else {
            this.setState({ orderIdList: _.reject(orderIdList, o => o == obj.id) });
        }
        this.setState({
            list,
        });
        this.doTotalCalculation();
    },
    doSelectedAll () {
        let { list, orderIdList } = this.state;
        if (_.every(list, o => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
            _.forEach(list, o => {
                this.setState({ orderIdList: [] });
            });
        } else {
            _.forEach(list, o => { o.selected = true; });
            _.forEach(list, o => { orderIdList.push(o.item.id); });
            this.setState({
                orderIdList: _.uniq(orderIdList),
            });
        }
        this.setState({ list });
        this.doTotalCalculation();
    },
    doTotalCalculation () {
        const { list } = this.state;
        sumWeight = 0;
        sumCount = 0;
        sumSize = 0;
        money = 0;
        _.filter(list, (o) => o.selected == true).forEach((item, i) => {
            sumSize = sumSize + item.item.size;
            sumCount = sumCount + 1;
            sumWeight = sumWeight + item.item.weight;
            money = money + item.item.realFee + item.item.needPayInsuanceFee;
        });
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        const { orderIdList, list } = this.state;
        if (orderIdList.length == 0) {
            Toast('请选择您要支付的货单');
            return;
        }
        if (!(_.find(list, o => o.item.stateList[0].state == OS.OS_READY_PAYMENT) || _.find(list, o => o.item.stateList[0].state == OS.OS_READY_DEDUCT_AND_PRINT_ORDER))) {
            Toast('请选择待支付的订单');
            return;
        }
        this.setState({ actionSheetVisible:true });
    },
    doConfirmPay () {
        const { orderIdList, list } = this.state;
        const param = {
            userId: app.personal.info.userId,
            orderIdList: orderIdList,
        };
        app.push({
            component:PayPassword,
            passProps:{
                param,
                routeName : !_.find(_.filter(list, (o) => o.selected == true), o => o.item.agent) ? app.route.ROUTE_PAY_FOR_ORDER_WHEN_SEND : app.route.ROUTE_PAY_AGENT_FOR_ORDER,
                prompt : '支付成功',
                doCloseActionSheet : this.doCloseActionSheet,
                alreadyPaid: this.alreadyPaid,
                money,
            },
        });
    },
    renderRow (obj, rowId) {
        const { stateList } = obj;
        const { type } = this.props;
        const { paid, list } = this.state;
        if (type == 'waitpay') {
            if (!_.find(list, (o) => o.index == rowId)) {
                list.push({ selected:false, index:rowId, item:obj });
            }
        }
        return (
            <View style={styles.row}>
                <View style={styles.rowTopContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.order_logo}
                        style={styles.topImage} />
                    <Text style={styles.topLeftText}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                    <Text style={styles.topRightText}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.middle}>
                    {
                        type == 'waitpay' &&
                        <TouchableOpacity onPress={this.doChoose.bind(null, obj, rowId)}
                            style={styles.btnChoose}>
                            <Image
                                resizeMode='stretch'
                                source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose}
                                style={styles.choose} />
                        </TouchableOpacity>
                    }
                    <TouchableOpacity style={styles.rowMiddleContainer} onPress={this.getOrderDetail.bind(null, obj, rowId)}>
                        <DImage
                            resizeMode='stretch'
                            defaultSource={app.img.common_default}
                            source={{ uri: obj.photo }}
                            style={styles.middleImage} />
                        <View style={styles.middleRight}>
                            <View style={styles.pointContainer}>
                                <View style={styles.placeContainer}>
                                    <Text style={styles.pointName}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                    <Text style={styles.pointText}>→</Text>
                                    <Text style={styles.pointName}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{obj.endPoint}</Text>
                                </View>
                                <Text style={styles.transformFee}>{'需付款：'}<Text style={styles.money}>￥{obj.realFee + obj.needPayInsuanceFee}</Text></Text>
                            </View>
                            <Text style={styles.commonInfo}>重量：{obj.weight}吨</Text>
                            <Text style={styles.commonInfo}>方量：{obj.size}m³</Text>
                            <Text style={styles.commonInfo}>件数：{obj.totalNumbers}件</Text>
                            <Text style={styles.commonInfo}>下单时间：{obj.createTime}</Text>
                        </View>
                    </TouchableOpacity>
                </View>
                <View style={styles.rowButtomContainer}>
                    {
                        stateList[0].state == OS.OS_READY_PAYMENT ?
                            <Button
                                style={styles.lookTransport}
                                disable={paid}
                                onPress={this.doPay.bind(null, obj, rowId)}
                                textStyle={styles.btnTransportText}>
                                {!paid ? '支付' : '已支付'}
                            </Button>
                        :
                        stateList[0].state >= OS.OS_ON_THE_WAY ?
                            <Button
                                onPress={this.doLookTransport.bind(null, obj)}
                                style={styles.lookTransport}
                                textStyle={styles.btnTransportText}>
                                {'查看物流'}
                            </Button>
                        :
                            <View />
                    }
                    <Button onPress={this.doLookDetail.bind(null, obj, rowId)} style={styles.lookDetail} textStyle={styles.btnDetallText}>{'查看详情'}</Button>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, type } = this.props;
        const { list, actionSheetVisible, orderIdList } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                <View style={styles.separator} />
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator}
                    listParam={{ userId: app.personal.info.userId, type: type }}
                    listName={'orderList'}
                    listUrl={app.route.ROUTE_GET_SEND_ORDER_LIST}
                    refreshEnable
                    />
                {
                    type == 'waitpay' &&
                    <View style={styles.selectedAllContainer}>
                        <View style={styles.totalLeft}>
                            <TouchableOpacity onPress={this.doSelectedAll}
                                style={styles.selectedAllBtn}>
                                <Image style={styles.chooseAll}
                                    source={status ? app.img.order_choose : app.img.order_no_choose} />
                                <Text style={styles.selectedAllText}>全选</Text>
                            </TouchableOpacity>
                            <Text style={styles.totalText}>总计</Text>
                            <Text style={styles.totalItem}>{sumWeight}吨</Text>
                            <Text style={styles.totalItem}>{sumSize}m³</Text>
                            <Text style={styles.totalItemRight}>{sumCount}单</Text>
                        </View>
                        <TouchableOpacity onPress={this.doShowActionSheet}
                            style={styles.pay}>
                            <Text style={styles.payText}>立即支付</Text>
                        </TouchableOpacity>
                    </View>
                }
                <CustomSheet
                    visible={actionSheetVisible} >
                    <PayInfo
                        orderCount={orderIdList.length}
                        doClose={this.doCloseActionSheet}
                        money={money}
                        doConfirmPay={this.doConfirmPay}
                        type={'all'} />
                </CustomSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    separator: {
        backgroundColor: '#f4f4f4',
        height: 8,
    },
    rowTopContainer: {
        paddingHorizontal:10,
        paddingVertical:5,
        backgroundColor:'white',
        flexDirection: 'row',
    },
    topImage: {
        width: 17,
        height:17,
    },
    topLeftText: {
        marginLeft:10,
        flex:1,
        fontSize: 14,
    },
    topRightText: {
        flex:1,
        fontSize: 14,
        textAlign:'right',
        color:'#f51b1a',
    },
    middle:{
        flexDirection:'row',
        height:100,
        alignItems:'center',
        width:sr.w,
        backgroundColor:'#f8f8f8',
    },
    rowMiddleContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:11,
        height:100,
    },
    btnChoose:{
        height:100,
        width:20,
        marginRight:3,
        justifyContent:'center',
        alignItems:'center',
    },
    choose:{
        height:12,
        width:12,
    },
    middleImage: {
        width: 80,
        height:80,
        borderRadius: 10,
    },
    middleRight: {
        paddingLeft: 10,
        width:sr.w - 105,
    },
    money: {
        fontSize: 12,
        color:'#f51b1a',
    },
    commonInfo: {
        fontSize: 13,
        color:'#888888',
    },
    pointName: {
        fontSize: 13,
        maxWidth: 60,
    },
    pointText:{
        marginLeft:5,
        marginRight:10,
    },
    transformFee: {
        fontSize: 12,
        color: 'gray',
        marginRight:10,
        textAlign:'right',
    },
    pointContainer: {
        flexDirection: 'row',
        marginBottom:4,
    },
    placeContainer: {
        flex:2,
        flexDirection: 'row',
    },
    rowButtomContainer: {
        backgroundColor:'white',
        flexDirection: 'row',
        justifyContent: 'flex-end',
        paddingVertical:5,
    },
    lookTransport: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#ff6200',
        borderWidth:1,
        backgroundColor:'white',
    },
    lookDetail: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#007ef7',
        borderWidth:1,
        marginLeft:20,
        marginRight:10,
        backgroundColor:'white',
    },
    btnTransportText:{
        color:'#ff6200',
        fontSize:12,
        fontWeight:'300',
    },
    btnDetallText:{
        color:'#007ef7',
        fontSize:12,
        fontWeight:'300',
    },
    totalLeft:{
        flex:7,
        flexDirection:'row',
        alignItems:'center',
    },
    selectedAllContainer:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
    },
    selectedAllBtn:{
        flexDirection:'row',
        alignItems:'center',
        height:40,
    },
    chooseAll:{
        height:12,
        width:12,
        marginLeft:5,
    },
    selectedAllText:{
        color:'#333333',
        fontSize:12,
        marginLeft:10,
    },
    totalText:{
        color:'#333333',
        fontSize:15,
        fontWeight:'500',
        marginLeft:20,
    },
    totalItem:{
        width:45,
        fontSize:12,
        color:'#f01823',
        textAlign:'right',
        marginLeft:5,
    },
    totalItemRight:{
        width:42,
        fontSize:12,
        color:'#f01823',
        textAlign:'right',
        marginRight:5,
    },
    pay:{
        flex:3,
        marginLeft:10,
        height:50,
        width:150,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor:'#c81622',
    },
    payText:{
        fontSize:14,
        fontWeight:'500',
        color:'#FFFFFF',
        letterSpacing:2,
    },
});

```

* PDClient/project/App/modules/common/ShowBigImage.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
} = ReactNative;

import Swiper from 'react-native-swiper';

module.exports = React.createClass({
    getInitialState () {
        const list = [];
        const list1 = [];
        this.props.defaultImageArray.map((item, i) => {
            if (i >= this.props.defaultIndex) {
                list1.push(item);
            } else {
                list.push(item);
            }
        });
        return {
            imageList: list1.concat(list),
        };
    },
    render () {
        return (
            <View style={styles.overlayContainer}>
                <Swiper
                    paginationStyle={styles.paginationStyle}
                    height={sr.th}>
                    {
                           this.state.imageList.map((item, i) => {
                               return (
                                   <TouchableOpacity
                                       key={i}
                                       activeOpacity={1}
                                       onPress={app.closeModal}
                                       style={styles.imageContainer}>
                                       <Image
                                           resizeMode='contain'
                                           defaultSource={app.img.common_default}
                                           source={{ uri: item }}
                                           style={styles.bannerImage}
                                           />
                                   </TouchableOpacity>
                               );
                           })
                       }
                </Swiper>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    overlayContainer: {
        flex: 1,
        alignItems:'center',
        justifyContent: 'center',
    },
    paginationStyle: {
        bottom: 30,
    },
    imageContainer: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    bannerImage: {
        alignSelf: 'center',
        width: sr.w,
        flex: 1,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/index.js

```js
'use strict';
const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

const Cargo = require('./cargo');
const Roadmap = require('./roadmap');
const Order = require('./order/Trucks');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: Cargo },
    { index: 1, component: Order },
    { index: 2, component: Roadmap },
    { index: 3, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '竞得货物', icon: app.img.home_cargo, selected: app.img.home_cargo_press },
            { index: 1, title: '我的货车', icon: app.img.home_truck_unselect, selected: app.img.home_truck },
            { index: 2, title: '路线设置', icon: app.img.home_roadmap, selected: app.img.home_roadmap_press },
            { index: 3, title: '我的', icon: app.img.home_mine, selected: app.img.home_mine_press },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDClient/project/App/modules/normalUser/index.js

```js
'use strict';
const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

// const Shipper = require('../order');
const Shipper = require('./market');
// const Roadmap = require('../roadmap');
const preOrder = require('./preOrder');
// const Collection = require('../collection');
const ReceiveOrder = require('./order/ReceiveOrderList');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: preOrder },
    { index: 1, component: ReceiveOrder },
    { index: 2, component: Shipper },
    { index: 3, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '我要发货', icon:app.img.home_pre_order, selected: app.img.home_pre_order_press },
            { index: 1, title: '我要收货', icon: app.img.home_order, selected: app.img.home_order_press },
            { index: 2, title: '行情', icon: app.img.home_main, selected: app.img.home_main_press },
            { index: 3, title: '我的', icon: app.img.home_mine, selected: app.img.home_mine_press },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDClient/project/App/modules/person/About.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '关于软件',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_ABOUT_PAGE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDClient/project/App/modules/person/AmountRule.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '担保金规则',
    },
    toAmountRule () {

    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_ABOUT_PAGE }}
                scalesPageToFit
            />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDClient/project/App/modules/person/BalanceDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '详情',
    },
    render () {
        const obj = this.props.obj;
        return (
            <View style={styles.container}>
                <View style={[styles.item, { paddingTop:2 }]}>
                    <Text style={styles.itemLeft}> 流水号 </Text>
                    <Text style={styles.itemRight}> {obj.thirdpartyAccount == null ? '内部支付' : obj.thirdpartyAccount} </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 类型 </Text>
                    <Text style={styles.itemRight}> {obj.remark} </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 金额 </Text>
                    <Text style={obj.tradeAmountYuan > 0 ? styles.itemMoneyGreen : styles.itemMoneyRed}>
                        {obj.tradeAmountYuan}
                    </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 时间 </Text>
                    <Text style={styles.itemRight}> {obj.tradeTime} </Text>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    item:{
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
    },
    itemLeft:{
        fontSize:14,
        color:'#333333',
        paddingLeft:8,
    },
    itemRight:{
        fontSize:14,
        color:'#333333',
        paddingRight:10,
    },
    itemMoneyRed:{
        fontSize:14,
        color:'#C81622',
        paddingRight:10,
    },
    itemMoneyGreen:{
        fontSize:14,
        color:'#2F971C',
        paddingRight:10,
    },
});

```

* PDClient/project/App/modules/person/BalanceDetailList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;
const BalanceDetail = require('./BalanceDetail');

module.exports = React.createClass({
    statics: {
        title: '余额明细',
    },
    renderRow (obj) {
        return (
            <TouchableOpacity onPress={this.toAccountDetails.bind(null, obj)}>
                <View style={styles.recharge}>
                    <View>
                        <Text style={styles.rechargeText} numberOfLine={1}>
                            {obj.remark}
                        </Text>
                        <Text style={styles.rechargeDate}>
                            {obj.tradeTime}
                        </Text>
                    </View>
                    <Text style={obj.tradeAmountYuan > 0 ? styles.rechargeMoney : styles.expenditureMoney}>
                        {obj.tradeAmountYuan}
                    </Text>
                </View>
            </TouchableOpacity>
        );
    },
    toAccountDetails (obj) {
        app.push({
            component:BalanceDetail,
            passProps: {
                obj:obj,
            },
        });
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId }}
                    listName={'billList'}
                    listUrl={app.route.ROUTE_GET_BILL_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    recharge:{
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    rechargeText:{
        paddingTop:5,
        paddingLeft:8,
        color:'#333333',
        fontSize:14,
        height:22,
        width:sr.w * 4 / 5,
    },
    rechargeDate:{
        color:'#aaaaaa',
        paddingVertical:5,
        paddingLeft:8,
        height:28,
    },
    rechargeMoney:{
        color:'#2F971C',
        fontSize:14,
        paddingRight:10,
        flex:1,
        textAlign:'right',
    },
    expenditureMoney:{
        color:'#C81622',
        fontSize:14,
        paddingRight:10,
        flex:1,
        textAlign:'right',
    },
});

```

* PDClient/project/App/modules/person/BindBankcard.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
} = ReactNative;

const { Button } = COMPONENTS;
module.exports = React.createClass({
    statics: {
        title: '绑定银行卡',
    },
    doBind () {

    },
    doScanBankcard () {

    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <View style={styles.infoStyleText}>
                            <Text style={styles.itemNameText}>{'账号'}</Text>
                        </View>
                        <TextInput style={styles.itemNameLeftText}
                            underlineColorAndroid='transparent'
                            placeholderTextColor='#aaaaaa'
                            placeholder='请填入银行卡号'
                            onChangeText={this.onContentTextChange}
                            />
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <View style={styles.infoStyleText}>
                            <Text style={styles.itemNameText}>{'姓名'}</Text>
                        </View>
                        <TextInput style={styles.itemNameLeftText}
                            underlineColorAndroid='transparent'
                            placeholderTextColor='#aaaaaa'
                            placeholder='请填入姓名'
                            onChangeText={this.onContentTextChange}
                            />
                    </View>
                </View>
                <View style={styles.lineView} />
                <Button onPress={this.doBind} style={styles.btnBind} textStyle={styles.btnBindText} >
                    绑定
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 10,
    },
    ItemBg: {
        padding: 10,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
        marginTop:1,
    },
    infoStyle: {
        flexDirection: 'row',
    },
    infoStyleText:{
        justifyContent:'center',
    },
    icon_add:{
        width:22,
        height:20,
        marginRight:5,
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    itemNameLeftText: {
        flex:1,
        marginTop:2,
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    btnBind:{
        marginTop:50,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
        backgroundColor:'#c81622',
    },
    btnBindText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDClient/project/App/modules/person/BindBankcardList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    ListView,
} = ReactNative;

const BindBankcard = require('./BindBankcard');
const { MessageBox } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '银行卡',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list: [1, 2],
        };
    },
    doAddBankcard () {
        app.push({
            component: BindBankcard,
        });
    },
    unBindBankcard (rowID) {
        app.showModal(
            <MessageBox
                onConfirm={this.doUnBindBankcard.bind(rowID)}
                content={'是否确认解绑该银行卡'}
                onCancel title={false}
                width={sr.s(250)} />
        );
    },
    doUnBindBankcard (rowID) {
        const { list } = this.state;
        list.splice(rowID, 1);
    },
    renderRow (obj, sectionID, rowID) {
        return (
            <View style={styles.ItemBg}>
                <View style={styles.infoStyle}>
                    <View >
                        <Text style={styles.itemNameText}>{'农业银行'}</Text>
                        <Text style={styles.itemNumberText}>{'**0851储蓄卡'}</Text>
                    </View>
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={() => this.unBindBankcard(rowID)}>
                        <Text style={styles.itemNameRightText}>{'解绑'}</Text>
                    </TouchableOpacity>
                </View>
            </View>
        );
    },
    renderFooter (obj, sectionID, rowId) {
        return (
            <TouchableOpacity
                activeOpacity={0.6}
                onPress={this.doAddBankcard}
                style={styles.touch_add}>
                <Image
                    resizeMode='stretch'
                    source={app.img.personal_add}
                    style={styles.icon_add} />
                <Text style={styles.itemAddText}>{'添加银行卡'}</Text>
            </TouchableOpacity>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    style={styles.ListView}
                    dataSource={this.ds.cloneWithRows(this.state.list)}
                    renderRow={this.renderRow}
                    renderFooter={this.renderFooter}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBg: {
        height: 42,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
        marginTop:2,
    },
    ListView:{
        marginTop:8,
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    touch_add:{
        alignItems:'center',
        marginTop:29,
    },
    icon_add:{
        width:30,
        height:30,
    },
    itemAddText: {
        fontSize: 14,
        color: '#888888',
        marginTop:10,
    },
    itemNameText: {
        fontSize: 14,
        color: '#333333',
        marginLeft: 8,
        marginBottom:2,
    },
    itemNumberText:{
        fontSize: 12,
        color: '#888888',
        marginLeft: 8,
        marginTop:2,
    },
    itemNameRightText: {
        textAlign:'right',
        fontSize: 13,
        color: '#3fa0ff',
        marginRight:10,
        marginTop:10,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
});

```

* PDClient/project/App/modules/person/BranchDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
    TouchableOpacity,
} = ReactNative;

import moment from 'moment';
const GuaranteeDetail = require('./GuaranteeDetail');

module.exports = React.createClass({
    statics: {
        title: '入驻详情',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list:[],
            guaranteeList:[],
        };
    },
    componentWillMount () {
        this.getBranchShopInfo();
    },
    getBranchShopInfo () {
        const param = {
            userId:app.personal.info.userId,
            shopId:this.props.id,
        };
        POST(app.route.ROUTE_GET_BRANCH_SHOP_INFO, param, this.getBranchShopInfoSuccess, false);
    },
    getBranchShopInfoSuccess (data) {
        if (data.success) {
            this.setState({
                list:data.context,
                guaranteeList:data.context.bondCompanyList,
            });
        } else {
            Toast(data.msg);
        }
    },
    showGuaranteeDetail (obj) {
        app.push({
            component:GuaranteeDetail,
            passProps:{
                obj,
            },
        });
    },
    renderRow (obj, sectionID, rowID) {
        return (
            <TouchableOpacity style={styles.item} onPress={this.showGuaranteeDetail.bind(null, obj)}>
                <Text style={styles.itemFont}>{obj.name}</Text>
                <View style={styles.priceRow}>
                    <Text style={styles.itemPrice}>{obj.bondAmount > 100000 ?
                            (obj.bondAmount / 10000) + '万' : obj.bondAmount}</Text>
                    <Image resizeMode='contain'
                        style={styles.imgGo}
                        source={app.img.common_go} />
                </View>
            </TouchableOpacity>
        );
    },
    render () {
        const { list, guaranteeList } = this.state;
        const name = this.props.name;
        return (
            <View style={styles.container}>
                <View style={styles.top}>
                    <Text style={styles.topTitle}>{name}</Text>
                    <Text style={styles.topItem}>入驻时间：{moment(list.registerTime).format('YYYY-MM-DD')}</Text>
                    <Text style={styles.topItem}>担保金额：{list.totalBondAmount > 100000 ?
                            (list.totalBondAmount / 10000) + '万' : list.totalBondAmount}</Text>
                </View>
                <Text style={styles.title}>担保公司</Text>
                <ListView
                    dataSource={this.ds.cloneWithRows(guaranteeList)}
                    renderRow={this.renderRow}
                    enableEmptySections
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    top:{
        backgroundColor:'#FFFFFF',
        height:90,
        justifyContent:'center',
    },
    topTitle:{
        fontSize:14,
        fontWeight:'700',
        marginTop:13,
        marginLeft:10,
        flex:1,
    },
    topItem:{
        fontSize:12,
        marginLeft:10,
        flex:1,
        fontWeight:'300',
    },
    title:{
        height:20,
        color:'#666666',
        fontSize:14,
        marginLeft:10,
        marginTop:15,
    },
    item:{
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        marginTop:1,
        height:42,
        alignItems:'center',
    },
    priceRow:{
        flexDirection:'row',
        flex:1,
        justifyContent:'flex-end',
    },
    itemFont:{
        fontSize:14,
        marginLeft:10,
        fontWeight:'300',
    },
    itemPrice:{
        fontSize:14,
        fontWeight:'300',
    },
    imgGo:{
        width:15,
        height:15,
        marginLeft:5,
        marginRight:15,
    },
});

```

* PDClient/project/App/modules/person/BranchStore.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

const BranchDetail = require('./BranchDetail');

module.exports = React.createClass({
    statics: {
        title: '入驻分店',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list:app.personal.info.shipper.registerShopList,
        };
    },
    showBranchDetail (id, name) {
        app.push({
            component:BranchDetail,
            passProps:{
                id,
                name,
            },
        });
    },
    renderRow (obj, sectionID, rowId) {
        return (
            <TouchableOpacity onPress={this.showBranchDetail.bind(null, obj.id, obj.name)}>
                <View style={styles.itemContainer}>
                    <Text style={styles.itemText}>{obj.name}</Text>
                </View>
                <View style={styles.listView} />
            </TouchableOpacity>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    style={styles.ListView}
                    dataSource={this.ds.cloneWithRows(this.state.list)}
                    renderRow={this.renderRow}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop:10,
    },
    itemContainer:{
        height:45,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
    },
    itemText:{
        fontSize:14,
        color:'#333333',
        marginLeft:15,
    },
    itemTime:{
        fontSize:12,
        color: '#888888',
        marginLeft:15,
    },
    listView:{
        height:1,
    },
});

```

* PDClient/project/App/modules/person/CashBalance.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const WithdrawCash = require('./WithdrawCash');
const Recharge = require('./Recharge');
const BalanceDetailList = require('./BalanceDetailList');

module.exports = React.createClass({
    statics: {
        title: '余额',
        rightButton: { title: '明细', handler: () => { app.scene.detail(); } },
    },
    getInitialState () {
        return {
            type:'1',
            remainAmount:app.personal.remainAmount,
        };
    },
    componentWillMount () {
        this.getRemainAmount();
    },
    getRemainAmount () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_REMAIN_AMOUNT, param, this.getRemainAmountSuccess, false);
    },
    getRemainAmountSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.setRemainAmount(context.amount);
            this.setState({ remainAmount:app.personal.remainAmount });
        }
    },
    detail () {
        app.push({
            component:BalanceDetailList,
        });
    },
    showWithdrawCash () {
        app.push({
            component: WithdrawCash,
            passProps:{
                setRemainAmount : this.setRemainAmount,
            },
        });
    },
    showRecharge () {
        app.push({
            component: Recharge,
            passProps:{
                setRemainAmount : this.setRemainAmount,
            },
        });
    },
    setRemainAmount (amount) {
        this.setState({
            remainAmount : amount,
        });
    },
    render () {
        const { remainAmount } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.TopView}>
                    <Text style={styles.CashBalanceTitle}>账户余额</Text>
                    <View style={styles.CashBalance}>
                        <Text style={styles.CashBalanceTitleLeft}>￥</Text><Text style={styles.CashBalanceContent}>{app.utils.N(remainAmount)}</Text>
                    </View>
                </View>
                {
                    (_.intersection(app.personal.info.authority, [AH.AH_WITHDRAW]).length != 0 || app.authority.info.currentRole == '发货人') &&
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={this.showWithdrawCash}
                        style={styles.ItemBg}>
                        <View style={styles.infoStyle}>
                            <Text style={styles.itemNameText}>{'提现'}</Text>
                        </View>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_go}
                            style={styles.icon_go} />
                        <View style={styles.lineView} />
                    </TouchableOpacity>
                }
                {
                    (_.intersection(app.personal.info.authority, [AH.AH_RECHARGE]).length != 0 || app.authority.info.currentRole == '发货人') &&
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={this.showRecharge}
                        style={styles.ItemBg}>
                        <View style={styles.infoStyle}>
                            <Text style={styles.itemNameText}>{'充值'}</Text>
                        </View>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_go}
                            style={styles.icon_go} />
                        <View style={styles.lineView} />
                    </TouchableOpacity>
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    TopView: {
        height:100,
        backgroundColor:'#c81622',
        marginBottom:8,
        paddingLeft:20,
        paddingTop:15,
        paddingBottom:20,
    },
    CashBalanceTitle:{
        fontSize:14,
        color:'white',
    },
    CashBalance: {
        flexDirection: 'row',
        marginTop:22,
    },
    CashBalanceTitleLeft:{
        fontSize:14,
        color:'white',
        alignSelf:'flex-end',
        paddingBottom:5,
    },
    CashBalanceContent:{
        fontSize:24,
        color:'white',
        alignSelf:'flex-end',
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
});

```

* PDClient/project/App/modules/person/CommonSetting.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Switch,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '基础设置',
    },
    getInitialState () {
        return {
            onlyWifiUpload: !!app.setting.data.onlyWifiUpload,
        };
    },
    onValueChange (value) {
        this.setState({ onlyWifiUpload: value });
        app.setting.setOnlyWifiUpload(value);
    },
    selectThemeColor (color) {
        app.setting.setThemeColor(color);
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.row}>
                    <Text style={styles.title}>只在wifi下上传</Text>
                    <Switch
                        style={styles.switch}
                        onValueChange={this.onValueChange}
                        value={this.state.onlyWifiUpload} />
                </View>
                <View style={styles.row}>
                    <Text style={styles.title}>主题颜色</Text>
                    <View style={styles.colorContainer}>
                        {
                            CONSTANTS.THEME_COLORS.map((color, i) => {
                                return (
                                    <TouchableOpacity
                                        key={i}
                                        onPress={this.selectThemeColor.bind(null, color)}
                                        style={[styles.color, { backgroundColor: color }]}
                                        />
                                );
                            })
                        }
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 20,
    },
    row: {
        paddingHorizontal: 14,
        height: 80,
        flexDirection: 'row',
        backgroundColor: '#FFFFFF',
        alignItems: 'center',
    },
    title: {
        flex: 7,
        fontSize: 17,
        color: 'gray',
        marginLeft: 2,
    },
    switch: {
        flex: 2,
    },
    colorContainer: {
        flex: 20,
        flexDirection: 'row',
        justifyContent: 'space-around',
    },
    color: {
        flex: 1,
        height:80,
        marginRight: 10,
    },
});

```

* PDClient/project/App/modules/person/ConfirmPayPassword.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const DigitalKeyboard = require('../common/DigitalKeyboard');

const list = [1, 2, 3, 4, 5, 6, 7, 8, 9];

module.exports = React.createClass({
    statics: {
        title: '确认支付密码',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        this.props.toClear();
        app.pop();
    },
    getInitialState () {
        return {
            password: '',
        };
    },
    passwordItem (item) {
        const { password } = this.state;
        this.setState({ password: password + item });
    },
    zero () {
        const { password } = this.state;
        this.setState({ password: password + 0 });
    },
    delete () {
        const { password } = this.state;
        this.setState({
            password: _.dropRight(password).join(''),
        });
    },
    confirm () {
        const { password, type } = this.state;
        const tmp = password.substring(0, 6);
        if (tmp.length == 6) {
            this.toNext(tmp);
        } else {
            Toast('支付密码有误');
            this.toClear();
        }
    },
    toClear () {
        this.setState({
            password: '',
        });
    },
    toNext (tmp) {
        const { number, verifyCode } = this.props;
        if (number == tmp) {
            const param = {
                userId:app.personal.info.userId,
                verifyCode,
                phone:app.personal.info.phone,
                password : tmp,
            };
            POST(app.route.ROUTE_SET_PAYMENT_PASSWORD, param, this.modifySuccess, true);
        } else {
            Toast('两次输入密码不一致，请重试');
            this.goBack();
        }
    },
    modifySuccess (data) {
        if (data.success) {
            Toast('修改成功');
            const info = app.personal.info;
            info.isSetPaymentPassword = 1;
            app.personal.set(info);
            app.pop(3);
        } else {
            Toast(data.msg);
            app.pop(2);
        }
    },
    render () {
        const max = [1, 2, 3, 4, 5, 6];
        const { password, type } = this.state;
        return (
            <View style={styles.container}>
                <Text style={styles.text}>再次输入密码以作确认</Text>
                <View style={styles.password}>
                    {
                        max.map((item, i) => (
                            <View style={i == 0 ? styles.itemStart : styles.item} key={i}>
                                { password.length >= (i + 1) ?
                                    <View style={styles.point} />
                                    :
                                    <View style={styles.noPoint} />
                                }
                            </View>
                        ))
                    }
                </View>
                <View style={styles.digitalKeyboard} />
                <View>
                    <DigitalKeyboard list={list}
                        passwordItem={this.passwordItem}
                        zero={this.zero}
                        delete={this.delete}
                        confirm={this.confirm} />
                </View>
            </View>
        );
    },
});
const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },

    text:{
        fontSize:14,
        textAlign:'center',
        color:'#333333',
        marginTop:30,
    },
    password:{
        height:40,
        width:330,
        backgroundColor:'#ffffff',
        flexDirection:'row',
        marginTop:15,
        marginLeft:(sr.w - 330) / 2,
        borderRightWidth:1,
        borderBottomWidth:1,
        borderTopWidth:1,
        borderColor:'#EDEDED',
        borderRadius:4,
    },
    itemStart:{
        height:40,
        width:55,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    item:{
        height:40,
        width:55,
        borderLeftWidth:1,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    point:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#000000',
    },
    noPoint:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#FFFFFF',
    },
    digitalKeyboard:{
        flex:1,
    },
});

```

* PDClient/project/App/modules/person/EditPersonInfo.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
    Text,
    StyleSheet,
    View,
    TouchableOpacity,
} = ReactNative;

const { DImage, Picker } = COMPONENTS;

const ImagePicker = require('./ImagePicker');
const EditSingleInfo = require('./EditSingleInfo');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '个人信息',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        this.props.updateInfo(app.personal.info);
        Picker.hide();
        app.pop();
    },
    getInitialState () {
        const info = app.personal.info;
        return {
            name: info.name,
            address: info.address,
            head: info.head,
            sex: info.sex === 0 ? '男' : '女',
            phone:info.phone,
            pickerData: ['男', '女'],
        };
    },
    toEditHead () {
        app.push({
            component: ImagePicker,
            passProps: {
                onCropImage: this.setUserHead,
            },
        });
    },
    setUserHead (uri) {
        this.setState({ head: uri });
    },
    toEditSingleInfo (name, tip, maxLength, checkFun) {
        Picker.hide();
        app.push({
            title: '修改' + tip,
            component: EditSingleInfo,
            passProps: {
                keyName:name,
                placeholder:tip,
                maxLength,
                updateSingleState:this.updateSingleState,
                checkFun,
            },
        });
    },
    updateSingleState (keyName, value) {
        let state = this.state;
        state[keyName] = value;
        this.setState({ state });
    },
    toEditSex () {
        const { sex, pickerData } = this.state;
        Picker(pickerData, [sex], '选择性别').then((value) => {
            const sex = value[0];
            this.setState({ sex }, () => {
                this.modifyPersonalInfo();
            });
        });
    },
    modifyPersonalInfo () {
        const { sex } = this.state;
        const param = {
            userId : app.personal.info.userId,
            sex : sex == '男' ? 0 : 1,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            app.personal.set(data.context);
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { name, address, sex, head, phone } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.headStyle} >
                    <TouchableOpacity
                        onPress={this.toEditHead}
                        style={styles.head_itemView}>
                        <DImage
                            defaultSource={app.img.personal_default_head}
                            source={{ uri: head }}
                            style={styles.headImgStyle} />
                        <View style={styles.rightView} >
                            <Image
                                source={app.img.common_go}
                                style={styles.goStyle} />
                        </View>
                    </TouchableOpacity>
                </View>
                <TouchableOpacity
                    onPress={this.toEditSingleInfo.bind(null, 'name', '昵称', CONSTANTS.NAME_MAX_LENGTH, app.utils.checkStr)}
                    style={styles.itemView} >
                    <Text style={styles.itemKeyText}>昵称</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{name || app.personal.info.phone}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity
                    onPress={this.toEditSex}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>性别</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{sex}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity
                    onPress={this.toEditSingleInfo.bind(null, 'address', '地址', CONSTANTS.ADDRESS_MAX_LENGTH, app.utils.checkStr)}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText} numberOfLines={1}>地址</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{address}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>手机号码</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{phone}</Text>
                    </View>
                </TouchableOpacity>
                {
                    (!app.personal.info.shipper && !app.personal.info.agent) &&
                    <Text />
                    ||
                    <TouchableOpacity
                        style={styles.itemView}>
                        <Text style={styles.itemKeyText}>所属{app.personal.info.shipper ? '物流公司' : '收货点'}</Text>
                        <View style={styles.rightView} >
                            <Text style={styles.itemValueText}>
                                {
                                    app.personal.info.shipper ?
                                    app.personal.info.shipper.name
                                    :
                                    app.personal.info.agent.name
                                }
                            </Text>
                        </View>
                    </TouchableOpacity>
                }
                {
                    (!app.personal.info.shipper && !app.personal.info.agent) &&
                    <Text />
                    ||
                    <TouchableOpacity
                        style={styles.itemView}>
                        <Text style={styles.itemKeyText}>职务</Text>
                        <View style={styles.rightView} >
                            <Text style={styles.itemValueText}>
                                {
                                    app.personal.info.shipper ?
                                    (app.personal.info.phone == app.personal.info.shipper.chairMan.phone ? '董事长' : '普通员工')
                                    :
                                    (app.personal.info.phone == app.personal.info.agent.chairMan.phone ? '董事长' : '普通员工')
                                }
                            </Text>
                        </View>
                    </TouchableOpacity>
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#F4F4F4',
        alignItems:'center',
    },
    headStyle: {
        width: sr.w,
        height:60,
        marginTop: 10,
    },
    head_itemView:{
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 60,
        marginBottom: 8,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    itemView: {
        marginTop:1,
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 42,
        width:sr.w,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    rightView: {
        flexDirection: 'row',
        height: 45,
        alignItems:'center',
    },
    headImgStyle: {
        height: 36,
        width: 36,
        borderRadius: 18,
        marginLeft: 20,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 20,
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
    itemValueText: {
        color: '#888888',
        fontSize: 14,
        marginRight: 10,
    },
    btnChangeRole:{
        position:'absolute',
        top:sr.h - 210,
        marginTop:15,
        height:45,
        width:sr.w - 25,
        borderRadius:2,
    },
});

```

* PDClient/project/App/modules/person/EditSex.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Text,
    StyleSheet,
    View,
    TouchableOpacity,
} = ReactNative;

const { Picker } = COMPONENTS;

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    getInitialState () {
        const info = app.personal.info;
        return {
            sex: info.sex === 0 ? '男' : '女',
            pickerData: ['男', '女'],
        };
    },
    goBack () {
        Picker.hide();
        app.pop();
    },
    toEditSex () {
        const { sex, pickerData } = this.state;
        Picker(pickerData, [sex], '选择性别').then((value) => {
            const sex = value[0];
            this.setState({ sex }, () => {
                this.modifyPersonalInfo();
            });
        });
    },
    modifyPersonalInfo () {
        const info = app.personal.info;
        const param = {
            userId: info.userId,
            sex: this.state.sex === '男' ? 0 : 1,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            const info = app.personal.info;
            info.sex = this.state.sex === '男' ? 0 : 1;
            app.personal.set(info);
            this.props.setSex(info.sex);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { sex } = this.state;
        return (
            <View style={styles.container}>
                <View style={[styles.separatorView, { marginTop: 30 }]} />
                <TouchableOpacity
                    onPress={this.toEditSex}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>{sex || '请选择您的性别'}</Text>
                </TouchableOpacity>
                <View style={styles.separatorView} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#EEEEEE',
    },
    itemView: {
        backgroundColor: 'white',
        height: 45,
        justifyContent: 'center',
        alignItems:'center',
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
});

```

* PDClient/project/App/modules/person/EditSingleInfo.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Text,
    StyleSheet,
    View,
    TextInput,
} = ReactNative;

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        rightButton: { title: '保存', handler: () => { app.scene.doSave(); } },
    },
    doSave () {
        const { placeholder, checkFun } = this.props;
        const info = app.personal.info;
        const { value } = this.state;
        if (!!checkFun && !checkFun(value)) {
            Toast('请填写正确的' + placeholder);
            return;
        }
        if (value.length == 0) {
            Toast(placeholder + '不能为空');
            return;
        }
        let param = {
            userId: info.userId,
        };
        param[this.keyName] = value;
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    getInitialState () {
        const info = app.personal.info;
        this.keyName = this.props.keyName;
        return {
            value: info[this.keyName] || '',
        };
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            const info = app.personal.info;
            info[this.keyName] = this.state.value;
            app.personal.set(info);
            this.props.updateSingleState(this.keyName, info[this.keyName]);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { value } = this.state;
        const { placeholder, maxLength } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.itemView}>
                    <Text style={styles.itemKeyText} />
                    <TextInput
                        ref={(ref) => { this.contentInput = ref; }}
                        style={styles.rightView}
                        onChangeText={(text) => this.setState({ value: text })}
                        multiline={false}
                        maxLength={maxLength}
                        placeholder={'请输入你的' + placeholder}
                        autoCapitalize={'none'}
                        underlineColorAndroid={'transparent'}
                        defaultValue={value}
                        />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#F4F4F4',
    },
    itemView: {
        marginTop:10,
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 42,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    rightView: {
        flex: 1,
        fontSize: 15,
        paddingVertical: 2,
        color: '#444444',
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
});

```

* PDClient/project/App/modules/person/Feedback.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Text,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '意见反馈',
    },
    getInitialState () {
        return {
            content:'',
            length:0,
        };
    },
    onContentTextChange (text) {
        this.setState({
            content:text,
            length:text.length,
        });
    },
    doSubmit () {
        if (!this.state.content) {
            Toast('请填写您需要反馈的内容');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            content: this.state.content,
        };
        POST(app.route.ROUTE_SUBMIT_FEEDBACK, param, this.doSubmitSuccess);
    },
    doSubmitSuccess (data) {
        if (data.success) {
            Toast('提交成功');
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const length = this.state.length;
        return (
            <View style={styles.container}>
                <Text style={styles.content_text}>
                    具体内容
                </Text>
                <TextInput style={styles.content_input}
                    underlineColorAndroid='transparent'
                    placeholderTextColor='#aaaaaa'
                    placeholder='请填入意见内容'
                    onChangeText={this.onContentTextChange}
                    multiline
                    maxLength={CONSTANTS.FEEDBACK_MAX_LENGTH}
                    />
                <Text style={styles.wordnumber_text}>
                    {length}/500
                </Text>
                <Button onPress={this.doSubmit}
                    style={styles.button}
                    textStyle={styles.btnLoginText}>
                    提交反馈
                    </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    content_text:{
        fontSize:14,
        height:40,
        width:351,
        color:'#666666',
        marginLeft:(sr.w - 351) / 2,
        paddingTop:18,
    },
    content_input:{
        fontSize:14,
        height:200,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor:'#FFFFFF',
        padding:3,
        textAlignVertical: 'top',
    },
    wordnumber_text:{
        fontSize:14,
        height:30,
        width:351,
        color:'#666666',
        marginLeft:(sr.w - 351) / 2,
        paddingTop:5,
        textAlign:'right',
    },
    button:{
        height:50,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor:'#f69934',
        borderRadius:4,
        marginTop:60,
    },
    btnLoginText:{
        fontSize:18,
        color:'#FFFFFF',
        fontWeight:'600',
    },
});

```

* PDClient/project/App/modules/person/GuaranteeAmount.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const AmountRule = require('./AmountRule');

module.exports = React.createClass({
    statics: {
        title: '担保金额',
    },
    getInitialState () {
        return {
            data:[],
        };
    },
    componentWillMount () {
        this.getBondAmountInfo();
    },
    getBondAmountInfo () {
        const param = {
            userId:app.personal.info.userId,
            shopId:app.personal.currentShopId,
        };
        POST(app.route.ROUTE_GET_BRANCH_SHOP_INFO, param, this.getBondAmountInfoSuccess, false);
    },
    getBondAmountInfoSuccess (data) {
        if (data.success) {
            this.setState({
                data:data.context,
            });
        } else {
            Toast(data.msg);
        }
    },
    toAmountRule () {
        app.push({
            component:AmountRule,
        });
    },
    render () {
        const { data } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.titleRow}>
                    <Text style={styles.titleAmount}>{data.remainBondAmount > 100000 ?
                            (app.utils.N(data.remainBondAmount / 10000)) + '万' : app.utils.N(data.remainBondAmount)}</Text>
                    <Text style={styles.titleFont}>可用担保金</Text>
                </View>
                <View style={styles.titleBottom}>
                    <Text style={styles.totalAmount}>总担保金：</Text>
                    <Text style={styles.totalAmount}>{data.totalBondAmount > 100000 ?
                            (app.utils.N(data.totalBondAmount / 10000)) + '万' : app.utils.N(data.totalBondAmount)}</Text>
                </View>
                <TouchableOpacity onPress={this.toAmountRule}>
                    <View style={styles.item}>
                        <Text style={styles.itemFont}>担保金规则</Text>
                        <Image source={app.img.common_go}
                            style={styles.imgGo}
                            resizeMode='cover' />
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    titleRow:{
        backgroundColor:'#c81622',
        height:77,
        alignItems:'center',
    },
    titleAmount:{
        color:'#ffffff',
        fontSize:30,
        fontWeight:'600',
        flex:1,
    },
    titleFont:{
        color:'#ffffff',
        fontSize:14,
        fontWeight:'500',
        flex:1,
        marginTop:10,
    },
    titleBottom:{
        backgroundColor:'#b21715',
        height:35,
        width:sr.w,
        flexDirection:'row',
        alignItems:'center',
    },
    totalAmount:{
        color:'#ffffff',
        fontSize:14,
        fontWeight:'500',
        marginLeft:10,
    },
    item:{
        height:42,
        backgroundColor:'#ffffff',
        justifyContent:'center',
    },
    imgGo:{
        width:15,
        height:15,
        position:'absolute',
        left:(sr.w - 30),
    },
    itemFont:{
        marginLeft:10,
        fontSize:14,
        fontWeight:'300',
    },
});

```

* PDClient/project/App/modules/person/GuaranteeDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '担保公司',
    },
    render () {
        const { obj } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}>担保公司</Text>
                    <Text style={styles.itemRight}>{obj.name}</Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}>担保金额</Text>
                    <Text style={styles.itemRight}>{obj.bondAmount > 100000 ?
                            (obj.bondAmount / 10000) + '万' : obj.bondAmount}</Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}>担保公司注册资金</Text>
                    <Text style={styles.itemRight}>{obj.capital > 100000 ?
                            (obj.capital / 10000) + '万' : obj.capital}</Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}>法人姓名</Text>
                    <Text style={styles.itemRight}>{obj.legalName}</Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}>法人电话</Text>
                    <Text style={styles.itemRight}>{obj.legalPhone}</Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}>担保公司电话</Text>
                    <Text style={styles.itemRight}>{obj.phoneList}</Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}>担保公司地址</Text>
                    <Text style={styles.itemRight}>{obj.address}</Text>
                </View>
                <View style={styles.itemImage}>
                    <Text style={styles.itemTitle}>担保公司图片资料</Text>
                    <View style={styles.images}>
                        {
                            obj.certificate.map((item, i) => (
                                <Image key={i}
                                    resizeMode='contain'
                                    style={styles.img}
                                    source={{ uri:item }} />
                            ))
                        }
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    item:{
        height:40,
        flexDirection:'row',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
        marginBottom:1,
    },
    itemLeft:{
        marginLeft:10,
        color:'#666666',
        flex:1,
    },
    itemRight:{
        width:200,
        textAlign:'right',
        marginRight:10,
    },
    itemImage:{
        height:155,
        backgroundColor:'#FFFFFF',
    },
    itemTitle:{
        marginLeft:10,
        marginTop:12,
        marginBottom:15.5,
        color:'#666666',
        fontSize:14,
    },
    images:{
        marginLeft:5,
        flexDirection:'row',
        width:sr.w - 5,
    },
    img:{
        flex:1,
        height:115,
        marginRight:5,
    },
});

```

* PDClient/project/App/modules/person/Help.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '软件许可协议',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri:app.route.ROUTE_SOFTWARE_LICENSE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDClient/project/App/modules/person/ImageCrop.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    ImageStore,
    ImageEditor,
} = ReactNative;

const ImageCrop = require('@remobile/react-native-image-crop');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '编辑头像',
        rightButton: { title: '完成', handler: () => {
            app.scene.cropImage();
        } },
    },
    goBack () {
        app.pop();
    },
    cropImage () {
        const { image } = this.props;
        const cropData = this.imageCrop.getCropData();
        ImageEditor.cropImage(
            image.uri,
            cropData,
            (croppedImageURI) => {
                this.uploadUserHead(croppedImageURI);
            },
            (error) => {
                Toast('文件出错');
                this.goBack();
            }
        );
    },
    uploadUserHead (filePath) {
        if (app.isandroid) {
            const options = {};
            options.fileKey = 'file';
            options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
            options.mimeType = 'image/png';
            options.params = {
                userId:app.personal.info.userId,
            };
            UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
        } else {
            ImageStore.getBase64ForTag(filePath, (data) => {
                data = 'data:image/png;base64,' + data;
                const options = {};
                options.fileKey = 'file';
                options.fileName = 'user_head.png';
                options.mimeType = 'image/png';
                options.params = {
                    userId:app.personal.info.userId,
                };
                ImageStore.removeImageForTag(filePath);
                UPLOAD(data, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
            }, () => {
                Toast('文件出错');
                this.goBack();
            });
        }
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            this.modifyPersonalInfo(data.context.url);
        } else {
            Toast('上传头像失败');
            this.goBack();
        }
    },
    uploadErrorCallback () {
        Toast('上传头像失败');
        this.goBack();
    },
    modifyPersonalInfo (url) {
        const info = app.personal.info;
        const param = {
            userId: info.userId,
            head: url,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess.bind(null, url), this.modifyUserInfoError, true);
    },
    modifyUserInfoSuccess (url, data) {
        if (data.success) {
            const info = app.personal.info;
            info.head = url;
            app.personal.set(info);
            this.props.onCropImage(url);
            this.goBack();
        } else {
            Toast(data.msg);
            this.goBack();
        }
    },
    modifyUserInfoError () {
        Toast('修改头像失败');
        this.goBack();
    },
    render () {
        const { image } = this.props;
        return (
            <View style={styles.container}>
                <ImageCrop
                    imageWidth={image.width}
                    imageHeight={image.height}
                    editRectRadius={0}
                    ref={(ref) => { this.imageCrop = ref; }}
                    source={{ uri: image.uri }} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
});

```

* PDClient/project/App/modules/person/ImagePicker.js

```js
const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
} = ReactNative;

const CameraRollPicker = require('@remobile/react-native-camera-roll-picker');
const Camera = require('@remobile/react-native-camera');
const ImageCrop = require('./ImageCrop');

module.exports = React.createClass({
    statics: {
        title: '选择头像',
    },
    cropImage (image) {
        app.navigator.replace({
            component: ImageCrop,
            passProps: {
                image,
                onCropImage: this.props.onCropImage,
            },
        });
    },
    onSelectedImages (images, image) {
        this.cropImage(image);
    },
    openCamera () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.cropImage({
                    uri,
                    width,
                    height,
                });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    render () {
        return (
            <CameraRollPicker selected={[]} onSelectedImages={this.onSelectedImages} openCamera={this.openCamera} maximum={1} />
        );
    },
});

```

* PDClient/project/App/modules/person/ModifyPassword.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
} = ReactNative;

const { Button, Label } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '修改密码',
    },
    getInitialState () {
        return {
            oldPassword: '',
            newPassword1: '',
            newPassword2: '',
        };
    },
    goBack () {
        app.pop();
    },
    doSubmit () {
        const { oldPassword, newPassword1, newPassword2 } = this.state;
        const { checkPassword } = app.utils;
        if (!checkPassword(oldPassword) || !checkPassword(newPassword1)) {
            Toast('密码必须有6-20位的数字，字母，下划线组成');
            return;
        }
        if (!oldPassword) {
            Toast('请填写旧密码');
            return;
        }
        if (!newPassword1) {
            Toast('请填写新密码');
            return;
        }
        if (!newPassword2) {
            Toast('请再次填写新密码');
            return;
        }
        if (newPassword2 !== newPassword1) {
            Toast('两次填写新密码不一致');
            return;
        }
        if (oldPassword === newPassword1) {
            Toast('新密码不能和原来密码一样');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            oldPassword,
            newPassword: newPassword1,
        };
        POST(app.route.ROUTE_MODIFY_PASSWORD, param, this.doSubmitSuccess, true);
    },
    doSubmitSuccess (data) {
        if (data.success) {
            Toast('修改成功');
            this.goBack();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <Label img={app.img.login_user}>请输入旧密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请输入旧密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ oldPassword: text })}
                    />
                <Label img={app.img.login_user}>请输入新密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请输入新密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ newPassword1: text })}
                    />
                <Label img={app.img.login_user}>请再次输入新密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请再次输入新密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ newPassword2: text })}
                    />
                <Button onPress={this.doSubmit} style={[styles.btnSubmit, { backgroundColor:app.setting.THEME_COLOR }]}>提交</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: 'white',
        paddingVertical: 20,
        paddingHorizontal: 25,
    },
    text_input: {
        height: 40,
        fontSize: 14,
        paddingLeft: 10,
        backgroundColor: 'white',
        textAlignVertical: 'top',
        borderWidth: 1,
        borderRadius: 5,
        marginBottom: 20,
        borderColor: '#DBDBDB',
    },
    btnSubmit: {
        width: sr.w - 50,
        marginTop: 80,
        height: 40,
        borderRadius: 10,
    },
});

```

* PDClient/project/App/modules/person/ModifyProfit.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const { SelectRegionAddress } = COMPONENTS;

const { Button } = COMPONENTS;

const ChangeType = {
    PRICE:0,
    PERCENT:1,
};

module.exports = React.createClass({
    statics: {
        title: '批量修改',
    },
    getInitialState () {
        return {
            price: '',
            change: ChangeType.PRICE,
        };
    },
    toChangePrice () {
        this.setState({
            change: ChangeType.PRICE,
            price: '',
        });
    },
    toChangePercent () {
        this.setState({
            change: ChangeType.PERCENT,
            price: '',
        });
    },
    doConfirmChange () {
        const { change, price } = this.state;
        const { roadmapId } = this.props;
        var profitRate = 0;
        var profitCount = 0;
        if (change == ChangeType.PERCENT) {
            profitRate = price;
        } else if (change == ChangeType.PRICE) {
            profitCount = price;
        }
        const param = {
            userId: app.personal.info.userId,
            profitRate,
            profitCount,
            regionIdList: roadmapId,
        };
        POST(app.route.ROUTE_SET_REGION_PROFIT_WITH_LIST, param, this.setRegionProfitWithListSuccess, false);
    },
    setRegionProfitWithListSuccess (data) {
        if (data.success) {
            Toast('修改成功');
            app.pop();
            this.props.refreshList();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { change, price } = this.state;
        const { roadmapId } = this.props;
        console.log('432143124', roadmapId);
        return (
            <View style={styles.container}>
                <View style={styles.priceChange}>
                    <TouchableOpacity onPress={this.toChangePrice}
                        style={[styles.itemChange, change == 0 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 0 ? { color:'#FFFFFF' } : {}]}>按价格调整</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.toChangePercent}
                        style={[styles.itemChange, change == 1 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 1 ? { color:'#FFFFFF' } : {}]}>按百分比调整</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.priceNumber}>
                    {
                        (change == 1 || change == 0) ?
                            <View onPress={this.toAdd} style={styles.priceAdd} >
                                <Image style={styles.chooseImage}
                                    source={app.img.order_choose} />
                                <Text style={styles.priceAddText} >上调</Text>
                            </View>
                        :
                            <View />
                    }
                    {
                        change == 0 ?
                            <View style={styles.priceInput}>
                                <TextInput
                                    onChangeText={(text) => this.setState({ price: text })}
                                    multiline={false}
                                    style={styles.bottomRight}
                                    placeholder={'请输入需要提高的价格'}
                                    autoCapitalize={'none'}
                                    underlineColorAndroid={'transparent'}
                                    defaultValue={price + ''}
                                />
                                <Text style={styles.bottomRightText}>元</Text>
                            </View>
                        :
                        change == 1 ?
                            <View style={styles.priceInput}>
                                <TextInput
                                    onChangeText={(text) => this.setState({ price: text })}
                                    multiline={false}
                                    style={styles.bottomRight}
                                    placeholder={'请输入需要提高的百分比'}
                                    autoCapitalize={'none'}
                                    underlineColorAndroid={'transparent'}
                                    defaultValue={price + ''}
                                />
                                <Text style={styles.bottomRightText}>%</Text>
                            </View>
                        :
                            <View />
                    }
                </View>
                <Button onPress={this.doConfirmChange}
                    style={styles.btnConfirmChange}
                    textStyle={styles.btnConfirmChangeText}>
                    确认
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#F4F4F4',
        paddingTop:8,
    },
    aspect:{
        marginTop:5,
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 42,
        width:sr.w,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    aspectText:{
        color: '#888888',
        fontSize: 14,
        marginLeft: 10,
    },
    rightView: {
        flexDirection: 'row',
        height: 45,
        alignItems:'center',
    },
    itemValueText: {
        color: '#888888',
        fontSize: 14,
        marginRight: 10,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 10,
    },
    priceChange:{
        height:45,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'space-around',
        marginTop:2,
    },
    itemChange:{
        height:20,
        width:100,
        backgroundColor:'#f3f3f3',
    },
    changeText:{
        fontSize:12,
        color:'#333333',
        textAlign:'center',
        height:20,
        lineHeight:18,
    },
    priceNumber:{
        height:40,
        backgroundColor:'#FFFFFF',
        marginTop:2,
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    bottomLeft:{
        flexDirection: 'row',
        alignItems:'center',
        height:40,
    },
    priceAdd:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:10,
    },
    chooseImage:{
        height:9,
        width:9,
    },
    priceAddText:{
        fontSize:14,
        color:'#333333',
        marginLeft:5,
    },
    priceSub:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:20,
    },
    priceInput:{
        flexDirection: 'row',
        alignItems:'center',
    },
    bottomRight:{
        height:40,
        width:sr.w / 2,
        fontSize:12,
        color: '#444444',
        textAlign:'right',
    },
    bottomRightText:{
        fontSize:13,
        color:'#333333',
        marginRight:15,
        marginLeft:3,
    },
    btnConfirmChange:{
        height:40,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        marginTop:250,
        borderRadius:4,
    },
    btnConfirmChangeText:{
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/person/ModifyShop.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
    RefreshControl,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '修改参考分店',
        rightButton: { title:'保存', handler: () => { app.scene.doSave(); } },
    },
    doSave () {
        const { shop } = this.state;
        const param = {
            userId: app.personal.info.userId,
            shopId: shop.id,
        };
        POST(app.route.ROUTE_SET_REFER_SHOP, param, this.setReferShopSuccess, false);
    },
    setReferShopSuccess (data) {
        const { shop } = this.state;
        if (data.success) {
            app.personal.info.agent.referShop = shop;
            Toast('修改成功');
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    componentWillMount () {
        this.getShopList();
    },
    getShopList () {
        const param = { userId: app.personal.info.userId };
        POST(app.route.ROUTE_GET_REFER_SHOP_LIST, param, this.getReferShopListSuccess, false);
    },
    getReferShopListSuccess (data) {
        if (data.success) {
            this.setState({
                list: data.context.branchShopList || {},
            });
        } else {
            Toast(data.msg);
        }
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list:{},
            shop: app.personal.info.agent.referShop ? app.personal.info.agent.referShop : '',
        };
    },
    doChoose (obj) {
        this.setState({
            shop: obj,
        });
    },
    renderRow (obj, sectionID, rowId) {
        const { shop } = this.state;
        return (
            <TouchableOpacity style={styles.item}
                onPress={this.doChoose.bind(null, obj)}>
                <View style={styles.itemContainer}>
                    <Text style={styles.itemText}>{obj.name}</Text>
                    <Image style={styles.choose}
                        source={shop.id == obj.id ? app.img.common_radio : {}} />
                </View>
            </TouchableOpacity>
        );
    },
    onScroll () {
        this.getShopList();
    },
    render () {
        const { list, shop } = this.state;
        return (
            <View style={styles.container}>
                <ListView
                    dataSource={this.ds.cloneWithRows(list)}
                    renderRow={this.renderRow}
                    enableEmptySections
                    refreshControl={
                        <RefreshControl
                            refreshing={false}
                            onRefresh={this.onScroll}
                            title='下拉刷新...' />
                    }
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    item:{
        marginTop:1,
    },
    itemContainer:{
        height:45,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-between',
        alignItems:'center',
    },
    itemText:{
        fontSize:14,
        color:'#333333',
        marginLeft:15,
    },
    choose:{
        height:10,
        width:10,
        marginRight:15,
    },
});

```

* PDClient/project/App/modules/person/NormalQuestions.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '常见问题',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_ABOUT_PAGE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDClient/project/App/modules/person/PayPasswordSetting.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const DigitalKeyboard = require('../common/DigitalKeyboard');
const ConfirmPayPassword = require('./ConfirmPayPassword');

const list = [1, 2, 3, 4, 5, 6, 7, 8, 9];

module.exports = React.createClass({
    statics: {
        title: '支付密码设置',

    },
    getInitialState () {
        return {
            password: '',
        };
    },
    passwordItem (item) {
        const { password } = this.state;
        this.setState({ password: password + item });
    },
    zero () {
        const { password } = this.state;
        this.setState({ password: password + 0 });
    },
    delete () {
        const { password } = this.state;
        this.setState({
            password: _.dropRight(password).join(''),
        });
    },
    confirm () {
        const { password, type } = this.state;
        const tmp = password.substring(0, 6);
        if (tmp.length == 6) {
            this.toNext(tmp);
        } else {
            Toast('请输入6位的支付密码');
            this.toClear();
        }
    },
    toNext (tmp) {
        app.push({
            component: ConfirmPayPassword,
            passProps:{
                number: tmp,
                toClear: this.toClear,
                verifyCode : this.props.verifyCode,
            },
        });
    },
    toClear () {
        this.setState({
            password: '',
        });
    },
    render () {
        const max = [1, 2, 3, 4, 5, 6];
        const { password, type } = this.state;
        return (
            <View style={styles.container}>
                <Text style={styles.text}>该六位号码将作为手机支付密码</Text>
                <View style={styles.password}>
                    {
                        max.map((item, i) => (
                            <View style={i == 0 ? styles.itemStart : styles.item} key={i}>
                                { password.length >= (i + 1) ?
                                    <View style={styles.point} />
                                    :
                                    <View style={styles.noPoint} />
                                }
                            </View>
                        ))
                    }
                </View>
                <View style={styles.digitalKeyboard} />
                <View>
                    <DigitalKeyboard list={list}
                        passwordItem={this.passwordItem}
                        zero={this.zero}
                        delete={this.delete}
                        confirm={this.confirm} />
                </View>
            </View>
        );
    },
});
const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },

    text:{
        fontSize:14,
        textAlign:'center',
        color:'#333333',
        marginTop:30,
    },
    password:{
        height:40,
        width:330,
        backgroundColor:'#ffffff',
        flexDirection:'row',
        marginTop:15,
        marginLeft:(sr.w - 330) / 2,
        borderWidth:1,
        borderColor:'#EDEDED',
        borderRadius:4,
    },
    itemStart:{
        height:40,
        width:55,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    item:{
        height:40,
        width:55,
        borderLeftWidth:1,
        borderColor:'#EDEDED',
        justifyContent:'center',
        alignItems:'center',
    },
    point:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#000000',
    },
    noPoint:{
        height:10,
        width:10,
        borderRadius:5,
        backgroundColor:'#FFFFFF',
    },
    digitalKeyboard:{
        flex:1,
    },
});

```

* PDClient/project/App/modules/person/Permission.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    Text,
    ListView,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

module.exports = React.createClass({
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {};
    },
    doSelect (obj) {
        this.props.setSelect(obj);
    },
    renderRow (obj, sectionID, rowID) {
        const { employeeAuthority } = this.props;
        return (
            obj.length > 11 ?
                <View style={styles.longItem}>
                    <TouchableOpacity onPress={this.doSelect.bind(null, obj)}
                        style={styles.press}>
                        <Image source={_.find(employeeAuthority, o => { return o == obj.o; }) != undefined ?
                                app.img.order_choose_r : app.img.order_no_choose_r}
                            style={styles.imgChoose} />
                        <Text style={styles.itemFont}>{AH.MAP[obj.o]}</Text>
                    </TouchableOpacity>
                </View>
                :
                <View style={styles.item}>
                    <TouchableOpacity onPress={this.doSelect.bind(null, obj)}
                        style={styles.press}>
                        <Image source={_.find(employeeAuthority, o => { return o == obj.o; }) != undefined ?
                                    app.img.order_choose_r : app.img.order_no_choose_r}
                            style={styles.imgChoose} />
                        <Text style={styles.itemFont}>{AH.MAP[obj.o]}</Text>
                    </TouchableOpacity>
                </View>
        );
    },
    render () {
        const { list, title } = this.props;
        return (
            <View style={styles.container}>
                {
                        list.length > 0 &&
                        <Text style={styles.head}>{title}</Text>
                    }
                <ListView
                    dataSource={this.ds.cloneWithRows(list)}
                    contentContainerStyle={styles.listStyle}
                    renderRow={this.renderRow} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    listStyle:{
        flexDirection:'row', // 改变ListView的主轴方向
        flexWrap:'wrap', // 换行
        width:sr.w,
    },
    item:{
        width:sr.w / 2,
        height:25,
        paddingLeft:10,
    },
    longItem:{
        width:sr.w,
        height:25,
        paddingLeft:10,
    },
    press:{
        flexDirection:'row',
        alignItems:'center',
        height:16,
    },
    imgChoose:{
        width:14,
        height:14,
    },
    itemFont:{
        marginLeft:10,
        fontSize:14,
        color:'#333333',
        fontWeight:'300',
    },
    head:{
        color:'#333333',
        fontSize:14,
        fontWeight:'500',
        marginLeft:9,
        marginTop:10,
        marginBottom:12,
    },
});

```

* PDClient/project/App/modules/person/PermissionSetting.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ScrollView,
} = ReactNative;

import _ from 'lodash';

const Permission = require('./Permission');

module.exports = React.createClass({
    statics: {
        title: '权限设置',
        rightButton : { title: '确认', handler: () => { app.scene.confirm(); } },
    },
    getInitialState () {
        return {
            list:this.props.employeeInfo && this.props.employeeInfo.authority || this.props.authority || [],
        };
    },
    confirm () {
        const { employeeInfo, isCreate } = this.props;
        const { list } = this.state;
        if (isCreate) {
            app.pop();
            this.props.backAuthority(list);
        } else {
            const param = {
                userId: app.personal.info.userId,
                memberId : employeeInfo.id,
                authority: list,
            };
            if (app.personal.info.shipper) {
                POST(app.route.ROUTE_MODIFY_MEMBER_AUTHORITY, param, this.modifyMemberAuthoritySuccess, true);
            } else if (app.personal.info.agent) {
                POST(app.route.ROUTE_MODIFY_MEMBER_AUTHORITY_AGENT, param, this.modifyMemberAuthoritySuccess, true);
            }
        }
    },
    modifyMemberAuthoritySuccess (data) {
        if (data.success) {
            Toast('修改成功');
            app.pop();
            this.props.refresh();
        } else {
            Toast(data.msg);
        }
    },
    setSelect (obj) {
        const { list } = this.state;
        _.find(list, o => { return obj.o == o; }) != undefined ? _.remove(list, o => { return obj.o == o; }) : list.push(parseInt(obj.o));
        this.setState({ list });
    },
    render () {
        const { selfAuthority, employeeInfo, isCreate } = this.props;
        const { list } = this.state;
        return (
            <View style={styles.container}>
                {
                    !isCreate &&
                    <View style={styles.top}>
                        <Text style={styles.name}>姓名：{employeeInfo.name || '无'}</Text>
                        <Text style={styles.topFont}>职务：{employeeInfo.post || '普通员工'}</Text>
                        <Text style={styles.topFont}>已有权限：{list.length}项</Text>
                    </View>
                }
                <Text style={styles.title}>选择权限</Text>
                <ScrollView style={styles.jurisdiction}>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 0 && o < 10000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'总店权限'} />
                    </View>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 10000 && o < 20000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'公共权限'} />
                    </View>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 20000 && o < 30000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'分店权限'} />
                    </View>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 30000 && o < 40000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'物流公司'} />
                    </View>
                    <View>
                        <Permission list={_.filter(_.map(selfAuthority, (o) => { if (o >= 40000 && o < 50000) return { o }; }), undefined)}
                            employeeAuthority={list} setSelect={this.setSelect} title={'收货点'} />
                    </View>
                </ScrollView>

            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    top:{
        backgroundColor:'#FFFFFF',
        height:80,
    },
    name:{
        fontSize:14,
        marginLeft:10,
        marginTop:5,
        flex:1,
    },
    topFont:{
        fontSize:12,
        marginLeft:10,
        color:'#333333',
        flex:1,
    },
    title:{
        color:'#666666',
        height:35,
        lineHeight:35,
        paddingLeft:10,
        textAlignVertical:'center',
    },
    jurisdiction:{
        flex:1,
        backgroundColor:'#FFFFFF',
    },
});

```

* PDClient/project/App/modules/person/Recharge.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    TextInput,
} = ReactNative;

const { Button, MessageBox } = COMPONENTS;
const BankCardList = require('./SelectBankCardList');

module.exports = React.createClass({
    statics: {
        title: '充值',
    },
    getInitialState () {
        return {
            bankCard:'请选择银行卡',
            amount:'',
            type:'',
            selectedRowID:'',
        };
    },
    showBankCardList () {
        const { selectedRowID } = this.state;
        app.push({
            component:BankCardList,
            passProps: {
                setBankCard: this.setCardInfo,
                selectedRowID,
            },
        });
    },
    doRecharge () {
        const { amount } = this.state;
        if (!app.utils.checkInt2PointNum(amount)) {
            Toast('请输入数字且小数点后最多2位');
            return;
        }
        if (amount > 9999999) {
            Toast('单笔金额不能超过9999999');
            return;
        }
        app.wxpay.doPay(amount, '充值', (data) => {
            if (data.success) {
                app.personal.setRemainAmount(app.personal.remainAmount + amount * 1);
                this.props.setRemainAmount(app.personal.remainAmount);
                app.pop();
                app.showModal(
                    <MessageBox
                        onConfirm={this.doConfirmDelete}
                        content={'成功充值' + amount + '元'}
                        width={sr.s(250)} />
                );
            }
        }, (data) => {
            Toast(data.errStr);
        });
        // app.push({
        //     component:PayPassword,
        //     passProps:{
        //         param,
        //         routeName:app.route.ROUTE_RECHARGE,
        //         amount,
        //         prompt : '充值成功',
        //     },
        // });
    },
    setCardInfo (cardName, selectedRowID) {
        this.setState({
            bankCard:cardName,
            selectedRowID,
        });
    },
    render () {
        const { amount } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.row}>
                    <Text style={styles.titleText}>金额</Text>
                    <TextInput
                        underlineColorAndroid='transparent'
                        keyboardType='numeric'
                        defaultValue={amount}
                        onChangeText={(text) => {
                            this.setState({ amount: text });
                            if (text > 9999999) {
                                Toast('单笔金额不能超过9999999');
                            }
                        }
                        }
                        style={styles.ItemBgText} />
                </View>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showBankCardList}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{this.state.bankCard}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <Button onPress={this.doRecharge} style={styles.btnRecharge} textStyle={styles.btnRechargeText} >
                    充值
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 10,
    },
    ItemBg: {
        paddingLeft:10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    row:{
        flexDirection:'row',
        alignItems:'center',
        height:44,
        backgroundColor:'#ffffff',
    },
    titleText:{
        marginLeft:8,
        fontSize:15,
        color:'#888888',
    },
    ItemBgText: {
        padding:0,
        flexDirection: 'row',
        alignItems: 'center',
        textAlign:'right',
        fontSize: 15,
        flex:1,
        marginRight:10,
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',

    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    btnRecharge:{
        marginTop:215,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
        backgroundColor:'#c81622',
    },
    btnRechargeText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDClient/project/App/modules/person/RegionProfitDetail.js

```js

```

* PDClient/project/App/modules/person/RegionProfitList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, MessageBox, PageList } = COMPONENTS;
const ModifyProfit = require('./ModifyProfit');
const RoadmapSetting = require('./RoadmapSetting');

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入路线终点查询路线'
                    defaultValue={searchText}
                    underlineColorAndroid='transparent'
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
    },
    onWillFocus () {
        app.getCurrentRoute().title = (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />);
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    getInitialState () {
        const agent = app.personal.info.agent;
        return {
            userId:app.personal.info.userId,
            keyword: '',
            dataList: [],
            list:[],
            roadmapId:[],
            shopId: agent.referShop ? agent.referShop.id : '',
        };
    },
    doStartSearch () {
        this.setState({
            keyword:searchText,
        });
    },
    // showRoadmapMarket (endPoint) {
    //     app.push({
    //         component: RoadmapMarketResult,
    //         passProps:{
    //             endPoint,
    //         },
    //     });
    // },
    showRoadmapDetail (obj) {
        app.push({
            component:RoadmapSetting,
            passProps:{
                obj:obj,
                isModify: true,
                refreshList: this.refreshList,
            },
        });
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    doChoose (obj, rowId) {
        const { list } = this.state;
        list[rowId].selected = !list[rowId].selected;
        this.setState({
            list,
        });
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({
            list,
        });
    },
    toModifyProfit () {
        const { list, userId, roadmapId } = this.state;
        list.forEach((item, i) => {
            item.selected == true && roadmapId.push(item.item.id);
        });
        if (roadmapId.length == 0) {
            Toast('请选择需要调价的路线');
            return;
        }
        app.push({
            component: ModifyProfit,
            passProps: {
                userId,
                roadmapId: _.uniq(roadmapId),
                refreshList: this.refreshList,
            },
        });
    },
    toDeleteRoadmap () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == false)) {
            Toast('请选择需要删除的路线');
        } else {
            app.showModal(
                <MessageBox
                    onConfirm={this.doConfirmDelete}
                    content={'是否确定删除所选路线'}
                    onCancel title={false}
                    width={sr.s(250)} />
            );
        }
    },
    delete (id) {
        const param = {
            userId: app.personal.info.userId,
            regionId: id,
        };
        let roadmapId = id;
        POST(app.route.ROUTE_REMOVE_REGION_PROFIT, param, this.doConfirmDeleteSuccess.bind(null, roadmapId), false);
    },
    doConfirmDelete () {
        const { list } = this.state;
        list.forEach((item, i) => {
            item.selected == true && this.delete(item.item.id);
        });
    },
    doConfirmDeleteSuccess (roadmapId, data) {
        if (data.success) {
            var list = this.listView.list;
            _.remove(list, function (o) {
                return o.id == roadmapId;
            });
            Toast('路线删除成功');
            this.setState({
                list:[],
            });
        } else {
            Toast('路线删除失败');
        }
    },
    toAddRoadmap () {
        if (!app.personal.info.agent.referShop) {
            Toast('请先设置参考分店');
            return;
        }
        app.push({
            component:RoadmapSetting,
            passProps:{
                refreshList:this.refreshList,
                isModify: false,
            },
        });
    },
    refreshList () {
        this.listView.refresh();
        this.setState({
            list:[],
        });
    },
    renderRow (obj, rowId) {
        const { list } = this.state;
        if (!_.find(list, (o) => o.index == rowId)) {
            list.push({ selected: false, index: rowId, item: obj });
        }
        return (
            <View style={styles.row}>
                <TouchableOpacity onPress={this.doChoose.bind(null, obj, rowId)}>
                    <Image
                        resizeMode='cover'
                        style={styles.imgChoose}
                        source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose} />
                </TouchableOpacity>
                <TouchableOpacity style={styles.point} onPress={this.showRoadmapDetail.bind(null, obj)}>
                    <View style={styles.piontContainer}>
                        <Text style={styles.pointFont} numberOfLines={1}>{obj.shop ? obj.shop.name : ''}</Text>
                    </View>
                    <Image resizeMode='contain'
                        source={app.img.cargo_point}
                        style={styles.imgLine} />
                    <View style={styles.endPiontContainer}>
                        <Text style={styles.pointFont} numberOfLines={1}>{obj.regionLastCode == 0 ? '全部' : obj.region}</Text>
                    </View>
                    <View style={styles.profitContainer}>
                        <Text style={styles.pointFont} numberOfLines={1}>{obj.profitRate ? obj.profitRate : obj.profitCount }{ obj.profitRate ? '%' : '元'}</Text>
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        const { list, keyword, shopId, userId } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        return (
            <View style={styles.container}>
                <View style={styles.top}>
                    <Button style={styles.btnAddRoadmap}
                        textStyle={styles.btnReleaseFont}
                        onPress={this.toAddRoadmap}>
                        设置路线利润
                    </Button>
                </View>
                <View style={styles.listView} />
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'regionRateList'}
                    renderSeparator={null}
                    listParam={{ userId, shopId, keyword }}
                    listUrl={app.route.ROUTE_GET_REGION_PROFIT_LIST}
                    refreshEnable
                    />
                <View style={styles.bottom}>
                    <TouchableOpacity style={styles.chooseAll} onPress={this.doSelectedAll}>
                        <Image
                            resizeMode='cover'
                            style={styles.imgChoose}
                            source={status ? app.img.order_choose : app.img.order_no_choose} />
                        <Text style={styles.chooseAllFont}>全选</Text>
                    </TouchableOpacity>
                    <Button onPress={this.toDeleteRoadmap}
                        style={styles.btnDelete}
                        textStyle={styles.btnDeleteFont}>删除</Button>
                    <Button onPress={this.toModifyProfit}
                        style={styles.btnModifyPrice}
                        textStyle={styles.btnModifyPriceFont}>调价</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    searchContainer: {
        height: 30,
        width: sr.w - 125,
        marginLeft:sr.w - 300,
        paddingVertical: 2,
        borderRadius: 4,
        backgroundColor: '#FFFFFF',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        padding:0,
        height: 25,
        width: sr.w - 155,
        fontSize: 14,
        marginLeft: 5,
    },
    iconSearch: {
        height: 15,
        width: 15,
        marginLeft:5,
    },
    top:{
        height:80,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    btnAddRoadmap:{
        width:150,
        height:35,
        borderRadius:4,
        backgroundColor:'#fe9917',
    },
    btnReleaseFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    listView:{
        marginTop:8,
    },
    row:{
        height:42,
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        marginBottom:1,
    },
    imgChoose:{
        marginLeft:10,
        width:13,
        height:13,
    },
    imgLine:{
        marginLeft:10,
        width:35,
    },
    piontContainer:{
        marginLeft:10,
        width:90,
        justifyContent:'center',
    },
    endPiontContainer:{
        marginLeft:10,
        width:120,
        justifyContent:'center',
    },
    profitContainer:{
        marginLeft:10,
        width:60,
        justifyContent:'center',
    },
    pointFont:{
        fontSize:14,
        alignSelf:'center',
    },
    btnRoadmapShipper:{
        width:65,
        height:20,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f01725',
        position:'absolute',
        right:(sr.w - 350) / 2,
    },
    btnShipperFont:{
        color:'#f01725',
        fontSize:12,
    },
    bottom:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
    },
    btnDelete:{
        width:60,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#aaaaaa',
        marginLeft:(sr.w - 200),
    },
    btnDeleteFont:{
        color:'#343434',
        fontSize:13,
        fontWeight:'400',
    },
    btnModifyPrice:{
        width:60,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f21620',
        marginLeft:15,
    },
    btnModifyPriceFont:{
        color:'#f21620',
        fontSize:13,
        fontWeight:'400',
    },
    chooseAllFont:{
        fontSize:14,
        marginLeft:10,
    },
    chooseAll:{
        alignItems:'center',
        flexDirection:'row',
    },
    point:{
        flex:1,
        flexDirection:'row',
    },
});

```

* PDClient/project/App/modules/person/RoadmapSetting.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const Roadmap = require('../common/Roadmap');

module.exports = React.createClass({
    statics: {
        title: '路线设置',
    },
    getInitialState () {
        const { obj } = this.props;
        return {
            tabIndex: obj ? obj.type : 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const { obj, isModify } = this.props;
        const { tabIndex } = this.state;
        const menus = [{ name:'所有路线', type: 0 }, { name:'长途路线', type: 1 }, { name:'短途路线', type: 2 }];
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item.name}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <Roadmap
                            refreshList={this.props.refreshList}
                            key={i}
                            index={i}
                            type={item.type}
                            obj={obj || {}}
                            isModify={isModify}
                            tabIndex={tabIndex}
                            />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    }, tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/person/SelectBankCardList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '银行卡',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        const { bankCard, selectedRowID } = this.state;
        this.props.setBankCard(bankCard, selectedRowID);
        app.pop();
    },
    getInitialState () {
        const { selectedRowID } = this.props;
        return {
            selectedRowID,
            bankCard:'农业银行',
        };
    },
    toChoose (obj, rowID) {
        this.setState({
            selectedRowID:rowID,
        });
    },
    renderRow (obj, rowID) {
        const { selectedRowID } = this.state;
        return (
            <View style={styles.container} >
                <TouchableOpacity onPress={this.toChoose.bind(null, obj, rowID)}>
                    <View style={styles.item}>
                        <Text style={styles.nameText}>
                            {this.state.bankCard}
                        </Text>
                        {
                            (rowID == selectedRowID) &&
                            <Image
                                resizeMode='stretch'
                                source={app.img.common_radio}
                                style={styles.icon_go} />
                        }

                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'clientList'}
                    listUrl={app.route.ROUTE_GET_CLIENT_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    item:{
        height:42,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    nameText:{
        paddingLeft:8,
        color:'#333333',
        fontSize:14,
    },
    icon_go: {
        width: 10,
        height: 10,
        marginRight: 12,
    },
});

```

* PDClient/project/App/modules/person/SelectEmployees.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    Text,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;
const PermissionSetting = require('./PermissionSetting');
const addEmployee = require('./addEmployee');

module.exports = React.createClass({
    statics: {
        title: '选择员工',
        rightButton : { title: '添加员工', handler: () => { app.scene.addEmployee(); } },
    },
    addEmployee () {
        app.push({
            component:addEmployee,
            passProps:{
                refresh:this.refresh,
            },
        });
    },
    showPermissionSetting (obj) {
        app.push({
            component:PermissionSetting,
            passProps:{
                employeeInfo:obj,
                selfAuthority:app.personal.info.authority,
                refresh: this.refresh,
            },
        });
    },
    refresh () {
        this.listView.refresh();
    },
    renderRow (obj, rowId) {
        var info = {};
        if (app.personal.info.shipper) {
            info = app.personal.info.shipper;
        } else {
            info = app.personal.info.agent;
        }
        if (obj.id == app.personal.info.userId) {
            return null;
        } else {
            return (
                <TouchableOpacity onPress={
                        info.chairMan.id == obj.id ? null :
                        this.showPermissionSetting.bind(null, obj)}>
                    <View style={styles.item}>
                        <Text style={styles.itemFont}>{obj.name ? obj.name : obj.phone}</Text>
                        <Text style={styles.itemNum}>{obj.authority.length}项</Text>
                        <Image resizeMode='contain' source={app.img.common_go} style={styles.itemImg} />
                    </View>
                </TouchableOpacity>
            );
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId }}
                    listName={'memberList'}
                    renderSeparator={null}
                    listUrl={app.personal.info.agent ? app.route.ROUTE_GET_MEMBER_LIST_AGENT : app.route.ROUTE_GET_MEMBER_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    item:{
        height:42,
        marginTop:1,
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
    },
    itemFont:{
        marginLeft:10,
        fontWeight:'300',
        flex:1,
    },
    itemNum:{
        fontWeight:'300',
        marginRight:10,
    },
    itemImg:{
        width:20,
        height:20,
    },
});

```

* PDClient/project/App/modules/person/Software.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '软件许可协议',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_SOFTWARE_LICENSE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDClient/project/App/modules/person/VerificationCode.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Text,
    Keyboard,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const PayPasswordSetting = require('./PayPasswordSetting');
const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '获取验证码',
    },
    getInitialState () {
        return {
            readSecond:false,
            time:59,
            verifyCode:'',
            button: false,
        };
    },
    doPress () {
        const param = {
            phone: app.personal.info.phone,
        };
        POST(app.route.ROUTE_REQUEST_SEND_VERIFY_CODE, param, this.requestSendVerifyCodeSuccess, false);
    },
    timer () {
        this.setState({ readSecond:true });
        this.setTimeout(
            () => {
                this.setState({ time:(this.state.time - 1) });
                if (this.state.time <= 0) {
                    return this.setState({ readSecond:false, time:59 });
                }
                this.timer();
            },
            1000
        );
    },
    requestSendVerifyCodeSuccess (data) {
        if (data.success) {
            this.timer();
        } else {
            Toast(data.msg);
        }
    },
    doNext () {
        const { verifyCode } = this.state;
        if (!verifyCode) {
            Toast('请填写验证码');
            return;
        }
        if (!app.utils.checkVerificationCode(verifyCode)) {
            Toast('请填写正确的验证码');
            return;
        }
        app.push({
            component:PayPasswordSetting,
            passProps:{
                verifyCode,
            },
        });
        Keyboard.dismiss();
    },
    render () {
        const { readSecond } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请填写验证码'
                            keyboardType='numeric'
                            maxLength={6}
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ verifyCode: text })}
                            style={styles.itemNameText} />
                        <TouchableOpacity
                            disabled={readSecond}
                            onPress={this.doPress}
                            style={styles.btnBind}>
                            { !readSecond ?
                                <View style={styles.btnContainer}>
                                    <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>获取验证码</Text>
                                </View>
                                :
                                <View style={styles.btnContainerGray}>
                                    <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>{this.state.time}s后重新发送</Text>
                                </View>
                            }
                        </TouchableOpacity>
                    </View>
                </View>
                <Button onPress={this.doNext}
                    style={styles.btnNext}
                    textStyle={styles.btnNextText} >
                    下一步
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBgTop: {
        height: 45,
        marginTop:10,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    ItemBg: {
        height: 45,
        marginTop:1,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent: 'space-between',
    },
    icon_add:{
        width:25,
        height:25,
        marginLeft: 8,
    },
    itemNameText: {
        flex:1,
        fontSize: 14,
        color: '#444444',
        marginLeft: 10,
    },

    btnNext:{
        marginTop:50,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnNextText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
    btnBind:{
        height:45,
        width:137,
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        alignItems:'center',
    },
    btnContainer:{
        height:45,
        alignItems:'center',
        justifyContent:'center',
        width:137,
    },
    btnBindText:{
        color:'#FF981A',
        fontSize:14,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
    },
    btnContainerGray:{
        height:45,
        width:137,
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#fafafa',
    },
    btnBindTextGray:{
        color:'#999999',
        backgroundColor:'#fafafa',
        fontSize:14,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
    },
});

```

* PDClient/project/App/modules/person/WithdrawCash.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    TextInput,
} = ReactNative;

const { Button } = COMPONENTS;
const BankCardList = require('./SelectBankCardList');
const PayPassword = require('../common/PayPassword');

module.exports = React.createClass({
    statics: {
        title: '提现',
    },
    showBankCardList () {
        const { selectedRowID } = this.state;
        app.push({
            component:BankCardList,
            passProps: {
                setBankCard: this.setCardInfo,
                selectedRowID,
            },
        });
    },
    getInitialState () {
        return {
            bankName: '请选择银行卡',
            money:'',
            selectedRowID:'',
        };
    },
    doWithdraw () {
        const { money } = this.state;
        if (!app.utils.checkInt2PointNum(money)) {
            Toast('请输入数字且小数点后最多2位');
            return;
        }
        if (money > 9999999) {
            Toast('单笔金额不能超过9999999');
            return;
        }
        if (money == 0) {
            Toast('提现金额必须大于0元');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            amount:money,
            thirdpartyAccount:'N1231242311',
        };
        app.push({
            component:PayPassword,
            passProps:{
                param,
                routeName:app.route.ROUTE_WITHDRAW,
                setRemainAmount : this.props.setRemainAmount,
                money,
                prompt : '提现成功',
            },
        });
    },
    setCardInfo (cardName, selectedRowID) {
        this.setState({
            bankName:cardName,
            selectedRowID,
        });
    },
    WithdrawalsAllMoney () {
        this.setState({
            money:app.personal.remainAmount + '',
        });
    },
    render () {
        const { money } = this.state;
        return (
            <View style={styles.container}>
                <Text style={styles.drawCashTitle}>
                    提现金额
                </Text>
                <View style={styles.drawCash}>
                    <Text style={styles.drawCashLeft}>
                        ￥
                    </Text>
                    <TextInput
                        keyboardType='numeric'
                        underlineColorAndroid='transparent'
                        placeholderTextColor='#888888'
                        placeholder='请输入提现金额'
                        defaultValue={money}
                        onChangeText={(text) => {
                            this.setState({ money: text });
                            if (text > 9999999) {
                                Toast('单笔金额不能超过9999999');
                            }
                        }
                        }
                        style={styles.drawCashContent} />
                </View>
                <View style={styles.balance}>
                    <View style={styles.balanceLeft}>
                        <Text style={styles.balanceTextLeft}>
                            账户余额：
                        </Text>
                        <Text style={styles.balanceTextRight}>
                            {app.personal.remainAmount}元
                        </Text>
                    </View>
                    <TouchableOpacity onPress={this.WithdrawalsAllMoney}>
                        <Text style={styles.allDrawcash}>
                            全部提现
                        </Text>
                    </TouchableOpacity>
                </View>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showBankCardList}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{this.state.bankName}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <Button onPress={this.doWithdraw} style={styles.btnDrawCash} textStyle={styles.btnDrawCashText}>
                    确认提现
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    drawCashTitle:{
        marginTop:10,
        paddingLeft:12,
        paddingTop:10,
        fontSize:12,
        backgroundColor:'#FFFFFF',
    },
    drawCash:{
        height:48,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        alignItems:'center',
    },
    drawCashLeft:{
        fontSize:12,
        paddingLeft:12,
    },
    drawCashContent:{
        flex:1,
        fontSize:20,
    },
    balance:{
        height:34,
        marginTop:1,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    balanceLeft:{
        height:34,
        marginTop:1,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
    },
    balanceTextLeft:{
        fontSize:14,
        color:'#888888',
        paddingLeft:12,
        paddingTop:10,
    },
    balanceTextRight:{
        fontSize:14,
        color:'#888888',
        paddingTop:10,
    },
    allDrawcash:{
        color:'#fd9a14',
        paddingRight:10,
        paddingTop:10,
    },
    ItemBg: {
        marginTop:17,
        padding: 10,
        height: 44,
        width:sr.w,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
        backgroundColor:'white',
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        width:sr.w - 45,
        color: '#444444',
        marginLeft: 8,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    btnDrawCash:{
        marginTop:285,
        backgroundColor:'#FE9917',
        height:46,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
    },
});

```

* PDClient/project/App/modules/person/addEmployee.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    Text,
    TextInput,
    Keyboard,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const PermissionSetting = require('./PermissionSetting');

module.exports = React.createClass({
    statics: {
        title: '添加员工',
        leftButton:{ handler: () => { app.scene.goBack(); } },
    },
    componentWillMount () {
        this.keyboardDidHideListener = Keyboard.addListener('keyboardDidHide', this._keyboardDidHide);
    },
    componentWillUnmount () {
        this.keyboardDidHideListener.remove();
    },
    _keyboardDidHide () {
        this.getMemberByPhone();
    },
    goBack () {
        this.props.refresh();
        app.pop();
    },
    getInitialState () {
        return {
            authority:[],
            phone:'',
            name:'',
            tip:'',
            memberId:'',
        };
    },
    selectPermission () {
        const { authority } = this.state;
        Keyboard.dismiss();
        app.push({
            component:PermissionSetting,
            passProps:{
                isCreate:true,
                authority,
                selfAuthority:app.personal.info.authority,
                backAuthority:(authority) => { this.setState({ authority }); },
            },
        });
    },
    getMemberByPhone () {
        const { phone } = this.state;
        const param = {
            userId: app.personal.info.userId,
            memberPhone:phone,
        };
        if (app.personal.info.agent) {
            POST(app.route.ROUTE_GET_MEMBER_BY_PHONE_AGENT, param, this.getMemberByPhoneSuccess, false);
        } else {
            POST(app.route.ROUTE_GET_MEMBER_BY_PHONE, param, this.getMemberByPhoneSuccess, false);
        }
    },
    getMemberByPhoneSuccess (data) {
        if (data.success) {
            this.setState({ name: data.context.name, memberId: data.context.id, tip: null });
        } else {
            this.setState({ tip:data.msg });
        }
    },
    modifyMemberAuthority () {
        const { memberId, authority } = this.state;
        if (!memberId) {
            Keyboard.dismiss();
            Toast('请记得设置权限');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            memberId,
            authority,
        };
        if (app.personal.info.shipper) {
            POST(app.route.ROUTE_MODIFY_MEMBER_AUTHORITY, param, this.modifyMemberAuthoritySuccess, true);
        } else if (app.personal.info.agent) {
            POST(app.route.ROUTE_MODIFY_MEMBER_AUTHORITY_AGENT, param, this.modifyMemberAuthoritySuccess, true);
        }
    },
    modifyMemberAuthoritySuccess (data) {
        if (data.success) {
            Toast('添加成功');
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { tip, name, authority } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.top}>
                    <View style={styles.row}>
                        <Text style={styles.rowFont}>手机号码</Text>
                        <TextInput style={styles.rowRightFont}
                            underlineColorAndroid='transparent'
                            placeholderColor='#aaaaaa'
                            maxLength={11}
                            onChangeText={(text) => this.setState({ phone:text })}
                            onSubmitEditing={Keyboard.dismiss}
                            onBlur={this.getMemberByPhone}
                            placeholder='请输入手机号码' />
                    </View>
                    {
                        tip != '' ? tip != null ?
                            <Text style={styles.rowTip}>{tip}</Text>
                        :
                            <View style={styles.row}>
                                <Text style={styles.rowFont}>姓名</Text>
                                <Text style={styles.rowRightFont}>{name || '无'}</Text>
                            </View>
                        : <View />
                }

                </View>
                <TouchableOpacity style={styles.row} onPress={this.selectPermission}>
                    <Text style={styles.rowFont}>权限设置</Text>
                    <Text style={styles.rowRightFont}>{authority.length}项</Text>
                    <Image resizeMode='contain' style={styles.imgGo} source={app.img.common_go} />
                </TouchableOpacity>
                <Button onPress={this.modifyMemberAuthority} style={styles.btnConfirm} textStyle={styles.btnFont}>确认添加</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    top:{
        marginTop:10,
    },
    row:{
        backgroundColor:'#FFFFFF',
        height:42,
        flexDirection:'row',
        alignItems:'center',
    },
    rowFont:{
        marginLeft:10,
        fontWeight:'300',
        flex:1,
    },
    rowTip:{
        height:35,
        fontWeight:'300',
        color:'#ee1824',
        textAlignVertical:'center',
        paddingLeft:10,
        lineHeight:35,
    },
    rowRightFont:{
        flex:1,
        fontSize:14,
        textAlign:'right',
        marginRight:10,
    },
    imgGo:{
        width:15,
        height:15,
        marginRight:10,
    },
    btnConfirm:{
        width:150,
        height:45,
        alignSelf:'center',
        borderRadius:4,
        marginTop:65,
    },
    btnFont:{
        fontSize:14,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/person/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    StyleSheet,
    Text,
    View,
    TouchableOpacity,
    ScrollView,
} = ReactNative;

import _ from 'lodash';

const CashBalance = require('./CashBalance');
const Bankcards = require('./BindBankcardList');

const EditPersonInfo = require('./EditPersonInfo');
const About = require('./About');
const Feedback = require('./Feedback');
const NormalQuestions = require('./NormalQuestions');
const UpdatePage = require('../update/UpdatePage');
const Software = require('./Software');
const ModifyPassword = require('./ModifyPassword');
const Order = require('../normalUser/order');
const GuaranteeAmount = require('./GuaranteeAmount');
const AddCar = require('../shortLogisticsCompany/cargo/AddCar');
const BranchStore = require('./BranchStore');
const SelectEmployees = require('./SelectEmployees');
const VerificationCode = require('./VerificationCode');
const RegionProfitList = require('./RegionProfitList');
const ModifyShop = require('./ModifyShop');

const { Button, DImage } = COMPONENTS;

const CHILD_PAGES_TOP = [
    { strict:true, title:'余额', module: CashBalance, img:'' },
    { strict:true, title:'银行卡', module: Bankcards, img:'' },
    { strict:true, title:'支付密码设置', module: VerificationCode, img:'' },
];
const CHILD_PAGES_MIDDLE = [
    { strict:true, title:'负责人', module: null, img:'' },
    { strict:true, title:'员工设置', module: SelectEmployees, img:'' },
    { strict:true, title:'路线设置', module: RegionProfitList, img:'' },
    { strict:true, title:'修改参考分店', module: ModifyShop, img:'' },

];

const MenuItem = React.createClass({
    showChildPage () {
        if (this.props.page.module) {
            app.push({
                component: this.props.page.module,
                passProps:{
                    type: this.props.type ? this.props.type : '',
                },
            });
        } else {
            return;
        }
    },
    render () {
        const { title } = this.props.page;
        return (
            <TouchableOpacity
                activeOpacity={0.6}
                onPress={this.showChildPage}
                style={styles.ItemBg}>
                <View style={styles.infoStyle}>
                    <Text style={styles.itemNameText}>{title}</Text>
                </View>
                {
                    this.props.page.module &&
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                }
                <View style={styles.lineView} />
            </TouchableOpacity>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: '个人中心',
    },
    onWillFocus () {
        this.setState({
            CHILD_PAGES_BOTTOM : [
                { strict:true, title:'添加货车', module: AddCar, img:'', currentRole:'物流公司' },
                { strict:true, title:'担保金额', module: GuaranteeAmount, img:'', currentRole:'物流公司' },
                { strict:true, title:'入驻分店', module: BranchStore, img:'', currentRole:'物流公司' },
                { strict:true, title:'权限设置', module: SelectEmployees, img:'', currentRole:'物流公司' },
                { strict:true, title:'软件许可协议', module: Software, img:'', currentRole:'发货人' },
                { strict:true, title:'常见问题', module: NormalQuestions, img:'', currentRole: app.authority.info.currentRole },
                { strict:true, title:'在线更新', module: UpdatePage, img:'', currentRole: app.authority.info.currentRole },
                { strict:true, title:'关于软件', module: About, img:'', currentRole: app.authority.info.currentRole },
                { strict:true, title:'意见反馈', module: Feedback, img:'', currentRole: app.authority.info.currentRole },
                { strict:true, title:'修改密码', module: ModifyPassword, img:'', currentRole: app.authority.info.currentRole },
            ],
        });
        app.getCurrentRoute().title = '个人中心';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    doLogout () {
        app.navigator.resetTo({
            component: require('../login/Login'),
        }, 0);
        app.personal.setNeedLogin(true);
    },
    getInitialState () {
        const info = app.personal.info;
        return {
            info,
            CHILD_PAGES_BOTTOM : [],
        };
    },
    toExitDatum () {
        app.push({
            component: EditPersonInfo,
            passProps: { updateInfo: this.updateInfo },
        });
    },
    updateInfo (info) {
        this.setState({ info });
    },
    doChangeRole (name) {
        app.authority.changeRole(name);
        if (name == '物流公司') {
            app.navigator.resetTo({
                component: require('../logisticsCompany'),
            }, 0);
        } else if (name == '发货人') {
            app.navigator.resetTo({
                component: require('../normalUser'),
            }, 0);
        } else if (name == '收货点') {
            app.navigator.resetTo({
                component: require('../receivePoint'),
            }, 0);
        }
    },
    render () {
        const { info, CHILD_PAGES_BOTTOM } = this.state;
        const canSelectList = app.authority.getCanSelectRoles();
        return (
            <ScrollView style={styles.container}>
                <View style={styles.headImgBg}>
                    <TouchableOpacity
                        onPress={this.toExitDatum}>
                        <DImage
                            resizeMode='cover'
                            defaultSource={app.img.personal_default_head}
                            source={{ uri: info.head }}
                            style={styles.headStyle} />
                        <Image
                            resizeMode='stretch'
                            source={app.personal.info.sex == 1 ? app.img.personal_male : app.img.personal_female}
                            style={styles.careStyle} />
                    </TouchableOpacity>
                    <Text style={styles.name}>{info.name ? info.name : info.phone}</Text>
                    <View style={styles.btnRow}>
                        {
                            canSelectList.map((item, i) => {
                                return (
                                    <Button onPress={this.doChangeRole.bind(null, item)} style={styles.btnChangeRole} key={i}
                                        textStyle={styles.btnChangeRoleText}>
                                        切换到{item}
                                    </Button>
                                );
                            })
                        }
                    </View>
                </View>
                <View>
                    {
                        app.authority.info.currentRole == '发货人' ?
                            <View>
                                <View style={styles.lineViewTop} />
                                <MenuItem page={{ strict:true, title:'我的货单', module: Order }} />
                                <View style={styles.lineViewTop} />
                            </View> : <Text />
                    }
                    {
                        CHILD_PAGES_TOP.map((item, i) => {
                            if (!app.personal.info.phone && item.strict) {
                                return null;
                            }
                            if (item.title == '余额') {
                                if ((_.intersection(app.personal.info.authority, [AH.AH_LOOK_AMOUNT, AH.AH_RECHARGE, AH.AH_WITHDRAW]).length != 0) || app.authority.info.currentRole == '发货人') {
                                    return (<MenuItem page={item} key={i} />);
                                } else {
                                    return null;
                                }
                            } else if (item.title == '支付密码设置') {
                                if ((_.intersection(app.personal.info.authority, [AH.AH_WITHDRAW]).length != 0) || app.authority.info.currentRole == '发货人') {
                                    return (<MenuItem page={item} key={i} />);
                                } else {
                                    return null;
                                }
                            } else {
                                return (<MenuItem page={item} key={i} />);
                            }
                        })
                    }

                    {
                        (app.personal.info.agent && app.authority.info.currentRole != '发货人' && app.authority.info.currentRole != '物流公司') ?
                            <View>
                                <View style={styles.lineViewTop} />
                                {
                                CHILD_PAGES_MIDDLE.map((item, i) => {
                                    if (item.title == '员工设置') {
                                        return (<MenuItem page={item} key={i} type='agent' />);
                                    } else {
                                        return (<MenuItem page={item} key={i} />);
                                    }
                                })
                            }
                            </View>
                        : null
                    }
                    <View style={styles.lineViewTop} />
                    {
                        _.filter(CHILD_PAGES_BOTTOM, o => app.authority.info.currentRole == o.currentRole).map((item, i) => {
                            if (!app.personal.info.phone && item.strict) {
                                return null;
                            }
                            if (item.title == '担保金额') {
                                if (_.intersection(app.personal.info.authority, [AH.AH_LOOK_AMOUNT, AH.AH_RECHARGE, AH.AH_WITHDRAW]).length != 0) {
                                    return (<MenuItem page={item} key={i} />);
                                } else {
                                    return null;
                                }
                            } else if (item.title == '权限设置') {
                                if (_.intersection(app.personal.info.authority, [AH.AH_MODIFY_SHIPPER_MEMBER_AUTHORITY]).length != 0) {
                                    return (<MenuItem page={item} key={i} />);
                                } else {
                                    return null;
                                }
                            } else if (item.title == '添加货车') {
                                if (_.intersection(app.personal.info.authority, [AH.AH_CITY_DISTRIBUTE]).length != 0) {
                                    return (<MenuItem page={item} key={i} />);
                                } else {
                                    return null;
                                }
                            } else {
                                return (<MenuItem page={item} key={i} />);
                            }
                        })
                    }
                    <View style={styles.line} />

                </View>
                <Button onPress={this.doLogout} style={styles.btnLogout} textStyle={styles.btnLogoutText} >
                    退出登录
                </Button>
            </ScrollView>

        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor:'white',
    },
    headImgBg:{
        height: 170,
        width: sr.w,
        backgroundColor:'#c81622',
        alignItems:'center',
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
    },
    btnRow:{
        marginTop:3,
        flexDirection:'row',
    },
    headStyle: {
        width: 87,
        height: 87,
        marginTop: 18,
        borderRadius: 43.5,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    lineViewTop:{
        backgroundColor: '#f4f4f4',
        height:8,
    },
    infoStyle: {
        flexDirection: 'row',
    },
    careStyle: {
        width: 30,
        height: 30,
        marginLeft:60,
        marginTop:-25,
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    name: {
        marginTop: 10,
        fontSize: 19,
        color: 'white',
        backgroundColor: 'transparent',
    },
    midView: {
        width: sr.w,
        height: 105,
        alignItems: 'center',
    },
    careShop: {
        marginVertical: 10,
        width:sr.w / 2.0,
        height: 50,
        alignItems: 'center',
        borderRadius: 8,
        justifyContent: 'center',
    },
    line: {
        width:sr.w,
        height:1,
        backgroundColor: '#f4f4f4',
    },
    btnChangeRole:{
        height:20,
        width:90,
        backgroundColor:'#fb9816',
    },
    btnChangeRoleText:{
        fontSize:12,
    },
    btnLogout:{
        marginTop:30,
        height:45,
        width:sr.w - 25,
        borderRadius:2,
        backgroundColor:'#e0e0e0',
        alignSelf:'center',
    },
    btnLogoutText:{
        color:'#000000',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDClient/project/App/modules/receivePoint/index.js

```js
'use strict';
const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

const placeOrder = require('./placeOrder');
const order = require('./order');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: placeOrder },
    { index: 1, component: order },
    { index: 3, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '填单', icon:app.img.home_pre_order, selected: app.img.home_pre_order_press },
            { index: 1, title: '货单', icon: app.img.home_order, selected: app.img.home_order_press },
            { index: 3, title: '我的', icon: app.img.home_mine, selected: app.img.home_mine_press },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/index.js

```js
'use strict';
const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';

const Cargo = require('./cargo');
const ShortRoadmap = require('./shortroadmap');
const Roadmap = require('./shortroadmap');
const Order = require('./order/Trucks');
const Person = require('../person');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: Cargo },
    { index: 1, component: Order },
    { index: 2, component: Roadmap },
    { index: 3, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    render () {
        const menus = [
            { index: 0, title: '竞得货物', icon: app.img.home_cargo, selected: app.img.home_cargo_press },
            { index: 1, title: '我的货单', icon: app.img.home_truck_unselect, selected: app.img.home_truck },
            { index: 2, title: '路线设置', icon: app.img.home_roadmap, selected: app.img.home_roadmap_press },
            { index: 3, title: '我的', icon: app.img.home_mine, selected: app.img.home_mine_press },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDClient/project/App/modules/login/ForgetPassword.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const PasswordConfirm = require('./PasswordConfirm');
const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '忘记密码',
    },
    getInitialState () {
        return {
            phone:'',
            readSecond:false,
            time:59,
            verifyCode:'',
        };
    },
    doPress () {
        const { phone } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        };
        const param = {
            phone,
        };
        POST(app.route.ROUTE_REQUEST_SEND_VERIFY_CODE, param, this.requestSendVerifyCodeSuccess, false);
    },
    timer () {
        this.setState({ readSecond:true });
        this.setTimeout(
            () => {
                this.setState({ time:(this.state.time - 1) });
                if (this.state.time <= 0) {
                    return this.setState({ readSecond:false, time:59 });
                }
                this.timer();
            },
            1000
        );
    },
    requestSendVerifyCodeSuccess (data) {
        if (data.success) {
            this.timer();
        } else {
            Toast(data.msg);
        }
    },
    doNext () {
        const { phone, verifyCode } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        };
        if (!verifyCode) {
            Toast('请填写验证码');
            return;
        }
        if (!app.utils.checkVerificationCode(verifyCode)) {
            Toast('请填写正确的格式的验证码');
            return;
        }
        app.push({
            component:PasswordConfirm,
            passProps:{
                phone,
                verifyCode,
            },
        });
    },
    render () {
        const { readSecond, time } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.ItemBgTop}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_phone}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请填写手机号码'
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            maxLength={11}
                            onChangeText={(text) => this.setState({ phone: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请填写验证码'
                            maxLength={6}
                            keyboardType='phone-pad'
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ verifyCode: text })}
                            style={styles.itemNameText} />
                        <TouchableOpacity
                            disabled={readSecond}
                            style={styles.btnBind}
                            onPress={this.doPress}>
                            {
                                    !readSecond ?
                                        <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>获取验证码</Text>
                                    :
                                        <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>{time}s后重新发送</Text>
                                }
                        </TouchableOpacity>
                    </View>
                </View>
                <Button onPress={this.doNext}
                    style={styles.btnNext}
                    textStyle={styles.btnNextText} >
                    下一步
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBgTop: {
        height: 45,
        marginTop:10,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    ItemBg: {
        height: 45,
        marginTop:1,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent: 'space-between',
    },
    icon_add:{
        width:25,
        height:25,
        marginLeft: 8,
    },
    itemNameText: {
        flex:1,
        fontSize: 14,
        color: '#444444',
        marginLeft: 10,
    },

    btnNext:{
        marginTop:50,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnNextText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
    btnBind:{
        justifyContent:'center',
        alignItems:'center',
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        height:45,
    },
    btnBindText:{
        color:'#FF981A',
        fontSize:16,
        fontWeight:'500',
        width:sr.w - 254,
        textAlign:'center',
    },
    btnBindTextGray:{
        color:'#999999',
        backgroundColor:'#fafafa',
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        fontSize:16,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
        flex:1,
        textAlignVertical:'center',
    },
});

```

* PDClient/project/App/modules/login/Login.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Image,
    View,
    TextInput,
    ListView,
    Text,
    TouchableOpacity,
} = ReactNative;

const ForgetPassword = require('./ForgetPassword');
const Register = require('./Register');
const ReceivePoint = require('../receivePoint');
const NormalUser = require('../normalUser');
const LogisticsCompany = require('../logisticsCompany');
const ShortLogisticsCompany = require('../shortLogisticsCompany');

const { Button } = COMPONENTS;

const WeixinQQPanel = React.createClass({
    render () {
        return (
            <View style={styles.thirdpartyContainer}>
                <View style={styles.sepratorContainer}>
                    <View style={styles.sepratorLine} />
                    <Text style={styles.sepratorText} >{app.isandroid ? '    ' : ''}或者您也可以</Text>
                </View>
                <View style={styles.thirdpartyButtonContainer}>
                    {
                        !!this.props.weixininstalled &&
                        <View style={styles.thirdpartyLeftButtonContainer}>
                            <Image
                                resizeMode='stretch'
                                source={app.img.login_weixin_button}
                                style={styles.image_button}
                                />
                            <Text style={styles.image_button_text}>微信登录</Text>
                        </View>
                    }
                    {
                        !!this.props.qqinstalled &&
                        <View style={styles.thirdpartyRightButtonContainer}>
                            <Image
                                resizeMode='stretch'
                                source={app.img.login_qq_button}
                                style={styles.image_button}
                                />
                            <Text style={styles.image_button_text}>QQ登录</Text>
                        </View>
                    }
                </View>
            </View>
        );
    },
});

const NoWeixinQQPanel = React.createClass({
    render () {
        return (
            <View style={styles.thirdpartyContainer2}>
                <Text style={[styles.thirdpartyContainer2_text, { color: app.setting.THEME_COLOR }]} />
            </View>
        );
    },
});

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '',
    },
    componentDidMount () {
        app.toggleNavigationBar(true);
    },
    doLogin () {
        const { phone, password } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('手机号码不是有效的手机号码');
            return;
        }
        if (!app.utils.checkPassword(password)) {
            Toast('密码必须有6-20位的数字，字母，下划线组成');
            return;
        }
        const param = {
            phone,
            password,
        };
        app.showLoading();
        POST(app.route.ROUTE_LOGIN, param, this.doLoginSuccess, this.doLoginError);
    },
    doLoginSuccess (data) {
        if (data.success) {
            app.personal.info.userId = data.context.userId;
            app.login.savePhone(this.state.phone);
            this.getPersonalInfo();
            this.getRemainAmount();
        } else {
            Toast(data.msg);
            app.hideLoading();
        }
    },
    getRemainAmount () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_REMAIN_AMOUNT, param, this.getRemainAmountSuccess, true);
    },
    getRemainAmountSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.setRemainAmount(context.amount);
        } else {
            Toast(data.msg);
            app.personal.setRemainAmount(0);
        }
    },
    doLoginError (error) {
        app.hideLoading();
    },
    doShowForgetPassword () {
        app.push({
            component: ForgetPassword,
            passProps: {
                phone: this.state.phone,
            },
        });
    },
    doShowRegister () {
        app.push({
            component: Register,
            passProps: {
                phone: this.state.phone,
                changeToLoginPanel: this.changeToLoginPanel,
            },
        });
    },
    getPersonalInfo () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_PERSONAL_INFO, param, this.getPersonalInfoSuccess, this.getPersonalInfoError);
    },
    getPersonalInfoSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.set(context);
            app.personal.get();
            app.navigator.replace({
                component: app.authority.info.currentRole == '收货点' ? ReceivePoint : app.authority.info.currentRole == '物流公司' ? app.personal.info.shipper.shipperType == 0 ? LogisticsCompany : ShortLogisticsCompany : NormalUser,
            });
            app.personal.setNeedLogin(false);
        } else {
            Toast(data.msg);
        }
        app.hideLoading();
    },
    getPersonalInfoError (error) {
        app.hideLoading();
    },
    getInitialState () {
        const ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            phone: app.login.list[0] || '',
            password: '',
            dataSource: ds.cloneWithRows(app.login.list),
            showList: false,
            weixininstalled: false,
            qqinstalled: false,
        };
    },
    changeToLoginPanel (phone) {
        this.setState({ phone });
    },
    onPhoneTextInputLayout (e) {
        const frame = e.nativeEvent.layout;
        this.listTop = frame.y + frame.height;
    },
    renderRow (text) {
        return (
            <TouchableOpacity onPress={() => this.setState({ phone: text, showList:false })}>
                <View style={styles.itemTextContainer}>
                    <Text style={styles.itemText}>
                        {text}
                    </Text>
                </View>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={sectionID + rowID} />
        );
    },
    onFocus () {
        this.setState({ showList: this.state.dataSource.getRowCount() > 0 && this.state.dataSource.getRowData(0, 0).length < 11 });
    },
    onBlur () {
        this.setState({ showList: false });
    },
    onPhoneTextChange (text) {
        const dataSource = this.state.dataSource;
        const newData = _.filter(app.login.list, (item) => { const reg = new RegExp('^' + text + '.*'); return reg.test(item); });
        this.setState({
            phone: text,
            dataSource: dataSource.cloneWithRows(newData),
            showList: newData.length > 0 && text.length < 11,
        });
    },
    render () {
        const row = this.state.dataSource.getRowCount();
        const listHeight = row > 4 ? styles.listHeightMax : row < 2 ? styles.listHeightMin : null;
        return (
            <View style={styles.container}>
                <View style={styles.logoContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.login_logo}
                        style={styles.logo}
                        />
                </View>
                <View style={styles.loginBox}>
                    <View
                        style={styles.phoneContainer}
                        onLayout={this.onPhoneTextInputLayout}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.login_phone}
                            style={styles.input_icon}
                            />
                        <TextInput
                            underlineColorAndroid='transparent'
                            placeholder='您的手机号码'
                            maxLength={11}
                            onChangeText={this.onPhoneTextChange}
                            defaultValue={this.state.phone}
                            style={styles.text_input}
                            keyboardType='phone-pad'
                            onFocus={this.onFocus}
                            onBlur={this.onBlur}
                            />
                    </View>
                    <View style={styles.listView} />
                    <View style={styles.passwordContainer}
                        >
                        <Image
                            resizeMode='stretch'
                            source={app.img.login_password}
                            style={styles.input_icon}
                            />
                        <TextInput
                            underlineColorAndroid='transparent'
                            placeholder='您的密码'
                            secureTextEntry
                            onChangeText={(text) => this.setState({ password: text })}
                            defaultValue={this.state.password}
                            style={styles.text_input}
                            />
                    </View>
                </View>

                <View style={styles.un_loading} >
                    <TouchableOpacity onPress={this.doShowRegister}>
                        <Text style={styles.register}>新用户注册</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.doShowForgetPassword}>
                        <Text style={styles.forgetPassword}>忘记密码</Text>
                    </TouchableOpacity>
                </View>

                <Button onPress={this.doLogin} style={styles.btnLogin} textStyle={styles.btnLoginText}>登录</Button>

                {this.state.qqinstalled || this.state.weixininstalled ? <WeixinQQPanel qqinstalled={this.state.qqinstalled} weixininstalled={this.state.weixininstalled} /> : <NoWeixinQQPanel />}
                {
                    this.state.showList &&
                    <ListView
                        initialListSize={1}
                        enableEmptySections
                        dataSource={this.state.dataSource}
                        keyboardShouldPersistTaps='always'
                        renderRow={this.renderRow}
                        renderSeparator={this.renderSeparator}
                        style={[styles.list, { top: this.listTop + 135 }, listHeight]}
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#ffffff',
    },
    logoContainer: {
        height: 120,
        justifyContent: 'center',
        alignItems: 'center',
        marginTop:18,
    },
    logo: {
        width: 85.5,
        height: 96,
    },
    listView:{
        height:1,
        width: 300,
        backgroundColor:'#dddddd',
    },
    loginBox:{
        marginLeft: (sr.w - 300) / 2,
        width: 300,
        height: 90,
        borderRadius:4,
        borderColor:'#dddddd',
        borderWidth:1,
        alignItems:'center',
        justifyContent:'center',
    },
    phoneContainer: {
        width: 300,
        height: 45,
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    passwordContainer:{
        width: 300,
        height: 45,
        flexDirection: 'row',
        alignItems:'center',
    },
    input_icon: {
        width: 28,
        height: 28,
        marginLeft: 10,
        marginRight: 10,
    },
    text_input: {
        height:40,
        width: 200,
        padding:0,
        fontSize:14,
        alignSelf: 'center',
    },
    un_loading:{
        flexDirection: 'row',
        justifyContent: 'space-between',
        marginTop:12,
    },
    register:{
        color:'#fd7b1b',
        marginLeft: (sr.w - 300) / 2,
    },
    forgetPassword:{
        color:'#f41728',
        marginRight: (sr.w - 300) / 2,
    },

    btnLogin: {
        height: 46,
        width: 300,
        marginLeft: (sr.w - 300) / 2,
        marginTop: 60,
        backgroundColor: '#c81622',
        borderRadius:4,
    },
    btnLoginText: {
        fontSize: 18,
        fontWeight: '600',
        color: '#FFFFFF',
    },
    thirdpartyContainer: {
        flex:1,
    },
    sepratorContainer: {
        height: 30,
        alignItems:'center',
        justifyContent: 'center',
        marginTop: 50,
    },
    sepratorLine: {
        top: 10,
        height: 2,
        width: sr.w - 20,
        backgroundColor: '#858687',
    },
    sepratorText: {
        backgroundColor:'#EEEEEE',
        color: '#A3A3A4',
        paddingHorizontal: 10,
    },
    thirdpartyButtonContainer: {
        marginTop: 30,
        height: 120,
        flexDirection: 'row',
    },
    thirdpartyLeftButtonContainer: {
        flex:1,
        alignItems:'center',
    },
    thirdpartyRightButtonContainer: {
        flex:1,
        alignItems:'center',
    },
    image_button: {
        width: 80,
        height: 80,
        margin: 10,
    },
    image_button_text: {
        color: '#4C4D4E',
        fontSize: 16,
    },
    thirdpartyContainer2: {
        marginTop: 30,
        height: 200,
        alignItems:'center',
        justifyContent: 'flex-end',
    },
    thirdpartyContainer2_text: {
        fontSize: 18,
        marginBottom:60,
    },
    list: {
        position: 'absolute',
        backgroundColor: 'rgba(255, 255, 255, 0.6)',
        borderWidth: 1,
        borderRadius: 5,
        borderColor: '#D7D7D7',
        width: 150,
        left: 80,
        paddingLeft: 10,
    },
    listHeightMin: {
        height: 30,
    },
    listHeightMax: {
        height: 184,
    },
    itemTextContainer: {
        height: 30,
        justifyContent: 'center',
    },
    itemText: {
        fontSize: 16,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDClient/project/App/modules/login/PasswordConfirm.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Image,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '忘记密码',
    },
    getInitialState () {
        return {
            newPassword:'',
            rePassword:'',
        };
    },
    doPress () {
        const { newPassword, rePassword } = this.state;
        const { phone, verifyCode } = this.props;
        if (newPassword != rePassword) {
            Toast('两次输入密码不一致');
            return;
        }
        const param = {
            phone,
            verifyCode,
            password:newPassword,
        };
        POST(app.route.ROUTE_FIND_PASSWORD, param, this.findPasswordSuccess, false);
    },
    findPasswordSuccess (data) {
        if (data.success) {
            Toast('密码设置成功');
            app.navigator.popToTop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_password}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请输入新密码'
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ newPassword: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_password_check}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='确认新密码'
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ rePassword: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <Button onPress={this.doPress}
                    style={styles.btnSubmit}
                    textStyle={styles.btnSubmitText} >
                    确认修改
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBg: {
        height: 45,
        flexDirection: 'row',
        backgroundColor:'white',
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        height: 45,
    },
    icon_add:{
        width:25,
        height:25,
        marginLeft: 8,
    },
    itemNameText: {
        width: 300,
        fontSize:14,
        marginLeft:10,
        marginTop:5,
        padding:0,
    },
    btnSubmit:{
        marginTop:50,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnSubmitText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/login/Register.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Image,
    Text,
    View,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const TimerMixin = require('react-timer-mixin');
const { Button, WebviewMessageBox } = COMPONENTS;

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '手机注册',
    },
    doRegister () {
        const { protocalRead, phone, password, rePassword, verifyCode } = this.state;
        if (!protocalRead) {
            Toast('注册前请先阅读用户协议');
            return;
        }
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        }
        if (!app.utils.checkPassword(password)) {
            Toast('密码必须由 6-20 位的数字或，字母，下划线组成');
            return;
        }
        if (password !== rePassword) {
            Toast('两次输入的密码不一致');
            return;
        }
        if (!verifyCode) {
            Toast('请填写验证码');
            return;
        }
        if (!app.utils.checkVerificationCode(verifyCode)) {
            Toast('请填写正确的格式的验证码');
            return;
        }
        // if (!app.utils.checkMailAddress(email)) {
        //     Toast('邮箱地址不规范，请重新输入');
        //     return;
        // }
        const param = {
            phone,
            verifyCode,
            password,
        };
        POST(app.route.ROUTE_REGISTER, param, this.doRegisterSuccess, true);
    },
    doRegisterSuccess (data) {
        if (data.success) {
            Toast('注册成功');
            this.props.changeToLoginPanel(this.state.phone);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    doShowProtocal () {
        app.showModal(
            <WebviewMessageBox webAddress={app.route.ROUTE_USER_LICENSE} title={CONSTANTS.APP_NAME + '用户协议'} />
        );
    },
    getInitialState () {
        return {
            phone: '',
            password: '',
            rePassword: '',
            verifyCode: '',
            protocalRead: true,
            overlayShow:false,
            readSecond:false,
            time:parseInt(59),
        };
    },
    changeProtocalState () {
        this.setState({ protocalRead: !this.state.protocalRead });
    },
    doPress () {
        const { phone } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        };
        const param = {
            phone,
        };
        POST(app.route.ROUTE_REQUEST_SEND_VERIFY_CODE, param, this.requestSendVerifyCodeSuccess, false);
    },
    timer () {
        this.setState({ readSecond:true });
        this.setTimeout(
            () => {
                this.setState({ time:(this.state.time - 1) });
                if (this.state.time <= 0) {
                    return this.setState({ readSecond:false, time:59 });
                }
                this.timer();
            },
            1000
        );
    },
    requestSendVerifyCodeSuccess (data) {
        if (data.success) {
            this.timer();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { readSecond, time } = this.state;
        return (
            <View style={styles.container}>
                <View style={[styles.phoneContainer, { marginTop:10 }]}>
                    <Image
                        source={app.img.login_phone}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='手机号'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ phone: text })}
                        style={styles.text_input}
                        keyboardType='phone-pad'
                        />
                </View>
                <View style={styles.verification}>
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请填写验证码'
                        keyboardType='phone-pad'
                        maxLength={CONSTANTS.VERIFICATION_MAX_LENGTH}
                        onChangeText={(text) => this.setState({ verifyCode: text })}
                        style={styles.text_input2}
                        />
                    <TouchableOpacity
                        disabled={readSecond}
                        style={styles.btnBind}
                        onPress={this.doPress}>
                        {
                            !readSecond ?
                                <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>获取验证码</Text>
                            :
                                <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>{time}s后重新发送</Text>
                        }
                    </TouchableOpacity>
                </View>
                <View style={styles.phoneContainer}>
                    <Image
                        source={app.img.login_password}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请输入密码'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ password: text })}
                        style={styles.text_input}
                        />
                </View>
                <View style={styles.phoneContainer}>
                    <Image
                        source={app.img.login_password_check}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请再次输入密码'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ rePassword: text })}
                        style={styles.text_input}
                        />
                </View>
                <View style={styles.agreement}>
                    <TouchableOpacity onPress={this.changeProtocalState}>
                        <Image
                            resizeMode='cover'
                            source={this.state.protocalRead ? app.img.order_choose_r : app.img.order_no_choose_r}
                            style={styles.protocal_icon}
                            />
                    </TouchableOpacity>
                    <Text style={styles.protocal_text}>  我已阅读并同意 </Text>
                    <Button onPress={this.doShowProtocal}
                        style={styles.protocal_button}
                        textStyle={styles.protocal_button_text}>
                        {'《四面通物流超市协议》'}
                    </Button>
                </View>
                <Button onPress={this.doRegister} style={styles.btnRegister} textStyle={styles.btnRegisterText}>注  册</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    phoneContainer:{
        height:45,
        flexDirection: 'row',
        alignItems:'center',
        borderBottomWidth:1,
        borderColor:'#f9f9f9',
        backgroundColor:'#FFFFFF',
    },
    text_phone_header: {
        height:20,
        width:16,
        marginLeft:12,
    },
    verification:{
        height:45,
        flexDirection: 'row',
        justifyContent: 'space-between',
        backgroundColor:'#FFFFFF',
        borderBottomWidth:1,
        borderColor:'#f9f9f9',
        alignItems:'center',
    },
    text_input: {
        marginLeft:14,
        fontSize:15,
        height:45,
        lineHeight:45,
        width: 180,
        alignSelf: 'center',
        justifyContent:'center',
    },
    text_input2: {
        marginLeft: 12,
        fontSize:15,
        height: 45,
        lineHeight:45,
        width: 220,
        alignSelf: 'center',
    },
    btnRegister: {
        height: 46,
        width: sr.w - 100,
        marginLeft: 50,
        marginTop: 35,
        borderRadius: 4,
        backgroundColor: '#c81622',
    },
    btnRegisterText: {
        fontSize: 20,
        fontWeight: '600',
        color: '#FFFFFF',
    },
    protocal_icon: {
        height: 15,
        width: 15,
        marginRight: 10,
    },
    protocal_text: {
        fontSize: 13,
    },
    agreement:{
        flexDirection: 'row',
        height:20,
        alignItems:'center',
        marginLeft:13,
        marginTop:10,
    },
    protocal_button: {
        height: 18,
        backgroundColor:'#f4f4f4',
    },
    protocal_button_text: {
        fontSize: 13,
        color: '#c81622',
        fontWeight:'400',
    },
    btnBind:{
        justifyContent:'center',
        alignItems:'center',
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        height:45,
    },
    btnBindText:{
        color:'#FF981A',
        fontSize:16,
        fontWeight:'500',
        width:sr.w - 254,
        textAlign:'center',
    },
    btnBindTextGray:{
        color:'#999999',
        backgroundColor:'#fafafa',
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        fontSize:16,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
        height:45,
        lineHeight:45,
        textAlignVertical:'center',
    },
});

```

* PDClient/project/App/modules/test/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    FlatList,
    Button,
} = ReactNative;

const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    getInitialState () {
        return {
            list: [1, 2, 3, 4, 5, 6, 7, 8],
        };
    },
    componentWillMount () {
        SplashScreen.hide();
    },
    renderItem ({ item, separators }) {
        console.log('========', separators);
        return (
            <View style={styles.row}>
                <Text>
                    {item}
                </Text>
            </View>
        );
    },
    onPress () {
        this.setState({ list: [2, 3, 4, 5] });
    },
    render () {
        return (
            <View style={styles.container}>
                <Button title='click' onPress={this.onPress} />
                <FlatList
                    data={this.state.list}
                    extraData={this.state}
                    renderItem={this.renderItem}
                    refreshing={false}
                    initialNumToRender={4}
                    ListHeaderComponent={<Text>'这是头'</Text>}
                    ListFooterComponent={<Text>'这是尾'</Text>}
                    ListEmptyComponent={<Text>'没有数据'</Text>}
                    ItemSeparatorComponent={() => <View style={styles.separator} />}
                    onRefresh={() => { console.log('========'); }}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop: 60,
    },
    row: {
        height: 80,
        justifyContent: 'center',
        alignItems: 'center',
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDClient/project/App/modules/test/pageList.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    getInitialState () {
        return {
            list: [1, 2, 3, 4, 5, 6, 7, 8],
        };
    },
    componentWillMount () {
        SplashScreen.hide();
    },
    renderRow (obj) {
        return (
            <View style={styles.row}>
                <Text>
                    {obj}
                </Text>
            </View>
        );
    },
    onPress () {
        this.setState({ list: [2, 3, 4, 5] });
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'testList'}
                    listUrl='http://localhost:4000/getList'
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop: 60,
    },
    row: {
        height: 80,
        justifyContent: 'center',
        alignItems: 'center',
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDClient/project/App/modules/test/testStartApp.js

```js
/**
 * Sample React Native App
 * https://github.com/facebook/react-native
 * @flow
 */

import React, { Component } from 'react';
import {
  Platform,
  StyleSheet,
  Text,
  View,
} from 'react-native';
const SplashScreen = require('@remobile/react-native-splashscreen');
const instructions = Platform.select({
    ios: 'Press Cmd+R to reload,\n' +
    'Cmd+D or shake for dev menu',
    android: 'Double tap R on your keyboard to reload,\n' +
    'Shake or press menu button for dev menu',
});
import TabNavigator from 'react-native-tab-navigator';
// const CameraRollPicker = require('@remobile/react-native-camera-roll-picker');
// import Swipeout from 'react-native-swipeout';
const { Slider } = require('../components/index');
// const { Button } = require('../components/index');
module.exports = React.createClass({
    componentWillMount () {
        SplashScreen.hide();
    },
    render () {
        return (
            <View style={styles.container}>
                <Text style={styles.welcome}>
          Welcome to React Native!
        </Text>
                <Text style={styles.instructions}>
          To get started, edit App.js
        </Text>
                <Text style={styles.instructions}>
                    {instructions}
                </Text>
                <TabNavigator tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}>
                    <TabNavigator.Item
                        key={1}
                        selected
                        title={'item.title'}
                        titleStyle={styles.titleStyle}
                        selectedTitleStyle={styles.titleSelectedStyle}>
                        <Slider />
                    </TabNavigator.Item>
                </TabNavigator>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: 'red',
    },
    welcome: {
        fontSize: 20,
        textAlign: 'center',
        margin: 10,
    },
    instructions: {
        textAlign: 'center',
        color: '#333333',
        marginBottom: 5,
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
});

```

* PDClient/project/App/modules/test/wxpay.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
} = ReactNative;
const { Button } = COMPONENTS;

const Wxpay = require('../../native/index.js').WeixinPay;

module.exports = React.createClass({
    componentWillMount () {
        const param = {
            userId: '59c1c5a2c2e39a4a3f34bf0b', // app.personal.info.userId,
            total_fee:1, // 总金额 (分)
            body:'充值',
        };
        POST(app.route.ROUTE_GET_UNIFIED_ORDER, param, this.getUnifiedOrderSuccess, true);
    },
    getUnifiedOrderSuccess (data) {
        console.log('---------------', data);
        if (data.success) {
            Wxpay.pay(data.context, function (results) { console.log('success:', results); }, function (results) { Toast('error:' + results); });
        }
    },
    /*
    * 注：订单总金额，只能为整数，单位为【分】，参数值不能带小数。
    * appid: 公众账号ID
    * noncestr: 随机字符串
    * package: 扩展字段
    * partnerid: 商户号
    * prepayid: 预支付交易会话ID
    * timestamp: 时间戳
    * sign: 签名
    */
    doPay () {
        Wxpay.pay({
            appid: 'wxcbe9347be9959618',
            noncestr: '6E19AACCBF1947C6B4174002AA4A0880',
            package: 'Sign=WXPay',
            partnerid: '1319502301',
            prepayid: 'wx201604261017572078a543080024071363',
            timestamp:'1461637077',
            sign: 'D33D5A6FAE941D5253DF998247B1C75A',
        }, function (results) { console.log('success:', results); }, function (results) { Toast('error:' + results); });
    },
    render () {
        return (
            <View style={styles.container}>
                <Button onPress={this.doPay}>微信支付</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: 'transparent',
        justifyContent: 'space-around',
        paddingVertical: 150,
    },
});

```

* PDClient/project/App/modules/update/UpdateInfoBox.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const Update = require('@remobile/react-native-update');

const
    STATUS_HAS_VEW_VERSION = 0,
    STATUS_DOWNLOAD_APK_PROGESS = 1,
    STATUS_DOWNLOAD_JS_PROGESS = 2,
    STATUS_UNZIP_JS_PROGESS = 3,
    STATUS_DOWNKOAD_APK_ERROR = 4,
    STATUS_DOWNKOAD_JS_ERROR = 5,
    STATUS_UNZIP_JS_ERROR = 6,
    STATUS_FAILED_INSTALL_ERROR = 7,
    STATUS_UPDATE_END = 8;

const
    ERROR_DOWNKOAD_APK = 1,
    ERROR_DOWNKOAD_JS = 2,
    ERROR_FAILED_INSTALL = 3,
    ERROR_UNZIP_JS = 4;

const PROGRESS_WIDTH = sr.tw * 0.7;
const { ProgressBar } = COMPONENTS;

const ProgressInfo = React.createClass({
    render () {
        const { progress } = this.props;
        if (progress < 1000) {
            return (
                <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                    <Text>{this.props.title} [{progress}%]</Text>
                    <ProgressBar
                        fillStyle={{}}
                        backgroundStyle={{ backgroundColor: '#cccccc', borderRadius: 2 }}
                        style={{ marginTop: 10, width:PROGRESS_WIDTH }}
                        progress={progress / 100.0}
                        />
                    <View style={styles.progressText}>
                        <Text>0</Text>
                        <Text>100</Text>
                    </View>
                </View>
            );
        } else {
            const size = progress / 1000 / 1024 / 1024;
            return (
                <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                    <Text>{this.props.title} [ {size.toFixed(2)} M ]</Text>
                </View>
            );
        }
    },
});

module.exports = React.createClass({
    getInitialState () {
        return {
            status:STATUS_HAS_VEW_VERSION,
            progress: 0,
        };
    },
    onError (errCode) {
        if (errCode == ERROR_DOWNKOAD_APK) {
            this.setState({ status: STATUS_DOWNKOAD_APK_ERROR });
        } else if (errCode == ERROR_DOWNKOAD_JS) {
            this.setState({ status: STATUS_DOWNKOAD_JS_ERROR });
        } else if (errCode == ERROR_FAILED_INSTALL) {
            this.setState({ status: STATUS_FAILED_INSTALL_ERROR });
        } else if (errCode == ERROR_UNZIP_JS) {
            this.setState({ status: STATUS_UNZIP_JS_ERROR });
        }
    },
    doUpdate () {
        const { jsVersionCode, trackViewUrl } = this.props.options;
        if (jsVersionCode !== undefined) {
            Update.updateJS({
                jsVersionCode,
                jsbundleUrl: app.isandroid ? app.route.ROUTE_JS_ANDROID_URL : app.route.ROUTE_JS_IOS_URL,
                onDownloadJSProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_JS_PROGESS, progress }); },
                onUnzipJSProgress:(progress) => { this.setState({ status: STATUS_UNZIP_JS_PROGESS, progress }); },
                onUnzipJSEnd:() => { this.setState({ status: STATUS_UPDATE_END }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        } else {
            Update.updateApp({
                trackViewUrl,
                androidApkUrl:app.route.ROUTE_APK_URL,
                androidApkDownloadDestPath:'/sdcard/pdclient.apk',
                onDownloadAPKProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_APK_PROGESS, progress }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        }
    },
    render () {
        const components = {};
        const { newVersion, description } = this.props.options;
        components[STATUS_HAS_VEW_VERSION] = (
            <View style={styles.functionContainer}>
                <Text style={styles.title}>{`发现新版本(${newVersion})`}</Text>
                <Text style={styles.redLine} />
                <Text style={styles.content}>
                    {'更新内容：'}
                </Text>
                {
                    description.map((item, i) => {
                        return (
                            <Text style={styles.contentItem} key={i}>{'- ' + item}</Text>
                        );
                    })
                }
                <View style={styles.buttonViewStyle}>
                    <TouchableOpacity
                        onPress={app.closeModal}
                        style={styles.buttonStyleContainCannel}>
                        <Text style={styles.buttonStyleCannel}>以后再说</Text>
                    </TouchableOpacity>
                    <TouchableOpacity
                        onPress={this.doUpdate}
                        style={styles.buttonStyleContain}>
                        <Text style={styles.buttonStyle} >立即更新</Text>
                    </TouchableOpacity>
                </View>
            </View>
        );
        components[STATUS_DOWNKOAD_APK_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>下载apk文件失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_DOWNKOAD_JS_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>下载js bundle失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_UNZIP_JS_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>解压js bundle失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_FAILED_INSTALL_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>你放弃了安装</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_DOWNLOAD_APK_PROGESS] = (
            <ProgressInfo
                title='正在下载APK'
                progress={this.state.progress} />
        );
        components[STATUS_DOWNLOAD_JS_PROGESS] = (
            <ProgressInfo
                title='正在下载Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UNZIP_JS_PROGESS] = (
            <ProgressInfo
                title='正在解压Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UPDATE_END] = (
            <Text>即将重启...</Text>
        );
        return (
            <View style={styles.container}>
                {components[this.state.status]}
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    functionContainer: {
        width:sr.w - 60,
        backgroundColor:'#FFFFFF',
    },
    progressText: {
        flexDirection:'row',
        justifyContent:'space-between',
        width: sr.w * 0.7,
    },
    textInfo: {
        color: '#000000',
        fontSize: 14,
        marginBottom: 20,
        textAlign: 'center',
    },
    buttonViewStyle: {
        flexDirection: 'row',
        width: sr.w - 40,
        height: 60,
        justifyContent: 'center',
    },
    redLine: {
        marginTop: 15,
        width: sr.w - 60,
        height: 1,
        backgroundColor: '#2F4F4F',
    },
    buttonStyleContain: {
        width: 120,
        height: 35,
        marginLeft: 30,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor: '#2F4F4F',
    },
    buttonStyleContainCannel: {
        width: 120,
        height: 35,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor: 'white',
        borderWidth: 1,
        borderColor: '#2F4F4F',
    },
    buttonStyle: {
        fontSize: 16,
        color: 'white',
        fontFamily: 'STHeitiSC-Medium',
    },
    buttonStyleCannel: {
        fontSize: 16,
        color: '#2F4F4F',
        fontFamily: 'STHeitiSC-Medium',
    },
    title: {
        color: '#2F4F4F',
        fontSize: 18,
        textAlign: 'center',
        overflow: 'hidden',
        marginTop: 15,
        fontFamily: 'STHeitiSC-Medium',
    },
    content: {
        color:'#000000',
        marginTop: 10,
        marginBottom: 10,
        marginHorizontal: 20,
        fontSize:16,
        fontFamily: 'STHeitiSC-Medium',
    },
    contentItem: {
        color:'#000000',
        marginBottom: 10,
        marginHorizontal: 20,
        fontSize:12,
    },
});

```

* PDClient/project/App/modules/update/UpdatePage.js

```js
'use strict';
const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

const Update = require('@remobile/react-native-update');

const
    STATUS_GET_VERSION = 0,
    STATUS_HAS_VEW_VERSION = 1,
    STATUS_HAS_NOT_VEW_VERSION = 2,
    STATUS_DOWNLOAD_APK_PROGESS = 3,
    STATUS_DOWNLOAD_JS_PROGESS = 4,
    STATUS_UNZIP_JS_PROGESS = 5,
    STATUS_GET_VERSION_ERROR = 6,
    STATUS_DOWNKOAD_APK_ERROR = 7,
    STATUS_DOWNKOAD_JS_ERROR = 8,
    STATUS_UNZIP_JS_ERROR = 9,
    STATUS_FAILED_INSTALL_ERROR = 10,
    STATUS_UPDATE_END = 11;

const
    ERROR_DOWNKOAD_APK = 1,
    ERROR_DOWNKOAD_JS = 2,
    ERROR_FAILED_INSTALL = 3,
    ERROR_UNZIP_JS = 4;

const PROGRESS_WIDTH = sr.tw * 0.7;
const { Button, ProgressBar } = COMPONENTS;

const ProgressInfo = React.createClass({
    render () {
        const { progress } = this.props;
        if (progress < 1000) {
            return (
                <View>
                    <Text>{this.props.title} [{progress}%]</Text>
                    <ProgressBar
                        fillStyle={{}}
                        backgroundStyle={{ backgroundColor: '#cccccc', borderRadius: 2 }}
                        style={{ marginTop: 10, width:PROGRESS_WIDTH }}
                        progress={progress / 100.0}
                        />
                    <View style={styles.progressText}>
                        <Text>0</Text>
                        <Text>100</Text>
                    </View>
                </View>
            );
        } else {
            const size = progress / 1000 / 1024 / 1024;
            return (
                <View style={{ flex: 1, alignItems: 'center' }}>
                    <Text>{this.props.title} [{size.toFixed(2)} M]</Text>
                </View>
            );
        }
    },
});

module.exports = React.createClass({
    statics: {
        title: '在线更新',
    },
    pageName: 'UpdatePage',
    getInitialState () {
        const { options } = this.props;
        return {
            options,
            status: !options ? STATUS_GET_VERSION : options.newVersion ? STATUS_HAS_VEW_VERSION : STATUS_HAS_NOT_VEW_VERSION,
            progress: 0,
        };
    },
    componentWillMount () {
        if (!this.state.options) {
            Update.checkVersion({
                versionUrl: app.route.ROUTE_VERSION_INFO_URL,
                iosAppId: CONSTANTS.IOS_APPID,
            }).then((options) => {
                this.setState({ options, status: !options ? STATUS_GET_VERSION_ERROR : options.newVersion ? STATUS_HAS_VEW_VERSION : STATUS_HAS_NOT_VEW_VERSION });
            });
        }
    },
    onError (errCode) {
        if (errCode == ERROR_DOWNKOAD_APK) {
            this.setState({ status: STATUS_DOWNKOAD_APK_ERROR });
        } else if (errCode == ERROR_DOWNKOAD_JS) {
            this.setState({ status: STATUS_DOWNKOAD_JS_ERROR });
        } else if (errCode == ERROR_FAILED_INSTALL) {
            this.setState({ status: STATUS_FAILED_INSTALL_ERROR });
        } else if (errCode == ERROR_UNZIP_JS) {
            this.setState({ status: STATUS_UNZIP_JS_ERROR });
        }
    },
    doUpdate () {
        const { jsVersionCode, trackViewUrl } = this.state.options;
        if (jsVersionCode !== undefined) {
            Update.updateJS({
                jsVersionCode,
                jsbundleUrl: app.isandroid ? app.route.ROUTE_JS_ANDROID_URL : app.route.ROUTE_JS_IOS_URL,
                onDownloadJSProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_JS_PROGESS, progress }); },
                onUnzipJSProgress:(progress) => { this.setState({ status: STATUS_UNZIP_JS_PROGESS, progress }); },
                onUnzipJSEnd:() => { this.setState({ status: STATUS_UPDATE_END }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        } else {
            Update.updateApp({
                trackViewUrl,
                androidApkUrl:app.route.ROUTE_APK_URL,
                androidApkDownloadDestPath:'/sdcard/pdclient.apk',
                onDownloadAPKProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_APK_PROGESS, progress }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        }
    },
    render () {
        const components = {};
        const { APP_NAME } = CONSTANTS;
        const { currentVersion, newVersion, description } = this.state.options || { currentVersion:Update.getVersion() };
        components[STATUS_GET_VERSION] = (
            <Text style={styles.textInfo}>正在获取版本号</Text>
        );
        components[STATUS_HAS_NOT_VEW_VERSION] = (
            <Text style={styles.textInfo}>当前版本已经是最新版本</Text>
        );
        components[STATUS_GET_VERSION_ERROR] = (
            <Text style={styles.textInfo}>获取版本信息失败，请稍后再试</Text>
        );
        components[STATUS_DOWNKOAD_APK_ERROR] = (
            <Text style={styles.textInfo}>下载apk文件失败，请稍后再试</Text>
        );
        components[STATUS_DOWNKOAD_JS_ERROR] = (
            <Text style={styles.textInfo}>下载js bundle失败，请稍后再试</Text>
        );
        components[STATUS_UNZIP_JS_ERROR] = (
            <Text style={styles.textInfo}>解压js bundle失败，请稍后再试</Text>
        );
        components[STATUS_FAILED_INSTALL_ERROR] = (
            <Text style={styles.textInfo}>你放弃了安装</Text>
        );
        components[STATUS_HAS_VEW_VERSION] = (
            <View style={styles.textInfoContainer}>
                <Text style={styles.textInfo}>发现新版本{newVersion}</Text>
                <View style={styles.descriptionContainer}>
                    {
                        description && description.map((item, i) => {
                            return (
                                <Text style={styles.textInfo} key={i}>{(i + 1) + '. ' + item}</Text>
                            );
                        })
                    }
                </View>
                <Button onPress={this.doUpdate} style={styles.button_layer} textStyle={styles.button_text}>立即更新</Button>
            </View>
        );
        components[STATUS_DOWNLOAD_APK_PROGESS] = (
            <ProgressInfo
                title='正在下载APK'
                progress={this.state.progress} />
        );
        components[STATUS_DOWNLOAD_JS_PROGESS] = (
            <ProgressInfo
                title='正在下载Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UNZIP_JS_PROGESS] = (
            <ProgressInfo
                title='正在解压Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UPDATE_END] = (
            <Text>正在重启...</Text>
        );
        return (
            <View style={styles.container}>
                <View style={styles.logoContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.personal_logo}
                        style={styles.logo}
                        />
                    <Text style={styles.app_name}>{APP_NAME + 'V' + currentVersion}</Text>
                </View>
                <View style={styles.functionContainer}>
                    {components[this.state.status]}
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
    },
    logoContainer: {
        alignItems:'center',
        marginTop: 52,
    },
    logo: {
        width: 83,
        height: 83,
    },
    app_name: {
        marginTop: 13,
        fontSize: 16,
        color: '#727272',
    },
    functionContainer: {
        flex: 1,
        width: sr.w,
        marginTop: 51,
        alignItems:'center',
    },
    button_layer: {
        width:178,
        height:49,
        borderRadius: 4,
        left: (sr.w - 178) / 2,
        position: 'absolute',
        bottom: 120,
        backgroundColor: '#DE3031',
    },
    button_text: {
        fontSize: 18,
        fontWeight: '400',
        color: '#FFFFFF',
        alignSelf: 'center',
        fontFamily: 'STHeitiSC-Medium',
    },
    progressText: {
        flexDirection:'row',
        justifyContent:'space-between',
        width: sr.w * 0.7,
    },
    textInfoContainer: {
        flex: 1,
        width: sr.w,
    },
    textInfo: {
        color: '#000000',
        fontSize: 18,
        marginBottom: 6,
        textAlign: 'center',
    },
});

```

* PDClient/project/App/modules/splash/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
} = ReactNative;

import Swiper from 'react-native-swiper';
const TimerMixin = require('react-timer-mixin');
const SplashScreen = require('@remobile/react-native-splashscreen');
const Login = require('../login/Login');
const NormalUser = require('../normalUser');
const LogisticsCompany = require('../logisticsCompany');
const ShortLogisticsCompany = require('../shortLogisticsCompany');
const ReceivePoint = require('../receivePoint');

module.exports = React.createClass({
    mixins: [TimerMixin],
    getInitialState () {
        return {
            renderSplashType: 0,
        };
    },
    doGetPersonalInfo () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_PERSONAL_INFO, param, this.getPersonalInfoSuccess, this.getInfoError);
    },
    getPersonalInfoSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.set(context);
            app.personal.get();
            this.changeToHomePage();
            app.personal.setNeedLogin(false);
        } else {
            this.getInfoError();
        }
    },
    getInfoError () {
        app.personal.setNeedLogin(true);
        this.changeToLoginPage();
    },
    enterLoginPage (needHideSplashScreen) {
        app.navigator.replace({
            component: Login,
        });
        needHideSplashScreen && SplashScreen.hide();
    },
    changeToLoginPage () {
        if (app.updateMgr.needShowSplash) {
            this.setState({ renderSplashType: 0 }, () => {
                SplashScreen.hide();
            });
        } else {
            this.setState({ renderSplashType: 1 }, () => {
                this.enterLoginPage(true);
            });
        }
    },
    enterHomePage (needHideSplashScreen) {
        app.navigator.replace({
            component: app.authority.info.currentRole == '收货点' ? ReceivePoint : app.authority.info.currentRole == '物流公司' ? app.personal.info.shipper.shipperType == 0 ? LogisticsCompany : ShortLogisticsCompany : NormalUser,
        });
        needHideSplashScreen && SplashScreen.hide();
    },
    changeToHomePage () {
        if (app.updateMgr.needShowSplash) {
            this.setState({ renderSplashType: 0 }, () => {
                SplashScreen.hide();
            });
        } else {
            this.setState({ renderSplashType: 2 }, () => {
                this.enterHomePage(true);
            });
        }
    },
    enterNextPage () {
        app.updateMgr.setNeedShowSplash(false);
        if (this.state.renderSplashType === 0) {
            app.personal.setNeedLogin(true);
            this.setState({ renderSplashType: 1 }, () => {
                this.enterLoginPage();
            });
        } else {
            this.setState({ renderSplashType: 2 }, () => {
                this.enterHomePage();
            });
        }
    },
    changeToNextPage () {
        if (app.personal.needLogin) {
            app.personal.setNeedLogin(true);
            this.changeToLoginPage();
        } else {
            this.doGetPersonalInfo();
        }
    },
    componentDidMount () {
        app.utils.until(
            () => app.personal.initialized && app.updateMgr.initialized && app.navigator,
            (cb) => setTimeout(cb, 100),
            () => this.changeToNextPage()
        );
    },
    componentWillUnmount () {
        app.updateMgr.checkUpdate();
    },
    onLayout (e) {
        const { height } = e.nativeEvent.layout;
        if (this.state.height !== height) {
            this.heightHasChange = !!this.state.height;
            this.setState({ height });
        }
    },
    renderSwiperSplash () {
        const { height } = this.state;
        const marginBottom = (!this.heightHasChange || Math.floor(height) === Math.floor(sr.th)) ? 0 : 30;
        return (
            <View style={{ flex: 1 }} onLayout={this.onLayout}>
                {
                    height &&
                    <Swiper
                        paginationStyle={styles.paginationStyle}
                        dot={<View style={{ backgroundColor:'#87E5D6', width: 8, height: 8, borderRadius: 4, marginLeft: 12, marginRight: 12, marginBottom }} />}
                        activeDot={<View style={{ backgroundColor:'#1A7AE9', width: 18, height: 9, borderRadius: 6, marginLeft: 7, marginRight: 7, marginBottom }} />}
                        height={height}
                        loop={false}>
                        {
                            [1, 2, 3].map((i) => {
                                return (
                                    <Image
                                        key={i}
                                        resizeMode='stretch'
                                        source={app.img['splash_splash' + i]}
                                        style={[styles.bannerImage, { height }]}>
                                        {
                                            i === 3 &&
                                            <TouchableOpacity
                                                style={styles.enterButtonContainer}
                                                onPress={this.enterNextPage}>
                                                <Image resizeMode='stretch' style={styles.enterButton} source={app.img.splash_start} />
                                            </TouchableOpacity>
                                        }
                                    </Image>
                                );
                            })
                        }
                    </Swiper>
                }
            </View>
        );
    },
    render () {
        return this.state.renderSplashType != 0 ? <Image style={{ width:sr.w, height:sr.h }} source={app.img.splash_splash1} /> : this.renderSwiperSplash();
    },
});

const styles = StyleSheet.create({
    paginationStyle: {
        bottom: 30,
    },
    bannerImage: {
        width: sr.w,
    },
    enterButtonContainer: {
        position: 'absolute',
        width: 165,
        height: 40,
        left: (sr.w - 165) / 2,
        bottom: 80,
        alignItems:'center',
        justifyContent: 'center',
    },
    enterButton: {
        width: 140,
        height: 36,
    },
});

```

* PDClient/project/App/native/wxpay/index.js

```js
const exec = require('@remobile/react-native-cordova').exec;

const WeixinPay = {
    pay (json, successFn, failureFn) {
        exec(successFn, failureFn, 'WeixinPay', 'payment', [json]);
    },
};

module.exports = WeixinPay;

```

* PDClient/project/App/utils/check/index.js

```js
module.exports = {
    checkPhone (phone) {
        return /^1\d{10}$/.test(phone);
    },
    checkIdentifyNumber (number) {
        return /^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/.test(number);
    },
    checkPassword (pwd) {
        return /^[\d\w_]{6,20}$/.test(pwd);
    },
    checkVerificationCode (code) {
        return /^\d{6}$/.test(code);
    },
    checkMailAddress (code) {
        const reg = /^([a-zA-Z0-9]+[_.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        return reg.test(code);
    },
    /**
     * 验证银行卡号(16位或19位数字)
    */
    checkBankCardCode (code) {
        return /^(\d{16}|\d{19})$/.test(code);
    },
    /**
     * 验证出生日期(平年日期格式为YYYY-MM-DD的正则表达式)
    */
    checkBirthDate (str) {
        var re = /^([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8])))$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
    * 验证字符串是否包含特殊符号
    */
    checkStr (str) {
        let re = /^[\u4E00-\u9FA5A-Za-z0-9-]+$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证数字(可以包含两个小数点)
    */
    check2PointNum (code) {
        return /^(0|[1-9][0-9]{0,9})(\.[0-9]{1,2})?$/.test(code);
    },
    /**
     * 验证数字(包含不限小数点)
    */
    checkNum (str) {
        var re = /^[0-9]+.?[0-9]*$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证数字(正整数)
    */
    checkIntNum (str) {
        var re = /^[0-9]*[1-9][0-9]*$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证非负整数
    */
    checkUnIntNum (str) {
        var re = /^\d+$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证数字为正数且最多包含两位小数
    */
    checkInt2PointNum (str) {
        let re = /^[0-9]+(.[0-9]{1,2})?$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
};

```

* PDClient/project/App/utils/common/index.js

```js
module.exports = {
    until (test, iterator, callback) {
        if (!test()) {
            iterator((err) => {
                if (err) {
                    return callback(err);
                }
                this.until(test, iterator, callback);
            });
        } else {
            callback();
        }
    },
    N (num, rank = 2) {
        typeof num !== 'number' && (num = 0);
        return parseFloat(num.toFixed(rank));
    },
    toThousands (num) {
        return (num || 0).toString().replace(/(\d)(?=(?:\d{3})+$)/g, '$1,');
    },
    getPercentages (list) {
        const sum = _.sum(list);
        return list.map((v) => Math.round(v * 100 / sum) + '%');
    },
    getVisibleText (text, n) {
        let realLength = 0, len = text.length, preLen = -1, charCode = -1, needCut = false;
        for (let i = 0; i < len; i++) {
            charCode = text.charCodeAt(i);
            if (charCode >= 0 && charCode <= 128) {
                realLength += 1;
            } else {
                realLength += 2;
            }
            if (preLen === -1 && realLength >= n) {
                preLen = i + 1;
            } else if (realLength > n + 2) {
                needCut = true;
                break;
            }
        }
        if (needCut) {
            text = text.substr(0, preLen) + '..';
        }
        return text;
    },
    cutLimitText (text, n) {
        let realLength = 0, len = text.length, preLen = -1, charCode = -1, needCut = false;
        for (let i = 0; i < len; i++) {
            charCode = text.charCodeAt(i);
            if (charCode >= 0 && charCode <= 128) {
                realLength += 1;
            } else {
                realLength += 2;
            }
            if (preLen === -1 && realLength >= n) {
                preLen = i + 1;
            } else if (realLength > n) {
                needCut = true;
                break;
            }
        }
        if (needCut) {
            text = text.substr(0, preLen);
        }
        return text;
    },
    getAddressTitleArray (list = [], lastCode) {
        let options;
        let value = [];
        for (const item of list) {
            const parent = _.find(item, o => o.code === lastCode) || {};
            parent.children = options;
            lastCode = parent.parentCode;
            parent.name && (value.unshift(parent));
            options = item;
        }
        return value;
    },
    getStartPointTitleArray (list = [], lastCode, id) { // 如果始发地是分店或者收货点，则传id，否则不传，一旦传了id，lastCode则无效
        let options;
        let value = [];
        for (const item of list) {
            const parent = _.find(item, o => !id ? o.code === lastCode : o.id === id) || {};
            parent.children = options;
            lastCode = parent.isLeaf ? parent.addressRegionLastCode : parent.parentCode;
            parent && value.unshift(parent);
            options = item;
            id = undefined;
        }
        return value;
    },
};

```

* PDClient/project/App/utils/date/index.js

```js
const moment = require('moment');

module.exports = {
    createDateData (start, end) {
        let date = [];
        let iy = start.year(), im = start.month() + 1, id = start.date();
        let ey = end.year(), em = end.month() + 1, ed = end.date();
        for (let y = iy; y <= ey; y++) {
            let month = [];
            let mm = [0, 31, (!(y % 4) & (!!(y % 100))) | (!(y % 400)) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            let iim = (y === iy) ? im : 1;
            let eem = (y === ey) ? em : 12;
            for (let m = iim; m <= eem; m++) {
                let day = [];
                let iid = (y === iy && m === im) ? id : 1;
                let eed = (y === ey && m === em) ? ed : mm[m];
                for (let d = iid; d <= eed; d++) {
                    day.push(d + '日');
                }
                month.push({ [m + '月']: day });
            }
            date.push({ [y + '年']: month });
        }
        return date;
    },
    createTimeData (start, end, date, hasSeconds) {
        const d = date.startOf('day');
        const isStart = d.isSame(moment(start).startOf('day'));
        const isEnd = d.isSame(moment(end).startOf('day'));
        let time = [];
        let ih = start.hour(), it = start.minute(), is = start.second();
        let eh = end.hour(), et = end.minute(), es = start.second();
        let iih = isStart ? ih : 0;
        let eeh = isEnd ? eh : 24;

        for (let h = iih; h < eeh; h++) {
            let minute = [];
            let iit = (isStart && h === ih) ? it : 0;
            let eet = (isEnd && h === eh) ? et : 60;
            for (let t = iit; t < eet; t++) {
                if (!hasSeconds) {
                    minute.push(t + '分');
                } else {
                    let second = [];
                    let iis = (isStart && h === ih && t === it) ? is : 1;
                    let ees = (isEnd && h === eh && t === et) ? es : 60;
                    for (let s = iis; s <= ees; s++) {
                        second.push(s + '秒');
                    }
                    minute.push({ [t + '分']: second });
                }
            }
            time.push({ [h + '时']: minute });
        }
        return time;
    },
    showDatePicker (Picker, start, end, selected) {
        return new Promise(async(resolve) => {
            const selectedValue = [selected.year() + '年', (selected.month() + 1) + '月', selected.date() + '日'];
            const pickerData = this.createDateData(start, end);
            Picker(pickerData, selectedValue, '选择日期').then((value) => {
                const time = moment(value.join(''), 'YYYY年M月D日');
                const date = moment(time.year() + '年' + (time.month() + 1) + '月' + time.date() + '日' + selected.hour() + '时' + selected.minute() + '分', 'YYYY年MM月DD日HH时mm分');
                resolve(date);
            });
        });
    },
    showTimePicker (Picker, start, end, selected, hasSeconds) {
        return new Promise(async(resolve) => {
            const selectedValue = [selected.hour() + '时', selected.minute() + '分', selected.second() + '秒'];
            const pickerData = this.createTimeData(start, end, selected, hasSeconds);
            Picker(pickerData, selectedValue, '选择时间').then((value) => {
                const time = moment(value.join(''), 'HH时mm分');
                const date = moment(selected.year() + '年' + (selected.month() + 1) + '月' + selected.date() + '日' + time.hour() + '时' + time.minute() + '分', 'YYYY年MM月DD日HH时mm分');
                resolve(date);
            });
        });
    },
};

```

* PDClient/project/App/utils/net/Get.js

```js
'use strict';

function GET (url, success, error) {
    console.log('getSend:', url);
    app.showLoading();
    fetch(url, {
        method: 'get',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
        },
    })
    .then((response) => response.json())
    .then((json) => {
        console.log('getRecv:', json);
        app.hideLoading();
        success && success(json);
    })
    .catch((err) => {
        app.hideLoading();
        if (!error || !error(err)) {
            Toast('网络出错');
        }
    });
}

module.exports = GET;

```

* PDClient/project/App/utils/net/Post.js

```js
'use strict';

module.exports = (url, parameter, success, failed, wait) => {
    console.log(url, 'send:', parameter);
    if (typeof failed === 'boolean') {
        wait = failed;
        failed = null;
    }
    if (wait) {
        app.showLoading();
    }
    fetch(url, {
        method: 'post',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(parameter),
    })
    .then((response) => response.json())
    .then((data) => {
        console.log(url, 'recv:', data);
        success(data);
        if (wait) {
            app.hideLoading();
        }
    })
    .catch((error) => {
        if (!failed || !failed(error)) {
            Toast('网络错误');
            console.log(url + ':网络错误', error);
            if (wait) {
                app.hideLoading();
            }
        }
    });
};

```

* PDClient/project/App/utils/net/Upload.js

```js
'use strict';

const FileTransfer = require('@remobile/react-native-file-transfer');

function UPLOAD (filePath, url, options, onprogress, success, failed, wait) {
    console.log(url, 'send:', options);
    if (typeof failed === 'boolean') {
        wait = failed;
        failed = null;
    }
    if (wait) {
        app.showLoading();
    }
    const fileTransfer = new FileTransfer();
    fileTransfer.onprogress = onprogress;
    fileTransfer.upload(filePath, app.route.ROUTE_UPDATE_FILE, (res) => {
        let json = {};
        try {
            json = JSON.parse(res.response);
        } catch (error) {
            if (!failed || !failed(error)) {
                Toast('数据解析错误');
                if (wait) {
                    app.hideLoading();
                }
            }
        }
        console.log(url, 'recv:', json);
        app.hideLoading();
        success(json);
    }, (err) => {
        if (!failed || !failed(err)) {
            Toast('上传失败');
            if (wait) {
                app.hideLoading();
            }
        }
    }, options);
}

module.exports = UPLOAD;

```

* PDClient/project/App/utils/net/index.js

```js
'use strict';

module.exports = {
    POST: require('./Post'),
    GET: require('./Get'),
    UPLOAD: require('./Upload'),
};

```

* PDClient/project/App/utils/qrcode/index.js

```js
module.exports = {
    genQRString (type, id) {
        const str = JSON.stringify({ c: 's', t: type, d: id });
        let output = '';
        for (let x = 0, y = str.length, charCode, hexCode; x < y; ++x) {
            charCode = str.charCodeAt(x);
            if (charCode < 128) {
                charCode += 128;
            } else if (charCode > 127) {
                charCode -= 128;
            }
            charCode = 255 - charCode;
            hexCode = charCode.toString(16);
            if (hexCode.length < 2) {
                hexCode = '0' + hexCode;
            }
            output += hexCode;
        }
        return output;
    },
    getQRResult (str) {
        let output = '';
        for (let x = 0, y = str.length, charCode, hexCode; x < y; x += 2) {
            hexCode = str.substr(x, 2);
            charCode = parseInt(hexCode, 16);
            charCode = 255 - charCode;
            if (charCode < 128) {
                charCode += 128;
            } else if (charCode > 127) {
                charCode -= 128;
            }
            output += String.fromCharCode(charCode);
        }
        try {
            const result = JSON.parse(output);
            if (result.c !== 's') {
                return undefined;
            }
            return { type: result.t, id: result.d };
        } catch (e) {
            return undefined;
        }
    },
};

```

* PDClient/project/App/modules/logisticsCompany/cargo/AddCar.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    ScrollView,
    TouchableOpacity,
} = ReactNative;
const { Button, CustomSheet, PageList } = COMPONENTS;
import moment from 'moment';
const CarInfo = require('./SelectCarType');

module.exports = React.createClass({
    statics: {
        title: '添加货车',
    },
    getInitialState () {
        return {
            actionSheetVisible: false,
            plateNo:'',
            insuanceMount:'',
            truckType:'',
            drivingLicense:'',
            phone:'',
            driver:'',
        };
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        this.setState({ actionSheetVisible:true });
    },
    submit () {
        const { carInfo, plateNo, insuanceMount, phone, driver, drivingLicense } = this.state;
        if (plateNo == null || plateNo == '') {
            Toast('车牌号不能为空');
        } else if (drivingLicense == null || drivingLicense == '') {
            Toast('行驶证号不能为空');
        } else if (carInfo == null || carInfo == '') {
            Toast('车长车型不能为空');
        } else if (insuanceMount == null || insuanceMount == '') {
            Toast('保险不能为空');
        } else if (phone == null || phone == '') {
            Toast('电话号码不能为空');
        } else if (!driver || driver == '') {
            Toast('司机必须先注册');
        } else {
            this.createTruck();
        }
    },
    createTruck () {
        const { carInfo, plateNo, insuanceMount, driver, drivingLicense } = this.state;
        const param = {
            userId: app.personal.info.userId,
            shopId: app.personal.currentShopId,
            plateNo,
            drivingLicense,
            truckType: carInfo,
            insuanceMount,
            driverId: driver.id,
        };
        POST(app.route.ROUTE_CREATE_TRUCK, param, this.doCreateTruckSuccess, true);
    },
    doCreateTruckSuccess (data) {
        if (data.success) {
            Toast('提交成功');
            app.pop();
            this.props.refreshList();
        } else {
            Toast(data.msg);
        }
    },
    chooseHistoryInfo (obj) {
        this.setState({
            plateNo:obj.plateNo,
            insuanceMount:obj.insuanceMount + '',
            drivingLicense:obj.drivingLicense,
            carInfo:obj.truckType,
        });
    },
    renderRow (obj, rowId) {
        return (
            <TouchableOpacity onPress={this.chooseHistoryInfo.bind(null, obj)}>
                <View style={styles.listRow}>
                    <Text style={styles.rowTitle}>{obj.plateNo}</Text>
                    <Text style={styles.rowInfo}>司机:{obj.driver.name}</Text>
                    <Text style={styles.rowTime}>{moment(obj.createTime).format('YYYY-MM-DD')}</Text>
                </View>
            </TouchableOpacity>
        );
    },
    setCarInfo (length, type) {
        this.setState({
            carInfo:length + type + '',
        });
    },
    getDriverInfoByPhone () {
        const param = {
            userId: app.personal.info.userId,
            phone:this.state.phone,
        };
        POST(app.route.ROUTE_GET_DRIVER_INFO_BY_PHONE, param, this.getDriverInfoByPhoneSuccess, false);
    },
    getDriverInfoByPhoneSuccess (data) {
        if (data.success) {
            this.setState({
                driver:data.context,
            });
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { carInfo, plateNo, insuanceMount, driver, drivingLicense } = this.state;
        return (
            <View style={styles.container}>
                <ScrollView>
                    <View style={styles.title}>
                        <Text style={styles.titleFont}>货车信息</Text>
                    </View>
                    <View>
                        <View style={styles.row}>
                            <Text style={styles.carInfoTitle}>车牌</Text>
                            <TextInput style={styles.carInfo}
                                underlineColorAndroid='transparent'
                                maxLength={7}
                                selectTextOnFocus
                                onChangeText={(text) => this.setState({ plateNo: text })}
                                defaultValue={plateNo == null ? '' : plateNo}
                                placeholderColor='#666666'
                                placeholder='请输入车牌号' />
                        </View>
                        <View style={styles.row}>
                            <Text style={styles.carInfoTitle}>行驶证</Text>
                            <TextInput style={styles.carInfo}
                                underlineColorAndroid='transparent'
                                selectTextOnFocus
                                maxLength={18}
                                defaultValue={drivingLicense == null ? '' : drivingLicense}
                                onChangeText={(text) => this.setState({ drivingLicense: text })}
                                placeholderColor='#666666'
                                placeholder='请输入行驶证号' />
                        </View>
                        <View style={styles.row}>
                            <Text style={styles.carInfoTitle}>保险</Text>
                            <TextInput style={styles.carInfo}
                                underlineColorAndroid='transparent'
                                maxLength={7}
                                selectTextOnFocus
                                onChangeText={(text) => this.setState({ insuanceMount: text })}
                                defaultValue={insuanceMount == null ? '' : insuanceMount}
                                placeholderColor='#666666'
                                placeholder='请输入保险' />
                        </View>
                        <TouchableOpacity
                            onPress={this.doShowActionSheet}
                            style={styles.row}>
                            <Text style={styles.carInfoTitle}>车长车型</Text>
                            <Text style={styles.carInfo}>{carInfo}</Text>
                        </TouchableOpacity>
                    </View>
                    <View style={styles.title}>
                        <Text style={styles.titleFont}>司机信息</Text>
                    </View>
                    <View>
                        <View style={styles.row}>
                            <Text style={styles.carInfoTitle}>电话号码</Text>
                            <TextInput style={styles.carInfo}
                                underlineColorAndroid='transparent'
                                selectTextOnFocus
                                maxLength={11}
                                onChangeText={(text) => this.setState({ phone: text })}
                                onBlur={this.getDriverInfoByPhone}
                                placeholderColor='#666666'
                                placeholder='请输入电话号码' />
                        </View>
                        <View style={styles.row}>
                            <Text style={styles.carInfoTitle}>姓名</Text>
                            <TextInput style={styles.carInfo}
                                underlineColorAndroid='transparent'
                                placeholderColor='#666666'
                                selectTextOnFocus
                                editable={false}
                                defaultValue={!driver ? '' : driver.name ? driver.name : '暂无'}
                                />
                        </View>
                    </View>
                    <Button onPress={this.submit} style={styles.btn} textStyle={styles.btnFont}>提交审核</Button>
                    <Text style={styles.history}>历史审核</Text>
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        listParam={{ userId: app.personal.info.userId,
                            shopId:app.personal.currentShopId }}
                        listName={'truckList'}
                        listUrl={app.route.ROUTE_GET_HISTORY_TRUCK_LIST}
                        refreshEnable
                            />
                </ScrollView>
                <CustomSheet
                    visible={this.state.actionSheetVisible} >
                    <CarInfo doClose={this.doCloseActionSheet} setCarInfo={this.setCarInfo} />
                </CustomSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    title:{
        height:30,
        justifyContent:'center',
        marginLeft:10,
    },
    titleFont:{
        fontSize:13,
    },
    row:{
        height:40,
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        marginBottom:1,
        alignItems:'center',
    },
    carInfo:{
        flex:1.6,
        fontSize:14,
        padding:0,
        color:'#333333',
        marginLeft:(sr.w - 300) / 2,
        textAlign:'right',
        marginRight:10,
    },
    carInfoTitle:{
        flex:0.4,
        fontSize:14,
        color:'#666666',
        marginLeft:10,
    },
    btn:{
        width:351,
        height:45,
        marginTop:18,
        borderRadius:4,
        alignSelf:'center',
        backgroundColor:'#FE9917',
    },
    btnFont:{
        fontWeight:'400',
    },
    history:{
        fontSize:13,
        marginLeft:10,
        marginTop:50,
        marginBottom:8,
    },
    listRow:{
        backgroundColor:'#FFFFFF',
        marginBottom:1,
        paddingLeft:10,
        paddingTop:5,
        height:50,
    },
    rowTitle:{
        flex:1,
    },
    rowInfo:{
        flex:1,
        fontSize:12,
        color:'#888888',
    },
    rowTime:{
        position:'absolute',
        left:(sr.w + 180) / 2,
        top:5,
        color:'#888888',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/BranchList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '物流超市',
        leftButton:{ handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        const { onWillFocus } = this.props;
        app.pop();
        if (onWillFocus) {
            onWillFocus();
        }
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            choose:app.personal.currentShopIndex,
        };
    },
    doChoose (rowId) {
        const { setCurrentShopId } = this.props;
        this.setState({
            choose:rowId,
        });
        app.personal.setCurrentShopIndex(rowId);
        app.personal.currentShopName = app.personal.info.shipper && app.personal.info.shipper.registerShopList[app.personal.currentShopIndex].name || '';
        app.personal.currentShopId = app.personal.info.shipper && app.personal.info.shipper.registerShopList[app.personal.currentShopIndex].id || null;
        if (setCurrentShopId) {
            setCurrentShopId(app.personal.currentShopId);
        }
    },
    renderRow (obj, sectionID, rowId) {
        const { choose } = this.state;
        return (
            <TouchableOpacity onPress={this.doChoose.bind(null, rowId)}>
                <View style={styles.itemContainer}>
                    <Text style={styles.itemText}>{obj.name}</Text>
                    <Image style={styles.choose}
                        source={choose == rowId ? app.img.common_radio : {}} />
                </View>
            </TouchableOpacity>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    dataSource={this.ds.cloneWithRows(app.personal.info.shipper.registerShopList)}
                    renderRow={this.renderRow}
                    enableEmptySections
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop:10,
    },
    itemContainer:{
        height:45,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-between',
        alignItems:'center',
    },
    itemText:{
        fontSize:14,
        color:'#333333',
        marginLeft:15,
    },
    choose:{
        height:10,
        width:10,
        marginRight:15,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/CarLoading.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { Button, PageList } = COMPONENTS;
const addCar = require('./AddCar');
const findMoving = require('./FindMoving');
const ScanOrderDetail = require('./ScanOrderDetail');
const ScanBarCode = require('../../common/ScanBarCode');
module.exports = React.createClass({
    statics: {
        title: '装车',
    },
    getInitialState () {
        return {
            type:false,
        };
    },
    onBarCodeRead (truckId, data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            this.showScanOrderDetail(truckId, data.id);
        }
    },
    startScanOrder (truckId) {
        if (app.personal.isFinishScan) {
            const param = {
                userId: app.personal.info.userId,
                truckId: truckId,
            };
            POST(app.route.ROUTE_START_SCAN_ORDER, param, this.startScanOrderSuccess.bind(null, truckId), true);
        } else {
            app.showModal(<ScanBarCode onBarCodeRead={this.onBarCodeRead.bind(null, truckId)} />);
        }
    },
    startScanOrderSuccess (truckId, data) {
        if (data.success) {
            app.personal.setIsFinishScan(true);
            app.showModal(<ScanBarCode onBarCodeRead={this.onBarCodeRead.bind(null, truckId)} />);
        } else {
            app.personal.setIsFinishScan(false);
            Toast(data.msg);
        }
    },
    showScanOrderDetail (truckId, orderId) {
        app.push({
            component:ScanOrderDetail,
            passProps:{
                truckId,
                orderId,
            },
        });
    },
    reload () {
        const { type } = this.state;
        this.setState({
            type:!type,
        });
    },
    findMoving (id) {
        app.push({
            component:findMoving,
            passProps:{
                truckId: id,
                reload: this.reload,
                refreshList:this.refreshList,
            },
        });
    },
    addCar () {
        app.push({
            component:addCar,
            passProps:{
                refreshList:this.refreshList,
            },
        });
    },
    refreshList () {
        this.listView.refresh();
    },
    btnTruckState (obj) {
        if (obj.state == TS.TS_READY_SEARCH_CARRY_PARTMENT) {
            return (<Button style={styles.btn} textStyle={styles.btnFont} onPress={this.findMoving.bind(null, obj.id)}>找搬运队</Button>);
        } else if (obj.state == TS.TS_READY_SCAN_LOAD) {
            return (<Button style={styles.btn} textStyle={styles.btnFont} onPress={this.startScanOrder.bind(null, obj.id)}>扫描装车</Button>);
        } else {
            return (<Text />);
        }
    },
    renderRow (obj, rowId) {
        return (
            <View style={styles.item}>
                <View style={styles.info}>
                    <Text style={styles.licensePlate}>{obj.plateNo}</Text>
                    <Text style={styles.carInfo}>司机:{!obj.driver.name ? '暂无' : obj.driver.name}</Text>
                    <Text style={styles.carInfo}>车长及车型:{obj.truckType}</Text>
                </View>
                <View style={styles.right}>
                    <Text style={styles.stateValue}>{TS.MAP[obj.state]}</Text>
                    {
                        this.btnTruckState(obj)
                    }
                </View>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.itemAddCar}>
                    <Button style={styles.btnAddCar} textStyle={styles.btnAddCarFont} onPress={this.addCar}>添加货车</Button>
                </View>
                <View style={styles.listTitle}>
                    <Text style={styles.listTitleFont}>货车列表</Text>
                </View>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'truckList'}
                    renderSeparator={null}
                    listParam={{ userId: app.personal.info.userId, shopId: app.personal.currentShopId }}
                    listUrl={app.route.ROUTE_GET_WORK_TRUCKLIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    itemAddCar:{
        height:80,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    btnAddCar:{
        width:150,
        height:35,
        backgroundColor:'#FE9917',
        borderRadius: 4,
    },
    btnAddCarFont:{
        fontWeight:'500',
    },
    listTitle:{
        height:40,
    },
    listTitleFont:{
        marginTop:18,
        marginLeft:10,
        fontSize:14,
    },
    item:{
        height:70,
        backgroundColor:'#FFFFFF',
        flexDirection:'row',
        justifyContent:'space-between',
        marginBottom:5,
    },
    info:{
        marginLeft:10,
        justifyContent:'center',
    },
    licensePlate:{
        fontSize:14,
        color:'#333333',
        marginBottom:2,
    },
    carInfo:{
        fontSize:14,
        color:'#888888',
        marginBottom:2,
    },
    right:{
        flexDirection:'row',
        marginRight:10,
    },
    stateValue:{
        fontSize:14,
        color:'#29951b',
        marginTop:5,
    },
    btn:{
        width:80,
        height:22,
        backgroundColor:'#FFFFFF',
        borderRadius:4,
        borderWidth:0.5,
        borderColor:'#ee1822',
        position:'absolute',
        right:3,
        bottom:10,
    },
    btnFont:{
        color:'#ee1822',
        fontSize:12,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/FindMoving.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ListView,
} = ReactNative;
const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '搬运队',
    },
    getInitialState () {
        return {
            ds: new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 }),
            list: [],
        };
    },
    componentWillMount () {
        const param = {
            userId:app.personal.info.userId,
            truckId:this.props.truckId,
        };
        POST(app.route.ROUTE_GET_CARRY_PARTMENT_LIST, param, this.doReceiveSuccess, true);
    },
    doReceiveSuccess (data) {
        if (data.success) {
            this.setState({
                list:data.context.partmenList,
            });
        } else {
            Toast(data.msg);
        }
    },
    doChoose (obj) {
        const param = {
            userId: app.personal.info.userId,
            truckId: this.props.truckId,
            carryPartmentId: obj.id,
        };
        POST(app.route.ROUTE_SELECT_CARRY_PARTMENT, param, this.doSelectCarryPartmentSuccess.bind(null, obj), true);
    },
    doSelectCarryPartmentSuccess (obj, data) {
        if (data.success) {
            Toast('成功选择搬运队');
            app.pop();
            this.props.refreshList();
        } else {
            Toast(data.msg);
        }
    },
    renderRow (obj, rowId) {
        return (
            <View style={styles.row}>
                <Text style={styles.name}>{obj.name}</Text>
                <Text style={styles.people}>人数:{obj.memberCount}人</Text>
                <Text style={styles.people}>{obj.phoneList}</Text>
                <Text style={styles.price}>¥{obj.price}/吨</Text>
                <Button onPress={this.doChoose.bind(null, obj)} style={styles.btn} textStyle={styles.btnFont}>成交</Button>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    dataSource={this.state.ds.cloneWithRows(this.state.list)}
                    renderRow={this.renderRow}
                />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    row:{
        backgroundColor:'#FFFFFF',
        height:75,
        marginTop:8,
        paddingLeft:10,
    },
    name:{
        fontSize:14,
        color:'#333333',
        flex:1,
        marginTop:8,
    },
    people:{
        fontSize:12,
        color:'#888888',
        flex:1,

    },
    price:{
        position:'absolute',
        fontSize:13,
        right:15,
        top:8,
        color:'#e7222d',
    },
    btn:{
        width:75,
        height:22,
        backgroundColor:'#FFFFFF',
        borderRadius:4,
        borderWidth:0.5,
        borderColor:'#ee1822',
        position:'absolute',
        right:15,
        bottom:10,
    },
    btnFont:{
        color:'#ee1822',
        fontSize:12,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/FinishScanOrder.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;
const { Button, CustomSheet } = COMPONENTS;
const PayInfo = require('../../common/PayInfo');
const OrderListOrderList = require('../order/OrderList');
const PayPassword = require('../../common/PayPassword');

module.exports = React.createClass({
    statics: {
        title: '搬运单',
    },
    getInitialState () {
        return {
            actionSheetVisible: false,
        };
    },
    showOrderList (truckId) {
        app.push({
            component: OrderListOrderList,
            passProps: {
                truckId,
            },
        });
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        this.setState({ actionSheetVisible:true });
    },
    doConfirmPay () {
        const { data } = this.props;
        const param = {
            userId: app.personal.info.userId,
        };
        app.push({
            component:PayPassword,
            passProps:{
                param,
                routeName : app.route.ROUTE_PAY_FOR_CARRY_PARTMENT,
                prompt : '支付成功',
                doCloseActionSheet : this.doCloseActionSheet,
                money:app.utils.N(data.carryPrice * data.totalWeight),
            },
        });
    },
    render () {
        const { data } = this.props;
        return (
            <View style={styles.container}>
                <TouchableOpacity style={styles.item} onPress={this.showOrderList.bind(null, data.id)}>
                    <View style={styles.row}>
                        <Text style={styles.info}>货车号: {data.plateNo}</Text>
                        <Text style={styles.info}>行驶证号: {data.drivingLicense}</Text>
                        <Text style={styles.info}>货车类型: {data.truckType}</Text>
                    </View>
                    <View style={styles.row}>
                        <Text style={styles.info}>重量: {data.totalWeight}吨</Text>
                        <Text style={styles.info}>方量: {data.totalSize}m³</Text>
                        <Text style={styles.info}>件数: {data.totalNumbers}</Text>
                    </View>
                    <View style={styles.row}>
                        <Text style={styles.info}>搬运费: {app.utils.N(data.carryPrice * data.totalWeight)}元</Text>
                        <Text style={styles.info}>保险费: {data.insuanceMount}元</Text>
                        <Text style={styles.info}>搬运部: {data.carryPartment ? data.carryPartment.name : ''}</Text>
                    </View>
                </TouchableOpacity>
                <View style={styles.bottomView}>
                    <Button onPress={this.doShowActionSheet} style={styles.btnPayNow} textStyle={styles.btnPayNowText}>
                        付搬运费
                    </Button>
                </View>
                <CustomSheet
                    visible={this.state.actionSheetVisible} >
                    <PayInfo doClose={this.doCloseActionSheet} data={data} doConfirmPay={this.doConfirmPay} type={'carry'} />
                </CustomSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor:'#f4f4f4',
    },
    item: {
        padding:10,
        backgroundColor:'#FFFFFF',
    },
    row:{
        flexDirection:'row',
        marginTop:10,
        alignItems:'center',
    },
    icon:{
        width:70,
        height:70,
        borderRadius:2,
        marginLeft:8,
    },
    rowInfo:{
        marginTop:10,
        marginBottom:10,
        marginLeft:5,
    },
    id:{
        fontSize:14,
        color:'#333333',
        flex:1,
    },
    info:{
        fontSize:12,
        color:'#888888',
        flex:1,
    },
    bottomView:{
        position:'absolute',
        bottom:300,
        width:sr.w,
    },
    bottomInfo:{
        flexDirection: 'row',
        backgroundColor:'white',
    },
    infoLeft:{
        height:45,
        flexDirection: 'row',
        flex:1,
        justifyContent:'center',
        alignItems: 'center',
    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    btnPayNow:{
        height:45,
        borderRadius:0,
    },
    btnPayNowText:{
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/ScanOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
import moment from 'moment';

module.exports = React.createClass({
    statics: {
        title: '扫描订单详情',
    },
    getInitialState () {
        return {
            data:[],
            count:1,
            obj:[],
        };
    },
    componentWillMount () {
        this.getOrderDetail();
    },
    getOrderDetail () {
        const { truckId, orderId } = this.props;
        const param = {
            userId:app.personal.info.userId,
            truckId,
            orderId,
            count:0,
        };
        POST(app.route.ROUTE_SCAN_LOAD_ORDER, param, this.postScanOrderSuccess, true);
    },
    postScanOrderSuccess (data) {
        if (data.success) {
            this.setState({
                data:data.context,
                obj:data.context.unloadAllOrderList[0],
            });
        } else {
            Toast(data.msg);
            app.pop();
        }
    },
    minusCount () {
        const { count } = this.state;
        if (count > 0) {
            this.setState({ count:count - 1 });
        } else {
            Toast('装车数量不能小于0');
        }
    },
    addCount () {
        const { count, obj } = this.state;
        if (count < obj.unloadNumber) {
            this.setState({ count:count + 1 });
        } else {
            Toast('装车数量不能大于未装载件数');
        }
    },
    showScanResult () {
        const { truckId, orderId } = this.props;
        const { count, obj } = this.state;
        if (count >= 0 && count <= obj.unloadNumber) {
            app.navigator.replace({
                component: require('./ScanResult'),
                passProps:{
                    truckId,
                    orderId,
                    count:count * 1,
                },
            });
        } else {
            Toast('装车数量有误');
        }
    },
    doCancel () {
        app.navigator.popToTop();
    },
    render () {
        const { data, count, obj } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.containerDetails}>
                    <Image style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri:data.latestOrder ? data.latestOrder.photo : '' }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{app.personal.currentShopName}</Text>
                                <Text >-</Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.endPoint}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>已载重量：{app.utils.N(data.totalWeight)}m³</Text>
                        <Text style={styles.textDetailsItem}>已载方量：{app.utils.N(data.totalSize)}吨</Text>
                        <Text style={styles.textDetailsItem}>未装载件数：{app.utils.N(obj.unloadNumber)}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.modifyCount}>
                    <Text style={styles.modifyCountTitle}>装车数量</Text>
                    <TouchableOpacity onPress={this.minusCount}>
                        <Text style={styles.imgSymbol}>－</Text>
                    </TouchableOpacity>
                    <TextInput
                        style={styles.countFont}
                        defaultValue={count + ''}
                        underlineColorAndroid='transparent'
                        onChangeText={(text) => this.setState({ count:text })}
                        keyboardType='numeric' />
                    <TouchableOpacity onPress={this.addCount}>
                        <Text style={styles.imgSymbol}>＋</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.bottom}>
                    <Button style={styles.btnConfirm} textStyle={styles.btnFont} onPress={this.showScanResult}>确认</Button>
                    <Button style={styles.btnCancel} textStyle={styles.btnFont} onPress={this.doCancel}>取消</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    containerDetails:{
        height:150,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    imageGoods:{
        height:125,
        width:125,
        marginLeft:12,
        marginTop:11,
    },
    goodsDetails:{
        marginLeft:8,
        height:125,
        paddingBottom:8,
        marginTop:10,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
        flex:1,
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    detailsAddress:{
        fontSize:16,
        width:100,
        color:'#333333',
        flexDirection: 'row',
    },
    moneyLeft:{
        fontSize:14,
        color:'#333333',
    },
    moneyRight:{
        fontSize:15,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:14,
        color:'#888888',
        flex:1,
    },
    modifyCount:{
        flexDirection:'row',
        backgroundColor:'#f4f4f4',
        height:50,
        marginTop:10,
        alignItems:'center',
    },
    modifyCountTitle:{
        marginLeft:20,
        color:'#888888',
        marginRight:130,
    },
    imgSymbol:{
        marginRight:10,
        fontSize:20,
    },
    countFont:{
        padding:0,
        fontSize:14,
        width:30,
        height:20,
        color:'#888888',
        backgroundColor:'#FFFFFF',
        marginRight:10,
        alignSelf:'center',
        textAlign:'right',
    },
    btnConfirm:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#FE9917',
    },
    btnCancel:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    bottom:{
        height:45,
        width:sr.w,
        flexDirection:'row',
        position:'absolute',
        bottom:0,
        right:0,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/ScanResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
} = ReactNative;

const { Button } = COMPONENTS;
import moment from 'moment';
const FinishScanOrder = require('./FinishScanOrder');
const ScanBarCode = require('../../common/ScanBarCode');

module.exports = React.createClass({
    statics: {
        title: '扫描结果',
    },
    componentWillMount () {
        const { truckId, orderId, count } = this.props;
        this.postScanOrder(truckId, orderId, count);
    },
    postScanOrder (truckId, orderId, count) {
        const param = {
            userId:app.personal.info.userId,
            truckId,
            orderId,
            count,
        };
        POST(app.route.ROUTE_SCAN_LOAD_ORDER, param, this.postScanOrderSuccess, true);
    },
    postScanOrderSuccess (data) {
        if (data.success) {
            this.setState({
                data:data.context,
                list:data.context.unloadAllOrderList,
                tmp:data.context.latestOrder,
            });
        } else {
            Toast(data.msg);
        }
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list: [],
            data:{},
            tmp:[],
        };
    },
    finishScanOrder () {
        POST(app.route.ROUTE_FINISH_SCAN_ORDER,
            { userId:app.personal.info.userId },
            (data) => {
                if (data.success) {
                    app.push({
                        component: FinishScanOrder,
                        passProps: { data:data.context } });
                } else {
                    Toast(data.msg);
                }
            },
                true);
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            const { truckId } = this.props;
            app.navigator.replace({
                component: require('./ScanOrderDetail'),
                passProps: {
                    truckId,
                    orderId:data.id,
                },
            });
        }
    },
    continueScanOrder () {
        app.showModal(
            <ScanBarCode onBarCodeRead={this.onBarCodeRead} />
        );
    },
    renderHeader () {
        const { data, tmp } = this.state;
        return (
            <View style={styles.header}>
                <View style={styles.top}>
                    <View style={styles.headerItem}>
                        <Text style={styles.headerFontTop}>{data.orderCount}单</Text>
                        <Text style={styles.headerFont}>已载单数</Text>
                    </View>
                    <View style={styles.headerItem}>
                        <Text style={styles.headerFontTop}>{data.totalNumbers}件</Text>
                        <Text style={styles.headerFont}>已载件数</Text>
                    </View>
                    <View style={styles.headerItem}>
                        <Text style={styles.headerFontTop}>{app.utils.N(data.totalWeight)}吨</Text>
                        <Text style={styles.headerFont}>已载重量</Text>
                    </View>
                    <View style={styles.headerItem}>
                        <Text style={styles.headerFontTop}>{app.utils.N(data.totalSize)}m³</Text>
                        <Text style={styles.headerFont}>已载方量</Text>
                    </View>
                </View>
                <View style={styles.order}>
                    <Image
                        resizeMode='cover'
                        defaultSource={app.img.common_default}
                        source={{ uri:tmp.photo }}
                        style={styles.icon} />
                    <View style={styles.rowInfo}>
                        <Text style={styles.id}
                            numberOfLines={1}
                            ellipsizeMode='tail'>货单号:{tmp.id}</Text>
                        <Text style={styles.info}>重量:{app.utils.N(tmp.weight)}吨</Text>
                        <Text style={styles.info}>方量:{app.utils.N(tmp.size)}m³</Text>
                        <Text style={styles.info}>收货地址:{tmp.endPoint}</Text>
                    </View>
                    <Text style={styles.timeInfo}>{moment(tmp.createTime).format('YYYY-MM-DD')}</Text>
                </View>
                <View style={styles.white}>
                    <Text style={styles.whiteText}>未完成货单列表</Text>
                </View>
            </View>
        );
    },
    renderRow (obj) {
        return (
            <View style={styles.row}>
                <Image
                    resizeMode='cover'
                    defaultSource={app.img.common_default}
                    source={{ uri:obj.photo }}
                    style={styles.icon} />
                <View style={styles.rowInfo}>
                    <Text style={styles.id}
                        numberOfLines={1}
                        ellipsizeMode='tail'>货单号:{obj.id}</Text>
                    <Text style={styles.info}>总件数:{app.utils.N(obj.totalNumbers)}件</Text>
                    <Text style={styles.infoRed}>未装载:{app.utils.N(obj.unloadNumber)}件</Text>
                    <Text style={styles.info}>收货地址:{obj.endPoint}</Text>
                </View>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    dataSource={this.ds.cloneWithRows(this.state.list)}
                    renderRow={this.renderRow}
                    renderHeader={this.renderHeader}
                            />
                <View style={styles.bottom}>
                    <Button style={styles.btnEnd} textStyle={styles.btnFont} onPress={this.finishScanOrder}>结束扫描</Button>
                    <Button style={styles.btnContinue} textStyle={styles.btnFont} onPress={this.continueScanOrder}>继续扫描</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    header:{
        height:200,
    },
    top:{
        flexDirection:'row',
        height:60,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    headerItem:{
        flex:1,
        alignItems:'center',
    },
    headerFontTop:{
        fontSize:14,
        color:'#333333',
        marginBottom:2,
    },
    headerFont:{
        fontSize:14,
        color:'#888888',
        marginTop:2,
    },
    order:{
        flexDirection:'row',
        height:90,
        backgroundColor:'#FFFFFF',
        marginTop:10,
        alignItems:'center',
    },
    headText:{
        color:'#333333',
        marginTop:15,
        marginLeft:10,
        fontSize:14,
        flexDirection:'row',
    },
    unload:{
        height:40,
        backgroundColor:'#FFFFFF',
        marginTop:5,
        flexDirection:'row',
        alignItems:'center',
        justifyContent:'space-between',
    },
    unloadLeft:{
        flexDirection:'row',
    },
    carNumber:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    goodsNumber:{
        fontSize:12,
        marginTop:2,
        marginLeft:6,
        color:'#f29c00',
    },
    unloadRight:{
        fontSize:14,
        color:'red',
        marginRight:10,
    },
    previous:{
        fontSize:15,
        color:'#ec202b',
    },
    row:{
        flexDirection:'row',
        height:90,
        backgroundColor:'#FFFFFF',
        marginTop:10,
        alignItems:'center',
    },
    icon:{
        width:70,
        height:70,
        borderRadius:2,
        marginLeft:8,
    },
    rowInfo:{
        marginTop:10,
        marginBottom:10,
        marginLeft:5,
    },
    id:{
        fontSize:14,
        color:'#333333',
        width:150,
        flex:1,
    },
    info:{
        fontSize:12,
        color:'#888888',
        marginTop:1,
        flex:1,
    },
    infoRed:{
        fontSize:12,
        color:'red',
        marginTop:5,
        flex:1,
    },
    timeInfo:{
        fontSize:12,
        width:80,
        color:'#888888',
        alignSelf:'flex-start',
        marginTop:12,
        marginLeft:30,
    },
    white:{
        height:30,
        backgroundColor:'#FFFFFF',
        marginTop:10,
        justifyContent:'center',
    },
    whiteText:{
        marginLeft:10,
        fontSize:14,
        color:'#333333',
    },
    btnContinue:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#FE9917',
    },
    btnEnd:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    bottom:{
        height:45,
        flexDirection:'row',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/SelectCarType.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const carInfo = [
    {
        name:'车长',
        array:['4.5米', '5米', '5.5米', '6.5米', '7.5米', '8.5米', '9.6米', '13.5米', '17.5米'],
    },
    {
        name:'车型',
        array:['其他', '高栏', '平板', '箱式', '高低板', '保温'],
    },
];
module.exports = React.createClass({
    getInitialState () {
        return {
            lengthName:'4.5米',
            typeName:'不限',
            selectArray : [0, 0],
        };
    },
    toClose () {
        app.pop();
    },
    toChoose (i, index, obj) {
        const { selectArray } = this.state;
        if (i == 0) {
            selectArray[i] = index;
            this.setState({
                lengthName:obj,
            });
        } else {
            selectArray[i] = index;
            this.setState({
                typeName:obj,
            });
        }
    },
    toSubmit (lengthName, typeName) {
        const { setCarInfo, doClose } = this.props;
        setCarInfo(lengthName, typeName);
        doClose();
    },
    render () {
        const { selectArray, lengthName, typeName } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.textTop}>车长车型</Text>
                    <TouchableOpacity onPress={this.props.doClose}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.cargo_cancel}
                            style={styles.closeStyle} />
                    </TouchableOpacity>
                </View>
                <View style={styles.listView} />
                {
                    carInfo.map((item, i) => (
                        <View style={styles.containerMiddle} key={i}>
                            <Text style={styles.rowTitle}>{item.name}</Text>
                            <View style={styles.row}>
                                {
                                    item.array.map((obj, index) => (
                                        <TouchableOpacity
                                            key={index}
                                            onPress={this.toChoose.bind(null, i, index, obj)}
                                            style={selectArray[i] == index ? styles.chooseItem : styles.item}
                                            >
                                            <Text style={styles.itemFont}>{obj}</Text>
                                        </TouchableOpacity>
                                    ))
                                }
                            </View>
                        </View>
                        ))
                    }
                <Button style={styles.btn} textStyle={styles.btnFont} onPress={this.toSubmit.bind(null, lengthName, typeName)}>确认</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        height:350,
        backgroundColor:'#FFFFFF',
    },
    containerTop:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',

    },
    textTop:{
        fontSize:17,
        marginLeft:(sr.w - 17 * 4) / 2,
        color:'#333333',
    },
    closeStyle:{
        height:15,
        width:15,
        marginRight:10,
    },
    containerMiddle:{
        marginTop:1,
        backgroundColor:'#ffffff',
    },
    rowTitle:{
        fontSize:13,
        marginLeft:10,
    },
    row:{
        flexDirection:'row',
        marginLeft:5,
        flexWrap:'wrap',
        width:sr.w,
    },
    item:{
        width:50,
        height:20,
        backgroundColor:'#f4f4f4',
        margin:5,
        alignItems:'center',
        justifyContent:'center',
    },
    chooseItem:{
        width:50,
        height:20,
        backgroundColor:'#FE9917',
        margin:5,
        alignItems:'center',
        justifyContent:'center',
    },
    itemFont:{
        fontSize:12,
    },
    rowTitle1:{
        fontSize:13,
        marginLeft:10,
        marginTop:19,
    },
    btn:{
        height:45,
        width:351,
        backgroundColor:'#c81622',
        borderRadius:4,
        alignSelf:'center',
        marginTop:50,
    },
    btnFont:{
        color:'#FFFFFF',
    },
    listView:{
        height:1,
        backgroundColor:'#f4f4f4',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/ShippingList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';
import moment from 'moment';
const { PageList } = COMPONENTS;

let sumWeight = 0;
let sumNumber = 0;
let sumSize = 0;

module.exports = React.createClass({
    statics: {
        title: '货单列表',
    },
    getInitialState () {
        return {
            list:[],
        };
    },
    doChoose (obj, rowId) {
        const { list } = this.state;
        list[rowId].selected = !list[rowId].selected;
        this.setState({ list });
        this.doTotalCalculation();
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({ list });
        this.doTotalCalculation();
    },
    doTotalCalculation () {
        const { list } = this.state;
        sumWeight = 0;
        sumNumber = 0;
        sumSize = 0;
        for (var i in list) {
            if (list[i].selected) {
                sumSize = sumSize + list[i].item.size;
                sumNumber = sumNumber + list[i].item.totalNumbers;
                sumWeight = sumWeight + list[i].item.weight;
            }
        }
    },
    renderRow (obj, rowId) {
        const { list } = this.state;
        if (!_.find(list, (o) => o.index == rowId)) {
            list.push({ selected:false, index:rowId, item:obj });
        }
        return (
            <View style={styles.itemContainer}>
                <TouchableOpacity
                    style={styles.detail}
                    onPress={this.doChoose.bind(null, obj, rowId)}>
                    <Image style={styles.choose}
                        source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose} />
                    <View style={styles.rightContainer}>
                        <View style={styles.pointContainer}>
                            <View style={{ flexDirection: 'row' }}>
                                <Text style={styles.itemAddress} numberOfLines={1}>{app.personal.currentShopName}</Text>
                                <Image style={styles.point} source={app.img.cargo_point} />
                                <Text style={styles.itemAddress} numberOfLines={1}>{obj.endPoint}</Text>
                            </View>
                            <Text style={styles.itemDate}>{moment(obj.createTime).format('YYYY-MM-DD')}</Text>
                        </View>
                        <View style={styles.pointContainerTop}>
                            <Text style={styles.textLeft}>重量：</Text>
                            <Text style={styles.textRight}>{obj.weight}吨</Text>
                        </View>
                        <View style={styles.itemNumber}>
                            <Text style={styles.textLeft}>方量：</Text>
                            <Text style={styles.textRight}>{obj.size}m³</Text>
                        </View>
                        <View style={styles.itemNumber}>
                            <Text style={styles.textLeft}>件数：</Text>
                            <Text style={styles.textRight}>{obj.totalNumbers}件</Text>
                        </View>
                    </View>
                </TouchableOpacity>
            </View>

        );
    },
    render () {
        const { list } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        const point = this.props.point;
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'orderList'}
                    listParam={{ userId: app.personal.info.userId, shopId:app.personal.currentShopId, endPoint:point }}
                    listUrl={app.route.ROUTE_GET_NEED_SEND_ORDER_LIST_BY_END_POINT}
                    refreshEnable
                    />
                <View style={styles.selectedAllContainer}>
                    <TouchableOpacity onPress={this.doSelectedAll}
                        style={styles.listView}>
                        <Image style={styles.chooseAll}
                            source={status ? app.img.order_choose : app.img.order_no_choose} />
                        <Text style={styles.selectedAllText}>全选</Text>
                    </TouchableOpacity>
                    <Text style={styles.totalText}>总计</Text>
                    <Text style={styles.totalItem}>{sumWeight}吨</Text>
                    <Text style={styles.totalItem}>{sumSize}m³</Text>
                    <Text style={styles.totalItem}>{sumNumber}件</Text>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop:10,
    },
    balance:{
        width:300,
        height:30,
        marginLeft:(sr.w - 300) / 2,
        flexDirection: 'row',
        justifyContent:'center',
        alignItems:'center',
        marginBottom:10,
    },
    balanceText:{
        fontSize:14,
        color:'#f69838',
        marginRight:5,
    },
    balanceTextRight:{
        fontSize:12,
        color:'#f69838',
        marginLeft:5,
    },
    itemContainer:{
        height:75,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    choose:{
        height:9,
        width:9,
        marginLeft:10,
        marginTop:33,
    },
    detail:{
        flexDirection: 'row',
        width:sr.w,
    },
    rightContainer:{
        marginTop:5,
        marginBottom:5,
        marginLeft:10,
        justifyContent:'center',
    },
    pointContainer:{
        flexDirection: 'row',
        alignItems:'center',
    },
    itemDate:{
        fontSize:12,
        color:'#888888',
        position:'absolute',
        right:-100,
    },
    pointContainerTop:{
        flexDirection: 'row',
        alignItems:'center',
        flex:1,
    },
    itemNumber:{
        flexDirection: 'row',
        alignItems:'center',
        flex:1,
    },
    point:{
        width:35,
        height:5,
        marginLeft:5,
        marginTop:5,
        marginRight:5,
    },
    itemAddress:{
        width:sr.w - 290,
        fontSize:14,
        color:'#333333',
    },
    textLeft:{
        fontSize:12,
        color:'#888888',
    },
    textRight:{
        fontSize:12,
        color:'#333333',
    },
    selectedAllContainer:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
    },
    chooseAll:{
        height:9,
        width:9,
        marginLeft:10,
    },
    selectedAllText:{
        color:'#333333',
        fontSize:12,
        marginLeft:10,
    },
    totalText:{
        color:'#333333',
        fontSize:15,
        fontWeight:'500',
        marginLeft:30,
    },
    totalItem:{
        fontSize:12,
        color:'#f01823',
        marginLeft:20,
    },
    listView:{
        flexDirection:'row',
        alignItems:'center',
        justifyContent:'center',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/cargo/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

const { PageList, Button } = COMPONENTS;

const ShippingList = require('./ShippingList');
const BranchList = require('./BranchList');
const Loading = require('./CarLoading');
const ScanOrderDetail = require('./ScanOrderDetail');
const ScanBarCode = require('../../common/ScanBarCode');
const PayInfo = require('../../common/PayInfoModel');
const OrderList = require('../order/OrderList');
const PayPassword = require('../../common/PayPassword');

let sumWeight = 0;
let sumCount = 0;
let sumSize = 0;

module.exports = React.createClass({
    getInitialState () {
        return {
            unfinishTruckData: {},
            showUnfinishTruck: false,
            list:[],
            actionSheetVisible: false,
            remainBondAmount:0,
            remainAmount:app.personal.remainAmount,
        };
    },
    componentWillMount () {
        this.getUnfinishTruck();
        this.getBranchShopInfo();
        this.getRemainAmount();
    },
    onWillFocus () {
        this.getUnfinishTruck();
        this.getBranchShopInfo();
        this.getRemainAmount();
    },
    updateNavBar () {
        app.getCurrentRoute().title = '竞得货物';
        app.getCurrentRoute().rightButton = { title: '装车', handler: () => { this.toFillCar(); } };
        app.getCurrentRoute().leftButton = { title: app.personal.currentShopName, handler: () => { app.scene.toShop(); }, isLimitLength:true };
        app.forceUpdateNavbar();
    },
    getRemainAmount () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_REMAIN_AMOUNT, param, this.getRemainAmountSuccess, false);
    },
    getRemainAmountSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.setRemainAmount(context.amount);
            this.setState({ remainAmount:app.personal.remainAmount });
        }
    },
    showOrderList (truckId) {
        app.push({
            component: OrderList,
            passProps: {
                truckId,
            },
        });
    },
    getBranchShopInfo () {
        const param = {
            userId : app.personal.info.userId,
            shopId : app.personal.currentShopId,
        };
        POST(app.route.ROUTE_GET_BRANCH_SHOP_INFO, param, this.getBranchShopInfoSuccess, false);
    },
    getBranchShopInfoSuccess (data) {
        if (data.success) {
            this.setState({ remainBondAmount : data.context.remainBondAmount });
        }
    },
    doShowActionSheet () {
        // this.setState({ actionSheetVisible:true });
        app.showModal(<PayInfo data={this.state.unfinishTruckData} doConfirmPay={this.doConfirmPay} />);
    },
    doConfirmPay () {
        const { unfinishTruckData } = this.state;
        const param = {
            userId: app.personal.info.userId,
            truckId:unfinishTruckData.id,
        };
        app.push({
            component:PayPassword,
            passProps:{
                param,
                routeName : app.route.ROUTE_PAY_FOR_CARRY_PARTMENT,
                prompt : '支付成功',
                doCloseActionSheet:() => {},
                money:app.utils.N(unfinishTruckData.carryPrice * unfinishTruckData.totalWeight),
            },
        });
    },
    onBarCodeRead (truckId, data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            this.showScanOrderDetail(truckId, data.id);
        }
    },
    finishScan () {
        const { unfinishTruckData } = this.state;
        if (app.utils.N(unfinishTruckData.carryPrice * unfinishTruckData.totalWeight) == 0) {
            Toast('货车没装货物，暂不能结束扫描');
            return;
        }
        const param = {
            userId:app.personal.info.userId,
        };
        POST(app.route.ROUTE_FINISH_SCAN_ORDER, param, this.finishScanSuccess, false);
    },
    finishScanSuccess (data) {
        if (data.success) {
            this.getUnfinishTruck();
        } else {
            Toast(data.msg);
        }
    },
    continueScanOrder (truckId) {
        const param = {
            userId:app.personal.info.userId,
        };
        POST(app.route.ROUTE_CONTINUE_SCAN_ORDER, param, this.continueScanOrderSuccess.bind(null, truckId), false);
    },
    continueScanOrderSuccess (truckId, data) {
        if (data.success) {
            app.showModal(<ScanBarCode onBarCodeRead={this.onBarCodeRead.bind(null, truckId)} />);
        } else {
            Toast(data.msg);
        }
    },
    getUnfinishTruck () {
        const param = {
            userId:app.personal.info.userId,
            shopId:app.personal.currentShopId,
        };
        POST(app.route.ROUTE_GET_UNFINISH_RUCK, param, this.getUnfinishTruckSuccess, false);
    },
    getUnfinishTruckSuccess (data) {
        if (data.success) {
            const truckId = data.context.id;
            this.setState({ unfinishTruckData:data.context, showUnfinishTruck:true });
            app.getCurrentRoute().title = '装车未完成';
            data.context.state == 5 ? app.getCurrentRoute().rightButton = { title: '继续扫描', handler: () => { this.continueScanOrder(truckId); } } :
            app.getCurrentRoute().rightButton = { title: '继续扫描', handler: () => {
                app.showModal(<ScanBarCode onBarCodeRead={this.onBarCodeRead.bind(null, truckId)} />);
            } };
            app.getCurrentRoute().leftButton = null;
            app.forceUpdateNavbar();
            app.personal.setIsFinishScan(false);
        } else {
            this.setState({ showUnfinishTruck:false });
            app.personal.setIsFinishScan(true);
            this.updateNavBar();
            this.listView && this.listView.refresh();
        }
    },
    showScanOrderDetail (truckId, orderId) {
        app.navigator.push({
            component:ScanOrderDetail,
            passProps:{
                truckId,
                orderId,
            },
        });
    },
    toShop () {
        app.push({
            component:BranchList,
        });
    },
    toFillCar () {
        app.push({
            component:Loading,
            passProps:{
                refreshList:this.refreshList,
            },
        });
    },
    doChoose (obj, rowId) {
        const { list } = this.state;
        list[rowId].selected = !list[rowId].selected;
        this.setState({
            list,
        });
        this.doTotalCalculation();
    },
    toDetail (end) {
        app.push({
            component:ShippingList,
            passProps:{
                point:end,
            },
        });
    },
    doSelectedAll () {
        let { list } = this.state;
        if (_.every(list, o => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({ list });
        this.doTotalCalculation();
    },
    doTotalCalculation () {
        const { list } = this.state;
        sumWeight = 0;
        sumCount = 0;
        sumSize = 0;
        _.filter(list, (o) => o.selected == true).forEach((item, i) => {
            sumSize = sumSize + item.item.totalSize;
            sumCount = sumCount + item.item.orderCount;
            sumWeight = sumWeight + item.item.totalWeight;
        });
    },
    refreshList () {
        this.listView.refresh();
    },
    renderRow (obj, rowId) {
        const { list } = this.state;
        if (!_.find(list, (o) => o.index == rowId)) {
            list.push({ selected:false, index:rowId, item:obj });
        }
        return (
            <View style={styles.itemContainer}>
                <TouchableOpacity style={styles.btnChoose}
                    onPress={this.doChoose.bind(null, obj, rowId)}>
                    <Image style={styles.choose}
                        source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose} />
                </TouchableOpacity>
                <TouchableOpacity onPress={this.toDetail.bind(null, obj.endPoint)}
                    style={styles.detail}>
                    <View style={styles.rightContainer}>
                        <View style={styles.pointContainer}>
                            <Text style={styles.itemAddress}>{app.personal.currentShopName}</Text>
                            <Image style={styles.point} source={app.img.cargo_point} />
                            <Text style={styles.itemAddress}>{obj.endPoint}</Text>
                        </View>
                        <View style={styles.pointContainerTop}>
                            <Text style={styles.textLeft}>总重量：</Text>
                            <Text style={styles.textRight}>{obj.totalWeight}吨</Text>
                        </View>
                        <View style={styles.itemNumber}>
                            <Text style={styles.textLeft}>总方量：</Text>
                            <Text style={styles.textRight}>{obj.totalSize}m³</Text>
                        </View>
                        <View style={styles.itemNumberBottom}>
                            <Text style={styles.textLeft}>总单数：</Text>
                            <Text style={styles.textRight}>{obj.orderCount}单</Text>
                        </View>
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        const { list, unfinishTruckData, showUnfinishTruck, remainAmount, remainBondAmount } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        return (
            <View style={styles.container}>
                {
                    (_.intersection(app.personal.info.authority, [AH.AH_LOOK_AMOUNT, AH.AH_RECHARGE, AH.AH_WITHDRAW]).length != 0) &&
                    <Image style={styles.balance}
                        source={app.img.cargo_balance_background}>
                        <Text style={styles.balanceText}>余额：
                            {remainAmount}</Text>
                        <Text style={styles.balanceTextRight}>担保余额：{app.utils.N(remainBondAmount)}</Text>
                    </Image>

                }
                {
                    !showUnfinishTruck ? <View style={styles.listView}>
                        <PageList
                            ref={(ref) => { this.listView = ref; }}
                            renderRow={this.renderRow}
                            listName={'orderList'}
                            listParam={{ userId: app.personal.info.userId, shopId:app.personal.currentShopId }}
                            listUrl={app.route.ROUTE_GET_NEED_SEND_ORDER_SUMMARY_LIST}
                            refreshEnable
                            />
                        <View style={styles.selectedAllContainer}>
                            <TouchableOpacity onPress={this.doSelectedAll}
                                style={styles.selectedAllBtn}>
                                <Image style={styles.chooseAll}
                                    source={status ? app.img.order_choose : app.img.order_no_choose} />
                                <Text style={styles.selectedAllText}>全选</Text>
                            </TouchableOpacity>
                            <Text style={styles.totalText}>总计</Text>
                            <Text style={styles.totalItem}>{sumWeight}吨</Text>
                            <Text style={styles.totalItem}>{sumSize}m³</Text>
                            <Text style={styles.totalItem}>{sumCount}单</Text>
                        </View>
                    </View>
                    :
                    <View style={styles.orderInfo}>
                        <TouchableOpacity style={styles.item} onPress={this.showOrderList.bind(null, unfinishTruckData.id)}>
                            <View style={styles.row}>
                                <Text style={styles.info}>货车号: {unfinishTruckData.plateNo}</Text>
                                <Text style={styles.info}>行驶证号: {unfinishTruckData.drivingLicense}</Text>
                                <Text style={styles.info}>货车类型: {unfinishTruckData.truckType}</Text>
                            </View>
                            <View style={styles.row}>
                                <Text style={styles.info}>重量: {app.utils.N(unfinishTruckData.totalWeight)}吨</Text>
                                <Text style={styles.info}>方量: {app.utils.N(unfinishTruckData.totalSize)}m³</Text>
                                <Text style={styles.info}>件数: {app.utils.N(unfinishTruckData.totalNumbers)}</Text>
                            </View>
                            <View style={styles.row}>
                                <Text style={styles.info}>搬运费: {app.utils.N(unfinishTruckData.carryPrice * unfinishTruckData.totalWeight)}元</Text>
                                <Text style={styles.info}>保险费: {app.utils.N(unfinishTruckData.insuanceMount)}元</Text>
                                <Text style={styles.info}>搬运部: {unfinishTruckData.carryPartment ? unfinishTruckData.carryPartment.name : ''}</Text>
                            </View>
                        </TouchableOpacity>
                        <View style={styles.bottomView}>
                            {
                                unfinishTruckData.state == 4 ? <Button onPress={this.finishScan} style={styles.btnPayNow} textStyle={styles.btnPayNowText}>结束扫描</Button> :
                                <Button onPress={this.doShowActionSheet} style={styles.btnPayNow} textStyle={styles.btnPayNowText}>付搬运费</Button>
                            }
                        </View>
                    </View>

                }

            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    listView:{
        flex:1,
        marginTop:10,
    },
    balance:{
        width:300,
        height:30,
        marginLeft:(sr.w - 300) / 2,
        flexDirection: 'row',
        justifyContent:'center',
        alignItems:'center',
    },
    balanceText:{
        fontSize:14,
        color:'#f69838',
        marginRight:5,
    },
    balanceTextRight:{
        fontSize:12,
        color:'#f69838',
        marginLeft:5,
    },
    itemContainer:{
        height:85,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    btnChoose:{
        height:85,
        justifyContent:'center',
        alignItems:'center',
        width:35,
    },
    choose:{
        height:12,
        width:12,
    },
    detail:{
        justifyContent:'center',
        width:sr.w - 35,
    },
    rightContainer:{
        justifyContent:'center',
    },
    pointContainer:{
        flexDirection: 'row',
        alignItems:'center',
    },
    pointContainerTop:{
        flexDirection: 'row',
        alignItems:'center',
        marginTop:2,
    },
    itemNumber:{
        flexDirection: 'row',
        alignItems:'center',
        marginTop:1,
    },
    itemNumberBottom:{
        flexDirection: 'row',
        alignItems:'center',
        marginTop:1,
    },
    point:{
        width:35,
        height:5,
        marginLeft:5,
        marginRight:5,
    },
    itemAddress:{
        marginTop:2,
        fontSize:14,
        color:'#333333',
    },
    textLeft:{
        fontSize:12,
        color:'#888888',
    },
    textRight:{
        fontSize:12,
        color:'#333333',
    },
    selectedAllContainer:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
    },
    selectedAllBtn:{
        flexDirection:'row',
        alignItems:'center',
    },
    chooseAll:{
        height:9,
        width:9,
        marginLeft:10,
    },
    selectedAllText:{
        color:'#333333',
        fontSize:12,
        marginLeft:10,
    },
    totalText:{
        color:'#333333',
        fontSize:15,
        fontWeight:'500',
        marginLeft:30,
    },
    totalItem:{
        fontSize:12,
        color:'#f01823',
        marginLeft:20,
    },
    item: {
        padding:10,
        backgroundColor:'#FFFFFF',
    },
    row:{
        flexDirection:'row',
        marginTop:10,
        alignItems:'center',
    },
    icon:{
        width:70,
        height:70,
        borderRadius:2,
        marginLeft:8,
    },
    rowInfo:{
        marginTop:10,
        marginBottom:10,
        marginLeft:5,
    },
    id:{
        fontSize:14,
        color:'#333333',
        flex:1,
    },
    info:{
        fontSize:12,
        color:'#888888',
        flex:1,
    },
    bottomView:{
        position:'absolute',
        top:200,
        width:sr.w,
    },
    bottomInfo:{
        flexDirection: 'row',
        backgroundColor:'white',
    },
    infoLeft:{
        height:45,
        flexDirection: 'row',
        flex:1,
        justifyContent:'center',
        alignItems: 'center',
    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    btnPayNow:{
        height:45,
        flex:1,
        borderRadius:0,
    },
    btnPayNowText:{
        fontSize:16,
        fontWeight:'500',
    },
    orderInfo:{
        height:480,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/order/Order.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const SendOrderList = require('../../common/SendOrderList');
const BranchList = require('./cargo/BranchList');
module.exports = React.createClass({
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    onWillFocus () {
        app.getCurrentRoute().title = '我的订单';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = { title: app.personal.currentShopName, handler: () => { app.scene.toShop(); }, isLimitLength:true };
        app.forceUpdateNavbar();
    },
    toShop () {
        app.push({
            component:BranchList,
        });
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = [{ name:'待付款', type:'waitpay' }, { name:'运输中', type:'onway' }, { name:'完成', type:'complete' }];
        const { tabIndex } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item.name}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <SendOrderList key={i} index={i} type={item.type} tabIndex={tabIndex} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/order/OrderList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList, Button, MessageBox } = COMPONENTS;
const SendOrderDetail = require('../../common/SendOrderDetail');
const ScanBarCode = require('../../common/ScanBarCode');
const ScanOrderDetail = require('./ScanOrderDetail');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '货单',
        rightButton: () => app.scene.renderRightButton(),
    },
    renderRightButton () {
        const { type } = this.props;
        if (type != 'complete') {
            return { title: '扫描到达', handler: () => { this.scanArrive(); } };
        }
    },
    getOrderDetail (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess.bind(null, index), true);
    },
    getOrderDetailSuccess (index, data) {
        const { success, msg } = data;
        if (success) {
            app.push({
                component: SendOrderDetail,
                passProps: {
                    data: data.context,
                    type: 1,
                    updateList: (data) => {
                        this.listView.updateList((list) => {
                            list[index] = data;
                            return list;
                        });
                    },
                },
            });
        } else {
            Toast(msg);
        }
    },
    doLookDetail (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess.bind(null, index), true);
    },
    scanArrive () {
        app.showModal(<ScanBarCode onBarCodeRead={this.onBarCodeRead.bind(null)} />);
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            this.scanConfirmReach(data.id);
        }
    },
    scanConfirmReach (id) {
        const param = {
            userId: app.personal.info.userId,
            orderId: id,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.doScanConfirmSuccess, true);
    },
    doScanConfirmSuccess (data) {
        if (data.success) {
            app.push({
                component : ScanOrderDetail,
                passProps : {
                    orderDetail : data.context,
                    refresh : this.listView.refresh,
                },
            });
        } else {
            Toast(data.msg);
        }
    },
    doConfirmReach (obj, index) {
        app.showModal(
            <MessageBox onConfirm={this.clickConfirmReach.bind(null, obj, index)} content={'是否确定抵达'} onCancel title={false} width={sr.s(250)} />
        );
    },
    clickConfirmReach (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_CONFIRM_HAND_OVER_ORDER, param, this.doConfirmSuccess.bind(null, index), true);
    },
    doConfirmSuccess (index, data) {
        const { success, context, msg } = data;
        if (success) {
            this.listView.updateList((list) => {
                list[index] = context.order || {};
                return list;
            });
            Toast('确认成功');
        } else {
            Toast(msg);
        }
    },
    doConfirmReceiveMoney (obj, index) {
        app.showModal(
            <MessageBox onConfirm={this.clickConfirmReceiveMoney.bind(null, obj, index)} content={'是否确定收款'} onCancel title={false} width={sr.s(250)} />
        );
    },
    clickConfirmReceiveMoney (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_FINISH_ORDER, param, this.doConfirmSuccess.bind(null, index), true);
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={sectionID + rowID} />
        );
    },
    renderRow (obj, rowID) {
        const { stateList, photo } = obj;
        return (
            <View style={styles.row}>
                <View style={styles.rowTopContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.order_logo}
                        style={styles.topImage} />
                    <Text style={styles.topLeftText}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                    <Text style={styles.topRightText}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <TouchableOpacity style={styles.rowMiddleContainer} onPress={this.getOrderDetail.bind(null, obj, rowID)}>
                    <Image
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri:photo }}
                        style={styles.middleImage} />
                    <View style={styles.middleRight}>
                        <View style={styles.pointContainer}>
                            <View style={styles.placeContainer}>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                <Text style={styles.pointName}>→</Text>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.endPoint}</Text>
                            </View>
                        </View>
                        <Text style={styles.commonInfo}>重量：{obj.weight}吨</Text>
                        <Text style={styles.commonInfo}>方量：{obj.size}m³</Text>
                        <Text style={styles.commonInfo}>件数：{obj.totalNumbers}件</Text>
                        <Text style={styles.commonInfo}>收货地址：{obj.endPoint}</Text>
                    </View>
                </TouchableOpacity>
                <View style={styles.rowButtomContainer}>
                    {
                        stateList && stateList[0].state == OS.OS_ON_THE_WAY &&
                        <Button onPress={this.doConfirmReach.bind(null, obj, rowID)} style={styles.ConfirmReach} textStyle={styles.btnConfirmReachText}>{'确认抵达'}</Button>
                    }
                    {
                        stateList && stateList[0].state == OS.OS_READY_RECEIVE && (obj.totalDesignatedFee + obj.proxyCharge) > 0 &&
                        <Button onPress={this.doConfirmReceiveMoney.bind(null, obj, rowID)} style={styles.ConfirmReach} textStyle={styles.btnConfirmReachText}>{'确认收款'}</Button>
                    }
                    <Button onPress={this.doLookDetail.bind(null, obj, rowID)} style={styles.lookDetail} textStyle={styles.btnDetallText}>{'查看详情'}</Button>
                </View>
            </View>
        );
    },
    render () {
        const { truckId } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.separator} />
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator}
                    listParam={{ userId: app.personal.info.userId, truckId }}
                    listName={'orderList'}
                    listUrl={app.route.ROUTE_GET_ORDER_LIST_IN_RUCKS}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    separator: {
        backgroundColor: '#f8f8f8',
        height: 8,
    },
    rowTopContainer: {
        paddingHorizontal:10,
        paddingVertical:5,
        backgroundColor:'white',
        flexDirection: 'row',
    },
    topImage: {
        width: 17,
        height:17,
    },
    topLeftText: {
        marginLeft:10,
        flex:1,
        fontSize: 14,
    },
    topRightText: {
        flex:1,
        fontSize: 14,
        textAlign:'right',
        color:'#f51b1a',
    },
    rowMiddleContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:11,
        backgroundColor:'#f8f8f8',
    },
    middleImage: {
        width: 80,
        height:80,
        marginLeft: 10,
    },
    middleRight: {
        paddingLeft: 10,
        width:sr.w - 100,
    },
    money: {
        fontSize: 14,
        color:'#f51b1a',
    },
    commonInfo: {
        fontSize: 13,
        color:'#888888',
    },
    pointName: {
        fontSize: 14,
        maxWidth: 70,
    },
    transformFee: {
        flex:1,
        fontSize: 14,
        color: 'gray',
        textAlign:'right',
    },
    pointContainer: {
        flexDirection: 'row',
    },
    placeContainer: {
        flex:1,
        flexDirection: 'row',
    },
    rowButtomContainer: {
        backgroundColor:'white',
        flexDirection: 'row',
        justifyContent: 'flex-end',
        paddingVertical:5,
    },
    ConfirmReach: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#ff6200',
        borderWidth:1,
        backgroundColor:'white',
    },
    lookDetail: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#007ef7',
        borderWidth:1,
        marginLeft:20,
        marginRight:10,
        backgroundColor:'white',
    },
    btnConfirmReachText:{
        color:'#ff6200',
        fontSize:12,
        fontWeight:'300',
    },
    btnDetallText:{
        color:'#007ef7',
        fontSize:12,
        fontWeight:'300',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/order/ScanOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
import moment from 'moment';

module.exports = React.createClass({
    statics: {
        title: '到货订单详情',
    },
    getInitialState () {
        return {
            data: this.props.orderDetail,
            count : 0,
        };
    },
    minusCount () {
        const { count } = this.state;
        if (count > 0) {
            this.setState({ count:count - 1 });
        } else {
            Toast('到货数量不能小于0');
        }
    },
    addCount () {
        const { count, data } = this.state;
        if (count < data.totalNumbers) {
            this.setState({ count:count + 1 });
        } else {
            Toast('到货数量不能超过货物总数');
        }
    },
    showScanResult () {
        const { count, data } = this.state;
        if (count > 0 && count <= data.totalNumbers) {
            const param = {
                userId: app.personal.info.userId,
                orderId: data.id,
            };
            POST(app.route.ROUTE_CONFIRM_HAND_OVER_ORDER, param, this.doConfirmSuccess, true);
        } else {
            Toast('数量清点有误,请重新核实');
        }
    },
    doConfirmSuccess (data) {
        if (data.success) {
            Toast('确认成功');
            this.props.refresh();
            app.navigator.popToTop();
        } else {
            Toast(data.msg);
        }
    },
    doCancel () {
        app.navigator.popToTop();
    },
    render () {
        const { data, count } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.containerDetails}>
                    <Image style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri:data.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{app.personal.currentShopName}</Text>
                                <Text >-</Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.endPoint}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>到货重量：{app.utils.N(data.weight)}m³</Text>
                        <Text style={styles.textDetailsItem}>到货方量：{app.utils.N(data.size)}吨</Text>
                        <Text style={styles.textDetailsItem}>货物总数：{app.utils.N(data.totalNumbers)}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.modifyCount}>
                    <Text style={styles.modifyCountTitle}>到货件数</Text>
                    <TouchableOpacity onPress={this.minusCount}>
                        <Text style={styles.imgSymbol}>－</Text>
                    </TouchableOpacity>
                    <TextInput
                        style={styles.countFont}
                        defaultValue={count + ''}
                        underlineColorAndroid='transparent'
                        onChangeText={(text) => this.setState({ count:text })}
                        keyboardType='numeric' />
                    <TouchableOpacity onPress={this.addCount}>
                        <Text style={styles.imgSymbol}>＋</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.bottom}>
                    <Button style={styles.btnConfirm} textStyle={styles.btnFont} onPress={this.showScanResult}>确认</Button>
                    <Button style={styles.btnCancel} textStyle={styles.btnFont} onPress={this.doCancel}>取消</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    containerDetails:{
        height:150,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    imageGoods:{
        height:125,
        width:125,
        marginLeft:12,
        marginTop:11,
    },
    goodsDetails:{
        marginLeft:8,
        height:125,
        paddingBottom:8,
        marginTop:10,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
        flex:1,
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    detailsAddress:{
        fontSize:16,
        width:100,
        color:'#333333',
        flexDirection: 'row',
    },
    moneyLeft:{
        fontSize:14,
        color:'#333333',
    },
    moneyRight:{
        fontSize:15,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:14,
        color:'#888888',
        flex:1,
    },
    modifyCount:{
        flexDirection:'row',
        backgroundColor:'#f4f4f4',
        height:50,
        marginTop:10,
        alignItems:'center',
    },
    modifyCountTitle:{
        marginLeft:20,
        color:'#888888',
        marginRight:130,
    },
    imgSymbol:{
        marginRight:10,
        fontSize:20,
    },
    countFont:{
        padding:0,
        fontSize:14,
        width:30,
        height:20,
        color:'#888888',
        backgroundColor:'#FFFFFF',
        marginRight:10,
        alignSelf:'center',
        textAlign:'right',
    },
    btnConfirm:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#FE9917',
    },
    btnCancel:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    bottom:{
        height:45,
        width:sr.w,
        flexDirection:'row',
        position:'absolute',
        bottom:0,
        right:0,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/order/TruckList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;
const OrderList = require('./OrderList');

module.exports = React.createClass({
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={sectionID + rowID} />
        );
    },
    pushOrderList (truckId) {
        app.push({
            component: OrderList,
            passProps:{
                truckId,
                type : this.props.type,
            },
        });
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity style={styles.item} onPress={this.pushOrderList.bind(null, obj.id)}>
                <View style={styles.info}>
                    <Text style={styles.licensePlate}>{obj.plateNo}</Text>
                    <Text style={styles.carInfo}>司机:{obj.driver == null ? '' : obj.driver.name}</Text>
                    <Text style={styles.carInfo}>车长及车型:{obj.truckType}</Text>
                </View>
            </TouchableOpacity>
        );
    },
    render () {
        const { index, tabIndex, type, data, listUrl } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                <View style={styles.separator} />
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        renderSeparator={this.renderSeparator}
                        listParam={{ userId: app.personal.info.userId, type: type }}
                        listName={type + '.list'}
                        list={data.list}
                        autoLoad={false}
                        listUrl={listUrl}
                        refreshEnable
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    separator: {
        backgroundColor: '#f8f8f8',
        height: 8,
    },
    item:{
        height:65,
        backgroundColor:'#FFFFFF',
        flexDirection:'row',
        alignItems:'center',
    },
    info:{
        marginLeft:10,
    },
    licensePlate:{
        fontSize:14,
        color:'#333333',
        marginBottom:2,
    },
    carInfo:{
        fontSize:14,
        color:'#888888',
        marginTop:1,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/order/Trucks.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const TruckList = require('./TruckList');
const BranchList = require('../cargo/BranchList');
module.exports = React.createClass({
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    onWillFocus () {
        app.getCurrentRoute().title = '我的货车';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = { title: app.personal.currentShopName, handler: () => { app.scene.toShop(); }, isLimitLength:true };
        app.forceUpdateNavbar();
    },
    toShop () {
        app.push({
            component:BranchList,
            passProps:{
                onWillFocus:this.onWillFocus,
            },
        });
    },
    componentDidMount () {
        this.getTrucks();
    },
    getTrucks () {
        const param = {
            userId: app.personal.info.userId,
            shopId: app.personal.currentShopId,
        };
        POST(app.route.ROUTE_GET_TRUCKS, param, this.getTrucksSuccess, false);
    },
    getTrucksSuccess (data) {
        if (data.success) {
            this.setState({ context:data.context });
        } else {
            Toast(data.msg);
        }
    },
    selectShop () {
        app.push({
            component:BranchList,
        });
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = [{ name:'运输中', type:'onway' }, { name:'完成', type:'complete' }];
        const { tabIndex, context } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item.name}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <TruckList key={i} index={i} type={item.type} tabIndex={tabIndex} data={context && context[item.type]} listUrl={app.route.ROUTE_GET_TRUCKS} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/AddRoadmap.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
    ScrollView,
} = ReactNative;
const { Button, SelectRegionAddress } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '发布路线',
    },
    getInitialState () {
        return {
            endPoint: '',
            endPointLastCode:'',
            status:false,
            price:0,
            minFee:0,
            basePrice:0,
            baseMinFee:0,
        };
    },
    showEndPlace () {
        const { endPointLastCode } = this.state;
        app.push({
            component: SelectRegionAddress,
            title:'到货地',
            passProps:{
                endPointLastCode,
                type : 0,
                confirmAddress:(endPoint, endPointLastCode) => {
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    publishRoadmap () {
        const { endPoint, endPointLastCode, price, minFee, basePrice, baseMinFee, status } = this.state;
        if (!endPoint || endPoint == '') {
            Toast('到货地不能为空');
            return;
        } else if (!price || price == '') {
            Toast('长途起价不能为空');
            return;
        } else if (!minFee || minFee == '') {
            Toast('长途单价不能为空');
            return;
        } else if (status) {
            if (!basePrice || basePrice == '') {
                Toast('长途起价保底不能为空');
                return;
            } else if (!baseMinFee || baseMinFee == '') {
                Toast('长途单价保底不能为空');
                return;
            }
        }
        const param = {
            userId:app.personal.info.userId,
            shopId:app.personal.currentShopId,
            endPoint,
            endPointLastCode,
            price,
            minFee,
            basePrice,
            baseMinFee,
        };
        POST(app.route.ROUTE_PUBLISH_ROADMAP, param, this.publishRoadmapSuccess, true);
    },
    publishRoadmapSuccess (data) {
        if (data.success) {
            Toast('发布路线成功');
            this.props.refreshList();
        } else {
            Toast(data.msg);
        }
    },
    joinRank () {
        this.setState({
            status:!this.state.status,
        });
    },
    render () {
        const { endPoint, status } = this.state;
        return (
            <ScrollView>
                <View style={styles.container}>
                    <View>
                        <View style={styles.itemStart}>
                            <Text style={styles.itemLeft}>始发地</Text>
                            <View style={styles.itemPoint}>
                                <Text style={styles.itemRightStart}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{(app.utils.getVisibleText(app.personal.currentShopAddress + app.personal.currentShopName, 50))}</Text>
                            </View>
                        </View>
                        <TouchableOpacity
                            activeOpacity={0.6}
                            onPress={this.showEndPlace}>
                            <View style={styles.item}>
                                <Text style={styles.itemLeft}>到货地</Text>
                                <View style={styles.itemPoint}>
                                    <Text style={styles.itemRight}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{endPoint}</Text>
                                    <Image
                                        source={app.img.common_go}
                                        style={styles.goStyle} />
                                </View>
                            </View>
                        </TouchableOpacity>
                    </View>
                    <View style={styles.list}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>长途单价</Text>
                            <TextInput style={styles.roadInfo}
                                underlineColorAndroid='transparent'
                                keyboardType='numeric'
                                placeholder='请输入长途单价'
                                onChangeText={(text) => this.setState({ price: text })} />
                            <Text style={styles.itemEnd}>元/吨</Text>
                        </View>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>长途起价</Text>
                            <TextInput style={styles.roadInfo}
                                underlineColorAndroid='transparent'
                                keyboardType='numeric'
                                placeholder='请输入长途起价'
                                onChangeText={(text) => this.setState({ minFee: text })} />
                            <Text style={styles.itemEnd}>元/票</Text>
                        </View>
                        <View style={styles.list}>

                            <TouchableOpacity onPress={this.joinRank}>
                                <View style={styles.item}>
                                    {
                                        status ?
                                        <Image style={styles.imgChoose} source={app.img.order_choose_r} />
                                        :
                                        <Image style={styles.imgChoose} source={app.img.order_no_choose_r} />
                                    }
                                    <Text style={styles.itemLeft}>智能排名保底价设置</Text>
                                </View>
                            </TouchableOpacity>

                            {
                                status ?
                                <View>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>长途单价保底</Text>
                                        <TextInput style={styles.roadInfo}
                                            underlineColorAndroid='transparent'
                                            placeholder='请输入长途单价保底'
                                            keyboardType='numeric'
                                            onChangeText={(text) => this.setState({ basePrice: text })} />
                                        <Text style={styles.itemEnd}>元/吨</Text>
                                    </View>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>长途起价保底</Text>
                                        <TextInput style={styles.roadInfo}
                                            underlineColorAndroid='transparent'
                                            placeholder='请输入长途起价保底'
                                            keyboardType='numeric'
                                            onChangeText={(text) => this.setState({ baseMinFee: text })} />
                                        <Text style={styles.itemEnd}>元/票</Text>
                                    </View>
                                </View> : <Text />
                            }
                            <Button style={styles.btnpublishRoadmap}
                                textStyle={styles.btnpublishRoadmapFont}
                                onPress={this.publishRoadmap}>发布路线</Button>
                        </View>
                    </View>
                </View>
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    itemStart:{
        height:40,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemLeft:{
        flex:1,
        paddingLeft:12,
        fontSize:14,
        color:'#333333',
    },
    itemPoint:{
        flexDirection: 'row',
    },
    itemRightStart:{
        fontSize:14,
        color:'#888888',
        width:sr.w / 3 * 2,
        textAlign:'right',
        paddingRight:5,
    },
    itemRight:{
        fontSize:14,
        color:'#333333',
        width:sr.w / 3 * 2,
        textAlign:'right',
        paddingRight:5,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 12,
    },
    item:{
        height:45,
        marginTop:1,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    list:{
        marginTop:7,
    },
    roadInfo:{
        flex:1,
        textAlign:'right',
        fontSize:14,
        padding: 0,
    },
    itemEnd:{
        fontSize:14,
        marginRight:10,
        marginLeft:5,
    },
    imgChoose:{
        width:14,
        height:14,
        marginLeft:12,
    },
    btnpublishRoadmap:{
        width:351,
        backgroundColor:'#c61a29',
        height:45,
        borderRadius:4,
        alignSelf:'center',
        marginTop:20,
    },
    btnpublishRoadmapFont:{
        fontWeight:'400',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/ModifyPrice.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

const { Button, CustomSheet } = COMPONENTS;
const Ranking = require('./Ranking');

const PriceType = {
    LONG:0,
    LONG_START:1,
};
const ChangeType = {
    PRICE:0,
    PERCENT:1,
    RANK:2,
};
module.exports = React.createClass({
    statics: {
        title: '调价',
    },
    getInitialState () {
        return {
            price: '',
            type: [],
            change: ChangeType.PRICE,
            add: false,
            sub: false,
            ranking:0,
            changePrice:0,
            actionSheetVisible:false,
        };
    },
    toLongStart () {
        const { type } = this.state;
        if (_.findIndex(type, (o) => o == PriceType.LONG_START) == -1) {
            type.push(PriceType.LONG_START);
            this.setState({ type });
        } else {
            this.setState({ type: _.reject(type, o => o == PriceType.LONG_START) });
        }
    },
    toLongPrice () {
        const { type } = this.state;
        if (_.findIndex(type, (o) => o == PriceType.LONG) == -1) {
            type.push(PriceType.LONG);
            this.setState({ type });
        } else {
            this.setState({ type: _.reject(type, o => o == PriceType.LONG) });
        }
    },
    toAdd () {
        this.setState({
            add: true,
            sub: false,
        });
    },
    toSub () {
        this.setState({
            add: false,
            sub: true,
        });
    },
    toChangePrice () {
        this.setState({
            change: ChangeType.PRICE,
            add: false,
            sub: false,
            price: '',
        });
    },
    toChangePercent () {
        this.setState({
            change: ChangeType.PERCENT,
            add: false,
            sub: false,
            price: '',
        });
    },
    toChangeRanking () {
        this.setState({
            change: ChangeType.RANK,
            add: false,
            sub: false,
        });
    },
    toRanking () {
        this.setState({ actionSheetVisible: true });
    },
    doClose () {
        this.setState({ actionSheetVisible: false });
    },
    toFirst () {
        this.setState({
            ranking: 1,
            actionSheetVisible: false,
        });
    },
    toSecond () {
        this.setState({
            ranking: 2,
            actionSheetVisible: false,
        });
    },
    toThird () {
        this.setState({
            ranking: 3,
            actionSheetVisible: false,
        });
    },
    toFourth () {
        this.setState({
            ranking: 4,
            actionSheetVisible: false,
        });
    },
    doConfirmChange () {
        const { type, change, price, ranking, add, sub } = this.state;
        const { userId, roadmapId } = this.props;
        if (type.length == 0) {
            Toast('请选择需要调价的类型');
            return;
        }
        if (change == ChangeType.UNKNOW) {
            Toast('请选择需要调价的模式');
            return;
        }
        if (change == ChangeType.RANK && ranking == 0) {
            Toast('请选择需要调整的名次');
            return;
        }
        if (add == false && sub == false && ranking == 0) {
            Toast('请选择上调还是下调或者排名');
            return;
        }
        if ((price == null || price == '') && change == ChangeType.PRICE) {
            Toast('请输入需要调整的价格');
            return;
        }
        if ((price == null || price == '') && change == ChangeType.PERCENT) {
            Toast('请输入需要调整的百分比');
            return;
        }
        var value = 0;
        if (change != ChangeType.RANK && change != ChangeType.UNKNOW) {
            if (sub) {
                value = -parseInt(price);
            } else {
                value = parseInt(price);
            }
        } else {
            value = ranking;
        }
        const param = {
            userId: userId,                           // 用户Id
            roadmapIdList: roadmapId,                 // 路线Id列表
            typeList: type,                         // 修改类型列表（0：长途运费单价 1：长途运费起价 2：送货上门单价 3：送货上门起价）
            mode: change,                             // 修改模式 （0: 按照价格调整 1: 按照百分比调整 2: 按照名次调整）
            value,                                    // 修改量（如果mode为0和1时，正数为增加，负数为减少）
        };
        POST(app.route.ROUTE_SET_ROADMAP_PRICE, param, this.doSetRoadmapPriceSuccess, true);
    },
    doSetRoadmapPriceSuccess (data) {
        if (data.success) {
            Toast('修改成功');
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { change, type, add, sub, ranking, actionSheetVisible, price } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.typeContainer}>
                    <View style={styles.typeTop}>
                        <TouchableOpacity onPress={this.toLongPrice}
                            style={styles.toChooseFirst}>
                            <Image style={styles.btnImage}
                                source={_.find(type, o => o == PriceType.LONG) == PriceType.LONG ?
                                    app.img.order_choose_r : app.img.order_no_choose_r} />
                            <Text style={styles.itemText}>长途单价</Text>
                        </TouchableOpacity>
                        <TouchableOpacity onPress={this.toLongStart}
                            style={styles.toChoose}>
                            <Image style={styles.btnImage}
                                source={_.find(type, o => o == PriceType.LONG_START) == PriceType.LONG_START
                                    ? app.img.order_choose_r : app.img.order_no_choose_r} />
                            <Text style={styles.itemText}>长途起价</Text>
                        </TouchableOpacity>
                    </View>
                </View>
                <View style={styles.priceChange}>
                    <TouchableOpacity onPress={this.toChangePrice}
                        style={[styles.itemChange, change == 0 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 0 ? { color:'#FFFFFF' } : {}]}>按价格调整</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.toChangePercent}
                        style={[styles.itemChange, change == 1 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 1 ? { color:'#FFFFFF' } : {}]}>按百分比调整</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.toChangeRanking}
                        style={[styles.itemChange, change == 2 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 2 ? { color:'#FFFFFF' } : {}]}>按排名调整</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.priceNumber}>
                    {
                        (change == 1 || change == 0) ?
                            <View style={styles.bottomLeft}>
                                <TouchableOpacity onPress={this.toAdd}
                                    style={styles.priceAdd}>
                                    <Image style={styles.chooseImage}
                                        source={add ? app.img.order_choose : app.img.order_no_choose} />
                                    <Text style={styles.priceAddText}>上调</Text>
                                </TouchableOpacity>
                                <TouchableOpacity onPress={this.toSub}
                                    style={styles.priceSub}>
                                    <Image style={styles.chooseImage}
                                        source={sub ? app.img.order_choose : app.img.order_no_choose} />
                                    <Text style={styles.priceAddText}>下调</Text>
                                </TouchableOpacity>
                            </View>
                        :
                            <View />
                    }
                    {
                        change == 0 ?
                            <View style={styles.priceInput}>
                                <TextInput
                                    onChangeText={(text) => this.setState({ price: text })}
                                    multiline={false}
                                    style={styles.bottomRight}
                                    placeholder={'请输入需要修改的价格'}
                                    autoCapitalize={'none'}
                                    underlineColorAndroid={'transparent'}
                                    defaultValue={price}
                                />
                                <Text style={styles.bottomRightText}>元</Text>
                            </View>
                        :
                        change == 1 ?
                            <View style={styles.priceInput}>
                                <TextInput
                                    onChangeText={(text) => this.setState({ price: text })}
                                    multiline={false}
                                    style={styles.bottomRight}
                                    placeholder={'请输入需要修改的百分比'}
                                    defaultValue={price}
                                    autoCapitalize={'none'}
                                    underlineColorAndroid={'transparent'}
                                />
                                <Text style={styles.bottomRightText}>%</Text>
                            </View>
                        :
                        change == 2 ?
                            <View style={styles.priceInput}>
                                <TouchableOpacity onPress={this.toRanking}>
                                    <Text style={styles.bottomRightText}>
                                        {ranking == 1 ?
                                        '第一名' : ranking == 2 ?
                                        '第二名' : ranking == 3 ?
                                        '第三名' : ranking == 4 ?
                                        '第四名' : '请选择排名'}
                                    </Text>
                                </TouchableOpacity>
                            </View>
                            :
                            <View />
                        }
                </View>
                <Button onPress={this.doConfirmChange}
                    style={styles.btnConfirmChange}
                    textStyle={styles.btnConfirmChangeText}>
                        确认调价
                    </Button>
                <CustomSheet
                    visible={actionSheetVisible}>
                    <Ranking doClose={this.doClose}
                        toFirst={this.toFirst}
                        toSecond={this.toSecond}
                        toThird={this.toThird}
                        toFourth={this.toFourth} />
                </CustomSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    typeContainer:{
        height:40,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
    },
    typeTop:{
        flexDirection: 'row',
        alignItems:'center',
    },
    toChooseFirst:{
        flexDirection: 'row',
        alignItems:'center',
    },
    toChoose:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:30,
    },
    btnImage:{
        height:16,
        width:16,
        marginLeft:10,
    },
    itemText:{
        fontSize:14,
        color:'#333333',
        marginLeft:5,
    },
    typeBottom:{
        flexDirection: 'row',
        alignItems:'center',
        marginTop:7,
    },
    priceChange:{
        height:40,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'space-around',
        marginTop:10,
    },
    itemChange:{
        height:20,
        width:100,
        backgroundColor:'#f3f3f3',
    },
    changeText:{
        fontSize:12,
        color:'#333333',
        textAlign:'center',
        height:20,
        lineHeight:18,
    },
    priceNumber:{
        height:40,
        backgroundColor:'#FFFFFF',
        marginTop:1,
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    bottomLeft:{
        flexDirection: 'row',
        alignItems:'center',
        height:40,
    },
    priceAdd:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:10,
    },
    chooseImage:{
        height:9,
        width:9,
    },
    priceAddText:{
        fontSize:14,
        color:'#333333',
        marginLeft:5,
    },
    priceSub:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:20,
    },
    priceInput:{
        flexDirection: 'row',
        alignItems:'center',
    },
    bottomRight:{
        height:40,
        width:sr.w / 2,
        fontSize:12,
        color: '#444444',
        textAlign:'right',
    },
    bottomRightText:{
        fontSize:13,
        color:'#333333',
        marginRight:15,
        marginLeft:3,
    },
    btnConfirmChange:{
        height:40,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        marginTop:250,
        borderRadius:4,
    },
    btnConfirmChangeText:{
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/ModifySendDoorPrice.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

const { Button, CustomSheet } = COMPONENTS;
const Ranking = require('./Ranking');

const PriceType = {
    SHORT:0,
    SHORT_START:1,
};
const ChangeType = {
    PRICE:0,
    PERCENT:1,
    RANK:2,
};
module.exports = React.createClass({
    statics: {
        title: '调价',
    },
    getInitialState () {
        return {
            price: '',
            baseMinFee: '',
            basePrice: '',
            type: [],
            change: ChangeType.PRICE,
            add: false,
            sub: false,
            status: false,
            ranking:0,
            changePrice:0,
            actionSheetVisible:false,
        };
    },
    toLongStart () {
        const { type } = this.state;
        if (_.findIndex(type, (o) => o == PriceType.SHORT_START) == -1) {
            type.push(PriceType.SHORT_START);
            this.setState({ type });
        } else {
            this.setState({ type: _.reject(type, o => o == PriceType.SHORT_START) });
        }
    },
    toLongPrice () {
        const { type } = this.state;
        if (_.findIndex(type, (o) => o == PriceType.SHORT) == -1) {
            type.push(PriceType.SHORT);
            this.setState({ type });
        } else {
            this.setState({ type: _.reject(type, o => o == PriceType.SHORT) });
        }
    },
    toAdd () {
        this.setState({
            add: true,
            sub: false,
        });
    },
    toSub () {
        this.setState({
            add: false,
            sub: true,
        });
    },
    toChangePrice () {
        this.setState({
            change: ChangeType.PRICE,
            add: false,
            sub: false,
            price: '',
        });
    },
    toChangePercent () {
        this.setState({
            change: ChangeType.PERCENT,
            add: false,
            sub: false,
            price: '',
        });
    },
    toChangeRanking () {
        this.setState({
            change: ChangeType.RANK,
            add: false,
            sub: false,
        });
    },
    toRanking () {
        this.setState({ actionSheetVisible: true });
    },
    doClose () {
        this.setState({ actionSheetVisible: false });
    },
    toFirst () {
        this.setState({
            ranking: 1,
            actionSheetVisible: false,
        });
    },
    toSecond () {
        this.setState({
            ranking: 2,
            actionSheetVisible: false,
        });
    },
    toThird () {
        this.setState({
            ranking: 3,
            actionSheetVisible: false,
        });
    },
    toFourth () {
        this.setState({
            ranking: 4,
            actionSheetVisible: false,
        });
    },
    doConfirmChange () {
        const { type, change, price, ranking, add, sub } = this.state;
        const { lastCodeList, roadmapId } = this.props;
        if (type.length == 0) {
            Toast('请选择需要调价的类型');
            return;
        }
        if (change == ChangeType.UNKNOW) {
            Toast('请选择需要调价的模式');
            return;
        }
        if (change == ChangeType.RANK && ranking == 0) {
            Toast('请选择需要调整的名次');
            return;
        }
        if (add == false && sub == false && ranking == 0) {
            Toast('请选择上调还是下调或者排名');
            return;
        }
        if ((price == null || price == '') && change == ChangeType.PRICE) {
            Toast('请输入需要调整的价格');
            return;
        }
        if ((price == null || price == '') && change == ChangeType.PERCENT) {
            Toast('请输入需要调整的百分比');
            return;
        }
        var value = 0;
        if (change != ChangeType.RANK && change != ChangeType.UNKNOW) {
            if (sub) {
                value = -parseInt(price);
            } else {
                value = parseInt(price);
            }
        } else {
            value = ranking;
        }
        const param = {
            userId: app.personal.info.userId,         // 用户Id
            roadmapId,                                // 长途主路线Id
            lastCodeList,                             // 所选送货上门路线的lastCode列表
            typeList: type,                           // 修改类型列表（0：送货上门单价 1：送货上门起价） Array
            mode: change,                             // 修改模式 （0: 按照价格调整 1: 按照百分比调整 2: 按照名次调整）
            value,                                    // 修改量（如果mode为0和1时，正数为增加，负数为减少）
        };
        POST(app.route.ROUTE_SET_ROADMAP_SEND_DOOR_PRICE, param, this.setRoadmapSendDoorPriceSuccess, true);
    },
    setRoadmapSendDoorPriceSuccess (data) {
        if (data.success) {
            Toast('修改成功');
            app.pop(2);
            this.props.doRefresh();

        } else {
            Toast(data.msg);
        }
    },
    doSetSavePrice () {
        const { baseMinFee, basePrice } = this.state;
        // userId	ID	用户Id
        // roadmapId	ID	路线Id
        // lastCodeList	Array	送货上门终点lastCode列表
        // typeList	Array	数组，0：同城配送运费单价的底价 1：同城配送运费起价的底价
        // mode	Number	修改模式 （0: 设置底价, 1: 按照价格调整 2: 按照百分比调整）
        // value	Number	修改量（如果mode为0和1时，正数为增加，负数为减少）

    },
    joinRank () {
        this.setState({
            status:!this.state.status,
        });
    },
    render () {
        const { change, type, add, sub, ranking, actionSheetVisible, price, status } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.typeContainer}>
                    <View style={styles.typeTop}>
                        <TouchableOpacity onPress={this.toLongPrice}
                            style={styles.toChooseFirst}>
                            <Image style={styles.btnImage}
                                source={_.find(type, o => o == PriceType.SHORT) == PriceType.SHORT ?
                                    app.img.order_choose_r : app.img.order_no_choose_r} />
                                <Text style={styles.itemText}>送货上门单价</Text>
                            </TouchableOpacity>
                            <TouchableOpacity onPress={this.toLongStart}
                                style={styles.toChoose}>
                                <Image style={styles.btnImage}
                                    source={_.find(type, o => o == PriceType.SHORT_START) == PriceType.SHORT_START
                                        ? app.img.order_choose_r : app.img.order_no_choose_r} />
                                    <Text style={styles.itemText}>送货上门起价</Text>
                                </TouchableOpacity>
                            </View>
                        </View>
                        <View style={styles.priceChange}>
                            <TouchableOpacity onPress={this.toChangePrice}
                                style={[styles.itemChange, change == 0 ? { backgroundColor:'#c91521' } : {}]}>
                                <Text style={[styles.changeText, change == 0 ? { color:'#FFFFFF' } : {}]}>按价格调整</Text>
                            </TouchableOpacity>
                            <TouchableOpacity onPress={this.toChangePercent}
                                style={[styles.itemChange, change == 1 ? { backgroundColor:'#c91521' } : {}]}>
                                <Text style={[styles.changeText, change == 1 ? { color:'#FFFFFF' } : {}]}>按百分比调整</Text>
                            </TouchableOpacity>
                            <TouchableOpacity onPress={this.toChangeRanking}
                                style={[styles.itemChange, change == 2 ? { backgroundColor:'#c91521' } : {}]}>
                                <Text style={[styles.changeText, change == 2 ? { color:'#FFFFFF' } : {}]}>按排名调整</Text>
                            </TouchableOpacity>
                        </View>
                        <View style={styles.priceNumber}>
                            {
                                (change == 1 || change == 0) ?
                                <View style={styles.bottomLeft}>
                                    <TouchableOpacity onPress={this.toAdd}
                                        style={styles.priceAdd}>
                                        <Image style={styles.chooseImage}
                                            source={add ? app.img.order_choose : app.img.order_no_choose} />
                                        <Text style={styles.priceAddText}>上调</Text>
                                    </TouchableOpacity>
                                    <TouchableOpacity onPress={this.toSub}
                                        style={styles.priceSub}>
                                        <Image style={styles.chooseImage}
                                            source={sub ? app.img.order_choose : app.img.order_no_choose} />
                                        <Text style={styles.priceAddText}>下调</Text>
                                    </TouchableOpacity>
                                </View>
                                :
                                <View >
                                </View>
                            }
                            {
                                change == 0 ?
                                <View style={styles.priceInput}>
                                    <TextInput
                                        onChangeText={(text) => this.setState({ price: text })}
                                        multiline={false}
                                        style={styles.bottomRight}
                                        placeholder={'请输入需要修改的价格'}
                                        autoCapitalize={'none'}
                                        underlineColorAndroid={'transparent'}
                                        defaultValue={price}
                                        />
                                    <Text style={styles.bottomRightText}>元</Text>
                                </View>
                                :
                                change == 1 ?
                                <View style={styles.priceInput}>
                                    <TextInput
                                        onChangeText={(text) => this.setState({ price: text })}
                                        multiline={false}
                                        style={styles.bottomRight}
                                        placeholder={'请输入需要修改的百分比'}
                                        defaultValue={price}
                                        autoCapitalize={'none'}
                                        underlineColorAndroid={'transparent'}
                                        />
                                    <Text style={styles.bottomRightText}>%</Text>
                                </View>
                                :
                                change == 2 ?
                                <View>
                                    <View style={styles.priceInput}>
                                        <TouchableOpacity style={styles.bottomRank}
                                            onPress={this.toRanking}>
                                            <Text style={styles.bottomRightText}>
                                                {
                                                    ranking == 1 ?
                                                    '第一名' : ranking == 2 ?
                                                    '第二名' : ranking == 3 ?
                                                    '第三名' : ranking == 4 ?
                                                    '第四名' : '请选择排名'
                                                }
                                            </Text>
                                        </TouchableOpacity>
                                    </View>
                                </View>
                                :
                                <View >
                                </View>
                            }
                        </View>
                        {
                            change == 2 &&
                            <TouchableOpacity onPress={this.joinRank}>
                                <View style={styles.joinRank}>
                                    {
                                        status ?
                                        <Image style={styles.imgChoose} source={app.img.order_choose_r} />
                                        :
                                        <Image style={styles.imgChoose} source={app.img.order_no_choose_r} />
                                    }
                                    <Text style={styles.itemLeft}>智能排名保底价设置</Text>
                                </View>
                            </TouchableOpacity>
                        }
                        {
                            change == 2 && status &&
                            <View style={styles.setSavePrice}>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>送货上门起价保底</Text>
                                    <TextInput style={styles.roadInfo}
                                        underlineColorAndroid='transparent'
                                        placeholder='请输入送货上门起价保底'
                                        onChangeText={(text) => this.setState({ baseMinFee: text })}
                                        />
                                    <Text style={styles.itemEnd}>元</Text>
                                </View>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>送货上门单价保底</Text>
                                    <TextInput style={styles.roadInfo}
                                        underlineColorAndroid='transparent'
                                        placeholder='请输入送货上门单价保底'
                                        onChangeText={(text) => this.setState({ basePrice: text })}
                                        />
                                    <Text style={styles.itemEnd}>元</Text>
                                </View>
                            </View>
                        }
                        {
                            change == 2 && status &&
                            <Button onPress={this.doSetSavePrice}
                                style={styles.btnConfirmSavePrice}
                                textStyle={styles.btnConfirmChangeText}>
                                设置保底价
                            </Button>
                            ||
                            <Button onPress={this.doConfirmChange}
                                style={styles.btnConfirmChange}
                                textStyle={styles.btnConfirmChangeText}>
                                确认调价
                            </Button>
                        }
                        <CustomSheet
                            visible={actionSheetVisible}>
                            <Ranking doClose={this.doClose}
                                toFirst={this.toFirst}
                                toSecond={this.toSecond}
                                toThird={this.toThird}
                                toFourth={this.toFourth} />
                        </CustomSheet>
                    </View>
                );
            },
        });

        const styles = StyleSheet.create({
            container: {
                flex: 1,
                backgroundColor: '#f4f4f4',
            },
            typeContainer:{
                height:40,
                backgroundColor:'#FFFFFF',
                justifyContent:'center',
            },
            typeTop:{
                flexDirection: 'row',
                alignItems:'center',
            },
            toChooseFirst:{
                flexDirection: 'row',
                alignItems:'center',
            },
            toChoose:{
                flexDirection: 'row',
                alignItems:'center',
                marginLeft:30,
            },
            btnImage:{
                height:16,
                width:16,
                marginLeft:10,
            },
            itemText:{
                fontSize:14,
                color:'#333333',
                marginLeft:5,
            },
            typeBottom:{
                flexDirection: 'row',
                alignItems:'center',
                marginTop:7,
            },
            priceChange:{
                height:40,
                backgroundColor:'#FFFFFF',
                flexDirection: 'row',
                alignItems:'center',
                justifyContent:'space-around',
                marginTop:10,
            },
            itemChange:{
                height:20,
                width:100,
                backgroundColor:'#f3f3f3',
            },
            changeText:{
                fontSize:12,
                color:'#333333',
                textAlign:'center',
                height:20,
                lineHeight:18,
            },
            priceNumber:{
                height:40,
                backgroundColor:'#FFFFFF',
                marginTop:1,
                flexDirection: 'row',
                justifyContent:'space-between',
            },
            bottomLeft:{
                flexDirection: 'row',
                alignItems:'center',
                height:40,
            },
            priceAdd:{
                flexDirection: 'row',
                alignItems:'center',
                marginLeft:10,
            },
            chooseImage:{
                height:9,
                width:9,
            },
            priceAddText:{
                fontSize:14,
                color:'#333333',
                marginLeft:5,
            },
            priceSub:{
                flexDirection: 'row',
                alignItems:'center',
                marginLeft:20,
            },
            priceInput:{
                flexDirection: 'row',
                alignItems:'center',
            },
            bottomRight:{
                height:40,
                width:sr.w / 2,
                fontSize:12,
                color: '#444444',
                textAlign:'right',
            },
            bottomRightText:{
                fontSize:13,
                color:'#333333',
                marginRight:15,
                marginLeft:3,
            },
            btnConfirmChange:{
                height:40,
                width:351,
                marginLeft:(sr.w - 351) / 2,
                marginTop:250,
                borderRadius:4,
            },
            btnConfirmChangeText:{
                fontSize:16,
                fontWeight:'500',
            },
            btnConfirmSavePrice:{
                height:40,
                width:351,
                marginLeft:(sr.w - 351) / 2,
                marginTop:110,
                borderRadius:4,
            },
            bottomRank:{
                height: 40,
                justifyContent: 'center',
            },
            joinRank:{
                height:45,
                marginTop:10,
                justifyContent: 'space-between',
                alignItems:'center',
                flexDirection: 'row',
                backgroundColor:'#FFFFFF',
            },
            imgChoose:{
                width:14,
                height:14,
                marginLeft:12,
            },
            setSavePrice:{
                marginTop: 1,
                backgroundColor: '#FFFFFF',
                width: sr.w,
            },
            item:{
                height:40,
                marginTop:1,
                justifyContent: 'space-between',
                alignItems:'center',
                flexDirection: 'row',
                backgroundColor:'#FFFFFF',
            },
            itemLeft:{
                flex:1,
                paddingLeft:12,
                fontSize:14,
                color:'#333333',
            },
            roadInfo:{
                flex:1,
                textAlign:'right',
                fontSize:14,
                padding:0,
            },
            itemEnd:{
                fontSize:14,
                marginRight:10,
                marginLeft:5,
            },
        });

```

* PDClient/project/App/modules/logisticsCompany/roadmap/Ranking.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '',
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.textTop}>名次</Text>
                    <TouchableOpacity onPress={this.props.doClose}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_close}
                            style={styles.closeStyle} />
                    </TouchableOpacity>
                </View>
                <View style={styles.line} />
                <TouchableOpacity onPress={this.props.toFirst}
                    style={styles.rankingStyleTop}>
                    <Text>第一名</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.toSecond}
                    style={styles.rankingStyle}>
                    <Text>第二名</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.toThird}
                    style={styles.rankingStyle}>
                    <Text>第三名</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.toFourth}
                    style={styles.rankingStyle}>
                    <Text>第四名</Text>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#fafafa',
    },
    containerTop:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textTop:{
        fontSize:17,
        marginLeft:(sr.w - 17 * 2) / 2,
        color:'#333333',
    },
    closeStyle:{
        height:30,
        width:30,
    },
    line:{
        height:1,
        backgroundColor:'#ededed',
    },
    rankingStyleTop:{
        height:40,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        marginLeft:10,
    },
    rankingStyle:{
        height:40,
        backgroundColor:'#FFFFFF',
        marginTop:1,
        justifyContent:'center',
        marginLeft:10,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/ReceivePointMarketResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const RoadmapMarketList = require('./RoadmapMarketList');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['长途单价', '送货上门单价', '时间最短'];
        const { tabIndex } = this.state;
        const { info, data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <RoadmapMarketList key={i} index={i} tabIndex={tabIndex} info={info} data={data.agent ? data.agent.roadmapList : []} listName={'agent.roadmapList'} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/RoadmapDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    ScrollView,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, SelectStartPointAddress, SelectRegionAddress } = COMPONENTS;

const SendDoorList = require('./SendDoorList');

module.exports = React.createClass({
    statics: {
        title: '路线详情',
    },
    componentWillMount () {
        this.getRoadmapDetail();
    },
    getInitialState () {
        return {
            startInfo:'',
            endPoint: '',
            endPointLastCode:'',
            enable:false,
            price:'',
            minFee:'',
            basePrice:0,
            baseMinFee:0,
            roadInfo:{},
        };
    },
    showStartPlace () {
        const { startInfo } = this.state;
        app.push({
            component: SelectStartPointAddress,
            passProps:{
                endPointLastCode:startInfo.startPointLastCode,
                id:startInfo.shopId || startInfo.agentId,
                confirmAddress:(obj) => {
                    this.setState({ startInfo:obj });
                },
            },
        });
    },
    showEndPlace () {
        const { endPointLastCode } = this.state;
        app.push({
            component: SelectRegionAddress,
            title:'到货地',
            passProps:{
                endPointLastCode,
                confirmAddress:(endPoint, endPointLastCode) => {
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    getRoadmapDetail () {
        const id = this.props.roadmapId;
        const param = {
            roadmapId:id,
        };
        POST(app.route.ROUTE_GET_SHIPPER_ROADMAP_DETAIL, param, this.getRoadmapDetailSuccess, true);
    },
    getRoadmapDetailSuccess (data) {
        if (data.success) {
            const obj = data.context;
            this.setState({
                startInfo:{ startPoint:obj.startPoint, id:obj.shop ? obj.shop.id : obj.agent ? obj.agent.id : '' },
                endPoint: obj.endPoint,
                endPointLastCode:obj.endPointLastCode,
                price:obj.price,
                minFee:obj.minFee + '',
                basePrice:obj.basePrice == null ? 0 : obj.basePrice,
                baseMinFee:obj.baseMinFee == null ? 0 : obj.baseMinFee,
                enable:obj.enable,
                roadInfo: data.context,
            });
        } else {
            Toast(data.msg);
        }
    },
    doMadifyRoadmap () {
        const id = this.props.roadmapId;
        const { endPoint, endPointLastCode, enable, price, minFee, basePrice, baseMinFee } = this.state;
        const param = {
            userId:app.personal.info.userId,
            roadmapId:id,
            endPoint,
            endPointLastCode,
            price,
            basePrice,
            minFee,
            baseMinFee,
        };
        POST(app.route.ROUTE_MODIFY_ROADMAP, param, this.doMadifyRoadmapSuccess, true);
    },
    doMadifyRoadmapSuccess (data) {
        if (data.success) {
            Toast('修改成功');
            app.pop();
            this.props.refreshList();
        } else {
            Toast(data.msg);
        }
    },
    doRefresh () {
        this.getRoadmapDetail();
    },
    showSendDoorList () {
        const { roadInfo } = this.state;
        app.push({
            component: SendDoorList,
            passProps:{
                roadInfo,
                getRoadmapDetail: this.getRoadmapDetail,
                doRefresh: this.doRefresh,
            },
        });
    },
    render () {
        const { roadInfo, startInfo, endPoint, enable, price, minFee, basePrice, baseMinFee } = this.state;
        return (
            <ScrollView>
                <View style={styles.container}>
                    <View>
                        <TouchableOpacity
                            activeOpacity={0.6}
                            onPress={this.showStartPlace}>
                            <View style={styles.itemStart}>
                                <Text style={styles.itemLeft}>始发地</Text>
                                <View style={styles.itemPoint}>
                                    <Text style={styles.itemRightStart}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{startInfo.startPoint || ''}</Text>
                                </View>
                            </View>
                        </TouchableOpacity>
                        <TouchableOpacity
                            activeOpacity={0.6}
                            onPress={this.showEndPlace}>
                            <View style={styles.item}>
                                <Text style={styles.itemLeft}>到货地</Text>
                                <View style={styles.itemPoint}>
                                    <Text style={styles.itemRight}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{endPoint}</Text>
                                    <Image
                                        source={app.img.common_go}
                                        style={styles.goStyle} />
                                </View>
                            </View>
                        </TouchableOpacity>
                    </View>
                    <View style={styles.list}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>长途起价</Text>
                            <TextInput style={styles.roadInfo}
                                underlineColorAndroid='transparent'
                                placeholder='请输入长途起价'
                                onChangeText={(text) => this.setState({ minFee: text })}
                                defaultValue={app.utils.N(minFee * 1) + ''} />
                            <Text style={styles.itemEnd}>元</Text>
                        </View>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>长途单价</Text>
                            <TextInput style={styles.roadInfo}
                                underlineColorAndroid='transparent'
                                placeholder='请输入长途单价'
                                onChangeText={(text) => this.setState({ price: text })}
                                defaultValue={app.utils.N(price * 1) + ''} />
                            <Text style={styles.itemEnd}>元</Text>
                        </View>
                        <View style={styles.list}>
                            <View>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>长途起价保底</Text>
                                    <TextInput style={styles.roadInfo}
                                        underlineColorAndroid='transparent'
                                        placeholder='请输入长途起价保底'
                                        onChangeText={(text) => this.setState({ baseMinFee: text })}
                                        defaultValue={app.utils.N(baseMinFee * 1) + ''} />
                                    <Text style={styles.itemEnd}>元</Text>
                                </View>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>长途单价保底</Text>
                                    <TextInput style={styles.roadInfo}
                                        underlineColorAndroid='transparent'
                                        placeholder='请输入长途单价保底'
                                        onChangeText={(text) => this.setState({ basePrice: text })}
                                        defaultValue={app.utils.N(basePrice * 1) + ''} />
                                    <Text style={styles.itemEnd}>元</Text>
                                </View>
                            </View>
                            <View style={styles.list}>
                                <TouchableOpacity
                                    activeOpacity={0.6}
                                    onPress={this.showSendDoorList}>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>送货上门价格设置</Text>
                                        <View style={styles.itemPoint}>
                                            <Image
                                                source={app.img.common_go}
                                                style={styles.goStyle} />
                                        </View>
                                    </View>
                                </TouchableOpacity>
                                <Button onPress={this.doMadifyRoadmap} style={styles.btn} textStyle={styles.btnFont}>确认修改</Button>
                            </View>
                        </View>
                    </View>
                </View>
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    itemStart:{
        height:40,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemLeft:{
        flex:1,
        paddingLeft:12,
        fontSize:14,
        color:'#333333',
    },
    itemPoint:{
        flexDirection: 'row',
    },
    itemRightStart:{
        fontSize:14,
        color:'#888888',
        width:sr.w / 3 * 2,
        textAlign:'right',
        paddingRight:5,
    },
    itemRight:{
        fontSize:14,
        color:'#333333',
        width:sr.w / 3 * 2,
        textAlign:'right',
        paddingRight:5,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 12,
    },
    item:{
        height:40,
        marginTop:1,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    list:{
        marginTop:7,
    },
    roadInfo:{
        flex:1,
        textAlign:'right',
        fontSize:14,
        padding:0,
    },
    itemEnd:{
        fontSize:14,
        marginRight:10,
        marginLeft:5,
    },
    imgChoose:{
        width:14,
        height:14,
        marginLeft:12,
    },
    btnpublishRoadmap:{
        width:351,
        backgroundColor:'#c61a29',
        height:45,
        borderRadius:4,
        alignSelf:'center',
        position:'absolute',
        top:250,
    },
    btnpublishRoadmapFont:{
        fontWeight:'400',
    },
    btn:{
        width:351,
        height:45,
        marginTop:18,
        borderRadius:4,
        alignSelf:'center',
        backgroundColor:'#FE9917',
    },
    btnFont:{
        fontWeight:'400',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/RoadmapMarketList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
let km = '';

module.exports = React.createClass({
    renderRow (obj, rowID) {
        if (obj.distance) {
            if (obj.distance > 1) {
                km = parseInt(!obj.distance ? 0 : obj.distance) + 'km';
            } else {
                km = (parseInt(!obj.distance ? 0 : obj.distance) * 1000) + 'm';
            }
        }
        return (
            <View style={styles.row}>
                <View style={styles.rowChild}>
                    <View style={styles.address}>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.shipperName}</Text>
                        <Text style={{ flex:0.3 }}>{'-'}</Text>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.endPoint}</Text>
                    </View>
                    <Text style={styles.rowChildDistance}>距我:{km}</Text>
                </View>
                <View style={styles.itemInfo}>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(obj.price) + '/吨'}</Text>
                        <Text style={styles.rowChildPrice}>运费单价</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(obj.sendDoorPrice) + '/吨'}</Text>
                        <Text style={styles.rowChildTitle}>送货上门</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildTime}>{obj.duration}天</Text>
                        <Text style={styles.rowChildTitle}>预计用时</Text>
                    </View>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, listName, info, data } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        listParam={{ userId: app.personal.info.userId, orderBy: index, ...info }}
                        listName={listName}
                        list={data}
                        autoLoad={false}
                        listUrl={app.route.ROUTE_GET_ROADMAP_LIST_WITH_END_POINT}
                        refreshEnable
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    row: {
        flex:1,
        paddingVertical: 20,
        paddingHorizontal: 2,
        backgroundColor:'#FFFFFF',
        marginTop:1,
    },
    rowChild:{
        width:sr.w,
        flexDirection:'row',
        marginTop:3,
        marginBottom:3,
    },
    rowChildFont:{
        flex:2,
        fontSize:14,
        marginLeft:5,
        fontWeight:'300',
    },
    rowChildDistance:{
        fontSize:12,
        color:'#FF9D24',
        fontWeight:'300',
        marginRight:5,
        flex:0.5,
    },
    rowChildNumber:{
        color:'#f61525',
        fontSize:15,
        fontWeight:'500',
    },
    rowChildTime:{
        fontSize:16,
        color:'#333333',
    },
    rowChildTitle:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    rowChildPrice:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    address:{
        flexDirection:'row',
        flex:1.5,
    },
    itemInfo:{
        flexDirection:'row',
        flex:1,
        alignItems:'center',
        justifyContent:'center',
        marginTop:3,
    },
    item:{
        flex:1,
        alignItems:'center',
        justifyContent:'center',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/RoadmapMarketResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

import { Geolocation } from '@remobile/react-native-baidu-map';

const ShopMarketResult = require('./ShopMarketResult');
const ReceivePointMarketResult = require('./ReceivePointMarketResult');
const BaidumapSelectPosition = require('../../baidumap');
let selectIndex = 0;
const TabTitle = React.createClass({
    getInitialState () {
        return {
            tab: 0,
        };
    },
    render () {
        const { tab } = this.state;
        const tabMenus = this.props.tabMenus ? this.props.tabMenus : [];

        return (
            <View style={styles.tabContainer}>
                {
                tabMenus.map((item, i) => (
                    <TouchableHighlight
                        key={i}
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={() => {
                            selectIndex = i;
                            this.setState({ tab:i });
                            this.props.changeTab();
                        }}
                        style={[styles.touchTab, tab === i ? { backgroundColor:'#E5E5E5' } : { backgroundColor:'#c81622' }]}>
                        <Text style={tab === i ? { color:'#c81622' } : { color:'#E5E5E5' }}>
                            {item}
                        </Text>
                    </TouchableHighlight>
                ))
            }
            </View>
        );
    },
});
module.exports = React.createClass({
    statics: {
        title: (<TabTitle changeTab={() => { app.scene.changeTab(); }} />),
        rightButton: { title: '位置', handler: () => { app.scene.setPosition(); } },
    },
    getInitialState () {
        return {
            tabIndex: 0,
            context: {},
            tabMenus:[],
            mapInfo:{ location:[0, 0], startPoint:'' },
        };
    },
    setPosition () {
        app.push({
            component: BaidumapSelectPosition,
            passProps:{
                confirm:(marker) => {
                    this.setState({ mapInfo:{ startPoint:marker.province + marker.city, location:[marker.longitude, marker.latitude] } }, () => { this.updateRightButton(marker.city); }); ;
                },
            },
        });
    },
    componentDidMount () {
        Geolocation.getCurrentPosition()
            .then(data => {
                console.warn(JSON.stringify(data));
                this.setState({ mapInfo:{ startPoint:data.province + data.city, location:[data.longitude, data.latitude] } }, () => { this.getRoadMaps(data.city); });
            })
            .catch(e => {
                console.warn(e, 'error');
            });
    },
    getRoadMaps (city) {
        this.updateRightButton(city);
        const { mapInfo } = this.state;
        const { endPoint } = this.props;
        const param = {
            userId: app.personal.info.userId,
            orderBy: 0,
            pageNo:0,
            pageSize:10,
            endPoint,
            ...mapInfo,
        };
        POST(app.route.ROUTE_GET_ROADMAP_LIST_WITH_END_POINT, param, this.getRoadMapsSuccess, false);
    },
    getRoadMapsSuccess (data) {
        if (data.success) {
            this.setState({ context:data.context, tabMenus:(!data.context.agent || data.context.agent.length == 0) ? ['物流超市'] : ['物流超市', '揽收点'] }, () => { this.updateTitle(); });
        } else {
            Toast(data.msg);
        }
    },
    updateRightButton (city) {
        app.getCurrentRoute().rightButton = { title:city, handler: () => { this.setPosition(); } };
        app.forceUpdateNavbar();
    },
    updateTitle () {
        app.getCurrentRoute().title = (<TabTitle changeTab={this.changeTab} tabMenus={this.state.tabMenus} />);
        app.forceUpdateNavbar();
    },
    changeTab () {
        this.setState({ tabIndex:selectIndex });
    },
    render () {
        const { tabIndex, mapInfo, context } = this.state;
        const { endPoint } = this.props;
        const info = {
            endPoint,
            ...mapInfo,
        };
        return (
            <View style={styles.container}>
                {
                    tabIndex === 0 ? <ShopMarketResult info={info} data={context} /> : <ReceivePointMarketResult info={info} data={context} />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        height: 30,
        width: 140,
        borderRadius:5,
        borderColor:'white',
        borderWidth:1,
        flexDirection: 'row',
        overflow: 'hidden',
    },
    touchTab: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/SendDoorList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    ListView,
    Image,
    RefreshControl,
    TouchableOpacity,
} = ReactNative;

const { Button, MessageBox } = COMPONENTS;

const ModifySendDoorPrice = require('./ModifySendDoorPrice');

module.exports = React.createClass({
    statics: {
        title: '送货上门设置',
    },
    getInitialState () {
        const { roadInfo } = this.props;
        const agent = app.personal.info.agent;
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            userId:app.personal.info.userId,
            keyword: '',
            dataList: [],
            list:[],
            roadmapId:[],
            lastCodeList: [],
            shopId:  '',
            sendDoorList: roadInfo.sendDoorList,
        };
    },
    componentWillMount() {
        const { roadInfo } = this.props;
        const { list } = this.state;
        for (var i = 0; i < roadInfo.sendDoorList.length; i++) {
            if (!_.find(list, (o) => o.index == i)) {
                list.push({ selected: false, index: i, item: roadInfo.sendDoorList[i] });
            }
        }
    },
    doChoose (obj, rowId) {
        const { list } = this.state;
        list[rowId].selected = !list[rowId].selected;
        this.setState({
            list,
        });
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({
            list,
        });
    },
    toSetPrice (context) {
        const { sendDoorList } = this.state;
        sendDoorList.forEach((item, i) => {
            context.forEach((o, j) => {
                if (item.sendDoorEndPointLastCode == o.sendDoorEndPointLastCode) {
                    item = o;
                }
            });
        });
    },
    toModifyProfit () {
        const { list, userId, roadmapId } = this.state;
        const { roadInfo } = this.props;
        var lastCodeList = [];
        list.forEach((item, i) => {
            item.selected == true && lastCodeList.push(item.item.sendDoorEndPointLastCode);
        });
        if (lastCodeList.length == 0) {
            Toast('请选择需要调价的路线');
            return;
        }
        app.push({
            component: ModifySendDoorPrice,
            passProps: {
                userId,
                roadmapId: roadInfo.id,
                lastCodeList: _.uniq(lastCodeList),
                doRefresh: this.props.doRefresh,
                toSetPrice: this.toSetPrice,
            },
        });
    },
    toCloseRoadmap () {
        const { list, userId, roadmapId, lastCodeList } = this.state;
        const { roadInfo } = this.props;
        list.forEach((o, i) => {
            o.selected == true && lastCodeList.push(o.item.sendDoorEndPointLastCode);
        });
        if (lastCodeList.length == 0) {
            Toast('请选择要修改的路线');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            roadmapId: roadInfo.id,
            lastCodeList: _.uniq(lastCodeList),
            enable: false,
        };
        POST(app.route.ROUTE_SET_ROADMAP_SEND_DOOR_ENABLE, param, this.setRoadmapSendDoorEnableSuccess, false);
    },
    setRoadmapSendDoorEnableSuccess (data) {
        const { list } = this.state;
        if (data.success) {
            Toast('修改成功');
            app.pop();
            this.props.getRoadmapDetail();
        } else {
            Toast(data.msg);
        }
    },
    toOpenRoadmap () {
        const { list, userId, roadmapId, lastCodeList } = this.state;
        const { roadInfo } = this.props;
        list.forEach((o, i) => {
            o.selected == true && lastCodeList.push(o.item.sendDoorEndPointLastCode);
        });
        if (lastCodeList.length == 0) {
            Toast('请选择要修改的路线');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            roadmapId: roadInfo.id,
            lastCodeList: _.uniq(lastCodeList),
            enable: true,
        };
        POST(app.route.ROUTE_SET_ROADMAP_SEND_DOOR_ENABLE, param, this.setRoadmapSendDoorEnableSuccess, false);
    },
    renderRow (obj, sectionId, rowId) {
        const { list } = this.state;
        return (
            <View style={styles.row}>
                <TouchableOpacity style={styles.image}
                    onPress={this.doChoose.bind(null, obj, rowId)}>
                    <Image
                        resizeMode='cover'
                        style={styles.imgChoose}
                        source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose} />
                </TouchableOpacity>
                <View style={styles.point} >
                    <View style={styles.endAddress}>
                        {
                            obj.enable ?
                            <Text style={styles.open} >已开通</Text>
                            :
                            <Text style={styles.close} >已停运</Text>
                        }
                        <Text style={styles.endPoint} numberOfLines={1}>{obj.sendDoorEndPoint}</Text>
                    </View>
                    <View style={styles.price}>
                        <Text style={styles.priceText}>起价:</Text>
                        <Text style={styles.priceNumber}>{obj.sendDoorMinFee}</Text>
                        <Text style={styles.priceText}>单价:</Text>
                        <Text style={styles.priceNumber}>{obj.sendDoorPrice}</Text>
                    </View>
                </View>
            </View>
        );
    },
    render () {
        const { list, keyword, shopId, userId, sendDoorList } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        var number = 0;
        list.forEach((item, i) => {
            item.selected == true && number++;
        });
        console.log('=====',sendDoorList);
        return (
            <View style={styles.container}>
                <View style={styles.listView} />
                <ListView
                    refreshControl={
                        <RefreshControl
                            refreshing={false}
                            onRefresh={this.onScroll}
                            title='正在刷新...' />
                    }
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(sendDoorList)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
                <View style={styles.bottom}>
                    <TouchableOpacity style={styles.chooseAll} onPress={this.doSelectedAll}>
                        <Image
                            resizeMode='cover'
                            style={styles.imgChoose}
                            source={status ? app.img.order_choose : app.img.order_no_choose} />
                        <Text style={styles.chooseAllFont}>全选</Text>
                        <Text style={styles.chooseAllFont}>已选{number}条</Text>
                    </TouchableOpacity>
                    <View style={{flexDirection:'row'}}>
                        <Button onPress={this.toModifyProfit}
                            style={styles.btnModifyPrice}
                            textStyle={styles.btnModifyPriceFont}>
                            调价
                        </Button>
                        <Button onPress={this.toOpenRoadmap}
                            style={styles.btnOpenRoadmap}
                            textStyle={styles.btnOpenRoadmapFont}>
                            开通
                        </Button>
                        <Button onPress={this.toCloseRoadmap}
                            style={styles.btnModifyPrice}
                            textStyle={styles.btnModifyPriceFont}>
                            关闭
                        </Button>
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    listView:{
        marginTop:8,
    },
    row:{
        height:42,
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        marginBottom:1,
    },
    image:{
        width:33,
        height:42,
        justifyContent:'center',
    },
    imgChoose:{
        marginLeft:10,
        width:13,
        height:13,
    },
    bottom:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'space-between',
    },
    btnModifyPrice:{
        width:60,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f21620',
        marginRight:13,
    },
    btnModifyPriceFont:{
        color:'#f21620',
        fontSize:14,
        fontWeight:'400',
    },
    btnOpenRoadmap:{
        width:60,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#50c248',
        marginRight:13,
    },
    btnOpenRoadmapFont:{
        color:'#50c248',
        fontSize:14,
        fontWeight:'400',
    },
    chooseAllFont:{
        fontSize:15,
        marginLeft:8,
    },
    chooseAll:{
        alignItems:'center',
        flexDirection:'row',
    },
    point:{
        width:sr.w-33,
        flexDirection:'row',
        alignItems:'center',
        flex: 1,
        justifyContent:'space-between',
    },
    endAddress:{
        flexDirection:'row',
        flex: 3,
    },
    open:{
        flex: 4,
        fontSize:14,
        color:'#50c248',
    },
    close:{
        flex: 4,
        fontSize:14,
        color:'#f01725',
    },
    endPoint:{
        flex: 9,
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    price:{
        flexDirection:'row',
        alignItems:'center',
        justifyContent:'center',
        height:42,
        marginRight:8,
        flex: 2,
    },
    priceText:{
        marginLeft:8,
    },
    priceNumber:{
        color:'#f01725',
        marginLeft:3,
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/ShopMarketResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const RoadmapMarketList = require('./RoadmapMarketList');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['长途单价', '送货上门单价', '时间最短'];
        const { tabIndex } = this.state;
        const { info, data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <RoadmapMarketList key={i} index={i} info={info} data={data.shop ? data.shop.roadmapList : []} tabIndex={tabIndex} listName={'shop.roadmapList'} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/logisticsCompany/roadmap/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, MessageBox, PageList } = COMPONENTS;
const RoadmapDetail = require('./RoadmapDetail');
const BranchList = require('../cargo/BranchList');
const ModifyPrice = require('./ModifyPrice');
const AddRoadmap = require('./AddRoadmap');
const RoadmapMarketResult = require('./RoadmapMarketResult');

let searchText = '';
let number = 0;

const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入路线终点查询路线'
                    defaultValue={searchText}
                    underlineColorAndroid='transparent'
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
    },
    onWillFocus () {
        app.getCurrentRoute().title = (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />);
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = { title: app.personal.currentShopName, handler: () => { app.scene.selectShop(); }, isLimitLength:true };
        app.forceUpdateNavbar();
    },
    selectShop () {
        app.push({
            component:BranchList,
            passProps:{
                onWillFocus:this.onWillFocus,
                setCurrentShopId:this.setCurrentShopId,
            },
        });
    },
    setCurrentShopId (id) {
        this.setState({
            shopId:id,
        });
    },
    getInitialState () {
        return {
            userId:app.personal.info.userId,
            list: [],
            keyword: '',
            dataList: [],
            roadmapId:[],
            shopId:app.personal.currentShopId,
        };
    },
    doStartSearch () {
        this.setState({
            keyword:searchText,
        });
    },
    showRoadmapMarket (endPoint) {
        app.push({
            component:RoadmapMarketResult,
            passProps:{
                endPoint,
            },
        });
    },
    showRoadmapDetail (id) {
        app.push({
            component:RoadmapDetail,
            passProps:{
                roadmapId: id,
                refreshList: this.refreshList,
            },
        });
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    doChoose (obj, rowId) {
        const { list } = this.state;
        list[rowId].selected = !list[rowId].selected;
        this.setState({
            list,
        });
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({
            list,
        });
    },
    toModifyPrice () {
        const { userId, roadmapId, list } = this.state;
        list.forEach((item, i) => {
            item.selected == true && roadmapId.push(item.item.id);
        });
        if (roadmapId.length == 0) {
            Toast('请选择需要调价的路线');
            return;
        }
        app.push({
            component: ModifyPrice,
            passProps: {
                userId,
                roadmapId: _.uniq(roadmapId),
            },
        });
        this.setState({
            roadmapId:[],
        });
    },
    toDeleteRoadmap () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == false)) {
            Toast('请选择需要删除的路线');
        } else {
            app.showModal(
                <MessageBox
                    onConfirm={this.doConfirmDelete}
                    content={'是否确定删除所选路线'}
                    onCancel title={false}
                    width={sr.s(250)} />
            );
        }
    },
    delete (id) {
        const param = {
            userId:app.personal.info.userId,
            roadmapId:id,
        };
        let roadmapId = id;
        POST(app.route.ROUTE_REMOVE_ROADMAP, param, this.doConfirmDeleteSuccess.bind(null, roadmapId), false);
    },
    doConfirmDelete () {
        const { list } = this.state;
        list.forEach((item, i) => {
            item.selected == true && this.delete(item.item.id);
        });
    },
    doConfirmDeleteSuccess (roadmapId, data) {
        const { list } = this.state;
        if (data.success) {
            _.remove(list, function (o) {
                return o.item.id == roadmapId;
            });
            this.refreshList();
            Toast('路线删除成功');
        } else {
            Toast('路线删除失败');
        }
    },
    toAddRoadmap () {
            app.push({
                component:AddRoadmap,
                passProps:{
                    refreshList:this.refreshList,
                },
            });
    },
    setEnable (type) {
        const { list } = this.state;
        var roadmapIdList = [];
        list.forEach((item, i) => {
            item.selected == true && roadmapIdList.push(item.item.id);
        });
        if (roadmapIdList.length == 0) {
            Toast('请选择您需要修改的路线');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            roadmapIdList,
            enable: type,
        };
        POST(app.route.ROUTE_SET_ROADMAP_ENABLE, param, this.setRoadmapEnableSuccess.bind(null,type), false);
    },
    setRoadmapEnableSuccess (type, data) {
        const { list } = this.state;
        if (data.success) {
            Toast('修改成功');
            number = 0;
            list.forEach((item, i) => {
                if (item.selected == true) {
                    item.selected = false;
                    item.item.enable = type;
                }
            });
        } else {
            Toast(data.msg);
        }
        this.setState({
            list
        });
        this.refreshList();
    },
    refreshList () {
        this.listView.refresh();
    },
    onGetList (data, pageNo) {
        const { list } = this.state;
        var roadmapList = data.context.roadmapList;
        if (data.success) {
            roadmapList.forEach((item, i) => {
                if (!_.find(list, (o) => o.index == i)) {
                    list.push({ selected:false, index:i, item:item });
                }
            });
        }
    },
    renderRow (obj, rowId) {
        const { list } = this.state;
        return (
            <View style={styles.item}>
                <View style={styles.rowTop}>
                    <TouchableOpacity
                        onPress={this.doChoose.bind(null, obj, rowId)}>
                        <Image
                            resizeMode='cover'
                            style={styles.imgChoose}
                            source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose} />
                    </TouchableOpacity>
                    <TouchableOpacity style={styles.point} onPress={this.showRoadmapDetail.bind(null, obj.id)}>
                        <View style={styles.pointStart}>
                            <Text style={styles.address} numberOfLines={1}>{obj.startPoint}</Text>
                        </View>
                        <Image resizeMode='contain'
                            source={app.img.cargo_point}
                            style={styles.imgLine} />
                        <View style={styles.pointEnd}>
                            <Text style={styles.address} numberOfLines={1}>{obj.endPoint}</Text>
                        </View>
                    </TouchableOpacity>
                    {
                        obj.enable ?
                        <Text style={styles.roadmapStart}>已开通</Text>
                        :
                        <Text style={styles.roadmapStop}>已停运</Text>
                    }
                </View>
                <View style={styles.rowBottom}>
                    <View style={styles.price}>
                        <Text style={styles.priceText}>起价:</Text>
                        <Text style={styles.priceNumber}>{obj.minFee}</Text>
                        <Text style={styles.priceText}>单价:</Text>
                        <Text style={styles.priceNumber}>{obj.price}</Text>
                    </View>
                    <Button style={styles.btnRoadmapShipper}
                        textStyle={styles.btnShipperFont}
                        onPress={this.showRoadmapMarket.bind(null, obj.endPoint)}>
                        路线行情
                    </Button>
                </View>
            </View>
        );
    },
    render () {
        const { list, keyword, shopId } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        var setType = {
            open: true,
            close: false,
         };
        var roadmapList = [];
        number = 0;
        list.forEach((item, i) => {
            item.selected == true && number++;
        });
        list.forEach((item, i) => {
            item.selected == true && roadmapList.push({type:item.item.enable, id:item.item.id});
        });
        return (
            <View style={styles.container}>
                <View style={styles.top}>
                        <Button style={styles.btnAddRoadmap}
                            textStyle={styles.btnReleaseFont}
                            onPress={this.toAddRoadmap}>
                            发布长途路线
                        </Button>
                </View>
                <View style={styles.listView} />
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    onGetList={this.onGetList}
                    listName={'roadmapList'}
                    renderSeparator={null}
                    listParam={{ userId: app.personal.info.userId, shopId, keyword }}
                    listUrl={app.route.ROUTE_GET_ROADMAP_LIST_SHIPPER}
                    refreshEnable
                    />
                <View style={styles.bottom}>
                    <View style={{flexDirection:'row'}}>
                        <TouchableOpacity style={styles.chooseAll} onPress={this.doSelectedAll}>
                            <Image
                                resizeMode='cover'
                                style={styles.imgChoose}
                                source={status ? app.img.order_choose : app.img.order_no_choose} />
                            <Text style={styles.chooseAllFont}>全选</Text>
                        </TouchableOpacity>
                        <Text style={styles.alreadyChoose}>已选{number}条</Text>
                    </View>
                    <View style={{flexDirection:'row',marginRight:8}}>
                        {
                            _.every(roadmapList, (o) => o.type == false) ?
                            <Button onPress={this.setEnable.bind(null,setType.open)}
                                style={styles.btnAllOpen}
                                textStyle={styles.btnAllOpenText}>
                                开通
                            </Button>
                            :
                            _.every(roadmapList, (o) => o.type == true) ?
                            <Button onPress={this.setEnable.bind(null,setType.close)}
                                style={styles.btnAllClose}
                                textStyle={styles.btnAllCloseText}>
                                停运
                            </Button>
                            :
                            <View style={{flexDirection:'row'}}>
                                <Button onPress={this.setEnable.bind(null,setType.open)}
                                    style={styles.btnAllOpen}
                                    textStyle={styles.btnAllOpenText}>
                                    开通
                                </Button>
                                <Button onPress={this.setEnable.bind(null,setType.close)}
                                    style={styles.btnAllClose}
                                    textStyle={styles.btnAllCloseText}>
                                    停运
                                </Button>
                            </View>
                        }
                        <Button onPress={this.toDeleteRoadmap}
                            style={styles.btnDelete}
                            textStyle={styles.btnDeleteFont}>删除</Button>
                        <Button onPress={this.toModifyPrice}
                            style={styles.btnModifyPrice}
                            textStyle={styles.btnModifyPriceFont}>调价</Button>
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    searchContainer: {
        height: 30,
        width: sr.w - 125,
        marginLeft:sr.w - 300,
        paddingVertical: 2,
        borderRadius: 4,
        backgroundColor: '#FFFFFF',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        padding:0,
        height: 25,
        width: sr.w - 155,
        fontSize: 14,
        marginLeft: 5,
    },
    iconSearch: {
        height: 15,
        width: 15,
        marginLeft:5,
    },
    top:{
        height:80,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    btnAddRoadmap:{
        width:150,
        height:35,
        borderRadius:4,
        backgroundColor:'#fe9917',
    },
    btnReleaseFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    listView:{
        marginTop:8,
    },
    rowTop:{
        height:42,
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        marginTop:3,
    },
    rowBottom:{
        marginTop:1,
        height:30,
        backgroundColor:'#FFFFFF',
    },
    price:{
        flexDirection:'row',
        height:30,
        alignItems:'center',
    },
    priceText:{
        marginLeft:8,
        fontSize:12,
        color:'#333333',
    },
    priceNumber:{
        fontSize:12,
        color:'#f01725',
    },
    imgChoose:{
        marginLeft:5,
        width:13,
        height:13,
    },
    imgLine:{
        marginLeft:10,
        width:35,
    },
    pointStart:{
        marginLeft:8,
        width:105,
        justifyContent:'center',
        alignItems:'center',
    },
    pointEnd:{
        marginLeft:8,
        width:115,
        justifyContent:'center',
        alignItems:'center',
    },
    address:{
        fontSize:14,
    },
    roadmapStart:{
        fontSize:14,
        color:'#50c248',
        right:(sr.w - 355) / 2,
    },
    roadmapStop:{
        fontSize:14,
        color:'#f01725',
        right:(sr.w - 355) / 2,
    },
    btnOpen:{
        marginTop:5,
        width:50,
        height:20,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#50c248',
        position:'absolute',
        right:(sr.w - 70) / 2,
    },
    btnOpenText:{
        color:'#50c248',
        fontSize:12,
    },
    btnClose:{
        marginTop:5,
        width:50,
        height:20,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f01725',
        position:'absolute',
        right:(sr.w - 195) / 2,
    },
    btnRoadmapShipper:{
        marginTop:5,
        width:65,
        height:20,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f01725',
        position:'absolute',
        right:(sr.w - 350) / 2,
    },
    btnShipperFont:{
        color:'#f01725',
        fontSize:12,
    },
    bottom:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'space-between',
    },
    btnAllOpen:{
        marginLeft:12,
        width:50,
        height:25,
        backgroundColor:'#FFFFFF',
        borderColor:'#50c248',
        borderWidth:0.5,
        borderRadius:2,
    },
    btnAllOpenText:{
        color:'#50c248',
        fontSize:14,
    },
    btnAllCloseText:{
        color:'#f01725',
        fontSize:14,
    },
    btnAllClose:{
        marginLeft:12,
        width:50,
        height:25,
        backgroundColor:'#FFFFFF',
        borderColor:'#f01725',
        borderWidth:0.5,
        borderRadius:2,
    },
    btnDelete:{
        marginLeft:12,
        width:50,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
    },
    btnDeleteFont:{
        color:'#343434',
        fontSize:13,
        fontWeight:'400',
    },
    btnModifyPrice:{
        marginLeft:12,
        width:50,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f21620',
    },
    btnModifyPriceFont:{
        color:'#f21620',
        fontSize:13,
        fontWeight:'400',
    },
    chooseAllFont:{
        fontSize:13,
        marginLeft:8,
    },
    alreadyChoose:{
        fontSize:12,
        marginLeft:5,
        marginTop:1,
    },
    chooseAll:{
        alignItems:'center',
        flexDirection:'row',
    },
    point:{
        flex:1,
        flexDirection:'row',
    },
});

```

* PDClient/project/App/modules/normalUser/market/CaredShipperList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;
const ShipperIntro = require('./ShipperIntro');

module.exports = React.createClass({
    statics: {
        title: '关注的物流公司',
    },
    getShipperDetail (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            shipperId: obj.shipperId,
        };
        POST(app.route.ROUTE_GET_SHIPPER_DETAIL, param, this.getShipperDetailSuccess.bind(null, index), true);
    },
    getShipperDetailSuccess (index, data) {
        const { success, msg } = data;
        if (success) {
            app.push({
                component: ShipperIntro,
                passProps: {
                    data: data.context,
                    updateList: () => {
                        this.listView.updateList((list) => {
                            list[index].cares++;
                            return list;
                        });
                    },
                },
            });
        } else {
            Toast(msg);
        }
    },
    renderRow (obj, sectionID, rowID) {
        const { image, name, logo, sign, address, cares } = obj;
        return (
            <TouchableOpacity style={styles.row} onPress={this.getShipperDetail.bind(null, obj, rowID)}>
                <Image
                    resizeMode='stretch'
                    source={{ uri: image }}
                    style={styles.image} />
                <View style={styles.rowRight}>
                    <View style={styles.nameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={{ uri: logo }}
                            style={styles.logo} />
                        <Text numberOfLines={1} style={styles.name}>{name}</Text>
                    </View>
                    <Text numberOfLines={1} style={styles.sign}>{sign}</Text>
                    <Text numberOfLines={1} style={styles.address}>{address}</Text>
                    <View style={styles.iconContainer}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.shipper_care_press}
                            style={styles.icon} />
                        <Text style={styles.careLabel}>关注：<Text style={styles.care}>{cares || 1}</Text></Text>
                    </View>
                </View>
            </TouchableOpacity>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId }}
                    listName={'shipperList'}
                    listUrl={app.route.ROUTE_GET_CARED_SHIPPER_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 2,
        alignItems: 'center',
        height: 140,
    },
    image: {
        width: 120,
        height:100,
        borderRadius: 10,
    },
    rowRight: {
        paddingLeft: 10,
    },
    nameContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    logo: {
        width: 26,
        height: 26,
        borderRadius: 13,
        marginRight: 5,
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    sign: {
        width: sr.w - 140,
        fontSize: 12,
        marginTop: 10,
    },
    address: {
        fontSize: 12,
        color: 'gray',
        marginTop: 10,
    },
    iconContainer: {
        marginTop: 10,
        flexDirection: 'row',
        alignItems: 'center',
        alignSelf: 'flex-end',
        marginRight: 10,
    },
    icon: {
        width: 20,
        height: 20,
        marginRight: 4,
    },
    careLabel: {
        fontSize: 12,
        color: '#8E8E8E',
    },
    care: {
        color: '#EE4000',
    },
});

```

* PDClient/project/App/modules/normalUser/market/CellPhoneBox.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    Linking,
    Image,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    openPhone () {
        const { phone } = this.props;
        app.closeModal();
        Linking.canOpenURL('tel:' + phone).then(supported => {
            if (!supported) {
                Toast('不支持拨打号码: ' + phone);
            } else {
                return Linking.openURL('tel:' + phone);
            }
        }).catch(err => {
            Toast('拨打号码: ' + phone + '失败');
        });
    },
    render () {
        const { phone } = this.props;
        return (
            <View style={styles.overlayContainer}>
                <TouchableOpacity
                    activeOpacity={1}
                    style={styles.container}>
                    <View style={styles.topView}>
                        <Text style={styles.titleText}>
                            {'拨打电话'}
                        </Text>
                    </View>
                    <TouchableOpacity onPress={this.openPhone} style={styles.phoneContainer}>
                        <Image resizeMode='stretch' source={app.img.shipper_phone} style={styles.icon} />
                        <Text style={styles.phone}>{phone}</Text>
                    </TouchableOpacity>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        height: 114,
        width: sr.w - 50,
        borderRadius: 4,
        backgroundColor: '#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    overlayContainer: {
        position:'absolute',
        top: 0,
        alignItems:'center',
        justifyContent: 'center',
        width:sr.w,
        height:sr.h,
    },
    titleText: {
        fontSize: 24,
        color: '#8B8386',
        backgroundColor: 'transparent',
    },
    topView: {
        height: 47,
        width: sr.w - 50,
        alignItems:'center',
        justifyContent:'center',
    },
    icon: {
        width: 30,
        height: 30,
        marginLeft: 15,
        marginRight: 10,
    },
    phoneContainer: {
        height: 57,
        width: sr.w - 50,
        alignItems:'center',
        justifyContent:'center',
        flexDirection: 'row',
    },
    phone: {
        fontSize: 20,
        color: '#EE4000',
    },
});

```

* PDClient/project/App/modules/normalUser/market/CityDistribution.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ScrollView,
    TouchableOpacity,
} = ReactNative;

const { Button, SelectShortAddress, SelectStartPointAddress } = COMPONENTS;
const MarketSearchResult = require('./MarketSearchResult');

let tmp = 0;

module.exports = React.createClass({
    getInitialState () {
        return {
            startInfo:'',
            endPoint:'',
            endPointLastCode:'',
            sendDoorEndPoint:'',
            sendDoorEndPointLastCode:'',
        };
    },
    showStartPlace () {
        const { startInfo } = this.state;
        app.push({
            component: SelectStartPointAddress,
            passProps:{
                endPointLastCode:startInfo.startPointLastCode,
                id:startInfo.shopId || startInfo.agentId,
                confirmAddress:(obj) => {
                    this.setState({ startInfo:obj });
                },
            },
        });
    },
    showSendDoorEndPlace () {
        const { startInfo, sendDoorEndPointLastCode } = this.state;
        if (!startInfo.startPointLastCode) {
            Toast('请先选择始发地');
            return;
        }
        app.push({
            component: SelectShortAddress,
            title:'送货上门地址',
            passProps:{
                endPointLastCode : sendDoorEndPointLastCode,
                parentCode : startInfo.startPointLastCode,
                confirmAddress:(sendDoorEndPoint, sendDoorEndPointLastCode) => {
                    this.setState({ sendDoorEndPoint, sendDoorEndPointLastCode });
                },
            },
        });
    },
    doMarketSearch () {
        const { startInfo, sendDoorEndPoint, isSendDoor, sendDoorEndPointLastCode } = this.state;
        if (!startInfo || !startInfo.startPoint) {
            Toast('请选择始发地');
            return;
        }
        if (!sendDoorEndPoint) {
            Toast('请选择送货地');
            return;
        }
        app.push({
            component: MarketSearchResult,
            passProps:{
                startInfo,
                endPoint : sendDoorEndPoint,
                endPointLastCode : sendDoorEndPointLastCode,
                isSendDoor,
            },
        });
    },
    render () {
        const { startInfo, endPoint, sendDoorEndPoint, isSendDoor } = this.state;
        return (
            <View>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showStartPlace}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>始发地</Text>
                    </View>
                    <Text style={styles.itemContentText} numberOfLines={1}>
                        {startInfo.startPoint || ''}
                    </Text>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showSendDoorEndPlace}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>送货地</Text>
                    </View>
                    <Text style={styles.itemContentText} numberOfLines={1}>{sendDoorEndPoint}</Text>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />

                    <View style={styles.lineView} />
                </TouchableOpacity>
                <View style={styles.line} />
                <Button onPress={this.doMarketSearch} style={styles.btnMarketSearch} textStyle={styles.btnMarketSearchText} >
                        行情查询
                    </Button>
            </View>
        );
    },

});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    card: {
        marginTop:-20,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor: '#FFFFFF',
        borderRadius:4,
    },
    switch: {
        textAlign:'right',
        paddingRight:10,
        width:120,
        alignSelf:'flex-end',
        position:'absolute',
        top:-25,
        fontSize:13,
        color:'#333333',
    },
    cardText: {
        paddingVertical:15,
        textAlign:'center',
        fontSize: 15,
        color: '#444444',
    },
    shipperImage: {
        width: sr.w,
        height: 160,
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
    },
    infoStyle: {
        flexDirection: 'row',
        flex:1,
    },
    itemNameText: {
        fontSize: 15,
        color: '#666666',
        marginLeft: 8,
    },
    itemContentText: {
        fontSize: 14,
        color: '#333333',
        marginRight:5,
        width:sr.w * 0.65,
        textAlign:'right',
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: 351,
        height: 1,
        backgroundColor: '#f8f8f8',
    },
    line:{
        height: 1,
        backgroundColor: '#f8f8f8',
    },
    choose: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
    },
    imgChoose: {
        width: 15,
        height: 15,
        marginLeft:10,
    },
    chooseText: {
        fontSize:14,
        marginLeft:10,
        color:'#666666',
    },
    btnMarketSearch:{
        marginTop:20,
        height:40,
        width:300,
        marginLeft:20,
        borderRadius:5,
        backgroundColor:'#c81622',
        marginBottom : 20,
    },
    btnMarketSearchText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/normalUser/market/HomeDelivery.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '是否送货上门',
    },
    getInitialState () {
        return {
            yes:false,
            no:false,
        };
    },
    toYes () {
        this.setState({
            yes:true,
            no:false,
        });
    },
    toNo () {
        this.setState({
            yes:false,
            no:true,
        });
    },
    render () {
        const { yes, no } = this.state;
        return (
            <View style={styles.container}>
                <TouchableOpacity onPress={this.toYes}>
                    <View style={[styles.yes, { marginTop:9 }]}>
                        <Text style={styles.yesLeft}>
                            是
                        </Text>
                        <Image source={app.img.common_radio}
                            resizeMode='stretch'
                            style={yes ? styles.choose : styles.lost} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.toNo}>
                    <View style={styles.yes}>
                        <Text style={styles.yesLeft}>
                            否
                        </Text>
                        <Image source={app.img.common_radio}
                            resizeMode='stretch'
                            style={no ? styles.choose : styles.lost} />
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    yes:{
        height:42,
        justifyContent: 'space-between',
        marginTop:1,
        alignItems:'center',
        backgroundColor:'#FFFFFF',
        flexDirection:'row',
    },
    yesLeft:{
        paddingLeft:10,
        fontSize:14,
        color:'#333333',
    },
    choose:{
        width: 10,
        height: 10,
        marginRight: 12,
    },
    lost:{
        width: 0,
        height: 0,
    },
});

```

* PDClient/project/App/modules/normalUser/market/LongDistance.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ScrollView,
    TouchableOpacity,
} = ReactNative;

const { Button, SelectRegionAddress, SelectStartPointAddress, SelectShortAddress } = COMPONENTS;
const MarketSearchResult = require('./MarketSearchResult');

module.exports = React.createClass({
    getInitialState () {
        return {
            startInfo:'',
            endPoint:'',
            endPointLastCode:'',
            sendDoorEndPoint:'',
            sendDoorEndPointLastCode:'',
            isSendDoor:false,
        };
    },
    showStartPlace () {
        const { startInfo } = this.state;
        app.push({
            component: SelectStartPointAddress,
            passProps:{
                endPointLastCode:startInfo.startPointLastCode,
                id:startInfo.shopId || startInfo.agentId,
                confirmAddress:(obj) => {
                    this.setState({ startInfo:obj });
                },
            },
        });
    },
    showEndPlace () {
        const { endPointLastCode, endPoint } = this.state;
        app.push({
            component: SelectRegionAddress,
            title:'到货地',
            passProps:{
                isNeedSelectAll:true,
                endPointLastCode,
                confirmAddress:(endPoint, endPointLastCode) => {
                    if (endPointLastCode != this.state.endPointLastCode) {
                        this.setState({ sendDoorEndPointLastCode:0, sendDoorEndPoint:'', isSendDoor : false });
                    }
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    showSendDoorEndPlace () {
        const { endPointLastCode, sendDoorEndPointLastCode } = this.state;
        if (!endPointLastCode) {
            Toast('请先选择到货地');
            return;
        }
        app.push({
            component: SelectShortAddress,
            title:'送货上门地址',
            passProps:{
                endPointLastCode:sendDoorEndPointLastCode,
                parentCode : endPointLastCode,
                confirmAddress:(sendDoorEndPoint, sendDoorEndPointLastCode) => {
                    this.setState({ sendDoorEndPoint, sendDoorEndPointLastCode });
                },
            },
        });
    },
    toHomeDelivery () {
        this.setState({
            isSendDoor: !this.state.isSendDoor,
        });
    },
    doMarketSearch () {
        const { startInfo, endPoint, sendDoorEndPoint, isSendDoor, endPointLastCode, sendDoorEndPointLastCode } = this.state;
        if (!startInfo || !startInfo.startPoint) {
            Toast('请选择始发地');
            return;
        }
        if (!endPoint) {
            Toast('请选择到货地');
            return;
        }
        if (isSendDoor && !sendDoorEndPoint) {
            Toast('请选择送货上门地址');
            return;
        }
        app.push({
            component: MarketSearchResult,
            passProps:{
                startInfo,
                endPoint,
                endPointLastCode,
                sendDoorEndPointLastCode,
                isSendDoor,
            },
        });
    },
    render () {
        const { startInfo, endPoint, sendDoorEndPoint, isSendDoor } = this.state;
        return (
            <View>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showStartPlace}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>始发地</Text>
                    </View>
                    <Text style={styles.itemContentText} numberOfLines={1}>
                        {startInfo.startPoint || ''}
                    </Text>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showEndPlace}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>到货地</Text>
                    </View>
                    <Text style={styles.itemContentText} numberOfLines={1}>{endPoint}</Text>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <View style={styles.line} />
                <TouchableOpacity style={styles.choose} onPress={this.toHomeDelivery}>
                    <Image source={isSendDoor ? app.img.order_choose_r : app.img.order_no_choose_r} style={styles.imgChoose} />
                    <Text style={styles.chooseText}>送货上门</Text>
                </TouchableOpacity>
                {
                    isSendDoor && <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={this.showSendDoorEndPlace}
                        style={styles.ItemBg}>
                        <View style={styles.infoStyle}>
                            <Text style={styles.itemNameText}>送货地</Text>
                        </View>
                        <Text style={styles.itemContentText} numberOfLines={1}>{sendDoorEndPoint}</Text>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_go}
                            style={styles.icon_go} />

                        <View style={styles.lineView} />
                    </TouchableOpacity>
            }
                <View style={styles.line} />
                <Button onPress={this.doMarketSearch} style={styles.btnMarketSearch} textStyle={styles.btnMarketSearchText} >
                行情查询
            </Button>
            </View>
        );
    },

});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    card: {
        marginTop:-20,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor: '#FFFFFF',
        borderRadius:4,
    },
    switch: {
        textAlign:'right',
        paddingRight:10,
        width:120,
        alignSelf:'flex-end',
        position:'absolute',
        top:-25,
        fontSize:13,
        color:'#333333',
    },
    cardText: {
        paddingVertical:15,
        textAlign:'center',
        fontSize: 15,
        color: '#444444',
    },
    shipperImage: {
        width: sr.w,
        height: 160,
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
    },
    infoStyle: {
        flexDirection: 'row',
        flex:1,
    },
    itemNameText: {
        fontSize: 15,
        color: '#666666',
        marginLeft: 8,
    },
    itemContentText: {
        fontSize: 14,
        color: '#333333',
        marginRight:5,
        width:sr.w * 0.65,
        textAlign:'right',
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: 351,
        height: 1,
        backgroundColor: '#f8f8f8',
    },
    line:{
        height: 1,
        backgroundColor: '#f8f8f8',
    },
    choose: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
    },
    imgChoose: {
        width: 15,
        height: 15,
        marginLeft:10,
    },
    chooseText: {
        fontSize:14,
        marginLeft:10,
        color:'#666666',
    },
    btnMarketSearch:{
        marginTop:20,
        height:40,
        width:300,
        marginLeft:20,
        borderRadius:5,
        backgroundColor:'#c81622',
        marginBottom : 20,
    },
    btnMarketSearchText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/normalUser/market/MarketSearchResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

import { Geolocation } from '@remobile/react-native-baidu-map';

const SearchResult = require('./SearchResult');
const BaidumapSelectPosition = require('../../baidumap');

module.exports = React.createClass({
    statics: {
        title: '查询结果',
        rightButton: { title: '位置', handler: () => { app.scene.setPosition(); } },
    },
    getInitialState () {
        return {
            mapInfo:{ location:[0, 0], region:this.props.startInfo.startPoint || '' },
        };
    },
    setPosition () {
        app.push({
            component: BaidumapSelectPosition,
            passProps:{
                confirm:(marker) => {
                    this.setState({ mapInfo:{ region:marker.province + marker.city, location:[marker.longitude, marker.latitude] } }, () => { this.updateRightButton(marker.city); });
                },
            },
        });
    },
    componentWillMount () {
        Geolocation.getCurrentPosition()
            .then(data => {
                console.warn(JSON.stringify(data));
                this.setState({ mapInfo:{ region:data.province + data.city, location:[data.longitude, data.latitude] } }, () => { this.updateRightButton(data.city); });
            })
            .catch(e => {
                console.warn(e, 'error');
            });
    },
    updateRightButton (city) {
        app.getCurrentRoute().rightButton = { title:city, handler: () => { this.setPosition(); } };
        app.forceUpdateNavbar();
    },
    // changeTab () {
    //     this.setState({ tabIndex: selectIndex });
    // },
    render () {
        const { mapInfo } = this.state;
        const { startInfo, endPoint, isSendDoor, sendDoorEndPoint, endPointLastCode, sendDoorEndPointLastCode } = this.props;
        const info = {
            endPoint,
            endPointLastCode,
            sendDoorEndPointLastCode,
            region:startInfo && startInfo.startPoint || '',
            ...startInfo,
            ...mapInfo,
        };
        return (
            <View style={styles.container}>
                <SearchResult mapInfo={info} sendDoor={isSendDoor} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        height: 30,
        width: 140,
        borderRadius:5,
        borderColor:'white',
        borderWidth:1,
        flexDirection: 'row',
        overflow: 'hidden',
    },
    touchTab: {
        flex:1,
        alignItems:'center',
        justifyContent:'center',
    },
    backgroundColorSelected: {
        backgroundColor:'#E5E5E5',
    },
    backgroundColorNoSelected: {
        backgroundColor:'#c81622',
    },
});

```

* PDClient/project/App/modules/normalUser/market/RoadmapSimpleList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    getInitialState () {
        const ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource: ds.cloneWithRows(this.props.list),
        };
    },
    componentWillReceiveProps (nextProps) {
        const { dataSource } = this.state;
        const { list } = nextProps;
        const { list: originList } = this.props;
        if (!_.isEqual(list, originList)) {
            this.setState({ dataSource: dataSource.cloneWithRows(list) });
        }
    },
    renderRow (obj) {
        const { name, type, startPoint, endPoint, transitPoint, price, duration } = obj;
        return (
            <View style={styles.row}>
                <View style={styles.nameContainer}>
                    <Text numberOfLines={1} style={styles.name}>{name}</Text>
                    <Text numberOfLines={1} style={[styles.type, { color: type === 0 ? '#228B22' : '#FF4500' }]}>{type === 0 ? '整车' : '零担'}</Text>
                </View>
                <View style={styles.pointContainer}>
                    <Text style={styles.name}>{startPoint.name}</Text>
                    {!!transitPoint[0] && <Text style={styles.name}>→</Text>}
                    {!!transitPoint[0] && <Text style={styles.name}>{transitPoint[0].name}</Text>}
                    <Text style={styles.name}>→</Text>
                    <Text style={styles.name}>{endPoint.name}</Text>
                </View>
                <View style={styles.priceContainer}>
                    <Text style={styles.name}><Text style={{ color: '#DAA520' }}>{price}</Text>元/{type === 0 ? '车' : '吨'}</Text>
                    <Text style={styles.name}>历时<Text style={{ color: '#FF4500' }}>{duration}</Text>小时</Text>
                </View>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    initialListSize={1}
                    enableEmptySections
                    dataSource={this.state.dataSource}
                    renderRow={this.renderRow} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        paddingHorizontal: 8,
        paddingVertical: 10,
    },
    nameContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
        alignItems: 'center',
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    type: {
        fontSize: 14,
    },
    pointContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
    },
    priceContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
    },
});

```

* PDClient/project/App/modules/normalUser/market/SearchList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
let km = '';

module.exports = React.createClass({
    renderRow (obj, rowID) {
        const { mapInfo, sendDoor } = this.props;
        if (obj.distance) {
            if (obj.distance > 1) {
                km = parseInt(obj.distance) + 'km';
            } else {
                km = (parseInt(obj.distance) * 1000) + 'm';
            }
        }
        return (
            <View style={styles.row}>
                <Text style={styles.rowChildCenter} numberOfLines={1}>{obj.shopName}</Text>
                <View style={styles.rowChild}>
                    <View style={styles.address}>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.shipperName}</Text>
                        <Text >{'->'}</Text>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.endPoint}</Text>
                    </View>
                    <Text style={styles.rowChildDistance}>距我:{km}</Text>
                </View>
                <View style={styles.itemInfo}>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(parseInt(obj.price))}/吨</Text>
                        <Text style={styles.rowChildPrice}>运费</Text>
                    </View>
                    {
                        sendDoor && <View style={styles.item}>
                            <Text style={styles.rowChildNumber}>￥{app.utils.N(obj.sendDoorPrice)}/吨</Text>
                            <Text style={styles.rowChildPrice}>送货上门</Text>
                        </View>
                    }
                    <View style={styles.item}>
                        <Text style={styles.rowChildTime}>{app.utils.N(parseInt(obj.selfSignRate)) + '%'}</Text>
                        <Text style={styles.rowChildTitle}>亲签率</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildTime}>{obj.duration}天</Text>
                        <Text style={styles.rowChildTitle}>预计用时</Text>
                    </View>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, mapInfo, type } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, orderBy: index, ...mapInfo }}
                    listName={!mapInfo.shopId ? 'agent.roadmapList' : 'shop.roadmapList'}
                    listUrl={app.route.ROUTE_GET_ROADMAP_LIST_WITH_END_POINT}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    row: {
        flex:1,
        paddingVertical: 10,
        paddingHorizontal: 2,
        backgroundColor:'#FFFFFF',
        marginTop:1,
    },
    rowChild:{
        width:sr.w,
        flexDirection:'row',
        marginTop:3,
        marginBottom:3,
    },
    rowChildCenter:{
        fontSize:14,
        paddingBottom:5,
        fontWeight:'300',
        alignSelf:'center',
    },
    rowChildFont:{
        fontSize:14,
        marginLeft:5,
        fontWeight:'300',
    },
    rowChildDistance:{
        fontSize:12,
        color:'#FF9D24',
        fontWeight:'300',
        marginRight:5,
        flex:0.5,
    },
    rowChildNumber:{
        color:'#f61525',
        fontSize:15,
        fontWeight:'500',
    },
    rowChildTime:{
        fontSize:16,
        color:'#333333',
    },
    rowChildTitle:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    rowChildPrice:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    address:{
        flexDirection:'row',
        flex:1.5,
    },
    itemInfo:{
        flexDirection:'row',
        flex:1,
        alignItems:'center',
        justifyContent:'center',
        marginTop:3,
    },
    item:{
        flex:1,
        alignItems:'center',
        justifyContent:'center',
    },
});

```

* PDClient/project/App/modules/normalUser/market/SearchResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const SearchList = require('./SearchList');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['价格最低', '时间最短', '亲签率最高', '距离最短'];
        const { tabIndex } = this.state;
        const { mapInfo, sendDoor } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <SearchList key={i} index={i} tabIndex={tabIndex} mapInfo={mapInfo} sendDoor={sendDoor} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/normalUser/market/ShipperDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ScrollView,
    TouchableOpacity,
} = ReactNative;

const CellPhoneBox = require('./CellPhoneBox');
const RoadmapSimpleList = require('./RoadmapSimpleList');
const RoadmapList = require('../../logisticsCompany/roadmap');

module.exports = React.createClass({
    componentWillMount () {
        app.toggleNavigationBar(true);
    },
    getInitialState () {
        return {
            data: this.props.data,
        };
    },
    openCell (phone) {
        app.showModal(<CellPhoneBox phone={phone} />, { touchHide: true });
    },
    careShipper () {
        const param = {
            userId: app.personal.info.userId,
            shipperId: this.props.data.shipperId,
        };
        POST(app.route.ROUTE_CARE_SHIPPER, param, this.careShipperSuccess, true);
    },
    careShipperSuccess (data) {
        if (data.success) {
            const { data } = this.state;
            data.isCare = true;
            data.cares++;
            this.setState({ data });
        } else {
            Toast(data.msg);
        }
    },
    showAllRoadmapList () {
        const { data } = this.state;
        app.push({
            title: '路线列表',
            component: RoadmapList,
            passProps: {
                shipper: data,
            },
        });
    },
    render () {
        const { name, address, sign, logo, image, cares, isCare, phoneList, roadmapList, roadmapCount } = this.state.data;
        return (
            <ScrollView>
                <View style={styles.container}>
                    <View style={styles.nameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={{ uri: logo }}
                            style={styles.logo} />
                        <Text numberOfLines={1} style={styles.name}>{name}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={{ uri: image }}
                        style={styles.image} />
                    <Text style={styles.label}>联系方式：</Text>
                    {
                        phoneList.map((phone, i) => (
                            <TouchableOpacity key={i} style={styles.phoneContainer} onPress={this.openCell.bind(null, phone)}>
                                <Image resizeMode='stretch' source={app.img.shipper_phone} style={styles.icon} />
                                <Text style={styles.phone}>{phone}</Text>
                            </TouchableOpacity>
                        ))
                    }
                    <Text style={styles.label}>公司签名：</Text>
                    <Text style={styles.sign}>{sign}</Text>
                    <Text style={styles.label}>公司地址：</Text>
                    <Text style={styles.address}>{address}</Text>
                    <Text style={styles.label}>关注人数：</Text>
                    <View style={styles.careContainer}>
                        <TouchableOpacity onPress={isCare ? Toast.bind(null, '您已经点赞过!') : this.careShipper}>
                            <Image
                                resizeMode='stretch'
                                source={isCare ? app.img.shipper_care_press : app.img.shipper_care_normal}
                                style={styles.icon} />
                        </TouchableOpacity>
                        <Text style={styles.cares}>{cares || 1}</Text>
                    </View>
                    <Text style={styles.label}>路线：</Text>
                    <RoadmapSimpleList list={roadmapList} />
                    {
                        roadmapCount >= roadmapList.length &&
                        <TouchableOpacity
                            onPress={this.showAllRoadmapList}
                            underlayColor='#EEB422'>
                            <Text style={styles.customRecordHeader}>查看该物流公司所有路线</Text>
                        </TouchableOpacity>
                    }
                </View>
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingHorizontal: 10,
        paddingTop: 20,
        paddingBottom: 50,
        backgroundColor: '#FFFFFF',
    },
    nameContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    logo: {
        width: 40,
        height: 40,
        borderRadius: 20,
        marginRight: 10,
    },
    name: {
        fontSize: 20,
    },
    image: {
        marginTop: 20,
        width: sr.w - 20,
        height: (sr.w - 20) * 2 / 3,
        borderRadius: 10,
    },
    label: {
        marginTop: 20,
        fontSize: 14,
        color: 'gray',
    },
    phoneContainer: {
        marginTop: 20,
        flexDirection: 'row',
        alignItems: 'center',
    },
    phone: {
        fontSize: 20,
        color: '#EE4000',
    },
    sign: {
        fontSize: 14,
        marginTop: 10,
        marginLeft: 20,
        lineHeight: 20,
    },
    address: {
        fontSize: 14,
        marginTop: 10,
        marginLeft: 20,
        lineHeight: 20,
    },
    careContainer: {
        marginTop: 10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    cares: {
        fontSize: 20,
        color: 'green',
    },
    icon: {
        width: 30,
        height: 30,
        marginLeft: 15,
        marginRight: 40,
    },
    customRecordHeader: {
        fontSize: 15,
        color:'#2aa7af',
        paddingTop: 10,
        paddingLeft: 30,
        marginRight: 10,
        marginBottom: 5,
    },
});

```

* PDClient/project/App/modules/normalUser/market/ShipperIntro.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    ScrollView,
} = ReactNative;

import Swiper from 'react-native-swiper';
const ShipperDetail = require('./ShipperDetail');
const CacheImage = require('@remobile/react-native-cache-image');

module.exports = React.createClass({
    componentWillMount () {
        app.toggleNavigationBar(false);
    },
    getInitialState () {
        const { descriptList } = this.props.data;
        return {
            descriptList: [false, ...descriptList, true],
        };
    },
    renderDots (index, total) {
        if (total <= 1) return null;
        const dots = [];
        const ActiveDot = <View style={{
            backgroundColor: '#FFFFFF',
            width: 8,
            height: 8,
            borderRadius: 4,
            marginLeft: 6,
            marginRight: 6,
            marginTop: 3,
            marginBottom: 3,
        }}
            />;
        const Dot = <View style={{
            backgroundColor: 'gray',
            width: 4,
            height: 4,
            borderRadius: 2,
            marginLeft: 7,
            marginRight: 7,
            marginTop: 4,
            marginBottom: 4,
        }}
            />;
        for (let i = 1; i < total - 1; i++) {
            dots.push(i === index
                ? React.cloneElement(ActiveDot, { key: i })
                : React.cloneElement(Dot, { key: i })
            );
        }
        return (
            <View pointerEvents='none' style={{ flexDirection: 'row' }}>
                {dots}
            </View>
        );
    },
    renderPagination (index, total, swiper) {
        return (
            <View style={styles.pageContainer}>
                <View style={styles.line} />
                <View style={styles.iconContainer}>
                    <View style={styles.iconInnerContainer}>
                        <TouchableOpacity onPress={this.goBack}>
                            <Image resizeMode='contain' source={app.img.common_home} style={styles.iconImage} />
                        </TouchableOpacity>
                        <TouchableOpacity onPress={this.showShipperDetail}>
                            <Image resizeMode='contain' source={app.img.shop_comment} style={styles.iconImage} />
                        </TouchableOpacity>
                    </View>
                    {this.renderDots(index, total)}
                </View>
            </View>
        );
    },
    goBack () {
        app.pop();
        app.toggleNavigationBar(true);
    },
    showShipperDetail () {
        app.navigator.replace({
            title: '物流公司详情',
            component: ShipperDetail,
            passProps: {
                ...this.props,
            },
        });
    },
    onMomentumScrollEnd (e, state) {
        if (state.index === 0) {
            this.goBack();
        } else if (state.index === state.total - 1) {
            this.showShipperDetail();
        }
    },
    onLayout (i, e) {
        const { height } = e.nativeEvent.layout;
        const { descriptList } = this.state;
        descriptList[i].height = Math.min(sr.s(120), height);
        this.setState({ descriptList });
    },
    render () {
        const { descriptList } = this.state;
        return (
            <View style={{ flex: 1 }}>
                {
                    !!descriptList &&
                    <Swiper
                        index={1}
                        renderPagination={this.renderPagination}
                        onMomentumScrollEnd={this.onMomentumScrollEnd}
                        loop={false}
                        height={sr.th}
                        >
                        {
                            descriptList.map((item, i) => {
                                if (item === false) {
                                    return (
                                        <View style={styles.blankView} key={i}>
                                            <Text style={styles.blankViewTextLeft}>
                                                回返滑右续继
                                            </Text>
                                        </View>
                                    );
                                }
                                if (item === true) {
                                    return (
                                        <View style={styles.blankView} key={i}>
                                            <Text style={styles.blankViewTextRight}>
                                                继续左滑查看详情
                                            </Text>
                                        </View>
                                    );
                                }
                                return (
                                    <CacheImage key={i} resizeMode='stretch' url={item.img} defaultSource={app.img.common_default} style={styles.shipperImage}>
                                        <View style={[styles.back, { height: !item.height ? 0 : item.height + sr.s(80) }]} />
                                        <ScrollView style={[styles.infoContainer, { height: item.height || 0 }]}>
                                            <Text style={styles.text} onLayout={this.onLayout.bind(null, i)}>
                                                <Text style={styles.descriptionHead}>
                                                    {item.text[0]}
                                                </Text>
                                                {item.text.substr(1)}
                                            </Text>
                                        </ScrollView>
                                    </CacheImage>
                                );
                            })
                        }
                    </Swiper>
                }
                <Image resizeMode='contain' source={app.img.login_logo} style={styles.logoImage} />
            </View>
        );
    },
});
const styles = StyleSheet.create({
    blankView: {
        flex: 1,
        backgroundColor: '#000000',
        justifyContent: 'center',
        alignItems: 'center',
    },
    blankViewTextLeft: {
        color: '#FFFFFF',
        fontSize: 30,
        textAlign: 'right',
    },
    blankViewTextRight: {
        color: '#FFFFFF',
        fontSize: 30,
    },
    shipperImage: {
        width: sr.w,
        height: sr.h,
    },
    logoImage: {
        position: 'absolute',
        width: 100,
        height: 100,
        left: 20,
        top: 0,
    },
    back: {
        height: 200,
        width: sr.w,
        position: 'absolute',
        bottom: 0,
        backgroundColor: 'rgba(0, 0, 0, 0.7)',
    },
    infoContainer: {
        height: 120,
        width: sr.w,
        position: 'absolute',
        bottom: 70,
        paddingHorizontal: 20,
    },
    descriptionHead: {
        fontSize: 25,
    },
    text: {
        fontSize: 15,
        lineHeight: 30,
        color: '#FFFFFF',
    },
    line: {
        height: 1,
        width: sr.w - 40,
        marginLeft: 20,
        backgroundColor: '#808080',

    },
    pageContainer: {
        height: 60,
        width: sr.w,
        position: 'absolute',
        bottom: 0,
    },
    iconContainer: {
        height: 60,
        width: sr.w,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        paddingRight: 20,
    },
    iconInnerContainer: {
        flexDirection: 'row',
    },
    iconImage: {
        width: 30,
        height: 30,
        marginLeft: 30,
    },
});

```

* PDClient/project/App/modules/normalUser/market/ShipperMarketList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '物流超市',
    },
    getInitialState () {
        return {
            type:'a',
        };
    },
    toChoose (obj) {
        this.setState({
            type:obj.type,
        });
    },
    renderRow (obj) {
        const { type } = this.state;

        return (
            <View style={styles.container} >
                <TouchableOpacity onPress={this.toChoose.bind(null, obj)}>
                    <View style={styles.item}>
                        <Text style={styles.nameText}>
                            {obj.name}
                        </Text>
                        {
                            (type === obj.type) &&
                            <Image
                                resizeMode='stretch'
                                source={app.img.common_radio}
                                style={styles.icon_go} />

                        }

                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'shipperList'}
                    listUrl={app.route.ROUTE_GET_SHIPPERLIST_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    item:{
        height:42,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    nameText:{
        paddingLeft:8,
        color:'#333333',
        fontSize:14,
    },
    icon_go: {
        width: 10,
        height: 10,
        marginRight: 12,
    },
});

```

* PDClient/project/App/modules/normalUser/market/ShipperRanking.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '物流排名',
    },
    getInitialState () {
        return {
            price:false,
            time:false,
            best:false,
        };
    },
    toPrice () {
        this.setState({
            price:true,
            time:false,
            best:false,
        });
    },
    toTime () {
        this.setState({
            price:false,
            time:true,
            best:false,
        });
    },
    toBest () {
        this.setState({
            price:false,
            time:false,
            best:true,
        });
    },
    render () {
        const { price, time, best } = this.state;
        return (
            <View style={styles.container}>
                <TouchableOpacity onPress={this.toPrice}>
                    <View style={[styles.leastPrice, { marginTop:9 }]}>
                        <Text style={styles.leastPriceLeft}>
                            一键最低价
                        </Text>
                        <Image source={app.img.common_radio}
                            resizeMode='stretch'
                            style={price ? styles.choose : styles.lost} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.toTime}>
                    <View style={styles.leastPrice}>
                        <Text style={styles.leastPriceLeft}>
                            一键最短时间
                        </Text>
                        <Image source={app.img.common_radio}
                            resizeMode='stretch'
                            style={time ? styles.choose : styles.lost} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.toBest}>
                    <View style={styles.leastPrice}>
                        <Text style={styles.leastPriceLeft}>
                            最优选择
                        </Text>
                        <Image source={app.img.common_radio}
                            resizeMode='stretch'
                            style={best ? styles.choose : styles.lost} />
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    leastPrice:{
        height:42,
        justifyContent: 'space-between',
        marginTop:1,
        alignItems:'center',
        backgroundColor:'#FFFFFF',
        flexDirection:'row',
    },
    leastPriceLeft:{
        paddingLeft:10,
        fontSize:14,
        color:'#333333',
    },
    choose:{
        width: 10,
        height: 10,
        marginRight: 12,
    },
    lost:{
        width: 0,
        height: 0,
    },
});

```

* PDClient/project/App/modules/normalUser/market/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ScrollView,
    TouchableOpacity,
} = ReactNative;

import Swiper from 'react-native-swiper';
const CacheImage = require('@remobile/react-native-cache-image');
const LongDistance = require('./LongDistance');
const CityDistrbution = require('./CityDistribution');

module.exports = React.createClass({
    statics: {
        title: '行情查询',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '行情查询';
        app.getCurrentRoute().rightButton = null;
        app.forceUpdateNavbar();
    },
    getInitialState () {
        return {
            status : false,
        };
    },
    changePattern () {
        this.setState({ status : !this.state.status });
    },
    render () {
        const { status } = this.state;
        return (
            <ScrollView style={styles.container}>
                <Swiper
                    index={1}
                    loop={false}
                    height={160}
                    >
                    {
                        [1, 2].map((item, i) => {
                            return (
                                <CacheImage key={i} resizeMode='stretch' url={item.img} defaultSource={app.img.common_default} style={styles.shipperImage} />
                            );
                        })
                    }
                </Swiper>
                <View style={styles.card}>
                    <View>
                        <Text style={styles.cardText}>行情查询</Text>
                        <TouchableOpacity onPress={this.changePattern}>
                            <Text style={styles.switch}>{ status ? '切至长途专线' : '切至同城配送'}</Text>
                        </TouchableOpacity>
                    </View>
                    {
                        status && <CityDistrbution /> || <LongDistance />
                    }

                </View>

            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    card: {
        marginTop:-20,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor: '#FFFFFF',
        borderRadius:4,
    },
    switch: {
        textAlign:'right',
        paddingRight:10,
        paddingBottom:10,
        alignSelf:'flex-end',
        fontSize:13,
        color:'#333333',
    },
    cardText: {
        paddingTop:20,
        textAlign:'center',
        fontSize: 15,
        color: '#444444',
    },
    shipperImage: {
        width: sr.w,
        height: 160,
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
    },
    infoStyle: {
        flexDirection: 'row',
        flex:1,
    },
    itemNameText: {
        fontSize: 15,
        color: '#666666',
        marginLeft: 8,
    },
    itemContentText: {
        fontSize: 14,
        color: '#333333',
        marginRight:5,
        width:sr.w * 0.65,
        textAlign:'right',
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: 351,
        height: 1,
        backgroundColor: '#f8f8f8',
    },
    line:{
        height: 1,
        backgroundColor: '#f8f8f8',
    },
    choose: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
    },
    imgChoose: {
        width: 15,
        height: 15,
        marginLeft:10,
    },
    chooseText: {
        fontSize:14,
        marginLeft:10,
        color:'#666666',
    },
    btnMarketSearch:{
        marginTop:20,
        height:40,
        width:300,
        marginLeft:20,
        borderRadius:5,
        backgroundColor:'#c81622',
        marginBottom : 20,
    },
    btnMarketSearchText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/normalUser/market/shipperList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;
const ShipperIntro = require('./ShipperIntro');

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入关键字搜索物流公司'
                    defaultValue={searchText}
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
        rightButton: { title: '搜索', handler: () => { app.scene.refresh(); } },
    },
    getInitialState () {
        return {
            keyword: '',
        };
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    getShipperDetail (obj, index) {
        const param = {
            userId: app.personal.info.userId,
            shipperId: obj.shipperId,
        };
        POST(app.route.ROUTE_GET_SHIPPER_DETAIL, param, this.getShipperDetailSuccess.bind(null, index), true);
    },
    getShipperDetailSuccess (index, data) {
        const { success, msg } = data;
        if (success) {
            app.push({
                component: ShipperIntro,
                passProps: {
                    data: data.context,
                    updateList: () => {
                        this.listView.updateList((list) => {
                            list[index].cares++;
                            return list;
                        });
                    },
                },
            });
        } else {
            Toast(msg);
        }
    },
    renderRow (obj, sectionID, rowID) {
        const { image, name, logo, sign, address, cares } = obj;
        return (
            <TouchableOpacity style={styles.row} onPress={this.getShipperDetail.bind(null, obj, rowID)}>
                <Image
                    resizeMode='stretch'
                    source={{ uri: image }}
                    style={styles.image} />
                <View style={styles.rowRight}>
                    <View style={styles.nameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={{ uri: logo }}
                            style={styles.logo} />
                        <Text numberOfLines={1} style={styles.name}>{name}</Text>
                    </View>
                    <Text numberOfLines={1} style={styles.sign}>{sign}</Text>
                    <Text numberOfLines={1} style={styles.address}>{address}</Text>
                    <View style={styles.iconContainer}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.shipper_care_press}
                            style={styles.icon} />
                        <Text style={styles.careLabel}>关注：<Text style={styles.care}>{cares || 1}</Text></Text>
                    </View>
                </View>
            </TouchableOpacity>
        );
    },
    render () {
        const { keyword } = this.state;
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, keyword }}
                    listName={'shipperList'}
                    listUrl={app.route.ROUTE_GET_SHIPPER_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    searchContainer: {
        height: 30,
        width: 250,
        paddingVertical: 2,
        borderRadius: 105,
        backgroundColor: '#E5E5E5',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        height: 25,
        width: 220,
        fontSize: 14,
        marginLeft: 5,
        overflow: 'hidden',
        alignItems:'center',
    },
    iconSearch: {
        height: 20,
        width: 20,
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 2,
        alignItems: 'center',
        height: 140,
    },
    image: {
        width: 120,
        height:100,
        borderRadius: 10,
    },
    rowRight: {
        paddingLeft: 10,
    },
    nameContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    logo: {
        width: 26,
        height: 26,
        borderRadius: 13,
        marginRight: 5,
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    sign: {
        width: sr.w - 140,
        fontSize: 12,
        marginTop: 10,
    },
    address: {
        fontSize: 12,
        color: 'gray',
        marginTop: 10,
    },
    iconContainer: {
        marginTop: 10,
        flexDirection: 'row',
        alignItems: 'center',
        alignSelf: 'flex-end',
        marginRight: 10,
    },
    icon: {
        width: 20,
        height: 20,
        marginRight: 4,
    },
    careLabel: {
        fontSize: 12,
        color: '#8E8E8E',
    },
    care: {
        color: '#EE4000',
    },
});

```

* PDClient/project/App/modules/normalUser/order/PaymentSuccess.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '支付成功',
        rightButton: { title: '完成', handler: () => { app.scene.complete(); } },
    },
    complete () {

    },
    doCheck () {

    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.pay_info}>
                    <Image style={styles.imagePayInfo}
                        resizeMode='stretch'
                        source={app.img.order_pay_success}
                        />
                    <Text style={styles.textCompelet}> 支付成功 </Text>
                    <Text style={styles.textMoney}> ¥ 200.00 </Text>
                </View>
                <Button onPress={this.doCheck} style={styles.btnCheck} textStyle={styles.btnCheckText} >
                    查看货单
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    pay_info:{
        height:150,
        backgroundColor:'#FFFFFF',
        alignItems: 'center',
    },
    imagePayInfo:{
        height:50,
        width:50,
        marginTop:13,
    },
    textCompelet:{
        fontSize:17,
        color:'#2b9320',
        fontWeight:'600',
        marginTop:13,
    },
    textMoney:{
        fontSize:20,
        color:'#333333',
        marginTop:10,
        fontWeight:'500',
    },
    btnCheck:{
        marginTop:110,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnCheckText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'600',
    },
});

```

* PDClient/project/App/modules/normalUser/order/ReceiveOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, CustomSheet } = COMPONENTS;
const PayInfo = require('../../common/PayInfo');
const PayPassword = require('../../common/PayPassword');
const LogisticsDetail = require('../../common/LogisticsDetail');
const moment = require('moment');

module.exports = React.createClass({
    statics: {
        title: '货单详情',
    },
    getInitialState () {
        return {
            choose:false,
            receiving:false || this.props.receiving,
            data:{},
            actionSheetVisible: false,
        };
    },
    componentWillMount () {
        this.getOrderDetail();
    },
    getOrderDetail () {
        const param = {
            userId: app.personal.info.userId,
            orderId: this.props.orderId,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess, true);
    },
    getOrderDetailSuccess (data) {
        if (data.success) {
            this.setState({ data:data.context });
        } else {
            Toast(data.msg);
        }
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        if (this.state.choose) { // 现金支付
            Toast('成功确认收货');// 需要物流公司确认收到现金
        } else { // app支付
            this.setState({ actionSheetVisible:true });
        }
    },
    doConfim () {
        const param = {
            userId: app.personal.info.userId,
            orderId: this.props.orderId,
        };
        POST(app.route.ROUTE_FINISH_ORDER, param, this.getFinishOrderSuccess, true);
    },
    doConfirmPay () {
        const { data } = this.state;
        const param = {
            userId: app.personal.info.userId,
            orderId: this.props.orderId,
        };
        app.push({
            component:PayPassword,
            passProps:{
                param,
                routeName : app.route.ROUTE_PAY_FOR_ORDER_WHEN_RECEIVE,
                prompt : '支付成功',
                doCloseActionSheet : this.doCloseActionSheet,
                money:app.utils.N(data.totalDesignatedFee + data.proxyCharge),
                refresh:this.props.refresh,
            },
        });
    },
    getFinishOrderSuccess (data) {
        if (data.success) {
            Toast('成功确认收货');
            this.props.refresh();
        } else {
            Toast(data.msg);
        }
    },
    toLogisticsDetail () {
        const { data } = this.state;
        app.push({
            component:LogisticsDetail,
            passProps:{
                obj:data,
            },
        });
    },
    doChoose () {
        this.setState({
            choose:!this.state.choose,
        });
    },
    toPayMode (payMode) {
        if (payMode == 0) {
            return '现付';
        } else if (payMode == 1) {
            return '到付';
        } else {
            return '混合付款';
        }
    },
    render () {
        const { data } = this.state;
        const { stateList } = data;
        return (
            <View style={styles.container}>
                <View style={styles.containerReceive}>
                    <Text style={styles.textName}> 收货人：{!data.receiverName ? '暂无' : data.receiverName}</Text>
                    <Text style={styles.textName}> 收货人电话:{!data.receiverPhone ? '暂无' : data.receiverPhone}</Text>
                    <Text style={styles.textAddress}> 到货地：{data && data.endPoint} </Text>
                </View>
                <View style={styles.containerMarket}>
                    <View style={styles.containerMarketLeft}>
                        <Image style={styles.imageLogo}
                            source={app.img.order_logo}
                            resizeMode='stretch'
                            />
                        <Text style={styles.textMarket}>{data.shop ? data.shop.name : data.agent ? data.agent.name : ''}</Text>
                    </View>
                    <Text style={styles.textGetState}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.containerDetails}>
                    <Image style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.home_order}
                        source={{ uri:data.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.shop ? data.shop.address : data.agent ? data.agent.address : ''}</Text>
                                <Text>-></Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.endPoint}</Text>
                            </View>
                            <View style={styles.detailsTopRight}>
                                <Text style={styles.moneyLeft}>运费：</Text>
                                <Text style={styles.moneyRight}>¥{data.realFee}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>重量：{data.size}m³</Text>
                        <Text style={styles.textDetailsItem}>方量：{data.weight}吨</Text>
                        <Text style={styles.textDetailsItem}>件数：{data.totalNumbers}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.containerWhite} />
                <View style={styles.containerNumber}>
                    <Text style={styles.textNumber}>订单号：{data.id}</Text>
                    <Text style={styles.textDate}>创建时间：{data.createTime}</Text>
                </View>
                <View style={styles.containerInfo}>
                    <Text style={styles.textInfo}>运费：¥{data.realFee}</Text>
                    <Text style={styles.textInfo}>指定收款：¥{data.totalDesignatedFee}</Text>
                    <Text style={styles.textInfo}>代收货款：¥{data.proxyCharge}</Text>
                    <Text style={styles.textInfo}>
                        支付方式：{this.toPayMode(data.payMode)}
                    </Text>
                    <Text style={styles.textTotal}>需支付：¥{app.utils.N(data.totalDesignatedFee + data.proxyCharge)}</Text>
                </View>
                <TouchableOpacity onPress={this.toLogisticsDetail}>
                    <View style={styles.logInfo}>
                        <Text style={styles.textLogInfo}>物流信息</Text>
                        <View style={styles.logInfoRight}>
                            <Text style={styles.textLogInfoRight}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                            <Image
                                style={styles.imageCommon_go}
                                resizeMode='stretch'
                                source={app.img.common_go}
                                />
                        </View>
                    </View>
                </TouchableOpacity>
                {
                    this.state.receiving ? (data.totalDesignatedFee + data.proxyCharge) > 0 ?
                        <Button onPress={this.doShowActionSheet} style={styles.btnReceive} textStyle={styles.btnReceiveText}>
                        立即支付
                    </Button>
                    : <Button onPress={this.doConfim} style={styles.btnReceive} textStyle={styles.btnReceiveText}>
                        确认收货
                    </Button>
                    : null

                    // <View>
                    //     <View style={styles.logInfo}>
                    //         {
                    //             (data.totalDesignatedFee + data.proxyCharge)>0 &&
                    //             <View style={{flexDirection:'row'}}>
                    //                 <TouchableOpacity style={styles.choose} onPress={this.doChoose}>
                    //                     { this.state.choose ?
                    //                         <Image
                    //                             style={styles.imageChoose}
                    //                             resizeMode='stretch'
                    //                             source={app.img.order_choose_r}
                    //                             />
                    //                         :
                    //                         <Image
                    //                             style={styles.imageChoose}
                    //                             resizeMode='stretch'
                    //                             source={app.img.order_no_choose_r}
                    //                             />
                    //                     }
                    //                     <Text style={[styles.textLogInfoRight, { marginLeft:5 }]}>现金支付</Text>
                    //                 </TouchableOpacity>
                    //                 <View style={styles.logInfoRight}>
                    //                     <Text style={styles.moneyLeft}>运费：</Text>
                    //                 <Text style={styles.moneyRight}>¥{app.utils.N(data.totalDesignatedFee + data.proxyCharge)}</Text>
                    //                 </View>
                    //             </View> || <View style={styles.isReachPay}></View>
                    //
                    //         }
                    //
                    //     </View>
                    //     <Button onPress={(data.totalDesignatedFee + data.proxyCharge)>0 && this.doShowActionSheet || this.doConfim} style={styles.btnReceive} textStyle={styles.btnReceiveText}>
                    //         确认收货
                    //     </Button>
                    // </View>
                }
                <CustomSheet
                    visible={this.state.actionSheetVisible} >
                    <PayInfo doClose={this.doCloseActionSheet} data={data} doConfirmPay={this.doConfirmPay} type={'receive'} />
                </CustomSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    containerTop:{
        height:60,
        backgroundColor:'#c81622',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    imageTop:{
        height:32,
        width:27,
    },
    textTop:{
        fontSize:12,
        fontWeight:'900',
        marginLeft:20,
        color:'#ffffff',
    },
    containerReceive:{
        marginTop:8,
        paddingLeft:10,
        height:55,
        backgroundColor:'#ffffff',
        justifyContent: 'center',
    },
    textAddress:{
        fontSize:12,
        marginBottom:3,
        color:'#333333',
        flex:1,
    },
    textName:{
        fontSize:12,
        color:'#333333',
        flex:1,
    },
    containerMarket:{
        height:25,
        marginTop:8,
        backgroundColor:'#ffffff',
        alignItems: 'center',
        justifyContent: 'space-between',
        flexDirection: 'row',
    },
    containerMarketLeft:{
        flexDirection: 'row',
    },
    imageLogo:{
        height:13,
        width:16.5,
        marginLeft:10,
    },
    textMarket:{
        marginLeft:10,
        color:'#333333',
        fontSize:12,
    },
    textGetState:{
        color:'#00a117',
        marginRight:10,
        fontSize:12,
    },
    containerDetails:{
        height:105,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    containerWhite:{
        height:8,
        backgroundColor:'#ffffff',
    },
    imageGoods:{
        height:75,
        width:75,
        marginLeft:12,
        marginTop:15,
    },
    goodsDetails:{
        marginLeft:8,
        height:95,
        paddingBottom:8,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
        marginTop:15,
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
        marginTop:15,
    },
    detailsAddress:{
        fontSize:14,
        width:80,
        color:'#333333',
        flexDirection: 'row',

    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:12,
        color:'#888888',
    },
    containerNumber:{
        height:50,
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        justifyContent: 'center',
    },
    textNumber:{
        color:'#333333',
        marginBottom:3,
        fontSize:12,
    },
    textDate:{
        color:'#888888',
        marginTop:3,
        fontSize:12,
    },
    containerInfo:{
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        paddingBottom:5,
        paddingTop:5,
    },
    textInfo:{
        color:'#888888',
        fontSize:12,
        marginTop:5,
        height:15,
    },
    textTotal:{
        marginTop:5,
        fontSize:12,
        color:'#333333',
        fontWeight:'400',
        height:15,
    },
    logInfo:{
        height:40,
        backgroundColor:'#ffffff',
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLogInfo:{
        color:'#888888',
        fontSize:14,
        marginLeft:10,
    },
    logInfoRight:{
        marginRight:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    textLogInfoRight:{
        fontSize:14,
        color:'#333333',
        marginRight:5,
    },
    imageCommon_go:{
        width: 8,
        height: 15,
        marginRight: 7,
    },
    choose:{
        marginLeft:10,
        flexDirection: 'row',
        alignItems: 'center',
        flex:1,
    },
    imageChoose:{
        height:15,
        width:15,
    },
    btnReceive:{
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:4,
        marginTop:30,
    },
    btnReceiveText:{
        fontSize:16,
        fontWeight:'500',
    },
    isReachPay:{
        backgroundColor:'#f4f4f4',
        width:sr.w,
        height:45,
    },
});

```

* PDClient/project/App/modules/normalUser/order/ReceiveOrderList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList, Button, DImage } = COMPONENTS;
const ReceiveOrderDetail = require('./ReceiveOrderDetail');
const LogisticsDetail = require('../../common/LogisticsDetail');
const moment = require('moment');

module.exports = React.createClass({
    statics: {
        title: '我要收货',
    },
    onWillFocus () {
        app.getCurrentRoute().title = '我要收货';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    getInitialState () {
        return {
            type:'',
            tabIndex: 0,
        };
    },
    doLookTransport (obj) {
        app.push({
            component: LogisticsDetail,
            passProps: {
                obj: obj,
            },
        });
    },
    doLookDetail (obj) {
        app.push({
            component: ReceiveOrderDetail,
            passProps:{
                receiving:false,
                orderId:obj.id,
            },
        });
    },
    doConfirmReceive (obj) {
        app.push({
            component: ReceiveOrderDetail,
            passProps:{
                receiving:true,
                orderId:obj.id,
                refresh:this.listView.refresh,
            },
        });
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={sectionID + rowID} />
        );
    },
    renderRow (obj, sectionID, rowID) {
        const { stateList } = obj;
        return (
            <View style={styles.row}>
                <View style={styles.rowTopContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.order_logo}
                        style={styles.topImage} />
                    <Text style={styles.topLeftText}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                    <Text style={styles.topRightText}>
                        {stateList ? OS.MAP[stateList[0].state] : ''}
                    </Text>
                </View>
                <TouchableOpacity
                    style={styles.rowMiddleContainer}
                    onPress={this.doLookDetail.bind(null, obj)}>
                    <DImage
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri: obj.photo }}
                        style={styles.middleImage} />
                    <View style={styles.middleRight}>
                        <View style={styles.pointContainer}>
                            <View style={styles.placeContainer}>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                <Text style={styles.pointName}>→</Text>
                                <Text style={styles.pointName}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{obj.endPoint}</Text>
                            </View>
                            <Text style={styles.transformFee}
                                >{'运费：'}<Text style={styles.money}>￥{obj.realFee}</Text></Text>
                        </View>
                        <Text style={styles.commonInfo}>{'重量：'}{obj.weight}吨</Text>
                        <Text style={styles.commonInfo}>{'方量：'}{obj.size}m³</Text>
                        <Text style={styles.commonInfo}>{'件数：'}{obj.totalNumbers}件</Text>
                        <Text style={styles.commonInfo}>{'下单时间：'}{moment(obj.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </TouchableOpacity>
                <View style={styles.rowButtomContainer}>
                    {
                        stateList[0].state == OS.OS_READY_RECEIVE &&
                        <Button
                            onPress={this.doConfirmReceive.bind(null, obj)}
                            style={styles.confirmReceive}
                            textStyle={styles.btnReceiveText}>
                            {'确认收货'}
                        </Button>
                    }
                    <Button
                        onPress={this.doLookTransport.bind(null, obj)}
                        style={styles.lookTransport}
                        textStyle={styles.btnTransportText}>
                        {'查看物流'}
                    </Button>
                </View>
            </View>
        );
    },
    render () {
        const menus = ['待发货', '运输中', '已到达', '已收货'];
        const { tabIndex } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.containerChoose}>
                    {
                        menus.map((item, i) => (
                            <TouchableOpacity
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableOpacity>
                        ))
                    }
                </View>
                <View style={styles.separator} />
                {
                    menus.map((item, i) => (
                        <View key={i} style={i === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                            <PageList
                                ref={(ref) => { this.listView = ref; }}
                                renderRow={this.renderRow}
                                renderSeparator={this.renderSeparator}
                                listParam={{
                                    userId: app.personal.info.userId,
                                    type:(i == 0 ? 'unsend' : i == 1 ? 'onway' : i == 2 ? 'reached' : 'complete'),
                                }}
                                listName={'orderList'}
                                listUrl={app.route.ROUTE_GET_RECEIVE_ORDER_LIST}
                                refreshEnable
                                />
                        </View>
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    containerChoose:{
        height:45,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemChoose:{
        flex:1,
        alignItems:'center',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
    typeContainer:{
        backgroundColor:'#c81622',
        height:80,
        width:60,
        position:'absolute',
        top:0,
        right:3,
    },
    typeButton:{
        height:25,
    },
    typeText:{
        fontSize:14,
        fontWeight:'400',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    separator: {
        backgroundColor: '#f8f8f8',
        height: 8,
    },
    rowTopContainer: {
        paddingHorizontal:10,
        paddingVertical:5,
        backgroundColor:'white',
        flexDirection: 'row',
    },
    topImage: {
        width: 17,
        height:17,
    },
    topLeftText: {
        marginLeft:10,
        flex:1,
        fontSize: 14,
    },
    topRightText: {
        flex:1,
        fontSize: 14,
        textAlign:'right',
        color:'#f51b1a',
    },
    rowMiddleContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:11,
        backgroundColor:'#f8f8f8',
    },
    middleImage: {
        width: 80,
        height:80,
        borderRadius: 10,
        marginLeft: 10,
    },
    middleRight: {
        paddingLeft: 10,
        width:sr.w - 100,
    },
    money: {
        fontSize: 14,
        color:'#f51b1a',
    },
    commonInfo: {
        fontSize: 13,
        color:'#888888',
    },
    pointName: {
        fontSize: 16,
        maxWidth: 80,
    },
    transformFee: {
        flex:0.8,
        fontSize: 14,
        color: 'gray',
        textAlign:'right',
    },
    pointContainer: {
        flexDirection: 'row',
    },
    placeContainer: {
        flex:1,
        flexDirection: 'row',
    },
    rowButtomContainer: {
        backgroundColor:'white',
        flexDirection: 'row',
        justifyContent: 'flex-end',
        paddingVertical:5,
    },
    lookTransport: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#ff6200',
        borderWidth:1,
        backgroundColor:'white',
        marginRight:10,
    },
    confirmReceive: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#c81622',
        borderWidth:1,
        marginRight:20,
        backgroundColor:'white',
    },
    btnTransportText:{
        color:'#ff6200',
        fontSize:12,
        fontWeight:'300',
    },
    btnReceiveText:{
        color:'#c81622',
        fontSize:12,
        fontWeight:'300',
    },
});

```

* PDClient/project/App/modules/normalUser/order/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const SendOrderList = require('../../common/SendOrderList');

module.exports = React.createClass({
    statics: {
        title: '我的货单',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = [{ name:'待付款', type:'waitpay' }, { name:'运输中', type:'onway' }, { name:'完成', type:'complete' }];
        const { tabIndex } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item.name}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <SendOrderList key={i} index={i} type={item.type} tabIndex={tabIndex} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/AddPreOrder.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
    ScrollView,
} = ReactNative;

const { DImage, SelectRegionAddress, SelectStartPointAddress, SelectShortAddress, ActionSheet } = COMPONENTS;
const Camera = require('@remobile/react-native-camera');
const PreOrderDetail = require('./PreOrderDetail');

module.exports = React.createClass({
    statics: {
        title: '填单',
        rightButton: { title: '保存', handler: () => { app.scene.prePlaceOrder(); } },
    },
    prePlaceOrder () {
        const { sendDoorEndPointLastCode, sendDoorEndPoint, name, senderName, isInsuance, startPoint, endPoint, receiverName, receiverPhone, weight, volume, totalNumbers, photo, endPointLastCode, isSendDoor, isCityDistribute, proxyCharge, totalDesignatedFee } = this.state;
        if (startPoint == '') {
            Toast('请选择始发地');
            return;
        }
        if (senderName == '') {
            Toast('发货人不能为空');
            return;
        }
        if (name == '') {
            Toast('货物名称不能为空');
            return;
        }
        if (receiverName == '') {
            Toast('收货人不能为空');
            return;
        }
        if (!app.utils.checkPhone(receiverPhone)) {
            Toast('请填写正确的收货人手机号码');
            return;
        }
        if (!isCityDistribute && endPoint == '') {
            Toast('请选择收货地');
            return;
        }
        if (!app.utils.checkNum(weight)) {
            Toast('请填写货物重量');
            return;
        }
        if (!app.utils.checkNum(volume)) {
            Toast('请填写货物体积');
            return;
        }
        if (!app.utils.checkIntNum(totalNumbers)) {
            Toast('请填写货物件数');
            return;
        }
        if (isSendDoor && sendDoorEndPoint == '') {
            Toast('请选择送货上门地址');
            return;
        }
        if (isCityDistribute && endPoint == '') {
            Toast('请选择同城配送地址');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            ...this.state,
        };
        POST(app.route.ROUTE_PLACE_PRE_ORDER, param, this.prePlaceOrderSuccess.bind(null, param), true);
    },
    prePlaceOrderSuccess (param, data) {
        if (data.success) {
            Toast('填单成功');
            app.push({
                component: PreOrderDetail,
                passProps:{
                    info:data.context,
                    refresh:this.props.refresh,
                },
            });
        } else {
            Toast(data.msg);
        }
    },
    getInitialState () {
        return {
            senderName:'',
            photo:'',
            receiverName:'',
            receiverPhone:'',
            endPoint: '',
            endPointLastCode:'',
            sendDoorEndPoint:'',
            sendDoorEndPointLastCode:'',
            weight:'',
            name:'',
            volume:'',
            totalNumbers:'',
            proxyCharge:0,
            totalDesignatedFee:0,
            isInsuance:false,
            isSendDoor:false,
            isCityDistribute:false,
            actionSheetVisible: false,
            isReachPay:false,
        };
    },
    setIsInsuance () {
        this.setState({
            isInsuance: !this.state.isInsuance,
        });
    },
    setIsSendDoor () {
        this.setState({
            isSendDoor: !this.state.isSendDoor,
        });
    },
    setIsCityDistribute () {
        this.setState({
            isCityDistribute: !this.state.isCityDistribute,
            endPoint:'',
            endPointLastCode:0,
        });
    },
    setReachPay () {
        this.setState({
            isReachPay: !this.state.isReachPay,
        });
    },
    showStartPlace () {
        const { startPointLastCode, shopId, agentId } = this.state;
        app.push({
            component: SelectStartPointAddress,
            passProps:{
                isNeedSelectAll:true,
                endPointLastCode:startPointLastCode,
                id:shopId || agentId,
                confirmAddress:(obj) => {
                    this.setState({ ...obj });
                },
            },
        });
    },
    showEndPlace () {
        const { endPointLastCode } = this.state;
        app.push({
            component: SelectRegionAddress,
            title:'到货地',
            passProps:{
                endPointLastCode,
                confirmAddress:(endPoint, endPointLastCode) => {
                    if (endPointLastCode != this.state.endPointLastCode) {
                        this.setState({ sendDoorEndPointLastCode:0, sendDoorEndPoint:'', isSendDoor : false });
                    }
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    showCityDistributeEndPlace () {
        const { endPointLastCode, startPointLastCode } = this.state;
        if (!startPointLastCode) {
            Toast('同城配送需先选择始发地');
            return;
        }
        app.push({
            component: SelectShortAddress,
            title:'同城配送地址',
            passProps:{
                endPointLastCode:endPointLastCode,
                parentCode : startPointLastCode,
                confirmAddress:(endPoint, endPointLastCode) => {
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    showSendDoorEndPlace () {
        const { endPointLastCode, sendDoorEndPointLastCode } = this.state;
        if (!endPointLastCode) {
            Toast('请先选择到货地');
            return;
        }
        app.push({
            component: SelectShortAddress,
            title:'送货上门地址',
            passProps:{
                endPointLastCode:sendDoorEndPointLastCode,
                parentCode : endPointLastCode,
                confirmAddress:(sendDoorEndPoint, sendDoorEndPointLastCode) => {
                    this.setState({ sendDoorEndPoint, sendDoorEndPointLastCode });
                },
            },
        });
    },
    doSelectPhoto () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.setState({ photo: uri });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            sourceType:Camera.PictureSourceType.PHOTOLIBRARY,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    selectPicture () {
        this.doCloseActionSheet();
        const options = {
            quality: 30,
            targetWidth: 240,
            targetHeight: 240,
            allowEdit: true,
            destinationType: Camera.DestinationType.FILE_URI,
            sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
        };
        Camera.getPicture((filePath) => {
            this.uploadPhoto(filePath);
        }, () => {
            Toast('操作失败');
        }, options);
    },
    takePicture () {
        this.doCloseActionSheet();
        const options = {
            quality: 30,
            allowEdit: true,
            targetWidth: 240,
            targetHeight: 240,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        };
        Camera.getPicture((filePath) => {
            this.uploadPhoto(filePath);
        }, () => {
            Toast('操作失败');
        }, options);
    },
    uploadPhoto (filePath) {
        this.setState({ headImgSource: { uri: filePath } });
        const options = {};
        options.fileKey = 'file';
        options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
        options.mimeType = 'image/jpeg';
        options.params = {
            clientId:app.personal.info.userID,
        };
        this.uploadOn = true;
        UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress),
        this.uploadSuccessCallback, this.uploadErrorCallback, true);
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            const context = data.context;
            this.setState({ photo:context.url });
        } else {
            Toast('上传失败');
        }
        this.uploadOn = false;
    },
    uploadErrorCallback () {
        this.uploadOn = false;
        this.setState({ photo: app.personal.info.head });
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        this.setState({ actionSheetVisible:true });
    },
    render () {
        const { photo, startPoint, endPoint, isSendDoor, isCityDistribute, isReachPay, isInsuance, actionSheetVisible, sendDoorEndPoint, endPointLastCode, sendDoorEndPointLastCode } = this.state;
        return (
            <View style={styles.container}>
                <ScrollView>
                    { photo == '' ?
                        <TouchableOpacity
                            onPress={this.doShowActionSheet}
                            style={styles.topImage}>
                            <DImage
                                defaultSource={app.img.order_upload_picture}
                                source={{ uri: photo }}
                                style={styles.photo} />
                            <Text style={styles.topImageText}>上传货物图片</Text>
                        </TouchableOpacity>
                        :
                        <TouchableOpacity
                            onPress={this.doShowActionSheet}
                            style={styles.topBigImage}>
                            <Text style={{ color:'#666666' }}>货物图片</Text>
                            <DImage
                                source={{ uri: photo }}
                                style={styles.bigPicture} />
                        </TouchableOpacity>
                    }
                    <View style={styles.itemStart}>
                        <Text style={styles.itemLeft}>发货人</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            placeholder='请输入发货人姓名'
                            onChangeText={(text) => this.setState({ senderName: text })}
                            />
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>货物名称</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            placeholder='请输入货物名称'
                            onChangeText={(text) => this.setState({ name: text })}
                            />
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>收货人</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            placeholder='请输入收货人姓名'
                            onChangeText={(text) => this.setState({ receiverName: text })}
                            />
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>收货人电话</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入收货人手机号码'
                            maxLength={11}
                            onChangeText={(text) => this.setState({ receiverPhone: text })}
                            />
                    </View>
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={this.showStartPlace}>
                        <View style={styles.itemStart}>
                            <Text style={styles.itemLeft}>始发地</Text>
                            <View style={styles.itemPoint}>
                                <Text style={[styles.itemRight, { paddingRight:5 }]}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{startPoint || ''}</Text>
                                <Image
                                    source={app.img.common_go}
                                    style={styles.goStyle} />
                            </View>
                        </View>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.setIsCityDistribute}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>是否同城配送</Text>
                            <View style={styles.itemPoint}>
                                <Text style={styles.itemRight}>{isCityDistribute ? '是' : '否'}</Text>
                                <Image
                                    source={app.img.common_go}
                                    style={styles.goStyle} />
                            </View>
                        </View>
                    </TouchableOpacity>
                    {
                        isCityDistribute ?
                            <TouchableOpacity
                                activeOpacity={0.6}
                                onPress={this.showCityDistributeEndPlace}>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>同城配送地址</Text>
                                    <View style={styles.itemPoint}>
                                        <Text style={[styles.itemRight, { paddingRight:5 }]}
                                            numberOfLines={1}
                                            ellipsizeMode='tail'>{endPoint}</Text>
                                        <Image
                                            source={app.img.common_go}
                                            style={styles.goStyle} />
                                    </View>
                                </View>
                            </TouchableOpacity>
                        :
                            <View>
                                <TouchableOpacity
                                    activeOpacity={0.6}
                                    onPress={this.showEndPlace}>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>到货地</Text>
                                        <View style={styles.itemPoint}>
                                            <Text style={[styles.itemRight, { paddingRight:5 }]}
                                                numberOfLines={1}
                                                ellipsizeMode='tail'>{endPoint}</Text>
                                            <Image
                                                source={app.img.common_go}
                                                style={styles.goStyle} />
                                        </View>
                                    </View>
                                </TouchableOpacity>
                                <TouchableOpacity onPress={this.setIsSendDoor}>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>送货上门</Text>
                                        <View style={styles.itemPoint}>
                                            <Text style={styles.itemRight}>{isSendDoor ? '是' : '否'}</Text>
                                            <Image
                                                source={app.img.common_go}
                                                style={styles.goStyle} />
                                        </View>
                                    </View>
                                </TouchableOpacity>
                                {
                                isSendDoor &&
                                <TouchableOpacity
                                    activeOpacity={0.6}
                                    onPress={this.showSendDoorEndPlace}>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>送货上门地址</Text>
                                        <View style={styles.itemPoint}>
                                            <Text style={[styles.itemRight, { paddingRight:5 }]}
                                                numberOfLines={1}
                                                ellipsizeMode='tail'>{sendDoorEndPoint}</Text>
                                            <Image
                                                source={app.img.common_go}
                                                style={styles.goStyle} />
                                        </View>
                                    </View>
                                </TouchableOpacity>
                            }
                            </View>
                    }

                    <View style={styles.itemUnitTop}>
                        <Text style={styles.itemLeft}>重量</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入货物重量'
                            onChangeText={(text) => this.setState({ weight: text })}
                            />
                        <Text style={styles.unit}>吨</Text>
                    </View>
                    <View style={styles.itemUnit}>
                        <Text style={styles.itemLeft}>方量</Text>
                        <TextInput style={styles.inputTextSymbol}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入货物方量'
                            onChangeText={(text) => this.setState({ volume: text })}
                            />
                        <Text style={styles.unit}>m³</Text>
                    </View>
                    <View style={styles.itemUnit}>
                        <Text style={styles.itemLeft}>件数</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入货物件数'
                            onChangeText={(text) => this.setState({ totalNumbers: text })}
                            />
                        <Text style={styles.unit}>件</Text>
                    </View>

                    <View style={styles.itemUnitTop}>
                        <Text style={styles.itemLeft}>代收货款</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='0'
                            onChangeText={(text) => this.setState({ proxyCharge : text })}
                            />
                        <Text style={styles.unit}>元</Text>
                    </View>
                    <View style={styles.itemUnit}>
                        <Text style={styles.itemLeft}>指定收款</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='0'
                            onChangeText={(text) => this.setState({ totalDesignatedFee : text })}
                            />
                        <Text style={styles.unit}>元</Text>
                    </View>
                    <TouchableOpacity onPress={this.setReachPay}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>是否到付</Text>
                            <View style={styles.itemPoint}>
                                <Text style={styles.itemRight}>{isReachPay ? '是' : '否'}</Text>
                                <Image
                                    source={app.img.common_go}
                                    style={styles.goStyle} />
                            </View>
                        </View>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.setIsInsuance}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>是否保价</Text>
                            <View style={styles.itemPoint}>
                                <Text style={styles.itemRight}>{isInsuance ? '是' : '否'}</Text>
                                <Image
                                    source={app.img.common_go}
                                    style={styles.goStyle} />
                            </View>
                        </View>
                    </TouchableOpacity>
                </ScrollView>
                <ActionSheet
                    visible={actionSheetVisible}
                    cancelText='取  消'
                    onCancel={this.doCloseActionSheet} >
                    <ActionSheet.Button onPress={this.takePicture}>拍    照</ActionSheet.Button>
                    <ActionSheet.Button onPress={this.selectPicture}>从相册选择</ActionSheet.Button>
                </ActionSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    topImage:{
        width:sr.w,
        height:65,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent: 'center',
    },
    topBigImage:{
        height:100,
        width:sr.w,
        padding:12,
        flexDirection:'row',
        alignItems:'center',
        justifyContent:'space-between',
        backgroundColor:'#FFFFFF',
    },
    photo:{
        height:23,
        width:25,
    },
    bigPicture:{
        height:80,
        width:120,
    },
    topImageText:{
        marginTop:10,
        fontSize:12,
        color:'#888888',
    },
    itemStart:{
        height:40,
        marginTop:8,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    item:{
        height:40,
        marginTop:1,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemLeft:{
        flex:1,
        paddingLeft:12,
        fontSize:14,
        color:'#666666',
    },
    itemRight:{
        paddingRight:12,
        fontSize:14,
        color:'#333333',
        width:sr.w / 3 * 2,
        textAlign:'right',
    },
    itemPoint:{
        flexDirection: 'row',
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 12,
    },
    inputText:{
        flex:1,
        height:40,
        fontSize:14,
        width:sr.w / 2,
        marginRight:10,
        textAlign:'right',
    },
    itemUnitTop:{
        marginTop:8,
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemUnit:{
        marginTop:1,
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    unit:{
        paddingRight:12,
        fontSize:14,
        color:'#888888',
    },
    inputTextSymbol:{
        flex:1,
        height:40,
        fontSize:14,
        width:sr.w / 2,
        marginRight:7,
        textAlign:'right',
    },
    protocal_icon: {
        height: 18,
        width: 18,
        backgroundColor:'#87d84f',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/LogisticsRanking.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const BaidumapSelectPosition = require('../../baidumap');

module.exports = React.createClass({
    statics: {
        title: '填单',
        rightButton: { title: '保存', handler: () => { app.scene.prePlaceOrder(); } },
    },
    prePlaceOrder () {

    },
    getInitialState () {
        return {
            set:0,
            position:'位置',
        };
    },
    toPrice () {
        this.setState({ set:1 });
    },
    toTime () {
        this.setState({ set:2 });
    },
    todistance () {
        this.setState({ set:3 });
    },
    toMap () {
        app.push({
            component: BaidumapSelectPosition,
            passProps:{
                confirm:(marker) => {
                    this.setState({ position:marker.title });
                },
            },
        });
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.topText}>物流排名</Text>
                    <TouchableOpacity onPress={this.toMap}>
                        <Text style={styles.topTextRight}>{this.state.position}</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.top}>
                    <TouchableOpacity onPress={this.toPrice}>
                        <Text style={this.state.set == 1 ? styles.redText : styles.itemText}>价格最低</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.toTime}>
                        <Text style={this.state.set == 2 ? styles.redText : styles.itemText}>时间最短</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.todistance}>
                        <Text style={this.state.set == 3 ? styles.redText : styles.itemText}>距离最短</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.info}>
                    <View style={styles.shop}>
                        <Text style={styles.shopInfo}>六面通物流公司 - 四面通物流大超市石板店</Text>
                        <Text style={styles.distance}>据我2km</Text>
                    </View>
                    <View style={styles.infoDetails}>
                        <View style={styles.unit}>
                            <Text style={styles.unitPriceNum}>¥20.00/吨</Text>
                            <Text style={styles.unitPrice}>运费单价</Text>
                        </View>
                        <View style={styles.unit}>
                            <Text style={styles.unitPriceNum}>¥150.00/吨</Text>
                            <Text style={styles.unitPrice}>送货上门</Text>
                        </View>
                        <View style={styles.unit}>
                            <Text style={styles.time}>2天</Text>
                            <Text style={styles.EstimateTime}>预计用时</Text>
                        </View>
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    containerTop:{
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    topText:{
        fontSize:16,
        marginTop:16,
        marginLeft:12,
        marginBottom:10,
        color:'#333333',
    },
    topTextRight:{
        marginRight:10,
        fontSize:16,
        marginTop:16,
        marginBottom:10,
        color:'#333333',
    },
    top:{
        height:35,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-around',
        alignItems:'center',
    },
    itemText:{
        fontSize:13,
        color:'#333333',
    },
    redText:{
        fontSize:13,
        color:'#f11821',
    },
    info:{
        marginTop:1,
        height:95,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
    },
    shop:{
        flexDirection: 'row',
    },
    shopInfo:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    distance:{
        fontSize:12,
        color:'#ff9517',
        marginTop:2,
        marginLeft:8,
    },
    infoDetails:{
        marginTop:10,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-around',
    },
    unit:{
        justifyContent:'center',
        alignItems:'center',
    },
    unitPriceNum:{
        fontSize:15,
        color:'#f11821',
        fontWeight:'500',
        marginBottom:3,
    },
    unitPrice:{
        fontSize:12,
        color:'#333333',
        marginTop:3,
    },
    time:{
        paddingTop:2,
        fontSize:15,
        color:'#333333',
        marginBottom:3,
    },
    EstimateTime:{
        fontSize:12,
        color:'#333333',
        marginTop:3,
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/LookPreOrder.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const BaidumapSelectPosition = require('../../baidumap');
const MarketSearchResult = require('./MarketSearchResult');
module.exports = React.createClass({
    statics: {
        title: '填单详情',
    },
    getInitialState () {
        return {
            mapInfo:{ location:[0, 0], region:'' },
        };
    },
    doSelectPosition () {
        app.push({
            component: BaidumapSelectPosition,
            passProps:{
                confirm:(marker) => {
                    this.setState({ mapInfo:{ region:marker.province + marker.city, location:[marker.longitude, marker.latitude] } });
                },
            },
        });
    },
    render () {
        const { mapInfo } = this.state;
        const { param } = this.props;
        const { name, startPoint, receiverName, receiverPhone, endPoint, weight, size, proxyCharge, totalDesignatedFee, isInsuance, isSendDoor, id, totalNumbers } = param;
        return (
            <View style={styles.container}>
                <View style={styles.startPoint}>
                    <Text style={styles.itemBottom}>始发地：{startPoint || ''}</Text>
                </View>
                <View style={styles.item}>
                    <View style={styles.itemTop}>
                        <Text style={styles.itemName}>收货人：{receiverName}</Text>
                        <Text style={styles.itemphone}>{receiverPhone}</Text>
                    </View>
                    <Text style={styles.itemBottom}>收货地：{endPoint}</Text>
                </View>
                <View style={styles.itemNumber}>
                    <Text style={styles.weight}>货物名称:{name}</Text>
                    <Text style={styles.weight}>重量：{weight}吨</Text>
                    <Text style={styles.size}>方量：{size}m³</Text>
                    <Text style={styles.number}>件数：{totalNumbers}件</Text>
                </View>
                <View style={styles.itemFee}>
                    <Text style={styles.generationFee}>代收货款：¥{ proxyCharge == '' ? 0 : proxyCharge }元</Text>
                    <Text style={styles.designatedFee}>指定收款：¥{ totalDesignatedFee == '' ? 0 : totalDesignatedFee }元</Text>
                    <Text style={styles.isInsuance}>是否保价：{isInsuance ? '是' : '否' }</Text>
                    <Text style={styles.isSendDoor}>送货上门：{isSendDoor ? '是' : '否' }</Text>
                </View>
                <View style={styles.logisticsRankContainer}>
                    <Text style={styles.logisticsRankTitle}>物流排名</Text>
                    <TouchableOpacity onPress={this.doSelectPosition}>
                        <Text style={styles.logisticsRankPosition}>{mapInfo.region ? mapInfo.region : '位置'}</Text>
                    </TouchableOpacity>
                </View>
                <MarketSearchResult mapInfo={mapInfo} orderInfo={{ orderId:id }} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    logisticsRankContainer:{
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    logisticsRankTitle:{
        fontSize:15,
        marginTop:10,
        marginLeft:12,
        marginBottom:10,
        color:'#333333',
    },
    logisticsRankPosition:{
        marginRight:10,
        fontSize:15,
        marginTop:10,
        marginBottom:10,
        color:'#333333',
    },
    startPoint:{
        height:25,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        borderBottomWidth:1,
        borderColor:'#F4F4F4',
    },
    item:{
        height:50,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        borderBottomWidth:1,
        borderColor:'#F4F4F4',
    },
    itemTop:{
        flexDirection: 'row',
        justifyContent: 'space-between',
        marginBottom:2,
    },
    itemName:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
    },
    itemphone:{
        marginRight:10,
        fontSize:12,
        color:'#333333',
    },
    itemBottom:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        marginTop:2,
    },
    itemNumber:{
        height:85,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
    },
    weight:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        marginBottom:2,
    },
    size:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        marginTop:2,
    },
    number:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        marginTop:2,
    },
    itemFee:{
        height:90,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        marginTop:1,
    },
    generationFee:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        marginBottom:2,
    },
    designatedFee:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        marginBottom:2,
        marginTop:2,
    },
    isInsuance:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        marginTop:5,
    },
    isSendDoor:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        marginTop:4,
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/LookPreOrderGroup.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const { SelectStartPointAddress } = COMPONENTS;
import { Geolocation } from '@remobile/react-native-baidu-map';

const BaidumapSelectPosition = require('../../baidumap');
const MarketSearchResultGroup = require('./MarketSearchResultGroup');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '预下单组详情',
        rightButton: () => app.scene.renderRightButton(),
    },
    getInitialState () {
        const { param } = this.props;
        return {
            mapInfo:{ location:[0, 0], region:'' },
            startInfo:{ startPoint:param.startPoint, startPointLastCode:param.startPointLastCode,id:param.shop ? param.shop.id : param.agent ? param.agent.id : '' } || {},
            type:false,
            groupName:param.name,
        };
    },
    componentDidMount () {
        Geolocation.getCurrentPosition()
            .then(data => {
                console.warn(JSON.stringify(data));
                this.setState({ mapInfo:{ region:data.province + data.city, location:[data.longitude, data.latitude] } });
            })
            .catch(e => {
                console.warn(e, 'error');
            });
    },
    renderRightButton () {
        const { type } = this.state;
        if (type) {
            return { title: '确认', handler: () => { this.doConfirm(); } };
        } else {
            return { title: '修改', handler: () => { this.doEdit(); } };
        }
    },
    doEdit () {
        const { type } = this.state;
        this.setState({ type:!type }, () => {
            app.getCurrentRoute().rightButton = { title: '确认', handler: () => { this.doConfirm(); } };
            app.forceUpdateNavbar();
        });
    },
    doConfirm () {
        const { type, startInfo, groupName } = this.state;
        const { param } = this.props;
        this.setState({ type:!type }, () => {
            app.getCurrentRoute().rightButton = { title: '修改', handler: () => { this.doEdit(); } };
            app.forceUpdateNavbar();
        });
        if (!startInfo.startPoint) {
            Toast('请选择发货地');
            return;
        }
        const params = {
            userId:app.personal.info.userId,
            orderGroupId:param.id,
            groupName,
            ...startInfo,
        };
        POST(app.route.ROUTE_MODIFY_PRE_ORDER_GROUP, params, this.doConfirmSuccess, false);
    },
    doConfirmSuccess (data) {
        if (data.success) {
            this.props.refresh();
        } else {
            Toast(data.msg);
        }
    },
    doSelectPosition () {
        app.push({
            component: BaidumapSelectPosition,
            passProps:{
                confirm:(marker) => {
                    this.setState({ mapInfo:{ region:marker.province + marker.city, location:[marker.longitude, marker.latitude] } });
                },
            },
        });
    },
    showStartPlace () {
        const { startInfo } = this.state;
        app.push({
            component: SelectStartPointAddress,
            passProps:{
                isNeedSelectAll:true,
                endPointLastCode:startInfo.startPointLastCode,
                id:startInfo.id || startInfo.shopId || startInfo.agentId,
                confirmAddress:(obj) => {
                    this.setState({ startInfo:obj });
                },
            },
        });
    },
    render () {
        const { mapInfo, type, groupName, startInfo } = this.state;
        const { param } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.item}>
                    {
                        type ?
                            <View>
                                <View style={styles.itemRow}>
                                    <Text style={styles.itemText}>群组名：</Text>
                                    <TextInput style={styles.modifyItemText}
                                        underlineColorAndroid='transparent'
                                        defaultValue={groupName}
                                        onChangeText={(text) => this.setState({ groupName: text })} />
                                </View>
                                <TouchableOpacity
                                    activeOpacity={0.6}
                                    onPress={this.showStartPlace}>
                                    <View style={styles.itemRow}>
                                        <Text style={styles.itemText}>发货地</Text>
                                        <View style={styles.itemPoint}>
                                            <Text style={styles.modifyItemText}
                                                numberOfLines={1}
                                                ellipsizeMode='tail'>{startInfo.startPoint || ''}</Text>
                                        </View>
                                    </View>
                                </TouchableOpacity>
                            </View> :
                            <View>
                                <Text style={styles.itemText}>群组名：{groupName}</Text>
                                <Text style={styles.itemText}>发货地：{startInfo.startPoint || ''}</Text>
                            </View>
                    }
                    <Text style={styles.itemText}>总尺寸：{param.totalSize}m³</Text>
                    <Text style={styles.itemText}>总重量：{param.totalWeight}吨</Text>
                    <Text style={styles.itemText}>总件数：{param.totalNumbers}件</Text>
                    <Text style={styles.itemText}>总单数：{param.orderCount}单</Text>
                </View>
                <View style={styles.logisticsRankContainer}>
                    <Text style={styles.logisticsRankTitle}>物流排名</Text>
                    <TouchableOpacity onPress={this.doSelectPosition}>
                        <Text style={styles.logisticsRankPosition}>{mapInfo.region ? mapInfo.region : '位置'}</Text>
                    </TouchableOpacity>
                </View>
                <MarketSearchResultGroup mapInfo={mapInfo} orderInfo={{ orderGroupId:param.id }} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    logisticsRankContainer:{
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    logisticsRankTitle:{
        fontSize:15,
        marginTop:10,
        marginLeft:10,
        marginBottom:10,
        color:'#333333',
    },
    logisticsRankPosition:{
        marginRight:10,
        fontSize:15,
        marginTop:10,
        marginBottom:10,
        color:'#333333',
    },
    item:{
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        borderBottomWidth:2,
        borderColor:'#F4F4F4',
        paddingBottom:10,
    },
    itemText:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        paddingTop:5,
        paddingBottom:5,
    },
    modifyItemText:{
        marginLeft:10,
        fontSize:12,
        color:'#333333',
        paddingTop:5,
        paddingBottom:5,
        flex:1,
    },
    itemRow:{
        flexDirection:'row',
        alignItems:'center',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/MarketSearchResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

import { Geolocation } from '@remobile/react-native-baidu-map';
const SupermarketSearchResult = require('./SupermarketSearchResult');
const ReceivePointSearchResult = require('./ReceivePointSearchResult');
module.exports = React.createClass({
    getInitialState () {
        return {
            tabIndex: 0,
            context:{},
            tabMenus:[],
            mapInfo:{},
        };
    },
    componentWillReceiveProps (nextProps) {
        this.setState({ mapInfo: nextProps.mapInfo });
    },
    componentWillMount () {
        Geolocation.getCurrentPosition()
        .then(data => {
            console.warn(JSON.stringify(data));
            this.setState({ mapInfo:{ region:data.province + data.city, location:[data.longitude, data.latitude] } }, () => { this.getRoadMaps(); });
        })
        .catch(e => {
            console.warn(e, 'error');
        });
    },
    getRoadMaps () {
        const { mapInfo } = this.state;
        const { orderInfo } = this.props;
        const param = {
            userId: app.personal.info.userId,
            orderBy: 0,
            pageNo:0,
            pageSize:10,
            ...mapInfo,
            ...orderInfo };
        POST(app.route.ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER, param, this.getRoadMapsSuccess, false);
    },
    getRoadMapsSuccess (data) {
        if (data.success) {
            this.setState({ tabMenus:(!data.context.agent || data.context.agent.roadmapList.length == 0) ? ['物流超市'] : ['物流超市', '揽收点'] });
            this.setState({ context:data.context });
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { tabIndex, tabMenus, context, mapInfo } = this.state;
        const { orderInfo } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.topTab}>
                    {
                        tabMenus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={() => {
                                    this.setState({ tabIndex:i });
                                }}
                                style={tabIndex != i ? styles.noTouchTab : styles.touchTab}>
                                <Text style={tabIndex != i ? styles.NoTouchText : styles.touchText}>
                                    {item}
                                </Text>
                            </TouchableHighlight>
                        ))
                    }
                </View>

                {
                    tabIndex === 0 ? <SupermarketSearchResult mapInfo={mapInfo} listName={'roadmapList'} orderInfo={orderInfo} data={context && context['shop']} /> : <ReceivePointSearchResult mapInfo={mapInfo} orderInfo={orderInfo} listName={'roadmapList'} data={context && context['agent']} />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        height: 30,
        width: 140,
        borderRadius:5,
        borderColor:'white',
        borderWidth:1,
        flexDirection: 'row',
        overflow: 'hidden',
    },
    topTab: {
        flexDirection:'row',
        height:30,
    },
    touchTab: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#c81622',
    },
    noTouchTab: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#E5E5E5',
    },
    NoTouchText: {
        color:'#c81622',
        fontWeight:'500',
    },
    touchText: {
        color:'#E5E5E5',
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/MarketSearchResultGroup.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

import { Geolocation } from '@remobile/react-native-baidu-map';
const SupermarketSearchResultGroup = require('./SupermarketSearchResultGroup');
const ReceivePointSearchResultGroup = require('./ReceivePointSearchResultGroup');
module.exports = React.createClass({
    getInitialState () {
        return {
            tabIndex: 0,
            context:{},
            tabMenus:[],
            mapInfo:{},
        };
    },
    componentWillReceiveProps (nextProps) {
        this.setState({ mapInfo: nextProps.mapInfo });
    },
    componentWillMount () {
        Geolocation.getCurrentPosition()
        .then(data => {
            console.warn(JSON.stringify(data));
            this.setState({ mapInfo:{ region:data.province + data.city, location:[data.longitude, data.latitude] } }, () => { this.getRoadMaps(); });
        })
        .catch(e => {
            console.warn(e, 'error');
        });
    },
    getRoadMaps () {
        const { mapInfo } = this.state;
        const { orderInfo } = this.props;
        const param = {
            userId: app.personal.info.userId,
            orderBy: 0,
            pageNo:0,
            pageSize:10,
            ...mapInfo,
            ...orderInfo };
        POST(app.route.ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER_GROUP, param, this.getRoadMapsSuccess, false);
    },
    getRoadMapsSuccess (data) {
        if (data.success) {
            this.setState({ tabMenus:(!data.context.agentList || data.context.agentList.length == 0) ? ['物流超市'] : ['物流超市', '揽收点'] });
            this.setState({ context:data.context });
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { tabIndex, tabMenus, context, mapInfo } = this.state;
        const { orderInfo } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.topTab}>
                    {
                        tabMenus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={() => {
                                    this.setState({ tabIndex:i });
                                }}
                                style={tabIndex != i ? styles.noTouchTab : styles.touchTab}>
                                <Text style={tabIndex != i ? styles.NoTouchText : styles.touchText}>
                                    {item}
                                </Text>
                            </TouchableHighlight>
                        ))
                    }
                </View>

                {
                    tabIndex === 0 ? <SupermarketSearchResultGroup mapInfo={mapInfo} listName={'shopList'} orderInfo={orderInfo} data={context && context['shopList']} /> : <ReceivePointSearchResultGroup mapInfo={mapInfo} orderInfo={orderInfo} listName={'agentList'} data={context && context['agentList']} />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        height: 30,
        width: 140,
        borderRadius:5,
        borderColor:'white',
        borderWidth:1,
        flexDirection: 'row',
        overflow: 'hidden',
    },
    topTab: {
        flexDirection:'row',
        height:30,
    },
    touchTab: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#c81622',
    },
    noTouchTab: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#E5E5E5',
    },
    NoTouchText: {
        color:'#c81622',
        fontWeight:'500',
    },
    touchText: {
        color:'#E5E5E5',
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/PreOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    ScrollView,
    TouchableOpacity,
} = ReactNative;
const { DImage, SelectRegionAddress, SelectStartPointAddress, SelectShortAddress, ActionSheet } = COMPONENTS;
const Camera = require('@remobile/react-native-camera');
const LookPreOrder = require('./LookPreOrder');

module.exports = React.createClass({
    statics: {
        title: '预下单详情',
        rightButton: { title: '修改', handler: () => { app.scene.doModify(); } },
        leftButton:{ handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        const { refresh } = this.props;
        !!refresh && refresh();
        app.navigator.popToTop();
    },
    getInitialState () {
        return {
            pageState:0, // 0,修改,1,保存
            ...this.props.info
        };
    },
    componentDidMount () {
        this.originData = this.state;
    },
    doModify () {
        app.getCurrentRoute().rightButton = { title: '保存', handler: () => { app.scene.doSave(); } };
        app.forceUpdateNavbar();
        this.setState({ pageState:1 });
    },
    doSave () {
        const { name, senderName, receiverPhone, weight, size, totalNumbers, photo, id, receiverName, endPoint, endPointLastCode, isSendDoor, isCityDistribute, proxyCharge,
            totalDesignatedFee, isInsuance, actionSheetVisible, isReachPay, startPoint, sendDoorEndPoint, sendDoorEndPointLastCode } = this.state;
        if (startPoint == '') {
            Toast('请选择始发地');
            return;
        }
        if (senderName == '') {
            Toast('发货人不能为空');
            return;
        }
        if (name == '') {
            Toast('货物名称不能为空');
            return;
        }
        if (receiverName == '') {
            Toast('收货人不能为空');
            return;
        }
        if (!app.utils.checkPhone(receiverPhone)) {
            Toast('请填写正确的收货人手机号码');
            return;
        }
        if (!isCityDistribute && endPoint == '') {
            Toast('请选择收货地');
            return;
        }
        if (!app.utils.checkNum(weight)) {
            Toast('请填写货物重量');
            return;
        }
        if (!app.utils.checkNum(size)) {
            Toast('请填写货物体积');
            return;
        }
        if (!app.utils.checkIntNum(totalNumbers)) {
            Toast('请填写货物件数');
            return;
        }
        if (isSendDoor && sendDoorEndPoint == '') {
            Toast('请选择送货上门地址');
            return;
        }
        if (isCityDistribute && endPoint == '') {
            Toast('请选择同城配送地址');
            return;
        }
        const param = {
            ...this.state,
            userId:app.personal.info.userId,
            orderId:id,
        };
        _.forIn(param, (v, k) => {
            if (_.isEqual(this.originData[k], v) && k != 'userId' && k != 'orderId') {
                delete param[k];
            }
        });
        POST(app.route.ROUTE_MODIFY_PRE_ORDER, param, this.doSaveSuccess, true);
    },
    doSaveSuccess (data) {
        if (data.success) {
            app.getCurrentRoute().rightButton = { title: '修改', handler: () => { app.scene.doModify(); } };
            app.forceUpdateNavbar();
            this.setState({ pageState:0 });
            this.props.updateList&&this.props.updateList(this.state);
        } else {
            Toast(data.msg);
        }
    },
    doSelectPhoto () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.setState({ photo: uri });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            sourceType:Camera.PictureSourceType.PHOTOLIBRARY,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    selectPicture () {
        this.doCloseActionSheet();
        const options = {
            quality: 30,
            targetWidth: 240,
            targetHeight: 240,
            allowEdit: true,
            destinationType: Camera.DestinationType.FILE_URI,
            sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
        };
        Camera.getPicture((filePath) => {
            this.uploadPhoto(filePath);
        }, () => {
            Toast('操作失败');
        }, options);
    },
    takePicture () {
        this.doCloseActionSheet();
        const options = {
            quality: 30,
            allowEdit: true,
            targetWidth: 240,
            targetHeight: 240,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        };
        Camera.getPicture((filePath) => {
            this.uploadPhoto(filePath);
        }, () => {
            Toast('操作失败');
        }, options);
    },
    uploadPhoto (filePath) {
        this.setState({ headImgSource: { uri: filePath } });
        const options = {};
        options.fileKey = 'file';
        options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
        options.mimeType = 'image/jpeg';
        options.params = {
            clientId:app.personal.info.userID,
        };
        this.uploadOn = true;
        UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress),
        this.uploadSuccessCallback, this.uploadErrorCallback, true);
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            const context = data.context;
            this.setState({ photo:context.url });
        } else {
            Toast('上传失败');
        }
        this.uploadOn = false;
    },
    uploadErrorCallback () {
        this.uploadOn = false;
        this.setState({ photo: app.personal.info.head });
    },
    doCloseActionSheet () {
        this.setState({ actionSheetVisible:false });
    },
    doShowActionSheet () {
        this.setState({ actionSheetVisible:true });
    },
    showStartPlace () {
        const { startPointLastCode, shopId, agentId } = this.state;
        app.push({
            component: SelectStartPointAddress,
            passProps:{
                isNeedSelectAll:true,
                endPointLastCode:startPointLastCode,
                id:shopId || agentId,
                confirmAddress:(obj) => {
                    this.setState({ ...obj });
                },
            },
        });
    },
    showEndPlace () {
        const { endPointLastCode } = this.state;
        app.push({
            component: SelectRegionAddress,
            title:'到货地',
            passProps:{
                endPointLastCode,
                confirmAddress:(endPoint, endPointLastCode) => {
                    if (endPointLastCode != this.state.endPointLastCode) {
                        this.setState({ sendDoorEndPointLastCode:0, sendDoorEndPoint:'', isSendDoor : false });
                    }
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    showCityDistributeEndPlace () {
        const { endPointLastCode, startPointLastCode } = this.state;
        if (!startPointLastCode) {
            Toast('同城配送需先选择始发地');
            return;
        }
        app.push({
            component: SelectShortAddress,
            title:'同城配送地址',
            passProps:{
                endPointLastCode:endPointLastCode,
                parentCode : startPointLastCode,
                confirmAddress:(endPoint, endPointLastCode) => {
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    showSendDoorEndPlace () {
        const { endPointLastCode, sendDoorEndPointLastCode } = this.state;
        if (!endPointLastCode) {
            Toast('请先选择到货地');
            return;
        }
        app.push({
            component: SelectShortAddress,
            title:'送货上门地址',
            passProps:{
                endPointLastCode:sendDoorEndPointLastCode,
                parentCode : endPointLastCode,
                confirmAddress:(sendDoorEndPoint, sendDoorEndPointLastCode) => {
                    this.setState({ sendDoorEndPoint, sendDoorEndPointLastCode });
                },
            },
        });
    },
    setIsInsuance () {
        this.setState({
            isInsuance: !this.state.isInsuance,
        });
    },
    setIsReachPay () {
        this.setState({
            isReachPay : !this.state.isReachPay,
        });
    },
    setIsSendDoor () {
        this.setState({
            isSendDoor: !this.state.isSendDoor,
        });
    },
    setIsCityDistribute () {
        this.setState({
            isCityDistribute: !this.state.isCityDistribute,
            endPoint:'',
            endPointLastCode:0
        });
    },
    render () {
        const {
            pageState,
            photo,
            startPoint,
            endPoint,
            receiverName,
            senderName,
            name,
            receiverPhone,
            totalNumbers,
            weight,
            size,
            isInsuance,
            isReachPay,
            isSendDoor,
            isCityDistribute,
            actionSheetVisible,
            proxyCharge,
            totalDesignatedFee,
            sendDoorEndPoint,
        } = this.state;
        return (
            <View style={styles.container}>
                {
                    pageState == 1 ?
                        <ScrollView>
                            { photo == '' ?
                                <TouchableOpacity
                                    onPress={this.doShowActionSheet}
                                    style={styles.topImage}>
                                    <DImage
                                        defaultSource={app.img.order_upload_picture}
                                        source={{ uri: photo }}
                                        style={styles.photo} />
                                    <Text style={styles.topImageText}>上传货物图片</Text>
                                </TouchableOpacity>
                            :
                                <TouchableOpacity
                                    onPress={this.doShowActionSheet}
                                    style={styles.topBigImage}>
                                    <Text style={{ color:'#666666' }}>货物图片</Text>
                                    <DImage
                                        source={{ uri: photo }}
                                        style={styles.bigPicture} />
                                </TouchableOpacity>
                            }
                            <View style={styles.itemStart}>
                                <Text style={styles.itemLeft}>发货人</Text>
                                <TextInput style={styles.inputText}
                                    underlineColorAndroid='transparent'
                                    placeholder='请输入发货人姓名'
                                    defaultValue={senderName}
                                    onChangeText={(text) => this.setState({ senderName: text })}
                                />
                            </View>
                            <View style={styles.item}>
                                <Text style={styles.itemLeft}>货物名称</Text>
                                <TextInput style={styles.inputText}
                                    underlineColorAndroid='transparent'
                                    placeholder='请输入货物名称'
                                    defaultValue={name}
                                    onChangeText={(text) => this.setState({ name: text })}
                                />
                            </View>
                            <View style={styles.item}>
                                <Text style={styles.itemLeft}>收货人</Text>
                                <TextInput style={styles.inputText}
                                    underlineColorAndroid='transparent'
                                    placeholder='请输入收货人姓名'
                                    defaultValue={receiverName}
                                    onChangeText={(text) => this.setState({ receiverName: text })}
                                />
                            </View>
                            <View style={styles.item}>
                                <Text style={styles.itemLeft}>收货人电话</Text>
                                <TextInput style={styles.inputText}
                                    underlineColorAndroid='transparent'
                                    keyboardType='numeric'
                                    placeholder='请输入收货人手机号码'
                                    defaultValue={receiverPhone}
                                    maxLength={11}
                                    onChangeText={(text) => this.setState({ receiverPhone: text })}
                                />
                            </View>
                            <TouchableOpacity
                                activeOpacity={0.6}
                                onPress={this.showStartPlace}>
                                <View style={styles.itemStart}>
                                    <Text style={styles.itemLeft}>始发地</Text>
                                    <View style={styles.itemTop}>
                                        <Text style={styles.itemRight}
                                            numberOfLines={1}
                                            ellipsizeMode='tail'>{startPoint || ''}</Text>
                                        <Image
                                            source={app.img.common_go}
                                            style={styles.goStyle} />
                                    </View>
                                </View>
                            </TouchableOpacity>
                            <TouchableOpacity onPress={this.setIsCityDistribute}>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>是否同城配送</Text>
                                    <View style={styles.itemTop}>
                                        <Text style={styles.itemRight}
                                            numberOfLines={1}
                                            ellipsizeMode='tail'>{isCityDistribute ? '是' : '否'}</Text>
                                        <Image
                                            source={app.img.common_go}
                                            style={styles.goStyle} />
                                    </View>
                                </View>
                            </TouchableOpacity>
                            {
                                isCityDistribute ?
                                    <TouchableOpacity
                                        activeOpacity={0.6}
                                        onPress={this.showCityDistributeEndPlace}>
                                        <View style={styles.item}>
                                            <Text style={styles.itemLeft}>同城配送地址</Text>
                                            <View style={styles.itemTop}>
                                                <Text style={[styles.itemRight, { paddingRight:5 }]}
                                                    numberOfLines={1}
                                                    ellipsizeMode='tail'>{endPoint}</Text>
                                                <Image
                                                    source={app.img.common_go}
                                                    style={styles.goStyle} />
                                            </View>
                                        </View>
                                    </TouchableOpacity>
                                :
                                <View>
                                    <TouchableOpacity
                                        activeOpacity={0.6}
                                        onPress={this.showEndPlace}>
                                        <View style={styles.item}>
                                            <Text style={styles.itemLeft}>到货地</Text>
                                            <View style={styles.itemTop}>
                                                <Text style={styles.itemRight}
                                                    numberOfLines={1}
                                                    ellipsizeMode='tail'>{endPoint}</Text>
                                                <Image
                                                    source={app.img.common_go}
                                                    style={styles.goStyle} />
                                            </View>
                                        </View>
                                    </TouchableOpacity>
                                    <TouchableOpacity onPress={this.setIsSendDoor}>
                                        <View style={styles.item}>
                                            <Text style={styles.itemLeft}>是否送货上门</Text>
                                            <View style={styles.itemTop}>
                                                <Text style={styles.itemRight}>{isSendDoor ? '是' : '否'}</Text>
                                                <Image
                                                    source={app.img.common_go}
                                                    style={styles.goStyle} />
                                            </View>
                                        </View>
                                    </TouchableOpacity>
                                    {
                                        isSendDoor &&
                                        <TouchableOpacity
                                            activeOpacity={0.6}
                                            onPress={this.showSendDoorEndPlace}>
                                            <View style={styles.item}>
                                                <Text style={styles.itemLeft}>送货上门地址</Text>
                                                <View style={styles.itemTop}>
                                                    <Text style={styles.itemRight}
                                                        numberOfLines={1}
                                                        ellipsizeMode='tail'>{sendDoorEndPoint}</Text>
                                                    <Image
                                                        source={app.img.common_go}
                                                        style={styles.goStyle} />
                                                </View>
                                            </View>
                                        </TouchableOpacity>
                                    }
                                </View>

                            }
                            <View style={styles.itemUnitTop}>
                                <Text style={styles.itemLeft}>重量</Text>
                                <TextInput style={styles.inputText}
                                    underlineColorAndroid='transparent'
                                    keyboardType='numeric'
                                    placeholder='请输入货物重量'
                                    defaultValue={weight + ''}
                                    onChangeText={(text) => this.setState({ weight: text })}
                                />
                                <Text style={styles.unit}>吨</Text>
                            </View>
                            <View style={styles.itemUnit}>
                                <Text style={styles.itemLeft}>方量</Text>
                                <TextInput style={styles.sizeInputText}
                                    underlineColorAndroid='transparent'
                                    keyboardType='numeric'
                                    placeholder='请输入货物方量'
                                    defaultValue={size + ''}
                                    onChangeText={(text) => this.setState({ size: text })}
                                />
                                <Text style={styles.unit}>m³</Text>
                            </View>
                            <View style={styles.itemUnit}>
                                <Text style={styles.itemLeft}>件数</Text>
                                <TextInput style={styles.inputText}
                                    underlineColorAndroid='transparent'
                                    keyboardType='numeric'
                                    placeholder='请输入货物件数'
                                    defaultValue={totalNumbers + ''}
                                    onChangeText={(text) => this.setState({ totalNumbers: text })}
                                />
                                <Text style={styles.unit}>件</Text>
                            </View>
                            <View style={styles.itemUnitTop}>
                                <Text style={styles.itemLeft}>代收货款</Text>
                                <TextInput style={styles.inputText}
                                    underlineColorAndroid='transparent'
                                    keyboardType='numeric'
                                    placeholder='0'
                                    defaultValue={proxyCharge + ''}
                                    onChangeText={(text) => this.setState({ proxyCharge : text })}
                                />
                                <Text style={styles.unit}>元</Text>
                            </View>
                            <View style={styles.itemUnit}>
                                <Text style={styles.itemLeft}>指定收款</Text>
                                <TextInput style={styles.inputText}
                                    underlineColorAndroid='transparent'
                                    keyboardType='numeric'
                                    placeholder='0'
                                    defaultValue={totalDesignatedFee + ''}
                                    onChangeText={(text) => this.setState({ totalDesignatedFee : text })}
                                />
                                <Text style={styles.unit}>元</Text>
                            </View>
                            <TouchableOpacity onPress={this.setIsInsuance}>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>是否保价</Text>
                                    <View style={styles.itemTop}>
                                        <Text style={styles.itemRight}>{isInsuance ? '是' : '否'}</Text>
                                        <Image
                                            source={app.img.common_go}
                                            style={styles.goStyle} />
                                    </View>
                                </View>
                            </TouchableOpacity>
                            <TouchableOpacity onPress={this.setIsReachPay}>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>是否到付</Text>
                                    <View style={styles.itemTop}>
                                        <Text style={styles.itemRight}>{isReachPay ? '是' : '否'}</Text>
                                        <Image
                                            source={app.img.common_go}
                                            style={styles.goStyle} />
                                    </View>
                                </View>
                            </TouchableOpacity>
                        </ScrollView> : <LookPreOrder param={this.state} />
                }
                <ActionSheet
                    visible={actionSheetVisible}
                    cancelText='取  消'
                    onCancel={this.doCloseActionSheet} >
                    <ActionSheet.Button onPress={this.takePicture}>拍    照</ActionSheet.Button>
                    <ActionSheet.Button onPress={this.selectPicture}>从相册选择</ActionSheet.Button>
                </ActionSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    topImage:{
        width:sr.w,
        height:65,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent: 'center',
    },
    topBigImage:{
        height:100,
        width:sr.w,
        padding:12,
        flexDirection:'row',
        alignItems:'center',
        justifyContent:'space-between',
        backgroundColor:'#FFFFFF',
    },
    photo:{
        height:23,
        width:25,
    },
    bigPicture:{
        height:80,
        width:120,
    },
    topImageText:{
        marginTop:10,
        fontSize:12,
        color:'#888888',
    },
    itemStart:{
        height:40,
        marginTop:8,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    item:{
        height:40,
        marginTop:1,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemTop:{
        flexDirection: 'row',
    },
    itemLeft:{
        flex:1,
        paddingLeft:12,
        fontSize:14,
        color:'#666666',
    },
    itemRight:{
        fontSize:14,
        color:'#333333',
        paddingRight:5,
        width:sr.w / 3 * 2,
        textAlign:'right',
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 12,
    },
    inputText:{
        flex:1,
        height:40,
        fontSize:14,
        width:sr.w / 2,
        marginRight:10,
        textAlign:'right',
    },
    sizeInputText:{
        flex:1,
        height:40,
        fontSize:14,
        width:sr.w / 2,
        marginRight:7,
        textAlign:'right',
    },
    itemUnitTop:{
        marginTop:8,
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemUnit:{
        marginTop:1,
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    unit:{
        paddingRight:12,
        fontSize:14,
        color:'#888888',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/PreOrderGroupList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;
const { PageList, Button, DImage } = COMPONENTS;
const PreOrderSelectList = require('./PreOrderSelectList');
const PreOrderListInGroup = require('./PreOrderListInGroup');
const LookPreOrderGroup = require('./LookPreOrderGroup');
const ConfirmMerge = require('../../common/ConfirmMerge');

module.exports = React.createClass({
    getInitialState () {
        return {
            list:[],
            isShowSelectAll:false,
        };
    },
    doSplitGroup (obj) {
        app.push({
            component:PreOrderListInGroup,
            passProps:{
                orderGroupId: obj.id,
                refresh: this.listView.refresh,
            },
        });
    },
    doLookDetail (obj) {
        app.push({
            component:LookPreOrderGroup,
            passProps:{
                param:obj,
                refresh: this.listView.refresh,
            },
        });
    },
    doChooseOne (obj, rowID) {
        const { list } = this.state;
        list[rowID].selected = !list[rowID].selected;
        this.setState({ list });
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({ list });
    },
    doMerge () {
        const { list } = this.state;
        const filterList = _.filter(list, o => o.selected);
        const orderGroupIdList = filterList.map(o => o.id);
        if (orderGroupIdList.length == 0) {
            Toast('请先勾选要合并的货单');
            return;
        }
        app.push({
            component:PreOrderSelectList,
            passProps:{
                doMergePreOrder: this.doMergePreOrder,
            },
        });
    },
    doMergePreOrder (orderIdList) {
        const { list } = this.state;
        const filterList = _.filter(list, o => o.selected);
        const orderGroupIdList = _.filter(filterList.map(o => o.id), undefined);
        if (!(orderGroupIdList.length <= 1 && orderIdList.length == 0)) {
            app.showModal(<ConfirmMerge doConfirm={(info) => {
                const param = {
                    userId: app.personal.info.userId,
                    orderGroupIdList,
                    orderIdList:orderIdList || [],
                    ...info,
                };
                POST(app.route.ROUTE_CREATE_PRE_ORDER_GROUP, param, this.doMergePreOrderSuccess, true);
            }} />);
        }
    },
    doMergePreOrderSuccess (data) {
        if (data.success) {
            const { list } = this.state;
            _.forEach(list, o => { o.selected = false; });
            this.setState({ list });
            this.listView.refresh();
            Toast('合并成功！');
        }
    },
    onGetList (data, pageNo) {
        if (!data.success || data.context.orderGroupList.length == 0 && pageNo == 0) {
            this.setState({ isShowSelectAll:false });
        } else {
            const { orderGroupList } = data.context;
            const list = _.uniqBy([...(_.map(orderGroupList, (v, k) => { return { id:v.id, selected:false }; })), ...this.state.list], 'id');
            this.setState({ isShowSelectAll:true, list });
        }
    },
    renderRow (obj, rowID) {
        const { list } = this.state;
        return (
            <View>
                <View style={styles.item}>
                    <TouchableOpacity style={styles.chooseView} onPress={this.doChooseOne.bind(null, obj, rowID)}>
                        <Image style={styles.chooseIcon} source={!list[rowID].selected ? app.img.order_no_choose : app.img.order_choose} />
                    </TouchableOpacity>
                    <TouchableOpacity style={styles.content} onPress={this.doLookDetail.bind(null, obj)}>
                        <DImage
                            resizeMode='stretch'
                            defaultSource={app.img.common_default}
                            source={{ uri:obj.photo }}
                            style={styles.image}
                            />
                        <View>
                            <View style={styles.itemRow}>
                                <Text style={styles.itemRowText}>名称：{obj.name}</Text>
                                <Text style={styles.itemRowText}>总单数:{obj.orderCount}</Text>
                            </View>
                            <View style={styles.itemRow}>
                                <Text style={styles.itemRowText}>总尺寸:{obj.totalSize}</Text>
                                <Text style={styles.itemRowText}>总重量:{obj.totalWeight}</Text>
                            </View>
                            <View style={styles.itemRow}>
                                <Text style={styles.totalNumbers}>总数量:{obj.totalNumbers}</Text>
                                <Text style={styles.startPoint}
                                    numberOfLines={1}>始发地：{(obj.startPoint || '') + (obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : '')}</Text>
                            </View>
                        </View>
                    </TouchableOpacity>
                </View>
                <View style={styles.rowButtomContainer}>
                    <Button onPress={this.doSplitGroup.bind(null, obj)} style={styles.btnSplitGroup} textStyle={styles.btnSplitGroupText}>{'查看货单'}</Button>
                </View>
            </View>
        );
    },
    render () {
        const { list, isShowSelectAll } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        return (
            <View style={styles.container}>
                <View style={styles.list}>
                    <PageList
                        style={styles.listStyle}
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        onGetList={this.onGetList}
                        listParam={{ userId: app.personal.info.userId }}
                        listName={'orderGroupList'}
                        listUrl={app.route.ROUTE_GET_PRE_ORDER_GROUP_LIST}
                        refreshEnable
                        />
                </View>
                {
                    isShowSelectAll &&
                    <View style={styles.bottom}>
                        <TouchableOpacity style={styles.chooseAll} onPress={this.doSelectedAll}>
                            <Image
                                resizeMode='cover'
                                style={styles.imgChoose}
                                source={status ? app.img.order_choose : app.img.order_no_choose} />
                            <Text style={styles.chooseAllFont}>全选</Text>
                        </TouchableOpacity>
                        <Button onPress={this.doMerge}
                            style={styles.btnMerge}
                            textStyle={styles.btnMergeFont}>合并</Button>
                    </View>
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    item:{
        height:70,
        flexDirection: 'row',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    content:{
        flexDirection: 'row',
        alignItems:'center',
    },
    chooseView :{
        height:70,
        width:30,
        justifyContent:'center',
        alignItems:'center',
    },
    chooseIcon:{
        height:12,
        width:12,
    },
    image:{
        height:50,
        width:50,
        marginRight:5,
    },
    itemRow:{
        width:sr.w - 90,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'space-between',
    },
    itemRowText:{
        fontSize:12,
        color:'#888888',
        marginTop:1,
        marginBottom:2,
    },
    totalNumbers:{
        fontSize:12,
        color:'#888888',
        marginTop:3,
        width:sr.w / 5,
    },
    startPoint:{
        fontSize:12,
        color:'#888888',
        marginTop:3,
        width:sr.w / 5 * 3,
    },
    bottom:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'space-between',
        backgroundColor:'#FFFFFF',
    },
    chooseAllFont:{
        fontSize:14,
        marginLeft:10,
    },
    chooseAll:{
        alignItems:'center',
        flexDirection:'row',
    },
    imgChoose:{
        marginLeft:10,
        width:12,
        height:12,
    },
    btnMerge:{
        width:60,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f21620',
        marginRight:15,
    },
    btnMergeFont:{
        color:'#f21620',
        fontSize:13,
        fontWeight:'400',
    },
    rowButtomContainer: {
        backgroundColor:'white',
        flexDirection: 'row',
        justifyContent: 'flex-end',
        paddingVertical:5,
    },
    btnSplitGroup: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#007ef7',
        borderWidth:1,
        marginLeft:20,
        marginRight:10,
        backgroundColor:'white',
    },
    btnSplitGroupText:{
        color:'#007ef7',
        fontSize:12,
        fontWeight:'300',
    },
    list:{
        width:sr.w,
        flex:1,
    },
    listStyle:{
        marginTop:10,
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/PreOrderList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

import Swipeout from 'react-native-swipeout';

const { PageList, Button, MessageBox, DImage } = COMPONENTS;
const AddPreOrder = require('./AddPreOrder');
const PreOrderDetail = require('./PreOrderDetail');
const ConfirmMerge = require('../../common/ConfirmMerge');

module.exports = React.createClass({
    getInitialState () {
        return {
            list:[],
            isShowSelectAll:false,
        };
    },
    doDetail (obj, sectionID) {
        app.push({
            component:PreOrderDetail,
            passProps:{
                info:obj,
                updateList: (data) => {
                    this.listView.updateList((list) => {
                        list[sectionID] = data;
                        return list;
                    });
                },
            },
        });
    },
    doConfirmDelete (obj) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_REMOVE_PRE_ORDER, param, this.doRemovePreOrderSuccess.bind(null, obj.id), true);
    },
    doRemovePreOrderSuccess (orderId, data) {
        if (data.success) {
            var list = this.listView.list;
            _.remove(list, function (o) {
                return o.id == orderId;
            });
            this.setState({ list });
            Toast('删除成功');
        } else {
            Toast(data.msg);
        }
    },
    showRemoveModel (obj) {
        app.showModal(
            <MessageBox onConfirm={this.doConfirmDelete.bind(null, obj)} content={'是否确定删除'} onCancel title={false} width={sr.s(250)} />
        );
    },
    doChooseOne (obj, rowID) {
        const { list } = this.state;
        list[rowID].selected = !list[rowID].selected;
        this.setState({ list });
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({ list });
    },
    doMergePreOrder () {
        const { list } = this.state;
        const filterList = _.filter(list, o => o.selected);
        const orderIdList = filterList.map(o => o.id);
        if (filterList.length == 0) {
            Toast('你还没选择需要合并的货单');
            return;
        }
        app.showModal(<ConfirmMerge doConfirm={(info) => {
            const param = {
                userId: app.personal.info.userId,
                orderIdList,
                ...info,
            };
            POST(app.route.ROUTE_CREATE_PRE_ORDER_GROUP, param, this.doMergePreOrderSuccess, true);
        }} />);
    },
    doMergePreOrderSuccess (data) {
        if (data.success) {
            const { list } = this.state;
            _.forEach(list, o => { o.selected = false; });
            this.setState({ list });
            this.listView.refresh();
            Toast('合并成功！');
        }
    },
    onGetList (data, pageNo) {
        if (!data.success || data.context.orderList.length == 0 && pageNo == 0) {
            this.setState({ isShowSelectAll:false });
        } else {
            const { orderList } = data.context;
            const list = _.uniqBy([...(_.map(orderList, (v, k) => { return { id:v.id, selected:false }; })), ...this.state.list], 'id');
            this.setState({ isShowSelectAll:true, list });
        }
    },
    AddPreOrder () {
        app.push({
            component:AddPreOrder,
            passProps:{
                refresh:this.refresh,
            },
        });
    },
    refresh () {
        this.listView.refresh();
    },
    renderRow (obj, rowID) {
        let { list } = this.state;
        return (
            <Swipeout right={[
                {
                    text: '删除',
                    backgroundColor: '#c81622',
                    onPress: this.showRemoveModel.bind(null, obj),
                },
            ]}
                autoClose>
                <View style={styles.item}>
                    <TouchableOpacity style={styles.chooseView} onPress={this.doChooseOne.bind(null, obj, rowID)}>
                        <Image style={styles.chooseIcon} source={!list[rowID].selected ? app.img.order_no_choose : app.img.order_choose} />
                    </TouchableOpacity>
                    <TouchableOpacity style={styles.content} onPress={this.doDetail.bind(null, obj, rowID)}>
                        <DImage
                            resizeMode='stretch'
                            defaultSource={app.img.common_default}
                            source={{ uri:obj.photo }}
                            style={styles.image}
                        />
                        <View style={styles.row}>
                            <View style={styles.itemTop}>
                                <Text style={styles.itemText}>始发地：{(obj.startPoint || '') + (obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : '')}</Text>
                            </View>
                            <Text style={styles.itemText}>
                            收货人：{obj.receiverName ? obj.receiverName : obj.receiverName == '' ? obj.receiverPhone : obj.receiverName}
                            </Text>
                            <Text style={styles.itemText}
                                numberOfLines={1}>到货地：{obj.endPoint}</Text>
                        </View>
                    </TouchableOpacity>
                </View>
            </Swipeout>

        );
    },
    render () {
        const { list, isShowSelectAll } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        return (
            <View style={styles.container}>
                <View style={styles.itemAddCar}>
                    <Button style={styles.btnAddPreOrder} textStyle={styles.btnAddPreOrderFont} onPress={this.AddPreOrder}>填单</Button>
                </View>
                <View style={styles.list}>
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        onGetList={this.onGetList}
                        listParam={{ userId: app.personal.info.userId }}
                        listName={'orderList'}
                        listUrl={app.route.ROUTE_GET_PRE_ORDER_LIST}
                        refreshEnable
                        />
                </View>
                {
                        isShowSelectAll &&
                        <View style={styles.bottom}>
                            <TouchableOpacity style={styles.chooseAll} onPress={this.doSelectedAll}>
                                <Image
                                    style={styles.imgChoose}
                                    source={status ? app.img.order_choose : app.img.order_no_choose} />
                                <Text style={styles.chooseAllFont}>全选</Text>
                            </TouchableOpacity>
                            <Button onPress={this.doMergePreOrder}
                                style={styles.btnMerge}
                                textStyle={styles.btnMergeFont}>合并</Button>
                        </View>
                    }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
    item:{
        height:70,
        flexDirection: 'row',
        alignItems:'center',
    },
    content:{
        flexDirection: 'row',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    contentFee: {
        flexDirection: 'row',
        flex:1,
        alignItems:'center',
        justifyContent:'flex-end',
    },
    chooseView :{
        height:70,
        width:30,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    chooseIcon:{
        height:12,
        width:12,
    },
    image:{
        height:50,
        width:50,
        marginRight:5,
    },
    itemTop:{
        flex:1,
        flexDirection: 'row',
    },
    itemText:{
        fontSize:12,
        color:'#888888',
        flex:1,
    },
    rightText:{
        fontSize:12,
        color:'#333333',
    },
    rightMoney:{
        fontSize:14,
        color:'red',
        marginRight:10,
    },
    bottom:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'space-between',
        backgroundColor:'#FFFFFF',
    },
    chooseAllFont:{
        fontSize:14,
        marginLeft:10,
    },
    chooseAll:{
        alignItems:'center',
        flexDirection:'row',
    },
    imgChoose:{
        width:12,
        height:12,
        marginLeft:10,
    },
    btnShipperFont:{
        color:'#f01725',
        fontSize:12,
    },
    btnMerge:{
        width:60,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f21620',
        marginRight:15,
    },
    btnMergeFont:{
        color:'#f21620',
        fontSize:13,
        fontWeight:'400',
    },
    point:{
        flex:1,
        flexDirection:'row',
    },
    btnAddPreOrder:{
        width:150,
        height:35,
        backgroundColor:'#FE9917',
        borderRadius: 4,
        alignSelf:'center',
        marginBottom:10,
    },
    btnAddPreOrderFont:{
        fontWeight:'500',
    },
    list:{
        width:sr.w,
        flex:1,
    },
    row:{
        flex:1,
        height:60,
        marginTop:10,
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/PreOrderListInGroup.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
    TouchableOpacity,
} = ReactNative;

import Swipeout from 'react-native-swipeout';

const { Button, MessageBox, DImage } = COMPONENTS;
const PreOrderDetail = require('./PreOrderDetail');

module.exports = React.createClass({
    statics: {
        title: '货单列表',
        leftButton: { handler: () => { app.scene.refresh(); } },
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            list:[],
            orderList:[],
        };
    },
    refresh () {
        this.props.refresh();
        app.pop();
    },
    doDetail (obj, sectionID) {
        app.push({
            component:PreOrderDetail,
            passProps:{
                info:obj,
            },
        });
    },
    componentWillMount () {
        const { orderGroupId } = this.props;
        this.getOrderListInGroup(orderGroupId);
    },
    getOrderListInGroup (orderGroupId) {
        const param = {
            userId: app.personal.info.userId,
            orderGroupId,
        };
        POST(app.route.ROUTE_GET_PRE_ORDER_LIST_IN_GROUP, param, this.getOrderListInGroupSuccess, true);
    },
    getOrderListInGroupSuccess (data) {
        if (data.success) {
            const { orderList } = data.context;
            const list = _.map(orderList, (v, k) => { return { id:v.id, selected:false }; });
            this.setState({ orderList, list });
        } else {
            Toast(data.msg);
        }
    },
    doConfirmDelete (obj) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_REMOVE_PRE_ORDER, param, this.doRemovePreOrderSuccess.bind(null, obj.id), true);
    },
    doRemovePreOrderSuccess (orderId, data) {
        if (data.success) {
            var orderList = this.state.orderList;
            _.remove(orderList, function (o) {
                return o.id == orderId;
            });
            this.setState({ orderList });
            Toast('删除成功');
        } else {
            Toast(data.msg);
        }
    },
    showRemoveModel (obj) {
        app.showModal(
            <MessageBox onConfirm={this.doConfirmDelete.bind(null, obj)} content={'是否确定删除'} onCancel title={false} width={sr.s(250)} />
        );
    },
    doChooseOne (obj, rowID) {
        const { list } = this.state;
        list[rowID].selected = !list[rowID].selected;
        this.setState({ list });
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({ list });
    },
    doSplitPreOrder (orderGroupId) {
        const { list } = this.state;
        const filterList = _.filter(list, o => o.selected);
        const orderIdList = filterList.map(o => o.id);
        if (orderIdList.length == 0) {
            Toast('请选择要拆分的货单');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            orderIdList,
            orderGroupId,
        };
        POST(app.route.ROUTE_REMOVE_PRE_ORDER_LIST_FROM_GROUP, param, this.doSplitPreOrderSuccess.bind(null, orderIdList), true);
    },
    doSplitPreOrderSuccess (orderIdList, data) {
        if (data.success) {
            var { orderList, list } = this.state;
            _.remove(orderList, obj => { return _.find(orderIdList, o => { return o == obj.id; }); });
            _.forEach(list, o => { o.selected = false; });
            this.setState({ list, orderList });
            Toast('拆分成功！');
        }
    },
    renderRow (obj, sectionID, rowID) {
        const { list } = this.state;
        return (
            <Swipeout right={[
                {
                    text: '删除',
                    backgroundColor: '#c81622',
                    onPress: this.showRemoveModel.bind(null, obj),
                },
            ]}
                autoClose>
                <View style={styles.item}>
                    <TouchableOpacity style={styles.chooseView} onPress={this.doChooseOne.bind(null, obj, rowID)}>
                        <Image style={styles.chooseIcon} source={!list[rowID].selected ? app.img.order_no_choose : app.img.order_choose} />
                    </TouchableOpacity>
                    <TouchableOpacity style={styles.content} onPress={this.doDetail.bind(null, obj, rowID)}>
                        <DImage
                            resizeMode='stretch'
                            defaultSource={app.img.common_default}
                            source={{ uri:obj.photo }}
                            style={styles.image}
                        />
                        <View style={{ flex:1 }}>
                            <View style={styles.itemTop}>
                                <Text style={styles.itemText}>始发地：{(obj.startPoint || '') + (obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : '')}</Text>
                                <View style={styles.contentFee}>
                                    <Text style={styles.rightText}>运费:</Text>
                                    <Text style={styles.rightMoney}>¥{obj.proxyCharge ? obj.proxyCharge : 0}</Text>
                                </View>
                            </View>
                            <Text style={styles.itemText}>
                            收货人：{obj.receiverName ? obj.receiverName : obj.receiverName == '' ? obj.receiverPhone : obj.receiverName}
                            </Text>
                            <Text style={styles.itemText}>地址：{obj.endPoint}</Text>
                        </View>
                    </TouchableOpacity>
                </View>
            </Swipeout>

        );
    },
    render () {
        const { list, orderList } = this.state;
        const { orderGroupId } = this.props;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        return (
            <View style={styles.container}>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(orderList)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
                <View style={styles.bottom}>
                    <TouchableOpacity style={styles.chooseAll} onPress={this.doSelectedAll}>
                        <Image
                            resizeMode='cover'
                            style={styles.imgChoose}
                            source={status ? app.img.order_choose : app.img.order_no_choose} />
                        <Text style={styles.chooseAllFont}>全选</Text>
                    </TouchableOpacity>
                    <Button onPress={this.doSplitPreOrder.bind(null, orderGroupId)}
                        style={styles.btnSplit}
                        textStyle={styles.btnSplitFont}>拆分</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
    item:{
        height:71,
        flexDirection: 'row',
        alignItems:'center',
    },
    content:{
        height:70,
        flex:1,
        flexDirection: 'row',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    contentFee: {
        flexDirection: 'row',
        justifyContent:'flex-end',
        flex:1,
        marginTop:-2,
    },
    chooseView :{
        height:70,
        width:30,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    chooseIcon:{
        height:12,
        width:12,
    },
    image:{
        height:50,
        width:50,
        marginRight:5,
    },
    itemTop:{
        flexDirection: 'row',
        alignItems:'flex-end',
        marginBottom:8,
    },
    itemText:{
        fontSize:12,
        color:'#888888',
        flex:2,
    },
    rightText:{
        fontSize:12,
        color:'#333333',
        marginTop:8,
    },
    rightMoney:{
        fontSize:14,
        color:'red',
        marginRight:10,
        marginTop:6,
    },
    bottom:{
        position:'absolute',
        bottom:0,
        height:50,
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'space-between',
        backgroundColor:'#FFFFFF',
    },
    chooseAllFont:{
        fontSize:14,
        marginLeft:10,
    },
    chooseAll:{
        alignItems:'center',
        flexDirection:'row',
    },
    imgChoose:{
        marginLeft:5,
        width:12,
        height:12,
    },
    imgLine:{
        marginLeft:10,
        width:35,
    },
    pointFont:{
        fontSize:14,
        marginLeft:10,
        width:100,
    },
    btnShipperFont:{
        color:'#f01725',
        fontSize:12,
    },
    btnSplit:{
        width:60,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f21620',
        marginRight:15,
    },
    btnSplitFont:{
        color:'#f21620',
        fontSize:13,
        fontWeight:'400',
    },
    point:{
        flex:1,
        flexDirection:'row',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/PreOrderSelectList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

import Swipeout from 'react-native-swipeout';

const { PageList, Button, MessageBox, DImage } = COMPONENTS;
const PreOrderDetail = require('./PreOrderDetail');

module.exports = React.createClass({
    statics: {
        title: '选择要合并货单',
        leftButton: { handler: () => { app.scene.doConcelSelectPreOrder(); } },
    },
    getInitialState () {
        return {
            list:[],
            isShowSelectAll:false,
        };
    },
    doDetail (obj, sectionID) {
        app.push({
            component:PreOrderDetail,
            passProps:{
                info:obj,
                updateList: (data) => {
                    this.listView.updateList((list) => {
                        list[sectionID] = data;
                        return list;
                    });
                },
            },
        });
    },
    doConfirmDelete (obj) {
        const param = {
            userId: app.personal.info.userId,
            orderId: obj.id,
        };
        POST(app.route.ROUTE_REMOVE_PRE_ORDER, param, this.doRemovePreOrderSuccess.bind(null, obj.id), true);
    },
    doRemovePreOrderSuccess (orderId, data) {
        if (data.success) {
            var list = this.listView.list;
            _.remove(list, function (o) {
                return o.id == orderId;
            });
            this.setState({ list });
            Toast('删除成功');
        } else {
            Toast(data.msg);
        }
    },
    showRemoveModel (obj) {
        app.showModal(
            <MessageBox onConfirm={this.doConfirmDelete.bind(null, obj)} content={'是否确定删除'} onCancel title={false} width={sr.s(250)} />
        );
    },
    doChooseOne (obj, rowID) {
        const { list } = this.state;
        list[rowID].selected = !list[rowID].selected;
        this.setState({ list });
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({ list });
    },
    doConfirmSelectPreOrder () {
        const { list } = this.state;
        const filterList = _.filter(list, o => o.selected);
        const orderIdList = filterList.map(o => o.id);
        this.doMergePreOrder(orderIdList);
    },
    doConcelSelectPreOrder () {
        this.doMergePreOrder([]);
    },
    doMergePreOrder (orderIdList) {
        this.props.doMergePreOrder(orderIdList);
        app.pop();
    },
    onGetList (data, pageNo) {
        if (!data.success || data.context.orderList.length == 0 && pageNo == 0) {
            this.setState({ isShowSelectAll:false });
        } else {
            const { orderList } = data.context;
            const list = _.uniqBy([...(_.map(orderList, (v, k) => { return { id:v.id, selected:false }; })), ...this.state.list], 'id');
            this.setState({ isShowSelectAll:true, list });
        }
    },
    renderRow (obj, rowID) {
        let { list } = this.state;
        return (
            <Swipeout right={[
                {
                    text: '删除',
                    backgroundColor: '#c81622',
                    onPress: this.showRemoveModel.bind(null, obj),
                },
            ]}
                autoClose>
                <View style={styles.item}>
                    <TouchableOpacity style={styles.chooseView} onPress={this.doChooseOne.bind(null, obj, rowID)}>
                        <Image style={styles.chooseIcon} source={!list[rowID].selected ? app.img.order_no_choose : app.img.order_choose} />
                    </TouchableOpacity>
                    <TouchableOpacity style={styles.content} onPress={this.doDetail.bind(null, obj, rowID)}>
                        <DImage
                            resizeMode='stretch'
                            defaultSource={app.img.common_default}
                            source={{ uri:obj.photo }}
                            style={styles.image}
                        />
                        <View>
                            <View style={styles.itemTop}>
                                <Text style={styles.itemText}
                                    numberOfLines={1}>始发地：{(obj.startPoint || '') + (obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : '')}</Text>
                                <View style={styles.contentFee}>
                                    <Text style={styles.rightText}>运费:</Text>
                                    <Text style={styles.rightMoney}>¥{obj.proxyCharge ? obj.proxyCharge : 0}</Text>
                                </View>
                            </View>
                            <Text style={styles.itemText}>
                            收货人：{obj.receiverName ? obj.receiverName : obj.receiverName == '' ? obj.receiverPhone : obj.receiverName}
                            </Text>
                            <Text style={styles.itemText}
                                numberOfLines={1}>地址：{obj.endPoint}</Text>
                        </View>
                    </TouchableOpacity>
                </View>
            </Swipeout>

        );
    },
    render () {
        const { list, isShowSelectAll } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    onGetList={this.onGetList}
                    listParam={{ userId: app.personal.info.userId }}
                    listName={'orderList'}
                    listUrl={app.route.ROUTE_GET_PRE_ORDER_LIST}
                    refreshEnable
                    />
                {
                        isShowSelectAll &&
                        <View style={styles.bottom}>
                            <TouchableOpacity style={styles.chooseAll} onPress={this.doSelectedAll}>
                                <Image
                                    resizeMode='cover'
                                    style={styles.imgChoose}
                                    source={status ? app.img.order_choose : app.img.order_no_choose} />
                                <Text style={styles.chooseAllFont}>全选</Text>
                            </TouchableOpacity>
                            <Button onPress={this.doConcelSelectPreOrder}
                                style={styles.btnMerge}
                                textStyle={styles.btnMergeFont}>取消</Button>
                            <Button onPress={this.doConfirmSelectPreOrder}
                                style={styles.btnMerge}
                                textStyle={styles.btnMergeFont}>确定</Button>
                        </View>
                    }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
    item:{
        height:70,
        flexDirection: 'row',
        alignItems:'center',
    },
    content:{
        height:70,
        flex:1,
        flexDirection: 'row',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    contentFee: {
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'flex-end',
    },
    chooseView :{
        height:70,
        width:30,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    chooseIcon:{
        height:12,
        width:12,
    },
    image:{
        height:50,
        width:50,
        marginRight:5,
    },
    itemTop:{
        flexDirection: 'row',
    },
    itemText:{
        fontSize:12,
        width:sr.w / 5 * 3,
        color:'#888888',
        marginTop:3,
    },
    rightText:{
        fontSize:12,
        color:'#333333',
    },
    rightMoney:{
        fontSize:14,
        color:'red',
        marginRight:10,
    },
    bottom:{
        position:'absolute',
        bottom:0,
        height:50,
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'flex-end',
        backgroundColor:'#FFFFFF',
    },
    chooseAllFont:{
        fontSize:14,
        marginLeft:10,
        marginRight:sr.w - 210,
    },
    chooseAll:{
        alignItems:'center',
        flexDirection:'row',
    },
    imgChoose:{
        marginLeft:5,
        width:12,
        height:12,
    },
    imgLine:{
        marginLeft:10,
        width:35,
    },
    pointFont:{
        fontSize:14,
        marginLeft:10,
        width:100,
    },
    btnShipperFont:{
        color:'#f01725',
        fontSize:12,
    },
    btnMerge:{
        width:60,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f21620',
        marginRight:15,
    },
    btnMergeFont:{
        color:'#f21620',
        fontSize:13,
        fontWeight:'400',
    },
    point:{
        flex:1,
        flexDirection:'row',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/ReceivePointSearchList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
let km = '';

module.exports = React.createClass({
    renderRow (obj, rowID) {
        if (obj.distance) {
            if (obj.distance > 1) {
                km = parseInt(obj.distance) + 'km';
            } else {
                km = parseInt((obj.distance) * 1000) + 'm';
            }
        }
        return (
            <View style={styles.row}>
                <View style={styles.rowChild}>
                    <View style={styles.address}>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.shipperName}</Text>
                        <Text >{'-'}</Text>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.endPoint}</Text>
                    </View>
                    <Text style={styles.rowChildDistance}>距我:{km}</Text>
                </View>
                <View style={styles.itemInfo}>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(parseInt(obj.price)) + '/吨'}</Text>
                        <Text style={styles.rowChildPrice}>运费单价</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(parseInt(obj.sendDoorPrice)) + '/吨'}</Text>
                        <Text style={styles.rowChildTitle}>送货上门</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(parseInt(obj.selfSignRate)) + '/%'}</Text>
                        <Text style={styles.rowChildTitle}>亲签率</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildTime}>{obj.duration}天</Text>
                        <Text style={styles.rowChildTitle}>预计用时</Text>
                    </View>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, mapInfo, orderInfo, listName, data } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        listParam={{ userId: app.personal.info.userId, orderBy: index, ...mapInfo, ...orderInfo }}
                        listName={listName}
                        list={data.roadmapList}
                        autoLoad={false}
                        listUrl={app.route.ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER}
                        refreshEnable
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    row: {
        flex:1,
        paddingVertical: 20,
        paddingHorizontal: 2,
    },
    rowChild:{
        width:sr.w,
        flexDirection:'row',
        marginTop:3,
        marginBottom:3,
    },
    rowChildFont:{
        fontSize:14,
        marginLeft:5,
        fontWeight:'300',
    },
    rowChildDistance:{
        fontSize:12,
        color:'#FF9D24',
        fontWeight:'300',
        marginRight:5,
        flex:0.5,
    },
    rowChildNumber:{
        color:'#f61525',
        fontSize:15,
        fontWeight:'500',
    },
    rowChildTime:{
        fontSize:16,
        color:'#333333',
    },
    rowChildTitle:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    rowChildPrice:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    address:{
        flexDirection:'row',
        flex:1.5,
    },
    itemInfo:{
        flexDirection:'row',
        flex:1,
        alignItems:'center',
        justifyContent:'center',
        marginTop:3,
    },
    item:{
        flex:1,
        alignItems:'center',
        justifyContent:'center',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/ReceivePointSearchListGroup.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
let km = '';

module.exports = React.createClass({
    renderRow (obj, rowID) {
        if (obj.distance) {
            if (obj.distance > 1) {
                km = parseInt(obj.distance) + 'km';
            } else {
                km = parseInt((obj.distance) * 1000) + 'm';
            }
        }
        return (
            <View style={styles.row}>
                <View style={styles.rowChild}>
                    <Text style={styles.shopName} numberOfLines={1}>{obj.name}</Text>
                    <View style={styles.price}>
                        <Text style={styles.rowChildFont} numberOfLines={1}>总运费:</Text>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{app.utils.N(parseInt(obj.totalTransportFee)) + '元'}</Text>
                    </View>
                    <Text style={styles.rowChildDistance}>距我:{km}</Text>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, mapInfo, orderInfo, listName, data } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        listParam={{ userId: app.personal.info.userId, orderBy: index, ...mapInfo, ...orderInfo }}
                        listName={listName}
                        list={data}
                        autoLoad={false}
                        listUrl={app.route.ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER_GROUP}
                        refreshEnable
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    row: {
        flex:1,
        paddingVertical: 20,
        paddingHorizontal: 2,
        backgroundColor:'#FFFFFF',
        marginTop:1,
    },
    rowChild:{
        width:sr.w,
        flexDirection:'row',
        marginTop:3,
        marginBottom:3,
    },
    shopName:{
        flex:2,
        fontSize:14,
        marginLeft:5,
        fontWeight:'300',
    },
    rowChildFont:{
        fontSize:13,
        marginLeft:5,
        color:'#c81622',
        fontWeight:'300',
    },
    rowChildDistance:{
        fontSize:12,
        color:'#FF9D24',
        fontWeight:'300',
        marginRight:15,
        textAlign:'right',
        flex:1,
    },
    price:{
        flexDirection:'row',
        flex:1,
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/ReceivePointSearchResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const ReceivePointSearchList = require('./ReceivePointSearchList');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['价格最低', '时间最短', '亲签率最高', '距离最短'];
        const { tabIndex } = this.state;
        const { mapInfo, orderInfo, listName, data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <ReceivePointSearchList key={i} index={i} tabIndex={tabIndex} mapInfo={mapInfo} orderInfo={orderInfo} listName={'agent.' + listName} data={data} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/ReceivePointSearchResultGroup.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const ReceivePointSearchListGroup = require('./ReceivePointSearchListGroup');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['价格最低', '距离最短'];
        const { tabIndex } = this.state;
        const { mapInfo, orderInfo, listName, data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <ReceivePointSearchListGroup key={i} index={i} tabIndex={tabIndex} mapInfo={mapInfo} orderInfo={orderInfo} listName={listName} data={data} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/SupermarketSearchList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
let km = '';

module.exports = React.createClass({
    renderRow (obj, rowID) {
        if (obj.distance) {
            if (obj.distance > 1) {
                km = parseInt(obj.distance) + 'km';
            } else {
                km = parseInt((obj.distance) * 1000) + 'm';
            }
        }
        return (
            <View style={styles.row}>
                <Text style={styles.rowChildCenter} numberOfLines={1}>{obj.shopName}</Text>
                <View style={styles.rowChild}>
                    <View style={styles.address}>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.shipperName}</Text>
                        <Text >{'-'}</Text>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.endPoint}</Text>
                    </View>
                    <Text style={styles.rowChildDistance}>距我:{km}</Text>
                </View>
                <View style={styles.itemInfo}>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(parseInt(obj.transportFee))}</Text>
                        <Text style={styles.rowChildPrice}>运费</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildTime}>{app.utils.N(parseInt(obj.selfSignRate)) + '%'}</Text>
                        <Text style={styles.rowChildTitle}>亲签率</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildTime}>{obj.duration}天</Text>
                        <Text style={styles.rowChildTitle}>预计用时</Text>
                    </View>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, mapInfo, orderInfo, listName, data } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        listParam={{ userId: app.personal.info.userId, orderBy: index, ...mapInfo, ...orderInfo }}
                        listName={listName}
                        list={data && data.roadmapList}
                        autoLoad={false}
                        listUrl={app.route.ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER}
                        refreshEnable
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    row: {
        flex:1,
        paddingVertical: 20,
        paddingHorizontal: 2,
        backgroundColor:'#FFFFFF',
        marginTop:1,
    },
    rowChild:{
        width:sr.w,
        flexDirection:'row',
        marginTop:3,
        marginBottom:3,
    },
    rowChildCenter:{
        fontSize:14,
        paddingBottom:5,
        fontWeight:'300',
        alignSelf:'center',
    },
    rowChildFont:{
        fontSize:14,
        marginLeft:5,
        fontWeight:'300',
    },
    rowChildDistance:{
        fontSize:12,
        color:'#FF9D24',
        fontWeight:'300',
        marginRight:5,
        flex:0.5,
    },
    rowChildNumber:{
        color:'#f61525',
        fontSize:15,
        fontWeight:'500',
    },
    rowChildTime:{
        fontSize:16,
        color:'#333333',
    },
    rowChildTitle:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    rowChildPrice:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    address:{
        flexDirection:'row',
        flex:1.5,
    },
    itemInfo:{
        flexDirection:'row',
        flex:1,
        alignItems:'center',
        justifyContent:'center',
        marginTop:3,
    },
    item:{
        flex:1,
        alignItems:'center',
        justifyContent:'center',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/SupermarketSearchListGroup.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
let km = '';

module.exports = React.createClass({
    renderRow (obj, rowID) {
        if (obj.distance) {
            if (obj.distance > 1) {
                km = parseInt(obj.distance) + 'km';
            } else {
                km = parseInt((obj.distance) * 1000) + 'm';
            }
        }
        return (
            <View style={styles.row}>
                <View style={styles.rowChild}>
                    <Text style={styles.shopName} numberOfLines={1}>{obj.name}</Text>
                    <View style={styles.price}>
                        <Text style={styles.rowChildFont} numberOfLines={1}>总运费:</Text>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{app.utils.N(parseInt(obj.totalTransportFee)) + '元'}</Text>
                    </View>
                    <Text style={styles.rowChildDistance}>距我:{km}</Text>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, mapInfo, orderInfo, listName, data } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        listParam={{ userId: app.personal.info.userId, orderBy: index, ...mapInfo, ...orderInfo }}
                        listName={listName}
                        list={data}
                        disable
                        autoLoad={false}
                        listUrl={app.route.ROUTE_GET_ROADMAP_LIST_WITH_PRE_ORDER_GROUP}
                        refreshEnable
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    row: {
        flex:1,
        paddingVertical: 20,
        paddingHorizontal: 2,
        backgroundColor:'#FFFFFF',
        marginTop:1,
    },
    rowChild:{
        width:sr.w,
        flexDirection:'row',
        marginTop:3,
        marginBottom:3,
    },
    shopName:{
        flex:2,
        fontSize:14,
        marginLeft:10,
        fontWeight:'300',
    },
    rowChildFont:{
        fontSize:13,
        marginLeft:5,
        color:'#c81622',
        fontWeight:'300',
    },
    rowChildDistance:{
        fontSize:12,
        color:'#FF9D24',
        fontWeight:'300',
        marginRight:15,
        flex:1,
        textAlign:'right',
    },
    price:{
        flexDirection:'row',
        flex:1,
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/SupermarketSearchResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const SupermarketSearchList = require('./SupermarketSearchList');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['价格最低', '时间最短', '亲签率最高', '距离最短'];
        const { tabIndex } = this.state;
        const { mapInfo, orderInfo, listName, data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <SupermarketSearchList key={i} index={i} tabIndex={tabIndex} mapInfo={mapInfo} orderInfo={orderInfo} listName={'shop.' + listName} data={data} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/SupermarketSearchResultGroup.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const SupermarketSearchListGroup = require('./SupermarketSearchListGroup');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['价格最低', '距离最短'];
        const { tabIndex } = this.state;
        const { mapInfo, orderInfo, listName, data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <SupermarketSearchListGroup key={i} index={i} tabIndex={tabIndex} mapInfo={mapInfo} orderInfo={orderInfo} listName={listName} data={data} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/normalUser/preOrder/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const PreOrderGroupList = require('./PreOrderGroupList');
const PreOrderList = require('./PreOrderList');
const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '预下货单',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    onWillFocus () {
        this.setTimeout(() => {
            app.getCurrentRoute().title = '我要发货';
            app.getCurrentRoute().rightButton = null;
            app.getCurrentRoute().leftButton = null;
            app.forceUpdateNavbar();
        }, 200);
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['单一货单', '货单组'];
        const { tabIndex } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    tabIndex == 0 ? <PreOrderList /> : <PreOrderGroupList />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/receivePoint/order/ReceiveOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, CustomSheet } = COMPONENTS;
const LogisticsDetail = require('../../common/LogisticsDetail');
const moment = require('moment');

module.exports = React.createClass({
    statics: {
        title: '货单详情',
    },
    getInitialState () {
        return {
            choose:false,
            receiving:false || this.props.receiving,
            data:{},
        };
    },
    componentWillMount () {
        this.getOrderDetail();
    },
    getOrderDetail () {
        const param = {
            userId: app.personal.info.userId,
            orderId: this.props.data.id,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess, true);
    },
    getOrderDetailSuccess (data) {
        if (data.success) {
            this.setState({ data:data.context });
        } else {
            Toast(data.msg);
        }
    },
    toLogisticsDetail () {
        const { data } = this.state;
        app.push({
            component:LogisticsDetail,
            passProps:{
                obj:data,
                type:'agent',
            },
        });
    },
    toPayMode (payMode) {
        if (payMode == 0) {
            return '现付';
        } else if (payMode == 1) {
            return '到付';
        } else {
            return '混合付款';
        }
    },
    doChoose () {
        this.setState({
            choose:!this.state.choose,
        });
    },
    render () {
        const { data } = this.state;
        const { stateList } = data;
        return (
            <View style={styles.container}>
                <View style={styles.containerReceive}>
                    <Text style={styles.textName}> 收货人：{!data.receiverName ? '暂无' : data.receiverName}</Text>
                    <Text style={styles.textName}> 收货人电话:{!data.receiverPhone ? '暂无' : data.receiverPhone}</Text>
                    <Text style={styles.textAddress}> 到货地：{data && data.endPoint} </Text>
                </View>
                <View style={styles.containerMarket}>
                    <View style={styles.containerMarketLeft}>
                        <Image style={styles.imageLogo}
                            source={app.img.order_logo}
                            resizeMode='stretch'
                            />
                        <Text style={styles.textMarket}>{data.shop ? data.shop.name : data.agent ? data.agent.name : ''}</Text>
                    </View>
                    <Text style={styles.textGetState}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.containerDetails}>
                    <Image style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.home_order}
                        source={{ uri:data.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.shop ? data.shop.address : data.agent ? data.agent.address : ''}</Text>
                                <Text>-></Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.endPoint}</Text>
                            </View>
                            <View style={styles.detailsTopRight}>
                                <Text style={styles.moneyLeft}>运费：</Text>
                                <Text style={styles.moneyRight}>¥{data.realFee}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>重量：{data.size}m³</Text>
                        <Text style={styles.textDetailsItem}>方量：{data.weight}吨</Text>
                        <Text style={styles.textDetailsItem}>件数：{data.totalNumbers}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.containerWhite} />
                <View style={styles.containerNumber}>
                    <Text style={styles.textNumber}>订单号：{data.id}</Text>
                    <Text style={styles.textDate}>创建时间：{data.createTime}</Text>
                </View>
                <View style={styles.containerInfo}>
                    <Text style={styles.textInfo}>运费：¥{data.realFee}</Text>
                    <Text style={styles.textInfo}>指定收款：¥{data.totalDesignatedFee}</Text>
                    <Text style={styles.textInfo}>代收货款：¥{data.proxyCharge}</Text>
                    <Text style={styles.textInfo}>
                        支付方式：{this.toPayMode(data.payMode)}
                    </Text>
                    <Text style={styles.textTotal}>需支付：¥{app.utils.N(data.totalDesignatedFee + data.proxyCharge)}</Text>
                </View>
                <TouchableOpacity onPress={this.toLogisticsDetail}>
                    <View style={styles.logInfo}>
                        <Text style={styles.textLogInfo}>物流信息</Text>
                        <View style={styles.logInfoRight}>
                            <Text style={styles.textLogInfoRight}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                            <Image
                                style={styles.imageCommon_go}
                                resizeMode='stretch'
                                source={app.img.common_go}
                                />
                        </View>
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    containerTop:{
        height:60,
        backgroundColor:'#c81622',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    imageTop:{
        height:32,
        width:27,
    },
    textTop:{
        fontSize:12,
        fontWeight:'900',
        marginLeft:20,
        color:'#ffffff',
    },
    containerReceive:{
        marginTop:8,
        paddingLeft:10,
        height:55,
        backgroundColor:'#ffffff',
        justifyContent: 'center',
    },
    textAddress:{
        fontSize:12,
        marginBottom:3,
        color:'#333333',
        flex:1,
    },
    textName:{
        fontSize:12,
        color:'#333333',
        flex:1,
    },
    containerMarket:{
        height:25,
        marginTop:8,
        backgroundColor:'#ffffff',
        alignItems: 'center',
        justifyContent: 'space-between',
        flexDirection: 'row',
    },
    containerMarketLeft:{
        flexDirection: 'row',
    },
    imageLogo:{
        height:13,
        width:16.5,
        marginLeft:10,
    },
    textMarket:{
        marginLeft:10,
        color:'#333333',
        fontSize:12,
    },
    textGetState:{
        color:'#00a117',
        marginRight:10,
        fontSize:12,
    },
    containerDetails:{
        height:105,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    containerWhite:{
        height:8,
        backgroundColor:'#ffffff',
    },
    imageGoods:{
        height:75,
        width:75,
        marginLeft:12,
        marginTop:15,
    },
    goodsDetails:{
        marginLeft:8,
        height:95,
        paddingBottom:8,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
        marginTop:15,
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
        marginTop:15,
    },
    detailsAddress:{
        fontSize:14,
        width:80,
        color:'#333333',
        flexDirection: 'row',

    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:12,
        color:'#888888',
    },
    containerNumber:{
        height:50,
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        justifyContent: 'center',
    },
    textNumber:{
        color:'#333333',
        marginBottom:3,
        fontSize:12,
    },
    textDate:{
        color:'#888888',
        marginTop:3,
        fontSize:12,
    },
    containerInfo:{
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        paddingBottom:5,
        paddingTop:5,
    },
    textInfo:{
        color:'#888888',
        fontSize:12,
        marginTop:5,
        height:15,
    },
    textTotal:{
        marginTop:5,
        fontSize:12,
        color:'#333333',
        fontWeight:'400',
        height:15,
    },
    logInfo:{
        height:40,
        backgroundColor:'#ffffff',
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLogInfo:{
        color:'#888888',
        fontSize:14,
        marginLeft:10,
    },
    logInfoRight:{
        marginRight:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    textLogInfoRight:{
        fontSize:14,
        color:'#333333',
        marginRight:5,
    },
    imageCommon_go:{
        width: 8,
        height: 15,
        marginRight: 7,
    },
    choose:{
        marginLeft:10,
        flexDirection: 'row',
        alignItems: 'center',
        flex:1,
    },
    imageChoose:{
        height:15,
        width:15,
    },
    btnReceive:{
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:4,
        marginTop:30,
    },
    btnReceiveText:{
        fontSize:16,
        fontWeight:'500',
    },
    isReachPay:{
        backgroundColor:'#f4f4f4',
        width:sr.w,
        height:45,
    },
});

```

* PDClient/project/App/modules/receivePoint/order/ReceviePointOrderList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

const { PageList, Button, MessageBox, DImage } = COMPONENTS;
const ReceiveOrderDetail = require('./ReceiveOrderDetail');
const LogisticsDetail = require('../../common/LogisticsDetail');
const PayPassword = require('../../common/PayPassword');
const PayInfo = require('../../common/PayInfo');

let money = 0;
let totalCount = 0;

module.exports = React.createClass({
    getInitialState () {
        return {
            paid: false,
            list:[],
            data: {},
            orderIdList: [],
            billList: [],
            orderBillList: [],
        };
    },
    getOrderDetail (obj, index) {
        app.push({
            component: ReceiveOrderDetail,
            passProps: {
                data: obj,
            },
        });
    },
    doLookTransport (obj) {
        app.push({
            component : LogisticsDetail,
            passProps:{
                obj,
            },
        });
    },
    doPrint (obj, rowId) {
        app.showModal(
            <MessageBox
                onConfirm={() => {
                    const param = {
                        userId: app.personal.info.userId,
                        orderIdList: [obj.id],
                    };
                    POST(app.route.ROUTE_PRINT_ORDER_LIST_BILL, param, this.doPrintSuccess, false);
                }}
                content={'确认打印收据'}
                width={sr.s(250)} />
        );
    },
    doPrintSuccess (data) {
        const { success, msg } = data;
        if (success) {
            this.listView.refresh();
            this.setState({
                orderBillList: [],
                billList: [],
            });
        } else {
            Toast(msg);
        }
    },
    doPay (obj, rowId) {
        app.showModal(
            <MessageBox
                onConfirm={() => {
                    const param = {
                        userId: app.personal.info.userId,
                        orderIdList: [obj.id],
                    };
                    POST(app.route.ROUTE_CONFIRM_CACH_PAYED_FOR_ORDER_LIST, param, this.doPaySuccess, false);
                }}
                content={'确认已现金收款'}
                width={sr.s(250)} />
        );
    },
    doPaySuccess (data) {
        const { success, msg } = data;
        if (success) {
            this.setState({
                orderIdList: [],
                list: [],
            });
            this.listView.refresh();
        } else {
            Toast(msg);
        }
    },
    renderSeparator (sectionID, rowId) {
        return (
            <View style={styles.separator} key={sectionID + rowId} />
        );
    },
    doChoose (obj, rowId) {
        const { list, orderIdList, billList, orderBillList } = this.state;
        const { type } = this.props;
        if (type == 'topay') {
            list[rowId].selected = !list[rowId].selected;
            if (_.findIndex(orderIdList, o => o == obj.id) == -1) {
                orderIdList.push(obj.id);
            } else {
                this.setState({ orderIdList: _.reject(orderIdList, o => o == obj.id) });
            }
            this.setState({
                list,
            });
            this.doTotalCalculation();
        } else {
            billList[rowId].selected = !billList[rowId].selected;
            if (_.findIndex(orderBillList, o => o == obj.id) == -1) {
                orderBillList.push(obj.id);
            } else {
                this.setState({ orderBillList: _.reject(orderBillList, o => o == obj.id) });
            }
            this.setState({
                billList,
            });
            this.doTotalCalculationBill();
        }
    },
    doSelectedBillOrderAll () {
        let { billList, orderBillList } = this.state;
        if (_.every(billList, o => o.selected == true)) {
            _.forEach(billList, o => { o.selected = false; });
            _.forEach(billList, o => {
                this.setState({ orderBillList: [] });
            });
        } else {
            _.forEach(billList, o => { o.selected = true; });
            _.forEach(billList, o => { orderBillList.push(o.item.id); });
            this.setState({
                orderBillList: _.uniq(orderBillList),
            });
        }
        this.setState({ billList });
        this.doTotalCalculationBill();
    },
    doPrintBillList () {
        const { orderBillList, billList } = this.state;
        if (orderBillList.length == 0) {
            Toast('请选择您要打印的货单');
            return;
        }
        if (!(_.find(billList, o => o.item.stateList[0].state == OS.OS_READY_PRINT_ORDER) || _.find(billList, o => o.item.stateList[0].state == OS.OS_READY_DEDUCT_AND_PRINT_ORDER))) {
            Toast('请选择待打印收据的订单');
            return;
        }
        app.showModal(
            <MessageBox
                onConfirm={() => { this.doPrintBill(); }}
                content={'确认打印收据' + totalCount + '单'}
                width={sr.s(250)} />
        );
    },
    doPrintBill () {
        const { orderBillList } = this.state;
        const param = {
            userId : app.personal.info.userId,
            orderIdList : orderBillList,
        };
        POST(app.route.ROUTE_PRINT_ORDER_LIST_BILL, param, this.doPrintBillSuccess, false);
    },
    doPrintBillSuccess (data) {
        if (data.success) {
            Toast('打印成功');
            this.listView.refresh();
            this.setState({ orderBillList : [], billList : [] });
            totalCount = 0;
        } else {
            Toast(data.msg);
        }
    },
    doTotalCalculationBill () {
        const { billList } = this.state;
        totalCount = _.filter(billList, (o) => o.selected == true).length;
    },
    doSelectedAll () {
        let { list, orderIdList } = this.state;
        if (_.every(list, o => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
            _.forEach(list, o => {
                this.setState({ orderIdList: [] });
            });
        } else {
            _.forEach(list, o => { o.selected = true; });
            _.forEach(list, o => { orderIdList.push(o.item.id); });
            this.setState({
                orderIdList: _.uniq(orderIdList),
            });
        }
        this.setState({ list });
        this.doTotalCalculation();
    },
    doTotalCalculation () {
        const { list } = this.state;
        money = 0;
        _.filter(list, (o) => o.selected == true).forEach((item, i) => {
            money = money + item.item.needPayInsuanceFee + item.item.needPayTransportFee;
        });
    },
    doPayOrderList () {
        const { orderIdList, list } = this.state;
        if (orderIdList.length == 0) {
            Toast('请选择您要支付的货单');
            return;
        }
        if (!(_.find(list, o => o.item.stateList[0].state == OS.OS_READY_PAYMENT))) {
            Toast('请选择待支付的订单');
            return;
        }
        app.showModal(
            <MessageBox
                onConfirm={() => { this.doConfirmPay(); }}
                content={'确认已现金收款'}
                width={sr.s(250)} />
        );
    },
    doConfirmPay () {
        const { orderIdList } = this.state;
        const param = {
            userId : app.personal.info.userId,
            orderIdList,
        };
        POST(app.route.ROUTE_CONFIRM_CACH_PAYED_FOR_ORDER_LIST, param, this.doConfirmPaySuccess, false);
    },
    doConfirmPaySuccess (data) {
        if (data.success) {
            Toast('支付成功');
            this.listView.refresh();
            this.setState({ orderIdList : [], list : [] });
            money = 0;
        } else {
            Toast(data.msg);
        }
    },
    renderRow (obj, rowId) {
        const { stateList } = obj;
        const { type } = this.props;
        const { paid, list, billList } = this.state;
        if (type == 'topay') {
            if (!_.find(list, (o) => o.index == rowId)) {
                list.push({ selected:false, index:rowId, item:obj });
            }
        }
        if (type == 'toprintbill') {
            if (!_.find(billList, (o) => o.index == rowId)) {
                billList.push({ selected:false, index:rowId, item:obj });
            }
        }
        return (
            <View style={styles.row}>
                <View style={styles.rowTopContainer}>
                    <DImage
                        resizeMode='stretch'
                        source={app.img.order_logo}
                        style={styles.topImage} />
                    <Text style={styles.topLeftText}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                    <Text style={styles.topRightText}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.middle}>
                    {
                        type == 'topay' &&
                        <TouchableOpacity onPress={this.doChoose.bind(null, obj, rowId)}
                            style={styles.btnChoose}>
                            <Image
                                resizeMode='stretch'
                                source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose}
                                style={styles.choose} />
                        </TouchableOpacity>
                    }
                    {
                        type == 'toprintbill' &&
                        <TouchableOpacity onPress={this.doChoose.bind(null, obj, rowId)}
                            style={styles.btnChoose}>
                            <Image
                                resizeMode='stretch'
                                source={!billList[rowId].selected ? app.img.order_no_choose : app.img.order_choose}
                                style={styles.choose} />
                        </TouchableOpacity>
                    }
                    <TouchableOpacity style={styles.rowMiddleContainer} onPress={this.getOrderDetail.bind(null, obj, rowId)}>
                        <DImage
                            resizeMode='stretch'
                            defaultSource={app.img.common_default}
                            source={{ uri: obj.photo }}
                            style={styles.middleImage} />
                        <View style={styles.middleRight}>
                            <View style={styles.pointContainer}>
                                <View style={styles.placeContainer}>
                                    <Text style={styles.pointName}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                    <Text style={styles.pointText}>→</Text>
                                    <Text style={styles.pointName}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{obj.endPoint}</Text>
                                </View>
                                <Text style={styles.transformFee}>{'运费：'}<Text style={styles.money}>￥{obj.needPayInsuanceFee + obj.needPayTransportFee}</Text></Text>
                            </View>
                            <Text style={styles.commonInfo}>重量：{obj.weight}吨</Text>
                            <Text style={styles.commonInfo}>方量：{obj.size}m³</Text>
                            <Text style={styles.commonInfo}>件数：{obj.totalNumbers}件</Text>
                            <Text style={styles.commonInfo}>下单时间：{obj.createTime}</Text>
                        </View>
                    </TouchableOpacity>
                </View>
                <View style={styles.rowButtomContainer}>
                    {
                        stateList[0].state == OS.OS_READY_PAYMENT ?
                            <Button
                                style={styles.lookTransport}
                                disable={paid}
                                onPress={this.doPay.bind(null, obj, rowId)}
                                textStyle={styles.btnTransportText}>
                                {!paid ? '支付' : '已支付'}
                            </Button>
                        :
                        (stateList[0].state == OS.OS_READY_PRINT_ORDER || stateList[0].state == OS.OS_READY_DEDUCT_AND_PRINT_ORDER) ?
                            <Button
                                onPress={this.doPrint.bind(null, obj)}
                                style={styles.lookTransport}
                                textStyle={styles.btnTransportText}>
                                {'打印收据'}
                            </Button>
                        :
                        stateList[0].state >= OS.OS_ON_THE_WAY ?
                            <Button
                                onPress={this.doLookTransport.bind(null, obj)}
                                style={styles.lookTransport}
                                textStyle={styles.btnTransportText}>
                                {'查看物流'}
                            </Button>
                        :
                            <View />
                    }
                    <Button onPress={this.getOrderDetail.bind(null, obj, rowId)} style={styles.lookDetail} textStyle={styles.btnDetallText}>{'查看详情'}</Button>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, type, data } = this.props;
        const { list, orderIdList, billList, orderBillList } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        const billStatus = billList.length != 0 && _.every(billList, (o) => o.selected == true);
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                <View style={styles.separator} />
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        renderSeparator={this.renderSeparator}
                        listParam={{ userId: app.personal.info.userId, type: type }}
                        listName={type + '.list'}
                        list={data.list}
                        listUrl={app.route.ROUTE_GET_ORDERS}
                        autoLoad={false}
                        refreshEnable
                        />
                }
                {
                    type == 'topay' &&
                    <View style={styles.selectedAllContainer}>
                        <View style={styles.totalLeft}>
                            <TouchableOpacity onPress={this.doSelectedAll}
                                style={styles.selectedAllBtn}>
                                <Image style={styles.chooseAll}
                                    source={status ? app.img.order_choose : app.img.order_no_choose} />
                                <Text style={styles.selectedAllText}>全选</Text>
                            </TouchableOpacity>
                            <Text style={styles.totalText}>总计</Text>
                            <Text style={styles.totalItemRight}>{money}元</Text>
                        </View>
                        <TouchableOpacity onPress={this.doPayOrderList}
                            style={styles.pay}>
                            <Text style={styles.payText}>现金支付</Text>
                        </TouchableOpacity>
                    </View>
                }
                {
                    type == 'toprintbill' &&
                    <View style={styles.selectedAllContainer}>
                        <View style={styles.totalLeft}>
                            <TouchableOpacity onPress={this.doSelectedBillOrderAll}
                                style={styles.selectedAllBtn}>
                                <Image style={styles.chooseAll}
                                    source={billStatus ? app.img.order_choose : app.img.order_no_choose} />
                                <Text style={styles.selectedAllText}>全选</Text>
                            </TouchableOpacity>
                            <Text style={styles.totalText}>总计</Text>
                            <Text style={styles.totalItemRight}>{totalCount}单</Text>
                        </View>
                        <TouchableOpacity onPress={this.doPrintBillList}
                            style={styles.pay}>
                            <Text style={styles.payText}>批量打印收据</Text>
                        </TouchableOpacity>
                    </View>
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    separator: {
        backgroundColor: '#f4f4f4',
        height: 8,
    },
    rowTopContainer: {
        paddingHorizontal:10,
        paddingVertical:5,
        backgroundColor:'white',
        flexDirection: 'row',
    },
    topImage: {
        width: 17,
        height:17,
    },
    topLeftText: {
        marginLeft:10,
        flex:1,
        fontSize: 14,
    },
    topRightText: {
        flex:1,
        fontSize: 14,
        textAlign:'right',
        color:'#f51b1a',
    },
    middle:{
        flexDirection:'row',
        height:100,
        alignItems:'center',
        width:sr.w,
        backgroundColor:'#f8f8f8',
    },
    rowMiddleContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:11,
        height:100,
    },
    btnChoose:{
        height:100,
        width:20,
        marginRight:3,
        justifyContent:'center',
        alignItems:'center',
    },
    choose:{
        height:12,
        width:12,
    },
    middleImage: {
        width: 80,
        height:80,
        borderRadius: 10,
    },
    middleRight: {
        paddingLeft: 10,
        width:sr.w - 105,
    },
    money: {
        fontSize: 12,
        color:'#f51b1a',
    },
    commonInfo: {
        fontSize: 13,
        color:'#888888',
    },
    pointName: {
        fontSize: 13,
        maxWidth: 60,
    },
    pointText:{
        marginLeft:5,
        marginRight:10,
    },
    transformFee: {
        fontSize: 12,
        color: 'gray',
        marginRight:10,
        textAlign:'right',
    },
    pointContainer: {
        flexDirection: 'row',
        marginBottom:4,
    },
    placeContainer: {
        flex:2,
        flexDirection: 'row',
    },
    rowButtomContainer: {
        backgroundColor:'white',
        flexDirection: 'row',
        justifyContent: 'flex-end',
        paddingVertical:5,
    },
    lookTransport: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#ff6200',
        borderWidth:1,
        backgroundColor:'white',
    },
    lookDetail: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#007ef7',
        borderWidth:1,
        marginLeft:20,
        marginRight:10,
        backgroundColor:'white',
    },
    btnTransportText:{
        color:'#ff6200',
        fontSize:12,
        fontWeight:'300',
    },
    btnDetallText:{
        color:'#007ef7',
        fontSize:12,
        fontWeight:'300',
    },
    totalLeft:{
        flex:7,
        flexDirection:'row',
        alignItems:'center',
    },
    selectedAllContainer:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
    },
    selectedAllBtn:{
        flexDirection:'row',
        alignItems:'center',
        height:40,
    },
    chooseAll:{
        height:12,
        width:12,
        marginLeft:5,
    },
    selectedAllText:{
        color:'#333333',
        fontSize:12,
        marginLeft:10,
    },
    totalText:{
        color:'#333333',
        fontSize:15,
        fontWeight:'500',
        marginLeft:20,
    },
    totalItem:{
        width:45,
        fontSize:12,
        color:'#f01823',
        textAlign:'right',
        marginLeft:5,
    },
    totalItemRight:{
        width:50,
        fontSize:12,
        color:'#f01823',
        textAlign:'right',
        marginRight:5,
    },
    pay:{
        flex:3,
        marginLeft:10,
        height:50,
        width:150,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor:'#c81622',
    },
    payText:{
        fontSize:14,
        fontWeight:'500',
        color:'#FFFFFF',
        letterSpacing:2,
    },
});

```

* PDClient/project/App/modules/receivePoint/order/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const ReceviePointOrderList = require('./ReceviePointOrderList');
const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '货单',
    },
    getInitialState () {
        return {
            tabIndex: 0,
            data : [],
        };
    },
    componentWillMount () {
        this.getOrders();
    },
    onWillFocus () {
        this.setTimeout(() => {
            app.getCurrentRoute().title = '货单';
            app.getCurrentRoute().rightButton = null;
            app.getCurrentRoute().leftButton = null;
            app.forceUpdateNavbar();
        }, 200);
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    getOrders () {
        const param = {
            userId : app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_ORDERS, param, this.getOrdersSuccess, false);
    },
    getOrdersSuccess (data) {
        if (data.success) {
            this.setState({ data : data.context });
        }
    },
    render () {
        const menus = [{ name:'待付款', type:'topay' }, { name:'待打印收据', type:'toprintbill' }, { name:'待发货', type:'tosend' }, { name:'运输中', type:'onway' }, { name:'已完成', type:'success' }];
        const { tabIndex, data } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item.name}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <ReceviePointOrderList key={i} index={i} type={item.type} tabIndex={tabIndex} data={data && data[item.type]} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/receivePoint/placeOrder/LogisticsRanking.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const BaidumapSelectPosition = require('../../baidumap');

module.exports = React.createClass({
    statics: {
        title: '填单',
        rightButton: { title: '保存', handler: () => { app.scene.prePlaceOrder(); } },
    },
    prePlaceOrder () {

    },
    getInitialState () {
        return {
            set:0,
            position:'位置',
        };
    },
    toPrice () {
        this.setState({ set:1 });
    },
    toTime () {
        this.setState({ set:2 });
    },
    todistance () {
        this.setState({ set:3 });
    },
    toMap () {
        app.push({
            component: BaidumapSelectPosition,
            passProps:{
                confirm:(marker) => {
                    this.setState({ position:marker.title });
                },
            },
        });
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.topText}>物流排名</Text>
                    <TouchableOpacity onPress={this.toMap}>
                        <Text style={styles.topTextRight}>{this.state.position}</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.top}>
                    <TouchableOpacity onPress={this.toPrice}>
                        <Text style={this.state.set == 1 ? styles.redText : styles.itemText}>价格最低</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.toTime}>
                        <Text style={this.state.set == 2 ? styles.redText : styles.itemText}>时间最短</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.todistance}>
                        <Text style={this.state.set == 3 ? styles.redText : styles.itemText}>距离最短</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.info}>
                    <View style={styles.shop}>
                        <Text style={styles.shopInfo}>六面通物流公司 - 四面通物流大超市石板店</Text>
                        <Text style={styles.distance}>据我2km</Text>
                    </View>
                    <View style={styles.infoDetails}>
                        <View style={styles.unit}>
                            <Text style={styles.unitPriceNum}>¥20.00/吨</Text>
                            <Text style={styles.unitPrice}>运费单价</Text>
                        </View>
                        <View style={styles.unit}>
                            <Text style={styles.unitPriceNum}>¥150.00/吨</Text>
                            <Text style={styles.unitPrice}>送货上门</Text>
                        </View>
                        <View style={styles.unit}>
                            <Text style={styles.time}>2天</Text>
                            <Text style={styles.EstimateTime}>预计用时</Text>
                        </View>
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    containerTop:{
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    topText:{
        fontSize:16,
        marginTop:16,
        marginLeft:12,
        marginBottom:10,
        color:'#333333',
    },
    topTextRight:{
        marginRight:10,
        fontSize:16,
        marginTop:16,
        marginBottom:10,
        color:'#333333',
    },
    top:{
        height:35,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-around',
        alignItems:'center',
    },
    itemText:{
        fontSize:13,
        color:'#333333',
    },
    redText:{
        fontSize:13,
        color:'#f11821',
    },
    info:{
        marginTop:1,
        height:95,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
    },
    shop:{
        flexDirection: 'row',
    },
    shopInfo:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    distance:{
        fontSize:12,
        color:'#ff9517',
        marginTop:2,
        marginLeft:8,
    },
    infoDetails:{
        marginTop:10,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-around',
    },
    unit:{
        justifyContent:'center',
        alignItems:'center',
    },
    unitPriceNum:{
        fontSize:15,
        color:'#f11821',
        fontWeight:'500',
        marginBottom:3,
    },
    unitPrice:{
        fontSize:12,
        color:'#333333',
        marginTop:3,
    },
    time:{
        paddingTop:2,
        fontSize:15,
        color:'#333333',
        marginBottom:3,
    },
    EstimateTime:{
        fontSize:12,
        color:'#333333',
        marginTop:3,
    },
});

```

* PDClient/project/App/modules/receivePoint/placeOrder/OrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const moment = require('moment');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '货单信息',
    },
    getInitialState () {
        const { data } = this.props;
        return {
            data,
        };
    },
    componentWillReceiveProps (nextProps) {
        this.setState({ data: nextProps.data });
    },
    render () {
        const { data } = this.state;
        const { showConfirmPayBox, doPrintReceipt, doPrintQrcode } = this.props;
        return (
            <View style={styles.container}>

                <View style={styles.containerDetails}>
                    <Image style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.home_order}
                        source={{ uri:data.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <Text style={styles.textDetailsItem}>重量：{data.size}m³</Text>
                        <Text style={styles.textDetailsItem}>方量：{data.weight}吨</Text>
                        <Text style={styles.textDetailsItem}>件数：{data.totalNumbers}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.containerWhite} />
                <View>
                    <Text style={styles.textTotal}>{'发货人 : ' + data.senderName}</Text>
                    <Text style={styles.textTotal}>{'发货人电话 : ' + data.senderPhone}</Text>
                    <Text style={styles.textTotal}>{'收货人 : ' + data.receiverName}</Text>
                    <Text style={styles.textTotal}>{'收货人电话 : ' + data.receiverPhone}</Text>
                    {
                        data.isCityDistribute?
                        <Text style={styles.textTotal}>{'同城配送地址 : ' + data.endPoint}</Text>
                        :
                        <View>
                            <Text style={styles.textTotal}>{'到货地 : ' + data.endPoint}</Text>
                            {
                                data.isSendDoor&& <Text style={styles.textTotal}>{'送货上门地址 : ' + data.sendDoorEndPoint}</Text>
                            }
                        </View>
                    }
                </View>
                <View style={styles.containerWhite} />
                <View style={styles.containerInfo}>
                    <Text style={styles.textInfo}>运费：¥{app.utils.N(data.needPayTransportFee) || 0}</Text>
                    <Text style={styles.textInfo}>指定收款：¥{app.utils.N(data.totalDesignatedFee) || 0}</Text>
                    <Text style={styles.textInfo}>代收货款：¥{app.utils.N(data.proxyCharge) || 0}</Text>
                    <Text style={styles.textInfo}>保险费：¥{app.utils.N(data.needPayInsuanceFee) || 0}</Text>
                    <Text style={styles.textTotal}>需支付：¥{app.utils.N(data.needPayTransportFee + data.needPayInsuanceFee) || 0}</Text>
                </View>
                {
                    data.state > OS.OS_READY_PRINT_BAR_CODE ? data.state == OS.OS_READY_PAYMENT ?
                        <Button onPress={showConfirmPayBox} style={styles.btnReceive} textStyle={styles.btnReceiveText}>
                        确认支付
                    </Button>
                    : <Button onPress={doPrintReceipt} style={styles.btnReceive} textStyle={styles.btnReceiveText}>
                        打印收据
                    </Button>
                    : <Button onPress={doPrintQrcode} style={styles.btnReceive} textStyle={styles.btnReceiveText}>
                        打印二维码
                    </Button>
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    containerTop:{
        height:60,
        backgroundColor:'#c81622',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    imageTop:{
        height:32,
        width:27,
    },
    textTop:{
        fontSize:12,
        fontWeight:'900',
        marginLeft:20,
        color:'#ffffff',
    },
    containerDetails:{
        height:105,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    containerWhite:{
        height:8,
        backgroundColor:'#ffffff',
    },
    imageGoods:{
        height:75,
        width:75,
        marginLeft:12,
        marginTop:15,
    },
    goodsDetails:{
        marginLeft:8,
        height:95,
        marginTop:3,
        justifyContent: 'center',
    },
    textDetailsItem:{
        marginTop:4,
        fontSize:12,
        color:'#888888',
    },
    containerInfo:{
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingBottom:5,
        paddingTop:5,
    },
    textInfo:{
        color:'#888888',
        fontSize:12,
        marginTop:5,
        height:15,
        marginLeft:10,
    },
    textTotal:{
        marginTop:5,
        fontSize:12,
        color:'#333333',
        fontWeight:'400',
        height:15,
        marginLeft:10,
    },
    logInfo:{
        height:40,
        backgroundColor:'#ffffff',
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLogInfo:{
        color:'#888888',
        fontSize:14,
        marginLeft:10,
    },
    logInfoRight:{
        marginRight:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    textLogInfoRight:{
        fontSize:14,
        color:'#333333',
        marginRight:5,
    },
    imageCommon_go:{
        width: 8,
        height: 15,
        marginRight: 7,
    },
    btnReceive:{
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:4,
        marginTop:30,
    },
    btnReceiveText:{
        fontSize:16,
        fontWeight:'500',
    },
    isReachPay:{
        backgroundColor:'#f4f4f4',
        width:sr.w,
        height:45,
    },
});

```

* PDClient/project/App/modules/receivePoint/placeOrder/PlaceOrder.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
    ScrollView,
} = ReactNative;

const { DImage, SelectRegionAddress, SelectShortAddress, ActionView, Button } = COMPONENTS;
const Camera = require('@remobile/react-native-camera');

module.exports = React.createClass({
    statics: {
        title: '填单',
    },
    doConfim () {
        const { sendDoorEndPointLastCode, sendDoorEndPoint, name, senderName, senderPhone, isInsuance, endPoint, receiverName, receiverPhone, weight, size, totalNumbers, photo, endPointLastCode, isSendDoor, isCityDistribute, proxyCharge, totalDesignatedFee } = this.state;
        if (photo == '') {
            Toast('请选择货物图片');
            return;
        }
        if (senderName == '') {
            Toast('发货人不能为空');
            return;
        }
        if (!app.utils.checkPhone(senderPhone)) {
            Toast('请填写正确的发货人手机号码');
            return;
        }
        if (name == '') {
            Toast('货物名称不能为空');
            return;
        }
        if (receiverName == '') {
            Toast('收货人不能为空');
            return;
        }
        if (!app.utils.checkPhone(receiverPhone)) {
            Toast('请填写正确的收货人手机号码');
            return;
        }
        if (!isCityDistribute && endPoint == '') {
            Toast('请选择收货地');
            return;
        }
        if (!app.utils.checkNum(weight)) {
            Toast('请填写货物重量');
            return;
        }
        if (!app.utils.checkNum(size)) {
            Toast('请填写货物体积');
            return;
        }
        if (!app.utils.checkIntNum(totalNumbers)) {
            Toast('请填写货物件数');
            return;
        }
        if (isCityDistribute && endPoint == '') {
            Toast('请选择同城配送地址');
            return;
        }
        if (isSendDoor && sendDoorEndPoint == '') {
            Toast('请选择送货上门地址');
            return;
        }
        this.props.confirm(this.state);
    },
    getInitialState () {
        const { info } = this.props;
        if (info) {
            return {
                senderName:info.senderName || '',
                senderPhone:info.senderPhone || '',
                photo:info.photo || '',
                receiverName:info.receiverName || '',
                receiverPhone:info.receiverPhone || '',
                endPoint: info.endPoint || '',
                endPointLastCode:info.endPointLastCode || '',
                sendDoorEndPoint:info.sendDoorEndPoint || '',
                sendDoorEndPointLastCode:info.sendDoorEndPointLastCode || '',
                weight:info.weight || '',
                name:info.name || '',
                size:info.size || '',
                totalNumbers:info.totalNumbers || '',
                proxyCharge:info.proxyCharge || '',
                totalDesignatedFee:info.totalDesignatedFee || '',
                isInsuance:info.isInsuance || false,
                isSendDoor: info.isSendDoor || false,
                isCityDistribute: info.isCityDistribute || false,
                isReachPay:info.isReachPay || false,
            };
        } else {
            return {
                senderName:'',
                senderPhone:'',
                photo:'',
                receiverName:'',
                receiverPhone:'',
                endPoint: '',
                endPointLastCode:'',
                sendDoorEndPoint:'',
                sendDoorEndPointLastCode:'',
                weight:'',
                name:'',
                size:'',
                totalNumbers:'',
                proxyCharge:0,
                totalDesignatedFee:0,
                isInsuance:false,
                isSendDoor:false,
                isCityDistribute:false,
                isReachPay:false,
            };
        }
    },
    setIsInsuance () {
        this.setState({
            isInsuance: !this.state.isInsuance,
        });
    },
    setIsCityDistribute () {
        this.setState({
            isCityDistribute: !this.state.isCityDistribute,
            endPoint:'',
            endPointLastCode:0,
            isSendDoor:false,
            sendDoorEndPoint:'',
            sendDoorEndPointLastCode:0
        });
    },
    setIsSendDoor () {
        this.setState({
            isSendDoor: !this.state.isSendDoor,
        });
    },
    toReachPay () {
        this.setState({
            isReachPay: !this.state.isReachPay,
        });
    },
    showEndPlace () {
        const { endPointLastCode } = this.state;
        app.push({
            component: SelectRegionAddress,
            title:'到货地',
            passProps:{
                endPointLastCode,
                type:4,
                confirmAddress:(endPoint, endPointLastCode) => {
                    if (endPointLastCode != this.state.endPointLastCode) {
                        this.setState({ sendDoorEndPointLastCode:0, sendDoorEndPoint:'', isSendDoor : false });
                    }
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    showCityDistributeEndPlace () {
        const { endPointLastCode } = this.state;
        app.push({
            component: SelectShortAddress,
            title:'同城配送地址',
            passProps:{
                endPointLastCode:endPointLastCode,
                parentCode : app.personal.info.agent.addressRegionLastCode,
                confirmAddress:(endPoint, endPointLastCode) => {
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    showSendDoorEndPlace () {
        const { endPointLastCode, sendDoorEndPointLastCode } = this.state;
        if (!endPointLastCode) {
            Toast('请先选择到货地');
            return;
        }
        app.push({
            component: SelectShortAddress,
            title:'送货上门地址',
            passProps:{
                endPointLastCode:sendDoorEndPointLastCode,
                parentCode : endPointLastCode,
                confirmAddress:(sendDoorEndPoint, sendDoorEndPointLastCode) => {
                    this.setState({ sendDoorEndPoint, sendDoorEndPointLastCode });
                },
            },
        });
    },
    doSelectPhoto () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.setState({ photo: uri });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            sourceType:Camera.PictureSourceType.PHOTOLIBRARY,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    selectPicture () {
        app.closeModal();
        const options = {
            quality: 30,
            targetWidth: 240,
            targetHeight: 240,
            allowEdit: true,
            destinationType: Camera.DestinationType.FILE_URI,
            sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
        };
        Camera.getPicture((filePath) => {
            this.uploadPhoto(filePath);
        }, () => {
            Toast('操作失败');
        }, options);
    },
    takePicture () {
        app.closeModal();
        const options = {
            quality: 30,
            allowEdit: true,
            targetWidth: 240,
            targetHeight: 240,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        };
        Camera.getPicture((filePath) => {
            this.uploadPhoto(filePath);
        }, () => {
            Toast('操作失败');
        }, options);
    },
    uploadPhoto (filePath) {
        this.setState({ headImgSource: { uri: filePath } });
        const options = {};
        options.fileKey = 'file';
        options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
        options.mimeType = 'image/jpeg';
        options.params = {
            clientId:app.personal.info.userID,
        };
        this.uploadOn = true;
        UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress),
        this.uploadSuccessCallback, this.uploadErrorCallback, true);
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            const context = data.context;
            this.setState({ photo:context.url });
        } else {
            Toast('上传失败');
        }
        this.uploadOn = false;
    },
    uploadErrorCallback () {
        this.uploadOn = false;
        this.setState({ photo: app.personal.info.head });
    },
    doShowActionSheet () {
        app.showModal(<ActionView
            cancelText='取  消'
            onCancel={app.closeModal} >
            <ActionView.Button onPress={this.takePicture}>拍    照</ActionView.Button>
            <ActionView.Button onPress={this.selectPicture}>从相册选择</ActionView.Button>
        </ActionView>);
    },
    render () {
        const {
            sendDoorEndPointLastCode,
            sendDoorEndPoint,
            name,
            senderName,
            senderPhone,
            isInsuance,
            endPoint,
            receiverName,
            receiverPhone,
            weight, size,
            totalNumbers,
            photo,
            endPointLastCode,
            isSendDoor,
            isCityDistribute,
            isReachPay,
            proxyCharge,
            totalDesignatedFee,
        } = this.state;
        return (
            <View style={styles.container}>
                <ScrollView>
                    { photo == '' ?
                        <TouchableOpacity
                            onPress={this.doShowActionSheet}
                            style={styles.topImage}>
                            <DImage
                                defaultSource={app.img.order_upload_picture}
                                source={{ uri: photo }}
                                style={styles.photo} />
                            <Text style={styles.topImageText}>上传货物图片</Text>
                        </TouchableOpacity>
                        :
                        <TouchableOpacity
                            onPress={this.doShowActionSheet}
                            style={styles.topBigImage}>
                            <Text style={{ color:'#666666' }}>货物图片</Text>
                            <DImage
                                source={{ uri: photo }}
                                style={styles.bigPicture} />
                        </TouchableOpacity>
                    }
                    <View style={styles.itemStart}>
                        <Text style={styles.itemLeft}>发货人</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            placeholder='请输入发货人姓名'
                            defaultValue={senderName}
                            onChangeText={(text) => this.setState({ senderName: text })}
                            />
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>发货人电话</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入发货人电话'
                            defaultValue={senderPhone}
                            maxLength={11}
                            onChangeText={(text) => this.setState({ senderPhone: text })}
                            />
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>货物名称</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            placeholder='请输入货物名称'
                            defaultValue={name}
                            onChangeText={(text) => this.setState({ name: text })}
                            />
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>收货人</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            placeholder='请输入收货人姓名'
                            defaultValue={receiverName}
                            onChangeText={(text) => this.setState({ receiverName: text })}
                            />
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.itemLeft}>收货人电话</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入收货人手机号码'
                            defaultValue={receiverPhone}
                            maxLength={11}
                            onChangeText={(text) => this.setState({ receiverPhone: text })}
                            />
                    </View>
                    <TouchableOpacity onPress={this.setIsCityDistribute}>
                        <View style={styles.itemStart}>
                            <Text style={styles.itemLeft}>是否同城配送</Text>
                            <View style={styles.itemPoint}>
                                <Text style={styles.itemRight}>{isCityDistribute ? '是' : '否'}</Text>
                                <Image
                                    source={app.img.common_go}
                                    style={styles.goStyle} />
                            </View>
                        </View>
                    </TouchableOpacity>
                    {
                        isCityDistribute ?
                            <TouchableOpacity
                                activeOpacity={0.6}
                                onPress={this.showCityDistributeEndPlace}>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>同城配送地址</Text>
                                    <View style={styles.itemPoint}>
                                        <Text style={[styles.itemRight, { paddingRight:5 }]}
                                            numberOfLines={1}
                                            ellipsizeMode='tail'>{endPoint}</Text>
                                        <Image
                                            source={app.img.common_go}
                                            style={styles.goStyle} />
                                    </View>
                                </View>
                            </TouchableOpacity>
                        :
                            <View>
                                <TouchableOpacity
                                    activeOpacity={0.6}
                                    onPress={this.showEndPlace}>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>到货地</Text>
                                        <View style={styles.itemPoint}>
                                            <Text style={[styles.itemRight, { paddingRight:5 }]}
                                                numberOfLines={1}
                                                ellipsizeMode='tail'>{endPoint}</Text>
                                            <Image
                                                source={app.img.common_go}
                                                style={styles.goStyle} />
                                        </View>
                                    </View>
                                </TouchableOpacity>
                                <TouchableOpacity onPress={this.setIsSendDoor}>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>送货上门</Text>
                                        <View style={styles.itemPoint}>
                                            <Text style={styles.itemRight}>{isSendDoor ? '是' : '否'}</Text>
                                            <Image
                                                source={app.img.common_go}
                                                style={styles.goStyle} />
                                        </View>
                                    </View>
                                </TouchableOpacity>
                                {
                                isSendDoor &&
                                <TouchableOpacity
                                    activeOpacity={0.6}
                                    onPress={this.showSendDoorEndPlace}>
                                    <View style={styles.item}>
                                        <Text style={styles.itemLeft}>送货上门地址</Text>
                                        <View style={styles.itemPoint}>
                                            <Text style={[styles.itemRight, { paddingRight:5 }]}
                                                numberOfLines={1}
                                                ellipsizeMode='tail'>{sendDoorEndPoint}</Text>
                                            <Image
                                                source={app.img.common_go}
                                                style={styles.goStyle} />
                                        </View>
                                    </View>
                                </TouchableOpacity>
                            }
                            </View>
                    }
                    <View style={styles.itemUnitTop}>
                        <Text style={styles.itemLeft}>重量</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入货物重量'
                            defaultValue={weight + ''}
                            onChangeText={(text) => this.setState({ weight: text })}
                            />
                        <Text style={styles.unit}>吨</Text>
                    </View>
                    <View style={styles.itemUnit}>
                        <Text style={styles.itemLeft}>方量</Text>
                        <TextInput style={styles.inputTextSymbol}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入货物方量'
                            defaultValue={size + ''}
                            onChangeText={(text) => this.setState({ size: text })}
                            />
                        <Text style={styles.unit}>m³</Text>
                    </View>
                    <View style={styles.itemUnit}>
                        <Text style={styles.itemLeft}>件数</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='请输入货物件数'
                            defaultValue={totalNumbers + ''}
                            onChangeText={(text) => this.setState({ totalNumbers: text })}
                            />
                        <Text style={styles.unit}>件</Text>
                    </View>

                    <View style={styles.itemUnitTop}>
                        <Text style={styles.itemLeft}>代收货款</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='0'
                            defaultValue={proxyCharge + ''}
                            onChangeText={(text) => this.setState({ proxyCharge : text })}
                            />
                        <Text style={styles.unit}>元</Text>
                    </View>
                    <View style={styles.itemUnit}>
                        <Text style={styles.itemLeft}>指定收款</Text>
                        <TextInput style={styles.inputText}
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            placeholder='0'
                            defaultValue={totalDesignatedFee + ''}
                            onChangeText={(text) => this.setState({ totalDesignatedFee : text })}
                            />
                        <Text style={styles.unit}>元</Text>
                    </View>
                    <TouchableOpacity onPress={this.toReachPay}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>是否到付</Text>
                            <View style={styles.itemPoint}>
                                <Text style={styles.itemRight}>{isReachPay ? '是' : '否'}</Text>
                                <Image
                                    source={app.img.common_go}
                                    style={styles.goStyle} />
                            </View>
                        </View>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.setIsInsuance}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>是否保价</Text>
                            <View style={styles.itemPoint}>
                                <Text style={styles.itemRight}>{isInsuance ? '是' : '否'}</Text>
                                <Image
                                    source={app.img.common_go}
                                    style={styles.goStyle} />
                            </View>
                        </View>
                    </TouchableOpacity>
                </ScrollView>
                <View style={styles.itemAddCar}>
                    <Button style={styles.btnAddPreOrder} textStyle={styles.btnAddPreOrderFont} onPress={this.doConfim}>确定</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    topImage:{
        width:sr.w,
        height:65,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent: 'center',
    },
    topBigImage:{
        height:100,
        width:sr.w,
        padding:12,
        flexDirection:'row',
        alignItems:'center',
        justifyContent:'space-between',
        backgroundColor:'#FFFFFF',
    },
    photo:{
        height:23,
        width:25,
    },
    bigPicture:{
        height:80,
        width:120,
    },
    topImageText:{
        marginTop:10,
        fontSize:12,
        color:'#888888',
    },
    itemStart:{
        height:40,
        marginTop:8,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    item:{
        height:40,
        marginTop:1,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemLeft:{
        flex:1,
        paddingLeft:12,
        fontSize:14,
        color:'#666666',
    },
    itemRight:{
        paddingRight:12,
        fontSize:14,
        color:'#333333',
        width:sr.w / 3 * 2,
        textAlign:'right',
    },
    itemPoint:{
        flexDirection: 'row',
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 12,
    },
    inputText:{
        flex:1,
        height:40,
        fontSize:14,
        width:sr.w / 2,
        marginRight:10,
        textAlign:'right',
    },
    itemUnitTop:{
        marginTop:8,
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemUnit:{
        marginTop:1,
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    unit:{
        paddingRight:12,
        fontSize:14,
        color:'#888888',
    },
    inputTextSymbol:{
        flex:1,
        height:40,
        fontSize:14,
        width:sr.w / 2,
        marginRight:7,
        textAlign:'right',
    },
    protocal_icon: {
        height: 18,
        width: 18,
        backgroundColor:'#87d84f',
    },
    btnAddPreOrder:{
        width:150,
        height:35,
        backgroundColor:'#FE9917',
        borderRadius: 4,
        alignSelf:'center',
        marginVertical:10,
    },
    btnAddPreOrderFont:{
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/receivePoint/placeOrder/PreOrderList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TextInput,
    Keyboard,
    TouchableOpacity,
} = ReactNative;

import Swipeout from 'react-native-swipeout';

const { PageList, Button, MessageBox, DImage } = COMPONENTS;

module.exports = React.createClass({
    getInitialState () {
        return {
            text:'',
            senderPhone:'',
            status:false,
        };
    },
    doStartSearch () {
        const { text } = this.state;
        this.setState({
            senderPhone: text,
            status : true,
        }, () => { this.listView.refresh(); Keyboard.dismiss(); });
    },
    doDetail (obj, sectionID) {
        this.props.onClickRow(obj);
    },
    renderRow (obj, rowID) {
        return (
            <View style={styles.item}>
                <TouchableOpacity style={styles.content} onPress={this.doDetail.bind(null, obj, rowID)}>
                    <DImage
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri:obj.photo }}
                        style={styles.image}
                    />
                    <View style={styles.row}>
                        <View style={styles.itemTop}>
                            <Text style={styles.itemText}>始发地：{(obj.startPoint || '') + (obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : '')}</Text>
                        </View>
                        <Text style={styles.itemText}>
                        收货人：{obj.receiverName ? obj.receiverName : obj.receiverName == '' ? obj.receiverPhone : obj.receiverName}
                        </Text>
                        <Text style={styles.itemText}
                            numberOfLines={1}>到货地：{obj.endPoint}</Text>
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        const { text, senderPhone, status } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.searchContainer}>
                    <Image
                        resizeMode='cover'
                        source={app.img.common_search_button}
                        style={styles.iconSearch} />
                    <TextInput
                        placeholder='输入发货人手机号'
                        defaultValue={text}
                        underlineColorAndroid='transparent'
                        onSubmitEditing={Keyboard.dismiss}
                        onChangeText={(text) => { this.setState({ text }); }}
                        style={styles.searchTextInput}
                        />
                    <Button onPress={this.doStartSearch} style={styles.searchBtnStyle} textStyle={styles.searchBtnTextStyle}>搜索</Button>
                </View>
                <View style={styles.list}>
                    {
                        status ? <PageList
                            ref={(ref) => { this.listView = ref; }}
                            renderRow={this.renderRow}
                            listParam={{ userId: app.personal.info.userId, senderPhone }}
                            listName={'orderList'}
                            autoLoad={false}
                            pageNo={-1}
                            listUrl={app.route.ROUTE_GET_PRE_ORDER_LIST_AGENT}
                            refreshEnable
                            /> : null
                    }

                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
        paddingTop:10,
    },
    searchContainer: {
        height: 30,
        width: sr.w - 120,
        marginLeft:60,
        marginBottom:20,
        paddingVertical: 2,
        borderRadius: 14,
        backgroundColor: '#FFFFFF',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        padding:0,
        height: 25,
        width: sr.w - 200,
        fontSize: 14,
        marginLeft: 5,
    },
    iconSearch: {
        height: 15,
        width: 15,
        marginLeft:5,
    },
    searchBtnStyle: {
        width:60,
        height:30,
        borderRadius:0,
        backgroundColor:'#F4F4F4',
    },
    searchBtnTextStyle: {
        color:'black',
        fontSize:15,
    },
    item:{
        height:70,
        marginLeft:10,
        flexDirection: 'row',
        alignItems:'center',
    },
    content:{
        flexDirection: 'row',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    image:{
        height:50,
        width:50,
        marginRight:5,
    },
    itemTop:{
        flex:1,
        flexDirection: 'row',
    },
    itemText:{
        fontSize:12,
        color:'#888888',
        flex:1,
    },
    list:{
        width:sr.w,
        flex:1,
    },
    row:{
        flex:1,
        height:60,
        marginTop:10,
    },
});

```

* PDClient/project/App/modules/receivePoint/placeOrder/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    ScrollView,
    RefreshControl,
    Text,
    TouchableHighlight,
} = ReactNative;

const { MessageBox } = COMPONENTS;
const PreOrderList = require('./PreOrderList');
const PlaceOrder = require('./PlaceOrder');
const OrderDetail = require('./OrderDetail');
const TimerMixin = require('react-timer-mixin');

const SHOW_PLACE_VIEW = 0;
const SHOW_ORDER_DETAIL = 1;
module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '填单',
    },
    getInitialState () {
        return {
            tabIndex: 0,
            showType:SHOW_PLACE_VIEW, // 0显示PlaceOrder和PreOrderList,1显示OrderDetail
            data:{},
            isModify:false, // 是修改货单还是下单
            isUpdateView:true, // 是否在onWillFocus中调用getLastestOrder
        };
    },
    setPlaceTitle () {
        app.getCurrentRoute().title = '填单';
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = null;
        app.forceUpdateNavbar();
    },
    setModifyTitle () {
        app.getCurrentRoute().title = '货单信息';
        app.getCurrentRoute().rightButton = { title: '修改', handler: () => { this.modify(); } };
        app.forceUpdateNavbar();
    },
    setContinueTitle () {
        app.getCurrentRoute().title = '货单信息';
        app.getCurrentRoute().rightButton = { title: '继续下单', handler: () => { this.continuePlaceOrder(); } };
        app.forceUpdateNavbar();
    },
    getLastestOrder () {
        const param = {
            userId:app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_LASTEST_ORDER, param, this.getLastestOrderSuccess, false);
    },
    getLastestOrderSuccess (data) {
        this.setState({ isUpdateView:true });
        if (data.success) {
            if (data.context.state == OS.OS_READY_PAYMENT || data.context.state == OS.OS_READY_PRINT_BAR_CODE) {
                this.setState({ data:data.context, showType:SHOW_ORDER_DETAIL }, this.setModifyTitle);
            } else {
                this.setState({ data:data.context, showType:SHOW_ORDER_DETAIL }, this.setContinueTitle);
            }
        } else {
            this.setState({ showType:SHOW_PLACE_VIEW, tabIndex:0, data:{} }, this.setPlaceTitle);
        }
    },
    confirm (data) {
        const { isModify } = this.state;
        this.setState({ isUpdateView:true });
        isModify ? this.modifyOrder(data) : this.placeOrder(data);
    },
    placeOrder (data) {
        const { sendDoorEndPointLastCode, isReachPay, sendDoorEndPoint, name, senderName, senderPhone, isInsuance, endPoint, receiverName, receiverPhone, weight, size, totalNumbers, photo, isCityDistribute, endPointLastCode, isSendDoor, proxyCharge, totalDesignatedFee } = data;
        const param = {
            userId: app.personal.info.userId,
            photo,
            senderName,
            receiverPhone,
            receiverName,
            isCityDistribute,
            endPoint,
            endPointLastCode,
            sendDoorEndPoint,
            sendDoorEndPointLastCode,
            weight,
            size,
            totalNumbers,
            isSendDoor,
            proxyCharge,
            isInsuance,
            totalDesignatedFee,
            isReachPay,
            senderPhone,
            name,
        };
        POST(app.route.ROUTE_PLACE_ORDER_AGENT, param, this.placeOrderSuccess, true);
    },
    placeOrderSuccess (data) {
        if (data.success) {
            Toast('填单成功');
            this.setState({ showType:SHOW_ORDER_DETAIL, data:data.context }, this.setModifyTitle);
        } else {
            Toast(data.msg);
            this.setState({ showType:SHOW_PLACE_VIEW });
        }
    },
    modifyOrder (data) {
        const { sendDoorEndPointLastCode, isReachPay, sendDoorEndPoint, name, senderName, senderPhone, isInsuance, isCityDistribute, endPoint, receiverName, receiverPhone, weight, size, totalNumbers, photo, endPointLastCode, isSendDoor, proxyCharge, totalDesignatedFee } = data;
        const param = {
            userId: app.personal.info.userId,
            orderId:this.state.data.id,
            isCityDistribute,
            photo,
            senderName,
            receiverPhone,
            receiverName,
            endPoint,
            endPointLastCode,
            sendDoorEndPoint,
            sendDoorEndPointLastCode,
            weight,
            size,
            totalNumbers,
            isSendDoor,
            proxyCharge,
            isInsuance,
            totalDesignatedFee,
            isReachPay,
            senderPhone,
            name,
        };
        _.forIn(param, (v, k) => {
            if (_.isEqual(this.state.data[k], v) && k != 'userId' && k != 'orderId') {
                delete param[k];
            }
        });
        POST(app.route.ROUTE_MODIFY_ORDER_AGENT, param, this.placeOrderSuccess, true);
    },
    modify () {
        this.setState({ showType:SHOW_PLACE_VIEW, tabIndex:0, isModify:true, isUpdateView:false }, this.setPlaceTitle);
    },
    continuePlaceOrder () {
        this.setState({ tabIndex:0, showType:SHOW_PLACE_VIEW, isModify:false, isUpdateView:false, data:{} }, this.setPlaceTitle);
    },
    doPrintReceipt () {
        const { data } = this.state;
        const param = {
            userId: app.personal.info.userId,
            orderId: data.id,
        };
        POST(app.route.ROUTE_PRINT_ORDER_BILL, param, this.doPrintReceiptSuccess, true);
    },
    showConfirmPayBox () {
        app.showModal(
            <MessageBox
                onConfirm={() => { this.confirmCachPay(); }}
                content={'确认已现金收款'}
                width={sr.s(250)} />
        );
    },
    confirmCachPay () {
        const { data } = this.state;
        const param = {
            userId: app.personal.info.userId,
            orderId: data.id,
        };
        POST(app.route.ROUTE_CONFIRM_CACH_PAYED, param, this.confirmCachPaySuccess, false);
    },
    confirmCachPaySuccess (data) {
        if (data.success) {
            Toast('支付成功');
            this.setState({ data:data.context }, this.setContinueTitle);
        } else {
            Toast(data.msg);
        }
    },
    doPrintReceiptSuccess (data) {
        if (data.success) {
            Toast('打印完成');
            this.setState({ showType:SHOW_PLACE_VIEW, data:{}, isModify:false }, this.setPlaceTitle);
        } else {
            Toast(data.msg);
        }
    },
    doPrintQrcode () {
        const { data } = this.state;
        const param = {
            userId: app.personal.info.userId,
            orderId: data.id,
        };
        POST(app.route.ROUTE_PRINT_BAR_CODE, param, this.doPrintQrcodeSuccess, false);
    },
    doPrintQrcodeSuccess (data) {
        if (data.success) {
            Toast('打印成功');
            this.setState({
                data : data.context,
            }, data.context.state == OS.OS_READY_PAYMENT ? this.setModifyTitle : this.setContinueTitle);
        } else {
            Toast(data.msg);
        }
    },
    componentWillMount () {
        this.state.isUpdateView ? this.getLastestOrder() : this.setPlaceTitle();
    },
    onWillFocus () {
        this.state.isUpdateView ? this.getLastestOrder() : this.setPlaceTitle();
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    onClickRow (data) {
        this.setState({ tabIndex:0, showType:SHOW_PLACE_VIEW, data:data }, this.setPlaceTitle);
    },
    render () {
        const menus = ['现填单', '通过预下单填单'];
        const { tabIndex, showType, data } = this.state;
        return (
            <ScrollView style={styles.container}
                refreshControl={
                    <RefreshControl
                        refreshing={false}
                        onRefresh={this.getLastestOrder}
                        title='正在刷新...' />
                }>
                {
                    showType == SHOW_PLACE_VIEW ?
                        <View style={{ flex:1 }}>
                            <View style={styles.tabContainer}>
                                {
                                menus.map((item, i) => (
                                    <TouchableHighlight
                                        key={i}
                                        underlayColor='rgba(0, 0, 0, 0)'
                                        onPress={this.changeTab.bind(null, i)}
                                        style={styles.touchTab}>
                                        <View style={styles.tabButton}>
                                            <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                                {item}
                                            </Text>
                                            <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                        </View>
                                    </TouchableHighlight>
                                ))
                            }
                            </View>
                            {
                            tabIndex == 0 ? <PlaceOrder confirm={this.confirm} info={data} /> : <PreOrderList onClickRow={this.onClickRow} />
                        }
                        </View>
                    :
                        <OrderDetail data={data} showConfirmPayBox={this.showConfirmPayBox} doPrintReceipt={this.doPrintReceipt} doPrintQrcode={this.doPrintQrcode} />
                }
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
        backgroundColor: '#FFFFFF',
        marginBottom:10,
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/cargo/AddCar.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    TouchableOpacity,
} = ReactNative;
const { Button, PageList } = COMPONENTS;
import moment from 'moment';
const CarInfo = require('./SelectCarType');

module.exports = React.createClass({
    statics: {
        title: '添加货车',
    },
    getInitialState () {
        return {
            plateNo:'',
        };
    },
    submit () {
        const { plateNo } = this.state;
        if (plateNo == null || plateNo == '') {
            Toast('车牌号不能为空');
        }  else {
            this.setCityTruck();
        }
    },
    setCityTruck () {
        const { plateNo } = this.state;
        const param = {
            userId: app.personal.info.userId,
            plateNo,
        };
        POST(app.route.ROUTE_SET_CITY_TRUCK, param, this.doSetCityTruckSuccess, true);
    },
    doSetCityTruckSuccess (data) {
        if (data.success) {
            Toast('提交成功');
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { carInfo, plateNo, drivingLicense } = this.state;
        return (
            <View style={styles.container}>
                <View>
                    <View style={styles.title}>
                        <Text style={styles.titleFont}>货车信息</Text>
                    </View>
                    <View>
                        <View style={styles.row}>
                            <Text style={styles.carInfoTitle}>车牌</Text>
                            <TextInput style={styles.carInfo}
                                underlineColorAndroid='transparent'
                                maxLength={7}
                                selectTextOnFocus
                                onChangeText={(text) => this.setState({ plateNo: text })}
                                defaultValue={plateNo == null ? '' : plateNo}
                                placeholderColor='#666666'
                                placeholder='请输入车牌号' />
                        </View>
                    </View>
                    <Button onPress={this.submit} style={styles.btn} textStyle={styles.btnFont}>确认添加</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    title:{
        height:30,
        justifyContent:'center',
        marginLeft:10,
    },
    titleFont:{
        fontSize:13,
    },
    row:{
        height:40,
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        marginBottom:1,
        alignItems:'center',
    },
    carInfo:{
        flex:1.6,
        fontSize:14,
        padding:0,
        color:'#333333',
        marginLeft:(sr.w - 300) / 2,
        textAlign:'right',
        marginRight:10,
    },
    carInfoTitle:{
        flex:0.4,
        fontSize:14,
        color:'#666666',
        marginLeft:10,
    },
    btn:{
        width:351,
        height:45,
        marginTop:18,
        borderRadius:4,
        alignSelf:'center',
        backgroundColor:'#FE9917',
    },
    btnFont:{
        fontWeight:'400',
    },
    history:{
        fontSize:13,
        marginLeft:10,
        marginTop:50,
        marginBottom:8,
    },
    listRow:{
        backgroundColor:'#FFFFFF',
        marginBottom:1,
        paddingLeft:10,
        paddingTop:5,
        height:50,
    },
    rowTitle:{
        flex:1,
    },
    rowInfo:{
        flex:1,
        fontSize:12,
        color:'#888888',
    },
    rowTime:{
        position:'absolute',
        left:(sr.w + 180) / 2,
        top:5,
        color:'#888888',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/cargo/BranchList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '物流超市',
        leftButton:{ handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        const { onWillFocus } = this.props;
        app.pop();
        if (onWillFocus) {
            onWillFocus();
        }
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            choose:app.personal.currentShopIndex,
        };
    },
    doChoose (rowId) {
        const { setCurrentShopId } = this.props;
        this.setState({
            choose:rowId,
        });
        app.personal.setCurrentShopIndex(rowId);
        app.personal.currentShopName = app.personal.info.shipper && app.personal.info.shipper.registerShopList[app.personal.currentShopIndex].name || '';
        app.personal.currentShopId = app.personal.info.shipper && app.personal.info.shipper.registerShopList[app.personal.currentShopIndex].id || null;
        if (setCurrentShopId) {
            setCurrentShopId(app.personal.currentShopId);
        }
    },
    renderRow (obj, sectionID, rowId) {
        const { choose } = this.state;
        return (
            <TouchableOpacity onPress={this.doChoose.bind(null, rowId)}>
                <View style={styles.itemContainer}>
                    <Text style={styles.itemText}>{obj.name}</Text>
                    <Image style={styles.choose}
                        source={choose == rowId ? app.img.common_radio : {}} />
                </View>
            </TouchableOpacity>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    dataSource={this.ds.cloneWithRows(app.personal.info.shipper.registerShopList)}
                    renderRow={this.renderRow}
                    enableEmptySections
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop:10,
    },
    itemContainer:{
        height:45,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-between',
        alignItems:'center',
    },
    itemText:{
        fontSize:14,
        color:'#333333',
        marginLeft:15,
    },
    choose:{
        height:10,
        width:10,
        marginRight:15,
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/cargo/OrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    TextInput,
} = ReactNative;

const { Button, CustomSheet, TouchAbleLink, } = COMPONENTS;
const PayInfo = require('../../common/PayInfo');
const PayPassword = require('../../common/PayPassword');
const LogisticsDetail = require('../../common/LogisticsDetail');
const ConfirmSendDoorAddress = require('../../common/ConfirmSendDoorAddress');
const moment = require('moment');

module.exports = React.createClass({
    statics: {
        title: '货单详情',
    },
    getInitialState () {
        return {
            data:{},
        };
    },
    componentWillMount () {
        this.getOrderDetail();
    },
    getOrderDetail () {
        const param = {
            userId: app.personal.info.userId,
            orderId: this.props.orderId,
        };
        POST(app.route.ROUTE_GET_ORDER_DETAIL, param, this.getOrderDetailSuccess, true);
    },
    getOrderDetailSuccess (data) {
        if (data.success) {
            this.setState({ data:data.context });
        } else {
            Toast(data.msg);
        }
    },
    toLogisticsDetail () {
        const { data } = this.state;
        app.push({
            component:LogisticsDetail,
            passProps:{
                obj:data,
            },
        });
    },
    toPayMode (payMode) {
        if (payMode == 0) {
            return '现付';
        } else if (payMode == 1) {
            return '到付';
        } else {
            return '混合付款';
        }
    },
    sendDoorPrice(){
        app.showModal(
            <ConfirmSendDoorAddress orderId={this.props.orderId}/>
        );
    },
    sendDoorBySelf(){
        const param = {
            userId:app.personal.info.userId,
            orderId:this.props.orderId,
            isTransport:false,
            endPoint:null,
            transportFee:null,
            isScan:false,
        };
        POST(app.route.ROUTE_SET_CLIENT_PICK_ORDER_TRANSPORT_FEE,param,this.setSendDoorSuccess,false);
    },
    setSendDoorSuccess(data){
        if (data.success) {
            Toast('状态改变成功');
            app.pop();
        }else{
            Toast(data.msg);
        }
    },
    render () {
        const { data } = this.state;
        const { stateList } = data;
        return (
            <View style={styles.container}>
                <View style={styles.containerReceive}>
                    <Text style={styles.textName}> 收货人：{!data.receiverName ? '暂无' : data.receiverName}</Text>
                    <Text style={styles.textName}> 收货人电话:{!data.receiverPhone ? '暂无' : data.receiverPhone}</Text>
                    <Text style={styles.textAddress}> 到货地：{data && data.endPoint} </Text>
                </View>
                <View style={styles.containerMarket}>
                    <View style={styles.containerMarketLeft}>
                        <Image style={styles.imageLogo}
                            source={app.img.order_logo}
                            resizeMode='stretch'
                            />
                        <Text style={styles.textMarket}>{data.shop ? data.shop.name : data.agent ? data.agent.name : ''}</Text>
                    </View>
                    <Text style={styles.textGetState}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.containerDetails}>
                    <Image style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.home_order}
                        source={{ uri:data.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.shop ? data.shop.address : data.agent ? data.agent.address : ''}</Text>
                                <Text>-></Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.endPoint}</Text>
                            </View>
                            <View style={styles.detailsTopRight}>
                                <Text style={styles.moneyLeft}>运费：</Text>
                                <Text style={styles.moneyRight}>¥{data.realFee}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>重量：{data.size}m³</Text>
                        <Text style={styles.textDetailsItem}>方量：{data.weight}吨</Text>
                        <Text style={styles.textDetailsItem}>件数：{data.totalNumbers}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.containerWhite} />
                <View style={styles.containerNumber}>
                    <Text style={styles.textNumber}>订单号：{data.id}</Text>
                    <Text style={styles.textDate}>创建时间：{data.createTime}</Text>
                </View>
                <View style={styles.containerInfo}>
                    <Text style={styles.textInfo}>运费：¥{data.realFee}</Text>
                    <Text style={styles.textInfo}>指定收款：¥{data.totalDesignatedFee}</Text>
                    <Text style={styles.textInfo}>代收货款：¥{data.proxyCharge}</Text>
                    <Text style={styles.textInfo}>
                        支付方式：{this.toPayMode(data.payMode)}
                    </Text>
                    <Text style={styles.textTotal}>需支付：¥{app.utils.N(data.totalDesignatedFee + data.proxyCharge)}</Text>
                </View>
                <TouchableOpacity onPress={this.toLogisticsDetail}>
                    <View style={styles.logInfo}>
                        <Text style={styles.textLogInfo}>仓储</Text>
                        <View style={styles.logInfoRight}>
                            <Text style={styles.textLogInfoRight}>二号仓库-第3区域</Text>
                        </View>
                    </View>
                </TouchableOpacity>
                <View style={styles.bottomView}>
                    <View style={styles.btnPhone} >
                        <Image source={app.img.shipper_tell_phone} style={styles.phone} resizeMode='contain'/>
                        <TouchAbleLink url={'tel:' + data.receiverPhone }
                        children={ <Text style={styles.btnCallText}>联系客户</Text>}/>
                    </View>
                    <Button  style={styles.btnBySelf} textStyle={styles.btnReceiveText} onPress={this.sendDoorBySelf}>
                        客户自提
                    </Button>
                    <Button  style={styles.btnReceive} textStyle={styles.btnReceiveText} onPress={this.sendDoorPrice}>
                        送货上门
                    </Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    containerTop:{
        height:60,
        backgroundColor:'#c81622',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    imageTop:{
        height:32,
        width:27,
    },
    textTop:{
        fontSize:12,
        fontWeight:'900',
        marginLeft:20,
        color:'#ffffff',
    },
    containerReceive:{
        marginTop:8,
        paddingLeft:10,
        height:55,
        backgroundColor:'#ffffff',
        justifyContent: 'center',
    },
    textAddress:{
        fontSize:12,
        marginBottom:3,
        color:'#333333',
        flex:1,
    },
    textName:{
        fontSize:12,
        color:'#333333',
        flex:1,
    },
    containerMarket:{
        height:25,
        marginTop:8,
        backgroundColor:'#ffffff',
        alignItems: 'center',
        justifyContent: 'space-between',
        flexDirection: 'row',
    },
    containerMarketLeft:{
        flexDirection: 'row',
    },
    imageLogo:{
        height:13,
        width:16.5,
        marginLeft:10,
    },
    textMarket:{
        marginLeft:10,
        color:'#333333',
        fontSize:12,
    },
    textGetState:{
        color:'#00a117',
        marginRight:10,
        fontSize:12,
    },
    containerDetails:{
        height:105,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    containerWhite:{
        height:8,
        backgroundColor:'#ffffff',
    },
    imageGoods:{
        height:75,
        width:75,
        marginLeft:12,
        marginTop:15,
    },
    goodsDetails:{
        marginLeft:8,
        height:95,
        paddingBottom:8,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
        marginTop:15,
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
        marginTop:15,
    },
    detailsAddress:{
        fontSize:14,
        width:80,
        color:'#333333',
        flexDirection: 'row',

    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:12,
        color:'#888888',
    },
    containerNumber:{
        height:50,
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        justifyContent: 'center',
    },
    textNumber:{
        color:'#333333',
        marginBottom:3,
        fontSize:12,
    },
    textDate:{
        color:'#888888',
        marginTop:3,
        fontSize:12,
    },
    containerInfo:{
        backgroundColor:'#ffffff',
        marginTop:8,
        paddingLeft:10,
        paddingBottom:5,
        paddingTop:5,
    },
    textInfo:{
        color:'#888888',
        fontSize:12,
        marginTop:5,
        height:15,
    },
    textTotal:{
        marginTop:5,
        fontSize:12,
        color:'#333333',
        fontWeight:'400',
        height:15,
    },
    logInfo:{
        height:40,
        backgroundColor:'#ffffff',
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLogInfo:{
        color:'#888888',
        fontSize:14,
        marginLeft:10,
    },
    logInfoRight:{
        marginRight:10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    textLogInfoRight:{
        fontSize:14,
        color:'#333333',
        marginRight:5,
    },
    imageCommon_go:{
        width: 8,
        height: 15,
        marginRight: 7,
    },
    btnReceive:{
        height:50,
        borderRadius:0,
        flex:0.8,
    },
    btnReceiveText:{
        fontSize:16,
        fontWeight:'500',
    },
    isReachPay:{
        backgroundColor:'#f4f4f4',
        width:sr.w,
        height:45,
    },
    btnPhone:{
        flexDirection:'row',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
        flex:1,
        height:50,
    },
    bottomView:{
        flex:1,
        alignItems:'flex-end',
        flexDirection:'row',
    },
    btnCall:{
        backgroundColor:'#FFFFFF',
        height:50,
        borderRadius:0,
    },
    btnCallText:{
        fontSize:16,
        color:'#333333',
    },
    phone:{
        height:20,
    },
    btnBySelf:{
        height:50,
        borderRadius:0,
        backgroundColor:'#F79835',
        flex:0.8,
    },
    sendDoorAddress:{
        marginTop:10,
    },
    listView:{
        height:1,
        backgroundColor:'#333333',
    },
    containerItem:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textLeft:{
        fontSize:14,
        color:'#333333',
        marginLeft:10,
    },
    textRight:{
        fontSize:14,
        color:'#888888',
        marginRight:10,
    },
    text_input: {
        height:40,
        width: 200,
        padding:0,
        fontSize:14,
        alignSelf: 'center',
        textAlign:'right',
    },
    rightView:{
        flexDirection: 'row',
        alignItems: 'center',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/cargo/ScanOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button,DImage } = COMPONENTS;
import moment from 'moment';

module.exports = React.createClass({
    statics: {
        title: '扫描订单详情',
    },
    getInitialState () {
        return {
            data:[],
            count:1,
            unStoageNumbers:0,
        };
    },
    componentWillMount () {
        this.getOrderDetail();
    },
    getOrderDetail () {
        const { orderId } = this.props;
        const param = {
            userId:app.personal.info.userId,
            orderId,
            count:0,
        };
        POST(app.route.ROUTE_PLACE_STORAGE, param, this.postScanOrderSuccess, true);
    },
    postScanOrderSuccess (data) {
        if (data.success) {
            this.setState({
                data:data.order,
                unStoageNumbers: _.find(data.order.stateList, o => o.state == 5 && o.count).count,
            });
        } else {
            Toast(data.msg);
            app.pop();
        }
    },
    minusCount () {
        const { count } = this.state;
        if (count > 0) {
            this.setState({ count:count - 1 });
        } else {
            Toast('入库数量不能小于0');
        }
    },
    addCount () {
        const { count, unStoageNumbers } = this.state;
        if (count < unStoageNumbers) {
            this.setState({ count:count + 1 });
        } else {
            Toast('入库数量不能大于未装载件数');
        }
    },
    showScanResult () {
        const { orderId } = this.props;
        const { count, unStoageNumbers } = this.state;
        if (count >= 0 && count <= unStoageNumbers) {
            app.navigator.replace({
                component: require('./ScanResult'),
                passProps:{
                    orderId,
                    count:count * 1,
                },
            });
        } else {
            Toast('入库数量有误');
        }
    },
    doCancel () {
        app.navigator.popToTop();
    },
    render () {
        const { data, count, unStoageNumbers } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.containerDetails}>
                    <DImage style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri:data.photo ? data.photo : '' }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{app.personal.currentShopName}</Text>
                                <Text >-</Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.endPoint}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>总重量：{app.utils.N(data.weight)}m³</Text>
                        <Text style={styles.textDetailsItem}>总方量：{app.utils.N(data.size)}吨</Text>
                        <Text style={styles.textDetailsItem}>未入库件数：{app.utils.N(unStoageNumbers)}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.modifyCount}>
                    <Text style={styles.modifyCountTitle}>入库数量</Text>
                    <TouchableOpacity onPress={this.minusCount}>
                        <Text style={styles.imgSymbol}>－</Text>
                    </TouchableOpacity>
                    <TextInput
                        style={styles.countFont}
                        defaultValue={count + ''}
                        underlineColorAndroid='transparent'
                        onChangeText={(text) => this.setState({ count:text })}
                        keyboardType='numeric' />
                    <TouchableOpacity onPress={this.addCount}>
                        <Text style={styles.imgSymbol}>＋</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.bottom}>
                    <Button style={styles.btnConfirm} textStyle={styles.btnFont} onPress={this.showScanResult}>确认</Button>
                    <Button style={styles.btnCancel} textStyle={styles.btnFont} onPress={this.doCancel}>取消</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    containerDetails:{
        height:150,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    imageGoods:{
        height:125,
        width:125,
        marginLeft:12,
        marginTop:11,
    },
    goodsDetails:{
        marginLeft:8,
        height:125,
        paddingBottom:8,
        marginTop:10,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
        flex:1,
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    detailsAddress:{
        fontSize:16,
        width:100,
        color:'#333333',
        flexDirection: 'row',
    },
    moneyLeft:{
        fontSize:14,
        color:'#333333',
    },
    moneyRight:{
        fontSize:15,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:14,
        color:'#888888',
        flex:1,
    },
    modifyCount:{
        flexDirection:'row',
        backgroundColor:'#f4f4f4',
        height:50,
        marginTop:10,
        alignItems:'center',
    },
    modifyCountTitle:{
        marginLeft:20,
        color:'#888888',
        marginRight:130,
    },
    imgSymbol:{
        marginRight:10,
        fontSize:20,
    },
    countFont:{
        padding:0,
        fontSize:14,
        width:30,
        height:20,
        color:'#888888',
        backgroundColor:'#FFFFFF',
        marginRight:10,
        alignSelf:'center',
        textAlign:'right',
    },
    btnConfirm:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#FE9917',
    },
    btnCancel:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    bottom:{
        height:45,
        width:sr.w,
        flexDirection:'row',
        position:'absolute',
        bottom:0,
        right:0,
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/cargo/ScanResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

const { Button,DImage } = COMPONENTS;
import moment from 'moment';
const ScanBarCode = require('../../common/ScanBarCode');

module.exports = React.createClass({
    statics: {
        title: '扫描结果',
    },
    componentWillMount () {
        const { orderId, count } = this.props;
        this.postScanOrder( orderId, count );
    },
    postScanOrder ( orderId, count) {
        const param = {
            userId:app.personal.info.userId,
            orderId,
            count,
        };
        POST(app.route.ROUTE_PLACE_STORAGE, param, this.postScanOrderSuccess, true);
    },
    postScanOrderSuccess (data) {
        if (data.success) {
            this.setState({
                data:data.order,
            });
        } else {
            Toast(data.msg);
        }
    },
    getInitialState () {
        return {
            data:{},
        };
    },
    finishScanOrder () {
        app.navigator.popToTop();
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            app.navigator.replace({
                component: require('./ScanOrderDetail'),
                passProps: {
                    orderId:data.id,
                },
            });
        }
    },
    continueScanOrder () {
        app.showModal(
            <ScanBarCode onBarCodeRead={this.onBarCodeRead} />
        );
    },
    render () {
        const { data } = this.state;
        return (
            <View style={styles.container}>
            <View style={styles.order}>
                <DImage
                    resizeMode='cover'
                    defaultSource={app.img.common_default}
                    source={{ uri:data.photo }}
                    style={styles.icon} />
                <View style={styles.rowInfo}>
                    <Text style={styles.id}
                        numberOfLines={1}
                        ellipsizeMode='tail'>货单号:{data.id}</Text>
                    <Text style={styles.info}>重量:{app.utils.N(data.weight)}吨</Text>
                    <Text style={styles.info}>方量:{app.utils.N(data.size)}m³</Text>
                    <Text style={styles.info}>收货地址:{data.endPoint}</Text>
                </View>
                <Text style={styles.timeInfo}>{moment(data.createTime).format('YYYY-MM-DD')}</Text>
            </View>
                <View style={styles.bottom}>
                    <Button style={styles.btnEnd} textStyle={styles.btnFont} onPress={this.finishScanOrder}>结束扫描</Button>
                    <Button style={styles.btnContinue} textStyle={styles.btnFont} onPress={this.continueScanOrder}>继续扫描</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    top:{
        flexDirection:'row',
        height:60,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    order:{
        flexDirection:'row',
        height:90,
        backgroundColor:'#FFFFFF',
        marginTop:10,
        alignItems:'center',
    },
    row:{
        flexDirection:'row',
        height:90,
        backgroundColor:'#FFFFFF',
        marginTop:10,
        alignItems:'center',
    },
    icon:{
        width:70,
        height:70,
        borderRadius:2,
        marginLeft:8,
    },
    rowInfo:{
        marginTop:10,
        marginBottom:10,
        marginLeft:5,
    },
    id:{
        fontSize:14,
        color:'#333333',
        width:150,
        flex:1,
    },
    info:{
        fontSize:12,
        color:'#888888',
        marginTop:1,
        flex:1,
    },
    timeInfo:{
        fontSize:12,
        width:80,
        color:'#888888',
        alignSelf:'flex-start',
        marginTop:12,
        marginLeft:30,
    },
    btnContinue:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#FE9917',
    },
    btnEnd:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    bottom:{
        marginTop:sr.h/3,
        height:45,
        flexDirection:'row',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/cargo/SelectCarType.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const carInfo = [
    {
        name:'车长',
        array:['4.5米', '5米', '5.5米', '6.5米', '7.5米', '8.5米', '9.6米', '13.5米', '17.5米'],
    },
    {
        name:'车型',
        array:['其他', '高栏', '平板', '箱式', '高低板', '保温'],
    },
];
module.exports = React.createClass({
    getInitialState () {
        return {
            lengthName:'4.5米',
            typeName:'不限',
            selectArray : [0, 0],
        };
    },
    toClose () {
        app.pop();
    },
    toChoose (i, index, obj) {
        const { selectArray } = this.state;
        if (i == 0) {
            selectArray[i] = index;
            this.setState({
                lengthName:obj,
            });
        } else {
            selectArray[i] = index;
            this.setState({
                typeName:obj,
            });
        }
    },
    toSubmit (lengthName, typeName) {
        const { setCarInfo, doClose } = this.props;
        setCarInfo(lengthName, typeName);
        doClose();
    },
    render () {
        const { selectArray, lengthName, typeName } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.textTop}>车长车型</Text>
                    <TouchableOpacity onPress={this.props.doClose}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.cargo_cancel}
                            style={styles.closeStyle} />
                    </TouchableOpacity>
                </View>
                <View style={styles.listView} />
                {
                    carInfo.map((item, i) => (
                        <View style={styles.containerMiddle} key={i}>
                            <Text style={styles.rowTitle}>{item.name}</Text>
                            <View style={styles.row}>
                                {
                                    item.array.map((obj, index) => (
                                        <TouchableOpacity
                                            key={index}
                                            onPress={this.toChoose.bind(null, i, index, obj)}
                                            style={selectArray[i] == index ? styles.chooseItem : styles.item}
                                            >
                                            <Text style={styles.itemFont}>{obj}</Text>
                                        </TouchableOpacity>
                                    ))
                                }
                            </View>
                        </View>
                        ))
                    }
                <Button style={styles.btn} textStyle={styles.btnFont} onPress={this.toSubmit.bind(null, lengthName, typeName)}>确认</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        height:350,
        backgroundColor:'#FFFFFF',
    },
    containerTop:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',

    },
    textTop:{
        fontSize:17,
        marginLeft:(sr.w - 17 * 4) / 2,
        color:'#333333',
    },
    closeStyle:{
        height:15,
        width:15,
        marginRight:10,
    },
    containerMiddle:{
        marginTop:1,
        backgroundColor:'#ffffff',
    },
    rowTitle:{
        fontSize:13,
        marginLeft:10,
    },
    row:{
        flexDirection:'row',
        marginLeft:5,
        flexWrap:'wrap',
        width:sr.w,
    },
    item:{
        width:50,
        height:20,
        backgroundColor:'#f4f4f4',
        margin:5,
        alignItems:'center',
        justifyContent:'center',
    },
    chooseItem:{
        width:50,
        height:20,
        backgroundColor:'#FE9917',
        margin:5,
        alignItems:'center',
        justifyContent:'center',
    },
    itemFont:{
        fontSize:12,
    },
    rowTitle1:{
        fontSize:13,
        marginLeft:10,
        marginTop:19,
    },
    btn:{
        height:45,
        width:351,
        backgroundColor:'#c81622',
        borderRadius:4,
        alignSelf:'center',
        marginTop:50,
    },
    btnFont:{
        color:'#FFFFFF',
    },
    listView:{
        height:1,
        backgroundColor:'#f4f4f4',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/cargo/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

const { PageList, Button } = COMPONENTS;

const BranchList = require('./BranchList');
const OrderDetail = require('./OrderDetail');
const ScanOrderDetail = require('./ScanOrderDetail');
const ScanBarCode = require('../../common/ScanBarCode');
const PayInfo = require('../../common/PayInfoModel');
const PayPassword = require('../../common/PayPassword');

let sumWeight = 0;
let sumCount = 0;
let sumSize = 0;

module.exports = React.createClass({
    getInitialState () {
        return {
            list:[],
            remainBondAmount:0,
            remainAmount:app.personal.remainAmount,
        };
    },
    componentWillMount () {
        this.updateNavBar();
        this.getBranchShopInfo();
        this.getRemainAmount();
    },
    onWillFocus () {
        this.updateNavBar();
        this.getBranchShopInfo();
        this.getRemainAmount();
    },
    updateNavBar () {
        app.getCurrentRoute().title = '竞得货物';
        app.getCurrentRoute().rightButton = { title: '扫描收货', handler: () => { this.toScanStorage(); } };
        app.getCurrentRoute().leftButton = { title: app.personal.currentShopName, handler: () => { app.scene.toShop(); }, isLimitLength:true };
        app.forceUpdateNavbar();
    },
    getRemainAmount () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_REMAIN_AMOUNT, param, this.getRemainAmountSuccess, false);
    },
    getRemainAmountSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.setRemainAmount(context.amount);
            this.setState({ remainAmount:app.personal.remainAmount });
        }
    },
    getBranchShopInfo () {
        const param = {
            userId : app.personal.info.userId,
            shopId : app.personal.currentShopId,
        };
        POST(app.route.ROUTE_GET_BRANCH_SHOP_INFO, param, this.getBranchShopInfoSuccess, false);
    },
    getBranchShopInfoSuccess (data) {
        if (data.success) {
            this.setState({ remainBondAmount : data.context.remainBondAmount });
        }
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            this.showScanOrderDetail(data.id);
        }
    },
    showScanOrderDetail (orderId) {
        app.push({
            component:ScanOrderDetail,
            passProps:{
                orderId,
            },
        });
    },
    toShop () {
        app.push({
            component:BranchList,
        });
    },
    toScanStorage () {
        app.showModal(<ScanBarCode onBarCodeRead={this.onBarCodeRead.bind( null )} />);
    },
    doChoose (obj, rowId) {
        const { list } = this.state;
        list[rowId].selected = !list[rowId].selected;
        this.setState({
            list,
        });
        this.doTotalCalculation();
    },
    toDetail (id) {
        app.push({
            component:OrderDetail,
            passProps:{
                orderId : id,
            }
        });
    },
    doSelectedAll () {
        let { list } = this.state;
        if (_.every(list, o => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({ list });
        this.doTotalCalculation();
    },
    doTotalCalculation () {
        const { list } = this.state;
        sumWeight = 0;
        sumCount = 0;
        sumSize = 0;
        _.filter(list, (o) => o.selected == true).forEach((item, i) => {
            sumSize = sumSize + item.item.totalSize;
            sumCount = sumCount + item.item.orderCount;
            sumWeight = sumWeight + item.item.totalWeight;
        });
    },
    refreshList () {
        this.listView.refresh();
    },
    renderRow (obj, rowId) {
        const { list } = this.state;
        if (!_.find(list, (o) => o.index == rowId)) {
            list.push({ selected:false, index:rowId, item:obj });
        }
        return (
            <View style={styles.itemContainer}>
                <TouchableOpacity style={styles.btnChoose}
                    onPress={this.doChoose.bind(null, obj, rowId)}>
                    <Image style={styles.choose}
                        source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose} />
                </TouchableOpacity>
                <TouchableOpacity onPress={this.toDetail.bind( null, obj.id )}
                    style={styles.detail}>
                    <View style={styles.rightContainer}>
                        <View style={styles.pointContainer}>
                            <Text style={styles.itemAddress}>{app.personal.currentShopName}</Text>
                            <Image style={styles.point} source={app.img.cargo_point} />
                            <Text style={styles.itemAddress}>{obj.endPoint}</Text>
                        </View>
                        <View style={styles.pointContainerTop}>
                            <Text style={styles.textLeft}>总重量：</Text>
                            <Text style={styles.textRight}>{obj.weight}吨</Text>
                        </View>
                        <View style={styles.itemNumber}>
                            <Text style={styles.textLeft}>总方量：</Text>
                            <Text style={styles.textRight}>{obj.size}m³</Text>
                        </View>
                        <View style={styles.itemNumberBottom}>
                            <Text style={styles.textLeft}>总单数：</Text>
                            <Text style={styles.textRight}>{obj.totalNumbers}单</Text>
                        </View>
                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        const { list, remainAmount, remainBondAmount } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        return (
            <View style={styles.container}>
                {
                    (_.intersection(app.personal.info.authority, [AH.AH_LOOK_AMOUNT, AH.AH_RECHARGE, AH.AH_WITHDRAW]).length != 0) &&
                    <Image style={styles.balance}
                        source={app.img.cargo_balance_background}>
                        <Text style={styles.balanceText}>余额：
                            {remainAmount}</Text>
                        <Text style={styles.balanceTextRight}>担保余额：{app.utils.N(remainBondAmount)}</Text>
                    </Image>

                }
                <View style={styles.listView}>
                        <PageList
                            ref={(ref) => { this.listView = ref; }}
                            renderRow={this.renderRow}
                            listName={'stored.list'}
                            listParam={{ userId: app.personal.info.userId, type : 'stored' }}
                            listUrl={app.route.ROUTE_GET_CITY_DISTRIBUTE_ORDERS}
                            refreshEnable
                            />
                        <View style={styles.selectedAllContainer}>
                            <TouchableOpacity onPress={this.doSelectedAll}
                                style={styles.selectedAllBtn}>
                                <Image style={styles.chooseAll}
                                    source={status ? app.img.order_choose : app.img.order_no_choose} />
                                <Text style={styles.selectedAllText}>全选</Text>
                            </TouchableOpacity>
                            <Text style={styles.totalText}>总计</Text>
                            <Text style={styles.totalItem}>{sumWeight}吨</Text>
                            <Text style={styles.totalItem}>{sumSize}m³</Text>
                            <Text style={styles.totalItem}>{sumCount}单</Text>
                        </View>
                    </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    listView:{
        flex:1,
        marginTop:10,
    },
    balance:{
        width:300,
        height:30,
        marginLeft:(sr.w - 300) / 2,
        flexDirection: 'row',
        justifyContent:'center',
        alignItems:'center',
    },
    balanceText:{
        fontSize:14,
        color:'#f69838',
        marginRight:5,
    },
    balanceTextRight:{
        fontSize:12,
        color:'#f69838',
        marginLeft:5,
    },
    itemContainer:{
        height:85,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    btnChoose:{
        height:85,
        justifyContent:'center',
        alignItems:'center',
        width:35,
    },
    choose:{
        height:12,
        width:12,
    },
    detail:{
        justifyContent:'center',
        width:sr.w - 35,
    },
    rightContainer:{
        justifyContent:'center',
    },
    pointContainer:{
        flexDirection: 'row',
        alignItems:'center',
    },
    pointContainerTop:{
        flexDirection: 'row',
        alignItems:'center',
        marginTop:2,
    },
    itemNumber:{
        flexDirection: 'row',
        alignItems:'center',
        marginTop:1,
    },
    itemNumberBottom:{
        flexDirection: 'row',
        alignItems:'center',
        marginTop:1,
    },
    point:{
        width:35,
        height:5,
        marginLeft:5,
        marginRight:5,
    },
    itemAddress:{
        marginTop:2,
        fontSize:14,
        color:'#333333',
    },
    textLeft:{
        fontSize:12,
        color:'#888888',
    },
    textRight:{
        fontSize:12,
        color:'#333333',
    },
    selectedAllContainer:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
    },
    selectedAllBtn:{
        flexDirection:'row',
        alignItems:'center',
    },
    chooseAll:{
        height:9,
        width:9,
        marginLeft:10,
    },
    selectedAllText:{
        color:'#333333',
        fontSize:12,
        marginLeft:10,
    },
    totalText:{
        color:'#333333',
        fontSize:15,
        fontWeight:'500',
        marginLeft:30,
    },
    totalItem:{
        fontSize:12,
        color:'#f01823',
        marginLeft:20,
    },
    item: {
        padding:10,
        backgroundColor:'#FFFFFF',
    },
    row:{
        flexDirection:'row',
        marginTop:10,
        alignItems:'center',
    },
    icon:{
        width:70,
        height:70,
        borderRadius:2,
        marginLeft:8,
    },
    rowInfo:{
        marginTop:10,
        marginBottom:10,
        marginLeft:5,
    },
    id:{
        fontSize:14,
        color:'#333333',
        flex:1,
    },
    info:{
        fontSize:12,
        color:'#888888',
        flex:1,
    },
    bottomView:{
        position:'absolute',
        top:200,
        width:sr.w,
    },
    bottomInfo:{
        flexDirection: 'row',
        backgroundColor:'white',
    },
    infoLeft:{
        height:45,
        flexDirection: 'row',
        flex:1,
        justifyContent:'center',
        alignItems: 'center',
    },
    moneyLeft:{
        fontSize:12,
        color:'#333333',
    },
    moneyRight:{
        fontSize:13,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    btnPayNow:{
        height:45,
        flex:1,
        borderRadius:0,
    },
    btnPayNowText:{
        fontSize:16,
        fontWeight:'500',
    },
    orderInfo:{
        height:480,
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/order/ScanOrderDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, DImage } = COMPONENTS;
import moment from 'moment';

module.exports = React.createClass({
    statics: {
        title: '扫描装车详情',
    },
    getInitialState () {
        return {
            data: [],
            count : 0,
        };
    },
    componentWillMount(){
        this.getScanDetail();
    },
    getScanDetail(){
        const { count } = this.state;
        const param = {
            userId: app.personal.info.userId,
            orderId: this.props.orderId,
            count,
        };
        POST(app.route.ROUTE_SCAN_LOAD_ORDER_FOR_CITY_DISTRIBUTE, param, this.getScanDetailSuccess, false);
    },
    getScanDetailSuccess(data){
        if (data.success) {
            this.setState({ data : data.context.latestOrder });
        }else{
            Toast(data.msg);
        }
    },
    minusCount () {
        const { count } = this.state;
        if (count > 0) {
            this.setState({ count:count - 1 });
        } else {
            Toast('装车数量不能小于0');
        }
    },
    addCount () {
        const { count, data } = this.state;
        if (count < data.totalNumbers) {
            this.setState({ count:count + 1 });
        } else {
            Toast('装车数量不能超过货物总数');
        }
    },
    showScanResult () {
        const { count, data } = this.state;
        if (count > 0 && count <= data.totalNumbers) {
            const param = {
                userId: app.personal.info.userId,
                orderId: data.id,
                count,
            };
            POST(app.route.ROUTE_SCAN_LOAD_ORDER_FOR_CITY_DISTRIBUTE, param, this.doConfirmSuccess, true);
        } else {
            Toast('数量清点有误,请重新核实');
        }
    },
    doConfirmSuccess (data) {
        if (data.success) {
            Toast('装车成功');
            app.navigator.popToTop();
        } else {
            Toast(data.msg);
        }
    },
    doCancel () {
        app.navigator.popToTop();
    },
    render () {
        const { data, count } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.containerDetails}>
                    <DImage style={styles.imageGoods}
                        resizeMode='stretch'
                        defaultSource={app.img.common_default}
                        source={{ uri:data.photo }}
                        />
                    <View style={styles.goodsDetails}>
                        <View style={styles.goodsDetailsTop}>
                            <View style={styles.detailsTopLeft}>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{app.personal.currentShopName}</Text>
                                <Text >-</Text>
                                <Text style={styles.detailsAddress}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{data.endPoint}</Text>
                            </View>
                        </View>
                        <Text style={styles.textDetailsItem}>装车重量：{app.utils.N(data.weight)}m³</Text>
                        <Text style={styles.textDetailsItem}>装车方量：{app.utils.N(data.size)}吨</Text>
                        <Text style={styles.textDetailsItem}>货物总数：{app.utils.N(data.totalNumbers)}件</Text>
                        <Text style={styles.textDetailsItem}>下单时间：{moment(data.createTime).format('YYYY-MM-DD')}</Text>
                    </View>
                </View>
                <View style={styles.modifyCount}>
                    <Text style={styles.modifyCountTitle}>装车件数</Text>
                    <TouchableOpacity onPress={this.minusCount}>
                        <Text style={styles.imgSymbol}>－</Text>
                    </TouchableOpacity>
                    <TextInput
                        style={styles.countFont}
                        defaultValue={count + ''}
                        underlineColorAndroid='transparent'
                        onChangeText={(text) => this.setState({ count:text })}
                        keyboardType='numeric' />
                    <TouchableOpacity onPress={this.addCount}>
                        <Text style={styles.imgSymbol}>＋</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.bottom}>
                    <Button style={styles.btnConfirm} textStyle={styles.btnFont} onPress={this.showScanResult}>确认</Button>
                    <Button style={styles.btnCancel} textStyle={styles.btnFont} onPress={this.doCancel}>取消</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    containerDetails:{
        height:150,
        backgroundColor:'#f8f8f8',
        flexDirection: 'row',
    },
    imageGoods:{
        height:125,
        width:125,
        marginLeft:12,
        marginTop:11,
    },
    goodsDetails:{
        marginLeft:8,
        height:125,
        paddingBottom:8,
        marginTop:10,
        justifyContent: 'center',
    },
    goodsDetailsTop:{
        width:sr.w - 99,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    detailsTopLeft:{
        flexDirection: 'row',
        alignItems: 'center',
        flex:1,
    },
    detailsTopRight:{
        flexDirection: 'row',
        alignItems: 'center',
    },
    detailsAddress:{
        fontSize:16,
        width:100,
        color:'#333333',
        flexDirection: 'row',
    },
    moneyLeft:{
        fontSize:14,
        color:'#333333',
    },
    moneyRight:{
        fontSize:15,
        fontWeight:'500',
        color:'#f01114',
        marginRight:10,
    },
    textDetailsItem:{
        marginTop:2,
        fontSize:14,
        color:'#888888',
        flex:1,
    },
    modifyCount:{
        flexDirection:'row',
        backgroundColor:'#f4f4f4',
        height:50,
        marginTop:10,
        alignItems:'center',
    },
    modifyCountTitle:{
        marginLeft:20,
        color:'#888888',
        marginRight:130,
    },
    imgSymbol:{
        marginRight:10,
        fontSize:20,
    },
    countFont:{
        padding:0,
        fontSize:14,
        width:30,
        height:20,
        color:'#888888',
        backgroundColor:'#FFFFFF',
        marginRight:10,
        alignSelf:'center',
        textAlign:'right',
    },
    btnConfirm:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#FE9917',
    },
    btnCancel:{
        flex:1,
        height:45,
        borderRadius:0,
        backgroundColor:'#c81622',
    },
    btnFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    bottom:{
        height:45,
        width:sr.w,
        flexDirection:'row',
        position:'absolute',
        bottom:0,
        right:0,
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/order/TruckList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const { PageList, DImage, Button } = COMPONENTS;
const OrderDetail = require('../../common/SendOrderDetail');
const LogisticsDetail = require('../../common/LogisticsDetail');

module.exports = React.createClass({
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={sectionID + rowID} />
        );
    },
    getOrderDetail(obj,rowID){
        app.push({
            component:OrderDetail,
            passProps:{
                data: obj,
            },
        });
    },
    doLookTransport(obj,rowID){
        app.push({
            component:LogisticsDetail,
            passProps:{
                obj,
            },
        });
    },
    renderRow (obj, rowID) {
        const { stateList } = obj;
        return (
            <View style={styles.row}>
                <View style={styles.rowTopContainer}>
                    <DImage
                        resizeMode='stretch'
                        source={app.img.order_logo}
                        style={styles.topImage} />
                    <Text style={styles.topLeftText}>{obj.shop ? obj.shop.name : obj.agent ? obj.agent.name : ''}</Text>
                    <Text style={styles.topRightText}>{stateList ? OS.MAP[stateList[0].state] : ''}</Text>
                </View>
                <View style={styles.middle}>
                    <TouchableOpacity style={styles.rowMiddleContainer} onPress={this.getOrderDetail.bind(null, obj, rowID)}>
                        <DImage
                            resizeMode='stretch'
                            defaultSource={app.img.common_default}
                            source={{ uri: obj.photo }}
                            style={styles.middleImage} />
                        <View style={styles.middleRight}>
                            <View style={styles.pointContainer}>
                                <View style={styles.placeContainer}>
                                    <Text style={styles.pointName}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{obj.shop ? obj.shop.address : obj.agent ? obj.agent.address : ''}</Text>
                                    <Text style={styles.pointText}>→</Text>
                                    <Text style={styles.pointName}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{obj.endPoint}</Text>
                                </View>
                                <Text style={styles.transformFee}>{'运费：'}<Text style={styles.money}>￥{obj.needPayInsuanceFee + obj.needPayTransportFee}</Text></Text>
                            </View>
                            <Text style={styles.commonInfo}>重量：{obj.weight}吨</Text>
                            <Text style={styles.commonInfo}>方量：{obj.size}m³</Text>
                            <Text style={styles.commonInfo}>件数：{obj.totalNumbers}件</Text>
                            <Text style={styles.commonInfo}>下单时间：{obj.createTime}</Text>
                        </View>
                    </TouchableOpacity>
                </View>
                <View style={styles.rowButtomContainer}>
                <Button
                    onPress={this.doLookTransport.bind(null, obj)}
                    style={styles.lookTransport}
                    textStyle={styles.btnTransportText}>
                    {'查看物流'}
                </Button>
                    <Button onPress={this.getOrderDetail.bind(null, obj, rowID)} style={styles.lookDetail} textStyle={styles.btnDetallText}>{'查看详情'}</Button>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, type, data, listUrl } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                <View style={styles.separator} />
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        renderSeparator={this.renderSeparator}
                        listParam={{ userId: app.personal.info.userId, type: type }}
                        listName={type + '.list'}
                        list={data.list}
                        autoLoad={false}
                        listUrl={listUrl}
                        refreshEnable
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    row: {
        paddingVertical: 2,
        paddingHorizontal: 2,
    },
    separator: {
        backgroundColor: '#f4f4f4',
        height: 8,
    },
    rowTopContainer: {
        paddingHorizontal:10,
        paddingVertical:5,
        backgroundColor:'white',
        flexDirection: 'row',
    },
    topImage: {
        width: 17,
        height:17,
    },
    topLeftText: {
        marginLeft:10,
        flex:1,
        fontSize: 14,
    },
    topRightText: {
        flex:1,
        fontSize: 14,
        textAlign:'right',
        color:'#f51b1a',
    },
    middle:{
        flexDirection:'row',
        height:100,
        alignItems:'center',
        width:sr.w,
        backgroundColor:'#f8f8f8',
    },
    rowMiddleContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical:11,
        height:100,
    },
    btnChoose:{
        height:100,
        width:20,
        marginRight:3,
        justifyContent:'center',
        alignItems:'center',
    },
    choose:{
        height:12,
        width:12,
    },
    middleImage: {
        width: 80,
        height:80,
        borderRadius: 10,
    },
    middleRight: {
        paddingLeft: 10,
        width:sr.w - 105,
    },
    money: {
        fontSize: 12,
        color:'#f51b1a',
    },
    commonInfo: {
        fontSize: 13,
        color:'#888888',
    },
    pointName: {
        fontSize: 13,
        maxWidth: 60,
    },
    pointText:{
        marginLeft:5,
        marginRight:10,
    },
    transformFee: {
        fontSize: 12,
        color: 'gray',
        marginRight:10,
        textAlign:'right',
    },
    pointContainer: {
        flexDirection: 'row',
        marginBottom:4,
    },
    placeContainer: {
        flex:2,
        flexDirection: 'row',
    },
    rowButtomContainer: {
        backgroundColor:'white',
        flexDirection: 'row',
        justifyContent: 'flex-end',
        paddingVertical:5,
    },
    lookTransport: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#ff6200',
        borderWidth:1,
        backgroundColor:'white',
    },
    lookDetail: {
        height:20,
        width:73,
        borderRadius:5,
        borderColor:'#007ef7',
        borderWidth:1,
        marginLeft:20,
        marginRight:10,
        backgroundColor:'white',
    },
    btnTransportText:{
        color:'#ff6200',
        fontSize:12,
        fontWeight:'300',
    },
    btnDetallText:{
        color:'#007ef7',
        fontSize:12,
        fontWeight:'300',
    },
    totalLeft:{
        flex:7,
        flexDirection:'row',
        alignItems:'center',
    },
    selectedAllContainer:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
    },
    selectedAllBtn:{
        flexDirection:'row',
        alignItems:'center',
        height:40,
    },
    chooseAll:{
        height:12,
        width:12,
        marginLeft:5,
    },
    selectedAllText:{
        color:'#333333',
        fontSize:12,
        marginLeft:10,
    },
    totalText:{
        color:'#333333',
        fontSize:15,
        fontWeight:'500',
        marginLeft:20,
    },
    totalItem:{
        width:45,
        fontSize:12,
        color:'#f01823',
        textAlign:'right',
        marginLeft:5,
    },
    totalItemRight:{
        width:50,
        fontSize:12,
        color:'#f01823',
        textAlign:'right',
        marginRight:5,
    },
    pay:{
        flex:3,
        marginLeft:10,
        height:50,
        width:150,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor:'#c81622',
    },
    payText:{
        fontSize:14,
        fontWeight:'500',
        color:'#FFFFFF',
        letterSpacing:2,
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/order/Trucks.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const TruckList = require('./TruckList');
const BranchList = require('../cargo/BranchList');
const ScanBarCode = require('../../common/ScanBarCode');
const ScanOrderDetail = require('./ScanOrderDetail');
module.exports = React.createClass({
    getInitialState () {
        return {
            tabIndex: 0,
            context:[],
        };
    },
    onWillFocus () {
        app.getCurrentRoute().title = '我的货单';
        app.getCurrentRoute().rightButton = { title: '扫描装车', handler: () => { app.scene.toScan(); } };
        app.getCurrentRoute().leftButton = { title: app.personal.currentShopName, handler: () => { app.scene.toShop(); }, isLimitLength:true };
        app.forceUpdateNavbar();
    },
    componentWillMount(){
        this.getCityDistributeOrders();
    },
    getCityDistributeOrders(){
        const param = {
            userId:app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_CITY_DISTRIBUTE_ORDERS,param,this.getCityDistributeOrdersSuccess,false);
    },
    getCityDistributeOrdersSuccess(data){
        if (data.success) {
            this.setState({ context : data.context });
        }
    },
    onBarCodeRead (data) {
        if (!data || data.type != CONSTANTS.QRCODE_TYPE_ORDER) { // type==1代表货单二维码
            Toast('无效的二维码');
        } else {
            this.carLoading(data.id);
        }
    },
    toScan(){
        app.showModal(<ScanBarCode onBarCodeRead={this.onBarCodeRead.bind( null )} />);
    },
    carLoading(orderId){
        app.push({
            component:ScanOrderDetail,
            passProps:{
                orderId,
            },
        });
    },
    toShop () {
        app.push({
            component:BranchList,
            passProps:{
                onWillFocus:this.onWillFocus,
            },
        });
    },
    selectShop () {
        app.push({
            component:BranchList,
        });
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = [{ name:'待库存', type:'tostore' }, { name:'待装车', type:'stored' }, { name:'运输中', type:'onway' }, { name:'完成', type:'success' }];
        const { tabIndex, context } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item.name}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <TruckList key={i} index={i} type={item.type} tabIndex={tabIndex} data={context && context[item.type]} listUrl={app.route.ROUTE_GET_CITY_DISTRIBUTE_ORDERS} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/AddRoadmap.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
    ScrollView,
} = ReactNative;
const { Button, SelectShortAddress } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '发布路线',
    },
    getInitialState () {
        return {
            endPoint: '',
            endPointLastCode:'',
            status:false,
            price:0,
            minFee:0,
            basePrice:0,
            baseMinFee:0,
        };
    },
    showEndPlace () {
        const { endPointLastCode } = this.state;
        app.push({
            component: SelectShortAddress,
            title:'到货地',
            passProps:{
                parentCode : 520101,
                confirmAddress:(endPoint, endPointLastCode) => {
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    publishRoadmap () {
        const { endPoint, endPointLastCode, price, minFee, basePrice, baseMinFee, status } = this.state;
        if (!endPoint || endPoint == '') {
            Toast('到货地不能为空');
            return;
        } else if (!price || price == '') {
            Toast('短途起价不能为空');
            return;
        } else if (!minFee || minFee == '') {
            Toast('短途单价不能为空');
            return;
        } else if (status) {
            if (!basePrice || basePrice == '') {
                Toast('短途起价保底不能为空');
                return;
            } else if (!baseMinFee || baseMinFee == '') {
                Toast('短途单价保底不能为空');
                return;
            }
        }
        const param = {
            userId:app.personal.info.userId,
            shopId:app.personal.currentShopId,
            endPoint,
            endPointLastCode,
            price,
            minFee,
            basePrice,
            baseMinFee,
            isCityDistribute:true,
        };
        POST(app.route.ROUTE_PUBLISH_ROADMAP, param, this.publishRoadmapSuccess, true);
    },
    publishRoadmapSuccess (data) {
        if (data.success) {
            Toast('发布路线成功');
            this.props.refreshList();
        } else {
            Toast(data.msg);
        }
    },
    joinRank () {
        this.setState({
            status:!this.state.status,
        });
    },
    render () {
        const { endPoint, status } = this.state;
        return (
            <ScrollView>
                <View style={styles.container}>
                    <View>
                        <View style={styles.itemStart}>
                            <Text style={styles.itemLeft}>始发地</Text>
                            <View style={styles.itemPoint}>
                                <Text style={styles.itemRightStart}
                                    numberOfLines={1}
                                    ellipsizeMode='tail'>{(app.utils.getVisibleText(app.personal.currentShopAddress + app.personal.currentShopName, 50))}</Text>
                            </View>
                        </View>
                        <TouchableOpacity
                            activeOpacity={0.6}
                            onPress={this.showEndPlace}>
                            <View style={styles.item}>
                                <Text style={styles.itemLeft}>到货地</Text>
                                <View style={styles.itemPoint}>
                                    <Text style={styles.itemRight}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{endPoint}</Text>
                                    <Image
                                        source={app.img.common_go}
                                        style={styles.goStyle} />
                                </View>
                            </View>
                        </TouchableOpacity>
                    </View>
                    <View style={styles.list}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>短途单价</Text>
                            <TextInput style={styles.roadInfo}
                                underlineColorAndroid='transparent'
                                keyboardType='numeric'
                                placeholder='请输入短途单价'
                                onChangeText={(text) => this.setState({ price: text })} />
                            <Text style={styles.itemEnd}>元/吨</Text>
                        </View>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>短途起价</Text>
                            <TextInput style={styles.roadInfo}
                                underlineColorAndroid='transparent'
                                keyboardType='numeric'
                                placeholder='请输入短途起价'
                                onChangeText={(text) => this.setState({ minFee: text })} />
                            <Text style={styles.itemEnd}>元/票</Text>
                        </View>
                        <View style={styles.list}>

                            <TouchableOpacity onPress={this.joinRank}>
                                <View style={styles.item}>
                                    {
                                        status ? <Image style={styles.imgChoose} source={app.img.order_choose_r} /> : <Image style={styles.imgChoose} source={app.img.order_no_choose_r} />
                                }
                                    <Text style={styles.itemLeft}>智能排名保底价设置</Text>
                                </View>
                            </TouchableOpacity>

                            {
                            status ? <View>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>短途单价保底</Text>
                                    <TextInput style={styles.roadInfo}
                                        underlineColorAndroid='transparent'
                                        placeholder='请输入短途单价保底'
                                        keyboardType='numeric'
                                        onChangeText={(text) => this.setState({ basePrice: text })} />
                                    <Text style={styles.itemEnd}>元/吨</Text>
                                </View>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>短途起价保底</Text>
                                    <TextInput style={styles.roadInfo}
                                        underlineColorAndroid='transparent'
                                        placeholder='请输入短途起价保底'
                                        keyboardType='numeric'
                                        onChangeText={(text) => this.setState({ baseMinFee: text })} />
                                    <Text style={styles.itemEnd}>元/票</Text>
                                </View>
                            </View> : <Text />
                    }
                            <Button style={styles.btnpublishRoadmap}
                                textStyle={styles.btnpublishRoadmapFont}
                                onPress={this.publishRoadmap}>发布路线</Button>
                        </View>
                    </View>
                </View>
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    itemStart:{
        height:40,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemLeft:{
        flex:1,
        paddingLeft:12,
        fontSize:14,
        color:'#333333',
    },
    itemPoint:{
        flexDirection: 'row',
    },
    itemRightStart:{
        fontSize:14,
        color:'#888888',
        width:sr.w / 3 * 2,
        textAlign:'right',
        paddingRight:5,
    },
    itemRight:{
        fontSize:14,
        color:'#333333',
        width:sr.w / 3 * 2,
        textAlign:'right',
        paddingRight:5,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 12,
    },
    item:{
        height:45,
        marginTop:1,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    list:{
        marginTop:7,
    },
    roadInfo:{
        flex:1,
        textAlign:'right',
        fontSize:14,
        padding: 0,
    },
    itemEnd:{
        fontSize:14,
        marginRight:10,
        marginLeft:5,
    },
    imgChoose:{
        width:14,
        height:14,
        marginLeft:12,
    },
    btnpublishRoadmap:{
        width:351,
        backgroundColor:'#c61a29',
        height:45,
        borderRadius:4,
        alignSelf:'center',
        marginTop:20,
    },
    btnpublishRoadmapFont:{
        fontWeight:'400',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/ModifyPrice.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

import _ from 'lodash';

const { Button, CustomSheet } = COMPONENTS;
const Ranking = require('./Ranking');

const PriceType = {
    LONG:0,
    LONG_START:1,
};
const ChangeType = {
    PRICE:0,
    PERCENT:1,
    RANK:2,
};
module.exports = React.createClass({
    statics: {
        title: '调价',
    },
    getInitialState () {
        return {
            price: '',
            type: [],
            change: ChangeType.PRICE,
            add: false,
            sub: false,
            ranking:0,
            changePrice:0,
            actionSheetVisible:false,
        };
    },
    toLongStart () {
        const { type } = this.state;
        if (_.findIndex(type, (o) => o == PriceType.LONG_START) == -1) {
            type.push(PriceType.LONG_START);
            this.setState({ type });
        } else {
            this.setState({ type: _.reject(type, o => o == PriceType.LONG_START) });
        }
    },
    toLongPrice () {
        const { type } = this.state;
        if (_.findIndex(type, (o) => o == PriceType.LONG) == -1) {
            type.push(PriceType.LONG);
            this.setState({ type });
        } else {
            this.setState({ type: _.reject(type, o => o == PriceType.LONG) });
        }
    },
    toAdd () {
        this.setState({
            add: true,
            sub: false,
        });
    },
    toSub () {
        this.setState({
            add: false,
            sub: true,
        });
    },
    toChangePrice () {
        this.setState({
            change: ChangeType.PRICE,
            add: false,
            sub: false,
            price: '',
        });
    },
    toChangePercent () {
        this.setState({
            change: ChangeType.PERCENT,
            add: false,
            sub: false,
            price: '',
        });
    },
    toChangeRanking () {
        this.setState({
            change: ChangeType.RANK,
            add: false,
            sub: false,
        });
    },
    toRanking () {
        this.setState({ actionSheetVisible: true });
    },
    doClose () {
        this.setState({ actionSheetVisible: false });
    },
    toFirst () {
        this.setState({
            ranking: 1,
            actionSheetVisible: false,
        });
    },
    toSecond () {
        this.setState({
            ranking: 2,
            actionSheetVisible: false,
        });
    },
    toThird () {
        this.setState({
            ranking: 3,
            actionSheetVisible: false,
        });
    },
    toFourth () {
        this.setState({
            ranking: 4,
            actionSheetVisible: false,
        });
    },
    doConfirmChange () {
        const { type, change, price, ranking, add, sub } = this.state;
        const { userId, roadmapId } = this.props;
        if (type.length == 0) {
            Toast('请选择需要调价的类型');
            return;
        }
        if (change == ChangeType.UNKNOW) {
            Toast('请选择需要调价的模式');
            return;
        }
        if (change == ChangeType.RANK && ranking == 0) {
            Toast('请选择需要调整的名次');
            return;
        }
        if (add == false && sub == false && ranking == 0) {
            Toast('请选择上调还是下调或者排名');
            return;
        }
        if ((price == null || price == '') && change == ChangeType.PRICE) {
            Toast('请输入需要调整的价格');
            return;
        }
        if ((price == null || price == '') && change == ChangeType.PERCENT) {
            Toast('请输入需要调整的百分比');
            return;
        }
        var value = 0;
        if (change != ChangeType.RANK && change != ChangeType.UNKNOW) {
            if (sub) {
                value = -parseInt(price);
            } else {
                value = parseInt(price);
            }
        } else {
            value = ranking;
        }
        const param = {
            userId: userId,                           // 用户Id
            roadmapIdList: roadmapId,                 // 路线Id列表
            typeList: type,                         // 修改类型列表（0：短途运费单价 1：短途运费起价 ）
            mode: change,                             // 修改模式 （0: 按照价格调整 1: 按照百分比调整 2: 按照名次调整）
            value,                                    // 修改量（如果mode为0和1时，正数为增加，负数为减少）
        };
        POST(app.route.ROUTE_SET_ROADMAP_PRICE, param, this.doSetRoadmapPriceSuccess, true);
    },
    doSetRoadmapPriceSuccess (data) {
        if (data.success) {
            Toast('修改成功');
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { change, type, add, sub, ranking, actionSheetVisible, price } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.typeContainer}>
                    <View style={styles.typeTop}>
                        <TouchableOpacity onPress={this.toLongPrice}
                            style={styles.toChooseFirst}>
                            <Image style={styles.btnImage}
                                source={_.find(type, o => o == PriceType.LONG) == PriceType.LONG ?
                                    app.img.order_choose_r : app.img.order_no_choose_r} />
                            <Text style={styles.itemText}>短途单价</Text>
                        </TouchableOpacity>
                        <TouchableOpacity onPress={this.toLongStart}
                            style={styles.toChoose}>
                            <Image style={styles.btnImage}
                                source={_.find(type, o => o == PriceType.LONG_START) == PriceType.LONG_START
                                    ? app.img.order_choose_r : app.img.order_no_choose_r} />
                            <Text style={styles.itemText}>短途起价</Text>
                        </TouchableOpacity>
                    </View>
                </View>
                <View style={styles.priceChange}>
                    <TouchableOpacity onPress={this.toChangePrice}
                        style={[styles.itemChange, change == 0 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 0 ? { color:'#FFFFFF' } : {}]}>按价格调整</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.toChangePercent}
                        style={[styles.itemChange, change == 1 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 1 ? { color:'#FFFFFF' } : {}]}>按百分比调整</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.toChangeRanking}
                        style={[styles.itemChange, change == 2 ? { backgroundColor:'#c91521' } : {}]}>
                        <Text style={[styles.changeText, change == 2 ? { color:'#FFFFFF' } : {}]}>按排名调整</Text>
                    </TouchableOpacity>
                </View>
                <View style={styles.priceNumber}>
                    {
                        (change == 1 || change == 0) ?
                            <View style={styles.bottomLeft}>
                                <TouchableOpacity onPress={this.toAdd}
                                    style={styles.priceAdd}>
                                    <Image style={styles.chooseImage}
                                        source={add ? app.img.order_choose : app.img.order_no_choose} />
                                    <Text style={styles.priceAddText}>上调</Text>
                                </TouchableOpacity>
                                <TouchableOpacity onPress={this.toSub}
                                    style={styles.priceSub}>
                                    <Image style={styles.chooseImage}
                                        source={sub ? app.img.order_choose : app.img.order_no_choose} />
                                    <Text style={styles.priceAddText}>下调</Text>
                                </TouchableOpacity>
                            </View>
                        :
                            <View />
                    }
                    {
                        change == 0 ?
                            <View style={styles.priceInput}>
                                <TextInput
                                    onChangeText={(text) => this.setState({ price: text })}
                                    multiline={false}
                                    style={styles.bottomRight}
                                    placeholder={'请输入需要修改的价格'}
                                    autoCapitalize={'none'}
                                    underlineColorAndroid={'transparent'}
                                    defaultValue={price}
                                />
                                <Text style={styles.bottomRightText}>元</Text>
                            </View>
                        :
                        change == 1 ?
                            <View style={styles.priceInput}>
                                <TextInput
                                    onChangeText={(text) => this.setState({ price: text })}
                                    multiline={false}
                                    style={styles.bottomRight}
                                    placeholder={'请输入需要修改的百分比'}
                                    defaultValue={price}
                                    autoCapitalize={'none'}
                                    underlineColorAndroid={'transparent'}
                                />
                                <Text style={styles.bottomRightText}>%</Text>
                            </View>
                        :
                        change == 2 ?
                            <View style={styles.priceInput}>
                                <TouchableOpacity onPress={this.toRanking}>
                                    <Text style={styles.bottomRightText}>
                                        {ranking == 1 ?
                                        '第一名' : ranking == 2 ?
                                        '第二名' : ranking == 3 ?
                                        '第三名' : ranking == 4 ?
                                        '第四名' : '请选择排名'}
                                    </Text>
                                </TouchableOpacity>
                            </View>
                            :
                            <View />
                        }
                </View>
                <Button onPress={this.doConfirmChange}
                    style={styles.btnConfirmChange}
                    textStyle={styles.btnConfirmChangeText}>
                        确认调价
                    </Button>
                <CustomSheet
                    visible={actionSheetVisible}>
                    <Ranking doClose={this.doClose}
                        toFirst={this.toFirst}
                        toSecond={this.toSecond}
                        toThird={this.toThird}
                        toFourth={this.toFourth} />
                </CustomSheet>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    typeContainer:{
        height:40,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
    },
    typeTop:{
        flexDirection: 'row',
        alignItems:'center',
    },
    toChooseFirst:{
        flexDirection: 'row',
        alignItems:'center',
    },
    toChoose:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:30,
    },
    btnImage:{
        height:16,
        width:16,
        marginLeft:10,
    },
    itemText:{
        fontSize:14,
        color:'#333333',
        marginLeft:5,
    },
    typeBottom:{
        flexDirection: 'row',
        alignItems:'center',
        marginTop:7,
    },
    priceChange:{
        height:40,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        alignItems:'center',
        justifyContent:'space-around',
        marginTop:10,
    },
    itemChange:{
        height:20,
        width:100,
        backgroundColor:'#f3f3f3',
    },
    changeText:{
        fontSize:12,
        color:'#333333',
        textAlign:'center',
        height:20,
        lineHeight:18,
    },
    priceNumber:{
        height:40,
        backgroundColor:'#FFFFFF',
        marginTop:1,
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    bottomLeft:{
        flexDirection: 'row',
        alignItems:'center',
        height:40,
    },
    priceAdd:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:10,
    },
    chooseImage:{
        height:9,
        width:9,
    },
    priceAddText:{
        fontSize:14,
        color:'#333333',
        marginLeft:5,
    },
    priceSub:{
        flexDirection: 'row',
        alignItems:'center',
        marginLeft:20,
    },
    priceInput:{
        flexDirection: 'row',
        alignItems:'center',
    },
    bottomRight:{
        height:40,
        width:sr.w / 2,
        fontSize:12,
        color: '#444444',
        textAlign:'right',
    },
    bottomRightText:{
        fontSize:13,
        color:'#333333',
        marginRight:15,
        marginLeft:3,
    },
    btnConfirmChange:{
        height:40,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        marginTop:250,
        borderRadius:4,
    },
    btnConfirmChangeText:{
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/Ranking.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '',
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.containerTop}>
                    <Text style={styles.textTop}>名次</Text>
                    <TouchableOpacity onPress={this.props.doClose}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.common_close}
                            style={styles.closeStyle} />
                    </TouchableOpacity>
                </View>
                <View style={styles.line} />
                <TouchableOpacity onPress={this.props.toFirst}
                    style={styles.rankingStyleTop}>
                    <Text>第一名</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.toSecond}
                    style={styles.rankingStyle}>
                    <Text>第二名</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.toThird}
                    style={styles.rankingStyle}>
                    <Text>第三名</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={this.props.toFourth}
                    style={styles.rankingStyle}>
                    <Text>第四名</Text>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#fafafa',
    },
    containerTop:{
        height:40,
        backgroundColor:'#ffffff',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textTop:{
        fontSize:17,
        marginLeft:(sr.w - 17 * 2) / 2,
        color:'#333333',
    },
    closeStyle:{
        height:30,
        width:30,
    },
    line:{
        height:1,
        backgroundColor:'#ededed',
    },
    rankingStyleTop:{
        height:40,
        backgroundColor:'#FFFFFF',
        justifyContent:'center',
        marginLeft:10,
    },
    rankingStyle:{
        height:40,
        backgroundColor:'#FFFFFF',
        marginTop:1,
        justifyContent:'center',
        marginLeft:10,
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/ReceivePointMarketResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const RoadmapMarketList = require('./RoadmapMarketList');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['长途单价', '送货上门单价', '时间最短'];
        const { tabIndex } = this.state;
        const { info, data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <RoadmapMarketList key={i} index={i} tabIndex={tabIndex} info={info} data={data.agent || []} listName={'agent'} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/RoadmapDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    ScrollView,
    Image,
    TouchableOpacity,
} = ReactNative;
const { Button, SelectStartPointAddress, SelectShortAddress } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '路线详情',
    },
    componentWillMount () {
        this.getRoadmapDetail();
    },
    getInitialState () {
        return {
            startInfo:'',
            endPoint: '',
            endPointLastCode:'',
            enable:false,
            price:'',
            minFee:'',
            basePrice:0,
            baseMinFee:0,
        };
    },
    showStartPlace () {
        const { startInfo } = this.state;
        app.push({
            component: SelectStartPointAddress,
            passProps:{
                endPointLastCode:startInfo.startPointLastCode,
                id:startInfo.shopId || startInfo.agentId,
                confirmAddress:(obj) => {
                    this.setState({ startInfo:obj });
                },
            },
        });
    },
    showEndPlace () {
        const { endPointLastCode, startInfo } = this.state;
        app.push({
            component: SelectShortAddress,
            title:'到货地',
            passProps:{
                endPointLastCode,
                parentCode : startInfo.startPointLastCode,
                confirmAddress:(endPoint, endPointLastCode) => {
                    this.setState({ endPoint, endPointLastCode });
                },
            },
        });
    },
    getRoadmapDetail () {
        const id = this.props.roadmapId;
        const param = {
            roadmapId:id,
        };
        POST(app.route.ROUTE_GET_SHIPPER_ROADMAP_DETAIL, param, this.getRoadmapDetailSuccess, true);
    },
    getRoadmapDetailSuccess (data) {
        if (data.success) {
            const obj = data.context;
            this.setState({
                startInfo:{ startPoint:obj.startPoint, id:obj.shop ? obj.shop.id : obj.agent ? obj.agent.id : '' },
                endPoint: obj.endPoint,
                endPointLastCode:obj.endPointLastCode,
                price:obj.price,
                minFee:obj.minFee + '',
                basePrice:obj.basePrice == null ? 0 : obj.basePrice,
                baseMinFee:obj.baseMinFee == null ? 0 : obj.baseMinFee,
                enable:obj.enable,
            });
        } else {
            Toast(data.msg);
        }
    },
    doMadifyRoadmap () {
        const id = this.props.roadmapId;
        const { endPoint, endPointLastCode, enable, price, minFee, basePrice, baseMinFee } = this.state;
        const param = {
            userId:app.personal.info.userId,
            roadmapId:id,
            endPoint,
            endPointLastCode,
            price,
            basePrice,
            minFee,
            baseMinFee,
            enable,
        };
        POST(app.route.ROUTE_MODIFY_ROADMAP, param, this.doMadifyRoadmapSuccess, true);
    },
    doMadifyRoadmapSuccess (data) {
        if (data.success) {
            Toast('修改成功');
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    onLine () {
        this.setState({ enable:!this.state.enable });
    },
    render () {
        const { startInfo, endPoint, enable, price, minFee, basePrice, baseMinFee } = this.state;
        return (
            <ScrollView>
                <View style={styles.container}>
                    <View>
                        <TouchableOpacity
                            activeOpacity={0.6}
                            onPress={this.showStartPlace}>
                            <View style={styles.itemStart}>
                                <Text style={styles.itemLeft}>始发地</Text>
                                <View style={styles.itemPoint}>
                                    <Text style={styles.itemRightStart}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{(app.utils.getVisibleText(app.personal.currentShopAddress + app.personal.currentShopName, 50))}</Text>
                                </View>
                            </View>
                        </TouchableOpacity>
                        <TouchableOpacity
                            activeOpacity={0.6}
                            onPress={this.showEndPlace}>
                            <View style={styles.item}>
                                <Text style={styles.itemLeft}>到货地</Text>
                                <View style={styles.itemPoint}>
                                    <Text style={styles.itemRight}
                                        numberOfLines={1}
                                        ellipsizeMode='tail'>{endPoint}</Text>
                                    <Image
                                        source={app.img.common_go}
                                        style={styles.goStyle} />
                                </View>
                            </View>
                        </TouchableOpacity>
                    </View>
                    <View style={styles.list}>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>短途起价</Text>
                            <TextInput style={styles.roadInfo}
                                underlineColorAndroid='transparent'
                                placeholder='请输入短途起价'
                                onChangeText={(text) => this.setState({ minFee: text })}
                                defaultValue={app.utils.N(minFee * 1) + ''} />
                            <Text style={styles.itemEnd}>元</Text>
                        </View>
                        <View style={styles.item}>
                            <Text style={styles.itemLeft}>短途单价/吨</Text>
                            <TextInput style={styles.roadInfo}
                                underlineColorAndroid='transparent'
                                placeholder='请输入短途单价'
                                onChangeText={(text) => this.setState({ price: text })}
                                defaultValue={app.utils.N(price * 1) + ''} />
                            <Text style={styles.itemEnd}>元</Text>
                        </View>
                        <View style={styles.list}>
                            <View>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>短途起价保底</Text>
                                    <TextInput style={styles.roadInfo}
                                        underlineColorAndroid='transparent'
                                        placeholder='请输入短途起价保底'
                                        onChangeText={(text) => this.setState({ baseMinFee: text })}
                                        defaultValue={app.utils.N(baseMinFee * 1) + ''} />
                                    <Text style={styles.itemEnd}>元</Text>
                                </View>
                                <View style={styles.item}>
                                    <Text style={styles.itemLeft}>短途单价保底/吨</Text>
                                    <TextInput style={styles.roadInfo}
                                        underlineColorAndroid='transparent'
                                        placeholder='请输入短途单价保底'
                                        onChangeText={(text) => this.setState({ basePrice: text })}
                                        defaultValue={app.utils.N(basePrice * 1) + ''} />
                                    <Text style={styles.itemEnd}>元</Text>
                                </View>
                            </View>
                            <TouchableOpacity onPress={this.onLine}>
                                <View style={styles.item}>
                                    {
                                        enable ? <Image style={styles.imgChoose} source={app.img.order_choose_r} /> : <Image style={styles.imgChoose} source={app.img.order_no_choose_r} />
                                }
                                    <Text style={styles.itemLeft}>是否上线</Text>
                                </View>
                            </TouchableOpacity>
                            <Button onPress={this.doMadifyRoadmap} style={styles.btn} textStyle={styles.btnFont}>确认修改</Button>
                        </View>
                    </View>
                </View>
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    itemStart:{
        height:40,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    itemLeft:{
        flex:1,
        paddingLeft:12,
        fontSize:14,
        color:'#333333',
    },
    itemPoint:{
        flexDirection: 'row',
    },
    itemRightStart:{
        fontSize:14,
        color:'#888888',
        width:sr.w / 3 * 2,
        textAlign:'right',
        paddingRight:10,
    },
    itemRight:{
        fontSize:14,
        color:'#333333',
        width:sr.w / 3 * 2,
        textAlign:'right',
        paddingRight:5,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 12,
    },
    item:{
        height:40,
        marginTop:1,
        justifyContent: 'space-between',
        alignItems:'center',
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
    },
    list:{
        marginTop:7,
    },
    roadInfo:{
        flex:1,
        textAlign:'right',
        fontSize:14,
        padding:0,
    },
    itemEnd:{
        fontSize:14,
        marginRight:10,
        marginLeft:5,
    },
    imgChoose:{
        width:14,
        height:14,
        marginLeft:12,
    },
    btnpublishRoadmap:{
        width:351,
        backgroundColor:'#c61a29',
        height:45,
        borderRadius:4,
        alignSelf:'center',
        position:'absolute',
        top:250,
    },
    btnpublishRoadmapFont:{
        fontWeight:'400',
    },
    btn:{
        width:351,
        height:45,
        marginTop:18,
        borderRadius:4,
        alignSelf:'center',
        backgroundColor:'#FE9917',
    },
    btnFont:{
        fontWeight:'400',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/RoadmapMarketList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
let km = '';

module.exports = React.createClass({
    renderRow (obj, rowID) {
        if (obj.distance) {
            if (obj.distance > 1) {
                km = parseInt(!obj.distance ? 0 : obj.distance) + 'km';
            } else {
                km = (parseInt(!obj.distance ? 0 : obj.distance) * 1000) + 'm';
            }
        }
        return (
            <View style={styles.row}>
                <View style={styles.rowChild}>
                    <View style={styles.address}>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.shipperName}</Text>
                        <Text style={{ flex:0.3 }}>{'-'}</Text>
                        <Text style={styles.rowChildFont} numberOfLines={1}>{obj.endPoint}</Text>
                    </View>
                    <Text style={styles.rowChildDistance}>距我:{km}</Text>
                </View>
                <View style={styles.itemInfo}>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(obj.price) + '/吨'}</Text>
                        <Text style={styles.rowChildPrice}>运费单价</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildNumber}>￥{app.utils.N(obj.sendDoorPrice) + '/吨'}</Text>
                        <Text style={styles.rowChildTitle}>送货上门</Text>
                    </View>
                    <View style={styles.item}>
                        <Text style={styles.rowChildTime}>{obj.duration}天</Text>
                        <Text style={styles.rowChildTitle}>预计用时</Text>
                    </View>
                </View>
            </View>
        );
    },
    render () {
        const { index, tabIndex, listName, info, data } = this.props;
        return (
            <View style={index === tabIndex ? styles.container : { left:-sr.tw, top:0, position:'absolute' }}>
                {
                    !!data &&
                    <PageList
                        ref={(ref) => { this.listView = ref; }}
                        renderRow={this.renderRow}
                        listParam={{ userId: app.personal.info.userId, orderBy: index, ...info }}
                        listName={listName}
                        list={data}
                        autoLoad={false}
                        listUrl={app.route.ROUTE_GET_ROADMAP_LIST_WITH_END_POINT}
                        refreshEnable
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#F4F4F4',
    },
    row: {
        flex:1,
        paddingVertical: 20,
        paddingHorizontal: 2,
        backgroundColor:'#FFFFFF',
        marginTop:1,
    },
    rowChild:{
        width:sr.w,
        flexDirection:'row',
        marginTop:3,
        marginBottom:3,
    },
    rowChildFont:{
        flex:2,
        fontSize:14,
        marginLeft:5,
        fontWeight:'300',
    },
    rowChildDistance:{
        fontSize:12,
        color:'#FF9D24',
        fontWeight:'300',
        marginRight:5,
        flex:0.5,
    },
    rowChildNumber:{
        color:'#f61525',
        fontSize:15,
        fontWeight:'500',
    },
    rowChildTime:{
        fontSize:16,
        color:'#333333',
    },
    rowChildTitle:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    rowChildPrice:{
        flex:1,
        fontSize:12,
        color:'#333333',
    },
    address:{
        flexDirection:'row',
        flex:1.5,
    },
    itemInfo:{
        flexDirection:'row',
        flex:1,
        alignItems:'center',
        justifyContent:'center',
        marginTop:3,
    },
    item:{
        flex:1,
        alignItems:'center',
        justifyContent:'center',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/RoadmapMarketResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

import { Geolocation } from '@remobile/react-native-baidu-map';

const ShopMarketResult = require('./ShopMarketResult');
const ReceivePointMarketResult = require('./ReceivePointMarketResult');
const BaidumapSelectPosition = require('../../baidumap');
let selectIndex = 0;
const TabTitle = React.createClass({
    getInitialState () {
        return {
            tab: 0,
        };
    },
    render () {
        const { tab } = this.state;
        const tabMenus = this.props.tabMenus ? this.props.tabMenus : [];

        return (
            <View style={styles.tabContainer}>
                {
                tabMenus.map((item, i) => (
                    <TouchableHighlight
                        key={i}
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={() => {
                            selectIndex = i;
                            this.setState({ tab:i });
                            this.props.changeTab();
                        }}
                        style={[styles.touchTab, tab === i ? { backgroundColor:'#E5E5E5' } : { backgroundColor:'#c81622' }]}>
                        <Text style={tab === i ? { color:'#c81622' } : { color:'#E5E5E5' }}>
                            {item}
                        </Text>
                    </TouchableHighlight>
                ))
            }
            </View>
        );
    },
});
module.exports = React.createClass({
    statics: {
        title: (<TabTitle changeTab={() => { app.scene.changeTab(); }} />),
        rightButton: { title: '位置', handler: () => { app.scene.setPosition(); } },
    },
    getInitialState () {
        return {
            tabIndex: 0,
            context: {},
            tabMenus:[],
            mapInfo:{ location:[0, 0], startPoint:'' },
        };
    },
    setPosition () {
        app.push({
            component: BaidumapSelectPosition,
            passProps:{
                confirm:(marker) => {
                    this.setState({ mapInfo:{ startPoint:marker.province + marker.city, location:[marker.longitude, marker.latitude] } }, () => { this.updateRightButton(marker.city); }); ;
                },
            },
        });
    },
    componentDidMount () {
        Geolocation.getCurrentPosition()
            .then(data => {
                console.warn(JSON.stringify(data));
                this.setState({ mapInfo:{ startPoint:data.province + data.city, location:[data.longitude, data.latitude] } }, () => { this.getRoadMaps(data.city); });
            })
            .catch(e => {
                console.warn(e, 'error');
            });
    },
    getRoadMaps (city) {
        this.updateRightButton(city);
        const { mapInfo } = this.state;
        const { endPoint } = this.props;
        const param = {
            userId: app.personal.info.userId,
            orderBy: 0,
            pageNo:0,
            pageSize:10,
            endPoint,
            ...mapInfo,
        };
        POST(app.route.ROUTE_GET_ROADMAP_LIST_WITH_END_POINT, param, this.getRoadMapsSuccess, false);
    },
    getRoadMapsSuccess (data) {
        if (data.success) {
            this.setState({ context:data.context, tabMenus:(!data.context.agent || data.context.agent.length == 0) ? ['物流超市'] : ['物流超市', '揽收点'] }, () => { this.updateTitle(); });
        } else {
            Toast(data.msg);
        }
    },
    updateRightButton (city) {
        app.getCurrentRoute().rightButton = { title:city, handler: () => { this.setPosition(); } };
        app.forceUpdateNavbar();
    },
    updateTitle () {
        app.getCurrentRoute().title = (<TabTitle changeTab={this.changeTab} tabMenus={this.state.tabMenus} />);
        app.forceUpdateNavbar();
    },
    changeTab () {
        this.setState({ tabIndex:selectIndex });
    },
    render () {
        const { tabIndex, mapInfo, context } = this.state;
        const { endPoint } = this.props;
        const info = {
            endPoint,
            ...mapInfo,
        };
        return (
            <View style={styles.container}>
                {
                    tabIndex === 0 ? <ShopMarketResult info={info} data={context} /> : <ReceivePointMarketResult info={info} data={context} />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        height: 30,
        width: 140,
        borderRadius:5,
        borderColor:'white',
        borderWidth:1,
        flexDirection: 'row',
        overflow: 'hidden',
    },
    touchTab: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/ShopMarketResult.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableHighlight,
} = ReactNative;

const RoadmapMarketList = require('./RoadmapMarketList');
module.exports = React.createClass({
    statics: {
        title: '查询结果',
    },
    getInitialState () {
        return {
            tabIndex: 0,
        };
    },
    changeTab (tabIndex) {
        this.setState({ tabIndex });
    },
    render () {
        const menus = ['长途单价', '送货上门单价', '时间最短'];
        const { tabIndex } = this.state;
        const { info, data } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.tabContainer}>
                    {
                        menus.map((item, i) => (
                            <TouchableHighlight
                                key={i}
                                underlayColor='rgba(0, 0, 0, 0)'
                                onPress={this.changeTab.bind(null, i)}
                                style={styles.touchTab}>
                                <View style={styles.tabButton}>
                                    <Text style={[styles.tabText, tabIndex === i ? { color:'#DE3031' } : { color:'#666666' }]} >
                                        {item}
                                    </Text>
                                    <View style={[styles.tabLine, tabIndex === i ? { backgroundColor: '#DE3031' } : null]} />
                                </View>
                            </TouchableHighlight>
                        ))
                    }
                </View>
                {
                    menus.map((item, i) => (
                        <RoadmapMarketList key={i} index={i} info={info} data={data.shop ? data.shop.roadmapList : []} tabIndex={tabIndex} listName={'shop.roadmapList'} />
                    ))
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    tabContainer: {
        width:sr.w,
        flexDirection: 'row',
    },
    touchTab: {
        flex: 1,
        paddingTop: 20,
    },
    tabButton: {
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonCenter: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
    },
    tabButtonRight: {
        flex: 1,
        alignItems:'center',
        justifyContent:'center',
        borderRadius: 9,
    },
    tabText: {
        fontSize: 13,
    },
    tabLine: {
        width: sr.w / 4,
        height: 2,
        marginTop: 10,
        alignSelf: 'center',
    },
});

```

* PDClient/project/App/modules/shortLogisticsCompany/shortroadmap/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button, MessageBox, PageList } = COMPONENTS;
const RoadmapDetail = require('./RoadmapDetail');
const BranchList = require('../cargo/BranchList');
const ModifyPrice = require('./ModifyPrice');
const AddRoadmap = require('./AddRoadmap');
const RoadmapMarketResult = require('./RoadmapMarketResult');

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入路线终点查询路线'
                    defaultValue={searchText}
                    underlineColorAndroid='transparent'
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
    },
    onWillFocus () {
        app.getCurrentRoute().title = (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />);
        app.getCurrentRoute().rightButton = null;
        app.getCurrentRoute().leftButton = { title: app.personal.currentShopName, handler: () => { app.scene.selectShop(); }, isLimitLength:true };
        app.forceUpdateNavbar();
    },
    selectShop () {
        app.push({
            component:BranchList,
            passProps:{
                onWillFocus:this.onWillFocus,
                setCurrentShopId:this.setCurrentShopId,
            },
        });
    },
    setCurrentShopId (id) {
        this.setState({
            shopId:id,
        });
    },
    getInitialState () {
        return {
            userId:app.personal.info.userId,
            keyword: '',
            dataList: [],
            list:[],
            roadmapId:[],
            shopId:app.personal.currentShopId,
        };
    },
    doStartSearch () {
        this.setState({
            keyword:searchText,
        });
    },
    showRoadmapMarket (endPoint) {
        app.push({
            component:RoadmapMarketResult,
            passProps:{
                endPoint,
            },
        });
    },
    showRoadmapDetail (id) {
        app.push({
            component:RoadmapDetail,
            passProps:{
                roadmapId: id,
                refreshList: this.refreshList,
            },
        });
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    doChoose (obj, rowId) {
        const { list } = this.state;
        list[rowId].selected = !list[rowId].selected;
        this.setState({
            list,
        });
    },
    doSelectedAll () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == true)) {
            _.forEach(list, o => { o.selected = false; });
        } else {
            _.forEach(list, o => { o.selected = true; });
        }
        this.setState({
            list,
        });
    },
    toModifyPrice () {
        const { list, userId, roadmapId } = this.state;
        list.forEach((item, i) => {
            item.selected == true && roadmapId.push(item.item.id);
        });
        if (roadmapId.length == 0) {
            Toast('请选择需要调价的路线');
            return;
        }
        app.push({
            component: ModifyPrice,
            passProps: {
                userId,
                roadmapId: _.uniq(roadmapId),
            },
        });
        this.setState({
            roadmapId:[],
        });
    },
    toDeleteRoadmap () {
        const { list } = this.state;
        if (_.every(list, (o) => o.selected == false)) {
            Toast('请选择需要删除的路线');
        } else {
            app.showModal(
                <MessageBox
                    onConfirm={this.doConfirmDelete}
                    content={'是否确定删除所选路线'}
                    onCancel title={false}
                    width={sr.s(250)} />
            );
        }
    },
    delete (id) {
        const param = {
            userId:app.personal.info.userId,
            roadmapId:id,
        };
        let roadmapId = id;
        POST(app.route.ROUTE_REMOVE_ROADMAP, param, this.doConfirmDeleteSuccess.bind(null, roadmapId), false);
    },
    doConfirmDelete () {
        const { list } = this.state;
        list.forEach((item, i) => {
            item.selected == true && this.delete(item.item.id);
        });
    },
    doConfirmDeleteSuccess (roadmapId, data) {
        if (data.success) {
            var list = this.listView.list;
            _.remove(list, function (o) {
                return o.id == roadmapId;
            });
            Toast('路线删除成功');
            this.setState({
                list:[],
            });
        } else {
            Toast('路线删除失败');
        }
    },
    toAddRoadmap () {
            app.push({
                component:AddRoadmap,
                passProps:{
                    refreshList:this.refreshList,
                },
            });
    },
    toOpen () {
        // userId	ID	用户Id
        // roadmapIdList	Array	路线Id列表
        // enable	Boolean	是否上线
        // setRoadmapEnable
        const { list } = this.state;

    },
    toClose () {

    },
    refreshList () {
        this.listView.refresh();
    },
    renderRow (obj, rowId) {
        const { list } = this.state;
        if (!_.find(list, (o) => o.index == rowId)) {
            list.push({ selected:false, index:rowId, item:obj });
        }
        return (
            <View style={styles.item}>
                <View style={styles.rowTop}>
                    <TouchableOpacity
                        onPress={this.doChoose.bind(null, obj, rowId)}>
                        <Image
                            resizeMode='cover'
                            style={styles.imgChoose}
                            source={!list[rowId].selected ? app.img.order_no_choose : app.img.order_choose} />
                    </TouchableOpacity>
                    <TouchableOpacity style={styles.point} onPress={this.showRoadmapDetail.bind(null, obj.id)}>
                        <View style={styles.pointStart}>
                            <Text style={styles.address} numberOfLines={1}>{obj.startPoint}</Text>
                        </View>
                        <Image resizeMode='contain'
                            source={app.img.cargo_point}
                            style={styles.imgLine} />
                        <View style={styles.pointEnd}>
                            <Text style={styles.address} numberOfLines={1}>{obj.endPoint}</Text>
                        </View>
                    </TouchableOpacity>
                    {
                        obj.enable ?
                        <Text style={styles.roadmapStart}>已开通</Text>
                        :
                        <Text style={styles.roadmapStop}>已停运</Text>
                    }
                </View>
                <View style={styles.rowBottom}>
                    <View style={styles.price}>
                        <Text style={styles.priceText}>起价:</Text>
                        <Text style={styles.priceNumber}>{obj.minFee}</Text>
                        <Text style={styles.priceText}>单价:</Text>
                        <Text style={styles.priceNumber}>{obj.price}</Text>
                    </View>
                    <Button style={styles.btnRoadmapShipper}
                        textStyle={styles.btnShipperFont}
                        onPress={this.showRoadmapMarket.bind(null, obj.endPoint)}>
                        路线行情
                    </Button>
                </View>
            </View>
        );
    },
    render () {
        const { list, keyword, shopId } = this.state;
        const status = list.length != 0 && _.every(list, (o) => o.selected == true);
        var number = 0;
        var roadmapList = [];
        list.forEach((item, i) => {
            item.selected == true && number++;
        });
        list.forEach((item, i) => {
            item.selected == true && roadmapList.push({type:item.item.enable,id:item.item.id});
        });
        return (
            <View style={styles.container}>
                <View style={styles.top}>
                        <Button style={styles.btnAddRoadmap}
                            textStyle={styles.btnReleaseFont}
                            onPress={this.toAddRoadmap}>
                            发布短途路线
                        </Button>
                </View>
                <View style={styles.listView} />
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    onGetList={this.onGetList}
                    listName={'roadmapList'}
                    renderSeparator={null}
                    listParam={{ userId: app.personal.info.userId, shopId, keyword, isCityDistribute : true }}
                    listUrl={app.route.ROUTE_GET_ROADMAP_LIST_SHIPPER}
                    refreshEnable
                    />
                <View style={styles.bottom}>
                    <View style={{flexDirection:'row'}}>
                        <TouchableOpacity style={styles.chooseAll} onPress={this.doSelectedAll}>
                            <Image
                                resizeMode='cover'
                                style={styles.imgChoose}
                                source={status ? app.img.order_choose : app.img.order_no_choose} />
                            <Text style={styles.chooseAllFont}>全选</Text>
                        </TouchableOpacity>
                        <Text style={styles.alreadyChoose}>已选{number}条</Text>
                    </View>
                    <View style={{flexDirection:'row',marginRight:8}}>
                        {
                            _.every(roadmapList, (o) => o.type == false) ?
                            <Button
                                style={styles.btnAllOpen}
                                textStyle={styles.btnAllOpenText}>
                                开通
                            </Button>
                            :
                            _.every(roadmapList, (o) => o.type == true) ?
                            <Button
                                style={styles.btnAllClose}
                                textStyle={styles.btnAllCloseText}>
                                停运
                            </Button>
                            :
                            <View style={{flexDirection:'row'}}>
                                <Button
                                    style={styles.btnAllOpen}
                                    textStyle={styles.btnAllOpenText}>
                                    开通
                                </Button>
                                <Button
                                    style={styles.btnAllClose}
                                    textStyle={styles.btnAllCloseText}>
                                    停运
                                </Button>
                            </View>
                        }
                        <Button onPress={this.toDeleteRoadmap}
                            style={styles.btnDelete}
                            textStyle={styles.btnDeleteFont}>删除</Button>
                        <Button onPress={this.toModifyPrice}
                            style={styles.btnModifyPrice}
                            textStyle={styles.btnModifyPriceFont}>调价</Button>
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
    },
    searchContainer: {
        height: 30,
        width: sr.w - 125,
        marginLeft:sr.w - 300,
        paddingVertical: 2,
        borderRadius: 4,
        backgroundColor: '#FFFFFF',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        padding:0,
        height: 25,
        width: sr.w - 155,
        fontSize: 14,
        marginLeft: 5,
    },
    iconSearch: {
        height: 15,
        width: 15,
        marginLeft:5,
    },
    top:{
        height:80,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    btnAddRoadmap:{
        width:150,
        height:35,
        borderRadius:4,
        backgroundColor:'#fe9917',
    },
    btnReleaseFont:{
        color:'#FFFFFF',
        fontWeight:'400',
    },
    listView:{
        marginTop:8,
    },
    rowTop:{
        height:42,
        flexDirection:'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        marginTop:3,
    },
    rowBottom:{
        marginTop:1,
        height:30,
        backgroundColor:'#FFFFFF',
    },
    price:{
        flexDirection:'row',
        height:30,
        alignItems:'center',
    },
    priceText:{
        marginLeft:8,
        fontSize:12,
        color:'#333333',
    },
    priceNumber:{
        fontSize:12,
        color:'#f01725',
    },
    imgChoose:{
        marginLeft:5,
        width:13,
        height:13,
    },
    imgLine:{
        marginLeft:10,
        width:35,
    },
    pointStart:{
        marginLeft:8,
        width:105,
        justifyContent:'center',
        alignItems:'center',
    },
    pointEnd:{
        marginLeft:8,
        width:115,
        justifyContent:'center',
        alignItems:'center',
    },
    address:{
        fontSize:14,
    },
    roadmapStart:{
        fontSize:14,
        color:'#50c248',
        right:(sr.w - 355) / 2,
    },
    roadmapStop:{
        fontSize:14,
        color:'#f01725',
        right:(sr.w - 355) / 2,
    },
    btnOpen:{
        marginTop:5,
        width:50,
        height:20,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#50c248',
        position:'absolute',
        right:(sr.w - 70) / 2,
    },
    btnOpenText:{
        color:'#50c248',
        fontSize:12,
    },
    btnClose:{
        marginTop:5,
        width:50,
        height:20,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f01725',
        position:'absolute',
        right:(sr.w - 195) / 2,
    },
    btnRoadmapShipper:{
        marginTop:5,
        width:65,
        height:20,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f01725',
        position:'absolute',
        right:(sr.w - 350) / 2,
    },
    btnShipperFont:{
        color:'#f01725',
        fontSize:12,
    },
    bottom:{
        height:50,
        width:sr.w,
        flexDirection: 'row',
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'space-between',
    },
    btnAllOpen:{
        marginLeft:9,
        width:50,
        height:25,
        backgroundColor:'#FFFFFF',
        borderColor:'#50c248',
        borderWidth:0.5,
        borderRadius:2,
    },
    btnAllOpenText:{
        color:'#50c248',
        fontSize:14,
    },
    btnAllCloseText:{
        color:'#f01725',
        fontSize:14,
    },
    btnAllClose:{
        marginLeft:9,
        width:50,
        height:25,
        backgroundColor:'#FFFFFF',
        borderColor:'#f01725',
        borderWidth:0.5,
        borderRadius:2,
    },
    btnDelete:{
        marginLeft:9,
        width:50,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
    },
    btnDeleteFont:{
        color:'#343434',
        fontSize:13,
        fontWeight:'400',
    },
    btnModifyPrice:{
        marginLeft:9,
        width:50,
        height:25,
        backgroundColor:'#FFFFFF',
        borderWidth:0.5,
        borderRadius:2,
        borderColor:'#f21620',
    },
    btnModifyPriceFont:{
        color:'#f21620',
        fontSize:13,
        fontWeight:'400',
    },
    chooseAllFont:{
        fontSize:13,
        marginLeft:8,
    },
    alreadyChoose:{
        fontSize:12,
        marginLeft:5,
        marginTop:1,
    },
    chooseAll:{
        alignItems:'center',
        flexDirection:'row',
    },
    point:{
        flex:1,
        flexDirection:'row',
    },
});

```

* PDDriver/project/App/index.js

```js
'use strict';

console.disableYellowBox = true;

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Platform,
    BackAndroid,
    View,
    Text,
    Image,
    StatusBar,
} = ReactNative;

const CustomComponents = require('react-native-deprecated-custom-components');
global.Navigator = CustomComponents.Navigator;
global._ = require('lodash');
global.sr = require('./config/Screen');
const COLOR = require('./config/Color');
global._c = COLOR._c;
global._bc = COLOR._bc;
global._tc = COLOR._tc;
global.Toast = require('@remobile/react-native-toast').show;
global.CONSTANTS = require('./config/Constants');
const Utils = require('./utils');
global.POST = Utils.POST;
global.GET = Utils.GET;
global.UPLOAD = Utils.UPLOAD;
global.COMPONENTS = require('./components/index');
const TimerMixin = require('react-timer-mixin');

const Route = require('./config/Route');
const img = require('./resource/image');
const aud = require('./resource/audio');
const PersonalInfoMgr = require('./manager/PersonalInfoMgr');
const UpdateMgr = require('./manager/UpdateMgr');
const SettingMgr = require('./manager/SettingMgr');
const LoginMgr = require('./manager/LoginMgr');
const JpushMgr = require('./manager/JpushMgr');
const { ProgressHud, DelayTouchableOpacity, Modal } = COMPONENTS;

global.app = {
    route: Route,
    utils: Utils,
    img: img,
    aud: aud,
    data: {},
    personal: PersonalInfoMgr,
    setting: SettingMgr,
    updateMgr:UpdateMgr,
    login: LoginMgr,
    jpush: JpushMgr,
    isandroid: Platform.OS === 'android',
};

global.SceneMixin = {
    componentWillMount () {
        app.scene = this;
    },
    onWillFocus () {
        app.scene = this;
    },
};

app.configureScene = function (route) {
    route = route || {};
    let sceneConfig = route.sceneConfig;
    if (sceneConfig) {
        return sceneConfig;
    }
    if (Platform.OS === 'android') {
        if (route.fromLeft) {
            sceneConfig = { ...Navigator.SceneConfigs.FloatFromLeft, gestures: null };
        } else {
            sceneConfig = Navigator.SceneConfigs.FadeAndroid;
        }
    } else {
        if (route.fromLeft) {
            sceneConfig = { ...Navigator.SceneConfigs.FloatFromLeft, gestures: null };
        } else {
            sceneConfig = { ...Navigator.SceneConfigs.HorizontalSwipeJump, gestures: null };
        }
    }
    return sceneConfig;
};

const Splash = require('./modules/splash/index');

const NavigationBarRouteMapper = {
    LeftButton (route, navigator, index, navState) {
        let leftButton = route.leftButton || route.component.leftButton;
        if (index === 0 && !leftButton) {
            return null;
        }
        if (typeof leftButton === 'function') {
            leftButton = leftButton();
        }
        const image = leftButton && leftButton.image || app.img.common_back;
        const title = leftButton && leftButton.title || '';
        const handler = leftButton && leftButton.handler || navigator.pop;
        if (image && !title) {
            return (
                <DelayTouchableOpacity
                    onPress={handler}
                    style={styles.navBarButton}>
                    <Image
                        resizeMode='stretch'
                        source={image}
                        style={styles.navBarIcon} />
                </DelayTouchableOpacity>
            );
        } else {
            return (
                <DelayTouchableOpacity
                    onPress={handler}
                    style={styles.navBarButton}>
                    <Text style={styles.navBarButtonText}>
                        {leftButton.title}
                    </Text>
                </DelayTouchableOpacity>
            );
        }
    },
    RightButton (route, navigator, index, navState) {
        let rightButton = route.rightButton || route.component.rightButton;
        if (typeof rightButton === 'function') {
            rightButton = rightButton();
        }
        if (!rightButton) {
            return <View style={styles.navBarRightEmptyButton} />;
        }
        if (rightButton.image) {
            return (
                <DelayTouchableOpacity
                    onPress={rightButton.handler}
                    style={styles.navBarButton}>
                    <Image
                        resizeMode='stretch'
                        source={rightButton.image}
                        style={styles.navBarIcon} />
                </DelayTouchableOpacity>
            );
        } else {
            return (
                <DelayTouchableOpacity
                    onPress={rightButton.handler}
                    style={styles.navBarButton}>
                    <Text style={styles.navBarButtonText}>
                        {rightButton.title}
                    </Text>
                </DelayTouchableOpacity>
            );
        }
    },
    Title (route, navigator, index, navState) {
        const title = route.title || route.component.title;
        if (typeof title === 'function') {
            return (
                <View style={styles.titleContainer}>
                    <Text
                        numberOfLines={1}
                        style={styles.navBarTitleText}>
                        {title()}
                    </Text>
                </View>
            );
        } else if (typeof title === 'string') {
            return (
                <View style={styles.titleContainer}>
                    <Text
                        numberOfLines={1}
                        style={styles.navBarTitleText}>
                        {title}
                    </Text>
                </View>
            );
        } else {
            return (
                <View style={styles.titleContainer}>
                    {title}
                </View>
            );
        }
    },
};

module.exports = React.createClass({
    mixins: [TimerMixin],
    getInitialState () {
        return {
            showNavBar: false,
            modalShow: false,
            modalContent: null,
            modalBackgroundColor: null,
            modalTouchHide: false,
        };
    },
    componentWillMount () {
        // if (!app.isandroid) {
        //     NativeModules.AccessibilityManager.setAccessibilityContentSizeMultipliers({
        //         'extraSmall': 1,
        //         'small': 1,
        //         'medium': 1,
        //         'large': 1,
        //         'extraLarge': 1,
        //         'extraExtraLarge': 1,
        //         'extraExtraExtraLarge': 1,
        //         'accessibilityMedium': 1,
        //         'accessibilityLarge': 1,
        //         'accessibilityExtraLarge': 1,
        //         'accessibilityExtraExtraLarge': 1,
        //         'accessibilityExtraExtraExtraLarge': 1,
        //     });
        // }
        app.root = this;
        app.showLoading = () => {
            this.refs.progressHud.show();
        };
        app.hideLoading = () => {
            this.refs.progressHud.hide();
        };
        StatusBar.setBackgroundColor('transparent');
        StatusBar.setTranslucent(true);
        app.showModal = (view, options = {}) => {
            const { backgroundColor, touchHide } = options;
            this.setState({
                modalShow: true,
                modalContent: view,
                modalBackgroundColor: backgroundColor,
                modalTouchHide: touchHide,
            });
        };
        app.closeModal = () => {
            this.refs.modal.closeModal();
        };
        app.removeModal = () => {
            this.setState({
                modalShow: false,
            });
        };
        app.update = () => {
            this.setState({});
        };
        app.forceUpdateNavbar = () => {
            this.setState({
                showNavBar: true,
            });
        };
        app.toggleNavigationBar = (show) => {
            this.setImmediate(() => {
                this.setState({ showNavBar:show });
            });
        };
        app.getCurrentRoute = (index = 0) => {
            const { routeStack, presentedIndex } = app.navigator.state;
            return routeStack[presentedIndex - index];
        };
        app.push = (params) => {
            app.navigator.push(params);
        };
        app.pop = (step = 1) => {
            if (step === 1) {
                app.navigator.pop();
            } else {
                const routes = app.navigator.getCurrentRoutes();
                const index = routes.length - step - 1;
                if (index > 0) {
                    app.navigator.popToRoute(routes[index]);
                } else {
                    app.navigator.popToTop();
                }
            }
        };
        if (app.isandroid) {
            BackAndroid.addEventListener('hardwareBackPress', () => {
                if (this.state.is_hud_visible) {
                    this.setState({ is_hud_visible: false });
                    return true;
                }
                if (this.state.modalShow) {
                    this.setState({ modalShow: false });
                    return true;
                }
                const routes = app.navigator.getCurrentRoutes();
                if (routes.length > 1) {
                    const leftButton = routes[routes.length - 1].component.leftButton;
                    if (leftButton && leftButton.handler) {
                        leftButton.handler();
                    } else {
                        app.pop();
                    }
                    return true;
                }
                if (!this.willExitAndroid) {
                    Toast('再按一次返回键退出程序');
                    this.willExitAndroid = true;
                    this.setTimeout(() => { this.willExitAndroid = false; }, 3000);
                    return true;
                }
                return false;
            });
        }
    },
    componentDidMount: function () {
        // app.net.register();
        app.jpush.register();
    },
    configureScene (route) {
        return app.configureScene(route);
    },
    renderScene (route, navigator) {
        return (
            <View style={{ flex: 1 }}>
                {this.state.showNavBar && <View style={[styles.navBarBack, { backgroundColor: app.setting.THEME_COLOR }]} />}
                <route.component
                    {...route.passProps}
                    ref={(ref) => { if (ref)route.ref = ref; }} />
            </View>
        );
    },
    render () {
        const initialRoute = {
            component: Splash,
        };
        const navigationBar = (
            <Navigator.NavigationBar
                routeMapper={NavigationBarRouteMapper}
                style={[styles.navBar, { backgroundColor: app.setting.THEME_COLOR }]}
                />
        );
        return (
            <View style={{ flex:1 }}>
                <Navigator
                    ref={(navigator) => {
                        if (navigator) {
                            app.navigator = navigator;
                        }
                    }}
                    debugOverlay={false}
                    style={styles.container}
                    initialRoute={initialRoute}
                    configureScene={this.configureScene}
                    renderScene={this.renderScene}
                    onDidFocus={(route) => {
                        if (route) {
                            const ref = route.ref;
                            const getChildScene = ref && ref.getChildScene;
                            // 注意：app.scene调用的时候一定需要使用封装函数，如：{handler: ()=>{app.scene.toggleEdit()}}，不能直接使用 handler: app.scene.toggleEdit.
                            // 在动画加载完成前 app.scene 还没有被赋值， 需要使用 SceneMixin 来设置 app.scene
                            const scene = app.scene = getChildScene ? getChildScene() : ref;
                            if (getChildScene && !scene.hasMouted) {
                                scene.hasMouted = true;
                                return;
                            }
                            scene && scene.onDidFocus && scene.onDidFocus();
                            // 如果时主页面，需要检测主页面和其子页面的回调
                            ref && ref !== scene && ref.onDidFocus && ref.onDidFocus();
                        }
                    }}
                    onWillFocus={(route) => {
                        if (route) {
                            const preRoute = app.navigator && app.getCurrentRoute();
                            if (preRoute) {
                                const preRef = preRoute.ref;
                                const preGetChildScene = preRef && preRef.getChildScene;
                                const preScene = preGetChildScene ? preGetChildScene() : preRef;
                                preScene && preScene.onWillHide && preScene.onWillHide();
                                // 如果时主页面，需要检测主页面和其子页面的回调
                                preRef && preRef !== preScene && preRef.onWillHide && preRef.onWillHide();
                            }
                            const ref = route.ref;
                            const getChildScene = ref && ref.getChildScene;
                            const scene = getChildScene ? getChildScene() : ref;
                            // 如果时主页面，需要检测主页面和其子页面的回调
                            scene && scene.onWillFocus && scene.onWillFocus();// 注意：在首次加载的时候页面没有被加载，route.ref为空，不会调用该函数，需要在该页面的componentWillMount里面处理首次逻辑，只有从上页面返回的时候才能被调用
                            ref && ref !== scene && ref.onWillFocus && ref.onWillFocus();
                        }
                    }}
                    navigationBar={this.state.showNavBar ? navigationBar : null}
                    />
                {
                    this.state.modalShow &&
                    <Modal ref='modal' backgroundColor={this.state.modalBackgroundColor} modalTouchHide={this.state.modalTouchHide}>
                        {this.state.modalContent}
                    </Modal>
                }
                <ProgressHud
                    ref='progressHud'
                    overlayColor='rgba(0, 0, 0, 0.6)'
                    color={app.setting.THEME_COLOR}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor:'#EEEEEE',
    },
    navBarBack: {
        height:sr.totalNavbarHeight,
    },
    navBar: {
        alignItems:'center',
        height: sr.totalNavbarHeight,
    },
    titleContainer: {
        width: sr.w,
        height: sr.navbarHeight,
        alignItems:'center',
        justifyContent: 'center',
        paddingTop: sr.translucent ? sr.statusBarHeight : 0,
    },
    navBarButtonText: {
        color: '#FFFFFF',
        fontSize: 18,
    },
    navBarTitleText: {
        fontSize: 18,
        color: '#FFFFFF',
        textAlign: 'center',
        fontWeight: '500',
        width: sr.w / 2,
    },
    navBarButton: {
        flexDirection: 'row',
        paddingHorizontal: 10,
        height:sr.navbarHeight,
        alignItems: 'center',
        paddingTop: sr.translucent ? sr.statusBarHeight / 2 : 0,
    },
    navBarRightEmptyButton: {
        width: 80,
        height: sr.navbarHeight,
    },
    navBarIcon: {
        width: sr.navbarHeight * (sr.translucent ? 0.2 : 0.3),
        height: sr.navbarHeight * (sr.translucent ? 0.2 : 0.3),
    },
});

```

* PDDriver/project/App/components/AutogrowInput.js

```js
import React, { Component } from 'react';
import {
    TextInput,
    StyleSheet,
} from 'react-native';

class Input extends Component {
    constructor () {
        super();
        this.state = {
            height: 35,
        };
    }
    componentWillMount () {
        const { maxLines, style, maxHeight } = this.props;
        const { height, lineHeight, fontSize } = StyleSheet.flatten(style);
        this.defaultHeight = height;
        this.maxHeight = maxLines ? (maxLines * (lineHeight || fontSize * 1.5)) : maxHeight || 99999;
        if (this.defaultHeight) {
            this.setState({ height:this.defaultHeight });
        }
    }
    handleChange (event) {
        const { onChange } = this.props;
        const { height } = event.nativeEvent.contentSize;

        if (this.state.height !== height && height < this.maxHeight) {
            this.setState({
                height: Math.min(Math.max(this.defaultHeight, height), this.maxHeight),
            });
        }
        onChange && onChange(event);
    }
    resetInputText () {
        this.refs.input.setNativeProps({ text: '' });
        this.setState({ height: this.defaultHeight });
    }
    render () {
        return (
            <TextInput
                ref='input'
                multiline
                {...this.props}
                style={[this.props.style, { height: this.state.height }]}
                onChange={this.handleChange.bind(this)}
                />
        );
    }
}

Input.propTypes = {
    style: React.PropTypes.oneOfType([
        React.PropTypes.number,
        React.PropTypes.array,
        React.PropTypes.object,
    ]),
    onChange: React.PropTypes.func,
};

module.exports = Input;

```

* PDDriver/project/App/components/Button.js

```js
'use strict';

const React = require('react');const {    PropTypes,} = React;const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    TouchableOpacity,
} = ReactNative;

const DEFAULT_OPACITY = 0.8;

module.exports = React.createClass({
    propTypes: {
        onPress: PropTypes.func,
        disable: PropTypes.bool,
        textStyle: PropTypes.style,
        activeOpacity: PropTypes.number,
    },
    render () {
        const touchableProps = {
            activeOpacity: this.props.disable ? 1 : this.props.activeOpacity ? this.props.activeOpacity : DEFAULT_OPACITY,
        };
        if (!this.props.disable) {
            touchableProps.onPress = this.props.onPress;
        }
        return (
            <TouchableOpacity
                style={[styles.container, { backgroundColor:app.setting.THEME_COLOR }, this.props.style]} {...touchableProps}
                testID={this.props.testID}>
                <Text style={[styles.text, this.props.disable ? styles.disableText : null, this.props.textStyle]}
                    numberOfLines={1}>
                    {this.props.children}
                </Text>
            </TouchableOpacity>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        borderRadius: 10,
        alignItems:'center',
        justifyContent:'center',
    },
    text: {
        color: '#FFFFFF',
        fontSize: 18,
        fontWeight: '100',
        textAlign: 'center',
        overflow: 'hidden',
    },
    disableText: {
        color: '#dcdcdc',
    },
});

```

* PDDriver/project/App/components/ClipRect.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Shape,
    Surface,
    Path,
} = ReactNative.ART;

const ClipRectIOS = React.createClass({
    render: function () {
        const style = ReactNative.StyleSheet.flatten(this.props.style);
        let { width, height, borderRadius, borderTopLeftRadius, borderTopRightRadius, borderBottomRightRadius, borderBottomLeftRadius, color } = style;
        borderRadius = borderRadius || 0;
        const tl = borderTopLeftRadius || borderRadius;
        const tr = borderTopRightRadius || borderRadius;
        const br = borderBottomRightRadius || borderRadius;
        const bl = borderBottomLeftRadius || borderRadius;

        const path = Path();

        path.move(0, tl);

        if (tl > 0) { path.arc(tl, -tl); }
        path.line(width - (tr + tl), 0);

        if (tr > 0) { path.arc(tr, tr); }
        path.line(0, height - (tr + br));

        if (br > 0) { path.arc(-br, br); }
        path.line(-width + (br + bl), 0);

        if (bl > 0) { path.arc(-bl, -bl); }
        path.line(0, bl)
        .line(width, 0)
        .line(0, -height)
        .line(-width, 0);

        return (
            <Surface width={width} height={height} style={{ backgroundColor:'transparent' }}>
                <Shape d={path} fill={color} />
            </Surface>
        );
    },
});

const TIMES = 30;
const _X = (r, d) => Math.cos(Math.PI / 180 * d) * r;
const _Y = (r, d) => Math.sin(Math.PI / 180 * d) * r;
const arc = (path, x, y, r, t) => {
    const offset = 90 / TIMES;
    for (let i = 0; i <= TIMES; i++) {
        path.lineTo(x - _X(r, 90 * t + offset * i), y - _Y(r, 90 * t + offset * i));
    }
};

const ClipRectAndroid = React.createClass({
    render: function () {
        const style = ReactNative.StyleSheet.flatten(this.props.style);
        let { width, height, borderRadius, borderTopLeftRadius, borderTopRightRadius, borderBottomRightRadius, borderBottomLeftRadius, color } = style;
        borderRadius = borderRadius || 0;
        const tl = borderTopLeftRadius || borderRadius;
        const tr = borderTopRightRadius || borderRadius;
        const br = borderBottomRightRadius || borderRadius;
        const bl = borderBottomLeftRadius || borderRadius;

        const path = Path();

        path.move(0, tl);

        if (tl > 0) { arc(path, tl, tl, tl, 0); }
        path.line(width - (tr + tl), 0);

        if (tr > 0) { arc(path, width - tr, tr, tr, 1); }
        path.line(0, height - (tr + br));

        if (br > 0) { arc(path, width - br, height - br, br, 2); }
        path.line(-width + (br + bl), 0);

        if (bl > 0) { arc(path, bl, height - bl, bl, 3); }
        path.line(0, bl)
        .line(width, 0)
        .line(0, -height)
        .line(-width, 0);

        return (
            <Surface width={width} height={height} style={{ backgroundColor:'transparent' }}>
                <Shape d={path} fill={color} />
            </Surface>
        );
    },
});

module.exports = ReactNative.Platform.OS === 'android' ? ClipRectAndroid : ClipRectIOS;

```

* PDDriver/project/App/components/CustomSheet.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    TouchableOpacity,
    View,
} = ReactNative;

const Overlay = require('./ActionSheet/overlay');
const Sheet = require('./ActionSheet/sheet');

module.exports = React.createClass({
    render () {
        const { visible, onCancel } = this.props;
        return (
            <Overlay visible={visible}>
                <View style={styles.actionSheetContainer}>
                    <TouchableOpacity
                        style={{ flex:1 }}
                        onPress={onCancel} />
                    <Sheet visible={visible}>
                        {this.props.children}
                    </Sheet>
                </View>
            </Overlay>
        );
    },
});

const styles = StyleSheet.create({
    actionSheetContainer: {
        flex: 1,
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
    },
});

```

* PDDriver/project/App/components/DImage.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    View,
} = ReactNative;

const DImage = React.createClass({
    getInitialState () {
        return { showDefault: true };
    },
    onLoad () {
        this.setState({ showDefault: false });
    },
    componentWillReceiveProps (nextProps) {
        const pre = this.props.source, post = nextProps.source;
        const preuri = pre.uri, posturi = post.uri;
        const preT = typeof posturi === 'string', postT = typeof posturi === 'string';
        if ((!(preT ^ postT)) && preuri !== posturi) {
            this.setState({ showDefault: true });
        }
    },
    render () {
        const { source, defaultSource, ...other } = this.props;
        const { showDefault } = this.state;
        return (
            showDefault ?
                <View>
                    <Image source={defaultSource} {...other}>{this.props.children}</Image>
                    <Image style={{ left:-1, top:-1, position:'absolute', width:1, height:1 }} source={source} onLoad={this.onLoad} />
                </View>
            :
                <Image source={source} {...other} >{this.props.children}</Image>
        );
    },
});

module.exports = DImage;

```

* PDDriver/project/App/components/DelayTouchableOpacity.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    TouchableOpacity,
} = ReactNative;

const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    componentWillMount () {
        this.enable = true;
        this.onPress = (e) => {
            if (this.enable) {
                this.enable = false;
                this.props.onPress(e);
                this.setTimeout(() => { this.enable = true; }, this.props.delayTime || 200);
            }
        };
    },
    render () {
        return (
            <TouchableOpacity
                {...this.props}
                onPress={this.onPress}
                >
                {this.props.children}
            </TouchableOpacity>
        );
    },
});

```

* PDDriver/project/App/components/Label.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

module.exports = React.createClass({
    render () {
        const { img, children, style, textStyle } = this.props;
        return (
            <View style={[styles.labelContainer, style]}>
                {!!img && <Image resizeMode='stretch' source={img} style={styles.labelIcon} />}
                <Text style={[styles.label, textStyle]}>{children}:</Text>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    labelContainer: {
        marginTop: 10,
        marginBottom: 6,
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    label: {
        color: '#969696',
        fontSize: 14,
    },
    labelIcon: {
        width: 20,
        height: 20,
        tintColor: '#A3A3A3',
    },
});

```

* PDDriver/project/App/components/MessageBox.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    TouchableHighlight,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps: function () {
        return {
            title: '温馨提示',
            content: '确定要执行操作吗？',
            cancelText: '取消',
            confirmText: '确定',
            width: 312,
        };
    },
    doConfirm () {
        const { onConfirm } = this.props;
        if (!onConfirm || !onConfirm()) {
            app.closeModal();
        }
    },
    doCancel () {
        const { onCancel } = this.props;
        if (onCancel === true || !onCancel || !onCancel()) {
            app.closeModal();
        }
    },
    render () {
        const { title, width, content, onCancel, cancelText, confirmText } = this.props;
        return (
            <View style={[styles.container, { width }]}>
                { !!title && <Text style={styles.title}>{title}</Text> }
                { !!title && <Text style={[styles.redLine, { width: width * 0.8 }]} /> }
                <Text style={styles.content}>
                    {content}
                </Text>
                <Text style={[styles.H_Line, { width }]} />
                <View style={[styles.buttonViewStyle, { width: width - 20 }]}>
                    {!!onCancel &&
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doCancel}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: 'red' }]}>{cancelText}</Text>
                    </TouchableHighlight>
                        }
                    {!!onCancel &&
                    <Text style={styles.line} />
                        }
                    <TouchableHighlight
                        underlayColor='rgba(0, 0, 0, 0)'
                        onPress={this.doConfirm}
                        style={styles.buttonStyleContain}>
                        <Text style={[styles.buttonStyle, { color: '#0076FF' }]} >{confirmText}</Text>
                    </TouchableHighlight>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#FFFFFF',
        borderRadius:10,
    },
    buttonViewStyle: {
        flexDirection: 'row',
        height: 50,
    },
    H_Line: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#b4b4b4',
    },
    redLine: {
        marginTop: 10,
        height: 1,
        backgroundColor: '#ff3c30',
    },
    line: {
        width: 1,
        height: 50,
        backgroundColor: '#b4b4b4',
    },
    buttonStyleContain: {
        height: 50,
        flex: 1,
        justifyContent:'center',
        alignItems:'center',
    },
    buttonStyle: {
        fontSize: 15,
        color: '#000000',
    },
    title: {
        color: '#ff3c30',
        fontSize: 16,
        fontWeight: '100',
        textAlign: 'center',
        overflow: 'hidden',
        marginTop:20,
    },
    content: {
        alignSelf:'center',
        color:'#000000',
        margin: 20,
        marginTop: 30,
    },
});

```

* PDDriver/project/App/components/Modal.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Animated,
    PanResponder,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            backgroundColor: 'rgba(0, 0, 0, 0.5)',
        };
    },
    getInitialState () {
        return {
            opacity: new Animated.Value(0),
        };
    },
    componentWillMount () {
        this._panResponder = PanResponder.create({
            onStartShouldSetPanResponder: (e, gestureState) => true,
            onPanResponderGrant: (e, gestureState) => {
                this.closeModal();
            },
        });
    },
    componentDidMount () {
        Animated.timing(this.state.opacity, {
            toValue: 1,
            duration: 500,
        }
        ).start();
    },
    closeModal () {
        Animated.timing(this.state.opacity, {
            toValue: 0,
            duration: 500,
        }
        ).start(() => {
            app.removeModal();
        });
    },
    render () {
        const { modalTouchHide } = this.props;
        return (
            <Animated.View style={[styles.container, { backgroundColor: this.props.backgroundColor, opacity: this.state.opacity }]} {...(modalTouchHide ? this._panResponder.panHandlers : {})}>
                {this.props.children}
            </Animated.View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        position: 'absolute',
        top: 0,
        bottom: 0,
        left: 0,
        right: 0,
        alignItems:'center',
        justifyContent: 'center',
    },
});

```

* PDDriver/project/App/components/PageList.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    View,
    Text,
    StyleSheet,
    FlatList,
} = ReactNative;

const STATUS = {
    /* loading more status change graph
    *
    * STATUS_TEXT_HIDE->[STATUS_HAVE_MORE, STATUS_START_LOAD]
    * STATUS_START_LOAD->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_HAVE_MORE->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_ALL_LOADED->[STATUS_TEXT_HIDE]
    */
    STATUS_TEXT_HIDE: 0,
    STATUS_START_LOAD: 1,
    STATUS_HAVE_MORE: 2,
    STATUS_NO_DATA: 3,
    STATUS_ALL_LOADED: 4,
    STATUS_LOAD_ERROR: 5,
};
const TEXT = {
    0: '',
    1: '',
    2: '正在加载更多...',
    3: '暂无数据!',
    4: '全部加载完成',
    5: '加载错误，请稍后再试',
};

const { STATUS_TEXT_HIDE, STATUS_START_LOAD, STATUS_HAVE_MORE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR } = STATUS;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            autoLoad: true,
            pageNo: 0,
            infiniteLoadStatus: STATUS_START_LOAD,
            style: { flex: 1 },
            pageSize: CONSTANTS.PER_PAGE_COUNT,
        };
    },
    componentDidMount () {
        if (this.props.autoLoad) {
            this.getList();
        }
    },
    updateList (callback) {
        this.list = callback(this.list);
        this.setState({
            dataSource: this.list,
        });
    },
    getInitialState () {
        this.list = this.props.list || [];
        this.pageNo = this.props.pageNo;
        return {
            dataSource: this.list,
            infiniteLoadStatus: this.props.infiniteLoadStatus,
        };
    },
    componentDidUpdate (prevProps, prevState) {
        if (!_.isEqual(prevProps.listParam, this.props.listParam)) {
            this.refresh();
        }
    },
    getList (wait) {
        const param = {
            ...this.props.listParam,
            pageNo: this.pageNo,
            pageSize: this.props.pageSize,
        };
        this.setState({ infiniteLoadStatus: this.pageNo === 0 ? STATUS_START_LOAD : STATUS_HAVE_MORE });
        POST(this.props.listUrl, param, this.getListSuccess, this.getListFailed, wait);
    },
    getListSuccess (data) {
        this.props.onGetList && this.props.onGetList(data, this.pageNo);
        if (data.success) {
            const list = _.get(data.context, this.props.listName);
            const infiniteLoadStatus = (!list.length && this.pageNo === 0) ? STATUS_NO_DATA : list.length < this.props.pageSize ? STATUS_ALL_LOADED : STATUS_TEXT_HIDE;
            this.list = this.list.concat(list);
            this.setState({
                dataSource: this.list,
                infiniteLoadStatus: infiniteLoadStatus,
            });
        } else {
            if (this.props.ListFailedText) {
                this.setState({ infiniteLoadStatus: this.props.ListFailedText });
            } else {
                this.getListFailed();
            }
        }
    },
    getListFailed () {
        this.pageNo--;
        this.setState({ infiniteLoadStatus: STATUS_LOAD_ERROR });
    },
    onEndReached () {
        if (this.state.infiniteLoadStatus !== STATUS_TEXT_HIDE || this.props.disable) {
            return;
        }
        this.pageNo++;
        this.getList();
    },
    refresh () {
        if (this.isRefreshing()) {
            return;
        }
        this.list = [];
        this.setState({
            dataSource: this.list,
        });
        this.pageNo = 0;
        this.getList();
    },
    isRefreshing () {
        return (this.state.infiniteLoadStatus === STATUS_START_LOAD || this.state.infiniteLoadStatus === STATUS_HAVE_MORE);
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View
                style={styles.separator}
                key={sectionID + rowID} />
        );
    },
    renderFooter () {
        const status = this.state.infiniteLoadStatus;
        return (
            <View style={styles.listFooterContainer}>
                <Text style={styles.listFooter}>
                    {typeof status === 'string' ? status : status === STATUS_NO_DATA && this.props.ListFailedText ? this.props.ListFailedText : TEXT[status]}
                </Text>
            </View>
        );
    },
    render () {
        return (
            <FlatList                onEndReached={this.onEndReached}
                onEndReachedThreshold={10}
                initialListSize={this.props.pageSize}
                enableEmptySections
                removeClippedSubviews={false}
                style={[{ alignSelf:'stretch' }, this.props.style]}
                data={this.state.dataSource}
                renderItem={({ item, index }) => this.props.renderRow(item, index)}
                ItemSeparatorComponent={this.props.renderSeparator === undefined ? this.renderSeparator : this.props.renderSeparator}
                ListFooterComponent={this.renderFooter}
                refreshing={this.state.infiniteLoadStatus === STATUS_START_LOAD}
                onRefresh={this.refresh}
                />
        );
    },
});
module.exports.STATUS = STATUS;

const styles = StyleSheet.create({
    listFooterContainer: {
        height: 60,
        alignItems: 'center',
        paddingTop: 10,
    },
    listFooter: {
        color: 'gray',
        fontSize: 12,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDDriver/project/App/components/PageListView.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    View,
    Text,
    StyleSheet,
    ListView,
    RefreshControl,
} = ReactNative;

const STATUS = {
    /* loading more status change graph
    *
    * STATUS_TEXT_HIDE->[STATUS_HAVE_MORE, STATUS_START_LOAD]
    * STATUS_START_LOAD->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_HAVE_MORE->[STATUS_TEXT_HIDE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR]
    * STATUS_ALL_LOADED->[STATUS_TEXT_HIDE]
    */
    STATUS_TEXT_HIDE: 0,
    STATUS_START_LOAD: 1,
    STATUS_HAVE_MORE: 2,
    STATUS_NO_DATA: 3,
    STATUS_ALL_LOADED: 4,
    STATUS_LOAD_ERROR: 5,
};
const TEXT = {
    0: '',
    1: '',
    2: '正在加载更多...',
    3: '暂无数据!',
    4: '全部加载完成',
    5: '加载错误，请稍后再试',
};

const { STATUS_TEXT_HIDE, STATUS_START_LOAD, STATUS_HAVE_MORE, STATUS_NO_DATA, STATUS_ALL_LOADED, STATUS_LOAD_ERROR } = STATUS;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            autoLoad: true,
            pageNo: 0,
            infiniteLoadStatus: STATUS_START_LOAD,
            style: { flex: 1 },
            pageSize: CONSTANTS.PER_PAGE_COUNT,
        };
    },
    componentDidMount () {
        if (this.props.autoLoad) {
            this.getList();
        }
    },
    updateList (callback) {
        this.list = callback(this.list);
        this.setState({
            dataSource: this.ds.cloneWithRows(this.list),
        });
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        this.list = this.props.list || [];
        this.pageNo = this.props.pageNo;
        return {
            dataSource: this.ds.cloneWithRows(this.list),
            infiniteLoadStatus: this.props.infiniteLoadStatus,
        };
    },
    componentDidUpdate (prevProps, prevState) {
        if (!_.isEqual(prevProps.listParam, this.props.listParam)) {
            this.refresh();
        }
    },
    getList (wait) {
        const param = {
            ...this.props.listParam,
            pageNo: this.pageNo,
            pageSize: this.props.pageSize,
        };
        this.setState({ infiniteLoadStatus: this.pageNo === 0 ? STATUS_START_LOAD : STATUS_HAVE_MORE });
        POST(this.props.listUrl, param, this.getListSuccess, this.getListFailed, wait);
    },
    getListSuccess (data) {
        this.props.onGetList && this.props.onGetList(data, this.pageNo);
        if (data.success) {
            const list = _.get(data.context, this.props.listName);
            const infiniteLoadStatus = (!list.length && this.pageNo === 0) ? STATUS_NO_DATA : list.length < this.props.pageSize ? STATUS_ALL_LOADED : STATUS_TEXT_HIDE;
            this.list = this.list.concat(list);
            this.setState({
                dataSource: this.ds.cloneWithRows(this.list),
                infiniteLoadStatus: infiniteLoadStatus,
            });
        } else {
            if (this.props.ListFailedText) {
                this.setState({ infiniteLoadStatus: this.props.ListFailedText });
            } else {
                this.getListFailed();
            }
        }
    },
    getListFailed () {
        this.pageNo--;
        this.setState({ infiniteLoadStatus: STATUS_LOAD_ERROR });
    },
    onEndReached () {
        if (this.state.infiniteLoadStatus !== STATUS_TEXT_HIDE || this.props.disable) {
            return;
        }
        this.pageNo++;
        this.getList();
    },
    refresh () {
        if (this.isRefreshing()) {
            return;
        }
        this.list = [];
        this.setState({
            dataSource: this.ds.cloneWithRows(this.list),
        });
        this.pageNo = 0;
        this.getList();
    },
    isRefreshing () {
        return (this.state.infiniteLoadStatus === STATUS_START_LOAD || this.state.infiniteLoadStatus === STATUS_HAVE_MORE);
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View
                style={styles.separator}
                key={sectionID + rowID} />
        );
    },
    renderFooter () {
        const status = this.state.infiniteLoadStatus;
        return (
            <View style={styles.listFooterContainer}>
                <Text style={styles.listFooter}>
                    {typeof status === 'string' ? status : status === STATUS_NO_DATA && this.props.ListFailedText ? this.props.ListFailedText : TEXT[status]}
                </Text>
            </View>
        );
    },
    render () {
        return (
            <ListView                onEndReached={this.onEndReached}
                onEndReachedThreshold={10}
                initialListSize={this.props.pageSize}
                enableEmptySections
                removeClippedSubviews={false}
                style={[{ alignSelf:'stretch' }, this.props.style]}
                dataSource={this.state.dataSource}
                renderRow={this.props.renderRow}
                renderSeparator={this.props.renderSeparator === undefined ? this.renderSeparator : this.props.renderSeparator}
                renderFooter={this.renderFooter}
                refreshControl={
                    this.props.refreshEnable ?
                        <RefreshControl
                            refreshing={this.state.infiniteLoadStatus === STATUS_START_LOAD}
                            onRefresh={this.refresh}
                            title='正在刷新...' />
                    : null
                }
                />
        );
    },
});
module.exports.STATUS = STATUS;

const styles = StyleSheet.create({
    listFooterContainer: {
        height: 60,
        alignItems: 'center',
        paddingTop: 10,
    },
    listFooter: {
        color: 'gray',
        fontSize: 12,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDDriver/project/App/components/Picker.js

```js
'use strict';

import Picker from 'react-native-picker';

module.exports = (pickerData, selectedValue, title) => {
    const color = Math.floor(app.setting.THEME_COLOR.replace('#', '0x'));
    const pickerToolBarBg = [(color >> 16) & 0xff, (color >> 8) & 0xff, color & 0xff, 1];
    return new Promise(async(resolve) => {
        Picker.isPickerShow((show) => {
            if (show) {
                Picker.hide();
            } else {
                Picker.init({
                    pickerConfirmBtnText: '确定',
                    pickerConfirmBtnColor: [0, 0, 255, 1],
                    pickerCancelBtnText: '取消',
                    pickerCancelBtnColor: [255 - pickerToolBarBg[0] / 2, 255 - pickerToolBarBg[1] / 2, 255 - pickerToolBarBg[2] / 2, 1],
                    pickerTitleText: title || '',
                    pickerTitleColor: [255, 255, 255, 1],
                    pickerToolBarBg,
                    pickerBg: [207, 207, 207, 1],
                    pickerFontColor: [0, 0, 0, 1],
                    pickerToolBarFontSize: 16,
                    pickerFontSize: 16,
                    pickerData,
                    selectedValue,
                    onPickerConfirm: (value) => { resolve(value); },
                });
                Picker.show();
            }
        });
    });
};
module.exports.hide = () => {
    Picker.isPickerShow((show) => {
        Picker.hide();
    });
};

```

* PDDriver/project/App/components/ProgressBar.js

```js
const React = require('react');const ReactNative = require('react-native');

const {
    StyleSheet,
    View,
} = ReactNative;

module.exports = React.createClass({
    getDefaultProps () {
        return {
            progress: 0,
        };
    },
    render () {
        const fillWidth = this.props.progress * this.props.style.width;
        return (
            <View style={[styles.background, this.props.backgroundStyle, this.props.style]}>
                <View style={[styles.fill, this.props.fillStyle, { width: fillWidth }]} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    background: {
        backgroundColor: '#bbbbbb',
        height: 5,
        overflow: 'hidden',
    },
    fill: {
        backgroundColor: '#3b5998',
        height: 5,
    },
});

```

* PDDriver/project/App/components/ProgressHud.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');

const {
    Image,
    StyleSheet,
    TouchableHighlight,
    View,
    Animated,
    Easing,
} = ReactNative;

const BACKGROUND_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjBFOTY2OTRGMDlBMTFFNUFGQUVDMUUwNDA5REUwMzQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NjBFOTY2OTVGMDlBMTFFNUFGQUVDMUUwNDA5REUwMzQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2MEU5NjY5MkYwOUExMUU1QUZBRUMxRTA0MDlERTAzNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2MEU5NjY5M0YwOUExMUU1QUZBRUMxRTA0MDlERTAzNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrUpG+0AAATlSURBVHjazJpLjBVVEIa7+zYzlwGG4WF0RhkJj4EEY3yigiyU3STiYjbCRmQFC1gQEkIISzUxonHpRqOGBQnxsTImhFcIMYIhZKLyUgENyjPD8JCBud1WOX/r8aROnb7PvpV8uTOdvn3P31V1Tp3qDtM0DRpkITD/T8Fd4iZxhThHnCK+J/YTvzfkx+sUwoMtgexCqUDiOM78ROwmdhEXWi0kIiYZAnwkOc6pEF8Q7xDDzRbCHugk4pwCqhFinsve2YFQbLgQ9sBkJXy0ASc1fGeE2ER8mTdE8tgUYirOD4XEdiW8ZqmRV9LxbuJjYifRUa8QHtR0ouwZeCgc94mQBi8JW4tQm1JraGUi4irjPzGOJbjW2/BoP7GYmKt81/U73xFDxF/VCGERPciLvCLGQeK4s6b1EYPEa8Qy6zqamEPEauJ+XiHTkdh5RPBFx4y7X609Q2wnVuYU8wmxNY8QFjBDWOASYd6/I92dGu0V4n1ilifk2DYQX2lCeIF7EJOAzws36/CCy3qJT4knPd65QbxMXHLNWj1I7tBBBBGjTRDB9gfxKrHPE2LTEI7i9NuBE0KFcYhIg+YZh+vrxDFPjnIoPiYJmSHcfZMAq20zRWTGU+w6lCiJQDaGjbaQGPO8KcD2xggSvFX2J2YnV64myJNHTCHdlgDbG2OuhajJ9jXyRfPKkC3EDCk7vG4Exdm7ggBzIhg09xVlS4TpjXvwSFE2jPJE8gh/PkrMiVCMRQ5CrBdF2+fW4G2WxljJQ2OPHVoV6u02EHLIyovUqpwXRQgrl0eyQrBo4xnsvMMb/4SXKSQUZq77QfvYWSE/sr/7YqsksTc77STkglEW2YvytBizVt6dXJF2R9nrlGPPdjdqIyGpUlkkMVTGjhNKbSSkU6m4b8dQOcnRMJjcRkJ6MVZpnKMxVu4uofsR+joXLbY5hkfscf4Wo/yIHCd0waVjBYuYDY+4hJxnAbeEhbBkfM5qA288h7CqQEzFWhBPZ5VtpNDbBkJWKqs6c9zca7i8MhNlflE2QCwxBm17gxfKi1luXHaU8Nmzj4EChawxwqoilPL7zQXvkrEASnCL6KECRLxAPK2EVAW7yH+FcGhd8+TKEygwW2Uc0usFL5gcQWX8vxLkF48QXhyfb9Fqz1P+FjRENG/skmqpUTTItJYQz+fLlZKmUSI2E/OVpgNzAKW9WBSehFKto9KH6bCrCSK4t7YNjbdE2afz9vsj84tSE/th4lnBM1JT4tugjiexlnG/941g4kmA1DswuzvvEYd9QgIk9jzhIlLuXAwmnplfqVEAd0FWEY97miDZ517iQ/siLiH8pReD/zrzmphs4eQp/Azxa46GRTcWuaXEQqsk0kT8SLwl9RG0R2980ZeQ4JpHpPqM67friOVxHO/ElMolzwPGYusSYIv5mXjTVcD6Hk/z7LQCCe4TUxI+S8KAS45zNRE/EB8EE6+C1LSV5bt5ENOcnXAugkB/TJ0G+usedrOae787NRF5PGLaXKwhZcUz0h0uKcc1b3C18RlxNM/gqn2Fo4y9wUCOEIs8ArTk5l7vnmratbW+VMObraeIBcod1QbsEnCC+Cao4dWnel9z4kd1i8HsnF6yucobI4TQ9VoHEjbwxTMW1Y/plT3Wg6KvbPSR72JHeg13nafUkUb8+N8CDABdKT+Sgc4IvgAAAABJRU5ErkJggg==';

const SPIN_DURATION = 1000;

const ProgressHud = React.createClass({
    getDefaultProps () {
        return {
            color: '#000',
            overlayColor: 'rgba(0, 0, 0, 0)',
        };
    },
    getInitialState () {
        return {
            visible: false,
            rotate: new Animated.Value(0),
        };
    },
    showAnimate () {
        const { rotate, visible } = this.state;
        if (visible) {
            rotate.setValue(0);
            Animated.timing(rotate, {
                toValue: 1,
                duration: SPIN_DURATION,
                easing: Easing.linear,
                useNativeDriver: true,
            }).start(() => {
                this.showAnimate();
            });
        }
    },
    show () {
        this.setState({
            visible: true,
        }, () => {
            this.showAnimate();
        });
    },
    hide () {
        const { rotate } = this.state;
        rotate.stopAnimation(() => {
            rotate.setValue(0);
            this.setState({
                visible: false,
            });
        });
    },
    onPress () {
        if (this.props.close) {
            this.props.close();
        }
    },
    render () {
        const { visible, rotate } = this.state;
        if (!visible) {
            return <View />;
        }
        return (
            <TouchableHighlight
                key='ProgressHud'
                style={[styles.overlay, { backgroundColor: this.props.overlayColor }]}
                onPress={this.onPress}
                underlayColor={this.props.overlayColor}
                activeOpacity={1}
                >
                <View style={styles.container}>
                    <Animated.Image
                        style={[styles.spinner, {
                            transform: [{
                                rotate: rotate.interpolate({
                                    inputRange: [0, 1],
                                    outputRange: ['0deg', '360deg'],
                                }),
                            }],
                        }]}
                        source={{
                            uri: BACKGROUND_IMAGE,
                            isStatic: true,
                        }}
                         />
                    <Image
                        resizeMode='cover'
                        source={app.img.splash_logo}
                        style={styles.spinner_image} />
                </View>
            </TouchableHighlight>
        );
    },
});

const styles = StyleSheet.create({
    overlay: {
        alignItems: 'center',
        justifyContent: 'center',
        flex: 1,
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
    },
    container: {
        justifyContent: 'center',
        alignItems: 'center',
        width: 100,
        height: 100,
        borderRadius: 16,
    },
    spinner: {
        alignItems: 'center',
        justifyContent: 'center',
        width: 60,
        height: 60,
        borderRadius: 60 / 2,
    },
    spinner_image: {
        position: 'absolute',
        left: 26,
        top: 26,
        width: 48,
        height: 48,
        borderRadius: 48 / 2,
    },
});

module.exports = ProgressHud;

```

* PDDriver/project/App/components/RText.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    Platform,
} = ReactNative;

const RText = React.createClass({
    render () {
        const { children, style, ...props } = this.props;
        const s = StyleSheet.flatten(style);
        const { lineHeight, fontSize } = s;
        const paddingVertical = (lineHeight - fontSize) / 2;
        return (
            <Text
                style={[{ paddingVertical }, style]}
                testID={this.props.testID}
                {...props}
                >
                {children}
            </Text>
        );
    },
});

module.exports = Platform.OS === 'android' ? RText : Text;

```

* PDDriver/project/App/components/ScoreSelect.js

```js
'use strict';
import React from 'react';
import {
    View,
    ScrollView,
    InteractionManager,
} from 'react-native';

const ViewPager = React.createClass({
    componentWillMount () {
        this.count = this.props.children.length;
    },
    componentDidMount () {
        InteractionManager.runAfterInteractions(() => {
            this.scrollView.scrollTo({ x: sr.s(160) });
        });
    },
    onScroll (e) {
        // android incompatible
        if (!e.nativeEvent.contentOffset) {
            e.nativeEvent.contentOffset = { x: e.nativeEvent.position * this.props.width };
        }
        this.updateIndex(e.nativeEvent.contentOffset.x);
    },
    updateIndex (x) {
        const { width, afterChange } = this.props;
        const selectedIndex = Math.round(x / width);
        if (this.lastSelectedIndex !== selectedIndex && selectedIndex >= 0 && selectedIndex <= this.count - 1) {
            this.lastSelectedIndex = selectedIndex;
            if (afterChange) {
                afterChange(selectedIndex);
            }
        }
    },
    render () {
        const { width, height } = this.props;
        const pages = this.props.children.map((page, i) => {
            return (<View style={{ width, height }} key={i}>{page}</View>);
        });
        return (
            <ScrollView ref={(scrollView) => { this.scrollView = scrollView; }}
                horizontal
                pagingEnabled={false}
                scrollEventThrottle={10}
                removeClippedSubviews={false}
                automaticallyAdjustContentInsets={false}
                directionalLockEnabled
                showsHorizontalScrollIndicator={false}
                showsVerticalScrollIndicator={false}
                contentContainerStyle={this.props.style}
                onScroll={this.onScroll}>
                <View style={{ width, height }} />
                {pages}
                <View style={{ width, height }} />
            </ScrollView>
        );
    },
});

module.exports = ViewPager;

```

* PDDriver/project/App/components/SelectRegionAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '所在地',
        rightButton: { title: '确定', handler: () => { app.scene.confirm(); } },
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    confirm (obj) {
        const { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        const { confirmAddress, isNeedSelectAll } = this.props;
        if (isNeedSelectAll) {
            if (!!lastObj && lastObj.isLeaf) {
                confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), allAddress.length >= 1 ? lastObj.code : 0);
                app.pop();
            } else {
                Toast('请选择完整到货地');
            }
        } else {
            confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), allAddress.length >= 1 ? lastObj.code : 0);
            app.pop();
        }
    },
    componentWillMount () {
        const { endPointLastCode } = this.props;
        !endPointLastCode || endPointLastCode == '' ? this.getRegionAddress(0) : this.getAddressFromLastCode(endPointLastCode);
    },
    getRegionAddress (parentCode) {
        const param = { userId: app.personal.info.userId, parentCode, type:0 };
        POST(app.route.ROUTE_GET_REGION_ADDRESS_LIST, param, this.getRegionAddressSuccess.bind(null, parentCode), false);
    },
    getRegionAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == 0 && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (addressLastCode) {
        const param = { userId: app.personal.info.userId, addressLastCode };
        POST(app.route.ROUTE_GET_ADDRESS_FROM_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getAddressTitleArray(data.context.addressList, addressLastCode), dataSource: data.context.addressList[0] || [] });
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        if (!!lastObj && lastObj.isLeaf) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) {
            this.props.confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), obj.code);
            app.pop();
        } else {
            this.getRegionAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getRegionAddress.bind(null, 0)}>
                        <Text style={styles.allAddress}>省市</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        <TouchableOpacity activeOpacity={1} style={styles.btnSelectAddress} >
                            <Text>选择地址</Text>
                        </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
});

```

* PDDriver/project/App/components/SelectShortAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '短途地址',
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    componentWillMount () {
        const { endPointLastCode, parentCode } = this.props;
        this.getAddressFromLastCode(parentCode, endPointLastCode);
    },
    getRegionAddress (parentCode) {
        const param = { userId: app.personal.info.userId, parentCode, type:1 };
        POST(app.route.ROUTE_GET_REGION_ADDRESS_LIST, param, this.getRegionAddressSuccess.bind(null, parentCode), false);
    },
    getRegionAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == this.props.parentCode && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (parentCode, addressLastCode) {
        const param = { userId: app.personal.info.userId, parentCode, addressLastCode };
        POST(app.route.ROUTE_GET_SEND_DOOR_ADDRESS_FROM_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getAddressTitleArray(data.context.addressList, addressLastCode), dataSource:data.context.addressList[0] || [] });
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        if (!!lastObj && lastObj.isLeaf) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) {
            this.props.confirmAddress(_.join(_.map(this.state.allAddress, 'name'), ''), obj.code);
            app.pop();
        } else {
            this.getRegionAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        const { parentCode } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getRegionAddress.bind(null, parentCode)}>
                        <Text style={styles.allAddress}>区域</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        <TouchableOpacity
                            activeOpacity={1}
                            style={styles.btnSelectAddress}>
                            <Text>选择地址</Text>
                        </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
});

```

* PDDriver/project/App/components/SelectStartPointAddress.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
    ListView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '始发地',
        rightButton: { title: '确定', handler: () => { app.scene.confirm(); } },
    },
    getInitialState () {
        this.ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            dataSource:[],
            allAddress:[],
        };
    },
    componentWillMount () {
        const { endPointLastCode, id } = this.props;
        // const endPointLastCode = 520101;
        // const id = "59e426b1b6ee191fe5d4fbf8";
        !endPointLastCode || endPointLastCode == '' ? this.getStartPointAddress(0) : this.getAddressFromLastCode(endPointLastCode, id);
    },
    getStartPointAddress (parentCode) {
        const param = { userId: app.personal.info.userId, parentCode };
        POST(app.route.ROUTE_GET_START_POINT_ADDRESS_LIST, param, this.getStartPointAddressSuccess.bind(null, parentCode), false);
    },
    getStartPointAddressSuccess (parentCode, data) {
        const { allAddress } = this.state;
        if (data.success) {
            parentCode == 0 && this.setState({ allAddress: [] });
            this.setState({ dataSource: data.context.addressList });
        } else {
            Toast(data.msg);
        }
    },
    getAddressFromLastCode (addressLastCode, id) {
        const param = { userId: app.personal.info.userId, addressLastCode, isLeaf: !!id };
        POST(app.route.ROUTE_GET_START_POINT_ADDRESS_FROME_LAST_CODE, param, this.getAddressFromLastCodeSuccess.bind(null, addressLastCode, id), false);
    },
    getAddressFromLastCodeSuccess (addressLastCode, id, data) {
        if (data.success) {
            this.setState({ allAddress: app.utils.getStartPointTitleArray(data.context.addressList, addressLastCode, id), dataSource:data.context.addressList[0] || [] });
        }
    },
    confirm () {
        const { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        const { confirmAddress, isNeedSelectAll } = this.props;
        if (isNeedSelectAll) {
            if (!!lastObj && lastObj.isLeaf) {
                if (lastObj.isShop) {
                    confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), shopId:lastObj.id, lastCode:lastObj.addressRegionLastCode });
                } else if (lastObj.isAgent) {
                    confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), agentId:lastObj.id, lastCode:lastObj.addressRegionLastCode });
                }
                app.pop();
            } else {
                Toast('请选择完整到货地');
            }
        } else {
            confirmAddress({ startPoint:_.join(_.map(allAddress, 'name'), ''), lastCode:lastObj.code });
            app.pop();
        }
    },
    getSubAddressList (obj) {
        let { allAddress } = this.state;
        const lastObj = allAddress[allAddress.length - 1];
        if (!!lastObj && lastObj.isLeaf) {
            allAddress.pop();
        }
        allAddress.push(obj);
        this.setState({ allAddress: _.uniqBy(allAddress, 'code') });
        if (obj.isLeaf) { // 省+市+名字
            if (obj.isShop) {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), shopId:obj.id, lastCode:obj.addressRegionLastCode });
            } else if (obj.isAgent) {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), agentId:obj.id, lastCode:obj.addressRegionLastCode });
            } else {
                this.props.confirmAddress({ startPoint:_.join(_.map(this.state.allAddress, 'name'), ''), lastCode:obj.code });
            }
            app.pop();
        } else {
            this.getStartPointAddress(obj.code);
        }
    },
    onClickAddressTitle (obj, index) {
        this.state.allAddress = _.dropRight(this.state.allAddress, this.state.allAddress.length - index);
        this.getSubAddressList(obj);
    },
    renderRow (obj, rowID) {
        return (
            <TouchableOpacity
                key={rowID}
                activeOpacity={0.6}
                onPress={this.getSubAddressList.bind(null, obj)}
                style={styles.row}>
                <Text>{obj.name}</Text>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={rowID} />
        );
    },
    render () {
        const { allAddress } = this.state;
        const { style } = this.props;
        return (
            <View style={style || styles.container}>
                <View style={styles.infoStyle}>
                    <TouchableOpacity
                        activeOpacity={1}
                        onPress={this.getStartPointAddress.bind(null, 0)}>
                        <Text style={styles.allAddress}>省市</Text>
                    </TouchableOpacity>
                    {
                        allAddress.map((item, i) => {
                            return (
                                <TouchableOpacity
                                    key={i}
                                    activeOpacity={1}
                                    onPress={this.onClickAddressTitle.bind(null, item, i)}>
                                    <Text style={styles.allAddress}>{item.name}</Text>
                                </TouchableOpacity>
                            );
                        })
                    }
                    {
                        allAddress.length != 4 &&
                            <TouchableOpacity
                                activeOpacity={1}
                                style={styles.btnSelectAddress}>
                                <Text>选择地址</Text>
                            </TouchableOpacity>
                    }
                    {
                        !!style &&
                            <TouchableOpacity
                                activeOpacity={0.6}
                                onPress={this.confirm}
                                style={styles.btnConfirmAddress}>
                                <Text>确定</Text>
                            </TouchableOpacity>
                    }
                </View>
                <ListView
                    initialListSize={1}
                    onEndReachedThreshold={10}
                    enableEmptySections
                    dataSource={this.ds.cloneWithRows(this.state.dataSource)}
                    renderRow={this.renderRow}
                    renderSeparator={this.renderSeparator} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    row: {
        flexDirection: 'row',
        paddingVertical: 10,
        paddingHorizontal: 12,
    },
    separator: {
        backgroundColor: '#EEEEEE',
        height: 1,
        width: sr.w,
    },
    infoStyle: {
        flexDirection: 'row',
        paddingTop:15,
        marginLeft:10,
    },
    allAddress:{
        fontSize:15,
        paddingVertical:5,
        paddingHorizontal:1,
    },
    btnSelectAddress:{
        paddingVertical:5,
        paddingHorizontal:2,
        borderColor:'red',
        borderBottomWidth:1,
    },
    btnConfirmAddress:{
        paddingVertical:5,
        paddingHorizontal:10,
    },
});

```

* PDDriver/project/App/components/Slider.js

```js
'use strict';

const React = require('react');const {    PropTypes,} = React;const ReactNative = require('react-native');
const {
  StyleSheet,
  PanResponder,
  View,
  Platform,
} = ReactNative;

const TRACK_SIZE = 4;
const THUMB_SIZE = 20;

function Rect (x, y, width, height) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
}

Rect.prototype.containsPoint = function (x, y) {
    return (x >= this.x
          && y >= this.y
          && x <= this.x + this.width
          && y <= this.y + this.height);
};

const Slider = React.createClass({
    propTypes: {
    /**
     * Initial value of the slider. The value should be between minimumValue
     * and maximumValue, which default to 0 and 1 respectively.
     * Default value is 0.
     *
     * *This is not a controlled component*, e.g. if you don't update
     * the value, the component won't be reset to its inital value.
     */
        value: PropTypes.number,

    /**
     * Initial minimum value of the slider. Default value is 0.
     */
        minimumValue: PropTypes.number,

    /**
     * Initial maximum value of the slider. Default value is 1.
     */
        maximumValue: PropTypes.number,

    /**
     * The color used for the track to the left of the button. Overrides the
     * default blue gradient image.
     */
        minimumTrackTintColor: PropTypes.string,

    /**
     * The color used for the track to the right of the button. Overrides the
     * default blue gradient image.
     */
        maximumTrackTintColor: PropTypes.string,

    /**
     * The color used for the thumb.
     */
        thumbTintColor: PropTypes.string,

    /**
     * The size of the touch area that allows moving the thumb.
     * The touch area has the same center has the visible thumb.
     * This allows to have a visually small thumb while still allowing the user
     * to move it easily.
     * The default is {width: 40, height: 40}.
     */
        thumbTouchSize: PropTypes.shape(
      { width: PropTypes.number, height: PropTypes.number }
    ),

    /**
     * Callback continuously called while the user is dragging the slider.
     */
        onValueChange: PropTypes.func,

    /**
     * Callback called when the user starts changing the value (e.g. when
     * the slider is pressed).
     */
        onSlidingStart: PropTypes.func,

    /**
     * Callback called when the user finishes changing the value (e.g. when
     * the slider is released).
     */
        onSlidingComplete: PropTypes.func,

    /**
     * The style applied to the slider container.
     */
        style: PropTypes.style,

    /**
     * The style applied to the track.
     */
        trackStyle: PropTypes.style,

    /**
     * The style applied to the thumb.
     */
        thumbStyle: PropTypes.style,

    /**
     * Set this to true to visually see the thumb touch rect in green.
     */
        debugTouchArea: PropTypes.bool,
    },
    getInitialState () {
        return {
            containerSize: {},
            trackSize: {},
            thumbSize: {},
            previousLeft: 0,
            value: this.props.value,
        };
    },
    getDefaultProps () {
        return {
            value: 0,
            minimumValue: 0,
            maximumValue: 1,
            minimumTrackTintColor: '#3f3f3f',
            maximumTrackTintColor: '#b3b3b3',
            thumbTintColor: '#343434',
            thumbTouchSize: { width: 40, height: 40 },
            debugTouchArea: false,
        };
    },
    componentWillMount () {
        this._panResponder = PanResponder.create({
            onStartShouldSetPanResponder: this._handleStartShouldSetPanResponder,
            onMoveShouldSetPanResponder: this._handleMoveShouldSetPanResponder,
            onPanResponderGrant: this._handlePanResponderGrant,
            onPanResponderMove: this._handlePanResponderMove,
            onPanResponderRelease: this._handlePanResponderEnd,
            onPanResponderTerminate: this._handlePanResponderEnd,
        });
    },
    componentWillReceiveProps (nextProps) {
        this.setState({ value: nextProps.value });
    },
    render () {
        const {
      minimumTrackTintColor,
      maximumTrackTintColor,
      thumbTintColor,
      styles,
      style,
      trackStyle,
      thumbStyle,
      debugTouchArea,
      ...other
    } = this.props;
        const { value, containerSize, trackSize, thumbSize } = this.state;
        const mainStyles = styles || defaultStyles;
        const thumbLeft = this._getThumbLeft(value);
        const valueVisibleStyle = {};
        if (containerSize.width === undefined
        || trackSize.width === undefined
        || thumbSize.width === undefined) {
            valueVisibleStyle.opacity = 0;
        }

        const minimumTrackStyle = {
            position: 'absolute',
            width: 300, // needed to workaround a bug for borderRadius
            marginTop: -trackSize.height,
            backgroundColor: minimumTrackTintColor,
            ...valueVisibleStyle,
        };

        if (thumbLeft >= 0 && thumbSize.width >= 0) {
            minimumTrackStyle.width = thumbLeft + thumbSize.width / 2;
        }

        const touchOverflowStyle = this._getTouchOverflowStyle();

        return (
            <View style={{ flex:1, justifyContent:'center' }}>
                <View
                    {...other}
                    style={[mainStyles.container, style]}
                    onLayout={this._measureContainer}>
                    <View
                        style={[{ backgroundColor: maximumTrackTintColor }, mainStyles.track, trackStyle]}
                        onLayout={this._measureTrack} />
                    <View style={[mainStyles.track, trackStyle, minimumTrackStyle]} />
                </View>
                <View
                    ref={(thumb) => { this.thumb = thumb; }}
                    onLayout={this._measureThumb}
                    style={[
                    { backgroundColor: thumbTintColor, marginTop: -(trackSize.height + thumbSize.height) / 2 },
                        mainStyles.thumb, thumbStyle, { left: thumbLeft, ...valueVisibleStyle },
                    ]}
                />
                <View
                    style={[defaultStyles.touchArea, touchOverflowStyle]}
                    {...this._panResponder.panHandlers}>
                    {debugTouchArea === true && this._renderDebugThumbTouchRect()}
                </View>
            </View>
        );
    },

    _handleStartShouldSetPanResponder (e: Object, /* gestureState: Object */): boolean {
    // Until the PR https://github.com/facebook/react-native/pull/3426 is merged, we need to always return "true" for android
        if (Platform.OS === 'android') {
            return true;
        }
    // Should we become active when the user presses down on the thumb?
        return this._thumbHitTest(e);
    },

    _handleMoveShouldSetPanResponder (/* e: Object, gestureState: Object */): boolean {
    // Should we become active when the user moves a touch over the thumb?
        return false;
    },

    _handlePanResponderGrant (/* e: Object, gestureState: Object */) {
        this.setState({ previousLeft: this._getThumbLeft(this.state.value) },
      this._fireChangeEvent.bind(this, 'onSlidingStart'));
    },
    _handlePanResponderMove (e: Object, gestureState: Object) {
        this.setState({ value: this._getValue(gestureState) },
      this._fireChangeEvent.bind(this, 'onValueChange'));
    },
    _handlePanResponderEnd (e: Object, gestureState: Object) {
        this.setState({ value: this._getValue(gestureState) },
      this._fireChangeEvent.bind(this, 'onSlidingComplete'));
    },

    _measureContainer (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const containerSize = { width: width, height: height };
        this.setState({ containerSize: containerSize });
    },

    _measureTrack (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const trackSize = { width: width, height: height };
        this.setState({ trackSize: trackSize });
    },

    _measureThumb (x: Object) {
        const { width, height } = x.nativeEvent.layout;
        const thumbSize = { width: width, height: height };
        this.setState({ thumbSize: thumbSize });
    },

    _getRatio (value: number) {
        return (value - this.props.minimumValue) / (this.props.maximumValue - this.props.minimumValue);
    },

    _getThumbLeft (value: number) {
        const ratio = this._getRatio(value);
        return ratio * (this.state.containerSize.width - this.state.thumbSize.width);
    },

    _getValue (gestureState: Object) {
        const length = this.state.containerSize.width - this.state.thumbSize.width;
        const thumbLeft = Math.min(length,
      Math.max(0, this.state.previousLeft + (this.props.vertical ? gestureState.dy : gestureState.dx)));

        const ratio = thumbLeft / length;
        return ratio * (this.props.maximumValue - this.props.minimumValue) + this.props.minimumValue;
    },

    _fireChangeEvent (event) {
        if (this.props[event]) {
            this.props[event](this.state.value);
        }
    },

    _getTouchOverflowSize () {
        const state = this.state;
        const props = this.props;

        const size = {};
        if (state.containerSize.width !== undefined
        && state.thumbSize.width !== undefined) {
            size.width = Math.max(0, props.thumbTouchSize.width - state.thumbSize.width);
            size.height = Math.max(0, props.thumbTouchSize.height - state.containerSize.height);
        }

        return size;
    },

    _getTouchOverflowStyle () {
        const { width, height } = this._getTouchOverflowSize();

        const touchOverflowStyle = {};
        if (width !== undefined && height !== undefined) {
            const verticalMargin = -height / 2;
            touchOverflowStyle.marginTop = verticalMargin;
            touchOverflowStyle.marginBottom = verticalMargin;

            const horizontalMargin = -width / 2;
            touchOverflowStyle.marginLeft = horizontalMargin;
            touchOverflowStyle.marginRight = horizontalMargin;
        }

        if (this.props.debugTouchArea === true) {
            touchOverflowStyle.backgroundColor = 'orange';
            touchOverflowStyle.opacity = 0.5;
        }

        return touchOverflowStyle;
    },

    _thumbHitTest (e: Object) {
        const nativeEvent = e.nativeEvent;
        const thumbTouchRect = this._getThumbTouchRect();
        return thumbTouchRect.containsPoint(nativeEvent.locationX, nativeEvent.locationY);
    },

    _getThumbTouchRect () {
        const state = this.state;
        const props = this.props;
        const touchOverflowSize = this._getTouchOverflowSize();

        return new Rect(
      touchOverflowSize.width / 2 + this._getThumbLeft(state.value) + (state.thumbSize.width - props.thumbTouchSize.width) / 2,
      touchOverflowSize.height / 2 + (state.containerSize.height - props.thumbTouchSize.height) / 2,
      props.thumbTouchSize.width,
      props.thumbTouchSize.height
    );
    },

    _renderDebugThumbTouchRect () {
        const thumbTouchRect = this._getThumbTouchRect();
        const positionStyle = {
            left: thumbTouchRect.x,
            top: thumbTouchRect.y,
            width: thumbTouchRect.width,
            height: thumbTouchRect.height,
        };

        return (
            <View
                style={[defaultStyles.debugThumbTouchArea, positionStyle]}
                pointerEvents='none'
      />
        );
    },
});

const defaultStyles = StyleSheet.create({
    container: {
        height: 40,
        justifyContent: 'center',
    },
    track: {
        height: TRACK_SIZE,
        borderRadius: TRACK_SIZE / 2,
    },
    thumb: {
        position: 'absolute',
        width: THUMB_SIZE,
        height: THUMB_SIZE,
        borderRadius: THUMB_SIZE / 2,
    },
    touchArea: {
        position: 'absolute',
        backgroundColor: 'transparent',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
    },
    debugThumbTouchArea: {
        position: 'absolute',
        backgroundColor: 'green',
        opacity: 0.5,
    },
});

module.exports = Slider;

```

* PDDriver/project/App/components/StarBar.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    View,
    StyleSheet,
} = ReactNative;

const MAX_STAR_NUM = 5;

module.exports = React.createClass({
    render () {
        const value = this.props.value;
        const starNum = Math.floor(value);
        const rest = value - starNum;
        const list = [];
        let i;
        for (i = 0; i < starNum; i++) {
            list[i] = 1;
        }
        if (i < MAX_STAR_NUM) {
            list[i] = rest <= 0.31 ? 2 : rest >= 0.69 ? 1 : 3;
            while (++i < MAX_STAR_NUM) {
                list[i] = 2;
            }
        }
        return (
            <View style={this.props.style ? this.props.style : styles.scoreIconContainer}>
                {
                    list.map((item, i) => {
                        const imgSource = app.img['actualCombat_star_' + item];
                        return (
                            <Image
                                key={i}
                                resizeMode='stretch'
                                source={imgSource}
                                style={this.props.starStyle ? this.props.starStyle : styles.scoreIcon}
                                />
                        );
                    })
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    scoreIconContainer: {
        height: 30,
        flexDirection: 'row',
        justifyContent: 'center',
    },
    scoreIcon: {
        marginLeft: 3,
        width: 20,
        height: 20,
    },
});

```

* PDDriver/project/App/components/TouchAbleCall.js

```js
import React, { Component } from 'react';
import {
    Text,
    Linking,
    TouchableOpacity,
} from 'react-native';
class TouchableCall extends Component {
    protoTypes:{
        url:React.ProtoTypes.string
    }
    render () {
        return (
            <TouchableOpacity onPress={() => {
                Linking.canOpenURL(this.props.url).then(supported => {
                    if (!supported) {
                        console.log('Can\'t handle url: ' + this.props.url);
                    } else {
                        return Linking.openURL(this.props.url);
                    }
                }).catch(err => console.error('An error occurred', err));
            }}>
                <Text>{this.props.url}</Text>
            </TouchableOpacity>

        );
    }
}
module.exports = TouchableCall;

```

* PDDriver/project/App/components/WebviewMessageBox.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    WebView,
    Text,
} = ReactNative;

const Button = require('./Button');

module.exports = React.createClass({
    render () {
        return (
            <View style={styles.overlayContainer}>
                {
                    !this.props.title &&
                    <View style={[styles.title, { backgroundColor: app.setting.THEME_COLOR }]}>
                        <View style={[styles.titleContainer, { marginTop: sr.trueStatusBarHeight }]}>
                            <Text style={styles.titleText}>
                                {this.props.title}
                            </Text>
                        </View>
                    </View>
                }
                <View style={[styles.container, { top: sr.totalNavbarHeight + sr.statusBarHeight }]}>
                    <WebView
                        style={styles.webview}
                        source={{ uri:this.props.webAddress }}
                        scalesPageToFit
                        />
                    <Button
                        onPress={app.closeModal}
                        style={styles.contentButton}
                        textStyle={styles.contentButtonText}>
                        确定</Button>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    overlayContainer: {
        position:'absolute',
        top: 0,
        bottom: 0,
        left:0,
        right: 0,
        backgroundColor: 'transparent',
    },
    title: {
        height:sr.totalNavbarHeight,
        width: sr.w,
    },
    titleContainer: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    titleText: {
        fontSize: 18,
        color: 'gray',
        fontWeight: '500',
    },
    container: {
        width:sr.w * 5 / 6,
        height:sr.h * 4 / 5,
        alignItems:'center',
        justifyContent:'center',
        borderRadius:10,
        position: 'absolute',
        left: sr.w * 1 / 12,
    },
    webview: {
        width:sr.w * 5 / 6,
        height:sr.h * 4 / 5 - 50,
    },
    contentButton: {
        width:sr.w * 5 / 6,
        height:50,
        borderRadius:0,
    },
    contentButtonText: {
        color: '#FFFFFF',
        fontWeight: '800',
    },
});

```

* PDDriver/project/App/components/index.js

```js
module.exports = {
    Button: require('./Button'),
    PageList: require('./PageList'),
    ActionSheet: require('./ActionSheet/index'),
    CustomSheet: require('./CustomSheet'),    ClipRect: require('./ClipRect'),
    Modal: require('./Modal'),
    DImage: require('./DImage'),
    Label: require('./Label'),
    ProgressBar: require('./ProgressBar'),
    Slider: require('./Slider'),
    MessageBox: require('./MessageBox'),
    WebviewMessageBox: require('./WebviewMessageBox'),
    DelayTouchableOpacity: require('./DelayTouchableOpacity'),
    StarBar: require('./StarBar'),
    ProgressHud: require('./ProgressHud'),
    RText: require('./RText'),
    ScoreSelect: require('./ScoreSelect'),
    AutogrowInput: require('./AutogrowInput'),
    TouchableCall: require('./TouchAbleCall'),
    Picker: require('./Picker'),
    SelectRegionAddress: require('./SelectRegionAddress'),
    SelectStartPointAddress: require('./SelectStartPointAddress'),
    SelectShortAddress: require('./SelectShortAddress'),
};

```

* PDDriver/project/App/config/Color.js

```js
'use strict';

module.exports = {
    _c (style, color) {
        return [style, { color: color || app.setting.THEME_COLOR }];
    },
    _bc (style, color) {
        return [style, { backgroundColor:color || app.setting.THEME_COLOR }];
    },
    _tc (style, color) {
        return [style, { tintColor: color || app.setting.THEME_COLOR }];
    },
};

```

* PDDriver/project/App/config/Constants.js

```js
'use strict';

// 该文件永远不要提交svn
// 发布正式服务器的配置，svn上面永远不要动这个配置，在发布测试服务器的时候将ISSUE改为false
// 如果发布ios时 ISSUE_IOS=true 其他的发布为 ISSUE_IOS=false
// CHANNEL为android渠道，发布百度市场时为baidu,其他的为default,ios忽略这个选项
const CONFIG = {
    ISSUE: false,
    ISSUE_IOS: false,
    CHANNEL: 'default',
};

// 发布测试服务器的配置，该配置只有 CONFIG.ISSUE 为 false 的时候才生效
// 如果是本地开发模式， CONFIG.ISSUE = false， TEST_CONFIG.ISSUE = false, 同时可以修改调试的服务器
// 如果是发布测试服务器， CONFIG.ISSUE = false，TEST_CONFIG.ISSUE = true
const TEST_CONFIG = {
    ISSUE: true,
    BASE_SERVER_INDEX: 0, // 只有 TEST_CONFIG.ISSUE 为 false时生效
};

// web服务器 依次是本地服务器， 测试服务器， 正式服务器
const BASE_SERVERS = ['192.168.1.222:3000', '192.168.1.189', '120.78.65.221'];
const BASE_SERVER = CONFIG.ISSUE ? BASE_SERVERS[2] : TEST_CONFIG.ISSUE ? BASE_SERVERS[1] : BASE_SERVERS[TEST_CONFIG.BASE_SERVER_INDEX];

module.exports = {
    APP_NAME: '四面通司机端',
    THEME_COLORS: ['#c81622', '#A62045', '#239FDB'],
    ISSUE_IOS: CONFIG.ISSUE_IOS,
    NOT_NEED_UPDATE_JS_START: !(CONFIG.ISSUE || TEST_CONFIG.ISSUE), // 启动时不需要更新小版本
    MINIFY: CONFIG.ISSUE, // 是否压缩js文件，我们采取测试服务器为了查找问题不用压缩js文件，正式服务器需要压缩js文件，并且不能看到调试信息
    CHANNEL: CONFIG.CHANNEL,
    // IOS的appid,1096525384
    IOS_APPID: '',
    BASE_SERVER: BASE_SERVER, // web服务器地址
    // 获取验证码的超时时间
    DEFAULT_CODE_TIMEOUT: 90,
    // 分页列表每页数据的条数
    PER_PAGE_COUNT: 10,
    NAME_MAX_LENGTH: 10,
    ADDRESS_MAX_LENGTH: 30,
    VERIFICATION_MAX_LENGTH: 6,
    FEEDBACK_MAX_LENGTH: 500,
};

```

* PDDriver/project/App/config/Route.js

```js
'use strict';

const { BASE_SERVER } = CONSTANTS;
const ROOT_SERVER = 'http://' + BASE_SERVER + '/';
const API_SERVER = ROOT_SERVER + 'api/';
const SERVER = API_SERVER + 'driver/';

module.exports = {
    // 登录
    ROUTE_REGISTER: SERVER + 'register', // 注册
    ROUTE_LOGIN: SERVER + 'login', // 登录
    ROUTE_FIND_PASSWORD: SERVER + 'findPassword', // 忘记密码
    ROUTE_MODIFY_PASSWORD: SERVER + 'modifyPassword', // 修改密码
    ROUTE_REQUEST_SEND_VERIFY_CODE: API_SERVER + 'requestSendVerifyCode', // 获取验证码

    // 路上卡车信息
    ROUTE_GET_ON_WAY_TRUCK: SERVER + 'getOnWayTruck', // 获取路上卡车信息
    ROUTE_UPLOAD_LOCATION: SERVER + 'uploadLocation', // 上传卡车位置信息
    ROUTE_CONFIRM_REACH: SERVER + 'confirmReach', // 确认目的地

    // 个人中心
    ROUTE_GET_PERSONAL_INFO: SERVER + 'getPersonalInfo', // 获取个人信息
    ROUTE_MODIFY_PERSONAL_INFO: SERVER + 'modifyPersonalInfo', // 修改个人信息
    ROUTE_SUBMIT_FEEDBACK: SERVER + 'submitFeedback', // 提交信息反馈

    // 文件上传
    ROUTE_UPDATE_FILE: API_SERVER + 'uploadFile', // 上传文件

    // 获取地址
    ROUTE_GET_REGION_ADDRESS_LIST: API_SERVER + 'getRegionAddress', // 获取地址列表
    ROUTE_GET_START_POINT_ADDRESS_LIST: API_SERVER + 'getStartPointAddress', // 获取地址列表

    // 网页地址
    ROUTE_USER_LICENSE: ROOT_SERVER + 'protocals/pddriver/user.html', // 用户协议
    ROUTE_SOFTWARE_LICENSE: ROOT_SERVER + 'protocals/pddriver/software.html', // 获取软件许可协议
    ROUTE_ABOUT_PAGE: ROOT_SERVER + 'protocals/pddriver/about.html', // 关于

    // 下载更新
    ROUTE_VERSION_INFO_URL: ROOT_SERVER + 'apps/pddriver/version.json', // 版本信息地址
    ROUTE_JS_ANDROID_URL: ROOT_SERVER + 'apps/pddriver/jsandroid.zip', // android jsbundle 包地址
    ROUTE_JS_IOS_URL: ROOT_SERVER + 'apps/pddriver/jsios.zip', // ios jsbundle 包地址
    ROUTE_APK_URL: ROOT_SERVER + 'apps/pddriver/pddriver.apk', // apk地址
};

```

* PDDriver/project/App/config/Screen.js

```js
'use strict';

const ReactNative = require('react-native');
const {
    Dimensions,
    PixelRatio,
    Platform,
    NativeModules,
} = ReactNative;

const SCREEN_WIDTH_BASE = 375;
const { width, height } = Dimensions.get('screen') || Dimensions.get('window');
const pxielRatio = PixelRatio.get();
const { TotalNavHeight, NavBarHeight, StatusBarHeight } = Navigator.NavigationBar.Styles.General;
const translucent = NativeModules.SplashScreen.translucent;
const statusBarHeight = (Platform.OS === 'android' && !translucent) ? StatusBarHeight : 0;
const workHeight = height - statusBarHeight;

module.exports = {
    translucent: NativeModules.SplashScreen.translucent,
    tw: width, // 屏幕的真实宽度
    w: SCREEN_WIDTH_BASE, // 屏幕的宽度
    th: workHeight, // 屏幕的真实高度（android不包含状态栏）
    h: workHeight * SCREEN_WIDTH_BASE / width, // 屏幕的高度（android不包含状态栏）
    tfh: height, // 屏幕全屏的真实高度（android包含状态栏）
    fh: height * SCREEN_WIDTH_BASE / width, // 屏幕全屏的高度（android包含状态栏）
    tch: workHeight - TotalNavHeight, // 界面的真实高度
    ch: (workHeight - TotalNavHeight) * SCREEN_WIDTH_BASE / width, // 界面的高度
    trueStatusBarHeight: StatusBarHeight, // android状态栏真实高度
    statusBarHeight: StatusBarHeight * SCREEN_WIDTH_BASE / width, // android状态栏高度
    trueTotalNavHeight: NavBarHeight, // 导航栏的真实高度
    navbarHeight: NavBarHeight * SCREEN_WIDTH_BASE / width, // 导航栏的高度
    trueTotalNavbarHeight: TotalNavHeight, // 导航栏的真实总高度
    totalNavbarHeight: TotalNavHeight * SCREEN_WIDTH_BASE / width, // 导航栏的总高度
    pr: pxielRatio,
    s: (w) => { return w * width / SCREEN_WIDTH_BASE; },
    rs: (w) => { return w * SCREEN_WIDTH_BASE / width; },
};

```

* PDDriver/project/App/manager/JpushMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    NativeAppEventEmitter,
    Platform,
} = ReactNative;
const EventEmitter = require('EventEmitter');
import JPushModule from 'jpush-react-native';
class Manager extends EventEmitter {
    register () {
        if (Platform.OS === 'android') {
            JPushModule.notifyJSDidLoad((resultCode) => {
                if (resultCode === 0) {
                    console.log('--------------notifyJSDidLoad success');
                }
            });
            JPushModule.addReceiveNotificationListener((map) => {
                console.log('------------------addReceiveNotificationListener' + JSON.stringify(map));
                this.emit('receiveJpushNotification', { context:map.alertContent });
                   // var extra = JSON.parse(map.extras);
                   // console.log(extra.key + ": " + extra.value);
            });
        } else {
            this.subscription = NativeAppEventEmitter.addListener(
             'receiveNotification',
             (notification) => {
                 console.log('----------------notification', notification);
                 this.emit('receiveJpushNotification', { context:notification.aps.alert });
             }
           );
        }
    }
    clear () {
        if (this.subscription) {
            this.subscription.remove();
            this.subscription = null;
        }
        JPushModule.removeReceiveCustomMsgListener();
        JPushModule.removeReceiveNotificationListener();
    }
}

module.exports = new Manager();

```

* PDDriver/project/App/manager/LoginMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'LOGIN_HISTORY_LIST';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.list = [];
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let list = [];
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                list = JSON.parse(infoStr);
            } catch (e) {
            }
            this.list = list || [];
        });
    }
    set (list) {
        return new Promise(async(resolve, reject) => {
            this.list = list;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(list));
            resolve();
        });
    }
    savePhone (phone) {
        let list = this.list;
        if (_.includes(list, phone)) {
            list = _.without(list, phone);
        }
        list.unshift(phone);
        this.set(list);
    }
    clear () {
        this.list = [];
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDDriver/project/App/manager/NetMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    Platform,
    NetInfo,
} = ReactNative;
const EventEmitter = require('EventEmitter');

class Manager extends EventEmitter {
    constructor () {
        super();
        this._init = false;
        this.info = {
            connect: false, // 是否连接
            fee: false, // 是否收费
        };
    }
    register () {
        if (!this._init) {
            this._init = true;
            NetInfo.addEventListener(
                'change',
                this._handleConnectionInfoChange.bind(this)
            );
        }
    }
    unregister () {
        NetInfo.removeEventListener(
            'change',
            this._handleConnectionInfoChange.bind(this)
        );
        this._init = false;
    }
    _handleConnectionInfoChange (o) {
        this.updateConnectionInfo(o);
    }
    updateConnectionInfo (o) {
        if (Platform.OS === 'android') {
            if (o === 'WIFI' || o === 'ETHERNET' || o === 'DUMMY') {
                this.info = { connect: true, fee: false };
            } else if (/MOBILE.*/.test(o)) {
                this.info = { connect: true, fee: true };
            } else {
                this.info = { connect: false, fee: false };
            }
        } else {
            if (o === 'wifi') {
                this.info = { connect: true, fee: false };
            } else if (o === 'cell') {
                this.info = { connect: true, fee: true };
            } else {
                this.info = { connect: false, fee: false };
            }
        }
        app.connect = this.info.connect;
        if (!app.connect) {
            // Toast('当前设备已离线，请检查您的网络是否可用');
        }
    }
}

module.exports = new Manager();

```

* PDDriver/project/App/manager/PersonalInfoMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');
const ITEM_NAME = 'personalInfo';
const NEED_LOGIN_ITEM_NAME = 'personalInfoNeedLogin';
const REMAIN_AMOUNR = 'remainAmount';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let info;
            try {
                const needLogin = await AsyncStorage.getItem(NEED_LOGIN_ITEM_NAME);
                this.needLogin = needLogin !== 'false';
                this.remainAmount = await AsyncStorage.getItem(REMAIN_AMOUNR);
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                info = JSON.parse(infoStr);
            } catch (e) {
                this.needLogin = true;
            }
            this.info = info || {};
            this.needLogin = this.needLogin || !info;
            this.remainAmount = this.remainAmount || !info;
            this.initialized = true;
        });
    }
    set (info) {
        this.info = info;
        return new Promise(async(resolve, reject) => {
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(info));
            resolve();
        });
    }
    setUserHead (head) {
        this.emit('USER_HEAD_CHANGE_EVENT', { head:head });
    }
    setNeedLogin (flag) {
        this.needLogin = flag;
        AsyncStorage.setItem(NEED_LOGIN_ITEM_NAME, flag + '');
    }
    setRemainAmount (amount) {
        this.remainAmount = amount;
        AsyncStorage.setItem(REMAIN_AMOUNR, amount + '');
    }
}

module.exports = new Manager();

```

* PDDriver/project/App/manager/SettingMgr.js

```js
'use strict';
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'APP_SETTING_MANAGER';

class Manager extends EventEmitter {
    constructor () {
        super();
        this.data = {};
        this.get();
    }
    get () {
        return new Promise(async(resolve, reject) => {
            let data = {};
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                data = JSON.parse(infoStr);
            } catch (e) {
                data = {};
            }
            this.data = data || {};
            this.THEME_COLOR = this.data.themeColor || CONSTANTS.THEME_COLORS[0];
        });
    }
    set (data) {
        return new Promise(async(resolve, reject) => {
            this.data = data;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(data));
            resolve();
        });
    }
    setOnlyWifiUpload (flag) {
        const data = this.data;
        data.onlyWifiUpload = flag;
        this.set(data);
    }
    setThemeColor (color) {
        const data = this.data;
        data.themeColor = color;
        this.set(data);
        this.THEME_COLOR = color;
        app.update();
    }
    clear () {
        this.data = {};
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDDriver/project/App/manager/UpdateMgr.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    AsyncStorage,
} = ReactNative;
const EventEmitter = require('EventEmitter');

const ITEM_NAME = 'NEED_SHOW_SPLASH';
const Update = require('@remobile/react-native-update');
const UpdateInfoBox = require('../modules/update/UpdateInfoBox');

class Manager extends EventEmitter {
    constructor () {
        super();
        this.needShowSplash = true;
        this.getNeedShowSplash();
    }
    checkUpdate () {
        Update.checkVersion({
            versionUrl: app.route.ROUTE_VERSION_INFO_URL,
            iosAppId: CONSTANTS.IOS_APPID,
        }).then((options) => {
            if (!__DEV__ && options && options.newVersion && (app.scene || {}).pageName !== 'UpdatePage') {
                app.showModal(<UpdateInfoBox options={options} />, { backgroundColor:'rgba(0, 0, 0, 0.6)' });
            }
        });
    }
    getNeedShowSplash () {
        return new Promise(async(resolve, reject) => {
            let needShowSplash;
            try {
                const infoStr = await AsyncStorage.getItem(ITEM_NAME);
                needShowSplash = JSON.parse(infoStr);
            } catch (e) {
            }
            this.needShowSplash = needShowSplash == null ? true : needShowSplash;
            this.initialized = true;
        });
    }
    setNeedShowSplash (needShowSplash) {
        return new Promise(async(resolve, reject) => {
            this.needShowSplash = needShowSplash;
            await AsyncStorage.setItem(ITEM_NAME, JSON.stringify(needShowSplash));
            resolve();
        });
    }
    clear () {
        this.needShowSplash = null;
        AsyncStorage.removeItem(ITEM_NAME);
    }
}

module.exports = new Manager();

```

* PDDriver/project/App/resource/audio.js

```js
module.exports = {};

```

* PDDriver/project/App/resource/image.js

```js
module.exports = {
    common_back:require('./image/common/back.png'),
    common_close:require('./image/common/close.png'),
    common_default:require('./image/common/default.png'),
    common_go:require('./image/common/go.png'),
    common_home:require('./image/common/home.png'),
    common_left_menu:require('./image/common/left_menu.png'),
    common_logo:require('./image/common/logo.png'),
    common_radio:require('./image/common/radio.png'),
    common_search:require('./image/common/search.png'),
    common_search_button:require('./image/common/search_button.png'),
    home_mine:require('./image/home/mine.png'),
    home_mine_press:require('./image/home/mine_press.png'),
    home_position:require('./image/home/position.png'),
    home_position_press:require('./image/home/position_press.png'),
    home_qrcode:require('./image/home/qrcode.png'),
    home_qrcode_press:require('./image/home/qrcode_press.png'),
    login_alipay_button:require('./image/login/alipay_button.png'),
    login_choose:require('./image/login/choose.png'),
    login_logo:require('./image/login/logo.png'),
    login_password:require('./image/login/password.png'),
    login_password_check:require('./image/login/password_check.png'),
    login_password_look:require('./image/login/password_look.png'),
    login_phone:require('./image/login/phone.png'),
    login_qq_button:require('./image/login/qq_button.png'),
    login_unchoose:require('./image/login/unchoose.png'),
    login_weixin_button:require('./image/login/weixin_button.png'),
    personal_add:require('./image/personal/add.png'),
    personal_default_head:require('./image/personal/default_head.png'),
    personal_female:require('./image/personal/female.png'),
    personal_info:require('./image/personal/info.png'),
    personal_male:require('./image/personal/male.png'),
    personal_money:require('./image/personal/money.png'),
    personal_personal_center:require('./image/personal/personal_center.png'),
    personal_scan:require('./image/personal/scan.png'),
    personal_settings:require('./image/personal/settings.png'),
    personal_wallet:require('./image/personal/wallet.png'),
    position_endpoint:require('./image/position/endpoint.png'),
    position_point:require('./image/position/point.png'),
    position_point_green:require('./image/position/point_green.png'),
    splash_logo:require('./image/splash/logo.png'),
    splash_splash1:require('./image/splash/splash1.png'),
    splash_splash2:require('./image/splash/splash2.png'),
    splash_splash3:require('./image/splash/splash3.png'),
    splash_start:require('./image/splash/start.png'),
};

```

* PDDriver/project/App/utils/index.js

```js
const common = require('./common');
const net = require('./net');
const check = require('./check');
const date = require('./date');
const qrcode = require('./qrcode');

module.exports = {
    ...common,
    ...net,
    ...check,
    ...date,
    ...qrcode,
};

```

* PDDriver/project/App/components/ActionSheet/button.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    render () {
        return (
            <TouchableOpacity
                activeOpacity={0.5}
                style={[styles.button, this.props.buttonStyle]}
                onPress={this.props.onPress}>
                <Text style={[styles.buttonText, this.props.textStyle]}>
                    {this.props.children}
                </Text>
            </TouchableOpacity>
        );
    },
});

const styles = StyleSheet.create({
    buttonText: {
        color: '#A1A2A3',
        alignSelf: 'center',
        fontSize: 18,
    },
    button: {
        height: 50,
        backgroundColor: '#FEFFFF',
        borderColor: '#EDEEEF',
        borderBottomWidth: 1,
        alignSelf: 'stretch',
        justifyContent: 'center',
    },
});

```

* PDDriver/project/App/components/ActionSheet/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    TouchableOpacity,
    View,
} = ReactNative;

const Button = require('./button');
const Overlay = require('./overlay');
const Sheet = require('./sheet');

module.exports = React.createClass({
    getDefaultProps () {
        return {
            cancelText: 'Cancel',
        };
    },
    render () {
        return (
            <Overlay visible={this.props.visible}>
                <View style={styles.actionSheetContainer}>
                    <TouchableOpacity
                        style={{ flex:1 }}
                        onPress={this.props.onCancel} />
                    <Sheet visible={this.props.visible}>
                        <View style={styles.buttonContainer}>
                            {this.props.children}
                        </View>
                        <Button
                            buttonStyle={styles.cancelButton}
                            textStyle={styles.cancelText}
                            onPress={this.props.onCancel}>{this.props.cancelText}</Button>
                    </Sheet>
                </View>
            </Overlay>
        );
    },
});
module.exports.Button = Button;

const styles = StyleSheet.create({
    actionSheetContainer: {
        flex: 1,
        padding: 10,
        paddingBottom: 6,
        justifyContent: 'flex-end',
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
    },
    buttonContainer: {
        borderRadius:6,
        overflow: 'hidden',
    },
    cancelButton: {
        marginTop:6,
        marginBottom:6,
        borderRadius:6,
        backgroundColor: '#A0D26F',
        borderBottomWidth: 0,
    },
    cancelText: {
        color:'#FFFFFF',
    },
});

```

* PDDriver/project/App/components/ActionSheet/overlay.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Animated,
    StyleSheet,
} = ReactNative;

const DEFAULT_ANIMATE_TIME = 300;

module.exports = React.createClass({
    getInitialState () {
        return {
            fadeAnim: new Animated.Value(0),
            overlayStyle: styles.emptyOverlay, // on android opacity=0 also can cover screen, so use overlayStyle fix it
        };
    },
    onAnimatedEnd () {
        !this.props.visible && this.setState({ overlayStyle:styles.emptyOverlay });
    },
    componentWillReceiveProps (newProps) {
        newProps.visible && this.setState({ overlayStyle: styles.fullOverlay });
        return Animated.timing(this.state.fadeAnim, {
            toValue: newProps.visible ? 1 : 0,
            duration: DEFAULT_ANIMATE_TIME,
        }).start(this.onAnimatedEnd);
    },

    render () {
        return (
            <Animated.View style={[this.state.overlayStyle, { opacity: this.state.fadeAnim }]}>
                {this.props.children}
            </Animated.View>
        );
    },
});

const styles = StyleSheet.create({
    fullOverlay: {
        top: 0,
        bottom: 0,
        left: 0,
        right: 0,
        backgroundColor: 'transparent',
        position: 'absolute',
    },
    emptyOverlay: {
        backgroundColor: 'transparent',
        position: 'absolute',
        left: -sr.w,
    },
});

```

* PDDriver/project/App/components/ActionSheet/sheet.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Animated,
} = ReactNative;

const DEFAULT_BOTTOM = -300;
const DEFAULT_ANIMATE_TIME = 300;

module.exports = React.createClass({
    getInitialState () {
        return {
            bottom: new Animated.Value(DEFAULT_BOTTOM),
        };
    },
    componentWillReceiveProps (newProps) {
        return Animated.timing(this.state.bottom, {
            toValue: newProps.visible ? 0 : DEFAULT_BOTTOM,
            duration: DEFAULT_ANIMATE_TIME,
        }).start();
    },

    render () {
        return (
            <Animated.View style={{ bottom: this.state.bottom }}>
                {this.props.children}
            </Animated.View>
        );
    },
});

```

* PDDriver/project/App/modules/baidumap/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

import { MapView, MapTypes, Geolocation } from '@remobile/react-native-baidu-map';

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '货物所在地',
    },
    getInitialState () {
        return {
            mayType: MapTypes.NORMAL,
            zoom: 15,
            center: {
                longitude: 106.6886,
                latitude: 26.566621,
            },
            trafficEnabled: false,
            baiduHeatMapEnabled: false,
            marker: {
                longitude: 106.6886,
                latitude: 26.566621,
                title: '花果园',
                city:'贵阳市',
                province:'贵州省',
            },
        };
    },
    componentWillMount () {
        Geolocation.getCurrentPosition()
            .then(data => {
                console.warn(JSON.stringify(data));
                this.setState({
                    zoom: 15,
                    marker: {
                        latitude: data.latitude,
                        longitude: data.longitude,
                        title: data.address,
                        city:data.city,
                        province:data.province,
                    },
                    center: {
                        latitude: data.latitude,
                        longitude: data.longitude,
                        rand: Math.random(),
                    },
                });
            })
            .catch(e => {
                console.warn(e, 'error');
            });
    },
    render () {
        const { marker } = this.state;
        return (
            <View style={styles.container}>
                <View>
                    <Text style={styles.selectPositionText}>{marker.title}</Text>
                    <Button onPress={() => { this.props.confirm(marker); app.pop(); }} style={styles.btnConfirm} >
                        确认货物所在地
                    </Button>
                </View>
                <MapView
                    trafficEnabled={this.state.trafficEnabled}
                    baiduHeatMapEnabled={this.state.baiduHeatMapEnabled}
                    zoom={this.state.zoom}
                    mapType={this.state.mapType}
                    center={this.state.center}
                    marker={this.state.marker}
                    markers={this.state.markers}
                    style={styles.map}
                    onMarkerClick={(data) => {
                        console.warn('onMarkerClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.position.latitude, data.position.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.position.latitude,
                                        longitude: data.position.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                    onMapPoiClick={(data) => {
                        console.warn('onMapPoiClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                    onMapClick={(data) => {
                        console.warn('onMapClick', JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                        city:e.city,
                                        province:e.province,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}

                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'flex-start',
        alignItems: 'center',
        backgroundColor: '#F5FCFF',
    },
    map: {
        width: sr.w,
        height: sr.h - 150,
        marginBottom: 50,
        marginTop:10,
        backgroundColor: 'red',
    },
    selectPositionText :{
        paddingVertical:12,
        alignSelf:'center',
        fontSize:16,
    },
    btnConfirm:{
        height:35,
        width:200,
        borderRadius:2,
    },
});

```

* PDDriver/project/App/modules/baidumap/test.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Button,
} = ReactNative;

import { MapView, MapTypes, Geolocation } from '@remobile/react-native-baidu-map';

const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    componentWillMount () {
        SplashScreen.hide();
    },
    getInitialState () {
        return {
            mayType: MapTypes.NORMAL,
            zoom: 15,
            center: {
                longitude: 113.981718,
                latitude: 22.542449,
            },
            trafficEnabled: false,
            baiduHeatMapEnabled: false,
            markers: [{
                longitude: 113.981718,
                latitude: 22.542449,
                title: 'Window of the world',
            }, {
                longitude: 113.995516,
                latitude: 22.537642,
                title: '',
            }],
        };
    },
    render () {
        return (
            <View style={styles.container}>
                <MapView
                    trafficEnabled={this.state.trafficEnabled}
                    baiduHeatMapEnabled={this.state.baiduHeatMapEnabled}
                    zoom={this.state.zoom}
                    mapType={this.state.mapType}
                    center={this.state.center}
                    marker={this.state.marker}
                    markers={this.state.markers}
                    style={styles.map}
                    onMarkerClick={(e) => {
                        console.warn(JSON.stringify(e));
                    }}
                    onMapPoiClick={(e) => {
                        console.warn('onMapPoiClick', JSON.stringify(e));
                        this.setState({
                            zoom: 15,
                            marker: {
                                latitude: e.latitude,
                                longitude: e.longitude,
                                title: e.name,
                            },
                        });
                    }}
                    onMapClick={(data) => {
                        console.warn(JSON.stringify(data));
                        Geolocation.reverseGeoCodeGPS(data.latitude, data.longitude)
                            .then(e => {
                                console.warn(JSON.stringify(e));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: e.address,
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}

                    />
                <View style={styles.row}>
                    <Button title='Normal' onPress={() => {
                        this.setState({
                            mapType: MapTypes.NORMAL,
                        });
                    }}
                        />
                    <Button style={styles.btn} title='Satellite' onPress={() => {
                        this.setState({
                            mapType: MapTypes.SATELLITE,
                        });
                    }}
                        />

                    <Button style={styles.btn} title='Locate' onPress={() => {
                        console.warn('center', this.state.center);
                        Geolocation.getCurrentPosition()
                            .then(data => {
                                console.warn(JSON.stringify(data));
                                this.setState({
                                    zoom: 15,
                                    marker: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        title: 'Your location',
                                    },
                                    center: {
                                        latitude: data.latitude,
                                        longitude: data.longitude,
                                        rand: Math.random(),
                                    },
                                });
                            })
                            .catch(e => {
                                console.warn(e, 'error');
                            });
                    }}
                        />
                </View>

                <View style={styles.row}>
                    <Button title='Zoom+' onPress={() => {
                        this.setState({
                            zoom: this.state.zoom + 1,
                        });
                    }}
                        />
                    <Button title='Zoom-' onPress={() => {
                        if (this.state.zoom > 0) {
                            this.setState({
                                zoom: this.state.zoom - 1,
                            });
                        }
                    }}
                        />
                </View>

                <View style={styles.row}>
                    <Button title='Traffic' onPress={() => {
                        this.setState({
                            trafficEnabled: !this.state.trafficEnabled,
                        });
                    }}
                        />

                    <Button title='Baidu HeatMap' onPress={() => {
                        this.setState({
                            baiduHeatMapEnabled: !this.state.baiduHeatMapEnabled,
                        });
                    }}
                        />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'flex-start',
        alignItems: 'center',
        backgroundColor: '#F5FCFF',
    },
    row: {
        flexDirection: 'row',
        height: 40,
    },
    map: {
        width: sr.w,
        height: sr.h / 2,
        marginBottom: 50,
        backgroundColor: 'red',
    },
    closeTouchableHighlight: {
        position:'absolute',
        top:0,
        left:sr.w * 6 / 7 + 3,
        width: 38,
        height: 38,
        marginTop: (sr.h - 200 - 20) / 2,
    },
    closeIcon: {
        width: 38,
        height: 38,
    },
});

```

* PDDriver/project/App/modules/common/CellPhoneBox.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Text,
    View,
    Linking,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    openPhone () {
        app.closeModal();
        Linking.canOpenURL('tel:' + this.props.phoneNum).then(supported => {
            if (!supported) {
                console.log('Can\'t handle url: ' + this.props.phoneNum);
            } else {
                return Linking.openURL('tel:' + this.props.phoneNum);
            }
        }).catch(err => console.error('An error occurred', err));
    },
    render () {
        return (
            <View style={styles.overlayContainer}>
                <TouchableOpacity
                    activeOpacity={1}
                    style={styles.container}>
                    <View style={styles.topView}>
                        <Text style={styles.titleText}>
                            {'拨打电话'}
                        </Text>
                    </View>
                    <TouchableOpacity
                        onPress={this.openPhone}
                        style={styles.btnView}>
                        <Text style={styles.phoneText}>
                            {this.props.phoneNum}
                        </Text>
                    </TouchableOpacity>
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        height: 114,
        width: sr.w - 50,
        borderRadius: 4,
        backgroundColor: '#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    overlayContainer: {
        position:'absolute',
        top: 0,
        alignItems:'center',
        justifyContent: 'center',
        width:sr.w,
        height:sr.h,
    },
    titleText: {
        fontSize: 24,
        color: '#444444',
        backgroundColor: 'transparent',
    },
    topView: {
        height: 47,
        width: sr.w - 50,
        alignItems:'center',
        justifyContent:'center',
    },
    btnView: {
        height: 57,
        width: sr.w - 50,
        alignItems:'center',
        justifyContent:'center',
    },
    phoneText: {
        fontSize: 18,
        color: '#666666',
        backgroundColor: 'transparent',
    },
});

```

* PDDriver/project/App/modules/common/ImageCrop.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    ImageStore,
    ImageEditor,
} = ReactNative;

const ImageCrop = require('@remobile/react-native-image-crop');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '编辑图片',
        rightButton: { title: '完成', handler: () => {
            app.scene.cropImage();
        } },
    },
    goBack () {
        app.pop();
    },
    cropImage () {
        const { image } = this.props;
        const cropData = this.imageCrop.getCropData();
        ImageEditor.cropImage(
            image.uri,
            cropData,
            (croppedImageURI) => {
                this.uploadImage(croppedImageURI);
            },
            (error) => {
                Toast('文件出错');
                this.goBack();
            }
        );
    },
    uploadImage (filePath) {
        if (app.isandroid) {
            const options = {};
            options.fileKey = 'file';
            options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
            options.mimeType = 'image/png';
            options.params = {
                userId:app.personal.info.userId,
            };
            UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
        } else {
            ImageStore.getBase64ForTag(filePath, (data) => {
                data = 'data:image/png;base64,' + data;
                const options = {};
                options.fileKey = 'file';
                options.fileName = 'image.png';
                options.mimeType = 'image/png';
                options.params = {
                    userId:app.personal.info.userId,
                };
                ImageStore.removeImageForTag(filePath);
                UPLOAD(data, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
            }, () => {
                Toast('文件出错');
                this.goBack();
            });
        }
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            this.props.onCropImage(data.context.url);
            this.goBack();
        } else {
            Toast('上传头像失败');
            this.goBack();
        }
    },
    uploadErrorCallback () {
        Toast('上传头像失败');
        this.goBack();
    },
    render () {
        const { image } = this.props;
        return (
            <View style={styles.container}>
                <ImageCrop
                    imageWidth={image.width}
                    imageHeight={image.height}
                    editRectRadius={0}
                    ref={(ref) => { this.imageCrop = ref; }}
                    source={{ uri: image.uri }} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
});

```

* PDDriver/project/App/modules/common/ImagePicker.js

```js
const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
} = ReactNative;

const CameraRollPicker = require('@remobile/react-native-camera-roll-picker');
const Camera = require('@remobile/react-native-camera');
const ImageCrop = require('./ImageCrop');

module.exports = React.createClass({
    statics: {
        title: '选择头像',
    },
    cropImage (image) {
        app.navigator.replace({
            component: ImageCrop,
            passProps: {
                image,
                onCropImage: this.props.onCropImage,
            },
        });
    },
    onSelectedImages (images, image) {
        this.cropImage(image);
    },
    openCamera () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.cropImage({
                    uri,
                    width,
                    height,
                });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    render () {
        return (
            <CameraRollPicker selected={[]} onSelectedImages={this.onSelectedImages} openCamera={this.openCamera} maximum={1} />
        );
    },
});

```

* PDDriver/project/App/modules/common/SelectClient.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入关键字搜索用户'
                    defaultValue={searchText}
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
        rightButton: { title: '搜索', handler: () => { app.scene.refresh(); } },
    },
    getInitialState () {
        return {
            keyword: '',
        };
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    onRowSelect (obj) {
        this.props.onSelect(obj);
        app.pop();
    },
    renderRow (obj, sectionID, rowID) {
        const { userId } = this.props;
        const { name, head, email, address, phone, reservePhone } = obj;
        return (
            <TouchableOpacity style={styles.row} onPress={this.onRowSelect.bind(null, obj)}>
                <View style={styles.leftContainer}>
                    <View style={styles.nameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={head ? { uri: head } : app.img.personal_default_head}
                            style={styles.head} />
                        <Text style={styles.name}>{name ? `${name} ( ${phone} )` : phone }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>邮箱：</Text>
                        <Text style={styles.name}>{ email || '无' }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>住址：</Text>
                        <Text style={styles.name}>{ address || '无' }</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text style={styles.label}>预留电话：</Text>
                        <Text style={styles.name}>{ reservePhone ? reservePhone.join('; ') : '无' }</Text>
                    </View>
                </View>
                {
                    obj.userId === userId &&
                    <Image resizeMode='stretch' source={app.img.common_radio} style={styles.icon} />
                }
            </TouchableOpacity>
        );
    },
    render () {
        const { keyword } = this.state;
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, keyword }}
                    listName={'clientList'}
                    listUrl={app.route.ROUTE_GET_CLIENT_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    searchContainer: {
        height: 30,
        width: 250,
        paddingVertical: 2,
        borderRadius: 105,
        backgroundColor: '#E5E5E5',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        height: 25,
        width: 220,
        fontSize: 14,
        marginLeft: 5,
        overflow: 'hidden',
        alignItems:'center',
    },
    iconSearch: {
        height: 20,
        width: 20,
    },
    row: {
        paddingHorizontal: 8,
        paddingVertical: 10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    leftContainer: {
        flex: 1,
    },
    nameContainer: {
        marginTop: 10,
        flexDirection: 'row',
        paddingHorizontal: 10,
        alignItems: 'center',
    },
    head: {
        width: 30,
        height: 30,
        borderRadius: 15,
        marginRight: 5,
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    label: {
        fontSize: 14,
        color: '#8B8B7A',
        marginLeft: 34,
    },
    icon: {
        width: 20,
        height: 16,
    },
});

```

* PDDriver/project/App/modules/common/SelectRoadmap.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TextInput,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

let searchText = '';
const Title = React.createClass({
    render () {
        return (
            <View style={styles.searchContainer}>
                <Image
                    resizeMode='cover'
                    source={app.img.common_search_button}
                    style={styles.iconSearch} />
                <TextInput
                    placeholder='输入关键字搜索路线'
                    defaultValue={searchText}
                    onChangeText={(text) => { searchText = text; }}
                    onSubmitEditing={this.props.doStartSearch}
                    style={styles.searchTextInput}
                    />
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: (<Title doStartSearch={() => { app.scene.doStartSearch(); }} />),
        rightButton: { title: '搜索', handler: () => { app.scene.refresh(); } },
    },
    getInitialState () {
        return {
            keyword: '',
        };
    },
    refresh () {
        this.setState({ keyword: searchText }, () => {
            this.listView.refresh();
        });
    },
    onRowSelect (obj) {
        this.props.onSelect(obj);
        app.pop();
    },
    renderRow (obj, sectionID, rowID) {
        const { roadmapId } = this.props;
        const { name, type, shipperName, shipperLogo, startPoint, endPoint, transitPoint, price, duration } = obj;
        return (
            <TouchableOpacity style={styles.row} onPress={this.onRowSelect.bind(null, obj)}>
                <View style={styles.leftContainer}>
                    <View style={styles.shipperNameContainer}>
                        <Image
                            resizeMode='stretch'
                            source={{ uri: shipperLogo }}
                            style={styles.shipperLogo} />
                        <Text numberOfLines={1} style={styles.shipperName}>{shipperName}</Text>
                    </View>
                    <View style={styles.nameContainer}>
                        <Text numberOfLines={1} style={styles.name}>{name}</Text>
                        <Text numberOfLines={1} style={[styles.type, { color: type === 0 ? '#228B22' : '#FF4500' }]}>{type === 0 ? '整车' : '零担'}</Text>
                    </View>
                    <View style={styles.pointContainer}>
                        <Text style={styles.name}>{startPoint.name}</Text>
                        {!!transitPoint[0] && <Text style={styles.name}>→</Text>}
                        {!!transitPoint[0] && <Text style={styles.name}>{transitPoint[0].name}</Text>}
                        <Text style={styles.name}>→</Text>
                        <Text style={styles.name}>{endPoint.name}</Text>
                    </View>
                    <View style={styles.priceContainer}>
                        <Text style={styles.name}><Text style={{ color: '#DAA520' }}>{price}</Text>元/{type === 0 ? '车' : '吨'}</Text>
                        <Text style={styles.name}>历时<Text style={{ color: '#FF4500' }}>{duration}</Text>小时</Text>
                    </View>
                </View>
                {
                    obj.id === roadmapId &&
                    <Image resizeMode='stretch' source={app.img.common_radio} style={styles.icon} />
                }
            </TouchableOpacity>
        );
    },
    render () {
        const { keyword } = this.state;
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId, keyword }}
                    listName={'roadmapList'}
                    listUrl={app.route.ROUTE_GET_ROADMAP_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#FFFFFF',
    },
    searchContainer: {
        height: 30,
        width: 250,
        paddingVertical: 2,
        borderRadius: 105,
        backgroundColor: '#E5E5E5',
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    searchTextInput: {
        height: 25,
        width: 220,
        fontSize: 14,
        marginLeft: 5,
        overflow: 'hidden',
        alignItems:'center',
    },
    iconSearch: {
        height: 20,
        width: 20,
    },
    row: {
        paddingHorizontal: 8,
        paddingVertical: 10,
        flexDirection: 'row',
        alignItems: 'center',
    },
    leftContainer: {
        flex: 1,
    },
    shipperNameContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    shipperContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        marginTop: 20,
        marginLeft: 10,
    },
    shipperLogo: {
        width: 20,
        height: 20,
        borderRadius: 10,
        marginRight: 5,
    },
    shipperName: {
        fontSize: 14,
        color: 'gray',
    },
    nameContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
        alignItems: 'center',
    },
    name: {
        fontSize: 14,
        color: 'gray',
    },
    type: {
        fontSize: 14,
    },
    pointContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
    },
    priceContainer: {
        marginTop: 10,
        flexDirection: 'row',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
    },
    icon: {
        width: 20,
        height: 16,
    },
});

```

* PDDriver/project/App/modules/common/ShowBigImage.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
} = ReactNative;

import Swiper from 'react-native-swiper';

module.exports = React.createClass({
    getInitialState () {
        const list = [];
        const list1 = [];
        this.props.defaultImageArray.map((item, i) => {
            if (i >= this.props.defaultIndex) {
                list1.push(item);
            } else {
                list.push(item);
            }
        });
        return {
            imageList: list1.concat(list),
        };
    },
    render () {
        return (
            <View style={styles.overlayContainer}>
                <Swiper
                    paginationStyle={styles.paginationStyle}
                    height={sr.th}>
                    {
                           this.state.imageList.map((item, i) => {
                               return (
                                   <TouchableOpacity
                                       key={i}
                                       activeOpacity={1}
                                       onPress={app.closeModal}
                                       style={styles.imageContainer}>
                                       <Image
                                           resizeMode='contain'
                                           defaultSource={app.img.common_default}
                                           source={{ uri: item }}
                                           style={styles.bannerImage}
                                           />
                                   </TouchableOpacity>
                               );
                           })
                       }
                </Swiper>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    overlayContainer: {
        flex: 1,
        alignItems:'center',
        justifyContent: 'center',
    },
    paginationStyle: {
        bottom: 30,
    },
    imageContainer: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    bannerImage: {
        alignSelf: 'center',
        width: sr.w,
        flex: 1,
    },
});

```

* PDDriver/project/App/modules/home/index.js

```js
'use strict';
const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
} = ReactNative;

import TabNavigator from 'react-native-tab-navigator';
import { Geolocation } from '@remobile/react-native-baidu-map';
const Position = require('../position');
const Qrcode = require('../qrcode');
const Person = require('../person');
const schedule = require('node-cron');

const INIT_ROUTE_INDEX = 0;
const ROUTE_STACK = [
    { index: 0, component: Position },
    { index: 1, component: Qrcode },
    { index: 2, component: Person },
];

const HomeTabBar = React.createClass({
    componentWillMount () {
        app.showMainScene = (i) => {
            const { title, leftButton, rightButton } = _.find(ROUTE_STACK, (o) => o.index === i).component;
            Object.assign(app.getCurrentRoute().component, {
                title: title,
                leftButton: leftButton,
                rightButton: rightButton,
            });
            this.props.onTabIndex(i);
            app.forceUpdateNavbar();
        };
    },
    componentDidMount () {
        app.hasLoadMainPage = true;
        app.toggleNavigationBar(true);
        this.setSchedule();
    },
    componentWillUnmount () {
        app.hasLoadMainPage = false;
        this.task.destroy();
    },
    getInitialState () {
        return {
            tabIndex: this.props.initTabIndex,
        };
    },
    handleWillFocus (route) {
        const tabIndex = route.index;
        this.setState({ tabIndex });
    },
    setSchedule () {
        // this.task = schedule.schedule('0 1,3,5,7,9,11,13,15,17,19,21,23 * * *', function () {
        this.task = schedule.schedule('*/30 * * * * *', function () {
            Geolocation.getCurrentPosition()
                .then(data => {
                    console.warn(JSON.stringify(data));
                    const param = {
                        userId: app.personal.info.userId,
                        address:data.address || '未知',
                        latitude:data.latitude,
                        longitude:data.longitude,
                    };
                    POST(app.route.ROUTE_UPLOAD_LOCATION, param, () => {}, null);
                })
                .catch(e => {
                    console.warn(e, 'error');
                });
        });
    },
    render () {
        const menus = [
            { index: 0, title: '位置', icon: app.img.home_position, selected: app.img.home_position_press },
            { index: 1, title: '二维码', icon: app.img.home_qrcode, selected: app.img.home_qrcode_press },
            { index: 2, title: '我的', icon: app.img.home_mine, selected: app.img.home_mine_press },
        ];
        const TabNavigatorItems = menus.map((item) => {
            return (
                <TabNavigator.Item
                    key={item.index}
                    selected={this.state.tabIndex === item.index}
                    title={item.title}
                    titleStyle={styles.titleStyle}
                    selectedTitleStyle={styles.titleSelectedStyle}
                    renderIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.icon}
                            style={styles.icon} />
                    }
                    renderSelectedIcon={() =>
                        <Image
                            resizeMode='stretch'
                            source={item.selected}
                            style={styles.icon} />
                    }
                    onPress={() => {
                        app.showMainScene(item.index);
                    }}>
                    <View />
                </TabNavigator.Item>
            );
        });
        return (
            <View style={styles.tabs}>
                <TabNavigator
                    tabBarStyle={styles.tabBarStyle}
                    tabBarShadowStyle={styles.tabBarShadowStyle}
                    hidesTabTouch >
                    {TabNavigatorItems}
                </TabNavigator>
            </View>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: ROUTE_STACK[INIT_ROUTE_INDEX].component.title,
        leftButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.leftButton,
        rightButton: ROUTE_STACK[INIT_ROUTE_INDEX].component.rightButton,
    },
    getChildScene () {
        return this.scene;
    },
    renderScene (route, navigator) {
        return <route.component ref={(ref) => { if (ref)route.ref = ref; }} />;
    },
    render () {
        return (
            <Navigator
                debugOverlay={false}
                style={styles.container}
                ref={(navigator) => {
                    this._navigator = navigator;
                }}
                initialRoute={ROUTE_STACK[INIT_ROUTE_INDEX]}
                initialRouteStack={ROUTE_STACK}
                renderScene={this.renderScene}
                onDidFocus={(route) => {
                    const ref = this.scene = app.scene = route.ref;
                    ref && ref.onDidFocus && ref.onDidFocus();
                }}
                onWillFocus={(route) => {
                    if (this._navigator) {
                        const { routeStack, presentedIndex } = this._navigator.state;
                        const preRoute = routeStack[presentedIndex];
                        if (preRoute) {
                            const preRef = preRoute.ref;
                            preRef && preRef.onWillHide && preRef.onWillHide();
                        }
                    }
                    const ref = route.ref;
                    ref && ref.onWillFocus && ref.onWillFocus(true); // 注意：因为有initialRouteStack，在mounted的时候所有的页面都会加载，因此只有第一个页面首次不会调用，需要在componentDidMount中调用，其他页面可以调用
                }}
                configureScene={(route) => ({
                    ...app.configureScene(route),
                })}
                navigationBar={
                    <HomeTabBar
                        initTabIndex={INIT_ROUTE_INDEX}
                        onTabIndex={(index) => {
                            this._navigator.jumpTo(_.find(ROUTE_STACK, (o) => o.index === index));
                        }}
                        />
                }
                />
        );
    },
});

const styles = StyleSheet.create({
    container: {
        overflow: 'hidden',
        flex: 1,
    },
    tabs: {
        height: 50,
        width: sr.w,
        left: 0,
        bottom:0,
    },
    titleStyle: {
        fontSize:10,
        color: '#929292',
    },
    titleSelectedStyle: {
        fontSize:10,
        color: '#DF3932',
    },
    tabBarStyle: {
        borderColor: '#EEEEEE',
        borderTopWidth: 1,
        height:50,
        backgroundColor: '#FEFCFD',
        alignItems: 'center',
    },
    tabBarShadowStyle: {
        height: 1,
        backgroundColor: '#EEEEEE',
    },
    icon: {
        width:22,
        height:22,
    },
});

```

* PDDriver/project/App/modules/login/ForgetPassword.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
const PasswordConfirm = require('./PasswordConfirm');
const TimerMixin = require('react-timer-mixin');

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '忘记密码',
    },
    getInitialState () {
        return {
            phone:'',
            readSecond:false,
            time:59,
            verifyCode:'',
        };
    },
    doPress () {
        const { phone } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        };
        const param = {
            phone,
        };
        POST(app.route.ROUTE_REQUEST_SEND_VERIFY_CODE, param, this.requestSendVerifyCodeSuccess, false);
    },
    timer () {
        this.setState({ readSecond:true });
        this.setTimeout(
            () => {
                this.setState({ time:(this.state.time - 1) });
                if (this.state.time <= 0) {
                    return this.setState({ readSecond:false, time:59 });
                }
                this.timer();
            },
            1000
        );
    },
    requestSendVerifyCodeSuccess (data) {
        if (data.success) {
            this.timer();
        } else {
            Toast(data.msg);
        }
    },
    doNext () {
        const { phone, verifyCode } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        };
        if (!verifyCode) {
            Toast('请填写验证码');
            return;
        }
        if (!app.utils.checkVerificationCode(verifyCode)) {
            Toast('请填写正确的验证码');
            return;
        }
        app.push({
            component:PasswordConfirm,
            passProps:{
                phone,
                verifyCode,
            },
        });
    },
    render () {
        const { readSecond } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.ItemBgTop}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_phone}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请填写手机号码'
                            underlineColorAndroid='transparent'
                            keyboardType='numeric'
                            maxLength={11}
                            onChangeText={(text) => this.setState({ phone: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请填写验证码'
                            keyboardType='numeric'
                            maxLength={CONSTANTS.VERIFICATION_MAX_LENGTH}
                            underlineColorAndroid='transparent'
                            onChangeText={(text) => this.setState({ verifyCode: text })}
                            style={styles.itemNameText} />
                        <TouchableOpacity
                            disabled={readSecond}
                            onPress={this.doPress}
                            style={styles.btnBind}>
                            { !readSecond ?
                                <View style={styles.btnContainer}>
                                    <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>获取验证码</Text>
                                </View>
                                :
                                <View style={styles.btnContainerGray}>
                                    <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>{this.state.time}s后重新发送</Text>
                                </View>
                            }
                        </TouchableOpacity>
                    </View>
                </View>
                <Button onPress={this.doNext}
                    style={styles.btnNext}
                    textStyle={styles.btnNextText} >
                    下一步
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBgTop: {
        height: 45,
        marginTop:10,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    ItemBg: {
        height: 45,
        marginTop:1,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        alignItems:'center',
        justifyContent: 'space-between',
    },
    icon_add:{
        width:25,
        height:25,
        marginLeft: 8,
    },
    itemNameText: {
        flex:1,
        fontSize: 14,
        color: '#444444',
        marginLeft: 10,
    },

    btnNext:{
        marginTop:50,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnNextText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
    btnBind:{
        height:45,
        width:137,
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        alignItems:'center',
    },
    btnContainer:{
        height:45,
        alignItems:'center',
        justifyContent:'center',
        width:137,
    },
    btnBindText:{
        color:'#FF981A',
        fontSize:14,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
    },
    btnContainerGray:{
        height:45,
        width:137,
        alignItems:'center',
        justifyContent:'center',
        backgroundColor:'#fafafa',
    },
    btnBindTextGray:{
        color:'#999999',
        backgroundColor:'#fafafa',
        fontSize:14,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
    },
});

```

* PDDriver/project/App/modules/login/Login.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    Image,
    View,
    TextInput,
    ListView,
    Text,
    TouchableOpacity,
} = ReactNative;

const ForgetPassword = require('./ForgetPassword');
const Register = require('./Register');
const home = require('../home/index');

const { Button } = COMPONENTS;

const WeixinQQPanel = React.createClass({
    render () {
        return (
            <View style={styles.thirdpartyContainer}>
                <View style={styles.sepratorContainer}>
                    <View style={styles.sepratorLine} />
                    <Text style={styles.sepratorText} >{app.isandroid ? '    ' : ''}或者您也可以</Text>
                </View>
                <View style={styles.thirdpartyButtonContainer}>
                    {
                        !!this.props.weixininstalled &&
                        <View style={styles.thirdpartyLeftButtonContainer}>
                            <Image
                                resizeMode='stretch'
                                source={app.img.login_weixin_button}
                                style={styles.image_button}
                                />
                            <Text style={styles.image_button_text}>微信登录</Text>
                        </View>
                    }
                    {
                        !!this.props.qqinstalled &&
                        <View style={styles.thirdpartyRightButtonContainer}>
                            <Image
                                resizeMode='stretch'
                                source={app.img.login_qq_button}
                                style={styles.image_button}
                                />
                            <Text style={styles.image_button_text}>QQ登录</Text>
                        </View>
                    }
                </View>
            </View>
        );
    },
});

const NoWeixinQQPanel = React.createClass({
    render () {
        return (
            <View style={styles.thirdpartyContainer2}>
                <Text style={[styles.thirdpartyContainer2_text, { color: app.setting.THEME_COLOR }]} />
            </View>
        );
    },
});

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '',
    },
    componentDidMount () {
        app.toggleNavigationBar(true);
    },
    doLogin () {
        const { phone, password } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('手机号码不是有效的手机号码');
            return;
        }
        if (!app.utils.checkPassword(password)) {
            Toast('密码必须有6-20位的数字，字母，下划线组成');
            return;
        }
        const param = {
            phone,
            password,
        };
        app.showLoading();
        POST(app.route.ROUTE_LOGIN, param, this.doLoginSuccess, this.doLoginError);
    },
    doLoginSuccess (data) {
        if (data.success) {
            app.personal.info.userId = data.context.userId;
            app.login.savePhone(this.state.phone);
            this.getPersonalInfo();
        } else {
            Toast(data.msg);
            app.hideLoading();
        }
    },
    doLoginError (error) {
        app.hideLoading();
    },
    doShowForgetPassword () {
        app.push({
            component: ForgetPassword,
            passProps: {
                phone: this.state.phone,
            },
        });
    },
    doShowRegister () {
        app.push({
            component: Register,
            passProps: {
                phone: this.state.phone,
                changeToLoginPanel: this.changeToLoginPanel,
            },
        });
    },
    getPersonalInfo () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_PERSONAL_INFO, param, this.getPersonalInfoSuccess, this.getPersonalInfoError);
    },
    getPersonalInfoSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.set(context);
            app.personal.get();
            app.navigator.replace({
                component: home,
            });
            app.personal.setNeedLogin(false);
        } else {
            Toast(data.msg);
        }
        app.hideLoading();
    },
    getPersonalInfoError (error) {
        app.hideLoading();
    },
    getInitialState () {
        const ds = new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 });
        return {
            phone: app.login.list[0] || '',
            password: '',
            dataSource: ds.cloneWithRows(app.login.list),
            showList: false,
            weixininstalled: false,
            qqinstalled: false,
        };
    },
    changeToLoginPanel (phone) {
        this.setState({ phone });
    },
    onPhoneTextInputLayout (e) {
        const frame = e.nativeEvent.layout;
        this.listTop = frame.y + frame.height;
    },
    renderRow (text) {
        return (
            <TouchableOpacity onPress={() => this.setState({ phone: text, showList:false })}>
                <View style={styles.itemTextContainer}>
                    <Text style={styles.itemText}>
                        {text}
                    </Text>
                </View>
            </TouchableOpacity>
        );
    },
    renderSeparator (sectionID, rowID) {
        return (
            <View style={styles.separator} key={sectionID + rowID} />
        );
    },
    onFocus () {
        this.setState({ showList: this.state.dataSource.getRowCount() > 0 && this.state.dataSource.getRowData(0, 0).length < 11 });
    },
    onBlur () {
        this.setState({ showList: false });
    },
    onPhoneTextChange (text) {
        const dataSource = this.state.dataSource;
        const newData = _.filter(app.login.list, (item) => { const reg = new RegExp('^' + text + '.*'); return reg.test(item); });
        this.setState({
            phone: text,
            dataSource: dataSource.cloneWithRows(newData),
            showList: newData.length > 0 && text.length < 11,
        });
    },
    render () {
        const row = this.state.dataSource.getRowCount();
        const listHeight = row > 4 ? styles.listHeightMax : row < 2 ? styles.listHeightMin : null;
        return (
            <View style={styles.container}>
                <View style={styles.logoContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.login_logo}
                        style={styles.logo}
                        />
                </View>
                <View style={styles.loginBox}>
                    <View
                        style={styles.phoneContainer}
                        onLayout={this.onPhoneTextInputLayout}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.login_phone}
                            style={styles.input_icon}
                            />
                        <TextInput
                            underlineColorAndroid='transparent'
                            placeholder='您的手机号码'
                            maxLength={11}
                            onChangeText={this.onPhoneTextChange}
                            defaultValue={this.state.phone}
                            style={styles.text_input}
                            keyboardType='phone-pad'
                            onFocus={this.onFocus}
                            onBlur={this.onBlur}
                            />
                    </View>
                    <View style={styles.listView} />
                    <View style={styles.passwordContainer}
                        >
                        <Image
                            resizeMode='stretch'
                            source={app.img.login_password}
                            style={styles.input_icon}
                            />
                        <TextInput
                            underlineColorAndroid='transparent'
                            placeholder='您的密码'
                            secureTextEntry
                            onChangeText={(text) => this.setState({ password: text })}
                            defaultValue={this.state.password}
                            style={styles.text_input}
                            />
                    </View>
                </View>

                <View style={styles.un_loading} >
                    <TouchableOpacity onPress={this.doShowRegister}>
                        <Text style={styles.register}>新用户注册</Text>
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.doShowForgetPassword}>
                        <Text style={styles.forgetPassword}>忘记密码</Text>
                    </TouchableOpacity>
                </View>

                <Button onPress={this.doLogin} style={styles.btnLogin} textStyle={styles.btnLoginText}>登录</Button>

                {this.state.qqinstalled || this.state.weixininstalled ? <WeixinQQPanel qqinstalled={this.state.qqinstalled} weixininstalled={this.state.weixininstalled} /> : <NoWeixinQQPanel />}
                {
                    this.state.showList &&
                    <ListView
                        initialListSize={1}
                        enableEmptySections
                        dataSource={this.state.dataSource}
                        keyboardShouldPersistTaps='always'
                        renderRow={this.renderRow}
                        renderSeparator={this.renderSeparator}
                        style={[styles.list, { top: this.listTop + 135 }, listHeight]}
                        />
                }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#ffffff',
    },
    logoContainer: {
        height: 120,
        justifyContent: 'center',
        alignItems: 'center',
        marginTop:18,
    },
    logo: {
        width: 85.5,
        height: 96,
    },
    listView:{
        height:1,
        width: 300,
        backgroundColor:'#dddddd',
    },
    loginBox:{
        marginLeft: (sr.w - 300) / 2,
        width: 300,
        height: 90,
        borderRadius:4,
        borderColor:'#dddddd',
        borderWidth:1,
        alignItems:'center',
        justifyContent:'center',
    },
    phoneContainer: {
        width: 300,
        height: 45,
        flexDirection: 'row',
        overflow: 'hidden',
        alignItems:'center',
    },
    passwordContainer:{
        width: 300,
        height: 45,
        flexDirection: 'row',
        alignItems:'center',
    },
    input_icon: {
        width: 28,
        height: 28,
        marginLeft: 10,
        marginRight: 10,
    },
    text_input: {
        height:40,
        width: 200,
        padding:0,
        fontSize:14,
        alignSelf: 'center',
    },
    un_loading:{
        flexDirection: 'row',
        justifyContent: 'space-between',
        marginTop:12,
    },
    register:{
        color:'#fd7b1b',
        marginLeft: (sr.w - 300) / 2,
    },
    forgetPassword:{
        color:'#f41728',
        marginRight: (sr.w - 300) / 2,
    },

    btnLogin: {
        height: 46,
        width: 300,
        marginLeft: (sr.w - 300) / 2,
        marginTop: 60,
        backgroundColor: '#c81622',
        borderRadius:4,
    },
    btnLoginText: {
        fontSize: 18,
        fontWeight: '600',
        color: '#FFFFFF',
    },
    thirdpartyContainer: {
        flex:1,
    },
    sepratorContainer: {
        height: 30,
        alignItems:'center',
        justifyContent: 'center',
        marginTop: 50,
    },
    sepratorLine: {
        top: 10,
        height: 2,
        width: sr.w - 20,
        backgroundColor: '#858687',
    },
    sepratorText: {
        backgroundColor:'#EEEEEE',
        color: '#A3A3A4',
        paddingHorizontal: 10,
    },
    thirdpartyButtonContainer: {
        marginTop: 30,
        height: 120,
        flexDirection: 'row',
    },
    thirdpartyLeftButtonContainer: {
        flex:1,
        alignItems:'center',
    },
    thirdpartyRightButtonContainer: {
        flex:1,
        alignItems:'center',
    },
    image_button: {
        width: 80,
        height: 80,
        margin: 10,
    },
    image_button_text: {
        color: '#4C4D4E',
        fontSize: 16,
    },
    thirdpartyContainer2: {
        marginTop: 30,
        height: 200,
        alignItems:'center',
        justifyContent: 'flex-end',
    },
    thirdpartyContainer2_text: {
        fontSize: 18,
        marginBottom:60,
    },
    list: {
        position: 'absolute',
        backgroundColor: 'rgba(255, 255, 255, 0.6)',
        borderWidth: 1,
        borderRadius: 5,
        borderColor: '#D7D7D7',
        width: 150,
        left: 80,
        paddingLeft: 10,
    },
    listHeightMin: {
        height: 30,
    },
    listHeightMax: {
        height: 184,
    },
    itemTextContainer: {
        height: 30,
        justifyContent: 'center',
    },
    itemText: {
        fontSize: 16,
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDDriver/project/App/modules/login/PasswordConfirm.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Image,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '忘记密码',
    },
    doPress () {
        const { newPassword, rePassword } = this.state;
        const { phone, verifyCode } = this.props;
        if (newPassword != rePassword) {
            Toast('两次输入密码不一致');
            return;
        }
        const param = {
            phone,
            verifyCode,
            password:newPassword,
        };
        POST(app.route.ROUTE_FIND_PASSWORD, param, this.findPasswordSuccess, false);
    },
    findPasswordSuccess (data) {
        if (data.success) {
            Toast('密码设置成功');
            app.navigator.popToTop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={[styles.ItemBg, { marginTop:10 }]}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_password}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='请输入新密码'
                            onChangeText={(text) => this.setState({ newPassword: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Image resizeMode='stretch'
                            source={app.img.login_password_check}
                            style={styles.icon_add} />
                        <TextInput placeholderTextColor='#aaaaaa'
                            placeholder='确认新密码'
                            onChangeText={(text) => this.setState({ rePassword: text })}
                            style={styles.itemNameText} />
                    </View>
                </View>
                <Button onPress={this.doPress}
                    style={styles.btnSubmit}
                    textStyle={styles.btnSubmitText} >
                    确认修改
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBg: {
        height: 45,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    icon_add:{
        width:25,
        height:25,
        marginLeft: 8,
    },
    itemNameText: {
        flex:1,
        fontSize: 18,
        color: '#444444',
        marginLeft: 10,
    },
    btnSubmit:{
        marginTop:50,
        height:45,
        width:300,
        marginLeft:(sr.w - 300) / 2,
        borderRadius:4,
        backgroundColor:'#c81622',
    },
    btnSubmitText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'500',
    },
});

```

* PDDriver/project/App/modules/login/Register.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Image,
    Text,
    View,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const TimerMixin = require('react-timer-mixin');
const { Button, WebviewMessageBox } = COMPONENTS;

module.exports = React.createClass({
    mixins: [TimerMixin],
    statics: {
        title: '手机注册',
    },
    doRegister () {
        const { protocalRead, phone, password, rePassword, verifyCode } = this.state;
        if (!protocalRead) {
            Toast('注册前请先阅读用户协议');
            return;
        }
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        }
        if (!app.utils.checkVerificationCode(verifyCode)) {
            Toast('请填写正确的验证码');
            return;
        }
        if (!app.utils.checkPassword(password)) {
            Toast('密码必须由 6-20 位的数字或，字母，下划线组成');
            return;
        }
        if (password !== rePassword) {
            Toast('两次输入的密码不一致');
            return;
        }
        const param = {
            phone,
            verifyCode,
            password,
        };
        POST(app.route.ROUTE_REGISTER, param, this.doRegisterSuccess, true);
    },
    doRegisterSuccess (data) {
        if (data.success) {
            Toast('注册成功');
            this.props.changeToLoginPanel(this.state.phone);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    doPress () {
        const { phone } = this.state;
        if (!app.utils.checkPhone(phone)) {
            Toast('请填写正确的手机号码');
            return;
        };
        const param = {
            phone,
        };
        POST(app.route.ROUTE_REQUEST_SEND_VERIFY_CODE, param, this.requestSendVerifyCodeSuccess, false);
    },
    timer () {
        this.setState({ readSecond:true });
        this.setTimeout(
            () => {
                this.setState({ time:(this.state.time - 1) });
                if (this.state.time <= 0) {
                    return this.setState({ readSecond:false, time:59 });
                }
                this.timer();
            },
            1000
        );
    },
    requestSendVerifyCodeSuccess (data) {
        if (data.success) {
            this.timer();
        } else {
            Toast(data.msg);
        }
    },
    doShowProtocal () {
        app.showModal(
            <WebviewMessageBox webAddress={app.route.ROUTE_USER_LICENSE} title={CONSTANTS.APP_NAME + '用户协议'} />
        );
    },
    getInitialState () {
        return {
            phone: '',
            password: '',
            rePassword: '',
            verifyCode: '',
            protocalRead: true,
            overlayShow:false,
            readSecond:false,
            time:parseInt(59),
        };
    },
    changeProtocalState () {
        this.setState({ protocalRead: !this.state.protocalRead });
    },
    render () {
        const { readSecond, time } = this.state;
        return (
            <View style={styles.container}>
                <View style={[styles.phoneContainer, { marginTop:10 }]}>
                    <Image
                        source={app.img.login_phone}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='手机号'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ phone: text })}
                        style={styles.text_input}
                        keyboardType='phone-pad'
                        />
                </View>
                <View style={styles.verification}>
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请填写验证码'
                        keyboardType='phone-pad'
                        maxLength={CONSTANTS.VERIFICATION_MAX_LENGTH}
                        onChangeText={(text) => this.setState({ verifyCode: text })}
                        style={styles.text_input2}
                        />
                    <TouchableOpacity
                        disabled={readSecond}
                        style={styles.btnBind}
                        onPress={this.doPress}>
                        {
                            !readSecond ?
                                <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>获取验证码</Text>
                            :
                                <Text style={readSecond ? styles.btnBindTextGray : styles.btnBindText}>{time}s后重新发送</Text>
                        }
                    </TouchableOpacity>
                </View>
                <View style={styles.phoneContainer}>
                    <Image
                        source={app.img.login_password}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请输入密码'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ password: text })}
                        style={styles.text_input}
                        />
                </View>
                <View style={styles.phoneContainer}>
                    <Image
                        source={app.img.login_password_check}
                        style={styles.text_phone_header} />
                    <TextInput
                        underlineColorAndroid='transparent'
                        placeholder='请再次输入密码'
                        maxLength={11}
                        onChangeText={(text) => this.setState({ rePassword: text })}
                        style={styles.text_input}
                        />
                </View>
                <View style={styles.agreement}>
                    <TouchableOpacity onPress={this.changeProtocalState}>
                        <Image
                            resizeMode='stretch'
                            source={this.state.protocalRead ? app.img.login_choose : app.img.login_unchoose}
                            style={styles.protocal_icon}
                            />
                    </TouchableOpacity>
                    <Text style={styles.protocal_text}>  我已阅读并同意 </Text>
                    <Button onPress={this.doShowProtocal}
                        style={styles.protocal_button}
                        textStyle={styles.protocal_button_text}>
                        {'《四面通物流超市协议》'}
                    </Button>
                </View>
                <Button onPress={this.doRegister} style={styles.btnRegister} textStyle={styles.btnRegisterText}>注  册</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    phoneContainer:{
        height:45,
        flexDirection: 'row',
        alignItems:'center',
        borderBottomWidth:1,
        borderColor:'#f9f9f9',
        backgroundColor:'#FFFFFF',
    },
    text_phone_header: {
        height:20,
        width:16,
        marginLeft:12,
    },
    verification:{
        height:45,
        flexDirection: 'row',
        justifyContent: 'space-between',
        backgroundColor:'#FFFFFF',
        borderBottomWidth:1,
        borderColor:'#f9f9f9',
        alignItems:'center',
    },
    text_input: {
        marginLeft:14,
        marginTop:5,
        padding:0,
        fontSize:14,
        height:40,
        width: 180,
    },
    text_input2: {
        marginLeft: 12,
        fontSize:14,
        marginTop:5,
        padding:0,
        height: 40,
        width: 220,
        alignSelf: 'center',
    },
    btnRegister: {
        height: 46,
        width: sr.w - 100,
        marginLeft: 50,
        marginTop: 35,
        borderRadius: 4,
        backgroundColor: '#c81622',
    },
    btnRegisterText: {
        fontSize: 20,
        fontWeight: '600',
        color: '#FFFFFF',
    },
    protocal_icon: {
        height: 15,
        width: 15,
        marginRight: 10,
    },
    protocal_text: {
        fontSize: 13,
    },
    agreement:{
        flexDirection: 'row',
        height:20,
        alignItems:'center',
        marginLeft:13,
        marginTop:10,
    },
    protocal_button: {
        height: 18,
        backgroundColor:'#f4f4f4',
    },
    protocal_button_text: {
        fontSize: 13,
        color: '#c81622',
        fontWeight:'400',
    },
    btnBind:{
        justifyContent:'center',
        alignItems:'center',
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        height:45,
    },
    btnBindText:{
        color:'#FF981A',
        fontSize:16,
        fontWeight:'500',
        width:sr.w - 254,
        textAlign:'center',
    },
    btnBindTextGray:{
        color:'#999999',
        backgroundColor:'#fafafa',
        borderLeftWidth:1,
        borderColor:'#f4f4f4',
        fontSize:16,
        fontWeight:'500',
        textAlign:'center',
        width:sr.w - 254,
        flex:1,
        textAlignVertical:'center',
    },
});

```

* PDDriver/project/App/modules/person/About.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '关于软件',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_ABOUT_PAGE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDDriver/project/App/modules/person/BalanceDetail.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '详情',
    },
    render () {
        const obj = this.props.obj;
        return (
            <View style={styles.container}>
                <View style={[styles.item, { paddingTop:2 }]}>
                    <Text style={styles.itemLeft}> 平台 </Text>
                    <Text style={styles.itemRight}> {obj.thirdpartyAccount == null ? '内部支付' : obj.thirdpartyAccount} </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 类型 </Text>
                    <Text style={styles.itemRight}> {obj.remark} </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 金额 </Text>
                    <Text style={obj.tradeAmountYuan > 0 ? styles.itemMoneyGreen : styles.itemMoneyRed}>
                        {obj.tradeAmountYuan}
                    </Text>
                </View>
                <View style={styles.item}>
                    <Text style={styles.itemLeft}> 时间 </Text>
                    <Text style={styles.itemRight}> {obj.tradeTime} </Text>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    item:{
        marginTop:8,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
    },
    itemLeft:{
        fontSize:14,
        color:'#333333',
        paddingLeft:8,
    },
    itemRight:{
        fontSize:14,
        color:'#333333',
        paddingRight:10,
    },
    itemMoneyRed:{
        fontSize:14,
        color:'#C81622',
        paddingRight:10,
    },
    itemMoneyGreen:{
        fontSize:14,
        color:'#2F971C',
        paddingRight:10,
    },
});

```

* PDDriver/project/App/modules/person/BalanceDetailList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;
const BalanceDetail = require('./BalanceDetail');

module.exports = React.createClass({
    statics: {
        title: '余额明细',
    },
    renderRow (obj) {
        return (
            <TouchableOpacity onPress={this.toAccountDetails.bind(null, obj)}>
                <View style={styles.recharge}>
                    <View>
                        <Text style={styles.rechargeText}>
                            {obj.remark}
                        </Text>
                        <Text style={styles.rechargeDate}>
                            {obj.tradeTime}
                        </Text>
                    </View>
                    <Text style={obj.tradeAmountYuan > 0 ? styles.rechargeMoney : styles.expenditureMoney}>
                        {obj.tradeAmountYuan}
                    </Text>
                </View>
            </TouchableOpacity>
        );
    },
    toAccountDetails (obj) {
        app.push({
            component:BalanceDetail,
            passProps: {
                obj:obj,
            },
        });
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listParam={{ userId: app.personal.info.userId }}
                    listName={'billList'}
                    listUrl={app.route.ROUTE_GET_BILL_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    recharge:{
        height:50,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    rechargeText:{
        paddingTop:5,
        paddingLeft:8,
        color:'#333333',
        fontSize:14,
    },
    rechargeDate:{
        color:'#aaaaaa',
        paddingVertical:5,
        paddingLeft:8,
    },
    rechargeMoney:{
        color:'#2F971C',
        fontSize:14,
        paddingRight:10,
    },
    expenditureMoney:{
        color:'#C81622',
        fontSize:14,
        paddingRight:10,
    },
});

```

* PDDriver/project/App/modules/person/BindBankcard.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    Text,
    TextInput,
    TouchableOpacity,
} = ReactNative;

const { Button } = COMPONENTS;
module.exports = React.createClass({
    statics: {
        title: '绑定银行卡',
    },
    doBind () {

    },
    doScanBankcard () {

    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{'账号'}</Text>
                        <TextInput style={styles.itemNameLeftText}
                            placeholderTextColor='#aaaaaa'
                            placeholder='请填入银行卡号'
                            onChangeText={this.onContentTextChange}
                            />
                        <TouchableOpacity
                            activeOpacity={0.6}
                            onPress={this.doScanBankcard}>
                            <Image
                                resizeMode='stretch'
                                source={app.img.personal_scan}
                                style={styles.icon_add} />
                        </TouchableOpacity>
                    </View>
                </View>
                <View style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{'姓名'}</Text>
                        <TextInput style={styles.itemNameLeftText}
                            placeholderTextColor='#aaaaaa'
                            placeholder='请填入姓名'
                            onChangeText={this.onContentTextChange}
                            />
                    </View>
                    <View style={styles.lineView} />
                </View>
                <Button onPress={this.doBind} style={styles.btnBind} textStyle={styles.btnBindText} >
                    绑定
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 10,
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        flexDirection: 'row',
    },
    icon_add:{
        flex:1,
        width:20,
        height:30,
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    itemNameLeftText: {
        flex:1,
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    btnBind:{
        marginTop:50,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
        backgroundColor:'#c81622',
    },
    btnBindText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDDriver/project/App/modules/person/BindBankcardList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    ListView,
} = ReactNative;

const BindBankcard = require('./BindBankcard');

module.exports = React.createClass({
    statics: {
        title: '银行卡',
    },
    getInitialState () {
        return {
            ds: new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 }),
            list: [1, 2],
        };
    },
    doAddBankcard () {
        app.push({
            component: BindBankcard,
        });
    },
    doUnBindBankcard (rowID) {
        this.state.list.splice(rowID, 1);
        this.setState({
            dataSource: this.state.list,
        });
    },
    renderRow (obj, sectionID, rowID) {
        return (
            <View style={styles.ItemBg}>
                <View style={styles.infoStyle}>
                    <View >
                        <Text style={styles.itemNameText}>{'农业银行'}</Text>
                        <Text style={styles.itemNumberText}>{'**0851储蓄卡'}</Text>
                    </View>
                    <TouchableOpacity
                        activeOpacity={0.6}
                        onPress={() => this.doUnBindBankcard(rowID)}>
                        <Text style={styles.itemNameRightText}>{'解绑'}</Text>
                    </TouchableOpacity>
                </View>
            </View>
        );
    },
    renderFooter (obj, sectionID, rowId) {
        return (
            <TouchableOpacity
                activeOpacity={0.6}
                onPress={this.doAddBankcard}
                style={styles.touch_add}>
                <Image
                    resizeMode='stretch'
                    source={app.img.personal_add}
                    style={styles.icon_add} />
                <Text style={styles.itemAddText}>{'添加银行卡'}</Text>
            </TouchableOpacity>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <ListView
                    style={styles.ListView}
                    dataSource={this.state.ds.cloneWithRows(this.state.list)}
                    renderRow={this.renderRow}
                    renderFooter={this.renderFooter}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    ItemBg: {
        height: 42,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
        marginTop:2,
    },
    ListView:{
        marginTop:8,
    },
    infoStyle: {
        width:sr.w,
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    touch_add:{
        alignItems:'center',
        marginTop:29,
    },
    icon_add:{
        width:30,
        height:30,
    },
    itemAddText: {
        fontSize: 14,
        color: '#888888',
        marginTop:10,
    },
    itemNameText: {
        fontSize: 14,
        color: '#333333',
        marginLeft: 8,
        marginBottom:2,
    },
    itemNumberText:{
        fontSize: 12,
        color: '#888888',
        marginLeft: 8,
        marginTop:2,
    },
    itemNameRightText: {
        textAlign:'right',
        fontSize: 13,
        color: '#3fa0ff',
        marginRight:10,
        marginTop:10,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
});

```

* PDDriver/project/App/modules/person/CashBalance.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const WithdrawCash = require('./WithdrawCash');
const Recharge = require('./Recharge');
const BalanceDetailList = require('./BalanceDetailList');

module.exports = React.createClass({
    statics: {
        title: '余额',
        rightButton: { title: '明细', handler: () => { app.scene.detail(); } },
    },
    getInitialState () {
        return {
            amount:'',
            type:'1',
        };
    },
    componentWillMount () {
        this.setState({
            amount:app.personal.remainAmount,
        });
    },
    detail () {
        app.push({
            component:BalanceDetailList,
        });
    },
    setCash (cash) {
        app.personal.setRemainAmount(cash);
        this.setState({
            amount:app.personal.remainAmount,
        });
    },
    showWithdrawCash () {
        app.push({
            component: WithdrawCash,
            passProps:{
                money:this.state.amount,
                setType:this.setCash,
            },
        });
    },
    showRecharge () {
        app.push({
            component: Recharge,
            passProps:{
                setType:this.setCash,
            },
        });
    },
    render () {
        const { amount } = this.state;
        return (
            <View style={styles.container}>
                <View style={styles.TopView}>
                    <Text style={styles.CashBalanceTitle}>账户余额</Text>
                    <View style={styles.CashBalance}>
                        <Text style={styles.CashBalanceTitleLeft}>￥</Text><Text style={styles.CashBalanceContent}>{amount}</Text>
                    </View>
                </View>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showWithdrawCash}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{'提现'}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showRecharge}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{'充值'}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
    TopView: {
        height:100,
        backgroundColor:'#c81622',
        marginBottom:8,
        paddingLeft:20,
        paddingTop:15,
        paddingBottom:20,
    },
    CashBalanceTitle:{
        fontSize:14,
        color:'white',
    },
    CashBalance: {
        flexDirection: 'row',
        marginTop:22,
    },
    CashBalanceTitleLeft:{
        fontSize:14,
        color:'white',
        alignSelf:'flex-end',
        paddingBottom:5,
    },
    CashBalanceContent:{
        fontSize:24,
        color:'white',
        alignSelf:'flex-end',
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
});

```

* PDDriver/project/App/modules/person/CommonSetting.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    Switch,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '基础设置',
    },
    getInitialState () {
        return {
            onlyWifiUpload: !!app.setting.data.onlyWifiUpload,
        };
    },
    onValueChange (value) {
        this.setState({ onlyWifiUpload: value });
        app.setting.setOnlyWifiUpload(value);
    },
    selectThemeColor (color) {
        app.setting.setThemeColor(color);
    },
    render () {
        return (
            <View style={styles.container}>
                <View style={styles.row}>
                    <Text style={styles.title}>只在wifi下上传</Text>
                    <Switch
                        style={styles.switch}
                        onValueChange={this.onValueChange}
                        value={this.state.onlyWifiUpload} />
                </View>
                <View style={styles.row}>
                    <Text style={styles.title}>主题颜色</Text>
                    <View style={styles.colorContainer}>
                        {
                            CONSTANTS.THEME_COLORS.map((color, i) => {
                                return (
                                    <TouchableOpacity
                                        key={i}
                                        onPress={this.selectThemeColor.bind(null, color)}
                                        style={[styles.color, { backgroundColor: color }]}
                                        />
                                );
                            })
                        }
                    </View>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 20,
    },
    row: {
        paddingHorizontal: 14,
        height: 80,
        flexDirection: 'row',
        backgroundColor: '#FFFFFF',
        alignItems: 'center',
    },
    title: {
        flex: 7,
        fontSize: 17,
        color: 'gray',
        marginLeft: 2,
    },
    switch: {
        flex: 2,
    },
    colorContainer: {
        flex: 20,
        flexDirection: 'row',
        justifyContent: 'space-around',
    },
    color: {
        flex: 1,
        height:80,
        marginRight: 10,
    },
});

```

* PDDriver/project/App/modules/person/EditBirthday.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Text,
    StyleSheet,
    View,
    TouchableOpacity,
} = ReactNative;

const { Picker } = COMPONENTS;
const moment = require('moment');

module.exports = React.createClass({
    getInitialState () {
        const info = app.personal.info;
        return {
            birthday: info.birthday,
        };
    },
    goBack () {
        Picker.hide();
    },
    createBirthdayData (now) {
        const date = [];
        const iy = now.year(), im = now.month() + 1, id = now.date();
        for (let y = 1916; y <= iy; y++) {
            const month = [];
            const mm = [0, 31, (!(y % 4) & (!!(y % 100))) | (!(y % 400)) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            const iim = (y == iy) ? im : 12;
            for (let m = 1; m <= iim; m++) {
                const day = [];
                const iid = (y == iy && m == im) ? id : mm[m];
                for (let d = 1; d <= iid; d++) {
                    day.push(d + '日');
                }
                month.push({ [m + '月']: day });
            }
            date.push({ [y + '年']: month });
        }
        return date;
    },
    toEditBirth () {
        const date = moment(this.state.birthday, 'YYYY-MM-DD');
        const selectedValue = [date.year() + '年', (date.month() + 1) + '月', date.date() + '日'];
        const pickerData = this.createBirthdayData(moment());
        Picker(pickerData, selectedValue, '选择生日').then((value) => {
            const birthday = moment(value.join(''), 'YYYY年M月D日').format('YYYY-MM-DD');
            this.setState({ birthday }, () => {
                this.modifyPersonalInfo();
            });
        });
    },
    modifyPersonalInfo () {
        const info = app.personal.info;
        const param = {
            userId: info.userId,
            birthday: this.state.birthday,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            const info = app.personal.info;
            info.birthday = this.state.birthday;
            app.personal.set(info);
            this.props.setBirth(info.birthday);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { birthday } = this.state;
        return (
            <View style={styles.container}>
                <View style={[styles.separatorView, { marginTop: 30 }]} />
                <TouchableOpacity
                    onPress={this.toEditBirth}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>{birthday || '请选择您的生日'}</Text>
                </TouchableOpacity>
                <View style={styles.separatorView} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#EEEEEE',
    },
    itemView: {
        backgroundColor: 'white',
        height: 45,
        justifyContent: 'center',
        alignItems:'center',
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
});

```

* PDDriver/project/App/modules/person/EditPersonInfo.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
    Text,
    StyleSheet,
    View,
    TouchableOpacity,
} = ReactNative;

const { DImage, Button, Picker } = COMPONENTS;

const ImagePicker = require('./ImagePicker');
const EditSingleInfo = require('./EditSingleInfo');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '个人信息',
        leftButton: { handler: () => { app.scene.goBack(); } },
    },
    goBack () {
        this.props.updateInfo(app.personal.info);
        Picker.hide();
        app.pop();
    },
    getInitialState () {
        const info = app.personal.info;
        return {
            name: info.name,
            licenseNo:info.licenseNo,
            address: info.address,
            head: info.head,
            sex: info.sex === 0 ? '男' : '女',
            phone:info.phone,
            pickerData: ['男', '女'],
        };
    },
    toEditHead () {
        Picker.hide();
        app.push({
            component: ImagePicker,
            passProps: {
                onCropImage: this.setUserHead,
            },
        });
    },
    setUserHead (uri) {
        this.setState({ head: uri });
    },
    toEditSingleInfo (name, tip, maxLength, keyboardType, checkFunc) {
        Picker.hide();
        app.push({
            title: '修改' + tip,
            component: EditSingleInfo,
            passProps: {
                keyName: name,
                placeholder: tip,
                maxLength,
                keyboardType,
                checkFunc,
                updateSingleState:this.updateSingleState,
            },
        });
    },
    updateSingleState (keyName, value) {
        let state = this.state;
        state[keyName] = value;
        this.setState({ state });
    },
    toEditSex () {
        const { sex, pickerData } = this.state;
        Picker(pickerData, [sex], '选择性别').then((value) => {
            const sex = value[0];
            this.setState({ sex }, () => {
                this.modifyPersonalInfo();
            });
        });
    },
    modifyPersonalInfo () {
        const info = app.personal.info;
        const param = {
            userId: info.userId,
            sex: this.state.sex === '男' ? 0 : 1,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            const info = app.personal.info;
            info.sex = this.state.sex === '男' ? 0 : 1;
            app.personal.set(info);
        } else {
            Toast(data.msg);
        }
    },
    doLogout () {
        app.navigator.resetTo({
            component: require('../login/Login'),
        }, 0);
        app.personal.setNeedLogin(true);
    },
    render () {
        const { name, address, sex, head, phone, licenseNo } = this.state;
        return (
            <View style={styles.container}>
                <View style={[styles.headStyle, { marginTop: 10 }]} >
                    <TouchableOpacity
                        onPress={this.toEditHead}
                        style={styles.head_itemView}>
                        <DImage
                            defaultSource={app.img.personal_default_head}
                            source={{ uri: head }}
                            style={styles.headImgStyle} />
                        <View style={styles.rightView} >
                            <Image
                                source={app.img.common_go}
                                style={styles.goStyle} />
                        </View>
                    </TouchableOpacity>
                </View>
                <TouchableOpacity
                    onPress={this.toEditSingleInfo.bind(null, 'licenseNo', '驾驶证号', 18, 'default', app.utils.checkIdentifyNumber)}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>驾驶证号</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{licenseNo}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity
                    onPress={this.toEditSingleInfo.bind(null, 'name', '真实姓名', CONSTANTS.NAME_MAX_LENGTH, 'default', null)}
                    style={[styles.itemView, { marginTop: 8 }]} >
                    <Text style={styles.itemKeyText}>真实姓名</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{name}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity
                    onPress={this.toEditSex}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>性别</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{sex}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <TouchableOpacity
                    onPress={this.toEditSingleInfo.bind(null, 'address', '地址', CONSTANTS.ADDRESS_MAX_LENGTH, 'default', app.utils.checkStr)}
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>家庭地址</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.addressText}
                            numberOfLines={1}>{address}</Text>
                        <Image
                            source={app.img.common_go}
                            style={styles.goStyle} />
                    </View>
                </TouchableOpacity>
                <View
                    style={styles.itemView}>
                    <Text style={styles.itemKeyText}>手机号码</Text>
                    <View style={styles.rightView} >
                        <Text style={styles.itemValueText}>{phone}</Text>
                    </View>
                </View>
                <Button onPress={this.doLogout} style={styles.btnLogout} textStyle={styles.btnLogoutText} >
                    退出登录
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#F4F4F4',
    },
    headStyle: {
        width: sr.w,
        height:60,

    },
    head_itemView:{
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 60,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    itemView: {
        marginTop:1,
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 42,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    rightView: {
        flexDirection: 'row',
        height: 45,
        alignItems:'center',
    },
    headImgStyle: {
        height: 36,
        width: 36,
        borderRadius: 18,
        marginLeft: 20,
    },
    goStyle: {
        height: 15,
        width: 8,
        marginRight: 20,
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
    itemValueText: {
        color: '#888888',
        fontSize: 14,
        marginRight: 10,
    },
    addressText:{
        color: '#888888',
        fontSize: 14,
        marginRight: 10,
        width: sr.w / 2,
        textAlign:'right',
    },
    btnChangeRole:{
        marginTop:15,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
    },
    btnLogout:{
        marginTop:215,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
        backgroundColor:'#D9D9D9',
    },
    btnLogoutText:{
        color:'#000000',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDDriver/project/App/modules/person/EditSingleInfo.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    Text,
    StyleSheet,
    View,
    TextInput,
} = ReactNative;

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        rightButton: { title: '保存', handler: () => { app.scene.doSave(); } },
    },
    doSave () {
        const { placeholder, checkFunc } = this.props;
        const { value } = this.state;
        const info = app.personal.info;
        if (!!checkFunc && !checkFunc(value)) {
            Toast('请填写正确的' + placeholder);
            return;
        } else {
            if (value.length == 0) {
                Toast(placeholder + '不能为空');
                return;
            }
        }
        let param = {
            userId: info.userId,
        };
        param[this.keyName] = value;
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess, true);
    },
    getInitialState () {
        const info = app.personal.info;
        this.keyName = this.props.keyName;
        return {
            value: info[this.keyName] || '',
        };
    },
    modifyUserInfoSuccess (data) {
        if (data.success) {
            const info = app.personal.info;
            info[this.keyName] = this.state.value;
            app.personal.set(info);
            this.props.updateSingleState(this.keyName, info[this.keyName]);
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const { value } = this.state;
        const { placeholder, keyboardType, maxLength } = this.props;
        return (
            <View style={styles.container}>
                <View style={styles.itemView}>
                    <Text style={styles.itemKeyText} />
                    <TextInput
                        ref={(ref) => { this.contentInput = ref; }}
                        style={styles.rightView}
                        onChangeText={(text) => this.setState({ value: text })}
                        multiline={false}
                        keyboardType={keyboardType}
                        maxLength={maxLength}
                        placeholder={'请输入你的' + placeholder}
                        autoCapitalize={'none'}
                        underlineColorAndroid={'transparent'}
                        defaultValue={value}
                        />
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: '#F4F4F4',
    },
    itemView: {
        marginTop:10,
        backgroundColor: 'white',
        flexDirection: 'row',
        height: 42,
        justifyContent: 'space-between',
        alignItems:'center',
    },
    rightView: {
        flex: 1,
        fontSize: 15,
        paddingVertical: 2,
        color: '#444444',
    },
    separatorView: {
        height: 1,
        width: sr.w,
        backgroundColor: '#aab9ba',
    },
    itemKeyText: {
        color: '#444444',
        fontSize: 15,
        marginLeft: 20,
    },
});

```

* PDDriver/project/App/modules/person/Feedback.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
    Text,
} = ReactNative;

const { Button } = COMPONENTS;

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '意见反馈',
    },
    getInitialState () {
        return {
            content:'',
            length:0,
        };
    },
    onContentTextChange (text) {
        this.setState({
            content:text,
            length:text.length,
        });
    },
    doSubmit () {
        if (!this.state.content) {
            Toast('请填写您需要反馈的内容');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            content: this.state.content,
        };
        POST(app.route.ROUTE_SUBMIT_FEEDBACK, param, this.doSubmitSuccess);
    },
    doSubmitSuccess (data) {
        if (data.success) {
            Toast('提交成功');
            app.pop();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        const length = this.state.length;
        return (
            <View style={styles.container}>
                <Text style={styles.content_text}>
                    具体内容
                </Text>
                <TextInput style={styles.content_input}
                    placeholderTextColor='#aaaaaa'
                    placeholder='请填入意见内容'
                    onChangeText={this.onContentTextChange}
                    underlineColorAndroid='transparent'
                    multiline
                    maxLength={CONSTANTS.FEEDBACK_MAX_LENGTH}
                    />
                <Text style={styles.wordnumber_text}>
                    {length}/500
                </Text>
                <Button onPress={this.doSubmit}
                    style={styles.button}
                    textStyle={styles.btnLoginText}>
                    提交反馈
                    </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    content_text:{
        fontSize:14,
        height:40,
        width:351,
        color:'#666666',
        marginLeft:(sr.w - 351) / 2,
        paddingTop:18,
    },
    content_input:{
        fontSize:14,
        height:200,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor:'#FFFFFF',
        textAlignVertical: 'top',
        padding:3,
    },
    wordnumber_text:{
        fontSize:14,
        height:30,
        width:351,
        color:'#666666',
        marginLeft:(sr.w - 351) / 2,
        paddingTop:5,
        textAlign:'right',
    },
    button:{
        height:50,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        backgroundColor:'#f69934',
        borderRadius:4,
        marginTop:60,
    },
    btnLoginText:{
        fontSize:18,
        color:'#FFFFFF',
        fontWeight:'600',
    },
});

```

* PDDriver/project/App/modules/person/Help.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '软件许可协议',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri:app.route.ROUTE_SOFTWARE_LICENSE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDDriver/project/App/modules/person/ImageCrop.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    ImageStore,
    ImageEditor,
} = ReactNative;

const ImageCrop = require('@remobile/react-native-image-crop');

module.exports = React.createClass({
    mixins: [SceneMixin],
    statics: {
        title: '编辑头像',
        rightButton: { title: '完成', handler: () => {
            app.scene.cropImage();
        } },
    },
    goBack () {
        app.pop();
    },
    cropImage () {
        const { image } = this.props;
        const cropData = this.imageCrop.getCropData();
        ImageEditor.cropImage(
            image.uri,
            cropData,
            (croppedImageURI) => {
                this.uploadUserHead(croppedImageURI);
            },
            (error) => {
                Toast('文件出错');
                this.goBack();
            }
        );
    },
    uploadUserHead (filePath) {
        if (app.isandroid) {
            const options = {};
            options.fileKey = 'file';
            options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
            options.mimeType = 'image/png';
            options.params = {
                userId:app.personal.info.userId,
            };
            UPLOAD(filePath, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
        } else {
            ImageStore.getBase64ForTag(filePath, (data) => {
                data = 'data:image/png;base64,' + data;
                const options = {};
                options.fileKey = 'file';
                options.fileName = 'user_head.png';
                options.mimeType = 'image/png';
                options.params = {
                    userId:app.personal.info.userId,
                };
                ImageStore.removeImageForTag(filePath);
                UPLOAD(data, app.route.ROUTE_UPDATE_FILE, options, (progress) => console.log(progress), this.uploadSuccessCallback, this.uploadErrorCallback, true);
            }, () => {
                Toast('文件出错');
                this.goBack();
            });
        }
    },
    uploadSuccessCallback (data) {
        if (data.success) {
            this.modifyPersonalInfo(data.context.url);
        } else {
            Toast('上传头像失败');
            this.goBack();
        }
    },
    uploadErrorCallback () {
        Toast('上传头像失败');
        this.goBack();
    },
    modifyPersonalInfo (url) {
        const info = app.personal.info;
        const param = {
            userId: info.userId,
            head: url,
        };
        POST(app.route.ROUTE_MODIFY_PERSONAL_INFO, param, this.modifyUserInfoSuccess.bind(null, url), this.modifyUserInfoError, true);
    },
    modifyUserInfoSuccess (url, data) {
        if (data.success) {
            const info = app.personal.info;
            info.head = url;
            app.personal.set(info);
            this.props.onCropImage(url);
            this.goBack();
        } else {
            Toast(data.msg);
            this.goBack();
        }
    },
    modifyUserInfoError () {
        Toast('修改头像失败');
        this.goBack();
    },
    render () {
        const { image } = this.props;
        return (
            <View style={styles.container}>
                <ImageCrop
                    imageWidth={image.width}
                    imageHeight={image.height}
                    editRectRadius={0}
                    ref={(ref) => { this.imageCrop = ref; }}
                    source={{ uri: image.uri }} />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
});

```

* PDDriver/project/App/modules/person/ImagePicker.js

```js
const React = require('react');
const ReactNative = require('react-native');
const {
    Image,
} = ReactNative;

const CameraRollPicker = require('@remobile/react-native-camera-roll-picker');
const Camera = require('@remobile/react-native-camera');
const ImageCrop = require('./ImageCrop');

module.exports = React.createClass({
    statics: {
        title: '选择头像',
    },
    cropImage (image) {
        app.navigator.replace({
            component: ImageCrop,
            passProps: {
                image,
                onCropImage: this.props.onCropImage,
            },
        });
    },
    onSelectedImages (images, image) {
        this.cropImage(image);
    },
    openCamera () {
        Camera.getPicture((filePath) => {
            const uri = 'file://' + filePath;
            Image.getSize(uri, (width, height) => {
                this.cropImage({
                    uri,
                    width,
                    height,
                });
            });
        }, null, {
            quality: 100,
            allowEdit: false,
            cameraDirection: Camera.Direction.FRONT,
            destinationType: Camera.DestinationType.FILE_URI,
        });
    },
    render () {
        return (
            <CameraRollPicker selected={[]} onSelectedImages={this.onSelectedImages} openCamera={this.openCamera} maximum={1} />
        );
    },
});

```

* PDDriver/project/App/modules/person/ModifyPassword.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    TextInput,
} = ReactNative;

const { Button, Label } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '修改密码',
    },
    getInitialState () {
        return {
            oldPassword: '',
            newPassword1: '',
            newPassword2: '',
        };
    },
    goBack () {
        app.pop();
    },
    doSubmit () {
        const { oldPassword, newPassword1, newPassword2 } = this.state;
        const { checkPassword } = app.utils;
        if (!checkPassword(oldPassword) || !checkPassword(newPassword1)) {
            Toast('密码必须有6-20位的数字，字母，下划线组成');
            return;
        }
        if (!oldPassword) {
            Toast('请填写旧密码');
            return;
        }
        if (!newPassword1) {
            Toast('请填写新密码');
            return;
        }
        if (!newPassword2) {
            Toast('请再次填写新密码');
            return;
        }
        if (newPassword2 !== newPassword1) {
            Toast('两次填写新密码不一致');
            return;
        }
        if (oldPassword === newPassword1) {
            Toast('新密码不能和原来密码一样');
            return;
        }
        const param = {
            userId: app.personal.info.userId,
            oldPassword,
            newPassword: newPassword1,
        };
        POST(app.route.ROUTE_MODIFY_PASSWORD, param, this.doSubmitSuccess, true);
    },
    doSubmitSuccess (data) {
        if (data.success) {
            Toast('修改成功');
            this.goBack();
        } else {
            Toast(data.msg);
        }
    },
    render () {
        return (
            <View style={styles.container}>
                <Label img={app.img.login_user}>请输入旧密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请输入旧密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ oldPassword: text })}
                    />
                <Label img={app.img.login_user}>请输入新密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请输入新密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ newPassword1: text })}
                    />
                <Label img={app.img.login_user}>请再次输入新密码</Label>
                <TextInput
                    underlineColorAndroid='transparent'
                    placeholder='请再次输入新密码'
                    style={styles.text_input}
                    secureTextEntry
                    onChangeText={(text) => this.setState({ newPassword2: text })}
                    />
                <Button onPress={this.doSubmit} style={[styles.btnSubmit, { backgroundColor:app.setting.THEME_COLOR }]}>提交</Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor: 'white',
        paddingVertical: 20,
        paddingHorizontal: 25,
    },
    text_input: {
        height: 40,
        fontSize: 14,
        paddingLeft: 10,
        backgroundColor: 'white',
        textAlignVertical: 'top',
        borderWidth: 1,
        borderRadius: 5,
        marginBottom: 20,
        borderColor: '#DBDBDB',
    },
    btnSubmit: {
        width: sr.w - 50,
        marginTop: 80,
        height: 40,
        borderRadius: 10,
    },
});

```

* PDDriver/project/App/modules/person/NormalQuestions.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '常见问题',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_ABOUT_PAGE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDDriver/project/App/modules/person/Recharge.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    TextInput,
} = ReactNative;

const { Button } = COMPONENTS;
const BankCardList = require('./SelectBankCardList');

module.exports = React.createClass({
    statics: {
        title: '充值',
    },
    getInitialState () {
        return {
            bankCard:'请选择银行卡',
            amount:1,
            type:'',
        };
    },
    showBankList () {
        app.push({
            component:BankCardList,
            passProps: { setBankCard: this.setBankCard },
        });
    },
    doRecharge () {
        const param = {
            userId: app.personal.info.userId,
            amount:this.state.amount,
            thirdpartyAccount:'N1231242311',
        };
        POST(app.route.ROUTE_RECHARGE, param, this.doRechargeSuccess, true);
    },
    doRechargeSuccess (data) {
        if (data.success) {
            Toast('充值成功');
        }
        this.props.setType(data.context.amount);
    },
    setBankCard (bankCard) {
        this.setState({ bankCard });
    },
    render () {
        const { bankCard } = this.state;
        return (
            <View style={styles.container}>
                <TextInput
                    placeholderTextColor='#444444'
                    placeholder='充值金额'
                    onChangeText={(text) => this.setState({ amount: text })}
                    style={styles.ItemBgText} />
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showBankList}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{bankCard}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <Button onPress={this.doRecharge} style={styles.btnRecharge} textStyle={styles.btnRechargeText} >
                    充值
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        paddingVertical: 10,
    },
    ItemBg: {
        paddingLeft:10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
    },
    ItemBgText: {
        paddingLeft:10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor:'white',
        fontSize: 15,
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',

    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    btnRecharge:{
        marginTop:215,
        height:45,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
        backgroundColor:'#c81622',
    },
    btnRechargeText:{
        color:'#ffffff',
        fontSize:16,
        fontWeight:'300',
    },
});

```

* PDDriver/project/App/modules/person/SelectBankCardList.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
} = ReactNative;

const { PageList } = COMPONENTS;

module.exports = React.createClass({
    statics: {
        title: '银行卡',
    },
    getInitialState () {
        return {
            selectedRowID:'',
            bankCard:'农业银行',
        };
    },
    toChoose (obj, rowID) {
        this.setState({
            selectedRowID:rowID,
        });
        this.props.setBankCard(this.state.bankCard);
    },
    renderRow (obj, rowID) {
        const { selectedRowID } = this.state;

        return (
            <View style={styles.container} >
                <TouchableOpacity onPress={this.toChoose.bind(null, obj, rowID)}>
                    <View style={styles.item}>
                        <Text style={styles.nameText}>
                            {this.state.bankCard}
                        </Text>
                        {
                            (rowID == selectedRowID) &&
                            <Image
                                resizeMode='stretch'
                                source={app.img.common_radio}
                                style={styles.icon_go} />
                        }

                    </View>
                </TouchableOpacity>
            </View>
        );
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'clientList'}
                    listUrl={app.route.ROUTE_GET_CLIENT_LIST}
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    item:{
        height:42,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems:'center',
        backgroundColor:'#FFFFFF',
    },
    nameText:{
        paddingLeft:8,
        color:'#333333',
        fontSize:14,
    },
    icon_go: {
        width: 10,
        height: 10,
        marginRight: 12,
    },
});

```

* PDDriver/project/App/modules/person/Software.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    WebView,
} = ReactNative;

module.exports = React.createClass({
    statics: {
        title: '软件许可协议',
    },
    render () {
        return (
            <WebView
                style={styles.container}
                source={{ uri: app.route.ROUTE_SOFTWARE_LICENSE }}
                scalesPageToFit
                />
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
    },
});

```

* PDDriver/project/App/modules/person/WithdrawCash.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    TouchableOpacity,
    TextInput,
} = ReactNative;

const { Button } = COMPONENTS;
const BankCardList = require('./SelectBankCardList');

module.exports = React.createClass({
    statics: {
        title: '提现',
    },
    showRecharge () {
        app.push({
            component:BankCardList,
            passProps: { setBankCard: this.setCardName },
        });
    },
    getInitialState () {
        return {
            bankName: '请选择银行卡',
            amount:1,
            type:'',
            money:'0.0',
        };
    },
    doWithdraw () {
        const param = {
            userId: app.personal.info.userId,
            amount:this.state.amount,
            thirdpartyAccount:'N1231242311',
        };
        POST(app.route.ROUTE_WITHDRAW, param, this.doWithdrawSuccess, true);
    },
    doWithdrawSuccess (data) {
        if (data.success) {
            Toast('提现成功');
        }
        this.props.setType(data.context.amount);
    },
    setCardName (cardName) {
        this.setState({ bankName:cardName });
    },
    WithdrawalsAllMoney () {
        this.setState({
            amount:this.props.money,
            money:this.props.money + '',
        });
    },
    render () {
        return (
            <View style={styles.container}>
                <Text style={styles.drawCashTitle}>
                    提现金额
                </Text>
                <View style={styles.drawCash}>
                    <Text style={styles.drawCashLeft}>
                        ￥
                    </Text>
                    <TextInput
                        placeholderTextColor='#444444'
                        placeholder={this.state.money}
                        onChangeText={(text) => this.setState({ amount: text })}
                        style={styles.drawCashContent} />
                </View>
                <View style={styles.balance}>
                    <View style={styles.balanceLeft}>
                        <Text style={styles.balanceTextLeft}>
                            账户余额：
                        </Text>
                        <Text style={styles.balanceTextRight}>
                            {this.props.money}元
                        </Text>
                    </View>
                    <TouchableOpacity onPress={this.WithdrawalsAllMoney}>
                        <Text style={styles.allDrawcash}>
                            全部提现
                        </Text>
                    </TouchableOpacity>
                </View>
                <TouchableOpacity
                    activeOpacity={0.6}
                    onPress={this.showRecharge}
                    style={styles.ItemBg}>
                    <View style={styles.infoStyle}>
                        <Text style={styles.itemNameText}>{this.state.bankName}</Text>
                    </View>
                    <Image
                        resizeMode='stretch'
                        source={app.img.common_go}
                        style={styles.icon_go} />
                    <View style={styles.lineView} />
                </TouchableOpacity>
                <Button onPress={this.doWithdraw} style={styles.btnDrawCash} textStyle={styles.btnDrawCashText}>
                    确认提现
                </Button>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container:{
        flex: 1,
        backgroundColor:'#F4F4F4',
    },
    drawCashTitle:{
        marginTop:10,
        paddingLeft:12,
        paddingTop:10,
        fontSize:12,
        backgroundColor:'#FFFFFF',
    },
    drawCash:{
        height:48,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        alignItems:'flex-end',
    },
    drawCashLeft:{
        fontSize:12,
        paddingLeft:12,
        paddingBottom:3,
    },
    drawCashContent:{
        flex:1,
        height:65,
        paddingBottom:3,
        fontSize:20,
        paddingTop:10,
    },
    balance:{
        height:34,
        marginTop:1,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
        justifyContent:'space-between',
    },
    balanceLeft:{
        height:34,
        marginTop:1,
        backgroundColor:'#FFFFFF',
        flexDirection: 'row',
    },
    balanceTextLeft:{
        fontSize:14,
        color:'#888888',
        paddingLeft:12,
        paddingTop:10,
    },
    balanceTextRight:{
        fontSize:14,
        color:'#888888',
        paddingTop:10,
    },
    allDrawcash:{
        color:'#fd9a14',
        paddingRight:10,
        paddingTop:10,
    },
    ItemBg: {
        marginTop:17,
        padding: 10,
        height: 44,
        width:sr.w,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
        backgroundColor:'white',
    },
    infoStyle: {
        flexDirection: 'row',
    },
    itemNameText: {
        fontSize: 15,
        width:sr.w - 45,
        color: '#444444',
        marginLeft: 8,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    btnDrawCash:{
        marginTop:285,
        backgroundColor:'#FE9917',
        height:46,
        width:351,
        marginLeft:(sr.w - 351) / 2,
        borderRadius:2,
    },
});

```

* PDDriver/project/App/modules/person/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    Image,
    StyleSheet,
    Text,
    View,
    TouchableOpacity,
    ScrollView,
} = ReactNative;

const EditPersonInfo = require('./EditPersonInfo');
const About = require('./About');
const Feedback = require('./Feedback');
const NormalQuestions = require('./NormalQuestions');
const UpdatePage = require('../update/UpdatePage');
const Software = require('./Software');
const ModifyPassword = require('./ModifyPassword');

const { DImage } = COMPONENTS;

const CHILD_PAGES_BOTTOM = [
    { strict:true, title:'修改密码', module: ModifyPassword, img:'' },
    { strict:true, title:'软件许可协议', module: Software, img:'' },
    { strict:true, title:'常见问题', module: NormalQuestions, img:'' },
    { strict:true, title:'在线更新', module: UpdatePage, img:'' },
    { strict:true, title:'关于软件', module: About, img:'' },
    { strict:true, title:'意见反馈', module: Feedback, img:'' },
];

const MenuItem = React.createClass({
    showChildPage () {
        const { module } = this.props.page;
        app.push({
            component: module,
        });
    },
    render () {
        const { title } = this.props.page;
        return (
            <TouchableOpacity
                activeOpacity={0.6}
                onPress={this.showChildPage}
                style={styles.ItemBg}>
                <View style={styles.infoStyle}>
                    <Text style={styles.itemNameText}>{title}</Text>
                </View>
                <Image
                    resizeMode='stretch'
                    source={app.img.common_go}
                    style={styles.icon_go} />
                <View style={styles.lineView} />
            </TouchableOpacity>
        );
    },
});

module.exports = React.createClass({
    statics: {
        title: '个人中心',
    },
    getInitialState () {
        const info = app.personal.info;
        return {
            info,
        };
    },
    toExitDatum () {
        app.push({
            component: EditPersonInfo,
            passProps: { updateInfo: this.updateInfo },
        });
    },
    updateInfo (info) {
        this.setState({ info });
    },
    render () {
        const { info } = this.state;
        return (
            <ScrollView style={styles.container}>
                <View style={styles.headImgBg}>
                    <TouchableOpacity
                        onPress={this.toExitDatum}>
                        <DImage
                            resizeMode='cover'
                            defaultSource={app.img.personal_default_head}
                            source={{ uri: info.head }}
                            style={styles.headStyle} />
                        <Image
                            resizeMode='stretch'
                            source={app.img.personal_female}
                            style={styles.careStyle} />
                    </TouchableOpacity>
                    <Text style={styles.name}>{info.name || info.phone}</Text>
                </View>
                <View>
                    <View style={styles.lineViewTop} />
                    {
                        CHILD_PAGES_BOTTOM.map((item, i) => {
                            if (!app.personal.info.phone && item.strict) {
                                return null;
                            }
                            return (
                                !item.hidden &&
                                <MenuItem page={item} key={i} />
                            );
                        })
                    }
                    <View style={styles.line} />
                </View>
            </ScrollView>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
        backgroundColor:'white',
    },
    headImgBg:{
        height: 160,
        width: sr.w,
        backgroundColor:'#c81622',
        alignItems:'center',
    },
    ItemBg: {
        padding: 10,
        height: 44,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
    },
    headStyle: {
        width: 87,
        height: 87,
        marginTop: 10,
        marginBottom: 5,
        borderRadius: 43.5,
    },
    icon_go: {
        width: 8,
        height: 15,
        marginRight: 7,
    },
    lineView: {
        position:'absolute',
        top: 0,
        width: sr.w,
        height: 1,
        backgroundColor: '#f4f4f4',
    },
    lineViewTop:{
        backgroundColor: '#f4f4f4',
        height:8,
    },
    infoStyle: {
        flexDirection: 'row',
    },
    careStyle: {
        width: 20,
        height: 20,
        marginLeft:60,
        marginTop:-25,
    },
    itemNameText: {
        fontSize: 15,
        color: '#444444',
        marginLeft: 8,
    },
    name: {
        marginTop: 20,
        fontSize: 19,
        color: 'white',
        backgroundColor: 'transparent',
    },
    midView: {
        width: sr.w,
        height: 105,
        alignItems: 'center',
    },
    careShop: {
        marginVertical: 10,
        width:sr.w / 2.0,
        height: 50,
        alignItems: 'center',
        borderRadius: 8,
        justifyContent: 'center',
    },
    line: {
        width:sr.w,
        height:1,
        backgroundColor: '#f4f4f4',
    },
});

```

* PDDriver/project/App/modules/position/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
    ListView,
    ScrollView,
    RefreshControl,
    TouchableOpacity,
} = ReactNative;

import { Geolocation } from '@remobile/react-native-baidu-map';

module.exports = React.createClass({
    statics: {
        title: '首页',
    },
    componentWillMount () {
        this.getOnWayTruck();
    },
    getOnWayTruck () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_ON_WAY_TRUCK, param, this.getOnWayTruckSuccess, false);
    },
    getOnWayTruckSuccess (data) {
        if (data.success) {
            this.setState({
                msg:null,
                data: data.context,
                list: data.context.locationList,
                // list: _.uniqBy(data.context.locationList, 'address'),
            });
        } else {
            this.setState({ msg:data.msg });
        }
    },
    doConfirmDestination () {
        Geolocation.getCurrentPosition()
        .then(data => {
            console.warn(JSON.stringify(data));
            const param = {
                userId: app.personal.info.userId,
                address:data.address || '未知',
                latitude:data.latitude,
                longitude:data.longitude,
            };
            POST(app.route.ROUTE_CONFIRM_REACH, param, this.confirmReach, false);
        })
        .catch(e => {
            console.warn(e, 'error');
        });
    },
    confirmReach (data) {
        if (data.success) {
            Toast('确认成功');
            this.getOnWayTruck();
        } else {
            Toast(data.msg);
        }
    },
    getInitialState () {
        return {
            ds: new ListView.DataSource({ rowHasChanged: (r1, r2) => r1 !== r2 }),
            list: [],
            data: {},
            msg:'暂无运输中的货车',
        };
    },
    renderRow (obj, sectionID, rowId) {
        return (
            <View style={styles.row}>
                <View style={styles.item}>
                    <Image
                        resizeMode='stretch'
                        source={rowId == 0 ? app.img.position_point_green : app.img.position_point}
                        style={styles.imagePoint} />
                    <View style={styles.itemRight}>
                        <Text style={rowId == 0 ? styles.addressGreen : styles.address}>{obj.address}</Text>
                        <Text style={rowId == 0 ? styles.timeGreen : styles.time}>{obj.time}</Text>
                    </View>
                </View>
            </View>
        );
    },
    onScroll () {
        this.getOnWayTruck();
    },
    render () {
        const { data, list, msg } = this.state;
        return (
            <View style={styles.container}>
                <ScrollView
                    refreshControl={
                        <RefreshControl
                            refreshing={false}
                            onRefresh={this.onScroll}
                            title='正在刷新...' />
                }>
                    {
                    !msg ?
                        <View>
                            <View style={styles.top}>
                                <Text style={styles.driverText}>司机:{app.personal.info.name}</Text>
                                <Text style={styles.carNumber}>{data.plateNo}</Text>
                                <Text style={styles.truckType}>{data.truckType}</Text>
                                <Text style={styles.totalWeight}>总重量：{data.totalWeight}/吨</Text>
                                <Text style={styles.totalNumbers}>总件数：{data.totalNumbers}/件</Text>
                            </View>
                            <ListView
                                style={styles.listView}
                                dataSource={this.state.ds.cloneWithRows(list)}
                                renderRow={this.renderRow}
                            />
                        </View>
                    :
                        <View style={styles.msg}>
                            <Image
                                resizeMode='cover'
                                defaultSource={app.img.personal_default_head}
                                source={{ uri: app.personal.info.head }}
                                style={styles.headStyle} />
                            <Text style={styles.driverText}>司机:{app.personal.info.name}</Text>
                            <Text style={styles.truckMsg}>{msg}</Text>
                        </View>
                }
                </ScrollView>
                {
                !msg &&
                <TouchableOpacity
                    onPress={this.doConfirmDestination}
                    style={styles.doConfirm}>
                    <View style={styles.confirm}>
                        <Image
                            resizeMode='stretch'
                            source={app.img.position_endpoint}
                            style={styles.imageBtn} />
                        <Text style={styles.confirmText}>确认目的地</Text>
                    </View>
                </TouchableOpacity>
            }
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor:'#f4f4f4',
    },
    row:{
        height:80,
    },
    item:{
        flexDirection:'row',
    },
    top:{
        height:135,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    msg:{
        height:175,
        backgroundColor:'#FFFFFF',
        alignItems:'center',
        justifyContent:'center',
    },
    carNumber:{
        fontSize:23,
        marginTop:5,
        color:'#f41729',
    },
    mid:{
        flexDirection:'row',
        marginTop:5,
    },
    driverText:{
        fontSize:14,
        fontWeight:'500',
        marginTop:5,
        color:'#333333',
        letterSpacing:2,
    },
    truckMsg:{
        fontSize:16,
        marginTop:15,
        color:'#c81622',
    },
    truckType:{
        fontSize:12,
        marginTop:3,
        color:'#888888',
    },
    totalWeight:{
        fontSize:12,
        color:'#333333',
        marginTop:5,
    },
    totalNumbers:{
        fontSize:12,
        color:'#333333',
        marginTop:5,
    },
    listView:{
        marginTop:25,
        backgroundColor:'#FFFFFF',
        paddingTop:30,
    },
    imagePoint:{
        width:8,
        height:80,
        marginLeft:25,
    },
    itemRight:{
        marginLeft:15,
    },
    address:{
        fontSize:12,
        color:'#888888',
    },
    time:{
        fontSize:12,
        color:'#888888',
        marginTop:3,
    },
    addressGreen:{
        fontSize:12,
        color:'green',
    },
    timeGreen:{
        fontSize:12,
        color:'green',
        marginTop:3,
    },
    doConfirm:{
        width:140,
        height:45,
        backgroundColor:'#aaaaaa',
        opacity:0.7,
        marginLeft:(sr.w - 125) / 2,
        position:'absolute',
        bottom:0,
        borderRadius:4,
        flexDirection:'row',
        alignItems:'center',
        justifyContent:'center',
    },
    confirm:{
        flexDirection:'row',
        alignItems:'center',
    },
    imageBtn:{
        height:20,
        width:15.5,
    },
    confirmText:{
        marginLeft:8,
        fontSize:15,
        fontWeight:'500',
        color:'#FFFFFF',
    },
    headStyle: {
        width: 87,
        height: 87,
        borderRadius: 43.5,
    },
});

```

* PDDriver/project/App/modules/qrcode/index.js

```js
'use strict';

const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

import QRCode from 'react-native-qrcode';

module.exports = React.createClass({
    statics: {
        title: '我的二维码',
    },
    render () {
        const { info } = app.personal;
        return (
            <View style={styles.container}>
                <View style={styles.card}>
                    <Text style={styles.tip}>{info.name || info.phone}</Text>
                    <View style={styles.qrcode} pointerEvents={'none'}>
                        <QRCode
                            value={app.utils.genQRString(2, info.userId)}
                            size={230}
                            bgColor='black'
                            fgColor='white' />
                    </View>
                    <Text style={styles.tip}>扫一扫二维码过安检</Text>
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f4f4f4',
        alignItems: 'center',
    },
    card: {
        backgroundColor: 'white',
        alignItems: 'center',
        justifyContent: 'center',
        marginTop:30,
        height:420,
        width:330,
        borderRadius:10,
    },
    qrcode: {
        borderColor:'#d6ebfe',
        borderWidth: 10,
        borderRadius:20,
        padding:20,
    },
    tip: {
        fontSize:16,
        color:'#888888',
        paddingVertical:20,
    },
});

```

* PDDriver/project/App/modules/splash/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Image,
    TouchableOpacity,
} = ReactNative;

import Swiper from 'react-native-swiper';
const TimerMixin = require('react-timer-mixin');
const SplashScreen = require('@remobile/react-native-splashscreen');
const Login = require('../login/Login');
const Home = require('../home/index');

module.exports = React.createClass({
    mixins: [TimerMixin],
    getInitialState () {
        return {
            renderSplashType: 0,
        };
    },
    doGetPersonalInfo () {
        const param = {
            userId: app.personal.info.userId,
        };
        POST(app.route.ROUTE_GET_PERSONAL_INFO, param, this.getPersonalInfoSuccess, this.getInfoError);
    },
    getPersonalInfoSuccess (data) {
        if (data.success) {
            const context = data.context;
            app.personal.set(context);
            this.changeToHomePage();
            app.personal.setNeedLogin(false);
        } else {
            this.getInfoError();
        }
    },
    getInfoError () {
        app.personal.setNeedLogin(true);
        this.changeToLoginPage();
    },
    enterLoginPage (needHideSplashScreen) {
        app.navigator.replace({
            component: Login,
        });
        needHideSplashScreen && SplashScreen.hide();
    },
    changeToLoginPage () {
        if (app.updateMgr.needShowSplash) {
            this.setState({ renderSplashType: 0 }, () => {
                SplashScreen.hide();
            });
        } else {
            this.setState({ renderSplashType: 1 }, () => {
                this.enterLoginPage(true);
            });
        }
    },
    enterHomePage (needHideSplashScreen) {
        app.navigator.replace({
            component: Home,
        });
        needHideSplashScreen && SplashScreen.hide();
    },
    changeToHomePage () {
        if (app.updateMgr.needShowSplash) {
            this.setState({ renderSplashType: 0 }, () => {
                SplashScreen.hide();
            });
        } else {
            this.setState({ renderSplashType: 2 }, () => {
                this.enterHomePage(true);
            });
        }
    },
    enterNextPage () {
        app.updateMgr.setNeedShowSplash(false);
        if (this.state.renderSplashType === 0) {
            app.personal.setNeedLogin(true);
            this.setState({ renderSplashType: 1 }, () => {
                this.enterLoginPage();
            });
        } else {
            this.setState({ renderSplashType: 2 }, () => {
                this.enterHomePage();
            });
        }
    },
    changeToNextPage () {
        if (app.personal.needLogin) {
            app.personal.setNeedLogin(true);
            this.changeToLoginPage();
        } else {
            this.doGetPersonalInfo();
        }
    },
    componentDidMount () {
        app.utils.until(
            () => app.personal.initialized && app.updateMgr.initialized && app.navigator,
            (cb) => setTimeout(cb, 100),
            () => this.changeToNextPage()
        );
    },
    componentWillUnmount () {
        app.updateMgr.checkUpdate();
    },
    onLayout (e) {
        const { height } = e.nativeEvent.layout;
        if (this.state.height !== height) {
            this.heightHasChange = !!this.state.height;
            this.setState({ height });
        }
    },
    renderSwiperSplash () {
        const { height } = this.state;
        const marginBottom = (!this.heightHasChange || Math.floor(height) === Math.floor(sr.th)) ? 0 : 30;
        return (
            <View style={{ flex: 1 }} onLayout={this.onLayout}>
                {
                    height &&
                    <Swiper
                        paginationStyle={styles.paginationStyle}
                        dot={<View style={{ backgroundColor:'#87E5D6', width: 8, height: 8, borderRadius: 4, marginLeft: 12, marginRight: 12, marginBottom }} />}
                        activeDot={<View style={{ backgroundColor:'#1A7AE9', width: 18, height: 9, borderRadius: 6, marginLeft: 7, marginRight: 7, marginBottom }} />}
                        height={height}
                        loop={false}>
                        {
                            [1, 2, 3].map((i) => {
                                return (
                                    <Image
                                        key={i}
                                        resizeMode='stretch'
                                        source={app.img['splash_splash' + i]}
                                        style={[styles.bannerImage, { height }]}>
                                        {
                                            i === 3 &&
                                            <TouchableOpacity
                                                style={styles.enterButtonContainer}
                                                onPress={this.enterNextPage}>
                                                <Image resizeMode='stretch' style={styles.enterButton} source={app.img.splash_start} />
                                            </TouchableOpacity>
                                        }
                                    </Image>
                                );
                            })
                        }
                    </Swiper>
                }
            </View>
        );
    },
    render () {
        return this.state.renderSplashType != 0 ? <Image style={{ width:sr.w, height:sr.h }} source={app.img.splash_splash1} /> : this.renderSwiperSplash();
    },
});

const styles = StyleSheet.create({
    paginationStyle: {
        bottom: 30,
    },
    bannerImage: {
        width: sr.w,
    },
    enterButtonContainer: {
        position: 'absolute',
        width: 165,
        height: 40,
        left: (sr.w - 165) / 2,
        bottom: 80,
        alignItems:'center',
        justifyContent: 'center',
    },
    enterButton: {
        width: 140,
        height: 36,
    },
});

```

* PDDriver/project/App/modules/test/index.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    FlatList,
    Button,
} = ReactNative;

const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    getInitialState () {
        return {
            list: [1, 2, 3, 4, 5, 6, 7, 8],
        };
    },
    componentWillMount () {
        SplashScreen.hide();
    },
    renderItem ({ item, separators }) {
        console.log('========', separators);
        return (
            <View style={styles.row}>
                <Text>
                    {item}
                </Text>
            </View>
        );
    },
    onPress () {
        this.setState({ list: [2, 3, 4, 5] });
    },
    render () {
        return (
            <View style={styles.container}>
                <Button title='click' onPress={this.onPress} />
                <FlatList
                    data={this.state.list}
                    extraData={this.state}
                    renderItem={this.renderItem}
                    refreshing={false}
                    initialNumToRender={4}
                    ListHeaderComponent={<Text>'这是头'</Text>}
                    ListFooterComponent={<Text>'这是尾'</Text>}
                    ListEmptyComponent={<Text>'没有数据'</Text>}
                    ItemSeparatorComponent={() => <View style={styles.separator} />}
                    onRefresh={() => { console.log('========'); }}
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop: 60,
    },
    row: {
        height: 80,
        justifyContent: 'center',
        alignItems: 'center',
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDDriver/project/App/modules/test/pageList.js

```js
'use strict';

const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
} = ReactNative;

const { PageList } = COMPONENTS;
const SplashScreen = require('@remobile/react-native-splashscreen');

module.exports = React.createClass({
    getInitialState () {
        return {
            list: [1, 2, 3, 4, 5, 6, 7, 8],
        };
    },
    componentWillMount () {
        SplashScreen.hide();
    },
    renderRow (obj) {
        return (
            <View style={styles.row}>
                <Text>
                    {obj}
                </Text>
            </View>
        );
    },
    onPress () {
        this.setState({ list: [2, 3, 4, 5] });
    },
    render () {
        return (
            <View style={styles.container}>
                <PageList
                    ref={(ref) => { this.listView = ref; }}
                    renderRow={this.renderRow}
                    listName={'testList'}
                    listUrl='http://localhost:4000/getList'
                    refreshEnable
                    />
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop: 60,
    },
    row: {
        height: 80,
        justifyContent: 'center',
        alignItems: 'center',
    },
    separator: {
        backgroundColor: '#DDDDDD',
        height: 1,
    },
});

```

* PDDriver/project/App/modules/update/UpdateInfoBox.js

```js
'use strict';
const React = require('react');
const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    TouchableOpacity,
} = ReactNative;

const Update = require('@remobile/react-native-update');

const
    STATUS_HAS_VEW_VERSION = 0,
    STATUS_DOWNLOAD_APK_PROGESS = 1,
    STATUS_DOWNLOAD_JS_PROGESS = 2,
    STATUS_UNZIP_JS_PROGESS = 3,
    STATUS_DOWNKOAD_APK_ERROR = 4,
    STATUS_DOWNKOAD_JS_ERROR = 5,
    STATUS_UNZIP_JS_ERROR = 6,
    STATUS_FAILED_INSTALL_ERROR = 7,
    STATUS_UPDATE_END = 8;

const
    ERROR_NULL = 0,
    ERROR_DOWNKOAD_APK = 1,
    ERROR_DOWNKOAD_JS = 2,
    ERROR_FAILED_INSTALL = 3,
    ERROR_UNZIP_JS = 4;

const PROGRESS_WIDTH = sr.tw * 0.7;
const { ProgressBar } = COMPONENTS;

const ProgressInfo = React.createClass({
    render () {
        const { progress } = this.props;
        if (progress < 1000) {
            return (
                <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                    <Text>{this.props.title} [{progress}%]</Text>
                    <ProgressBar
                        fillStyle={{}}
                        backgroundStyle={{ backgroundColor: '#cccccc', borderRadius: 2 }}
                        style={{ marginTop: 10, width:PROGRESS_WIDTH }}
                        progress={progress / 100.0}
                        />
                    <View style={styles.progressText}>
                        <Text>0</Text>
                        <Text>100</Text>
                    </View>
                </View>
            );
        } else {
            const size = progress / 1000 / 1024 / 1024;
            return (
                <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                    <Text>{this.props.title} [ {size.toFixed(2)} M ]</Text>
                </View>
            );
        }
    },
});

module.exports = React.createClass({
    getInitialState () {
        return {
            status:STATUS_HAS_VEW_VERSION,
            progress: 0,
        };
    },
    onError (errCode) {
        if (errCode == ERROR_DOWNKOAD_APK) {
            this.setState({ status: STATUS_DOWNKOAD_APK_ERROR });
        } else if (errCode == ERROR_DOWNKOAD_JS) {
            this.setState({ status: STATUS_DOWNKOAD_JS_ERROR });
        } else if (errCode == ERROR_FAILED_INSTALL) {
            this.setState({ status: STATUS_FAILED_INSTALL_ERROR });
        } else if (errCode == ERROR_UNZIP_JS) {
            this.setState({ status: STATUS_UNZIP_JS_ERROR });
        }
    },
    doUpdate () {
        const { jsVersionCode, trackViewUrl } = this.props.options;
        if (jsVersionCode !== undefined) {
            Update.updateJS({
                jsVersionCode,
                jsbundleUrl: app.isandroid ? app.route.ROUTE_JS_ANDROID_URL : app.route.ROUTE_JS_IOS_URL,
                onDownloadJSProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_JS_PROGESS, progress }); },
                onUnzipJSProgress:(progress) => { this.setState({ status: STATUS_UNZIP_JS_PROGESS, progress }); },
                onUnzipJSEnd:() => { this.setState({ status: STATUS_UPDATE_END }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        } else {
            Update.updateApp({
                trackViewUrl,
                androidApkUrl:app.route.ROUTE_APK_URL,
                androidApkDownloadDestPath:'/sdcard/pddriver.apk',
                onDownloadAPKProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_APK_PROGESS, progress }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        }
    },
    render () {
        const components = {};
        const { newVersion, description } = this.props.options;
        components[STATUS_HAS_VEW_VERSION] = (
            <View style={styles.functionContainer}>
                <Text style={styles.title}>{`发现新版本(${newVersion})`}</Text>
                <Text style={styles.redLine} />
                <Text style={styles.content}>
                    {'更新内容：'}
                </Text>
                {
                    description.map((item, i) => {
                        return (
                            <Text style={styles.contentItem} key={i}>{'- ' + item}</Text>
                        );
                    })
                }
                <View style={styles.buttonViewStyle}>
                    <TouchableOpacity
                        onPress={app.closeModal}
                        style={styles.buttonStyleContainCannel}>
                        <Text style={styles.buttonStyleCannel}>以后再说</Text>
                    </TouchableOpacity>
                    <TouchableOpacity
                        onPress={this.doUpdate}
                        style={styles.buttonStyleContain}>
                        <Text style={styles.buttonStyle} >立即更新</Text>
                    </TouchableOpacity>
                </View>
            </View>
        );
        components[STATUS_DOWNKOAD_APK_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>下载apk文件失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_DOWNKOAD_JS_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>下载js bundle失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_UNZIP_JS_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>解压js bundle失败，请在设置里重新更新</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_FAILED_INSTALL_ERROR] = (
            <View style={[styles.functionContainer, { alignItems: 'center', paddingVertical: 30 }]}>
                <Text style={styles.textInfo}>你放弃了安装</Text>
                <TouchableOpacity
                    onPress={app.closeModal}
                    style={styles.buttonStyleContainCannel}>
                    <Text style={styles.buttonStyleCannel}>我知道了</Text>
                </TouchableOpacity>
            </View>
        );
        components[STATUS_DOWNLOAD_APK_PROGESS] = (
            <ProgressInfo
                title='正在下载APK'
                progress={this.state.progress} />
        );
        components[STATUS_DOWNLOAD_JS_PROGESS] = (
            <ProgressInfo
                title='正在下载Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UNZIP_JS_PROGESS] = (
            <ProgressInfo
                title='正在解压Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UPDATE_END] = (
            <Text>即将重启...</Text>
        );
        return (
            <View style={styles.container}>
                {components[this.state.status]}
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    functionContainer: {
        width:sr.w - 60,
        backgroundColor:'#FFFFFF',
    },
    progressText: {
        flexDirection:'row',
        justifyContent:'space-between',
        width: sr.w * 0.7,
    },
    textInfo: {
        color: '#000000',
        fontSize: 14,
        marginBottom: 20,
        textAlign: 'center',
    },
    buttonViewStyle: {
        flexDirection: 'row',
        width: sr.w - 40,
        height: 60,
        justifyContent: 'center',
    },
    redLine: {
        marginTop: 15,
        width: sr.w - 60,
        height: 1,
        backgroundColor: '#2F4F4F',
    },
    buttonStyleContain: {
        width: 120,
        height: 35,
        marginLeft: 30,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor: '#2F4F4F',
    },
    buttonStyleContainCannel: {
        width: 120,
        height: 35,
        justifyContent:'center',
        alignItems:'center',
        backgroundColor: 'white',
        borderWidth: 1,
        borderColor: '#2F4F4F',
    },
    buttonStyle: {
        fontSize: 16,
        color: 'white',
        fontFamily: 'STHeitiSC-Medium',
    },
    buttonStyleCannel: {
        fontSize: 16,
        color: '#2F4F4F',
        fontFamily: 'STHeitiSC-Medium',
    },
    title: {
        color: '#2F4F4F',
        fontSize: 18,
        textAlign: 'center',
        overflow: 'hidden',
        marginTop: 15,
        fontFamily: 'STHeitiSC-Medium',
    },
    content: {
        color:'#000000',
        marginTop: 10,
        marginBottom: 10,
        marginHorizontal: 20,
        fontSize:16,
        fontFamily: 'STHeitiSC-Medium',
    },
    contentItem: {
        color:'#000000',
        marginBottom: 10,
        marginHorizontal: 20,
        fontSize:12,
    },
});

```

* PDDriver/project/App/modules/update/UpdatePage.js

```js
'use strict';
const React = require('react');const ReactNative = require('react-native');
const {
    StyleSheet,
    View,
    Text,
    Image,
} = ReactNative;

const Update = require('@remobile/react-native-update');

const
    STATUS_GET_VERSION = 0,
    STATUS_HAS_VEW_VERSION = 1,
    STATUS_HAS_NOT_VEW_VERSION = 2,
    STATUS_DOWNLOAD_APK_PROGESS = 3,
    STATUS_DOWNLOAD_JS_PROGESS = 4,
    STATUS_UNZIP_JS_PROGESS = 5,
    STATUS_GET_VERSION_ERROR = 6,
    STATUS_DOWNKOAD_APK_ERROR = 7,
    STATUS_DOWNKOAD_JS_ERROR = 8,
    STATUS_UNZIP_JS_ERROR = 9,
    STATUS_FAILED_INSTALL_ERROR = 10,
    STATUS_UPDATE_END = 11;

const
    ERROR_NULL = 0,
    ERROR_DOWNKOAD_APK = 1,
    ERROR_DOWNKOAD_JS = 2,
    ERROR_FAILED_INSTALL = 3,
    ERROR_UNZIP_JS = 4;

const PROGRESS_WIDTH = sr.tw * 0.7;
const { Button, ProgressBar } = COMPONENTS;

const ProgressInfo = React.createClass({
    render () {
        const { progress } = this.props;
        if (progress < 1000) {
            return (
                <View>
                    <Text>{this.props.title} [{progress}%]</Text>
                    <ProgressBar
                        fillStyle={{}}
                        backgroundStyle={{ backgroundColor: '#cccccc', borderRadius: 2 }}
                        style={{ marginTop: 10, width:PROGRESS_WIDTH }}
                        progress={progress / 100.0}
                        />
                    <View style={styles.progressText}>
                        <Text>0</Text>
                        <Text>100</Text>
                    </View>
                </View>
            );
        } else {
            const size = progress / 1000 / 1024 / 1024;
            return (
                <View style={{ flex: 1, alignItems: 'center' }}>
                    <Text>{this.props.title} [{size.toFixed(2)} M]</Text>
                </View>
            );
        }
    },
});

module.exports = React.createClass({
    statics: {
        title: '在线更新',
    },
    pageName: 'UpdatePage',
    getInitialState () {
        const { options } = this.props;
        return {
            options,
            status: !options ? STATUS_GET_VERSION : options.newVersion ? STATUS_HAS_VEW_VERSION : STATUS_HAS_NOT_VEW_VERSION,
            progress: 0,
        };
    },
    componentWillMount () {
        if (!this.state.options) {
            Update.checkVersion({
                versionUrl: app.route.ROUTE_VERSION_INFO_URL,
                iosAppId: CONSTANTS.IOS_APPID,
            }).then((options) => {
                this.setState({ options, status: !options ? STATUS_GET_VERSION_ERROR : options.newVersion ? STATUS_HAS_VEW_VERSION : STATUS_HAS_NOT_VEW_VERSION });
            });
        }
    },
    onError (errCode) {
        if (errCode == ERROR_DOWNKOAD_APK) {
            this.setState({ status: STATUS_DOWNKOAD_APK_ERROR });
        } else if (errCode == ERROR_DOWNKOAD_JS) {
            this.setState({ status: STATUS_DOWNKOAD_JS_ERROR });
        } else if (errCode == ERROR_FAILED_INSTALL) {
            this.setState({ status: STATUS_FAILED_INSTALL_ERROR });
        } else if (errCode == ERROR_UNZIP_JS) {
            this.setState({ status: STATUS_UNZIP_JS_ERROR });
        }
    },
    doUpdate () {
        const { jsVersionCode, trackViewUrl } = this.state.options;
        if (jsVersionCode !== undefined) {
            Update.updateJS({
                jsVersionCode,
                jsbundleUrl: app.isandroid ? app.route.ROUTE_JS_ANDROID_URL : app.route.ROUTE_JS_IOS_URL,
                onDownloadJSProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_JS_PROGESS, progress }); },
                onUnzipJSProgress:(progress) => { this.setState({ status: STATUS_UNZIP_JS_PROGESS, progress }); },
                onUnzipJSEnd:() => { this.setState({ status: STATUS_UPDATE_END }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        } else {
            Update.updateApp({
                trackViewUrl,
                androidApkUrl:app.route.ROUTE_APK_URL,
                androidApkDownloadDestPath:'/sdcard/pddriver.apk',
                onDownloadAPKProgress:(progress) => { this.setState({ status: STATUS_DOWNLOAD_APK_PROGESS, progress }); },
                onError:(errCode) => { this.onError(errCode); },
            });
        }
    },
    render () {
        const components = {};
        const { APP_NAME } = CONSTANTS;
        const { currentVersion, newVersion, description } = this.state.options || { currentVersion:Update.getVersion() };
        components[STATUS_GET_VERSION] = (
            <Text style={styles.textInfo}>正在获取版本号</Text>
        );
        components[STATUS_HAS_NOT_VEW_VERSION] = (
            <Text style={styles.textInfo}>当前版本已经是最新版本</Text>
        );
        components[STATUS_GET_VERSION_ERROR] = (
            <Text style={styles.textInfo}>获取版本信息失败，请稍后再试</Text>
        );
        components[STATUS_DOWNKOAD_APK_ERROR] = (
            <Text style={styles.textInfo}>下载apk文件失败，请稍后再试</Text>
        );
        components[STATUS_DOWNKOAD_JS_ERROR] = (
            <Text style={styles.textInfo}>下载js bundle失败，请稍后再试</Text>
        );
        components[STATUS_UNZIP_JS_ERROR] = (
            <Text style={styles.textInfo}>解压js bundle失败，请稍后再试</Text>
        );
        components[STATUS_FAILED_INSTALL_ERROR] = (
            <Text style={styles.textInfo}>你放弃了安装</Text>
        );
        components[STATUS_HAS_VEW_VERSION] = (
            <View style={styles.textInfoContainer}>
                <Text style={styles.textInfo}>发现新版本{newVersion}</Text>
                <View style={styles.descriptionContainer}>
                    {
                        description && description.map((item, i) => {
                            return (
                                <Text style={styles.textInfo} key={i}>{(i + 1) + '. ' + item}</Text>
                            );
                        })
                    }
                </View>
                <Button onPress={this.doUpdate} style={styles.button_layer} textStyle={styles.button_text}>立即更新</Button>
            </View>
        );
        components[STATUS_DOWNLOAD_APK_PROGESS] = (
            <ProgressInfo
                title='正在下载APK'
                progress={this.state.progress} />
        );
        components[STATUS_DOWNLOAD_JS_PROGESS] = (
            <ProgressInfo
                title='正在下载Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UNZIP_JS_PROGESS] = (
            <ProgressInfo
                title='正在解压Bundle文件'
                progress={this.state.progress} />
        );
        components[STATUS_UPDATE_END] = (
            <Text>正在重启...</Text>
        );
        return (
            <View style={styles.container}>
                <View style={styles.logoContainer}>
                    <Image
                        resizeMode='stretch'
                        source={app.img.personal_logo}
                        style={styles.logo}
                        />
                    <Text style={styles.app_name}>{APP_NAME + 'V' + currentVersion}</Text>
                </View>
                <View style={styles.functionContainer}>
                    {components[this.state.status]}
                </View>
            </View>
        );
    },
});

const styles = StyleSheet.create({
    container: {
        flex:1,
    },
    logoContainer: {
        alignItems:'center',
        marginTop: 52,
    },
    logo: {
        width: 83,
        height: 83,
    },
    app_name: {
        marginTop: 13,
        fontSize: 16,
        color: '#727272',
    },
    functionContainer: {
        flex: 1,
        width: sr.w,
        marginTop: 51,
        alignItems:'center',
    },
    button_layer: {
        width:178,
        height:49,
        borderRadius: 4,
        left: (sr.w - 178) / 2,
        position: 'absolute',
        bottom: 120,
        backgroundColor: '#DE3031',
    },
    button_text: {
        fontSize: 18,
        fontWeight: '400',
        color: '#FFFFFF',
        alignSelf: 'center',
        fontFamily: 'STHeitiSC-Medium',
    },
    progressText: {
        flexDirection:'row',
        justifyContent:'space-between',
        width: sr.w * 0.7,
    },
    textInfoContainer: {
        flex: 1,
        width: sr.w,
    },
    textInfo: {
        color: '#000000',
        fontSize: 18,
        marginBottom: 6,
        textAlign: 'center',
    },
});

```

* PDDriver/project/App/utils/check/index.js

```js
module.exports = {
    checkPhone (phone) {
        return /^1\d{10}$/.test(phone);
    },
    checkIdentifyNumber (number) {
        return /^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/.test(number);
    },
    checkPassword (pwd) {
        return /^[\d\w_]{6,20}$/.test(pwd);
    },
    checkVerificationCode (code) {
        return /^\d{6}$/.test(code);
    },
    checkMailAddress (code) {
        const reg = /^([a-zA-Z0-9]+[_.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        return reg.test(code);
    },
    /**
     * 验证银行卡号(16位或19位数字)
    */
    checkBankCardCode (code) {
        return /^(\d{16}|\d{19})$/.test(code);
    },
    /**
     * 验证出生日期(平年日期格式为YYYY-MM-DD的正则表达式)
    */
    checkBirthDate (str) {
        var re = /^([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8])))$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
    * 验证字符串是否包含特殊符号
    */
    checkStr (str) {
        let re = /^[\u4E00-\u9FA5A-Za-z0-9-]+$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证数字(可以包含两个小数点)
    */
    check2PointNum (code) {
        return /^(0|[1-9][0-9]{0,9})(\.[0-9]{1,2})?$/.test(code);
    },
    /**
     * 验证数字(包含不限小数点)
    */
    checkNum (str) {
        var re = /^[0-9]+.?[0-9]*$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证数字(正整数)
    */
    checkIntNum (str) {
        var re = /^[0-9]*[1-9][0-9]*$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
    /**
     * 验证非负整数
    */
    checkUnIntNum (str) {
        var re = /^\d+$/;
        if (re.test(str)) {
            return true;
        } else {
            return false;
        }
    },
};

```

* PDDriver/project/App/utils/common/index.js

```js
module.exports = {
    until (test, iterator, callback) {
        if (!test()) {
            iterator((err) => {
                if (err) {
                    return callback(err);
                }
                this.until(test, iterator, callback);
            });
        } else {
            callback();
        }
    },
    toThousands (num) {
        return (num || 0).toString().replace(/(\d)(?=(?:\d{3})+$)/g, '$1,');
    },
    getPercentages (list) {
        const sum = _.sum(list);
        return list.map((v) => Math.round(v * 100 / sum) + '%');
    },
    getVisibleText (text, n) {
        let realLength = 0, len = text.length, preLen = -1, charCode = -1, needCut = false;
        for (let i = 0; i < len; i++) {
            charCode = text.charCodeAt(i);
            if (charCode >= 0 && charCode <= 128) {
                realLength += 1;
            } else {
                realLength += 2;
            }
            if (preLen === -1 && realLength >= n) {
                preLen = i + 1;
            } else if (realLength > n + 2) {
                needCut = true;
                break;
            }
        }
        if (needCut) {
            text = text.substr(0, preLen) + '..';
        }
        return text;
    },
    cutLimitText (text, n) {
        let realLength = 0, len = text.length, preLen = -1, charCode = -1, needCut = false;
        for (let i = 0; i < len; i++) {
            charCode = text.charCodeAt(i);
            if (charCode >= 0 && charCode <= 128) {
                realLength += 1;
            } else {
                realLength += 2;
            }
            if (preLen === -1 && realLength >= n) {
                preLen = i + 1;
            } else if (realLength > n) {
                needCut = true;
                break;
            }
        }
        if (needCut) {
            text = text.substr(0, preLen);
        }
        return text;
    },
};

```

* PDDriver/project/App/utils/date/index.js

```js
const moment = require('moment');

module.exports = {
    createDateData (start, end) {
        let date = [];
        let iy = start.year(), im = start.month() + 1, id = start.date();
        let ey = end.year(), em = end.month() + 1, ed = end.date();
        for (let y = iy; y <= ey; y++) {
            let month = [];
            let mm = [0, 31, (!(y % 4) & (!!(y % 100))) | (!(y % 400)) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            let iim = (y === iy) ? im : 1;
            let eem = (y === ey) ? em : 12;
            for (let m = iim; m <= eem; m++) {
                let day = [];
                let iid = (y === iy && m === im) ? id : 1;
                let eed = (y === ey && m === em) ? ed : mm[m];
                for (let d = iid; d <= eed; d++) {
                    day.push(d + '日');
                }
                month.push({ [m + '月']: day });
            }
            date.push({ [y + '年']: month });
        }
        return date;
    },
    createTimeData (start, end, date, hasSeconds) {
        const d = date.startOf('day');
        const isStart = d.isSame(moment(start).startOf('day'));
        const isEnd = d.isSame(moment(end).startOf('day'));
        let time = [];
        let ih = start.hour(), it = start.minute(), is = start.second();
        let eh = end.hour(), et = end.minute(), es = start.second();
        let iih = isStart ? ih : 0;
        let eeh = isEnd ? eh : 24;

        for (let h = iih; h < eeh; h++) {
            let minute = [];
            let iit = (isStart && h === ih) ? it : 0;
            let eet = (isEnd && h === eh) ? et : 60;
            for (let t = iit; t < eet; t++) {
                if (!hasSeconds) {
                    minute.push(t + '分');
                } else {
                    let second = [];
                    let iis = (isStart && h === ih && t === it) ? is : 1;
                    let ees = (isEnd && h === eh && t === et) ? es : 60;
                    for (let s = iis; s <= ees; s++) {
                        second.push(s + '秒');
                    }
                    minute.push({ [t + '分']: second });
                }
            }
            time.push({ [h + '时']: minute });
        }
        return time;
    },
    showDatePicker (Picker, start, end, selected) {
        return new Promise(async(resolve) => {
            const selectedValue = [selected.year() + '年', (selected.month() + 1) + '月', selected.date() + '日'];
            const pickerData = this.createDateData(start, end);
            Picker(pickerData, selectedValue, '选择日期').then((value) => {
                const time = moment(value.join(''), 'YYYY年M月D日');
                const date = moment(time.year() + '年' + (time.month() + 1) + '月' + time.date() + '日' + selected.hour() + '时' + selected.minute() + '分', 'YYYY年MM月DD日HH时mm分');
                resolve(date);
            });
        });
    },
    showTimePicker (Picker, start, end, selected, hasSeconds) {
        return new Promise(async(resolve) => {
            const selectedValue = [selected.hour() + '时', selected.minute() + '分', selected.second() + '秒'];
            const pickerData = this.createTimeData(start, end, selected, hasSeconds);
            Picker(pickerData, selectedValue, '选择时间').then((value) => {
                const time = moment(value.join(''), 'HH时mm分');
                const date = moment(selected.year() + '年' + (selected.month() + 1) + '月' + selected.date() + '日' + time.hour() + '时' + time.minute() + '分', 'YYYY年MM月DD日HH时mm分');
                resolve(date);
            });
        });
    },
};

```

* PDDriver/project/App/utils/net/Get.js

```js
'use strict';

function GET (url, success, error) {
    console.log('getSend:', url);
    app.showLoading();
    fetch(url, {
        method: 'get',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
        },
    })
    .then((response) => response.json())
    .then((json) => {
        console.log('getRecv:', json);
        app.hideLoading();
        success && success(json);
    })
    .catch((err) => {
        app.hideLoading();
        if (!error || !error(err)) {
            Toast('网络出错');
        }
    });
}

module.exports = GET;

```

* PDDriver/project/App/utils/net/Post.js

```js
'use strict';

module.exports = (url, parameter, success, failed, wait) => {
    console.log(url, 'send:', parameter);
    if (typeof failed === 'boolean') {
        wait = failed;
        failed = null;
    }
    if (wait) {
        app.showLoading();
    }
    fetch(url, {
        method: 'post',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(parameter),
    })
    .then((response) => response.json())
    .then((data) => {
        console.log(url, 'recv:', data);
        success(data);
        if (wait) {
            app.hideLoading();
        }
    })
    .catch((error) => {
        if (!failed || !failed(error)) {
            Toast('网络错误');
            console.log(url + ':网络错误', error);
            if (wait) {
                app.hideLoading();
            }
        }
    });
};

```

* PDDriver/project/App/utils/net/Upload.js

```js
'use strict';

const FileTransfer = require('@remobile/react-native-file-transfer');

function UPLOAD (filePath, url, options, onprogress, success, failed, wait) {
    console.log(url, 'send:', options);
    if (typeof failed === 'boolean') {
        wait = failed;
        failed = null;
    }
    if (wait) {
        app.showLoading();
    }
    const fileTransfer = new FileTransfer();
    fileTransfer.onprogress = onprogress;
    fileTransfer.upload(filePath, app.route.ROUTE_UPDATE_FILE, (res) => {
        let json = {};
        try {
            json = JSON.parse(res.response);
        } catch (error) {
            if (!failed || !failed(error)) {
                Toast('数据解析错误');
                if (wait) {
                    app.hideLoading();
                }
            }
        }
        console.log(url, 'recv:', json);
        app.hideLoading();
        success(json);
    }, (err) => {
        if (!failed || !failed(err)) {
            Toast('上传失败');
            if (wait) {
                app.hideLoading();
            }
        }
    }, options);
}

module.exports = UPLOAD;

```

* PDDriver/project/App/utils/net/index.js

```js
'use strict';

module.exports = {
    POST: require('./Post'),
    GET: require('./Get'),
    UPLOAD: require('./Upload'),
};

```

* PDDriver/project/App/utils/qrcode/index.js

```js
module.exports = {
    genQRString (type, id) {
        const str = JSON.stringify({ c: 's', t: type, d: id });
        let output = '';
        for (let x = 0, y = str.length, charCode, hexCode; x < y; ++x) {
            charCode = str.charCodeAt(x);
            if (charCode < 128) {
                charCode += 128;
            } else if (charCode > 127) {
                charCode -= 128;
            }
            charCode = 255 - charCode;
            hexCode = charCode.toString(16);
            if (hexCode.length < 2) {
                hexCode = '0' + hexCode;
            }
            output += hexCode;
        }
        return output;
    },
    getQRResult (str) {
        let output = '';
        for (let x = 0, y = str.length, charCode, hexCode; x < y; x += 2) {
            hexCode = str.substr(x, 2);
            charCode = parseInt(hexCode, 16);
            charCode = 255 - charCode;
            if (charCode < 128) {
                charCode += 128;
            } else if (charCode > 127) {
                charCode -= 128;
            }
            output += String.fromCharCode(charCode);
        }
        try {
            const result = JSON.parse(output);
            if (result.c !== 's') {
                return undefined;
            }
            return { type: result.t, id: result.d };
        } catch (e) {
            return undefined;
        }
    },
};

```
